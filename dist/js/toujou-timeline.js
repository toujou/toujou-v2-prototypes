import{_ as h}from"./tslib.es6-4b7d5947.js";import{s as d}from"./lit-element-6fe74b4f.js";import{e as u}from"./custom-element-73470d87.js";import"./query-assigned-elements-acf341e1.js";const o="toujou-timeline-new-observation",m="toujou-timeline-ready",_="toujou-timeline-legend-year-click",p="toujou-timeline-legend-ready";var n;(function(r){r.RIGHT="right",r.LEFT="left",r.NONE="none"})(n||(n={}));let l=class extends d{constructor(){super(...arguments),this._swipeDirection=n.NONE,this._swipeDistanceX=0,this._swipeStartX=0,this._swipeStartTime=0,this._swipeAllowedTime=300,this._swipeThreshold=150,this._swipeRestraint=100,this._checkForLocationHash=()=>{const e=window.location.hash;if(!e)return;this.querySelector(`${e}`)&&(this._timelineContainerEl.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),this._scrollToYear(e.substring(1)))},this._onTouchStart=e=>{const t=e.changedTouches[0];console.log("TOUCH START",t),this._swipeDirection=n.NONE,this._swipeDistanceX=0,this._swipeStartX=t.pageX,this._swipeStartTime=new Date().getTime()},this._onTouchEnd=e=>{const t=e.changedTouches[0];console.log("TOUCH END",t),this._swipeDistanceX=t.pageX-this._swipeStartX,new Date().getTime()-this._swipeStartTime<=this._swipeAllowedTime&&Math.abs(this._swipeDistanceX)>=this._swipeThreshold&&(this._swipeDirection=this._swipeDistanceX<0?n.LEFT:n.RIGHT),this._handleSwipe()},this._handleSwipe=()=>{console.log("11111"),console.log("direction",this._swipeDirection),console.log("distance",this._swipeDistanceX)}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this._init()}_init(){if(this._years=this.querySelectorAll(".timeline-item__year"),!this._years)return;this._timelineContainerEl=this.querySelector(".timeline__container"),this._isHorizontalTimeline=this.getAttribute("timeline-direction")==="horizontal",this._isHorizontalTimeline&&(this._checkForLocationHash(),this._initSwipeListeners());const e={rootMargin:"-100px -100px -100px -100px",threshold:this._createThresholdList(50)};this.observer=new IntersectionObserver(this._handleObserver.bind(this),e),this._years.forEach(t=>{this.observer.observe(t)}),this.dispatchEvent(new CustomEvent(m,{bubbles:!0,composed:!0,detail:this})),this.addEventListener(_,this._onLegendYearClick)}_handleObserver(e){const t=[];e.forEach(i=>{const s=i.target.id;s&&(t.push({yearId:s,isIntersecting:i.isIntersecting}),this.dispatchEvent(new CustomEvent(o,{bubbles:!0,composed:!0,detail:t})))})}_createThresholdList(e){return[...Array(e).keys()].map(t=>t/e)}_onLegendYearClick(e){const t=e.detail;t&&this._scrollToYear(t)}_scrollToYear(e){const t=this.querySelector(`#${e}`);if(!t)return;const i=t.closest(".timeline-item");if(!i)return;const s=i.offsetLeft;this._timelineContainerEl.scrollTo({left:s,behavior:"smooth"})}_initSwipeListeners(){console.log("initing..."),this.addEventListener("touchstart",this._onTouchStart),this.addEventListener("touchend",this._onTouchEnd)}};l=h([u("toujou-timeline")],l);let c=class extends d{constructor(){super(...arguments),this.isActiveAttribute="is-active"}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this._yearLinks=this.querySelectorAll(".timeline-legend__link"),this._yearLinks&&this._init()}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener(o,this._onTimelineObservations.bind(this))}_init(){window.addEventListener(o,this._onTimelineObservations.bind(this)),this._yearLinks.forEach(e=>{e.addEventListener("keyup",this._handleYearLinkKeyUp)}),this._isHorizontalTimeline=!!this.closest('.timeline[timeline-direction="horizontal"]'),this._isHorizontalTimeline&&this._initYearClicks(),this.dispatchEvent(new CustomEvent(p,{bubbles:!0,composed:!0,detail:this}))}_initYearClicks(){this._yearLinks.forEach(e=>{e.addEventListener("click",this._onYearLinkClick)})}_onTimelineObservations(e){const t=e.detail;t&&t.forEach(i=>{const s=this.querySelector(`.timeline-legend__link[href="#${i.yearId}"]`);s&&(i.isIntersecting?s.setAttribute(this.isActiveAttribute,""):s.removeAttribute(this.isActiveAttribute))})}_onYearLinkClick(e){let t;const i=e.currentTarget;if(!i)return;const s=i.href;if(!s)return;const a=s.split("#");a.length>1&&(t=a.pop()),t&&(e.preventDefault(),e.stopPropagation(),this.dispatchEvent(new CustomEvent(_,{bubbles:!0,composed:!0,detail:t})))}_handleYearLinkKeyUp(e){(e.key==="Enter"||e.code==="Enter"||e.code==="Space"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),e.currentTarget.click())}};c=h([u("toujou-timeline-legend")],c);
//# sourceMappingURL=toujou-timeline.js.map

{"version":3,"file":"toujou-overlay.js","sources":["../../src/components/toujou-overlay/toujou-overlay.ts"],"sourcesContent":["import { LitElement, PropertyValues } from 'lit'\nimport { customElement, property } from 'lit/decorators.js'\n\nenum COOKIE_STATES {\n    ACCEPTED = 'accepted',\n    REJECTED = 'rejected'\n}\n\nenum STATE {\n    OPEN = 'open',\n    CLOSED = 'closed'\n}\n\n@customElement('toujou-overlay')\nexport class ToujouOverlay extends LitElement {\n    @property({ type: String })\n    _overlayId: string | null = null;\n\n    @property({ type: HTMLElement })\n    _warningEl: Element | null = null;\n\n    @property({ type: HTMLElement })\n    _closeButton: Element | null = null;\n\n    @property({ type: Array })\n    _buttons: Element[] = [];\n\n    @property({ type: String })\n    _overlayCookie: string | false = false;\n\n    @property({ type: String, attribute: 'state', reflect: true })\n    state: string = STATE.CLOSED;\n\n    @property({ type: Boolean, attribute: 'warning-visible', reflect: true })\n    warningVisible: boolean = false;\n\n    protected createRenderRoot(): Element | ShadowRoot {\n        return this;\n    }\n\n    constructor() {\n        super();\n\n        this._handleButtonClick = this._handleButtonClick.bind(this);\n        this._handleCloseButtonClick = this._handleCloseButtonClick.bind(this);\n    }\n\n\n    connectedCallback() {\n        super.connectedCallback();\n        this._getElements();\n\n        if (location.hash === '#aaa') {\n            this._setCookie(COOKIE_STATES.ACCEPTED);\n        }\n\n        this._overlayCookie = this._checkCookie('toujou-overlay-' + this._overlayId)\n\n        if (this._buttons.length) {\n            this._buttons.forEach((button) => {\n                button.addEventListener('click', this._handleButtonClick)\n            })\n        }\n\n        if (this._closeButton) {\n            this._closeButton.addEventListener('click', this._handleCloseButtonClick)\n        }\n\n        if (!this._overlayCookie) {\n            this.state = STATE.OPEN;\n        } else if (this._overlayCookie === COOKIE_STATES.REJECTED) {\n            this.state = STATE.OPEN;\n        } else if (this._overlayCookie === COOKIE_STATES.ACCEPTED) {\n            this.state = STATE.CLOSED;\n        }\n    }\n\n    updated(_changedProperties: PropertyValues) {\n        super.updated(_changedProperties);\n\n        if (_changedProperties.has('state')) {\n            // Enable/disable body scroll via overlay-open attribute\n            document.body.toggleAttribute('overlay-open', STATE.OPEN === this.state);\n        }\n    }\n\n    disconnectedCallback() {\n        super.disconnectedCallback();\n\n        if (this._buttons.length) {\n            this._buttons.forEach((button) => {\n                button.removeEventListener('click', this._handleButtonClick);\n            })\n        }\n\n        if (this._closeButton) {\n            this._closeButton.removeEventListener('click', this._handleCloseButtonClick);\n        }\n    }\n\n    /**\n     * Close overlay when the close button is clicked\n     */\n    _handleCloseButtonClick() {\n        this.state = STATE.CLOSED;\n        this._setCookie(COOKIE_STATES.ACCEPTED)\n    }\n\n    /**\n     * Check which button was clicked and set state accordingly\n     * @param event\n     */\n    _handleButtonClick(event: Event) {\n        event.preventDefault();\n        const target = event?.target as HTMLButtonElement;\n        const choice: string | null = target.getAttribute('data-overlay-value') || null;\n\n\n        if (choice === 'no') {\n            this.state = STATE.OPEN;\n            this._setCookie(COOKIE_STATES.REJECTED);\n            this.warningVisible = true;\n        } else if (choice === 'yes') {\n            this.state = STATE.CLOSED;\n            this._setCookie(COOKIE_STATES.ACCEPTED);\n        }\n        target.blur();\n    }\n\n    /**\n     * Get necessary elements\n     */\n    _getElements(): void {\n        this._overlayId = this.getAttribute('id') || null;\n        this._warningEl = this.querySelector('.overlay__warning');\n        this._closeButton = this.querySelector('.overlay__close-button');\n        this._buttons = Array.from(this.querySelectorAll('.overlay__buttons .button'));\n    }\n\n    /**\n     * Set cookie with the correct name and state\n     * @param choice\n     */\n    _setCookie(choice: string): void {\n        document.cookie = `toujou-overlay-${this._overlayId}=${choice};path=/;`;\n    }\n\n    /**\n     * Get cookie for the current overlay\n     * @param cookieName\n     */\n    _checkCookie(cookieName: string): string | false {\n        const match = document.cookie.match(new RegExp('(^| )' + cookieName + '=([^;]+)'));\n        return match ? match[2] : false;\n    }\n}\n\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'toujou-overlay': ToujouOverlay\n    }\n}\n"],"names":["ToujouOverlay","LitElement","button","_changedProperties","event","target","choice","cookieName","match","__decorateClass","property","customElement"],"mappings":"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"}
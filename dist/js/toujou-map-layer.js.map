{"version":3,"file":"toujou-map-layer.js","sources":["../../node_modules/@toujou/toujou-map/dist/toujou-map-layer.js"],"sourcesContent":["import {UpdatingElement}from'lit';class ToujouMapLayer extends UpdatingElement {\n  static get is() { return 'toujou-map-layer'; }\n\n  static get properties() {\n    return {\n      layerId: {\n        type: String,\n        attribute: 'layer-id',\n      },\n      source: {\n        type: String,\n      },\n      sourceLayer: {\n        type: String,\n        attribute: 'source-layer',\n      },\n      type: {\n        type: String,\n      },\n      minZoom: {\n        type: Number,\n        attribute: 'min-zoom',\n      },\n      maxZoom: {\n        type: Number,\n        attribute: 'max-zoom',\n      },\n      filter: {\n        type: Array,\n      },\n      layout: {\n        type: Object,\n      },\n      paint: {\n        type: Object,\n      },\n\n      /**\n       * The ID of an existing layer to insert the new layer before. When viewing the map, the id layer will appear beneath the beforeId layer.\n       * If beforeId is omitted, the layer will be appended to the end of the layers array and appear above all other layers on the map.\n       * TODO check layer addition order in case, beforeLayerId is omitted.\n       */\n      beforeLayerId: {\n        type: String,\n      },\n    };\n  }\n\n  set map(map) {\n    if (map !== this._map) {\n      this._map && this.removeLayer();\n      this._map = map;\n      map && this.initLayer();\n    }\n  }\n\n  get map() {\n    return this._map;\n  }\n\n  get layerConf() {\n    const conf = {\n      id: this.layerId,\n      source: this.source,\n      // \"source-layer\": this.sourceLayer,\n      type: this.type,\n      minZoom: this.minZoom,\n      maxZoom: this.maxZoom,\n      metadata: {\n        beforeLayerId: this.beforeLayerId,\n      },\n    };\n\n    this.filter && this.filter.length > 0 && (conf.filter = this.filter);\n    this.layout && (conf.layout = this.layout);\n    this.paint && (conf.paint = this.paint);\n\n    return conf;\n  }\n\n  constructor(props) {\n    super(props);\n    this.minZoom = 0;\n    this.maxZoom = 24;\n    this.filter = [];\n    this.layout = {};\n    this.paint = {};\n    this._map = null;\n    this.layer = null;\n    this.beforeLayerId = null;\n    this.initLayer = this.initLayer.bind(this);\n    this.initWhenSourceIsAvailable = this.initWhenSourceIsAvailable.bind(this);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.dispatchEvent(new CustomEvent('toujou-map-element-attached', { detail: this, bubbles: true, composed: true }));\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.map && this.removeLayer();\n  }\n\n  // eslint-disable-next-line consistent-return\n  initLayer() {\n    if (!this.map.style) {\n      return this.map.once('load', this.initLayer);\n    }\n\n    if (!this.map.getSource(this.source)) {\n      this.map.on('sourcedata', this.initWhenSourceIsAvailable);\n      // eslint-disable-next-line consistent-return\n      return;\n    }\n\n    this.map.addLayer(this.layerConf);\n    this.dispatchEvent(new CustomEvent('toujou-map-layer-added', { detail: this.layerConf, bubbles: true, composed: true }));\n    this.layer = this.map.getLayer(this.layerId);\n  }\n\n  initWhenSourceIsAvailable(event) {\n    if (event.sourceId === this.source) {\n      this.map.off('sourcedata', this.initWhenSourceIsAvailable);\n      this.initLayer();\n    }\n  }\n\n  removeLayer() {\n    if (this.map.getLayer(this.layerId)) {\n      this.dispatchEvent(new CustomEvent('toujou-map-layer-removed', { detail: this.layerConf, bubbles: true, composed: true }));\n      this.map.removeLayer(this.layerId);\n    }\n  }\n}\n\ncustomElements.define(ToujouMapLayer.is, ToujouMapLayer);//# sourceMappingURL=toujou-map-layer.js.map\n"],"names":["ToujouMapLayer","UpdatingElement","map","conf","props","event"],"mappings":"8CAAkC,MAAMA,UAAuBC,CAAgB,CAC7E,WAAW,IAAK,CAAE,MAAO,kBAAqB,CAE9C,WAAW,YAAa,CACtB,MAAO,CACL,QAAS,CACP,KAAM,OACN,UAAW,UACZ,EACD,OAAQ,CACN,KAAM,MACP,EACD,YAAa,CACX,KAAM,OACN,UAAW,cACZ,EACD,KAAM,CACJ,KAAM,MACP,EACD,QAAS,CACP,KAAM,OACN,UAAW,UACZ,EACD,QAAS,CACP,KAAM,OACN,UAAW,UACZ,EACD,OAAQ,CACN,KAAM,KACP,EACD,OAAQ,CACN,KAAM,MACP,EACD,MAAO,CACL,KAAM,MACP,EAOD,cAAe,CACb,KAAM,MACP,CACP,CACG,CAED,IAAI,IAAIC,EAAK,CACPA,IAAQ,KAAK,OACf,KAAK,MAAQ,KAAK,cAClB,KAAK,KAAOA,EACZA,GAAO,KAAK,YAEf,CAED,IAAI,KAAM,CACR,OAAO,KAAK,IACb,CAED,IAAI,WAAY,CACd,MAAMC,EAAO,CACX,GAAI,KAAK,QACT,OAAQ,KAAK,OAEb,KAAM,KAAK,KACX,QAAS,KAAK,QACd,QAAS,KAAK,QACd,SAAU,CACR,cAAe,KAAK,aACrB,CACP,EAEI,YAAK,QAAU,KAAK,OAAO,OAAS,IAAMA,EAAK,OAAS,KAAK,QAC7D,KAAK,SAAWA,EAAK,OAAS,KAAK,QACnC,KAAK,QAAUA,EAAK,MAAQ,KAAK,OAE1BA,CACR,CAED,YAAYC,EAAO,CACjB,MAAMA,CAAK,EACX,KAAK,QAAU,EACf,KAAK,QAAU,GACf,KAAK,OAAS,GACd,KAAK,OAAS,GACd,KAAK,MAAQ,GACb,KAAK,KAAO,KACZ,KAAK,MAAQ,KACb,KAAK,cAAgB,KACrB,KAAK,UAAY,KAAK,UAAU,KAAK,IAAI,EACzC,KAAK,0BAA4B,KAAK,0BAA0B,KAAK,IAAI,CAC1E,CAED,mBAAoB,CAClB,MAAM,kBAAiB,EACvB,KAAK,cAAc,IAAI,YAAY,8BAA+B,CAAE,OAAQ,KAAM,QAAS,GAAM,SAAU,EAAI,CAAE,CAAC,CACnH,CAED,sBAAuB,CACrB,MAAM,qBAAoB,EAC1B,KAAK,KAAO,KAAK,aAClB,CAGD,WAAY,CACV,GAAI,CAAC,KAAK,IAAI,MACZ,OAAO,KAAK,IAAI,KAAK,OAAQ,KAAK,SAAS,EAG7C,GAAI,CAAC,KAAK,IAAI,UAAU,KAAK,MAAM,EAAG,CACpC,KAAK,IAAI,GAAG,aAAc,KAAK,yBAAyB,EAExD,MACD,CAED,KAAK,IAAI,SAAS,KAAK,SAAS,EAChC,KAAK,cAAc,IAAI,YAAY,yBAA0B,CAAE,OAAQ,KAAK,UAAW,QAAS,GAAM,SAAU,EAAI,CAAE,CAAC,EACvH,KAAK,MAAQ,KAAK,IAAI,SAAS,KAAK,OAAO,CAC5C,CAED,0BAA0BC,EAAO,CAC3BA,EAAM,WAAa,KAAK,SAC1B,KAAK,IAAI,IAAI,aAAc,KAAK,yBAAyB,EACzD,KAAK,UAAS,EAEjB,CAED,aAAc,CACR,KAAK,IAAI,SAAS,KAAK,OAAO,IAChC,KAAK,cAAc,IAAI,YAAY,2BAA4B,CAAE,OAAQ,KAAK,UAAW,QAAS,GAAM,SAAU,EAAI,CAAE,CAAC,EACzH,KAAK,IAAI,YAAY,KAAK,OAAO,EAEpC,CACH,CAEA,eAAe,OAAOL,EAAe,GAAIA,CAAc"}
{"version":3,"file":"toujou-contact-box.js","sources":["../../src/components/toujou-contact-box/toujou-contact-box.ts"],"sourcesContent":["import { LitElement } from 'lit'\nimport { customElement, property } from 'lit/decorators.js'\n\n@customElement('toujou-contact-box')\nexport class ToujouContactBox extends LitElement {\n    // Constants\n    openContactBoxBodyAttribute = 'contact-box-is-open';\n    keyCodes = {\n        tab: 9,\n        escape: 27,\n    };\n    selectors = {\n        focusableEls: '.contact-box__close, a.contact-box__link',\n        contactStateInput: '#contact-state',\n        closeButton: '.contact-box__close',\n    };\n\n    @property({ type: HTMLElement })\n    private _closeButton: HTMLButtonElement | null = null;\n\n    @property({ type: HTMLInputElement })\n    private _contactStateInput: HTMLInputElement | null = null;\n\n    @property({ type: Boolean })\n    private state: boolean = false;\n\n    @property({ type: HTMLElement })\n    private _focusableEls: HTMLElement[] = [];\n\n    @property({ type: HTMLElement })\n    private _firstFocusableEl: HTMLElement | null = null;\n\n    @property({ type: HTMLElement })\n    private _lastFocusableEl: HTMLElement | null = null;\n\n    @property({ type: HTMLElement })\n    private _prevContentFocusEl: HTMLElement | null = null;\n\n    protected createRenderRoot(): Element | ShadowRoot {\n        return this;\n    }\n\n    /**\n     * When the state changes we should:\n     *  - toggle body attribute\n     *  - focus trap\n     *  - add / remove keydown event listeners\n     * @param value\n     */\n    set _state(value: boolean) {\n        this.state = value;\n\n        if (this.state) {\n            this.setAttribute('tabindex', '0');\n            document.body.setAttribute(this.openContactBoxBodyAttribute, '');\n            window.addEventListener('keydown', this._handleKeyDown.bind(this));\n            this._prevContentFocusEl = document.activeElement as HTMLElement;\n            this.focus();\n        } else {\n            this.removeAttribute('tabindex');\n            this._contactStateInput!.checked = false;\n            document.body.removeAttribute(this.openContactBoxBodyAttribute);\n            window.removeEventListener('keydown', this._handleKeyDown);\n            this._prevContentFocusEl?.focus();\n        }\n    }\n\n    get _value() {\n        return this.state;\n    }\n\n    /**\n     * Get necessary elements and initialize\n     */\n    connectedCallback() {\n        this._contactStateInput = document.querySelector(this.selectors.contactStateInput);\n        this._closeButton = this.querySelector(this.selectors.closeButton);\n\n        if (!this._closeButton || !this._contactStateInput) {\n            console.error('TOUJOU: Could not find the necessary elements for the contact box');\n            return;\n        } else {\n            this._init();\n        }\n    }\n\n    /**\n     * Remove event listeners\n     */\n    disconnectedCallback() {\n        this._contactStateInput?.removeEventListener('change', this._handleStateInputStateChange);\n        this.removeEventListener('click', this._handleClick);\n        this._closeButton?.removeEventListener('click', this._handleCloseButtonClick);\n    }\n\n    /**\n     * Get focusable elements and add event listeners\n     */\n    _init() {\n        this._focusableEls = Array.from(this.querySelectorAll(this.selectors.focusableEls));\n        this._firstFocusableEl = this._focusableEls[0];\n        this._lastFocusableEl = this._focusableEls[this._focusableEls.length - 1];\n        this._contactStateInput?.addEventListener('change', this._handleStateInputStateChange.bind(this));\n        this.addEventListener('click', this._handleClick.bind(this));\n        this._closeButton?.addEventListener('click', this._handleCloseButtonClick.bind(this));\n    }\n\n    /**\n     * When the state input changes we should set the corresponding state to the this._state variable\n     */\n    _handleStateInputStateChange() {\n        this._state = this._contactStateInput?.checked || false;\n    }\n\n    /**\n     * Check if click target was the backdrop. if so, close contact box by \"clicking\" on close button\n     * @param event\n     */\n    _handleClick(event: MouseEvent) {\n        const clickedElement = event.target as HTMLElement;\n        if (clickedElement === this && this._closeButton) {\n            this._state = false;\n        }\n    }\n\n    /**\n     * React to key down events\n     *  - Esc key should close the contact box\n     *  - tab should move to next focusable element\n     *  - tab + shift should move to previous focusable element\n     * @param event\n     */\n    _handleKeyDown(event: KeyboardEvent) {\n        if (!this.state) return;\n\n        if (event.key === 'Escape' || event.keyCode === this.keyCodes.escape) {\n            this._handleEscapePress();\n        } else if (event.key === 'Tab' || event.keyCode === this.keyCodes.tab) {\n            this._handleTabPress(event);\n        }\n    }\n\n    /**\n     * Close the contact box when the escape key is pressed\n     */\n    _handleEscapePress() {\n        this._state = false;\n    }\n\n    /**\n     * Focus trap inside the contact box\n     * - tab should move to next focusable element\n     * - tab + shift should move to previous focusable element\n     * @param event\n     */\n    _handleTabPress(event: KeyboardEvent) {\n        if (event.shiftKey) {\n            if (document.activeElement === this._firstFocusableEl) {\n                event.preventDefault();\n                this._lastFocusableEl?.focus();\n            }\n        } else {\n            if (document.activeElement === this._lastFocusableEl) {\n                event.preventDefault();\n                this._firstFocusableEl?.focus();\n            }\n        }\n    }\n\n    /**\n     * Close the contact box when the close button is clicked\n     */\n    _handleCloseButtonClick() {\n        this._state = false;\n    }\n}\n\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'toujou-contact-box': ToujouContactBox\n    }\n}"],"names":["ToujouContactBox","LitElement","value","_a","_b","event","__decorateClass","property","customElement"],"mappings":"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"}
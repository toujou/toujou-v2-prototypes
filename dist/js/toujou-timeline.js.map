{"version":3,"file":"toujou-timeline.js","sources":["../../node_modules/@toujou/toujou-timeline/lib/index.js"],"sourcesContent":["import {__decorate}from'tslib';import {LitElement}from'lit';import {customElement}from'lit/decorators.js';// Custom event names\nconst timelineNewObservationEventName = 'toujou-timeline-new-observation';\nconst timelineReadyEventName = 'toujou-timeline-ready';\nconst timelineLegendYearClickEventName = 'toujou-timeline-legend-year-click';\nconst timelineLegendReadyEventName = 'toujou-timeline-legend-ready';var SwipeDirection;\n(function (SwipeDirection) {\n    SwipeDirection[\"RIGHT\"] = \"right\";\n    SwipeDirection[\"LEFT\"] = \"left\";\n    SwipeDirection[\"NONE\"] = \"none\";\n})(SwipeDirection || (SwipeDirection = {}));\nlet ToujouTimeline = class ToujouTimeline extends LitElement {\n    constructor() {\n        super(...arguments);\n        this._swipeDirection = SwipeDirection.NONE;\n        this._swipeDistanceX = 0;\n        this._swipeStartX = 0;\n        this._swipeStartTime = 0;\n        this._swipeAllowedTime = 300;\n        this._swipeThreshold = 150;\n        this._swipeRestraint = 100;\n        /**\n         * Check if the location address has a #id. If so:\n         *  - check if it corresponds to a timeline's child element. If so:\n         *    - Scroll timeline into view\n         *    - Scroll to correct year\n         */\n        this._checkForLocationHash = () => {\n            const yearHash = window.location.hash;\n            if (!yearHash)\n                return;\n            const targetYearEl = this.querySelector(`${yearHash}`);\n            if (targetYearEl) {\n                // Means the hash corresponds to a child element's id, and we should scroll it into view\n                this._timelineContainerEl.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'nearest' });\n                this._scrollToYear(yearHash.substring(1));\n            }\n        };\n        this._onTouchStart = (event) => {\n            const touchObj = event.changedTouches[0];\n            console.log('TOUCH START', touchObj);\n            this._swipeDirection = SwipeDirection.NONE;\n            this._swipeDistanceX = 0;\n            this._swipeStartX = touchObj.pageX;\n            this._swipeStartTime = new Date().getTime();\n        };\n        this._onTouchEnd = (event) => {\n            const touchObj = event.changedTouches[0];\n            console.log('TOUCH END', touchObj);\n            this._swipeDistanceX = touchObj.pageX - this._swipeStartX;\n            const elapsedTime = new Date().getTime() - this._swipeStartTime;\n            if (elapsedTime <= this._swipeAllowedTime) {\n                if (Math.abs(this._swipeDistanceX) >= this._swipeThreshold) {\n                    this._swipeDirection = (this._swipeDistanceX < 0) ? SwipeDirection.LEFT : SwipeDirection.RIGHT;\n                }\n            }\n            this._handleSwipe();\n        };\n        this._handleSwipe = () => {\n            console.log('11111');\n            console.log('direction', this._swipeDirection);\n            console.log('distance', this._swipeDistanceX);\n        };\n    }\n    createRenderRoot() {\n        return this;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this._init();\n    }\n    /**\n     * Initialize the timeline element by\n     *  - Getting all 'year' element and start observing any visibility changes\n     */\n    _init() {\n        this._years = this.querySelectorAll('.timeline-item__year');\n        if (!this._years)\n            return;\n        this._timelineContainerEl = this.querySelector('.timeline__container');\n        this._isHorizontalTimeline = this.getAttribute('timeline-direction') === 'horizontal';\n        if (this._isHorizontalTimeline) {\n            this._checkForLocationHash();\n            this._initSwipeListeners();\n        }\n        // Options for the intersection observer\n        const options = {\n            rootMargin: '-100px -100px -100px -100px',\n            threshold: this._createThresholdList(50),\n        };\n        this.observer = new IntersectionObserver(this._handleObserver.bind(this), options);\n        // Watch for any visibility changes on any of the \"year\" items\n        this._years.forEach((year) => {\n            this.observer.observe(year);\n        });\n        // Timeline ready event dispatch\n        this.dispatchEvent(new CustomEvent(timelineReadyEventName, {\n            bubbles: true,\n            composed: true,\n            detail: this\n        }));\n        this.addEventListener(timelineLegendYearClickEventName, this._onLegendYearClick);\n    }\n    /**\n     * Dispatch a custom event whenever any of the \"year\" element's visibility changes\n     * @param entries\n     */\n    _handleObserver(entries) {\n        const observations = [];\n        entries.forEach((entry) => {\n            const targetId = entry.target.id;\n            if (!targetId)\n                return;\n            observations.push({\n                yearId: targetId,\n                isIntersecting: entry.isIntersecting\n            });\n            this.dispatchEvent(new CustomEvent(timelineNewObservationEventName, {\n                bubbles: true,\n                composed: true,\n                detail: observations\n            }));\n        });\n    }\n    /**\n     * Generate a threshold list for the observer base on a number of steps\n     * @param numberOfSteps\n     */\n    _createThresholdList(numberOfSteps) {\n        return [...Array(numberOfSteps).keys()].map((x) => x / numberOfSteps);\n    }\n    /**\n     * React to the legend year click by getting the correct scroll target element and triggering the scroll function\n     * @param event\n     */\n    _onLegendYearClick(event) {\n        const scrollTarget = event.detail;\n        if (!scrollTarget)\n            return;\n        this._scrollToYear(scrollTarget);\n    }\n    /**\n     * Scroll to the correct target element\n     * @param scrollTarget\n     */\n    _scrollToYear(scrollTarget) {\n        const targetYearEl = this.querySelector(`#${scrollTarget}`);\n        if (!targetYearEl)\n            return;\n        const targetParentTimelineItem = targetYearEl.closest('.timeline-item');\n        if (!targetParentTimelineItem)\n            return;\n        const timelineParentItemOffsetLeft = targetParentTimelineItem.offsetLeft;\n        this._timelineContainerEl.scrollTo({\n            left: timelineParentItemOffsetLeft,\n            behavior: 'smooth'\n        });\n    }\n    _initSwipeListeners() {\n        console.log('initing...');\n        this.addEventListener('touchstart', this._onTouchStart);\n        this.addEventListener('touchend', this._onTouchEnd);\n    }\n};\nToujouTimeline = __decorate([\n    customElement('toujou-timeline')\n], ToujouTimeline);let ToujouTimelineLegend = class ToujouTimelineLegend extends LitElement {\n    constructor() {\n        super(...arguments);\n        this.isActiveAttribute = 'is-active';\n    }\n    createRenderRoot() {\n        return this;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this._yearLinks = this.querySelectorAll('.timeline-legend__link');\n        if (!this._yearLinks)\n            return;\n        this._init();\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        window.removeEventListener(timelineNewObservationEventName, this._onTimelineObservations.bind(this));\n    }\n    /**\n     * Initialize the legend component:\n     *  - Add timeline observations events listener\n     *  - If horizontal timeline -> add year click listeners\n     */\n    _init() {\n        window.addEventListener(timelineNewObservationEventName, this._onTimelineObservations.bind(this));\n        this._yearLinks.forEach((yearLink) => {\n            yearLink.addEventListener('keyup', this._handleYearLinkKeyUp);\n        });\n        this._isHorizontalTimeline = !!this.closest('.timeline[timeline-direction=\"horizontal\"]');\n        if (this._isHorizontalTimeline) {\n            this._initYearClicks();\n        }\n        this.dispatchEvent(new CustomEvent(timelineLegendReadyEventName, {\n            bubbles: true,\n            composed: true,\n            detail: this\n        }));\n    }\n    /**\n     * Add a click event listener to each of the year links elements\n     */\n    _initYearClicks() {\n        this._yearLinks.forEach((yearLink) => {\n            yearLink.addEventListener('click', this._onYearLinkClick);\n        });\n    }\n    /**\n     * Listen to any observations (visibility change of any timeline \"year\" element)\n     * and toggle the 'is-active' attribute accordingly\n     * @param event\n     */\n    _onTimelineObservations(event) {\n        const observations = event.detail;\n        if (!observations)\n            return;\n        observations.forEach((observation) => {\n            const targetLink = this.querySelector(`.timeline-legend__link[href=\"#${observation.yearId}\"]`);\n            if (!targetLink)\n                return;\n            observation.isIntersecting\n                ? targetLink.setAttribute(this.isActiveAttribute, '')\n                : targetLink.removeAttribute(this.isActiveAttribute);\n        });\n    }\n    /**\n     * When a year link is clicked:\n     *  - prevent default\n     *  - get target hash and dispatch custom event\n     * @param event\n     */\n    _onYearLinkClick(event) {\n        let yearHash = undefined;\n        const year = event.currentTarget;\n        if (!year)\n            return;\n        const yearTargetId = year.href;\n        if (!yearTargetId)\n            return;\n        const yearParts = yearTargetId.split('#');\n        if (yearParts.length > 1) {\n            yearHash = yearParts.pop();\n        }\n        if (!yearHash)\n            return;\n        event.preventDefault();\n        event.stopPropagation();\n        this.dispatchEvent(new CustomEvent(timelineLegendYearClickEventName, {\n            bubbles: true,\n            composed: true,\n            detail: yearHash\n        }));\n    }\n    /**\n     * Handle Space and Enter key press when year link is focused\n     * @param event\n     */\n    _handleYearLinkKeyUp(event) {\n        if (event.key === 'Enter' || event.code === 'Enter' || event.code === 'Space' || event.key === ' ') {\n            event.preventDefault();\n            event.stopPropagation();\n            const currentTarget = event.currentTarget;\n            currentTarget.click();\n        }\n    }\n};\nToujouTimelineLegend = __decorate([\n    customElement('toujou-timeline-legend')\n], ToujouTimelineLegend);//# sourceMappingURL=index.js.map\n"],"names":["timelineNewObservationEventName","timelineReadyEventName","timelineLegendYearClickEventName","timelineLegendReadyEventName","SwipeDirection","ToujouTimeline","LitElement","yearHash","event","touchObj","options","year","entries","observations","entry","targetId","numberOfSteps","x","scrollTarget","targetYearEl","targetParentTimelineItem","timelineParentItemOffsetLeft","__decorate","customElement","ToujouTimelineLegend","yearLink","observation","targetLink","yearTargetId","yearParts"],"mappings":"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"}
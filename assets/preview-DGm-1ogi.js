var fv=Object.defineProperty;var mv=(b,f,s)=>f in b?fv(b,f,{enumerable:!0,configurable:!0,writable:!0,value:s}):b[f]=s;var Kg=(b,f,s)=>mv(b,typeof f!="symbol"?f+"":f,s);import{T as gv,i as bn,s as mi,x as pi,r as Uf}from"./lit-element-BBH-C6Hg.js";import{e as _v,i as yv,t as vv,a as bv,d as xv,b as wv}from"./directive-CgLDkg6E.js";import{m as Sv,f as ls,c as qc,p as Bp,a as Cv}from"./directive-helpers-Dws2r8QK.js";import{c as qf,g as __}from"./_commonjsHelpers-Cpj98o6Y.js";import{U as Tv}from"./index-DK7qLjyd.js";import{b as Ev}from"./badgeCustomConfig-DUXiHpL4.js";import"./index-DO8khQO4.js";/*! (c) Andrea Giammarchi @webreflection ISC */(function(){var b=function(k,V){var Q=function(Be){for(var Ve=0,nt=Be.length;Ve<nt;Ve++)fe(Be[Ve])},fe=function(Be){var Ve=Be.target,nt=Be.attributeName,Ze=Be.oldValue;Ve.attributeChangedCallback(nt,Ze,Ve.getAttribute(nt))};return function(Se,Be){var Ve=Se.constructor.observedAttributes;return Ve&&k(Be).then(function(){new V(Q).observe(Se,{attributes:!0,attributeOldValue:!0,attributeFilter:Ve});for(var nt=0,Ze=Ve.length;nt<Ze;nt++)Se.hasAttribute(Ve[nt])&&fe({target:Se,attributeName:Ve[nt],oldValue:null})}),Se}};function f(k,V){if(k){if(typeof k=="string")return s(k,V);var Q=Object.prototype.toString.call(k).slice(8,-1);if(Q==="Object"&&k.constructor&&(Q=k.constructor.name),Q==="Map"||Q==="Set")return Array.from(k);if(Q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Q))return s(k,V)}}function s(k,V){(V==null||V>k.length)&&(V=k.length);for(var Q=0,fe=new Array(V);Q<V;Q++)fe[Q]=k[Q];return fe}function E(k,V){var Q=typeof Symbol<"u"&&k[Symbol.iterator]||k["@@iterator"];if(!Q){if(Array.isArray(k)||(Q=f(k))||V){Q&&(k=Q);var fe=0,Se=function(){};return{s:Se,n:function(){return fe>=k.length?{done:!0}:{done:!1,value:k[fe++]}},e:function(Ze){throw Ze},f:Se}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Be=!0,Ve=!1,nt;return{s:function(){Q=Q.call(k)},n:function(){var Ze=Q.next();return Be=Ze.done,Ze},e:function(Ze){Ve=!0,nt=Ze},f:function(){try{!Be&&Q.return!=null&&Q.return()}finally{if(Ve)throw nt}}}}/*! (c) Andrea Giammarchi - ISC */var R=!0,G=!1,S="querySelectorAll",l=function(V){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document,fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:MutationObserver,Se=arguments.length>3&&arguments[3]!==void 0?arguments[3]:["*"],Be=function Ze(qe,yt,Ht,K,De,je){var Mt=E(qe),Gt;try{for(Mt.s();!(Gt=Mt.n()).done;){var Ue=Gt.value;(je||S in Ue)&&(De?Ht.has(Ue)||(Ht.add(Ue),K.delete(Ue),V(Ue,De)):K.has(Ue)||(K.add(Ue),Ht.delete(Ue),V(Ue,De)),je||Ze(Ue[S](yt),yt,Ht,K,De,R))}}catch(zt){Mt.e(zt)}finally{Mt.f()}},Ve=new fe(function(Ze){if(Se.length){var qe=Se.join(","),yt=new Set,Ht=new Set,K=E(Ze),De;try{for(K.s();!(De=K.n()).done;){var je=De.value,Mt=je.addedNodes,Gt=je.removedNodes;Be(Gt,qe,yt,Ht,G,G),Be(Mt,qe,yt,Ht,R,G)}}catch(Ue){K.e(Ue)}finally{K.f()}}}),nt=Ve.observe;return(Ve.observe=function(Ze){return nt.call(Ve,Ze,{subtree:R,childList:R})})(Q),Ve},ae="querySelectorAll",_e=self,ee=_e.document,Pe=_e.Element,Ce=_e.MutationObserver,N=_e.Set,ge=_e.WeakMap,Ee=function(V){return ae in V},He=[].filter,tt=function(k){var V=new ge,Q=function(K){for(var De=0,je=K.length;De<je;De++)V.delete(K[De])},fe=function(){for(var K=qe.takeRecords(),De=0,je=K.length;De<je;De++)Ve(He.call(K[De].removedNodes,Ee),!1),Ve(He.call(K[De].addedNodes,Ee),!0)},Se=function(K){return K.matches||K.webkitMatchesSelector||K.msMatchesSelector},Be=function(K,De){var je;if(De)for(var Mt,Gt=Se(K),Ue=0,zt=nt.length;Ue<zt;Ue++)Gt.call(K,Mt=nt[Ue])&&(V.has(K)||V.set(K,new N),je=V.get(K),je.has(Mt)||(je.add(Mt),k.handle(K,De,Mt)));else V.has(K)&&(je=V.get(K),V.delete(K),je.forEach(function(Lt){k.handle(K,De,Lt)}))},Ve=function(K){for(var De=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,je=0,Mt=K.length;je<Mt;je++)Be(K[je],De)},nt=k.query,Ze=k.root||ee,qe=l(Be,Ze,Ce,nt),yt=Pe.prototype.attachShadow;return yt&&(Pe.prototype.attachShadow=function(Ht){var K=yt.call(this,Ht);return qe.observe(K),K}),nt.length&&Ve(Ze[ae](nt)),{drop:Q,flush:fe,observer:qe,parse:Ve}},Ge=self,Ye=Ge.document,mt=Ge.Map,dt=Ge.MutationObserver,pt=Ge.Object,$e=Ge.Set,bt=Ge.WeakMap,Pt=Ge.Element,Qe=Ge.HTMLElement,Ke=Ge.Node,et=Ge.Error,rt=Ge.TypeError,Dt=Ge.Reflect,It=pt.defineProperty,ei=pt.keys,Zt=pt.getOwnPropertyNames,Rt=pt.setPrototypeOf,Tt=!self.customElements,at=function(V){for(var Q=ei(V),fe=[],Se=new $e,Be=Q.length,Ve=0;Ve<Be;Ve++){fe[Ve]=V[Q[Ve]];try{delete V[Q[Ve]]}catch{Se.add(Ve)}}return function(){for(var nt=0;nt<Be;nt++)Se.has(nt)||(V[Q[nt]]=fe[nt])}};if(Tt){var ft=function(){var V=this.constructor;if(!ii.has(V))throw new rt("Illegal constructor");var Q=ii.get(V);if(Ci)return ut(Ci,Q);var fe=xt.call(Ye,Q);return ut(Rt(fe,V.prototype),Q)},xt=Ye.createElement,ii=new mt,Qt=new mt,gi=new mt,st=new mt,Yt=[],_i=function(V,Q,fe){var Se=gi.get(fe);if(Q&&!Se.isPrototypeOf(V)){var Be=at(V);Ci=Rt(V,Se);try{new Se.constructor}finally{Ci=null,Be()}}var Ve="".concat(Q?"":"dis","connectedCallback");Ve in Se&&V[Ve]()},qt=tt({query:Yt,handle:_i}),fi=qt.parse,Ci=null,Wi=function(V){if(!Qt.has(V)){var Q,fe=new Promise(function(Se){Q=Se});Qt.set(V,{$:fe,_:Q})}return Qt.get(V).$},ut=b(Wi,dt);self.customElements={define:function(V,Q){if(st.has(V))throw new et('the name "'.concat(V,'" has already been used with this registry'));ii.set(Q,V),gi.set(V,Q.prototype),st.set(V,Q),Yt.push(V),Wi(V).then(function(){fi(Ye.querySelectorAll(V))}),Qt.get(V)._(Q)},get:function(V){return st.get(V)},whenDefined:Wi},It(ft.prototype=Qe.prototype,"constructor",{value:ft}),self.HTMLElement=ft,Ye.createElement=function(k,V){var Q=V&&V.is,fe=Q?st.get(Q):st.get(k);return fe?new fe:xt.call(Ye,k)},"isConnected"in Ke.prototype||It(Ke.prototype,"isConnected",{configurable:!0,get:function(){return!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}else if(Tt=!self.customElements.get("extends-br"),Tt)try{var Xt=function k(){return self.Reflect.construct(HTMLBRElement,[],k)};Xt.prototype=HTMLLIElement.prototype;var we="extends-br";self.customElements.define("extends-br",Xt,{extends:"br"}),Tt=Ye.createElement("br",{is:we}).outerHTML.indexOf(we)<0;var ht=self.customElements,Ot=ht.get,Et=ht.whenDefined;self.customElements.whenDefined=function(k){var V=this;return Et.call(this,k).then(function(Q){return Q||Ot.call(V,k)})}}catch{}if(Tt){var $t=function(V){var Q=Ti.get(V);be(Q.querySelectorAll(this),V.isConnected)},jt=self.customElements,Pi=Ye.createElement,Yi=jt.define,Di=jt.get,Ii=jt.upgrade,ni=Dt||{construct:function(V){return V.call(this)}},tn=ni.construct,Ti=new bt,Ui=new $e,nn=new mt,hn=new mt,At=new mt,ue=new mt,j=[],q=[],Z=function(V){return ue.get(V)||Di.call(jt,V)},ne=function(V,Q,fe){var Se=At.get(fe);if(Q&&!Se.isPrototypeOf(V)){var Be=at(V);z=Rt(V,Se);try{new Se.constructor}finally{z=null,Be()}}var Ve="".concat(Q?"":"dis","connectedCallback");Ve in Se&&V[Ve]()},pe=tt({query:q,handle:ne}),be=pe.parse,Me=tt({query:j,handle:function(V,Q){Ti.has(V)&&(Q?Ui.add(V):Ui.delete(V),q.length&&$t.call(q,V))}}),ve=Me.parse,Ae=Pt.prototype.attachShadow;Ae&&(Pt.prototype.attachShadow=function(k){var V=Ae.call(this,k);return Ti.set(this,V),V});var Te=function(V){if(!hn.has(V)){var Q,fe=new Promise(function(Se){Q=Se});hn.set(V,{$:fe,_:Q})}return hn.get(V).$},de=b(Te,dt),z=null;Zt(self).filter(function(k){return/^HTML.*Element$/.test(k)}).forEach(function(k){var V=self[k];function Q(){var fe=this.constructor;if(!nn.has(fe))throw new rt("Illegal constructor");var Se=nn.get(fe),Be=Se.is,Ve=Se.tag;if(Be){if(z)return de(z,Be);var nt=Pi.call(Ye,Ve);return nt.setAttribute("is",Be),de(Rt(nt,fe.prototype),Be)}else return tn.call(this,V,[],fe)}It(Q.prototype=V.prototype,"constructor",{value:Q}),It(self,k,{value:Q})}),Ye.createElement=function(k,V){var Q=V&&V.is;if(Q){var fe=ue.get(Q);if(fe&&nn.get(fe).tag===k)return new fe}var Se=Pi.call(Ye,k);return Q&&Se.setAttribute("is",Q),Se},jt.get=Z,jt.whenDefined=Te,jt.upgrade=function(k){var V=k.getAttribute("is");if(V){var Q=ue.get(V);if(Q){de(Rt(k,Q.prototype),V);return}}Ii.call(jt,k)},jt.define=function(k,V,Q){if(Z(k))throw new et("'".concat(k,"' has already been defined as a custom element"));var fe,Se=Q&&Q.extends;nn.set(V,Se?{is:k,tag:Se}:{is:"",tag:k}),Se?(fe="".concat(Se,'[is="').concat(k,'"]'),At.set(fe,V.prototype),ue.set(k,V),q.push(fe)):(Yi.apply(jt,arguments),j.push(fe=k)),Te(k).then(function(){Se?(be(Ye.querySelectorAll(fe)),Ui.forEach($t,[fe])):ve(Ye.querySelectorAll(fe))}),hn.get(k)._(V)}}})();class Mv{constructor(f){this.navListItems=[],this.activeSubNavs=[],this.listItemSelector=".main-nav__list-item",this.hasSubNavAttribute="data-has-subnav",this.isOpenAttribute="data-is-open",this.listItemLevelAttribute="data-nav-item-level",this.listItemChevronSelector=".main-nav__chevron",this.listSelector=".main-nav__list",this.isOpenOnHoverAttribute="data-is-open-on-hover",this._getNavListItems=()=>{if(this.navListItems=[...this.mainNavEl.querySelectorAll(this.listItemSelector)],!this.navListItems){console.warn("TOUJOU: Main navigation has no list items!");return}this.navListItems.forEach(s=>{s.hasSubNav=s.hasAttribute(this.hasSubNavAttribute),s.hasSubNav&&(s.isOpen=!1,s.level=s.getAttribute(this.listItemLevelAttribute),s.toggleEl=s.querySelector(".main-nav__chevron"),s.toggleEl.addEventListener("click",()=>{this._toggleListItemState(s)}),s.addEventListener("keyup",this._handleKeyUp))})},this._handleMouseEvent=s=>{window.innerWidth<this.minWidthDesktop||(s.type==="mouseenter"||s.type==="mouseleave")&&this._toggleListItemState(s.currentTarget)},this._handleKeyUp=s=>{var E,R,G;if(s.key==="Escape"||s.code==="Escape"){const S=this.activeSubNavs.shift();s.stopPropagation(),S?(this._toggleListItemState(S),(G=(R=S.parentElement)==null?void 0:R.querySelector(`${this.listItemChevronSelector}[aria-controls="${(E=S.querySelector(this.listSelector))==null?void 0:E.id}"]`))==null||G.focus({focusVisible:!0})):this.mainNavEl.dispatchEvent(new CustomEvent("toujou-main-nav-close"))}},this._toggleListItemState=s=>{const E=s.querySelector(this.listItemChevronSelector);s.isOpen=!s.isOpen,E==null||E.setAttribute("aria-expanded",`${s.isOpen}`),E==null||E.setAttribute("aria-pressed",`${s.isOpen}`),s.isOpen?(s.setAttribute(this.isOpenAttribute,""),this._closeOtherOpenListItems(s),this.activeSubNavs.unshift(s),window.addEventListener("click",this._onWindowClick)):s.removeAttribute(this.isOpenAttribute)},this._closeOtherOpenListItems=s=>{var R;const E=(R=s.parentNode)==null?void 0:R.querySelectorAll(`${this.listItemSelector}[${this.isOpenAttribute}]`);E&&E.forEach(G=>{G.isOpen&&G!==s&&this._toggleListItemState(G)})},this._closeAllNavListItems=()=>{this.navListItems.forEach(s=>{s.isOpen&&(this._toggleListItemState(s),window.removeEventListener("click",this._onWindowClick))})},this._onWindowClick=s=>{s.target.closest(".main-nav")||this._closeAllNavListItems()},this.mainNavEl=f,this.minWidthDesktop=parseInt(getComputedStyle(f).getPropertyValue("--main-nav-min-width-desktop"))||1024,this._getNavListItems(),this.mainNavEl.hasAttribute(this.isOpenOnHoverAttribute)&&this.navListItems.forEach(s=>{s.hasSubNav&&(s.addEventListener("mouseenter",this._handleMouseEvent),s.addEventListener("mouseleave",this._handleMouseEvent))}),window.addEventListener("keyup",this._handleKeyUp)}}function y_(){const b=document.querySelector(".main-nav");!b||b.mainNav||(b.mainNav=new Mv(b))}function Jg(){y_()}document.readyState!=="loading"?setTimeout(()=>{Jg()}):document.addEventListener("DOMContentLoaded",()=>{Jg()});function Bt(b,f,s,E){var R=arguments.length,G=R<3?f:E===null?E=Object.getOwnPropertyDescriptor(f,s):E,S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(b,f,s,E);else for(var l=b.length-1;l>=0;l--)(S=b[l])&&(G=(R<3?S(G):R>3?S(f,s,G):S(f,s))||G);return R>3&&G&&Object.defineProperty(f,s,G),G}function jp(b,f,s,E){if(s==="a"&&!E)throw new TypeError("Private accessor was defined without a getter");if(typeof f=="function"?b!==f||!E:!f.has(b))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?E:s==="a"?E.call(b):E?E.value:f.get(b)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ln=b=>f=>typeof f=="function"?((s,E)=>(customElements.define(s,E),E))(b,f):((s,E)=>{const{kind:R,elements:G}=E;return{kind:R,elements:G,finisher(S){customElements.define(s,S)}}})(b,f);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const kv=(b,f)=>f.kind==="method"&&f.descriptor&&!("value"in f.descriptor)?{...f,finisher(s){s.createProperty(f.key,b)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:f.key,initializer(){typeof f.initializer=="function"&&(this[f.key]=f.initializer.call(this))},finisher(s){s.createProperty(f.key,b)}},Pv=(b,f,s)=>{f.constructor.createProperty(s,b)};function vt(b){return(f,s)=>s!==void 0?Pv(b,f,s):kv(b,f)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Yc(b){return vt({...b,state:!0})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Iv=({finisher:b,descriptor:f})=>(s,E)=>{var R;if(E===void 0){const G=(R=s.originalKey)!==null&&R!==void 0?R:s.key,S=f!=null?{kind:"method",placement:"prototype",key:G,descriptor:f(s.key)}:{...s,key:G};return b!=null&&(S.finisher=function(l){b(l,G)}),S}{const G=s.constructor;f!==void 0&&Object.defineProperty(s,E,f(E)),b==null||b(G,E)}};/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Np;const Av=((Np=window.HTMLSlotElement)===null||Np===void 0?void 0:Np.prototype.assignedElements)!=null?(b,f)=>b.assignedElements(f):(b,f)=>b.assignedNodes(f).filter(s=>s.nodeType===Node.ELEMENT_NODE);function zv(b){const{slot:f,selector:s}={};return Iv({descriptor:E=>({get(){var R;const G="slot"+(f?`[name=${f}]`:":not([name])"),S=(R=this.renderRoot)===null||R===void 0?void 0:R.querySelector(G),l=S!=null?Av(S,b):[];return s?l.filter(ae=>ae.matches(s)):l},enumerable:!0,configurable:!0})})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Qg=(b,f,s)=>{const E=new Map;for(let R=f;R<=s;R++)E.set(b[R],R);return E},Dv=_v(class extends yv{constructor(b){if(super(b),b.type!==vv.CHILD)throw Error("repeat() can only be used in text expressions")}ct(b,f,s){let E;s===void 0?s=f:f!==void 0&&(E=f);const R=[],G=[];let S=0;for(const l of b)R[S]=E?E(l,S):S,G[S]=s(l,S),S++;return{values:G,keys:R}}render(b,f,s){return this.ct(b,f,s).values}update(b,[f,s,E]){var R;const G=Sv(b),{values:S,keys:l}=this.ct(f,s,E);if(!Array.isArray(G))return this.ut=l,S;const ae=(R=this.ut)!==null&&R!==void 0?R:this.ut=[],_e=[];let ee,Pe,Ce=0,N=G.length-1,ge=0,Ee=S.length-1;for(;Ce<=N&&ge<=Ee;)if(G[Ce]===null)Ce++;else if(G[N]===null)N--;else if(ae[Ce]===l[ge])_e[ge]=ls(G[Ce],S[ge]),Ce++,ge++;else if(ae[N]===l[Ee])_e[Ee]=ls(G[N],S[Ee]),N--,Ee--;else if(ae[Ce]===l[Ee])_e[Ee]=ls(G[Ce],S[Ee]),qc(b,_e[Ee+1],G[Ce]),Ce++,Ee--;else if(ae[N]===l[ge])_e[ge]=ls(G[N],S[ge]),qc(b,G[Ce],G[N]),N--,ge++;else if(ee===void 0&&(ee=Qg(l,ge,Ee),Pe=Qg(ae,Ce,N)),ee.has(ae[Ce]))if(ee.has(ae[N])){const He=Pe.get(l[ge]),tt=He!==void 0?G[He]:null;if(tt===null){const Ge=qc(b,G[Ce]);ls(Ge,S[ge]),_e[ge]=Ge}else _e[ge]=ls(tt,S[ge]),qc(b,G[Ce],tt),G[He]=null;ge++}else Bp(G[N]),N--;else Bp(G[Ce]),Ce++;for(;ge<=Ee;){const He=qc(b,_e[Ee+1]);ls(He,S[ge]),_e[ge++]=He}for(;Ce<=N;){const He=G[Ce++];He!==null&&Bp(He)}return this.ut=l,Cv(b,_e),gv}});var e0,$p,Vp,Nr,Lv=bn(e0||($p=[`:host {
    position: relative;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
    -webkit-box-align: center;
        -ms-flex-align: center;
            align-items: center;
    -webkit-box-pack: center;
        -ms-flex-pack: center;
            justify-content: center;
}

.breadcrumb__fake-list {
    display: none;
    list-style: none;
    position: relative;
    border-radius: var(--breadcrumb-fake-list-border-radius);
}

.breadcrumb__fake-list::before {
    content: "";
    width: 0;
    height: 0;
    position: absolute;
    top: 0;
    left: var(--spacing-s);
    border-left: var(--breadcrumb-fake-list-triangle-size) solid transparent;
    border-right: var(--breadcrumb-fake-list-triangle-size) solid transparent;
    border-bottom: var(--breadcrumb-fake-list-triangle-size) solid var(--breadcrumb-mobile-menu-bg-color);
    -webkit-transform: translateY(-100%);
            transform: translateY(-100%);
}

.breadcrumb__fake-list .breadcrumb__link {
    color: var(--breadcrumb-link-color);
    font-size: var(--breadcrumb-font-size);
    font-family: var(--breadcrumb-font-family);
    -webkit-text-decoration: var(--breadcrumb-link-text-decoration);
            text-decoration: var(--breadcrumb-link-text-decoration);
}

:host([ismobile][mobilemenuisopen]) .breadcrumb__fake-list {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
    gap: var(--breadcrumb-mobile-menu-list-gap);
    padding: var(--breadcrumb-mobile-menu-padding);
    position: absolute;
    top: var(--breadcrumb-mobile-menu-top);
    left: 0;
    background-color: var(--breadcrumb-mobile-menu-bg-color);
    -webkit-box-shadow: var(--breadcrumb-mobile-menu-shadow);
            box-shadow: var(--breadcrumb-mobile-menu-shadow);
}

.breadcrumb__fake-list .breadcrumb__link:focus {
    color: var(--breadcrumb-link-color-active, var(--color-primary));
}

@media (hover: hover) {
    .breadcrumb__fake-list .breadcrumb__link:hover {
        color: var(--breadcrumb-link-color-active, var(--color-primary));
        text-decoration: underline;
    }
}

`],Vp||(Vp=$p.slice(0)),e0=Object.freeze(Object.defineProperties($p,{raw:{value:Object.freeze(Vp)}}))));let Sr=Nr=class extends mi{static get styles(){return Lv}render(){return pi`
      <slot name="toggle-buttons" @click="${this._handleToggleClick}"></slot>
      <slot name="list"></slot>
      <div class="breadcrumb__fake-list" part="fake-list">
        ${this.listItems?Dv(this.listItems.slice(0,this.listItems.length-1),(b,f)=>f,b=>pi`${b.cloneNode(!0)}`):null}
      </div>
    `}constructor(){super(),this.breakpoint=0,this.isMobile=!1,this.list=null,this.listItems=[],this.toggleButtons=[],this.mobileMenuIsOpen=!1,this._handleToggleClick=this._handleToggleClick.bind(this)}firstUpdated(){this._initListAndItems(),this._calculateBreakpoint(),this.toggleButtons=Array.from(this.querySelectorAll(Nr.SELECTORS.TOGGLE)),this.breakpoint>0&&(this._initMediaQueryListener(),this.isMobile=this._mql.matches)}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new CustomEvent(Nr.EVENT_NAMES.CONNECTED,{bubbles:!0,composed:!0}))}_initListAndItems(){this.list=this.querySelector(Nr.SELECTORS.LIST),this.listItems=Array.from(this.querySelectorAll(Nr.SELECTORS.ITEM))}_initMediaQueryListener(){this._mql||(this._mql=window.matchMedia(`(max-width: ${this.breakpoint}px)`),this._mql.addEventListener("change",function(b,f){let s;return(...E)=>{clearTimeout(s),s=setTimeout(()=>b.apply(this,E),f)}}(this._onMediaQueryChange.bind(this),Nr.DEBOUNCE_DELAY)))}_onMediaQueryChange(b){this.isMobile=b.matches,b.matches||(this.mobileMenuIsOpen=!1),this.dispatchEvent(new CustomEvent(Nr.EVENT_NAMES.MODE_CHANGE,{bubbles:!0,composed:!0,detail:{isMobile:this.isMobile,breakpoint:this.breakpoint}}))}_calculateBreakpoint(){var b;if(!this.listItems.length)return;let f=0;(b=this.listItems)===null||b===void 0||b.forEach(s=>{f+=s.getBoundingClientRect().width,f+=parseInt(window.getComputedStyle(s)["margin-right"]),f+=Nr.IS_MOBILE_BUFFER_PER_ITEM}),this.breakpoint=Math.ceil(f)}_handleToggleClick(){this.mobileMenuIsOpen=!this.mobileMenuIsOpen;const b=this.mobileMenuIsOpen?Nr.EVENT_NAMES.MENU_OPEN:Nr.EVENT_NAMES.MENU_CLOSE;this.dispatchEvent(new CustomEvent(b,{bubbles:!0,composed:!0}))}};Sr.DEBOUNCE_DELAY=150,Sr.IS_MOBILE_BUFFER_PER_ITEM=16,Sr.SELECTORS={LIST:".breadcrumb__list",ITEM:".breadcrumb__item",TOGGLE:".breadcrumb__toggle",FAKE_LIST:".breadcrumb__fake-list"},Sr.EVENT_NAMES={MODE_CHANGE:"toujou-breadcrumb-mode-change",CONNECTED:"toujou-breadcrumb-connected",MENU_OPEN:"toujou-breadcrumb-menu-open",MENU_CLOSE:"toujou-breadcrumb-menu-close"},Bt([vt({type:Number})],Sr.prototype,"breakpoint",void 0),Bt([vt({type:Boolean,reflect:!0})],Sr.prototype,"isMobile",void 0),Bt([vt({type:HTMLOListElement})],Sr.prototype,"list",void 0),Bt([vt({type:Array})],Sr.prototype,"listItems",void 0),Bt([vt({type:Array})],Sr.prototype,"toggleButtons",void 0),Bt([vt({type:Boolean,reflect:!0})],Sr.prototype,"mobileMenuIsOpen",void 0),Sr=Nr=Bt([Ln("toujou-breadcrumb")],Sr);var Qh,ed,td;(function(b){b.PRIMARY="primary",b.SECONDARY="secondary",b.FONT="font"})(Qh||(Qh={})),function(b){b.DEFAULT="default",b.BORDER="border",b.GHOST="ghost"}(ed||(ed={})),function(b){b.TINY="tiny",b.SMALL="small",b.NORMAL="normal",b.LARGE="large"}(td||(td={}));let Rv=class extends HTMLButtonElement{constructor(){super(),this.defaultButtonVariant=Qh.PRIMARY,this.defaultButtonType=ed.DEFAULT,this.defaultButtonSize=td.NORMAL}connectedCallback(){this._checkRequiredAttributes()}_checkRequiredAttributes(){const f=this.getAttribute("button-variant");f?Object.values(Qh).includes(f)||(console.warn(`TOUJOU: Invalid button-variant value, falling back to default: "${this.defaultButtonVariant}"`),this.setAttribute("button-variant",this.defaultButtonVariant)):this.setAttribute("button-variant",this.defaultButtonVariant);const s=this.getAttribute("button-size");s?Object.values(td).includes(s)||(console.warn(`TOUJOU: Invalid button-size value, falling back to default: "${this.defaultButtonSize}"`),this.setAttribute("button-size",this.defaultButtonSize)):this.setAttribute("button-size",this.defaultButtonSize);const E=this.getAttribute("button-type");E?Object.values(ed).includes(E)||(console.warn(`TOUJOU: Invalid button-type value, falling back to default: "${this.defaultButtonType}"`),this.setAttribute("button-type",this.defaultButtonType)):this.setAttribute("button-type",this.defaultButtonType)}};customElements.define("toujou-button",Rv,{extends:"button"});var kf,Wh,v_;let Co=class extends mi{get result(){const f=Math.round(this.duration);return f===0?`${this.lessThanText} 1 ${this.minutesSingularText}`:f===1?`1 ${this.minutesSingularText}`:`${f} ${this.minutesPluralText}`}render(){return pi`
      <slot name="label" class="label"></slot>
      ${this.result}
    `}constructor(){super(),kf.add(this),this.wordCount=0,this.duration=0,this.targetSelector="body",this.minutesSingularText="minute",this.minutesPluralText="minutes",this.lessThanText="under",this.readingSpeed=250,Wh.set(this,()=>{this.targetEl=document.querySelector(`${this.targetSelector}`),this.targetEl&&(this.wordCount+=jp(this,kf,"m",v_).call(this,this.targetEl))}),document.readyState==="complete"||document.readyState==="interactive"?setTimeout(jp(this,Wh,"f")):document.addEventListener("DOMContentLoaded",jp(this,Wh,"f"))}updated(f){f.has("wordCount")&&(this.duration=Math.ceil(this.wordCount/this.readingSpeed))}};Wh=new WeakMap,kf=new WeakSet,v_=function(b){const f=b.textContent,s=f==null?void 0:f.replace(/[\n\r]+|[\s]{2,}/g," "),E=s==null?void 0:s.trim(),R=E==null?void 0:E.split(" ");return(R==null?void 0:R.length)||0},Bt([vt({type:Number})],Co.prototype,"wordCount",void 0),Bt([vt({type:Number})],Co.prototype,"duration",void 0),Bt([vt({type:String,attribute:"target-selector"})],Co.prototype,"targetSelector",void 0),Bt([vt({type:String,attribute:"minutes-singular-text"})],Co.prototype,"minutesSingularText",void 0),Bt([vt({type:String,attribute:"minutes-plural-text"})],Co.prototype,"minutesPluralText",void 0),Bt([vt({type:String,attribute:"less-than-text"})],Co.prototype,"lessThanText",void 0),Bt([vt({type:Number,attribute:"reading-speed"})],Co.prototype,"readingSpeed",void 0),Co=Bt([Ln("toujou-estimated-reading-time")],Co);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */console.warn("The main 'lit-element' module entrypoint is deprecated. Please update your imports to use the 'lit' package: 'lit' and 'lit/decorators.ts' or import from 'lit-element/lit-element.ts'. See https://lit.dev/msg/deprecated-import-path for more information.");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xc=globalThis,id=Xc.trustedTypes,t0=id?id.createPolicy("lit-html",{createHTML:b=>b}):void 0,b_="$lit$",ha=`lit$${Math.random().toFixed(9).slice(2)}$`,x_="?"+ha,Ov=`<${x_}>`,ys=document,ru=()=>ys.createComment(""),ou=b=>b===null||typeof b!="object"&&typeof b!="function",Gf=Array.isArray,Fv=b=>Gf(b)||typeof(b==null?void 0:b[Symbol.iterator])=="function",Up=`[ 	
\f\r]`,Gc=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,i0=/-->/g,n0=/>/g,cs=RegExp(`>|${Up}(?:([^\\s"'>=/]+)(${Up}*=${Up}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),r0=/'/g,o0=/"/g,w_=/^(?:script|style|textarea|title)$/i,au=Symbol.for("lit-noChange"),Dn=Symbol.for("lit-nothing"),a0=new WeakMap,fs=ys.createTreeWalker(ys,129);function S_(b,f){if(!Gf(b)||!b.hasOwnProperty("raw"))throw Error("invalid template strings array");return t0!==void 0?t0.createHTML(f):f}const Bv=(b,f)=>{const s=b.length-1,E=[];let R,G=f===2?"<svg>":f===3?"<math>":"",S=Gc;for(let l=0;l<s;l++){const ae=b[l];let _e,ee,Pe=-1,Ce=0;for(;Ce<ae.length&&(S.lastIndex=Ce,ee=S.exec(ae),ee!==null);)Ce=S.lastIndex,S===Gc?ee[1]==="!--"?S=i0:ee[1]!==void 0?S=n0:ee[2]!==void 0?(w_.test(ee[2])&&(R=RegExp("</"+ee[2],"g")),S=cs):ee[3]!==void 0&&(S=cs):S===cs?ee[0]===">"?(S=R??Gc,Pe=-1):ee[1]===void 0?Pe=-2:(Pe=S.lastIndex-ee[2].length,_e=ee[1],S=ee[3]===void 0?cs:ee[3]==='"'?o0:r0):S===o0||S===r0?S=cs:S===i0||S===n0?S=Gc:(S=cs,R=void 0);const N=S===cs&&b[l+1].startsWith("/>")?" ":"";G+=S===Gc?ae+Ov:Pe>=0?(E.push(_e),ae.slice(0,Pe)+b_+ae.slice(Pe)+ha+N):ae+ha+(Pe===-2?l:N)}return[S_(b,G+(b[s]||"<?>")+(f===2?"</svg>":f===3?"</math>":"")),E]};let Pf=class C_{constructor({strings:f,_$litType$:s},E){let R;this.parts=[];let G=0,S=0;const l=f.length-1,ae=this.parts,[_e,ee]=Bv(f,s);if(this.el=C_.createElement(_e,E),fs.currentNode=this.el.content,s===2||s===3){const Pe=this.el.content.firstChild;Pe.replaceWith(...Pe.childNodes)}for(;(R=fs.nextNode())!==null&&ae.length<l;){if(R.nodeType===1){if(R.hasAttributes())for(const Pe of R.getAttributeNames())if(Pe.endsWith(b_)){const Ce=ee[S++],N=R.getAttribute(Pe).split(ha),ge=/([.?@])?(.*)/.exec(Ce);ae.push({type:1,index:G,name:ge[2],strings:N,ctor:ge[1]==="."?Nv:ge[1]==="?"?$v:ge[1]==="@"?Vv:cd}),R.removeAttribute(Pe)}else Pe.startsWith(ha)&&(ae.push({type:6,index:G}),R.removeAttribute(Pe));if(w_.test(R.tagName)){const Pe=R.textContent.split(ha),Ce=Pe.length-1;if(Ce>0){R.textContent=id?id.emptyScript:"";for(let N=0;N<Ce;N++)R.append(Pe[N],ru()),fs.nextNode(),ae.push({type:2,index:++G});R.append(Pe[Ce],ru())}}}else if(R.nodeType===8)if(R.data===x_)ae.push({type:2,index:G});else{let Pe=-1;for(;(Pe=R.data.indexOf(ha,Pe+1))!==-1;)ae.push({type:7,index:G}),Pe+=ha.length-1}G++}}static createElement(f,s){const E=ys.createElement("template");return E.innerHTML=f,E}};function Tl(b,f,s=b,E){var S,l;if(f===au)return f;let R=E!==void 0?(S=s._$Co)==null?void 0:S[E]:s._$Cl;const G=ou(f)?void 0:f._$litDirective$;return(R==null?void 0:R.constructor)!==G&&((l=R==null?void 0:R._$AO)==null||l.call(R,!1),G===void 0?R=void 0:(R=new G(b),R._$AT(b,s,E)),E!==void 0?(s._$Co??(s._$Co=[]))[E]=R:s._$Cl=R),R!==void 0&&(f=Tl(b,R._$AS(b,f.values),R,E)),f}let jv=class{constructor(f,s){this._$AV=[],this._$AN=void 0,this._$AD=f,this._$AM=s}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(f){const{el:{content:s},parts:E}=this._$AD,R=((f==null?void 0:f.creationScope)??ys).importNode(s,!0);fs.currentNode=R;let G=fs.nextNode(),S=0,l=0,ae=E[0];for(;ae!==void 0;){if(S===ae.index){let _e;ae.type===2?_e=new Zf(G,G.nextSibling,this,f):ae.type===1?_e=new ae.ctor(G,ae.name,ae.strings,this,f):ae.type===6&&(_e=new Uv(G,this,f)),this._$AV.push(_e),ae=E[++l]}S!==(ae==null?void 0:ae.index)&&(G=fs.nextNode(),S++)}return fs.currentNode=ys,R}p(f){let s=0;for(const E of this._$AV)E!==void 0&&(E.strings!==void 0?(E._$AI(f,E,s),s+=E.strings.length-2):E._$AI(f[s])),s++}},Zf=class T_{get _$AU(){var f;return((f=this._$AM)==null?void 0:f._$AU)??this._$Cv}constructor(f,s,E,R){this.type=2,this._$AH=Dn,this._$AN=void 0,this._$AA=f,this._$AB=s,this._$AM=E,this.options=R,this._$Cv=(R==null?void 0:R.isConnected)??!0}get parentNode(){let f=this._$AA.parentNode;const s=this._$AM;return s!==void 0&&(f==null?void 0:f.nodeType)===11&&(f=s.parentNode),f}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(f,s=this){f=Tl(this,f,s),ou(f)?f===Dn||f==null||f===""?(this._$AH!==Dn&&this._$AR(),this._$AH=Dn):f!==this._$AH&&f!==au&&this._(f):f._$litType$!==void 0?this.$(f):f.nodeType!==void 0?this.T(f):Fv(f)?this.k(f):this._(f)}O(f){return this._$AA.parentNode.insertBefore(f,this._$AB)}T(f){this._$AH!==f&&(this._$AR(),this._$AH=this.O(f))}_(f){this._$AH!==Dn&&ou(this._$AH)?this._$AA.nextSibling.data=f:this.T(ys.createTextNode(f)),this._$AH=f}$(f){var G;const{values:s,_$litType$:E}=f,R=typeof E=="number"?this._$AC(f):(E.el===void 0&&(E.el=Pf.createElement(S_(E.h,E.h[0]),this.options)),E);if(((G=this._$AH)==null?void 0:G._$AD)===R)this._$AH.p(s);else{const S=new jv(R,this),l=S.u(this.options);S.p(s),this.T(l),this._$AH=S}}_$AC(f){let s=a0.get(f.strings);return s===void 0&&a0.set(f.strings,s=new Pf(f)),s}k(f){Gf(this._$AH)||(this._$AH=[],this._$AR());const s=this._$AH;let E,R=0;for(const G of f)R===s.length?s.push(E=new T_(this.O(ru()),this.O(ru()),this,this.options)):E=s[R],E._$AI(G),R++;R<s.length&&(this._$AR(E&&E._$AB.nextSibling,R),s.length=R)}_$AR(f=this._$AA.nextSibling,s){var E;for((E=this._$AP)==null?void 0:E.call(this,!1,!0,s);f!==this._$AB;){const R=f.nextSibling;f.remove(),f=R}}setConnected(f){var s;this._$AM===void 0&&(this._$Cv=f,(s=this._$AP)==null||s.call(this,f))}},cd=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(f,s,E,R,G){this.type=1,this._$AH=Dn,this._$AN=void 0,this.element=f,this.name=s,this._$AM=R,this.options=G,E.length>2||E[0]!==""||E[1]!==""?(this._$AH=Array(E.length-1).fill(new String),this.strings=E):this._$AH=Dn}_$AI(f,s=this,E,R){const G=this.strings;let S=!1;if(G===void 0)f=Tl(this,f,s,0),S=!ou(f)||f!==this._$AH&&f!==au,S&&(this._$AH=f);else{const l=f;let ae,_e;for(f=G[0],ae=0;ae<G.length-1;ae++)_e=Tl(this,l[E+ae],s,ae),_e===au&&(_e=this._$AH[ae]),S||(S=!ou(_e)||_e!==this._$AH[ae]),_e===Dn?f=Dn:f!==Dn&&(f+=(_e??"")+G[ae+1]),this._$AH[ae]=_e}S&&!R&&this.j(f)}j(f){f===Dn?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,f??"")}},Nv=class extends cd{constructor(){super(...arguments),this.type=3}j(f){this.element[this.name]=f===Dn?void 0:f}},$v=class extends cd{constructor(){super(...arguments),this.type=4}j(f){this.element.toggleAttribute(this.name,!!f&&f!==Dn)}},Vv=class extends cd{constructor(f,s,E,R,G){super(f,s,E,R,G),this.type=5}_$AI(f,s=this){if((f=Tl(this,f,s,0)??Dn)===au)return;const E=this._$AH,R=f===Dn&&E!==Dn||f.capture!==E.capture||f.once!==E.once||f.passive!==E.passive,G=f!==Dn&&(E===Dn||R);R&&this.element.removeEventListener(this.name,this,E),G&&this.element.addEventListener(this.name,this,f),this._$AH=f}handleEvent(f){var s;typeof this._$AH=="function"?this._$AH.call(((s=this.options)==null?void 0:s.host)??this.element,f):this._$AH.handleEvent(f)}},Uv=class{constructor(f,s,E){this.element=f,this.type=6,this._$AN=void 0,this._$AM=s,this.options=E}get _$AU(){return this._$AM._$AU}_$AI(f){Tl(this,f)}};const qp=Xc.litHtmlPolyfillSupport;qp==null||qp(Pf,Zf),(Xc.litHtmlVersions??(Xc.litHtmlVersions=[])).push("3.3.1");const qv=(b,f,s)=>{const E=f;let R=E._$litPart$;return R===void 0&&(E._$litPart$=R=new Zf(f.insertBefore(ru(),null),null,void 0,{})),R._$AI(b),R};var s0,Gp,Zp,Gv=bn(s0||(Gp=[`.exit-warning__message {
    background-color: var(--toujou-exist-warning-message-bg-color, var(--bg-color));
    overflow: var(--toujou-exist-warning-message-overflow, hidden);
    padding: var(--toujou-exist-warning-message-padding, var(--spacing-normal) var(--spacing-normal) var(--spacing-l));
}
`],Zp||(Zp=Gp.slice(0)),s0=Object.freeze(Object.defineProperties(Gp,{raw:{value:Object.freeze(Zp)}}))));let Hp=class extends mi{static get properties(){return{title:{type:String},targetUrl:{type:String},redirectDelay:{type:Number},secondsRemaining:{type:Number},opened:{type:Boolean},_messageTemplate:{type:Object}}}constructor(){super(),this.targetUrl="http://www.dfau.de",this.redirectDelay=50,this.onIntervalTick=this.onIntervalTick.bind(this),this.onModalOpenedChanged=this.onModalOpenedChanged.bind(this),this._secondsRemainingInterval=null,this._messageTemplate=null,this._modal=null,this._modalOpenedObserver=new MutationObserver(this.onModalOpenedChanged)}render(){return pi`
      <toujou-modal title="${this.title}" is-exit-warning>
        <div class="exit-warning__message">
          <slot></slot>
        </div>
      </toujou-modal>
    `}connectedCallback(){const f=this.querySelector("template");f&&(this._messageTemplate=new Function("html","targetUrl","secondsRemaining","return html`"+f.innerHTML+"`")),super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this._modalOpenedObserver.disconnect()}updated(f){this._messageTemplate&&qv(this._messageTemplate(pi,this.targetUrl,this.secondsRemaining),this)}firstUpdated(f){this._modal=this.shadowRoot.querySelector("toujou-modal"),this._modal&&this._modalOpenedObserver.observe(this._modal,{attributeFilter:["opened"]})}onModalOpenedChanged(){this._modal.opened?(this.secondsRemaining=this.redirectDelay,this._secondsRemainingInterval=window.setInterval(this.onIntervalTick,1e3)):(this._secondsRemainingInterval&&window.clearInterval(this._secondsRemainingInterval),this._secondsRemainingInterval=null)}onIntervalTick(){this.secondsRemaining--,this.secondsRemaining<=0&&(window.location.href=this.targetUrl,this.close())}open(){this._modal&&this._modal.open()}close(){this._modal&&this._modal.close()}};function l0(b){console.log("11111");const f=document.querySelector("exit-warning");return f?window.location.href.match(/toujou-ajax-modal=/)&&window.self!==window.parent?(window.parent.postMessage({action:"toujou-exit-warning",targetUrl:b},window.location.origin),!0):(new URL(b).hostname===window.location.hostname?window.location.href=b:(f.targetUrl=b,f.open()),!0):!1}Hp.styles=[Gv],Hp=Bt([Ln("exit-warning")],Hp),document.addEventListener("click",function(b){if(b.metaKey||b.ctrlKey)return;const f=function(s){const E=s.composedPath();for(let R=0;R<E.indexOf(document.body);R++){const G=E[R];if(G.hasAttribute&&G.hasAttribute("target")&&G!==document.body)return G}}(b);f instanceof HTMLElement&&!(f instanceof HTMLFormElement)&&f.getAttribute("target")==="toujou-exit-warning"&&l0(f.getAttribute("href"))&&(b.preventDefault(),b.stopPropagation())}),window.addEventListener("message",function(b){b.origin===window.location.origin&&b.data.action!==void 0&&b.data.action==="toujou-exit-warning"&&b.data.targetUrl&&l0(b.data.targetUrl)});var c0,Wp,Yp,Kc,Zv=bn(c0||(Wp=[`:host {
    display: var(--toujou-third-party-content-display, flex);
    -webkit-box-align: var(--toujou-third-party-content-align-items, stretch);
        -ms-flex-align: var(--toujou-third-party-content-align-items, stretch);
            align-items: var(--toujou-third-party-content-align-items, stretch);
    -webkit-box-pack: var(--toujou-third-party-content-justify-content, center);
        -ms-flex-pack: var(--toujou-third-party-content-justify-content, center);
            justify-content: var(--toujou-third-party-content-justify-content, center);
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: var(--toujou-third-party-content-flex-direction, column);
            flex-direction: var(--toujou-third-party-content-flex-direction, column);
    position: var(--toujou-third-party-content-position, relative);
    top: var(--toujou-third-party-content-top, 0);
    left: var(--toujou-third-party-content-left, 0);
    height: var(--toujou-third-party-content-height, 100%);
    width: var(--toujou-third-party-content-width, 100%);
}

:host([contenttype='maps']) {
    position: var(--toujou-third-party-content-maps-position, absolute);
}

iframe {
    border: var(--toujou-third-party-content-iframe-border, none);
    position: var(--toujou-third-party-content-iframe-position, absolute);
    height: var(--toujou-third-party-content-iframe-height, 100%);
    width: var(--toujou-third-party-content-iframe-width, 100%);
}

:host([contenttype='html']) iframe {
    position: var(--toujou-third-party-content-html-iframe-position, relative);
}
`],Yp||(Yp=Wp.slice(0)),c0=Object.freeze(Object.defineProperties(Wp,{raw:{value:Object.freeze(Yp)}}))));function u0(b){if(!b)return 0;if(b.classList.contains("inpage-nav__label")){const f=getComputedStyle(b),s=parseFloat(f.paddingLeft)+parseFloat(f.paddingRight);return b.offsetWidth+s}return b.offsetWidth}function Hv(b,f,s,E){return function(G){let S=0;return Object.keys(G).forEach(l=>{const ae=getComputedStyle(G[l].item),_e=parseFloat(ae.paddingLeft)+parseFloat(ae.paddingRight);S+=G[l].item.offsetWidth+_e}),S}(b)+u0(f)+u0(s)*(E?3:1)}(function(b){b.CONNECTED="toujou-inpage-nav-connected",b.DISCONNECTED="toujou-inpage-nav-disconnected",b.STUCK_STATE_CHANGE="toujou-inpage-nav-stuck-state-change"})(Kc||(Kc={}));let us=class extends mi{set _currentSectionID(f){this._navItems&&(f?this._previousCurrentSectionID!==f&&(this._updateLabelVisibility(!!f),this._updateNavItemsState(f)):(this._updateLabelVisibility(!1),this._updateNavItemsState(null)))}render(){return pi`
      <slot></slot>
      <slot name="cta" id="cta"></slot>
    `}constructor(){super(),this.isMobile=!1,this.mobileOpen=!1,this.isStuck=!1,this._targetSections=new Map,this.intersectionObserverNumberOfSteps=50,this.stickyObserverCleanup=null,this.mobileBreakpointOffset=this._getMobileBreakpointOffset(),this._currentSectionID=null,this._isCentered=this.hasAttribute("centered"),this._isAuto=this.hasAttribute("is-auto"),this._targetSections=new Map,this._rootMarginsSize=-200,setTimeout(()=>{this._init()})}connectedCallback(){super.connectedCallback(),this.updateComplete.then(()=>{this._setupStickyStateObserver()}),this.dispatchEvent(new CustomEvent(Kc.CONNECTED,{bubbles:!0,composed:!0}))}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._checkIsMobileState.bind(this)),this._toggle.removeEventListener("click",this._mobileOpenToggle.bind(this)),this.addEventListener("click",this._handleNavClick.bind(this)),this.stickyObserverCleanup&&(this.stickyObserverCleanup(),this.stickyObserverCleanup=null),this.observer&&this.observer.disconnect(),this.dispatchEvent(new CustomEvent(Kc.DISCONNECTED,{bubbles:!0,composed:!0}))}attributeChangedCallback(f,s,E){super.attributeChangedCallback(f,s,E),f!=="ismobile"&&f!=="mobileopen"||this._updateAriaAttributes(f)}_setupStickyStateObserver(){this.hasAttribute("is-sticky")&&(this.stickyObserverCleanup=function(f,s,E={}){if(!(f instanceof HTMLElement))throw new TypeError("observeStickyElement expects a valid HTMLElement as the first argument.");if(typeof s!="function")throw new TypeError("observeStickyElement: callback must be a function");const{threshold:R=1,triggerImmediately:G=!0,rootMargin:S="0px"}=E,l=document.createElement("div");l.className="sticky-sentinel",Object.assign(l.style,{position:"relative",width:"0",height:"0",pointerEvents:"none",opacity:"0"});const ae=f.parentElement;if(!ae)return console.warn("Sticky element has no parent, cannot observe sticky state"),()=>{};ae.insertBefore(l,f);let _e=!1,ee=!0;const Pe=N=>{_e!==N&&(_e=N,s(N))},Ce=new IntersectionObserver(N=>{if(!ee)return;const ge=N[0];if(ge){const Ee=!ge.isIntersecting;Pe(Ee)}},{threshold:R,rootMargin:S});return Ce.observe(l),G&&requestAnimationFrame(()=>{if(!ee)return;const N=l.getBoundingClientRect().top<0;Pe(N)}),()=>{ee=!1,Ce.disconnect(),l.parentElement&&l.parentElement.removeChild(l)}}(this,f=>{this.isStuck=f,this.dispatchEvent(new CustomEvent(Kc.STUCK_STATE_CHANGE,{detail:{isStuck:f},bubbles:!0,composed:!0}))},{threshold:.1,triggerImmediately:!0,rootMargin:"-1px 0px 0px 0px"}))}_init(){this._getChildrenElements(),this._navItems?(this._toggle=this.querySelector(".inpage-nav__toggle"),this._checkIsMobileState(),this._addTargetObservers(),window.addEventListener("resize",this._checkIsMobileState.bind(this)),this._toggle.addEventListener("click",this._mobileOpenToggle.bind(this)),this.addEventListener("click",this._handleNavClick.bind(this))):console.error("Could not initialize the inpage-nav. Error: No nav items!!!")}_getChildrenElements(){this._navItems={},this._navLabel=this.querySelector(".inpage-nav__label")||null,this._cta=this.querySelector('[slot="cta"]'),(this.querySelectorAll(".inpage-nav__item")||null).forEach((f,s)=>{const E=f.querySelector("a").getAttribute("href");this._navItems[s]={item:f,link:E,target:document.querySelector(E)}})}_checkIsMobileState(){this.isMobile=!1,window.requestAnimationFrame(()=>{this._navBreakpoint=Hv(this._navItems,this._navLabel,this._cta,this._isCentered),this.isMobile=this._navBreakpoint>this.offsetWidth-this.mobileBreakpointOffset})}_addTargetObservers(){const f={rootMargin:`${this._rootMarginsSize}px 0px ${this._rootMarginsSize}px 0px`,threshold:this._createThresholdList(this.intersectionObserverNumberOfSteps)};this.observer=new IntersectionObserver(this._handleObserver.bind(this),f),Object.keys(this._navItems).forEach(s=>{const E=this._navItems[s].target;if(!(E instanceof HTMLElement))return;this._targetSections.set(E,!1);const R=E.hasAttribute("id")?E:E.nextElementSibling;this.observer.observe(R)})}_createThresholdList(f){return[...Array(f).keys()].map(s=>s/f)}_handleObserver(f){f.forEach(s=>{this._targetSections.set(s.target,s.isIntersecting)}),this._updateSectionsAttributes(),this._updateActiveItemUI()}_updateSectionsAttributes(){let f=!1;this._targetSections.forEach((s,E)=>{E.toggleAttribute("inpageNavTargetVisible",!f&&s),s&&!f&&(f=s)})}_updateActiveItemUI(){const f=document.querySelector("*[inpageNavTargetVisible]")||null;f?this._currentSectionID=`#${f.id.toString()}`:!f&&this._navLabel?this._currentSectionID=null:f||this._navLabel||(this._currentSectionID=this._navItems[0].link)}_mobileOpenToggle(){this.mobileOpen=!this.mobileOpen}_handleNavClick(f){f.target.classList.contains("inpage-nav__link")&&(this.mobileOpen=!1)}_updateAriaAttributes(f){f==="mobileopen"?this._toggle.setAttribute("aria-expanded",String(this.mobileOpen)):f==="ismobile"&&this._toggle.setAttribute("aria-hidden",String(!this.isMobile))}_updateLabelVisibility(f){this._navLabel&&(f?this._navLabel.removeAttribute("visible"):this._navLabel.setAttribute("visible",""))}_updateNavItemsState(f){const s=this.querySelector(".inpage-nav__item[active]");s&&(s.removeAttribute("active"),s.removeAttribute("aria-current")),Object.keys(this._navItems).forEach(E=>{this._navItems[E].link===f&&(this._navItems[E].item.setAttribute("active",""),this._navItems[E].item.setAttribute("aria-current","true"))}),this._previousCurrentSectionID=f}_getMobileBreakpointOffset(){const f=getComputedStyle(document.documentElement);return parseInt(f.getPropertyValue("--toujou-inpage-nav-breakpoint-offset")||"180",10)}};us.styles=[Zv],Bt([vt({type:Boolean,reflect:!0})],us.prototype,"isMobile",void 0),Bt([vt({type:Boolean,reflect:!0})],us.prototype,"mobileOpen",void 0),Bt([vt({type:Boolean,reflect:!0,attribute:"is-stuck"})],us.prototype,"isStuck",void 0),Bt([vt({type:Map})],us.prototype,"_targetSections",void 0),us=Bt([Ln("toujou-inpage-nav")],us);let h0=class extends mi{static get is(){return"toujou-input-password-toggle"}static get properties(){return{passwordVisible:{type:Boolean,attribute:!1}}}constructor(){super(),this.passwordVisible=!1}render(){return pi`
      <slot name="input"></slot>
      ${this.passwordVisible?pi`<slot name="hide-password-button" @click="${this.handleToggleClick}"></slot>`:pi`<slot name="show-password-button" @click="${this.handleToggleClick}"></slot>`}
    `}handleToggleClick(f){f.preventDefault(),f.stopPropagation();const s=this.inputElement,E=(s==null?void 0:s.getAttribute("type"))==="password"?"text":"password";s==null||s.setAttribute("type",E),this.passwordVisible=E==="text"}get inputElement(){var f,s;const E=(f=this.shadowRoot)===null||f===void 0?void 0:f.querySelector("slot");return E===null?null:(s=E==null?void 0:E.assignedNodes({flatten:!0}).find(R=>R.tagName==="INPUT"))!==null&&s!==void 0?s:null}};customElements.define(h0.is,h0);let d0=class extends mi{static get is(){return"toujou-lazy-render"}get templates(){return this.shadowRoot.querySelector("#slot").assignedNodes({flatten:!0}).filter(f=>f.tagName==="TEMPLATE")}render(){return pi`
      <slot id="slot"></slot>`}connectedCallback(){super.connectedCallback(),this.intersectionObserver=new IntersectionObserver(f=>{f.some(s=>s.isIntersecting)&&(this.renderTemplates(),this.intersectionObserver.disconnect())}),this.intersectionObserver.observe(this)}disconnectedCallback(){this.intersectionObserver&&this.intersectionObserver.disconnect(),super.disconnectedCallback()}renderTemplates(){this.templates.forEach(f=>{const s=document.importNode(f.content,!0);f.parentNode.insertBefore(s,f)})}};customElements.define(d0.is,d0);var E_={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.1/LICENSE.txt
 */(function(b,f){(function(s,E){b.exports=E()})(qf,function(){var s={},E={};function R(S,l,ae){if(E[S]=ae,S==="index"){var _e="var sharedModule = {}; ("+E.shared+")(sharedModule); ("+E.worker+")(sharedModule);",ee={};return E.shared(ee),E.index(s,ee),typeof window<"u"&&s.setWorkerUrl(window.URL.createObjectURL(new Blob([_e],{type:"text/javascript"}))),s}}R("shared",["exports"],function(S){function l(r,t,n,o){return new(n||(n=Promise))(function(u,p){function m(w){try{v(o.next(w))}catch(T){p(T)}}function _(w){try{v(o.throw(w))}catch(T){p(T)}}function v(w){var T;w.done?u(w.value):(T=w.value,T instanceof n?T:new n(function(P){P(T)})).then(m,_)}v((o=o.apply(r,t||[])).next())})}function ae(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var _e,ee;function Pe(){if(ee)return _e;function r(t,n){this.x=t,this.y=n}return ee=1,_e=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,o=t.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),o=Math.sin(t),u=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=u,this},_rotateAround:function(t,n){var o=Math.cos(t),u=Math.sin(t),p=n.y+u*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-u*(this.y-n.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t},_e}typeof SuppressedError=="function"&&SuppressedError;var Ce,N,ge=ae(Pe()),Ee=function(){if(N)return Ce;function r(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return N=1,Ce=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var p=this.sampleCurveX(o)-t;if(Math.abs(p)<n)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=p/m}var _=0,v=1;for(o=t,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-t)<n));u++)t>p?_=o:v=o,o=.5*(v-_)+_;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Ce}(),He=ae(Ee);let tt,Ge;function Ye(){return tt==null&&(tt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),tt}function mt(){if(Ge==null&&(Ge=!1,Ye())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){Ge=!0;break}}}return Ge||!1}var dt=1e-6,pt=typeof Float32Array<"u"?Float32Array:Array;function $e(){var r=new pt(9);return pt!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function bt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Pt(){var r=new pt(3);return pt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Qe(r){return Math.hypot(r[0],r[1],r[2])}function Ke(r,t,n){var o=new pt(3);return o[0]=r,o[1]=t,o[2]=n,o}function et(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function rt(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r}function Dt(r,t,n){var o=t[0],u=t[1],p=t[2],m=n[0],_=n[1],v=n[2];return r[0]=u*v-p*_,r[1]=p*m-o*v,r[2]=o*_-u*m,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var It,ei=Qe;function Zt(r,t,n){var o=t[0],u=t[1],p=t[2],m=t[3];return r[0]=n[0]*o+n[4]*u+n[8]*p+n[12]*m,r[1]=n[1]*o+n[5]*u+n[9]*p+n[13]*m,r[2]=n[2]*o+n[6]*u+n[10]*p+n[14]*m,r[3]=n[3]*o+n[7]*u+n[11]*p+n[15]*m,r}function Rt(){var r=new pt(4);return pt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Tt(r,t,n,o){var u=.5*Math.PI/180;t*=u,n*=u,o*=u;var p=Math.sin(t),m=Math.cos(t),_=Math.sin(n),v=Math.cos(n),w=Math.sin(o),T=Math.cos(o);return r[0]=p*v*T-m*_*w,r[1]=m*_*T+p*v*w,r[2]=m*v*w-p*_*T,r[3]=m*v*T+p*_*w,r}function at(){var r=new pt(2);return pt!=Float32Array&&(r[0]=0,r[1]=0),r}function ft(r,t){var n=new pt(2);return n[0]=r,n[1]=t,n}Pt(),It=new pt(4),pt!=Float32Array&&(It[0]=0,It[1]=0,It[2]=0,It[3]=0),Pt(),Ke(1,0,0),Ke(0,1,0),Rt(),Rt(),$e(),at();const xt=8192;function ii(r,t,n){return t*(xt/(r.tileSize*Math.pow(2,n-r.tileID.overscaledZ)))}function Qt(r,t){return(r%t+t)%t}function gi(r,t,n){return r*(1-n)+t*n}function st(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,n=t*r;return 4*(r<.5?n:3*(r-t)+n-.75)}function Yt(r,t,n,o){const u=new He(r,t,n,o);return p=>u.solve(p)}const _i=Yt(.25,.1,.25,1);function qt(r,t,n){return Math.min(n,Math.max(t,r))}function fi(r,t,n){const o=n-t,u=((r-t)%o+o)%o+t;return u===t?n:u}function Ci(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}let Wi=1;function ut(r,t,n){const o={};for(const u in r)o[u]=t.call(this,r[u],u,r);return o}function Xt(r,t,n){const o={};for(const u in r)t.call(this,r[u],u,r)&&(o[u]=r[u]);return o}function we(r){return Array.isArray(r)?r.map(we):typeof r=="object"&&r?ut(r,we):r}const ht={};function Ot(r){ht[r]||(typeof console<"u"&&console.warn(r),ht[r]=!0)}function Et(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function $t(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let jt=null;function Pi(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Yi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Di(r,t,n,o,u){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(r,{timestamp:0});try{const m=p==null?void 0:p.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const _=m.startsWith("BGR"),v=new Uint8ClampedArray(o*u*4);if(yield p.copyTo(v,function(w,T,P,D,F){const B=4*Math.max(-T,0),U=(Math.max(0,P)-P)*D*4+B,W=4*D,te=Math.max(0,T),ye=Math.max(0,P);return{rect:{x:te,y:ye,width:Math.min(w.width,T+D)-te,height:Math.min(w.height,P+F)-ye},layout:[{offset:U,stride:W}]}}(r,t,n,o,u)),_)for(let w=0;w<v.length;w+=4){const T=v[w];v[w]=v[w+2],v[w+2]=T}return v}finally{p.close()}})}let Ii,ni;function tn(r,t,n,o){return r.addEventListener(t,n,o),{unsubscribe:()=>{r.removeEventListener(t,n,o)}}}function Ti(r){return r*Math.PI/180}function Ui(r){return r/Math.PI*180}const nn={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},hn={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},At="AbortError";function ue(){return new Error(At)}const j={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function q(r){return j.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Z="global-dispatcher";class ne extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const pe=()=>$t(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,be=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=q(r.url);if(o)return o(r,t);if($t(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:Z},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(pe())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return l(this,void 0,void 0,function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:pe(),signal:u.signal});let m,_;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{m=yield fetch(p)}catch(w){throw new ne(0,w.message,o.url,new Blob)}if(!m.ok){const w=yield m.blob();throw new ne(m.status,m.statusText,o.url,w)}_=o.type==="arrayBuffer"||o.type==="image"?m.arrayBuffer():o.type==="json"?m.json():m.text();const v=yield _;if(u.signal.aborted)throw ue();return{data:v,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(r,t);if($t(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:Z},t)}var n;return function(o,u){return new Promise((p,m)=>{var _;const v=new XMLHttpRequest;v.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(v.responseType="arraybuffer");for(const w in o.headers)v.setRequestHeader(w,o.headers[w]);o.type==="json"&&(v.responseType="text",!((_=o.headers)===null||_===void 0)&&_.Accept||v.setRequestHeader("Accept","application/json")),v.withCredentials=o.credentials==="include",v.onerror=()=>{m(new Error(v.statusText))},v.onload=()=>{if(!u.signal.aborted)if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let w=v.response;if(o.type==="json")try{w=JSON.parse(v.response)}catch(T){return void m(T)}p({data:w,cacheControl:v.getResponseHeader("Cache-Control"),expires:v.getResponseHeader("Expires")})}else{const w=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});m(new ne(v.status,v.statusText,o.url,w))}},u.signal.addEventListener("abort",()=>{v.abort(),m(ue())}),v.send(o.body)})}(r,t)};function Me(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ve(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Ae(r,t,n){if(n&&n[r]){const o=n[r].indexOf(t);o!==-1&&n[r].splice(o,1)}}class Te{constructor(t,n={}){Ci(this,n),this.type=t}}class de extends Te{constructor(t,n={}){super("error",Ci({error:t},n))}}class z{on(t,n){return this._listeners=this._listeners||{},ve(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Ae(t,n,this._listeners),Ae(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ve(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new Te(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of u)_.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of p)Ae(o,_,this._oneTimeListeners),_.call(this,t);const m=this._eventedParent;m&&(Ci(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof de&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var k={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const V=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Q(r,t){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return V.forEach(o=>{o in t&&(n[o]=t[o])}),n}function fe(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!fe(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!fe(r[n],t[n]))return!1;return!0}return r===t}function Se(r,t){r.push(t)}function Be(r,t,n){Se(n,{command:"addSource",args:[r,t[r]]})}function Ve(r,t,n){Se(t,{command:"removeSource",args:[r]}),n[r]=!0}function nt(r,t,n,o){Ve(r,n,o),Be(r,t,n)}function Ze(r,t,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!fe(r[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!fe(r[n][o],t[n][o]))return!1;return!0}function qe(r,t,n,o,u,p){r=r||{},t=t||{};for(const m in r)Object.prototype.hasOwnProperty.call(r,m)&&(fe(r[m],t[m])||n.push({command:p,args:[o,m,t[m],u]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(r,m)&&(fe(r[m],t[m])||n.push({command:p,args:[o,m,t[m],u]}))}function yt(r){return r.id}function Ht(r,t){return r[t.id]=t,r}class K{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function De(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}class je extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Mt{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new Mt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Gt={kind:"null"},Ue={kind:"number"},zt={kind:"string"},Lt={kind:"boolean"},ti={kind:"color"},bi={kind:"projectionDefinition"},ui={kind:"object"},gt={kind:"value"},Ri={kind:"collator"},sn={kind:"formatted"},Ei={kind:"padding"},lo={kind:"colorArray"},va={kind:"numberArray"},Pr={kind:"resolvedImage"},ba={kind:"variableAnchorOffsetCollection"};function Wn(r,t){return{kind:"array",itemType:r,N:t}}function Oi(r){if(r.kind==="array"){const t=Oi(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const Pu=[Gt,Ue,zt,Lt,ti,bi,sn,ui,Wn(gt),Ei,va,lo,Pr,ba];function xa(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!xa(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of Pu)if(!xa(n,t))return null}}return`Expected ${Oi(r)} but found ${Oi(t)} instead.`}function ws(r,t){return t.some(n=>n.kind===r.kind)}function co(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function Gr(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const Iu=.96422,Au=.82521,zu=4/29,Ao=6/29,Du=3*Ao*Ao,Lu=Ao*Ao*Ao,wa=Math.PI/180,wd=180/Math.PI;function Ru(r){return(r%=360)<0&&(r+=360),r}function zo([r,t,n,o]){let u,p;const m=Ll((.2225045*(r=Dl(r))+.7168786*(t=Dl(t))+.0606169*(n=Dl(n)))/1);r===t&&t===n?u=p=m:(u=Ll((.4360747*r+.3850649*t+.1430804*n)/Iu),p=Ll((.0139322*r+.0971045*t+.7141733*n)/Au));const _=116*m-16;return[_<0?0:_,500*(u-m),200*(m-p),o]}function Dl(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ll(r){return r>Lu?Math.pow(r,1/3):r/Du+zu}function Ou([r,t,n,o]){let u=(r+16)/116,p=isNaN(t)?u:u+t/500,m=isNaN(n)?u:u-n/200;return u=1*Cs(u),p=Iu*Cs(p),m=Au*Cs(m),[Ss(3.1338561*p-1.6168667*u-.4906146*m),Ss(-.9787684*p+1.9161415*u+.033454*m),Ss(.0719453*p-.2289914*u+1.4052427*m),o]}function Ss(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Cs(r){return r>Ao?r*r*r:Du*(r-zu)}const _r=Object.hasOwn||function(r,t){return Object.prototype.hasOwnProperty.call(r,t)};function ri(r,t){return _r(r,t)?r[t]:void 0}function Ir(r){return parseInt(r.padEnd(2,r),16)/255}function Ar(r,t){return uo(t?r/100:r,0,1)}function uo(r,t,n){return Math.min(Math.max(t,r),n)}function Rl(r){return!r.some(Number.isNaN)}const Ol={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function er(r,t,n){return r+n*(t-r)}function zr(r,t,n){return r.map((o,u)=>er(o,t[u],n))}class oi{constructor(t,n,o,u=1,p=!0){this.r=t,this.g=n,this.b=o,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,n,o,u]))}static parse(t){if(t instanceof oi)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=ri(Ol,o);if(u){const[m,_,v]=u;return[m/255,_/255,v/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let _=1;return[Ir(o.slice(_,_+=m)),Ir(o.slice(_,_+=m)),Ir(o.slice(_,_+=m)),Ir(o.slice(_,_+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[_,v,w,T,P,D,F,B,U,W,te,ye]=m,le=[T||" ",F||" ",W].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const O=[w,D,U].join(""),H=O==="%%%"?100:O===""?255:0;if(H){const ce=[uo(+v/H,0,1),uo(+P/H,0,1),uo(+B/H,0,1),te?Ar(+te,ye):1];if(Rl(ce))return ce}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,_,v,w,T,P,D,F,B]=p,U=[v||" ",T||" ",D].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const W=[+_,uo(+w,0,100),uo(+P,0,100),F?Ar(+F,B):1];if(Rl(W))return function([te,ye,le,O]){function H(ce){const ze=(ce+te/30)%12,We=ye*Math.min(le,1-le);return le-We*Math.max(-1,Math.min(ze-3,9-ze,1))}return te=Ru(te),ye/=100,le/=100,[H(0),H(8),H(4),O]}(W)}}}(t);return n?new oi(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[t/p,n/p,o/p,u])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,u,p]=zo(t),m=Math.sqrt(o*o+u*u);return[Math.round(1e4*m)?Ru(Math.atan2(u,o)*wd):NaN,m,n,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zo(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,u]=this.rgb;return`rgba(${[t,n,o].map(p=>Math.round(255*p)).join(",")},${u})`}static interpolate(t,n,o,u="rgb"){switch(u){case"rgb":{const[p,m,_,v]=zr(t.rgb,n.rgb,o);return new oi(p,m,_,v,!1)}case"hcl":{const[p,m,_,v]=t.hcl,[w,T,P,D]=n.hcl;let F,B;if(isNaN(p)||isNaN(w))isNaN(p)?isNaN(w)?F=NaN:(F=w,_!==1&&_!==0||(B=T)):(F=p,P!==1&&P!==0||(B=m));else{let le=w-p;w>p&&le>180?le-=360:w<p&&p-w>180&&(le+=360),F=p+o*le}const[U,W,te,ye]=function([le,O,H,ce]){return le=isNaN(le)?0:le*wa,Ou([H,Math.cos(le)*O,Math.sin(le)*O,ce])}([F,B??er(m,T,o),er(_,P,o),er(v,D,o)]);return new oi(U,W,te,ye,!1)}case"lab":{const[p,m,_,v]=Ou(zr(t.lab,n.lab,o));return new oi(p,m,_,v,!1)}}}}oi.black=new oi(0,0,0,1),oi.white=new oi(1,1,1,1),oi.transparent=new oi(0,0,0,0),oi.red=new oi(1,0,0,1);class Sa{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ts=["bottom","center","top"];class Fl{constructor(t,n,o,u,p,m){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=p,this.verticalAlign=m}}class Pn{constructor(t){this.sections=t}static fromString(t){return new Pn([new Fl(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Pn?t:Pn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof rn)return t;if(typeof t=="number")return new rn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new rn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new rn(zr(t.values,n.values,o))}}class In{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof In)return t;if(typeof t=="number")return new In([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new In(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new In(zr(t.values,n.values,o))}}class dn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof dn)return t;if(typeof t=="string"){const o=oi.parse(t);return o?new dn([o]):void 0}if(!Array.isArray(t))return;const n=[];for(const o of t){if(typeof o!="string")return;const u=oi.parse(o);if(!u)return;n.push(u)}return new dn(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o,u="rgb"){const p=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let m=0;m<t.values.length;m++)p.push(oi.interpolate(t.values[m],n.values[m],o,u));return new dn(p)}}class Fi extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Es=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class hi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof hi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],u=t[n+1];if(typeof o!="string"||!Es.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new hi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){const u=t.values,p=n.values;if(u.length!==p.length)throw new Fi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const m=[];for(let _=0;_<u.length;_+=2){if(u[_]!==p[_])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${u[_]}, to[${_}]: ${p[_]}`);m.push(u[_]);const[v,w]=u[_+1],[T,P]=p[_+1];m.push([er(v,T,o),er(w,P,o)])}return new hi(m)}}class $n{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new $n({name:t,available:!1}):null}}class Wt{constructor(t,n,o){this.from=t,this.to=n,this.transition=o}static interpolate(t,n,o){return new Wt(t,n,o)}static parse(t){return t instanceof Wt?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Wt(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Wt(t.from,t.to,t.transition):typeof t=="string"?new Wt(t,t,1):void 0}}function Kt(r,t,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,n,o]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ho(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Wt||r instanceof oi||r instanceof Sa||r instanceof Pn||r instanceof rn||r instanceof In||r instanceof dn||r instanceof hi||r instanceof $n)return!0;if(Array.isArray(r)){for(const t of r)if(!ho(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!ho(r[t]))return!1;return!0}return!1}function Ut(r){if(r===null)return Gt;if(typeof r=="string")return zt;if(typeof r=="boolean")return Lt;if(typeof r=="number")return Ue;if(r instanceof oi)return ti;if(r instanceof Wt)return bi;if(r instanceof Sa)return Ri;if(r instanceof Pn)return sn;if(r instanceof rn)return Ei;if(r instanceof In)return va;if(r instanceof dn)return lo;if(r instanceof hi)return ba;if(r instanceof $n)return Pr;if(Array.isArray(r)){const t=r.length;let n;for(const o of r){const u=Ut(o);if(n){if(n===u)continue;n=gt;break}n=u}return Wn(n||gt,t)}return ui}function po(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof oi||r instanceof Wt||r instanceof Pn||r instanceof rn||r instanceof In||r instanceof dn||r instanceof hi||r instanceof $n?r.toString():JSON.stringify(r)}class Rn{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ho(t[1]))return n.error("invalid value");const o=t[1];let u=Ut(o);const p=n.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new Rn(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Do={string:zt,number:Ue,boolean:Lt,object:ui};class Vn{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const p=t[0];if(p==="array"){let _,v;if(t.length>2){const w=t[1];if(typeof w!="string"||!(w in Do)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=Do[w],u++}else _=gt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);v=t[2],u++}o=Wn(_,v)}else{if(!Do[p])throw new Error(`Types doesn't contain name = ${p}`);o=Do[p]}const m=[];for(;u<t.length;u++){const _=n.parse(t[u],u,gt);if(!_)return null;m.push(_)}return new Vn(o,m)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!xa(this.type,Ut(o)))return o;if(n===this.args.length-1)throw new Fi(`Expected value to be of type ${Oi(this.type)}, but found ${Oi(Ut(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Bl={"to-boolean":Lt,"to-color":ti,"to-number":Ue,"to-string":zt};class yr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!Bl[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=Bl[o],p=[];for(let m=1;m<t.length;m++){const _=n.parse(t[m],m,gt);if(!_)return null;p.push(_)}return new yr(u,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof oi)return n;if(typeof n=="string"){const p=t.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Kt(n[0],n[1],n[2],n[3]),!o))return new oi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Fi(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const u=rn.parse(n);if(u)return u}throw new Fi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=In.parse(n);if(u)return u}throw new Fi(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=dn.parse(n);if(u)return u}throw new Fi(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const u=hi.parse(n);if(u)return u}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Fi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Pn.fromString(po(this.args[0].evaluate(t)));case"resolvedImage":return $n.fromString(po(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return po(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Fu=["Unknown","Point","LineString","Polygon"];class Bu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=oi.parse(t),this._parseColorCache.set(t,n)),n}}class Ca{constructor(t,n,o=[],u,p=new Mt,m=[]){this.registry=t,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=p,this.errors=m,this.expectedType=u,this._isConstant=n}parse(t,n,o,u,p={}){return n?this.concat(n,o,u)._parse(t,p):this._parse(t,p)}_parse(t,n){function o(u,p,m){return m==="assert"?new Vn(p,[u]):m==="coerce"?new yr(p,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let m=p.parse(t,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,v=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value"){if(_.kind==="projectionDefinition"&&["string","array"].includes(v.kind)||["color","formatted","resolvedImage"].includes(_.kind)&&["value","string"].includes(v.kind)||["padding","numberArray"].includes(_.kind)&&["value","number","array"].includes(v.kind)||_.kind==="colorArray"&&["value","string","array"].includes(v.kind)||_.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(v.kind))m=o(m,_,n.typeAnnotation||"coerce");else if(this.checkSubtype(_,v))return null}else m=o(m,_,n.typeAnnotation||"assert")}if(!(m instanceof Rn)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const _=new Bu;try{m=new Rn(m.type,m.evaluate(_))}catch(v){return this.error(v.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,p=o?this.scope.concat(o):this.scope;return new Ca(this.registry,this._isConstant,u,n||null,p,this.errors)}error(t,...n){const o=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new je(o,t))}checkSubtype(t,n){const o=xa(t,n);return o&&this.error(o),o}}class Ta{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let p=1;p<t.length-1;p+=2){const m=t[p];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const _=n.parse(t[p+1],p+1);if(!_)return null;o.push([m,_])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new Ta(o,u):null}outputDefined(){return this.result.outputDefined()}}class sr{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new sr(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class pn{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Ue),u=n.parse(t[2],2,Wn(n.expectedType||gt));return o&&u?new pn(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new Fi(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Fi(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Fi(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Lo{constructor(t,n){this.type=Lt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,gt),u=n.parse(t[2],2,gt);return o&&u?ws(o.type,[Lt,zt,Ue,Gt,gt])?new Lo(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!co(n,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(Ut(n))} instead.`);if(!co(o,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${Oi(Ut(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ea{constructor(t,n,o){this.type=Ue,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,gt),u=n.parse(t[2],2,gt);if(!o||!u)return null;if(!ws(o.type,[Lt,zt,Ue,Gt,gt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,Ue);return p?new Ea(o,u,p):null}return new Ea(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!co(n,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(Ut(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),co(o,["string"])){const p=o.indexOf(n,u);return p===-1?-1:[...o.slice(0,p)].length}if(co(o,["array"]))return o.indexOf(n,u);throw new Fi(`Expected second argument to be of type array or string, but found ${Oi(Ut(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Ro{constructor(t,n,o,u,p,m){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=p,this.otherwise=m}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const p={},m=[];for(let w=2;w<t.length-1;w+=2){let T=t[w];const P=t[w+1];Array.isArray(T)||(T=[T]);const D=n.concat(w);if(T.length===0)return D.error("Expected at least one branch label.");for(const B of T){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,Ut(B)))return null}else o=Ut(B);if(p[String(B)]!==void 0)return D.error("Branch labels must be unique.");p[String(B)]=m.length}const F=n.parse(P,w,u);if(!F)return null;u=u||F.type,m.push(F)}const _=n.parse(t[1],1,gt);if(!_)return null;const v=n.parse(t[t.length-1],t.length-1,u);return v?_.type.kind!=="value"&&n.concat(1).checkSubtype(o,_.type)?null:new Ro(o,u,_,p,m,v):null}evaluate(t){const n=this.input.evaluate(t);return(Ut(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class on{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const _=n.parse(t[m],m,Lt);if(!_)return null;const v=n.parse(t[m+1],m+1,o);if(!v)return null;u.push([_,v]),o=o||v.type}const p=n.parse(t[t.length-1],t.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new on(o,u,p)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Ma{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,gt),u=n.parse(t[2],2,Ue);if(!o||!u)return null;if(!ws(o.type,[Wn(gt),zt,gt]))return n.error(`Expected first argument to be of type array or string, but found ${Oi(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,Ue);return p?new Ma(o.type,o,u,p):null}return new Ma(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),co(n,["string"]))return[...n].slice(o,u).join("");if(co(n,["array"]))return n.slice(o,u);throw new Fi(`Expected first argument to be of type array or string, but found ${Oi(Ut(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Oo(r,t){const n=r.length-1;let o,u,p=0,m=n,_=0;for(;p<=m;)if(_=Math.floor((p+m)/2),o=r[_],u=r[_+1],o<=t){if(_===n||t<u)return _;p=_+1}else{if(!(o>t))throw new Fi("Input is not a number.");m=_-1}return 0}class Fo{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,p]of o)this.labels.push(u),this.outputs.push(p)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Ue);if(!o)return null;const u=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let m=1;m<t.length;m+=2){const _=m===1?-1/0:t[m],v=t[m+1],w=m,T=m+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(u.length&&u[u.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const P=n.parse(v,T,p);if(!P)return null;p=p||P.type,u.push([_,P])}return new Fo(p,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const p=n.length;return u>=n[p-1]?o[p-1].evaluate(t):o[Oo(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Sd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Zr,ka,jl=function(){if(ka)return Zr;function r(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return ka=1,Zr=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var p=this.sampleCurveX(o)-t;if(Math.abs(p)<n)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=p/m}var _=0,v=1;for(o=t,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-t)<n));u++)t>p?_=o:v=o,o=.5*(v-_)+_;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Zr}(),Cd=Sd(jl);class On{constructor(t,n,o,u,p){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,_]of p)this.labels.push(m),this.outputs.push(_)}static interpolationFactor(t,n,o,u){let p=0;if(t.name==="exponential")p=Bo(n,t.base,o,u);else if(t.name==="linear")p=Bo(n,1,o,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;p=new Cd(m[0],m[1],m[2],m[3]).solve(Bo(n,1,o,u))}return p}static parse(t,n){let[o,u,p,...m]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const w=u[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:w}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const w=u.slice(1);if(w.length!==4||w.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:w}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,Ue),!p)return null;const _=[];let v=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==lo?n.expectedType&&n.expectedType.kind!=="value"&&(v=n.expectedType):v=ti;for(let w=0;w<m.length;w+=2){const T=m[w],P=m[w+1],D=w+3,F=w+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=n.parse(P,F,v);if(!B)return null;v=v||B.type,_.push([T,B])}return Gr(v,Ue)||Gr(v,bi)||Gr(v,ti)||Gr(v,Ei)||Gr(v,va)||Gr(v,lo)||Gr(v,ba)||Gr(v,Wn(Ue))?new On(v,o,u,p,_):n.error(`Type ${Oi(v)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const p=n.length;if(u>=n[p-1])return o[p-1].evaluate(t);const m=Oo(n,u),_=On.interpolationFactor(this.interpolation,u,n[m],n[m+1]),v=o[m].evaluate(t),w=o[m+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return er(v,w,_);case"color":return oi.interpolate(v,w,_);case"padding":return rn.interpolate(v,w,_);case"colorArray":return dn.interpolate(v,w,_);case"numberArray":return In.interpolate(v,w,_);case"variableAnchorOffsetCollection":return hi.interpolate(v,w,_);case"array":return zr(v,w,_);case"projectionDefinition":return Wt.interpolate(v,w,_)}case"interpolate-hcl":switch(this.type.kind){case"color":return oi.interpolate(v,w,_,"hcl");case"colorArray":return dn.interpolate(v,w,_,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return oi.interpolate(v,w,_,"lab");case"colorArray":return dn.interpolate(v,w,_,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Bo(r,t,n,o){const u=o-n,p=r-n;return u===0?0:t===1?p/u:(Math.pow(t,p)-1)/(Math.pow(t,u)-1)}const Yn={color:oi.interpolate,number:er,padding:rn.interpolate,numberArray:In.interpolate,colorArray:dn.interpolate,variableAnchorOffsetCollection:hi.interpolate,array:zr};class Un{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const p=[];for(const _ of t.slice(1)){const v=n.parse(_,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!v)return null;o=o||v.type,p.push(v)}if(!o)throw new Error("No output type");const m=u&&p.some(_=>xa(u,_.type));return new Un(m?gt:o,p)}evaluate(t){let n,o=null,u=0;for(const p of this.args)if(u++,o=p.evaluate(t),o&&o instanceof $n&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Nl(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Pa(r,t,n,o){return o.compare(t,n)===0}function jo(r,t,n){const o=r!=="=="&&r!=="!=";return class M_{constructor(p,m,_){this.type=Lt,this.lhs=p,this.rhs=m,this.collator=_,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const _=p[0];let v=m.parse(p[1],1,gt);if(!v)return null;if(!Nl(_,v.type))return m.concat(1).error(`"${_}" comparisons are not supported for type '${Oi(v.type)}'.`);let w=m.parse(p[2],2,gt);if(!w)return null;if(!Nl(_,w.type))return m.concat(2).error(`"${_}" comparisons are not supported for type '${Oi(w.type)}'.`);if(v.type.kind!==w.type.kind&&v.type.kind!=="value"&&w.type.kind!=="value")return m.error(`Cannot compare types '${Oi(v.type)}' and '${Oi(w.type)}'.`);o&&(v.type.kind==="value"&&w.type.kind!=="value"?v=new Vn(w.type,[v]):v.type.kind!=="value"&&w.type.kind==="value"&&(w=new Vn(v.type,[w])));let T=null;if(p.length===4){if(v.type.kind!=="string"&&w.type.kind!=="string"&&v.type.kind!=="value"&&w.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(T=m.parse(p[3],3,Ri),!T)return null}return new M_(v,w,T)}evaluate(p){const m=this.lhs.evaluate(p),_=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const v=Ut(m),w=Ut(_);if(v.kind!==w.kind||v.kind!=="string"&&v.kind!=="number")throw new Fi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${v.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const v=Ut(m),w=Ut(_);if(v.kind!=="string"||w.kind!=="string")return t(p,m,_)}return this.collator?n(p,m,_,this.collator.evaluate(p)):t(p,m,_)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const $l=jo("==",function(r,t,n){return t===n},Pa),Td=jo("!=",function(r,t,n){return t!==n},function(r,t,n,o){return!Pa(0,t,n,o)}),Ed=jo("<",function(r,t,n){return t<n},function(r,t,n,o){return o.compare(t,n)<0}),Md=jo(">",function(r,t,n){return t>n},function(r,t,n,o){return o.compare(t,n)>0}),kd=jo("<=",function(r,t,n){return t<=n},function(r,t,n,o){return o.compare(t,n)<=0}),Ms=jo(">=",function(r,t,n){return t>=n},function(r,t,n,o){return o.compare(t,n)>=0});class ks{constructor(t,n,o){this.type=Ri,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Lt);if(!u)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Lt);if(!p)return null;let m=null;return o.locale&&(m=n.parse(o.locale,1,zt),!m)?null:new ks(u,p,m)}evaluate(t){return new Sa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ps{constructor(t,n,o,u,p){this.type=zt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Ue);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=n.parse(u.locale,1,zt),!p))return null;let m=null;if(u.currency&&(m=n.parse(u.currency,1,zt),!m))return null;let _=null;if(u["min-fraction-digits"]&&(_=n.parse(u["min-fraction-digits"],1,Ue),!_))return null;let v=null;return u["max-fraction-digits"]&&(v=n.parse(u["max-fraction-digits"],1,Ue),!v)?null:new Ps(o,p,m,_,v)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ia{constructor(t){this.type=sn,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let p=!1;for(let m=1;m<=t.length-1;++m){const _=t[m];if(p&&typeof _=="object"&&!Array.isArray(_)){p=!1;let v=null;if(_["font-scale"]&&(v=n.parse(_["font-scale"],1,Ue),!v))return null;let w=null;if(_["text-font"]&&(w=n.parse(_["text-font"],1,Wn(zt)),!w))return null;let T=null;if(_["text-color"]&&(T=n.parse(_["text-color"],1,ti),!T))return null;let P=null;if(_["vertical-align"]){if(typeof _["vertical-align"]=="string"&&!Ts.includes(_["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${_["vertical-align"]}' instead.`);if(P=n.parse(_["vertical-align"],1,zt),!P)return null}const D=u[u.length-1];D.scale=v,D.font=w,D.textColor=T,D.verticalAlign=P}else{const v=n.parse(t[m],1,gt);if(!v)return null;const w=v.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:v,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ia(u)}evaluate(t){return new Pn(this.sections.map(n=>{const o=n.content.evaluate(t);return Ut(o)===Pr?new Fl("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new Fl(po(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Vl{constructor(t){this.type=Pr,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,zt);return o?new Vl(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=$n.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Is{constructor(t){this.type=Ue,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Oi(o.type)} instead.`):new Is(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Fi(`Expected value to be of type string or array, but found ${Oi(Ut(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const vr=8192;function Pd(r,t){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*vr),Math.round(o*u*vr)]}function Ul(r,t){const n=Math.pow(2,t.z);return[(u=(r[0]/vr+t.x)/n,360*u-180),(o=(r[1]/vr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Aa(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function za(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function ju(r,t,n){const o=r[0]-t[0],u=r[1]-t[1],p=r[0]-n[0],m=r[1]-n[1];return o*m-p*u==0&&o*p<=0&&u*m<=0}function Da(r,t,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(p=[t[0]-r[0],t[1]-r[1]])[1]-u[1]*p[0]!=0&&!(!As(r,t,n,o)||!As(n,o,r,t));var u,p}function Nu(r,t,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(Da(r,t,o[u],o[u+1]))return!0;return!1}function No(r,t,n=!1){let o=!1;for(const _ of t)for(let v=0;v<_.length-1;v++){if(ju(r,_[v],_[v+1]))return n;(p=_[v])[1]>(u=r)[1]!=(m=_[v+1])[1]>u[1]&&u[0]<(m[0]-p[0])*(u[1]-p[1])/(m[1]-p[1])+p[0]&&(o=!o)}var u,p,m;return o}function Id(r,t){for(const n of t)if(No(r,n))return!0;return!1}function $u(r,t){for(const n of r)if(!No(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Nu(r[n],r[n+1],t))return!1;return!0}function Ad(r,t){for(const n of t)if($u(r,n))return!0;return!1}function As(r,t,n,o){const u=o[0]-n[0],p=o[1]-n[1],m=(r[0]-n[0])*p-u*(r[1]-n[1]),_=(t[0]-n[0])*p-u*(t[1]-n[1]);return m>0&&_<0||m<0&&_>0}function ql(r,t,n){const o=[];for(let u=0;u<r.length;u++){const p=[];for(let m=0;m<r[u].length;m++){const _=Pd(r[u][m],n);Aa(t,_),p.push(_)}o.push(p)}return o}function Vu(r,t,n){const o=[];for(let u=0;u<r.length;u++){const p=ql(r[u],t,n);o.push(p)}return o}function Uu(r,t,n,o){if(r[0]<n[0]||r[0]>n[2]){const u=.5*o;let p=r[0]-n[0]>u?-o:n[0]-r[0]>u?o:0;p===0&&(p=r[0]-n[2]>u?-o:n[2]-r[0]>u?o:0),r[0]+=p}Aa(t,r)}function Gl(r,t,n,o){const u=Math.pow(2,o.z)*vr,p=[o.x*vr,o.y*vr],m=[];for(const _ of r)for(const v of _){const w=[v.x+p[0],v.y+p[1]];Uu(w,t,n,u),m.push(w)}return m}function Zl(r,t,n,o){const u=Math.pow(2,o.z)*vr,p=[o.x*vr,o.y*vr],m=[];for(const v of r){const w=[];for(const T of v){const P=[T.x+p[0],T.y+p[1]];Aa(t,P),w.push(P)}m.push(w)}if(t[2]-t[0]<=u/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const v of m)for(const w of v)Uu(w,t,n,u)}var _;return m}class fo{constructor(t,n){this.type=Lt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ho(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const p of o.features){const{type:m,coordinates:_}=p.geometry;m==="Polygon"&&u.push(_),m==="MultiPolygon"&&u.push(..._)}if(u.length)return new fo(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new fo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new fo(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const _=ql(o.coordinates,p,m),v=Gl(n.geometry(),u,p,m);if(!za(u,p))return!1;for(const w of v)if(!No(w,_))return!1}if(o.type==="MultiPolygon"){const _=Vu(o.coordinates,p,m),v=Gl(n.geometry(),u,p,m);if(!za(u,p))return!1;for(const w of v)if(!Id(w,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const _=ql(o.coordinates,p,m),v=Zl(n.geometry(),u,p,m);if(!za(u,p))return!1;for(const w of v)if(!$u(w,_))return!1}if(o.type==="MultiPolygon"){const _=Vu(o.coordinates,p,m),v=Zl(n.geometry(),u,p,m);if(!za(u,p))return!1;for(const w of v)if(!Ad(w,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let qu=class{constructor(r=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,o=t[r];for(;r>0;){const u=r-1>>1,p=t[u];if(n(o,p)>=0)break;t[r]=p,r=u}t[r]=o}_down(r){const{data:t,compare:n}=this,o=this.length>>1,u=t[r];for(;r<o;){let p=1+(r<<1);const m=p+1;if(m<this.length&&n(t[m],t[p])<0&&(p=m),n(t[p],u)>=0)break;t[r]=t[p],r=p}t[r]=u}};function Hl(r,t,n=0,o=r.length-1,u=zd){for(;o>n;){if(o-n>600){const v=o-n+1,w=t-n+1,T=Math.log(v),P=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*P*(v-P)/v)*(w-v/2<0?-1:1);Hl(r,t,Math.max(n,Math.floor(t-w*P/v+D)),Math.min(o,Math.floor(t+(v-w)*P/v+D)),u)}const p=r[t];let m=n,_=o;for($o(r,n,t),u(r[o],p)>0&&$o(r,n,o);m<_;){for($o(r,m,_),m++,_--;u(r[m],p)<0;)m++;for(;u(r[_],p)>0;)_--}u(r[n],p)===0?$o(r,n,_):(_++,$o(r,_,o)),_<=t&&(n=_+1),t<=_&&(o=_-1)}}function $o(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function zd(r,t){return r<t?-1:r>t?1:0}function zs(r,t){if(r.length<=1)return[r];const n=[];let o,u;for(const p of r){const m=Gu(p);m!==0&&(p.area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(o&&n.push(o),o=[p]):o.push(p))}if(o&&n.push(o),t>1)for(let p=0;p<n.length;p++)n[p].length<=t||(Hl(n[p],t,1,n[p].length-1,Dd),n[p]=n[p].slice(0,t));return n}function Dd(r,t){return t.area-r.area}function Gu(r){let t=0;for(let n,o,u=0,p=r.length,m=p-1;u<p;m=u++)n=r[u],o=r[m],t+=(o.x-n.x)*(n.y+o.y);return t}const Zu=1/298.257223563,Hu=Zu*(2-Zu),Wu=Math.PI/180;class Wl{constructor(t){const n=6378.137*Wu*1e3,o=Math.cos(t*Wu),u=1/(1-Hu*(1-o*o)),p=Math.sqrt(u);this.kx=n*p*o,this.ky=n*p*u*(1-Hu)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,u=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,n){let o,u,p,m,_=1/0;for(let v=0;v<t.length-1;v++){let w=t[v][0],T=t[v][1],P=this.wrap(t[v+1][0]-w)*this.kx,D=(t[v+1][1]-T)*this.ky,F=0;P===0&&D===0||(F=(this.wrap(n[0]-w)*this.kx*P+(n[1]-T)*this.ky*D)/(P*P+D*D),F>1?(w=t[v+1][0],T=t[v+1][1]):F>0&&(w+=P/this.kx*F,T+=D/this.ky*F)),P=this.wrap(n[0]-w)*this.kx,D=(n[1]-T)*this.ky;const B=P*P+D*D;B<_&&(_=B,o=w,u=T,p=v,m=F)}return{point:[o,u],index:p,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function yi(r,t){return t[0]-r[0]}function Ds(r){return r[1]-r[0]+1}function Dr(r,t){return r[1]>=r[0]&&r[1]<t}function Yl(r,t){if(r[0]>r[1])return[null,null];const n=Ds(r);if(t){if(n===2)return[r,null];const u=Math.floor(n/2);return[[r[0],r[0]+u],[r[0]+u,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function Xl(r,t){if(!Dr(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Aa(n,r[o]);return n}function Kl(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)Aa(t,o);return t}function Yu(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function Jl(r,t,n){if(!Yu(r)||!Yu(t))return NaN;let o=0,u=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(u=r[1]-t[3]),r[3]<t[1]&&(u=t[1]-r[3]),n.distance([0,0],[o,u])}function mo(r,t,n){const o=n.pointOnLine(t,r);return n.distance(r,o.point)}function Ql(r,t,n,o,u){const p=Math.min(mo(r,[n,o],u),mo(t,[n,o],u)),m=Math.min(mo(n,[r,t],u),mo(o,[r,t],u));return Math.min(p,m)}function Ld(r,t,n,o,u){if(!Dr(t,r.length)||!Dr(o,n.length))return 1/0;let p=1/0;for(let m=t[0];m<t[1];++m){const _=r[m],v=r[m+1];for(let w=o[0];w<o[1];++w){const T=n[w],P=n[w+1];if(Da(_,v,T,P))return 0;p=Math.min(p,Ql(_,v,T,P,u))}}return p}function Rd(r,t,n,o,u){if(!Dr(t,r.length)||!Dr(o,n.length))return NaN;let p=1/0;for(let m=t[0];m<=t[1];++m)for(let _=o[0];_<=o[1];++_)if(p=Math.min(p,u.distance(r[m],n[_])),p===0)return p;return p}function Od(r,t,n){if(No(r,t,!0))return 0;let o=1/0;for(const u of t){const p=u[0],m=u[u.length-1];if(p!==m&&(o=Math.min(o,mo(r,[m,p],n)),o===0))return o;const _=n.pointOnLine(u,r);if(o=Math.min(o,n.distance(r,_.point)),o===0)return o}return o}function Fd(r,t,n,o){if(!Dr(t,r.length))return NaN;for(let p=t[0];p<=t[1];++p)if(No(r[p],n,!0))return 0;let u=1/0;for(let p=t[0];p<t[1];++p){const m=r[p],_=r[p+1];for(const v of n)for(let w=0,T=v.length,P=T-1;w<T;P=w++){const D=v[P],F=v[w];if(Da(m,_,D,F))return 0;u=Math.min(u,Ql(m,_,D,F,o))}}return u}function Xu(r,t){for(const n of r)for(const o of n)if(No(o,t,!0))return!0;return!1}function Bd(r,t,n,o=1/0){const u=Kl(r),p=Kl(t);if(o!==1/0&&Jl(u,p,n)>=o)return o;if(za(u,p)){if(Xu(r,t))return 0}else if(Xu(t,r))return 0;let m=1/0;for(const _ of r)for(let v=0,w=_.length,T=w-1;v<w;T=v++){const P=_[T],D=_[v];for(const F of t)for(let B=0,U=F.length,W=U-1;B<U;W=B++){const te=F[W],ye=F[B];if(Da(P,D,te,ye))return 0;m=Math.min(m,Ql(P,D,te,ye,n))}}return m}function Ku(r,t,n,o,u,p){if(!p)return;const m=Jl(Xl(o,p),u,n);m<t&&r.push([m,p,[0,0]])}function Ls(r,t,n,o,u,p,m){if(!p||!m)return;const _=Jl(Xl(o,p),Xl(u,m),n);_<t&&r.push([_,p,m])}function Rs(r,t,n,o,u=1/0){let p=Math.min(o.distance(r[0],n[0][0]),u);if(p===0)return p;const m=new qu([[0,[0,r.length-1],[0,0]]],yi),_=Kl(n);for(;m.length>0;){const v=m.pop();if(v[0]>=p)continue;const w=v[1],T=t?50:100;if(Ds(w)<=T){if(!Dr(w,r.length))return NaN;if(t){const P=Fd(r,w,n,o);if(isNaN(P)||P===0)return P;p=Math.min(p,P)}else for(let P=w[0];P<=w[1];++P){const D=Od(r[P],n,o);if(p=Math.min(p,D),p===0)return 0}}else{const P=Yl(w,t);Ku(m,p,o,r,_,P[0]),Ku(m,p,o,r,_,P[1])}}return p}function Os(r,t,n,o,u,p=1/0){let m=Math.min(p,u.distance(r[0],n[0]));if(m===0)return m;const _=new qu([[0,[0,r.length-1],[0,n.length-1]]],yi);for(;_.length>0;){const v=_.pop();if(v[0]>=m)continue;const w=v[1],T=v[2],P=t?50:100,D=o?50:100;if(Ds(w)<=P&&Ds(T)<=D){if(!Dr(w,r.length)&&Dr(T,n.length))return NaN;let F;if(t&&o)F=Ld(r,w,n,T,u),m=Math.min(m,F);else if(t&&!o){const B=r.slice(w[0],w[1]+1);for(let U=T[0];U<=T[1];++U)if(F=mo(n[U],B,u),m=Math.min(m,F),m===0)return m}else if(!t&&o){const B=n.slice(T[0],T[1]+1);for(let U=w[0];U<=w[1];++U)if(F=mo(r[U],B,u),m=Math.min(m,F),m===0)return m}else F=Rd(r,w,n,T,u),m=Math.min(m,F)}else{const F=Yl(w,t),B=Yl(T,o);Ls(_,m,u,r,n,F[0],B[0]),Ls(_,m,u,r,n,F[0],B[1]),Ls(_,m,u,r,n,F[1],B[0]),Ls(_,m,u,r,n,F[1],B[1])}}return m}function ec(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class go{constructor(t,n){this.type=Ue,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ho(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new go(o,o.features.map(u=>ec(u.geometry)).flat());if(o.type==="Feature")return new go(o,ec(o.geometry));if("type"in o&&"coordinates"in o)return new go(o,ec(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=n.geometry(),p=u.flat().map(v=>Ul([v.x,v.y],n.canonical));if(u.length===0)return NaN;const m=new Wl(p[0][1]);let _=1/0;for(const v of o){switch(v.type){case"Point":_=Math.min(_,Os(p,!1,[v.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,Os(p,!1,v.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,Rs(p,!1,v.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=n.geometry(),p=u.flat().map(v=>Ul([v.x,v.y],n.canonical));if(u.length===0)return NaN;const m=new Wl(p[0][1]);let _=1/0;for(const v of o){switch(v.type){case"Point":_=Math.min(_,Os(p,!0,[v.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,Os(p,!0,v.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,Rs(p,!0,v.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const p=zs(u,0).map(v=>v.map(w=>w.map(T=>Ul([T.x,T.y],n.canonical)))),m=new Wl(p[0][0][0][1]);let _=1/0;for(const v of o)for(const w of p){switch(v.type){case"Point":_=Math.min(_,Rs([v.coordinates],!1,w,m,_));break;case"LineString":_=Math.min(_,Rs(v.coordinates,!0,w,m,_));break;case"Polygon":_=Math.min(_,Bd(w,v.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class La{constructor(t){this.type=gt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new La(o)}evaluate(t){var n;const o=(n=t.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?ri(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Vo={"==":$l,"!=":Td,">":Md,"<":Ed,">=":Ms,"<=":kd,array:Vn,at:pn,boolean:Vn,case:on,coalesce:Un,collator:ks,format:Ia,image:Vl,in:Lo,"index-of":Ea,interpolate:On,"interpolate-hcl":On,"interpolate-lab":On,length:Is,let:Ta,literal:Rn,match:Ro,number:Vn,"number-format":Ps,object:Vn,slice:Ma,step:Fo,string:Vn,"to-boolean":yr,"to-color":yr,"to-number":yr,"to-string":yr,var:sr,within:fo,distance:go,"global-state":La};class tr{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=tr.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=m.filter(([w])=>!Array.isArray(w)||w.length===t.length-1);let v=null;for(const[w,T]of _){v=new Ca(n.registry,Fs,n.path,null,n.scope);const P=[];let D=!1;for(let F=1;F<t.length;F++){const B=t[F],U=Array.isArray(w)?w[F-1]:w.type,W=v.parse(B,1+P.length,U);if(!W){D=!0;break}P.push(W)}if(!D)if(Array.isArray(w)&&w.length!==P.length)v.error(`Expected ${w.length} arguments, but found ${P.length} instead.`);else{for(let F=0;F<P.length;F++){const B=Array.isArray(w)?w[F]:w.type,U=P[F];v.concat(F+1).checkSubtype(B,U.type)}if(v.errors.length===0)return new tr(o,p,T,P)}}if(_.length===1)n.errors.push(...v.errors);else{const w=(_.length?_:m).map(([P])=>{return D=P,Array.isArray(D)?`(${D.map(Oi).join(", ")})`:`(${Oi(D.type)}...)`;var D}).join(" | "),T=[];for(let P=1;P<t.length;P++){const D=n.parse(t[P],1+T.length);if(!D)return null;T.push(Oi(D.type))}n.error(`Expected arguments of type ${w}, but found (${T.join(", ")}) instead.`)}return null}static register(t,n){tr.definitions=n;for(const o in n)t[o]=tr}}function Ju(r,[t,n,o,u]){t=t.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const p=u?u.evaluate(r):1,m=Kt(t,n,o,p);if(m)throw new Fi(m);return new oi(t/255,n/255,o/255,p,!1)}function Qu(r,t){return r in t}function tc(r,t){const n=t[r];return n===void 0?null:n}function _o(r){return{type:r}}function Fs(r){if(r instanceof sr)return Fs(r.boundExpression);if(r instanceof tr&&r.name==="error"||r instanceof ks||r instanceof fo||r instanceof go||r instanceof La)return!1;const t=r instanceof yr||r instanceof Vn;let n=!0;return r.eachChild(o=>{n=t?n&&Fs(o):n&&o instanceof Rn}),!!n&&Bs(r)&&Uo(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Bs(r){if(r instanceof tr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof fo||r instanceof go)return!1;let t=!0;return r.eachChild(n=>{t&&!Bs(n)&&(t=!1)}),t}function Ra(r){if(r instanceof tr&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!Ra(n)&&(t=!1)}),t}function Uo(r,t){if(r instanceof tr&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(o=>{n&&!Uo(o,t)&&(n=!1)}),n}function eh(r){return{result:"success",value:r}}function qo(r){return{result:"error",value:r}}function Go(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function ic(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function nc(r){return!!r.expression&&r.expression.interpolated}function ai(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function yo(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Ut(r)===ui}function th(r){return r}function ih(r,t){const n=r.stops&&typeof r.stops[0][0]=="object",o=n||!(n||r.property!==void 0),u=r.type||(nc(t)?"exponential":"interval"),p=function(T){switch(T.type){case"color":return oi.parse;case"padding":return rn.parse;case"numberArray":return In.parse;case"colorArray":return dn.parse;default:return null}}(t);if(p&&((r=De({},r)).stops&&(r.stops=r.stops.map(T=>[T[0],p(T[1])])),r.default=p(r.default?r.default:t.default)),r.colorSpace&&(m=r.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var m;const _=function(T){switch(T){case"exponential":return nh;case"interval":return Nd;case"categorical":return jd;case"identity":return rh;default:throw new Error(`Unknown function type "${T}"`)}}(u);let v,w;if(u==="categorical"){v=Object.create(null);for(const T of r.stops)v[T[0]]=T[1];w=typeof r.stops[0][0]}if(n){const T={},P=[];for(let B=0;B<r.stops.length;B++){const U=r.stops[B],W=U[0].zoom;T[W]===void 0&&(T[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},P.push(W)),T[W].stops.push([U[0].value,U[1]])}const D=[];for(const B of P)D.push([T[B].zoom,ih(T[B],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:On.interpolationFactor.bind(void 0,F),zoomStops:D.map(B=>B[0]),evaluate:({zoom:B},U)=>nh({stops:D,base:r.base},t,B).evaluate(B,U)}}if(o){const T=u==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:On.interpolationFactor.bind(void 0,T),zoomStops:r.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(r,t,P,v,w)}}return{kind:"source",evaluate(T,P){const D=P&&P.properties?P.properties[r.property]:void 0;return D===void 0?Oa(r.default,t.default):_(r,t,D,v,w)}}}function Oa(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function jd(r,t,n,o,u){return Oa(typeof n===u?o[n]:void 0,r.default,t.default)}function Nd(r,t,n){if(ai(n)!=="number")return Oa(r.default,t.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const u=Oo(r.stops.map(p=>p[0]),n);return r.stops[u][1]}function nh(r,t,n){const o=r.base!==void 0?r.base:1;if(ai(n)!=="number")return Oa(r.default,t.default);const u=r.stops.length;if(u===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[u-1][0])return r.stops[u-1][1];const p=Oo(r.stops.map(T=>T[0]),n),m=function(T,P,D,F){const B=F-D,U=T-D;return B===0?0:P===1?U/B:(Math.pow(P,U)-1)/(Math.pow(P,B)-1)}(n,o,r.stops[p][0],r.stops[p+1][0]),_=r.stops[p][1],v=r.stops[p+1][1],w=Yn[t.type]||th;return typeof _.evaluate=="function"?{evaluate(...T){const P=_.evaluate.apply(void 0,T),D=v.evaluate.apply(void 0,T);if(P!==void 0&&D!==void 0)return w(P,D,m,r.colorSpace)}}:w(_,v,m,r.colorSpace)}function rh(r,t,n){switch(t.type){case"color":n=oi.parse(n);break;case"formatted":n=Pn.fromString(n.toString());break;case"resolvedImage":n=$n.fromString(n.toString());break;case"padding":n=rn.parse(n);break;case"colorArray":n=dn.parse(n);break;case"numberArray":n=In.parse(n);break;default:ai(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Oa(n,r.default,t.default)}tr.register(Vo,{error:[{kind:"error"},[zt],(r,[t])=>{throw new Fi(t.evaluate(r))}],typeof:[zt,[gt],(r,[t])=>Oi(Ut(t.evaluate(r)))],"to-rgba":[Wn(Ue,4),[ti],(r,[t])=>{const[n,o,u,p]=t.evaluate(r).rgb;return[255*n,255*o,255*u,p]}],rgb:[ti,[Ue,Ue,Ue],Ju],rgba:[ti,[Ue,Ue,Ue,Ue],Ju],has:{type:Lt,overloads:[[[zt],(r,[t])=>Qu(t.evaluate(r),r.properties())],[[zt,ui],(r,[t,n])=>Qu(t.evaluate(r),n.evaluate(r))]]},get:{type:gt,overloads:[[[zt],(r,[t])=>tc(t.evaluate(r),r.properties())],[[zt,ui],(r,[t,n])=>tc(t.evaluate(r),n.evaluate(r))]]},"feature-state":[gt,[zt],(r,[t])=>tc(t.evaluate(r),r.featureState||{})],properties:[ui,[],r=>r.properties()],"geometry-type":[zt,[],r=>r.geometryType()],id:[gt,[],r=>r.id()],zoom:[Ue,[],r=>r.globals.zoom],"heatmap-density":[Ue,[],r=>r.globals.heatmapDensity||0],elevation:[Ue,[],r=>r.globals.elevation||0],"line-progress":[Ue,[],r=>r.globals.lineProgress||0],accumulated:[gt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ue,_o(Ue),(r,t)=>{let n=0;for(const o of t)n+=o.evaluate(r);return n}],"*":[Ue,_o(Ue),(r,t)=>{let n=1;for(const o of t)n*=o.evaluate(r);return n}],"-":{type:Ue,overloads:[[[Ue,Ue],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[Ue],(r,[t])=>-t.evaluate(r)]]},"/":[Ue,[Ue,Ue],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[Ue,[Ue,Ue],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[Ue,[],()=>Math.LN2],pi:[Ue,[],()=>Math.PI],e:[Ue,[],()=>Math.E],"^":[Ue,[Ue,Ue],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[Ue,[Ue],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Ue,[Ue],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Ue,[Ue],(r,[t])=>Math.log(t.evaluate(r))],log2:[Ue,[Ue],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Ue,[Ue],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Ue,[Ue],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Ue,[Ue],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Ue,[Ue],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Ue,[Ue],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Ue,[Ue],(r,[t])=>Math.atan(t.evaluate(r))],min:[Ue,_o(Ue),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[Ue,_o(Ue),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[Ue,[Ue],(r,[t])=>Math.abs(t.evaluate(r))],round:[Ue,[Ue],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ue,[Ue],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Ue,[Ue],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[Lt,[zt,gt],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[Lt,[gt],(r,[t])=>r.id()===t.value],"filter-type-==":[Lt,[zt],(r,[t])=>r.geometryType()===t.value],"filter-<":[Lt,[zt,gt],(r,[t,n])=>{const o=r.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Lt,[gt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Lt,[zt,gt],(r,[t,n])=>{const o=r.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[Lt,[gt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Lt,[zt,gt],(r,[t,n])=>{const o=r.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Lt,[gt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Lt,[zt,gt],(r,[t,n])=>{const o=r.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Lt,[gt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Lt,[gt],(r,[t])=>t.value in r.properties()],"filter-has-id":[Lt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Lt,[Wn(zt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[Lt,[Wn(gt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[Lt,[zt,Wn(gt)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[Lt,[zt,Wn(gt)],(r,[t,n])=>function(o,u,p,m){for(;p<=m;){const _=p+m>>1;if(u[_]===o)return!0;u[_]>o?m=_-1:p=_+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[_o(Lt),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[_o(Lt),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[Lt,[Lt],(r,[t])=>!t.evaluate(r)],"is-supported-script":[Lt,[zt],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[zt,[zt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[zt,[zt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[zt,_o(gt),(r,t)=>t.map(n=>po(n.evaluate(r))).join("")],"resolved-locale":[zt,[Ri],(r,[t])=>t.evaluate(r).resolvedLocale()]});class js{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new Bu,this._defaultValue=n?function(o){if(o.type==="color"&&yo(o.default))return new oi(0,0,0,0);switch(o.type){case"color":return oi.parse(o.default)||null;case"padding":return rn.parse(o.default)||null;case"numberArray":return In.parse(o.default)||null;case"colorArray":return dn.parse(o.default)||null;case"variableAnchorOffsetCollection":return hi.parse(o.default)||null;case"projectionDefinition":return Wt.parse(o.default)||null;default:return o.default===void 0?null:o.default}}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,u,p,m){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,p,m){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Ns(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Vo}function $s(r,t){const n=new Ca(Vo,Fs,[],t?function(u){const p={color:ti,string:zt,number:Ue,enum:zt,boolean:Lt,formatted:sn,padding:Ei,numberArray:va,colorArray:lo,projectionDefinition:bi,resolvedImage:Pr,variableAnchorOffsetCollection:ba};return u.type==="array"?Wn(p[u.value]||gt,u.length):p[u.type]}(t):void 0),o=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?eh(new js(o,t)):qo(n.errors)}class Fa{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Ra(n.expression),this.globalStateRefs=Ho(n.expression)}evaluateWithoutErrorHandling(t,n,o,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,p,m)}evaluate(t,n,o,u,p,m){return this._styleExpression.evaluate(t,n,o,u,p,m)}}class Vs{constructor(t,n,o,u){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Ra(n.expression),this.globalStateRefs=Ho(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,n,o,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,p,m)}evaluate(t,n,o,u,p,m){return this._styleExpression.evaluate(t,n,o,u,p,m)}interpolationFactor(t,n,o){return this.interpolationType?On.interpolationFactor(this.interpolationType,t,n,o):0}}function rc(r,t){const n=$s(r,t);if(n.result==="error")return n;const o=n.value.expression,u=Bs(o);if(!u&&!Go(t))return qo([new je("","data expressions not supported")]);const p=Uo(o,["zoom"]);if(!p&&!ic(t))return qo([new je("","zoom expressions not supported")]);const m=Zo(o);return m||p?m instanceof je?qo([m]):m instanceof On&&!nc(t)?qo([new je("",'"interpolate" expressions cannot be used with this property')]):eh(m?new Vs(u?"camera":"composite",n.value,m.labels,m instanceof On?m.interpolation:void 0):new Fa(u?"constant":"source",n.value)):qo([new je("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ba{constructor(t,n){this._parameters=t,this._specification=n,De(this,ih(this._parameters,this._specification))}static deserialize(t){return new Ba(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Zo(r){let t=null;if(r instanceof Ta)t=Zo(r.result);else if(r instanceof Un){for(const n of r.args)if(t=Zo(n),t)break}else(r instanceof Fo||r instanceof On)&&r.input instanceof tr&&r.input.name==="zoom"&&(t=r);return t instanceof je||r.eachChild(n=>{const o=Zo(n);o instanceof je?t=o:!t&&o?t=new je("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new je("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ho(r,t=new Set){return r instanceof La&&t.add(r.key),r.eachChild(n=>{Ho(n,t)}),t}function ja(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!ja(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const oc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hr(r){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ja(r)||(r=Us(r));const t=$s(r,oc);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,u)=>t.value.evaluate(n,o,{},u),needGeometry:oh(r),getGlobalStateRefs:()=>Ho(t.value.expression)}}function $d(r,t){return r<t?-1:r>t?1:0}function oh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(oh(r[t]))return!0;return!1}function Us(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?ac(r[1],r[2],"=="):t==="!="?Na(ac(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ac(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(Us))):t==="all"?["all"].concat(r.slice(1).map(Us)):t==="none"?["all"].concat(r.slice(1).map(Us).map(Na)):t==="in"?ah(r[1],r.slice(2)):t==="!in"?Na(ah(r[1],r.slice(2))):t==="has"?sh(r[1]):t!=="!has"||Na(sh(r[1]));var n}function ac(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function ah(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort($d)]]:["filter-in-small",r,["literal",t]]}}function sh(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Na(r){return["!",r]}function qs(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let u="[";for(const p of r)u+=`${qs(p)},`;return`${u}]`}const n=Object.keys(r).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${qs(r[n[u]])},`;return`${o}}`}function Gs(r){let t="";for(const n of V)t+=`/${qs(r[n])}`;return t}function lh(r){const t=r.value;return t?[new K(r.key,t,"constants have been deprecated as of v8")]:[]}function qi(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Wr(r){if(Array.isArray(r))return r.map(Wr);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=Wr(r[n]);return t}return qi(r)}function ir(r){const t=r.key,n=r.value,o=r.valueSpec||{},u=r.objectElementValidators||{},p=r.style,m=r.styleSpec,_=r.validateSpec;let v=[];const w=ai(n);if(w!=="object")return[new K(t,n,`object expected, ${w} found`)];for(const T in n){const P=T.split(".")[0],D=ri(o,P)||o["*"];let F;if(ri(u,P))F=u[P];else if(ri(o,P))F=_;else if(u["*"])F=u["*"];else{if(!o["*"]){v.push(new K(t,n[T],`unknown property "${T}"`));continue}F=_}v=v.concat(F({key:(t&&`${t}.`)+T,value:n[T],valueSpec:D,style:p,styleSpec:m,object:n,objectKey:T,validateSpec:_},n))}for(const T in o)u[T]||o[T].required&&o[T].default===void 0&&n[T]===void 0&&v.push(new K(t,n,`missing required property "${T}"`));return v}function Zs(r){const t=r.value,n=r.valueSpec,o=r.style,u=r.styleSpec,p=r.key,m=r.arrayElementValidator||r.validateSpec;if(ai(t)!=="array")return[new K(p,t,`array expected, ${ai(t)} found`)];if(n.length&&t.length!==n.length)return[new K(p,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new K(p,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let _={type:n.value,values:n.values};u.$version<7&&(_.function=n.function),ai(n.value)==="object"&&(_=n.value);let v=[];for(let w=0;w<t.length;w++)v=v.concat(m({array:t,arrayIndex:w,value:t[w],valueSpec:_,validateSpec:r.validateSpec,style:o,styleSpec:u,key:`${p}[${w}]`}));return v}function $a(r){const t=r.key,n=r.value,o=r.valueSpec;let u=ai(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new K(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new K(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new K(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Wo(r){const t=r.valueSpec,n=qi(r.value.type);let o,u,p,m={};const _=n!=="categorical"&&r.value.property===void 0,v=!_,w=ai(r.value.stops)==="array"&&ai(r.value.stops[0])==="array"&&ai(r.value.stops[0][0])==="object",T=ir({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new K(F.key,F.value,'identity function may not have a "stops" property')];let B=[];const U=F.value;return B=B.concat(Zs({key:F.key,value:U,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:P})),ai(U)==="array"&&U.length===0&&B.push(new K(F.key,U,"array must have at least one stop")),B},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&_&&T.push(new K(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||T.push(new K(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!nc(r.valueSpec)&&T.push(new K(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(v&&!Go(r.valueSpec)?T.push(new K(r.key,r.value,"property functions not supported")):_&&!ic(r.valueSpec)&&T.push(new K(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!w||r.value.property!==void 0||T.push(new K(r.key,r.value,'"property" property is required')),T;function P(F){let B=[];const U=F.value,W=F.key;if(ai(U)!=="array")return[new K(W,U,`array expected, ${ai(U)} found`)];if(U.length!==2)return[new K(W,U,`array length 2 expected, length ${U.length} found`)];if(w){if(ai(U[0])!=="object")return[new K(W,U,`object expected, ${ai(U[0])} found`)];if(U[0].zoom===void 0)return[new K(W,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new K(W,U,"object stop key must have value")];if(p&&p>qi(U[0].zoom))return[new K(W,U[0].zoom,"stop zoom values must appear in ascending order")];qi(U[0].zoom)!==p&&(p=qi(U[0].zoom),u=void 0,m={}),B=B.concat(ir({key:`${W}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:$a,value:D}}))}else B=B.concat(D({key:`${W}[0]`,value:U[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},U));return Ns(Wr(U[1]))?B.concat([new K(`${W}[1]`,U[1],"expressions are not allowed in function stops.")]):B.concat(F.validateSpec({key:`${W}[1]`,value:U[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function D(F,B){const U=ai(F.value),W=qi(F.value),te=F.value!==null?F.value:B;if(o){if(U!==o)return[new K(F.key,te,`${U} stop domain type must match previous stop domain type ${o}`)]}else o=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new K(F.key,te,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&n!=="categorical"){let ye=`number expected, ${U} found`;return Go(t)&&n===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new K(F.key,te,ye)]}return n!=="categorical"||U!=="number"||isFinite(W)&&Math.floor(W)===W?n!=="categorical"&&U==="number"&&u!==void 0&&W<u?[new K(F.key,te,"stop domain values must appear in ascending order")]:(u=W,n==="categorical"&&W in m?[new K(F.key,te,"stop domain values must be unique")]:(m[W]=!0,[])):[new K(F.key,te,`integer expected, found ${W}`)]}}function Yo(r){const t=(r.expressionContext==="property"?rc:$s)(Wr(r.value),r.valueSpec);if(t.result==="error")return t.value.map(o=>new K(`${r.key}${o.key}`,r.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new K(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ra(n))return[new K(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ra(n))return[new K(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Uo(n,["zoom","feature-state"]))return[new K(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Bs(n))return[new K(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sc(r){const t=r.key,n=r.value,o=ai(n);return o!=="string"?[new K(t,n,`color expected, ${o} found`)]:oi.parse(String(n))?[]:[new K(t,n,`color expected, "${n}" found`)]}function Va(r){const t=r.key,n=r.value,o=r.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(qi(n))===-1&&u.push(new K(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(qi(n))===-1&&u.push(new K(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function lc(r){return ja(Wr(r.value))?Yo(De({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ch(r)}function ch(r){const t=r.value,n=r.key;if(ai(t)!=="array")return[new K(n,t,`array expected, ${ai(t)} found`)];const o=r.styleSpec;let u,p=[];if(t.length<1)return[new K(n,t,"filter array must have at least 1 element")];switch(p=p.concat(Va({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),qi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&qi(t[1])==="$type"&&p.push(new K(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new K(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=ai(t[1]),u!=="string"&&p.push(new K(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=ai(t[m]),qi(t[1])==="$type"?p=p.concat(Va({key:`${n}[${m}]`,value:t[m],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new K(`${n}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)p=p.concat(ch({key:`${n}[${m}]`,value:t[m],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":u=ai(t[1]),t.length!==2?p.push(new K(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new K(`${n}[1]`,t[1],`string expected, ${u} found`))}return p}function uh(r,t){const n=r.key,o=r.validateSpec,u=r.style,p=r.styleSpec,m=r.value,_=r.objectKey,v=p[`${t}_${r.layerType}`];if(!v)return[];const w=_.match(/^(.*)-transition$/);if(t==="paint"&&w&&v[w[1]]&&v[w[1]].transition)return o({key:n,value:m,valueSpec:p.transition,style:u,styleSpec:p});const T=r.valueSpec||v[_];if(!T)return[new K(n,m,`unknown property "${_}"`)];let P;if(ai(m)==="string"&&Go(T)&&!T.tokens&&(P=/^{([^}]+)}$/.exec(m)))return[new K(n,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const D=[];return r.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&D.push(new K(n,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&yo(Wr(m))&&qi(m.type)==="identity"&&D.push(new K(n,m,'"text-font" does not support identity functions'))),D.concat(o({key:r.key,value:m,valueSpec:T,style:u,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:_}))}function Xo(r){return uh(r,"paint")}function Ko(r){return uh(r,"layout")}function qn(r){let t=[];const n=r.value,o=r.key,u=r.style,p=r.styleSpec;if(ai(n)!=="object")return[new K(o,n,`object expected, ${ai(n)} found`)];n.type||n.ref||t.push(new K(o,n,'either "type" or "ref" is required'));let m=qi(n.type);const _=qi(n.ref);if(n.id){const v=qi(n.id);for(let w=0;w<r.arrayIndex;w++){const T=u.layers[w];qi(T.id)===v&&t.push(new K(o,n.id,`duplicate layer id "${n.id}", previously used at line ${T.id.__line__}`))}}if("ref"in n){let v;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&t.push(new K(o,n[w],`"${w}" is prohibited for ref layers`))}),u.layers.forEach(w=>{qi(w.id)===_&&(v=w)}),v?v.ref?t.push(new K(o,n.ref,"ref cannot reference another ref layer")):m=qi(v.type):t.push(new K(o,n.ref,`ref layer "${_}" not found`))}else if(m!=="background")if(n.source){const v=u.sources&&u.sources[n.source],w=v&&qi(v.type);v?w==="vector"&&m==="raster"?t.push(new K(o,n.source,`layer "${n.id}" requires a raster source`)):w!=="raster-dem"&&m==="hillshade"||w!=="raster-dem"&&m==="color-relief"?t.push(new K(o,n.source,`layer "${n.id}" requires a raster-dem source`)):w==="raster"&&m!=="raster"?t.push(new K(o,n.source,`layer "${n.id}" requires a vector source`)):w!=="vector"||n["source-layer"]?w==="raster-dem"&&m!=="hillshade"&&m!=="color-relief"?t.push(new K(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]||w==="geojson"&&v.lineMetrics||t.push(new K(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new K(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new K(o,n.source,`source "${n.source}" not found`))}else t.push(new K(o,n,'missing required property "source"'));return t=t.concat(ir({key:o,value:n,valueSpec:p.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:lc,layout:v=>ir({layer:n,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":w=>Ko(De({layerType:m},w))}}),paint:v=>ir({layer:n,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":w=>Xo(De({layerType:m},w))}})}})),t}function lr(r){const t=r.value,n=r.key,o=ai(t);return o!=="string"?[new K(n,t,`string expected, ${o} found`)]:[]}const cc={promoteId:function({key:r,value:t}){if(ai(t)==="string")return lr({key:r,value:t});{const n=[];for(const o in t)n.push(...lr({key:`${r}.${o}`,value:t[o]}));return n}}};function hh(r){const t=r.value,n=r.key,o=r.styleSpec,u=r.style,p=r.validateSpec;if(!t.type)return[new K(n,t,'"type" is required')];const m=qi(t.type);let _;switch(m){case"vector":case"raster":return _=ir({key:n,value:t,valueSpec:o[`source_${m.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:cc,validateSpec:p}),_;case"raster-dem":return _=function(v){var w;const T=(w=v.sourceName)!==null&&w!==void 0?w:"",P=v.value,D=v.styleSpec,F=D.source_raster_dem,B=v.style;let U=[];const W=ai(P);if(P===void 0)return U;if(W!=="object")return U.push(new K("source_raster_dem",P,`object expected, ${W} found`)),U;const te=qi(P.encoding)==="custom",ye=["redFactor","greenFactor","blueFactor","baseShift"],le=v.value.encoding?`"${v.value.encoding}"`:"Default";for(const O in P)!te&&ye.includes(O)?U.push(new K(O,P[O],`In "${T}": "${O}" is only valid when "encoding" is set to "custom". ${le} encoding found`)):F[O]?U=U.concat(v.validateSpec({key:O,value:P[O],valueSpec:F[O],validateSpec:v.validateSpec,style:B,styleSpec:D})):U.push(new K(O,P[O],`unknown property "${O}"`));return U}({sourceName:n,value:t,style:r.style,styleSpec:o,validateSpec:p}),_;case"geojson":if(_=ir({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:p,objectElementValidators:cc}),t.cluster)for(const v in t.clusterProperties){const[w,T]=t.clusterProperties[v],P=typeof w=="string"?[w,["accumulated"],["get",v]]:w;_.push(...Yo({key:`${n}.${v}.map`,value:T,expressionContext:"cluster-map"})),_.push(...Yo({key:`${n}.${v}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return _;case"video":return ir({key:n,value:t,valueSpec:o.source_video,style:u,validateSpec:p,styleSpec:o});case"image":return ir({key:n,value:t,valueSpec:o.source_image,style:u,validateSpec:p,styleSpec:o});case"canvas":return[new K(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Va({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function dh(r){const t=r.value,n=r.styleSpec,o=n.light,u=r.style;let p=[];const m=ai(t);if(t===void 0)return p;if(m!=="object")return p=p.concat([new K("light",t,`object expected, ${m} found`)]),p;for(const _ in t){const v=_.match(/^(.*)-transition$/);p=p.concat(v&&o[v[1]]&&o[v[1]].transition?r.validateSpec({key:_,value:t[_],valueSpec:n.transition,validateSpec:r.validateSpec,style:u,styleSpec:n}):o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:r.validateSpec,style:u,styleSpec:n}):[new K(_,t[_],`unknown property "${_}"`)])}return p}function Jo(r){const t=r.value,n=r.styleSpec,o=n.sky,u=r.style,p=ai(t);if(t===void 0)return[];if(p!=="object")return[new K("sky",t,`object expected, ${p} found`)];let m=[];for(const _ in t)m=m.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],style:u,styleSpec:n}):[new K(_,t[_],`unknown property "${_}"`)]);return m}function uc(r){const t=r.value,n=r.styleSpec,o=n.terrain,u=r.style;let p=[];const m=ai(t);if(t===void 0)return p;if(m!=="object")return p=p.concat([new K("terrain",t,`object expected, ${m} found`)]),p;for(const _ in t)p=p.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:r.validateSpec,style:u,styleSpec:n}):[new K(_,t[_],`unknown property "${_}"`)]);return p}function Hs(r){let t=[];const n=r.value,o=r.key;if(Array.isArray(n)){const u=[],p=[];for(const m in n)n[m].id&&u.includes(n[m].id)&&t.push(new K(o,n,`all the sprites' ids must be unique, but ${n[m].id} is duplicated`)),u.push(n[m].id),n[m].url&&p.includes(n[m].url)&&t.push(new K(o,n,`all the sprites' URLs must be unique, but ${n[m].url} is duplicated`)),p.push(n[m].url),t=t.concat(ir({key:`${o}[${m}]`,value:n[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return lr({key:o,value:n})}function ph(r){return t=r.value,t&&t.constructor===Object?[]:[new K(r.key,r.value,`object expected, ${ai(r.value)} found`)];var t}const Ws={"*":()=>[],array:Zs,boolean:function(r){const t=r.value,n=r.key,o=ai(t);return o!=="boolean"?[new K(n,t,`boolean expected, ${o} found`)]:[]},number:$a,color:sc,constants:lh,enum:Va,filter:lc,function:Wo,layer:qn,object:ir,source:hh,light:dh,sky:Jo,terrain:uc,projection:function(r){const t=r.value,n=r.styleSpec,o=n.projection,u=r.style,p=ai(t);if(t===void 0)return[];if(p!=="object")return[new K("projection",t,`object expected, ${p} found`)];let m=[];for(const _ in t)m=m.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],style:u,styleSpec:n}):[new K(_,t[_],`unknown property "${_}"`)]);return m},projectionDefinition:function(r){const t=r.key;let n=r.value;n=n instanceof String?n.valueOf():n;const o=ai(n);return o!=="array"||function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"}(n)||function(u){return!!["interpolate","step","literal"].includes(u[0])}(n)?["array","string"].includes(o)?[]:[new K(t,n,`projection expected, invalid type "${o}" found`)]:[new K(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:lr,formatted:function(r){return lr(r).length===0?[]:Yo(r)},resolvedImage:function(r){return lr(r).length===0?[]:Yo(r)},padding:function(r){const t=r.key,n=r.value;if(ai(n)==="array"){if(n.length<1||n.length>4)return[new K(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let p=0;p<n.length;p++)u=u.concat(r.validateSpec({key:`${t}[${p}]`,value:n[p],validateSpec:r.validateSpec,valueSpec:o}));return u}return $a({key:t,value:n,valueSpec:{}})},numberArray:function(r){const t=r.key,n=r.value;if(ai(n)==="array"){const o={type:"number"};if(n.length<1)return[new K(t,n,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<n.length;p++)u=u.concat(r.validateSpec({key:`${t}[${p}]`,value:n[p],validateSpec:r.validateSpec,valueSpec:o}));return u}return $a({key:t,value:n,valueSpec:{}})},colorArray:function(r){const t=r.key,n=r.value;if(ai(n)==="array"){if(n.length<1)return[new K(t,n,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<n.length;u++)o=o.concat(sc({key:`${t}[${u}]`,value:n[u]}));return o}return sc({key:t,value:n})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,o=ai(n),u=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new K(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let m=0;m<n.length;m+=2)p=p.concat(Va({key:`${t}[${m}]`,value:n[m],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(Zs({key:`${t}[${m+1}]`,value:n[m+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:u}));return p},sprite:Hs,state:ph};function Ys(r){const t=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=Ys,n.expression&&yo(qi(t))?Wo(r):n.expression&&Ns(Wr(t))?Yo(r):n.type&&Ws[n.type]?Ws[n.type](r):ir(De({},r,{valueSpec:n.type?o[n.type]:n}))}function Qo(r){const t=r.value,n=r.key,o=lr(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new K(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new K(n,t,'"glyphs" url must include a "{range}" token'))),o}function nr(r,t=k){let n=[];return n=n.concat(Ys({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:Ys,objectElementValidators:{glyphs:Qo,"*":()=>[]}})),r.constants&&(n=n.concat(lh({key:"constants",value:r.constants}))),fh(n)}function cr(r){return function(t){return r({...t,validateSpec:Ys})}}function fh(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function Fn(r){return function(...t){return fh(r.apply(this,t))}}nr.source=Fn(cr(hh)),nr.sprite=Fn(cr(Hs)),nr.glyphs=Fn(cr(Qo)),nr.light=Fn(cr(dh)),nr.sky=Fn(cr(Jo)),nr.terrain=Fn(cr(uc)),nr.state=Fn(cr(ph)),nr.layer=Fn(cr(qn)),nr.filter=Fn(cr(lc)),nr.paintProperty=Fn(cr(Xo)),nr.layoutProperty=Fn(cr(Ko));const ea=nr,Vd=ea.light,Xs=ea.sky,Ud=ea.paintProperty,hc=ea.layoutProperty;function Ua(r,t){let n=!1;if(t&&t.length)for(const o of t)r.fire(new de(new Error(o.message))),n=!0;return n}class ta{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(n=m[1])+2*(o=m[2]);for(let v=0;v<this.d*this.d;v++){const w=m[3+v],T=m[3+v+1];u.push(w===T?null:m.subarray(w,T))}const _=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],_),this.bboxes=m.subarray(_),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const p=o/n*t;this.min=-p,this.max=t+p}insert(t,n,o,u,p){this._forEachCell(n,o,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,p,m){this.cells[p].push(m)}query(t,n,o,u,p){const m=this.min,_=this.max;if(t<=m&&n<=m&&_<=o&&_<=u&&!p)return Array.prototype.slice.call(this.keys);{const v=[];return this._forEachCell(t,n,o,u,this._queryCell,v,{},p),v}}_queryCell(t,n,o,u,p,m,_,v){const w=this.cells[p];if(w!==null){const T=this.keys,P=this.bboxes;for(let D=0;D<w.length;D++){const F=w[D];if(_[F]===void 0){const B=4*F;(v?v(P[B+0],P[B+1],P[B+2],P[B+3]):t<=P[B+2]&&n<=P[B+3]&&o>=P[B+0]&&u>=P[B+1])?(_[F]=!0,m.push(T[F])):_[F]=!1}}}}_forEachCell(t,n,o,u,p,m,_,v){const w=this._convertToCellCoord(t),T=this._convertToCellCoord(n),P=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let F=w;F<=P;F++)for(let B=T;B<=D;B++){const U=this.d*B+F;if((!v||v(this._convertFromCellCoord(F),this._convertFromCellCoord(B),this._convertFromCellCoord(F+1),this._convertFromCellCoord(B+1)))&&p.call(this,t,n,o,u,U,m,_,v))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=n;for(let m=0;m<t.length;m++){const _=t[m];u[3+m]=p,u.set(_,p),p+=_.length}return u[3+t.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+t.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new ta(t.buffer)}}const br={};function _t(r,t,n={}){if(br[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),br[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}_t("Object",Object),_t("Set",Set),_t("TransferableGridIndex",ta),_t("Color",oi),_t("Error",Error),_t("AJAXError",ne),_t("ResolvedImage",$n),_t("StylePropertyFunction",Ba),_t("StyleExpression",js,{omit:["_evaluator"]}),_t("ZoomDependentExpression",Vs),_t("ZoomConstantExpression",Fa),_t("CompoundExpression",tr,{omit:["_evaluate"]});for(const r in Vo)Vo[r]._classRegistryKey||_t(`Expression_${r}`,Vo[r]);function dc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function qa(r){return r.$name||r.constructor._classRegistryKey}function pc(r){return!function(t){if(t===null||typeof t!="object")return!1;const n=qa(t);return!(!n||n==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||dc(r)||Pi(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Ga(r,t){if(pc(r))return(dc(r)||Pi(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const p=[];for(const m of r)p.push(Ga(m,t));return p}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=qa(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!br[n])throw new Error(`${n} is not registered.`);const{klass:o}=br[n],u=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in r){if(!r.hasOwnProperty(p)||br[n].omit.indexOf(p)>=0)continue;const m=r[p];u[p]=br[n].shallow.indexOf(p)>=0?m:Ga(m,t)}r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function ia(r){if(pc(r))return r;if(Array.isArray(r))return r.map(ia);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=qa(r)||"Object";if(!br[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=br[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const u of Object.keys(r)){if(u==="$name")continue;const p=r[u];o[u]=br[t].shallow.indexOf(u)>=0?p:ia(p)}return o}class fc{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const si={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Hangul Syllables":r=>r>=44032&&r<=55215,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function mc(r){for(const t of r)if(Js(t.charCodeAt(0)))return!0;return!1}function mh(r){for(const t of r)if(!Gd(t.charCodeAt(0)))return!1;return!0}function Ks(r){const t=r.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const qd=Ks(["Arab","Dupl","Mong","Ougr","Syrc"]);function Gd(r){return!qd.test(String.fromCodePoint(r))}const gc=Ks(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Js(r){return!(r!==746&&r!==747&&(r<4352||!(si["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||si["CJK Compatibility"](r)||si["CJK Strokes"](r)||!(!si["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||si["Enclosed CJK Letters and Months"](r)||si["Ideographic Description Characters"](r)||si.Kanbun(r)||si.Katakana(r)&&r!==12540||!(!si["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!si["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||si["Vertical Forms"](r)||si["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||gc.test(String.fromCodePoint(r)))))}function _c(r){return!(Js(r)||function(t){return!!(si["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||si["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||si["Letterlike Symbols"](t)||si["Number Forms"](t)||si["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||si["Control Pictures"](t)&&t!==9251||si["Optical Character Recognition"](t)||si["Enclosed Alphanumerics"](t)||si["Geometric Shapes"](t)||si["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||si["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||si["CJK Symbols and Punctuation"](t)||si.Katakana(t)||si["Private Use Area"](t)||si["CJK Compatibility Forms"](t)||si["Small Form Variants"](t)||si["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const gh=Ks(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Za(r){return gh.test(String.fromCodePoint(r))}function Zd(r,t){return!(!t&&Za(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||si.Khmer(r))}function yc(r){for(const t of r)if(Za(t.charCodeAt(0)))return!0;return!1}const Yr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(Yr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,t){return l(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const n=r.pluginURL,o=new Promise(p=>{this.loadScriptResolve=p});t(n);const u=new Promise(p=>setTimeout(()=>p(),this.TIMEOUT));if(yield Promise.race([o,u]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:n};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)})}};class Li{constructor(t,n){this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new fc,this.transition=n.transition||{},this.globalState=n.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new fc,this.transition={},this.globalState={})}isSupportedScript(t){return function(n,o){for(const u of n)if(!Zd(u.charCodeAt(0),o))return!1;return!0}(t,Yr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Ha{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,u){if(yo(o))return new Ba(o,u);if(Ns(o)){const p=rc(o,u);if(p.result==="error")throw new Error(p.value.map(m=>`${m.key}: ${m.message}`).join(", "));return p.value}{let p=o;return u.type==="color"&&typeof o=="string"?p=oi.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type!=="numberArray"||typeof o!="number"&&!Array.isArray(o)?u.type!=="colorArray"||typeof o!="string"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?p=hi.parse(o):u.type==="projectionDefinition"&&typeof o=="string"&&(p=Wt.parse(o)):p=dn.parse(o):p=In.parse(o):p=rn.parse(o),{globalStateRefs:new Set,kind:"constant",evaluate:()=>p}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Qs{constructor(t){this.property=t,this.value=new Ha(t,void 0)}transitioned(t,n){return new _h(this.property,this.value,n,Ci({},t.transition,this.transition),t.now)}untransitioned(){return new _h(this.property,this.value,null,{},0)}}class vc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return we(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Qs(this._values[t].property)),this._values[t].value=new Ha(this._values[t].property,n===null?void 0:we(n))}getTransition(t){return we(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Qs(this._values[t].property)),this._values[t].transition=we(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new yh(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new yh(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class _h{constructor(t,n,o,u,p){this.property=t,this.value=n,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,p=this.value.possiblyEvaluate(t,n,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return m.possiblyEvaluate(t,n,o);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,n,o),p,st(_))}}return p}}class yh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new el(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Hd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return we(this._values[t].value)}setValue(t,n){this._values[t]=new Ha(this._values[t].property,n===null?void 0:we(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new el(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,n,o);return u}}class xr{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class el{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ct{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=Yn[this.specification.type];return u?u(t,n,o):t}}class Vt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new xr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new xr(this,{kind:"constant",value:void 0},t.parameters);const u=Yn[this.specification.type];if(u){const p=u(t.value.value,n.value.value,o);return new xr(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,n,o,u,p,m){return t.kind==="constant"?t.value:t.evaluate(n,o,u,p,m)}}class tl extends Vt{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new xr(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,u),m=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,_=this._calculate(m,m,m,n);return new xr(this,{kind:"constant",value:_},n)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new xr(this,{kind:"constant",value:p},n)}return new xr(this,t.expression,n)}evaluate(t,n,o,u,p,m){if(t.kind==="source"){const _=t.evaluate(n,o,u,p,m);return this._calculate(_,_,_,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class bc{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,u);return this._calculate(p,p,p,n)}return this._calculate(t.expression.evaluate(new Li(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Li(Math.floor(n.zoom),n)),t.expression.evaluate(new Li(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Wa{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class Bn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Ha(o,void 0),p=this.defaultTransitionablePropertyValues[n]=new Qs(o);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}_t("DataDrivenProperty",Vt),_t("DataConstantProperty",Ct),_t("CrossFadedDataDrivenProperty",tl),_t("CrossFadedProperty",bc),_t("ColorRampProperty",Wa);const vh="-transition";class xn extends z{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Hr(t.filter)),n.layout&&(this._unevaluatedLayout=new Hd(n.layout)),n.paint)){this._transitionablePaint=new vc(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new el(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=Hr(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const u of o.getGlobalStateRefs())t.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}setLayoutProperty(t,n,o={}){n!=null&&this._validate(hc,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(vh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Ud,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(vh))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[t],p=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const v=this._transitionablePaint._values[t].value;return v.isDataDriven()||m||p||this._handleOverridablePaintPropertyUpdate(t,_,v)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Xt(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,u,p={}){return(!p||p.validate!==!1)&&Ua(this,t.call(ea,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:k,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof xr&&Go(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const bh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vo{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Bi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gi(r,t=1){let n=0,o=0;return{members:r.map(u=>{const p=bh[u.type].BYTES_PER_ELEMENT,m=n=xh(n,Math.max(t,p)),_=u.components||1;return o=Math.max(o,p),n+=p*_,{name:u.name,type:u.type,components:_,offset:m}}),size:xh(n,Math.max(o,t)),alignment:t}}function xh(r,t){return Math.ceil(r/t)*t}class Xr extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}Xr.prototype.bytesPerElement=4,_t("StructArrayLayout2i4",Xr);class Kr extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=u,t}}Kr.prototype.bytesPerElement=6,_t("StructArrayLayout3i6",Kr);class xc extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const m=4*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=p,t}}xc.prototype.bytesPerElement=8,_t("StructArrayLayout4i8",xc);class il extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,u,p,m)}emplace(t,n,o,u,p,m,_){const v=6*t;return this.int16[v+0]=n,this.int16[v+1]=o,this.int16[v+2]=u,this.int16[v+3]=p,this.int16[v+4]=m,this.int16[v+5]=_,t}}il.prototype.bytesPerElement=12,_t("StructArrayLayout2i4i12",il);class bo extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,u,p,m)}emplace(t,n,o,u,p,m,_){const v=4*t,w=8*t;return this.int16[v+0]=n,this.int16[v+1]=o,this.uint8[w+4]=u,this.uint8[w+5]=p,this.uint8[w+6]=m,this.uint8[w+7]=_,t}}bo.prototype.bytesPerElement=8,_t("StructArrayLayout2i4ub8",bo);class Ya extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}Ya.prototype.bytesPerElement=8,_t("StructArrayLayout2f8",Ya);class wc extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,_,v,w,T){const P=this.length;return this.resize(P+1),this.emplace(P,t,n,o,u,p,m,_,v,w,T)}emplace(t,n,o,u,p,m,_,v,w,T,P){const D=10*t;return this.uint16[D+0]=n,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=p,this.uint16[D+4]=m,this.uint16[D+5]=_,this.uint16[D+6]=v,this.uint16[D+7]=w,this.uint16[D+8]=T,this.uint16[D+9]=P,t}}wc.prototype.bytesPerElement=20,_t("StructArrayLayout10ui20",wc);class nl extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,_,v,w,T,P,D){const F=this.length;return this.resize(F+1),this.emplace(F,t,n,o,u,p,m,_,v,w,T,P,D)}emplace(t,n,o,u,p,m,_,v,w,T,P,D,F){const B=12*t;return this.int16[B+0]=n,this.int16[B+1]=o,this.int16[B+2]=u,this.int16[B+3]=p,this.uint16[B+4]=m,this.uint16[B+5]=_,this.uint16[B+6]=v,this.uint16[B+7]=w,this.int16[B+8]=T,this.int16[B+9]=P,this.int16[B+10]=D,this.int16[B+11]=F,t}}nl.prototype.bytesPerElement=24,_t("StructArrayLayout4i4ui4i24",nl);class Sc extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,t}}Sc.prototype.bytesPerElement=12,_t("StructArrayLayout3f12",Sc);class h extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}h.prototype.bytesPerElement=4,_t("StructArrayLayout1ul4",h);class e extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,_,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,t,n,o,u,p,m,_,v,w)}emplace(t,n,o,u,p,m,_,v,w,T){const P=10*t,D=5*t;return this.int16[P+0]=n,this.int16[P+1]=o,this.int16[P+2]=u,this.int16[P+3]=p,this.int16[P+4]=m,this.int16[P+5]=_,this.uint32[D+3]=v,this.uint16[P+8]=w,this.uint16[P+9]=T,t}}e.prototype.bytesPerElement=20,_t("StructArrayLayout6i1ul2ui20",e);class i extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,u,p,m)}emplace(t,n,o,u,p,m,_){const v=6*t;return this.int16[v+0]=n,this.int16[v+1]=o,this.int16[v+2]=u,this.int16[v+3]=p,this.int16[v+4]=m,this.int16[v+5]=_,t}}i.prototype.bytesPerElement=12,_t("StructArrayLayout2i2i2i12",i);class a extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,u,p)}emplace(t,n,o,u,p,m){const _=4*t,v=8*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=u,this.int16[v+6]=p,this.int16[v+7]=m,t}}a.prototype.bytesPerElement=16,_t("StructArrayLayout2f1f2i16",a);class c extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,u,p,m)}emplace(t,n,o,u,p,m,_){const v=16*t,w=4*t,T=8*t;return this.uint8[v+0]=n,this.uint8[v+1]=o,this.float32[w+1]=u,this.float32[w+2]=p,this.int16[T+6]=m,this.int16[T+7]=_,t}}c.prototype.bytesPerElement=16,_t("StructArrayLayout2ub2f2i16",c);class d extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=u,t}}d.prototype.bytesPerElement=6,_t("StructArrayLayout3ui6",d);class g extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,_,v,w,T,P,D,F,B,U,W,te){const ye=this.length;return this.resize(ye+1),this.emplace(ye,t,n,o,u,p,m,_,v,w,T,P,D,F,B,U,W,te)}emplace(t,n,o,u,p,m,_,v,w,T,P,D,F,B,U,W,te,ye){const le=24*t,O=12*t,H=48*t;return this.int16[le+0]=n,this.int16[le+1]=o,this.uint16[le+2]=u,this.uint16[le+3]=p,this.uint32[O+2]=m,this.uint32[O+3]=_,this.uint32[O+4]=v,this.uint16[le+10]=w,this.uint16[le+11]=T,this.uint16[le+12]=P,this.float32[O+7]=D,this.float32[O+8]=F,this.uint8[H+36]=B,this.uint8[H+37]=U,this.uint8[H+38]=W,this.uint32[O+10]=te,this.int16[le+22]=ye,t}}g.prototype.bytesPerElement=48,_t("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",g);class y extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,_,v,w,T,P,D,F,B,U,W,te,ye,le,O,H,ce,ze,We,Oe,Fe,it,Je){const ot=this.length;return this.resize(ot+1),this.emplace(ot,t,n,o,u,p,m,_,v,w,T,P,D,F,B,U,W,te,ye,le,O,H,ce,ze,We,Oe,Fe,it,Je)}emplace(t,n,o,u,p,m,_,v,w,T,P,D,F,B,U,W,te,ye,le,O,H,ce,ze,We,Oe,Fe,it,Je,ot){const Ne=32*t,St=16*t;return this.int16[Ne+0]=n,this.int16[Ne+1]=o,this.int16[Ne+2]=u,this.int16[Ne+3]=p,this.int16[Ne+4]=m,this.int16[Ne+5]=_,this.int16[Ne+6]=v,this.int16[Ne+7]=w,this.uint16[Ne+8]=T,this.uint16[Ne+9]=P,this.uint16[Ne+10]=D,this.uint16[Ne+11]=F,this.uint16[Ne+12]=B,this.uint16[Ne+13]=U,this.uint16[Ne+14]=W,this.uint16[Ne+15]=te,this.uint16[Ne+16]=ye,this.uint16[Ne+17]=le,this.uint16[Ne+18]=O,this.uint16[Ne+19]=H,this.uint16[Ne+20]=ce,this.uint16[Ne+21]=ze,this.uint16[Ne+22]=We,this.uint32[St+12]=Oe,this.float32[St+13]=Fe,this.float32[St+14]=it,this.uint16[Ne+30]=Je,this.uint16[Ne+31]=ot,t}}y.prototype.bytesPerElement=64,_t("StructArrayLayout8i15ui1ul2f2ui64",y);class x extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}x.prototype.bytesPerElement=4,_t("StructArrayLayout1f4",x);class C extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.uint16[6*t+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,t}}C.prototype.bytesPerElement=12,_t("StructArrayLayout1ui2f12",C);class M extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=4*t;return this.uint32[2*t+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=u,t}}M.prototype.bytesPerElement=8,_t("StructArrayLayout1ul2ui8",M);class A extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}A.prototype.bytesPerElement=4,_t("StructArrayLayout2ui4",A);class I extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}I.prototype.bytesPerElement=2,_t("StructArrayLayout1ui2",I);class L extends Bi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const m=4*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=p,t}}L.prototype.bytesPerElement=16,_t("StructArrayLayout4f16",L);class $ extends vo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}$.prototype.size=20;class X extends e{get(t){return new $(this,t)}}_t("CollisionBoxArray",X);class Y extends vo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Y.prototype.size=48;class J extends g{get(t){return new Y(this,t)}}_t("PlacedSymbolArray",J);class ie extends vo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ie.prototype.size=64;class se extends y{get(t){return new ie(this,t)}}_t("SymbolInstanceArray",se);class re extends x{getoffsetX(t){return this.float32[1*t+0]}}_t("GlyphOffsetArray",re);class he extends Kr{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}_t("SymbolLineVertexArray",he);class me extends vo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}me.prototype.size=12;class oe extends C{get(t){return new me(this,t)}}_t("TextAnchorOffsetArray",oe);class xe extends vo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}xe.prototype.size=8;class Le extends M{get(t){return new xe(this,t)}}_t("FeatureIndexArray",Le);class ke extends Xr{}class Ie extends Xr{}class Re extends Xr{}class ct extends il{}class lt extends bo{}class Xe extends Ya{}class wt extends wc{}class Jt extends nl{}class vi extends Sc{}class ji extends h{}class xi extends i{}class Ni extends c{}class Mi extends d{}class wi extends A{}const ki=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:wn}=ki;class di{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,o,u){const p=this.segments[this.segments.length-1];return t>di.MAX_VERTEX_ARRAY_LENGTH&&Ot(`Max vertices per segment is ${di.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${di.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+t>di.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u?this.createNewSegment(n,o,u):p}createNewSegment(t,n,o){const u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(t,n,o){return this.prepareSegment(0,t,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new di([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function fn(r,t){return 256*(r=qt(Math.floor(r),0,255))+qt(Math.floor(t),0,255)}di.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t("SegmentVector",di);const Sn=Gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Jr,Qr,eo,wr={exports:{}},Xa={exports:{}},Ka={exports:{}},na=function(){if(eo)return wr.exports;eo=1;var r=(Jr||(Jr=1,Xa.exports=function(n,o){var u,p,m,_,v,w,T,P;for(p=n.length-(u=3&n.length),m=o,v=3432918353,w=461845907,P=0;P<p;)T=255&n.charCodeAt(P)|(255&n.charCodeAt(++P))<<8|(255&n.charCodeAt(++P))<<16|(255&n.charCodeAt(++P))<<24,++P,m=27492+(65535&(_=5*(65535&(m=(m^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(T=0,u){case 3:T^=(255&n.charCodeAt(P+2))<<16;case 2:T^=(255&n.charCodeAt(P+1))<<8;case 1:m^=T=(65535&(T=(T=(65535&(T^=255&n.charCodeAt(P)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return m^=n.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Xa.exports),t=(Qr||(Qr=1,Ka.exports=function(n,o){for(var u,p=n.length,m=o^p,_=0;p>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(_)|(255&n.charCodeAt(++_))<<8|(255&n.charCodeAt(++_))<<16|(255&n.charCodeAt(++_))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++_;switch(p){case 3:m^=(255&n.charCodeAt(_+2))<<16;case 2:m^=(255&n.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&n.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Ka.exports);return wr.exports=r,wr.exports.murmur3=r,wr.exports.murmur2=t,wr.exports}(),Gn=ae(na);class ur{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push(to(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=to(t);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=n?u=m:o=m+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return xo(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new ur;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function to(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Gn(String(r))}function xo(r,t,n,o){for(;n<o;){const u=r[n+o>>1];let p=n-1,m=o+1;for(;;){do p++;while(r[p]<u);do m--;while(r[m]>u);if(p>=m)break;Xi(r,p,m),Xi(t,3*p,3*m),Xi(t,3*p+1,3*m+1),Xi(t,3*p+2,3*m+2)}m-n<o-m?(xo(r,t,n,m),n=m+1):(xo(r,t,m+1,o),o=m)}}function Xi(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}_t("FeaturePositionMap",ur);class Ai{constructor(t,n){this.gl=t.gl,this.location=n}}class jn extends Ai{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ln extends Ai{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class wh extends Ai{constructor(t,n){super(t,n),this.current=oi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Wd=new Float32Array(16);function Cc(r){return[fn(255*r.r,255*r.g),fn(255*r.b,255*r.a)]}class Ja{constructor(t,n,o){this.value=t,this.uniformNames=n.map(u=>`u_${u}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new wh(t,n):new jn(t,n)}}class ra{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,u){const p=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new ln(t,n):new jn(t,n)}}class Lr{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,o,u,p){const m=this.paintVertexArray.length,_=this.expression.evaluate(new Li(0),n,{},u,[],p);this.paintVertexArray.resize(t),this._setPaintValue(m,t,_)}updatePaintArray(t,n,o,u){const p=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(t,n,p)}_setPaintValue(t,n,o){if(this.type==="color"){const u=Cc(o);for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cn{constructor(t,n,o,u,p,m){this.expression=t,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,n,o,u,p){const m=this.expression.evaluate(new Li(this.zoom),n,{},u,[],p),_=this.expression.evaluate(new Li(this.zoom+1),n,{},u,[],p),v=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(v,t,m,_)}updatePaintArray(t,n,o,u){const p=this.expression.evaluate({zoom:this.zoom},o,u),m=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(t,n,p,m)}_setPaintValue(t,n,o,u){if(this.type==="color"){const p=Cc(o),m=Cc(u);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,p[0],p[1],m[0],m[1])}else{for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=qt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new jn(t,n)}}class Rr{constructor(t,n,o,u,p,m){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,u,p){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(t,n,o,u){if(!u||!o)return;const{min:p,mid:m,max:_}=o,v=u[p],w=u[m],T=u[_];if(v&&w&&T)for(let P=t;P<n;P++)this.zoomInPaintVertexArray.emplace(P,w.tl[0],w.tl[1],w.br[0],w.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],w.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,w.tl[0],w.tl[1],w.br[0],w.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],w.pixelRatio,T.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Sn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Sn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Tc{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const p in t.paint._values){if(!o(p))continue;const m=t.paint.get(p);if(!(m instanceof xr&&Go(m.property.specification)))continue;const _=Ec(p,t.type),v=m.value,w=m.property.specification.type,T=m.property.useIntegerZoom,P=m.property.specification["property-type"],D=P==="cross-faded"||P==="cross-faded-data-driven";if(v.kind==="constant")this.binders[p]=D?new ra(v.value,_):new Ja(v.value,_,w),u.push(`/u_${p}`);else if(v.kind==="source"||D){const F=Mc(p,w,"source");this.binders[p]=D?new Rr(v,w,T,n,F,t.id):new Lr(v,_,w,F),u.push(`/a_${p}`)}else{const F=Mc(p,w,"composite");this.binders[p]=new Cn(v,_,w,T,n,F),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Lr||n instanceof Cn?n.maxValue:0}populatePaintArrays(t,n,o,u,p){for(const m in this.binders){const _=this.binders[m];(_ instanceof Lr||_ instanceof Cn||_ instanceof Rr)&&_.populatePaintArray(t,n,o,u,p)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof ra&&u.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,u,p){let m=!1;for(const _ in t){const v=n.getPositions(_);for(const w of v){const T=o.feature(w.index);for(const P in this.binders){const D=this.binders[P];if((D instanceof Lr||D instanceof Cn||D instanceof Rr)&&D.expression.isStateDependent===!0){const F=u.paint.get(P);D.expression=F.value,D.updatePaintArray(w.start,w.end,T,t[_],p),m=!0}}}}return m}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Ja||o instanceof ra)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Lr||o instanceof Cn)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof Rr)for(let u=0;u<Sn.members.length;u++)t.push(Sn.members[u].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ja||o instanceof ra||o instanceof Cn)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Ja||p instanceof ra||p instanceof Cn){for(const m of p.uniformNames)if(n[m]){const _=p.getBinding(t,n[m],m);o.push({name:m,property:u,binding:_})}}}return o}setUniforms(t,n,o,u){for(const{name:p,property:m,binding:_}of n)this.binders[m].setUniform(_,u,o.get(m),p)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Rr){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Lr||o instanceof Cn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Lr||o instanceof Cn||o instanceof Rr)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Lr||n instanceof Cn||n instanceof Rr)&&n.destroy()}}}class io{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Tc(u,n,o);this.needsUpload=!1,this._featureMap=new ur,this._bufferOffset=0}populatePaintArrays(t,n,o,u,p,m){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,n,u,p,m);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,n,p,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ec(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Mc(r,t,n){const o={color:{source:Ya,composite:L},number:{source:x,composite:Ya}},u=function(p){return{"line-pattern":{source:wt,composite:wt},"fill-pattern":{source:wt,composite:wt},"fill-extrusion-pattern":{source:wt,composite:wt}}[p]}(r);return u&&u[n]||o[t][n]}_t("ConstantBinder",Ja),_t("CrossFadedConstantBinder",ra),_t("SourceExpressionBinder",Lr),_t("CrossFadedCompositeBinder",Rr),_t("CompositeExpressionBinder",Cn),_t("ProgramConfiguration",Tc,{omit:["_buffers"]}),_t("ProgramConfigurationSet",io);const Qa=Math.pow(2,14)-1,hm=-Qa-1;function es(r){const t=xt/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let p=0;p<u.length;p++){const m=u[p],_=Math.round(m.x*t),v=Math.round(m.y*t);m.x=qt(_,hm,Qa),m.y=qt(v,hm,Qa),(_<m.x||_>m.x+1||v<m.y||v>m.y+1)&&Ot("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ts(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?es(r):[]}}const dm=-32768;function P1(r,t,n,o,u){r.emplaceBack(dm+8*t+o,dm+8*n+u)}class Yd{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ie,this.indexArray=new Mi,this.segments=new di,this.programConfigurations=new io(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const u=this.layers[0],p=[];let m=null,_=!1,v=u.type==="heatmap";if(u.type==="circle"){const T=u;m=T.layout.get("circle-sort-key"),_=!m.isConstant(),v=v||T.paint.get("circle-pitch-alignment")==="map"}const w=v?n.subdivisionGranularity.circle:1;for(const{feature:T,id:P,index:D,sourceLayerIndex:F}of t){const B=this.layers[0]._featureFilter.needGeometry,U=ts(T,B);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom,{globalState:this.globalState}),U,o))continue;const W=_?m.evaluate(U,{},o):void 0,te={id:P,properties:T.properties,type:T.type,sourceLayerIndex:F,index:D,geometry:B?U.geometry:es(T),patterns:{},sortKey:W};p.push(te)}_&&p.sort((T,P)=>T.sortKey-P.sortKey);for(const T of p){const{geometry:P,index:D,sourceLayerIndex:F}=T,B=t[D].feature;this.addFeature(T,P,D,o,w),n.featureIndex.insert(B,P,D,F,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u,p=1){let m;switch(p){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const _=m.length;for(const v of n)for(const w of v){const T=w.x,P=w.y;if(T<0||T>=xt||P<0||P>=xt)continue;const D=this.segments.prepareSegment(_*_,this.layoutVertexArray,this.indexArray,t.sortKey),F=D.vertexLength;for(let B=0;B<_;B++)for(let U=0;U<_;U++)P1(this.layoutVertexArray,T,P,m[U],m[B]);for(let B=0;B<_-1;B++)for(let U=0;U<_-1;U++){const W=F+B*_+U,te=F+(B+1)*_+U;this.indexArray.emplaceBack(W,te+1,W+1),this.indexArray.emplaceBack(W,te,te+1)}D.vertexLength+=_*_,D.primitiveLength+=(_-1)*(_-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},u)}}function pm(r,t){for(let n=0;n<r.length;n++)if(rl(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(rl(r,t[n]))return!0;return!!Xd(r,t)}function I1(r,t,n){return!!rl(r,t)||!!Kd(t,r,n)}function fm(r,t){if(r.length===1)return gm(t,r[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(rl(r,o[u]))return!0}for(let n=0;n<r.length;n++)if(gm(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Xd(r,t[n]))return!0;return!1}function A1(r,t,n){if(r.length>1){if(Xd(r,t))return!0;for(let o=0;o<t.length;o++)if(Kd(t[o],r,n))return!0}for(let o=0;o<r.length;o++)if(Kd(r[o],t,n))return!0;return!1}function Xd(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],u=r[n+1];for(let p=0;p<t.length-1;p++)if(z1(o,u,t[p],t[p+1]))return!0}return!1}function z1(r,t,n,o){return Et(r,n,o)!==Et(t,n,o)&&Et(r,t,n)!==Et(r,t,o)}function Kd(r,t,n){const o=n*n;if(t.length===1)return r.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(mm(r,t[u-1],t[u])<o)return!0;return!1}function mm(r,t,n){const o=t.distSqr(n);if(o===0)return r.distSqr(t);const u=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/o;return r.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function gm(r,t){let n,o,u,p=!1;for(let m=0;m<r.length;m++){n=r[m];for(let _=0,v=n.length-1;_<n.length;v=_++)o=n[_],u=n[v],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(p=!p)}return p}function rl(r,t){let n=!1;for(let o=0,u=r.length-1;o<r.length;u=o++){const p=r[o],m=r[u];p.y>t.y!=m.y>t.y&&t.x<(m.x-p.x)*(t.y-p.y)/(m.y-p.y)+p.x&&(n=!n)}return n}function D1(r,t,n){const o=n[0],u=n[2];if(r.x<o.x&&t.x<o.x||r.x>u.x&&t.x>u.x||r.y<o.y&&t.y<o.y||r.y>u.y&&t.y>u.y)return!1;const p=Et(r,t,n[0]);return p!==Et(r,t,n[1])||p!==Et(r,t,n[2])||p!==Et(r,t,n[3])}function kc(r,t,n){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(r)}function Sh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Ch(r,t,n,o,u){if(!t[0]&&!t[1])return r;const p=ge.convert(t)._mult(u);n==="viewport"&&p._rotate(-o);const m=[];for(let _=0;_<r.length;_++)m.push(r[_].sub(p));return m}let _m,ym;_t("CircleBucket",Yd,{omit:["layers"]});var L1={get paint(){return ym=ym||new Bn({"circle-radius":new Vt(k.paint_circle["circle-radius"]),"circle-color":new Vt(k.paint_circle["circle-color"]),"circle-blur":new Vt(k.paint_circle["circle-blur"]),"circle-opacity":new Vt(k.paint_circle["circle-opacity"]),"circle-translate":new Ct(k.paint_circle["circle-translate"]),"circle-translate-anchor":new Ct(k.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ct(k.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ct(k.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vt(k.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vt(k.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vt(k.paint_circle["circle-stroke-opacity"])})},get layout(){return _m=_m||new Bn({"circle-sort-key":new Vt(k.layout_circle["circle-sort-key"])})}};class R1 extends xn{constructor(t){super(t,L1)}createBucket(t){return new Yd(t)}queryRadius(t){const n=t;return kc("circle-radius",this,n)+kc("circle-stroke-width",this,n)+Sh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:m,unwrappedTileID:_,getElevation:v}){const w=Ch(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,m),T=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),P=this.paint.get("circle-pitch-alignment")==="map",D=P?w:function(B,U,W,te){return B.map(ye=>vm(ye,U,W,te))}(w,p,_,v),F=P?T*m:T;for(const B of u)for(const U of B){const W=P?U:vm(U,p,_,v);let te=F;const ye=p.projectTileCoordinates(U.x,U.y,_,v).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?te*=ye/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(te*=p.cameraToCenterDistance/ye),I1(D,W,te))return!0}return!1}}function vm(r,t,n,o){const u=t.projectTileCoordinates(r.x,r.y,n,o).point;return new ge((.5*u.x+.5)*t.width,(.5*-u.y+.5)*t.height)}class bm extends Yd{}let xm;_t("HeatmapBucket",bm,{omit:["layers"]});var O1={get paint(){return xm=xm||new Bn({"heatmap-radius":new Vt(k.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vt(k.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ct(k.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wa(k.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ct(k.paint_heatmap["heatmap-opacity"])})}};function Jd(r,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return r.width=t,r.height=n,r.data=u,r}function wm(r,{width:t,height:n},o){if(t===r.width&&n===r.height)return;const u=Jd({},{width:t,height:n},o);Qd(r,u,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},o),r.width=t,r.height=n,r.data=u.data}function Qd(r,t,n,o,u,p){if(u.width===0||u.height===0)return t;if(u.width>r.width||u.height>r.height||n.x>r.width-u.width||n.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=r.data,_=t.data;if(m===_)throw new Error("srcData equals dstData, so image is already copied");for(let v=0;v<u.height;v++){const w=((n.y+v)*r.width+n.x)*p,T=((o.y+v)*t.width+o.x)*p;for(let P=0;P<u.width*p;P++)_[T+P]=m[w+P]}return t}class Pc{constructor(t,n){Jd(this,t,1,n)}resize(t){wm(this,t,1)}clone(){return new Pc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,p){Qd(t,n,o,u,p,1)}}class Xn{constructor(t,n){Jd(this,t,4,n)}resize(t){wm(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Xn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,p){Qd(t,n,o,u,p,4)}setPixel(t,n,o){const u=4*(t*this.width+n);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function Sm(r){const t={},n=r.resolution||256,o=r.clips?r.clips.length:1,u=r.image||new Xn({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(m,_,v)=>{t[r.evaluationKey]=v;const w=r.expression.evaluate(t);u.setPixel(m/4/n,_/4,w)};if(r.clips)for(let m=0,_=0;m<o;++m,_+=4*n)for(let v=0,w=0;v<n;v++,w+=4){const T=v/(n-1),{start:P,end:D}=r.clips[m];p(_,w,P*(1-T)+D*T)}else for(let m=0,_=0;m<n;m++,_+=4)p(0,_,m/(n-1));return u}_t("AlphaImage",Pc),_t("RGBAImage",Xn);const ep="big-fb";class F1 extends xn{createBucket(t){return new bm(t)}constructor(t){super(t,O1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ep)&&this.heatmapFbos.delete(ep)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Cm;var B1={get paint(){return Cm=Cm||new Bn({"hillshade-illumination-direction":new Ct(k.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ct(k.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ct(k.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ct(k.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ct(k.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ct(k.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ct(k.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ct(k.paint_hillshade["hillshade-method"])})}};class j1 extends xn{constructor(t){super(t,B1),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const p=Math.max(t.length,n.length,o.length,u.length);t=t.concat(Array(p-t.length).fill(t.at(-1))),n=n.concat(Array(p-n.length).fill(n.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),u=u.concat(Array(p-u.length).fill(u.at(-1)));const m=n.map(Ti);return{directionRadians:t.map(Ti),altitudeRadians:m,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Tm;var N1={get paint(){return Tm=Tm||new Bn({"color-relief-opacity":new Ct(k["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Wa(k["paint_color-relief"]["color-relief-color"])})}};class tp{constructor(t,n,o,u){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,o){const{width:u,height:p}=t,m=!(this.size&&this.size[0]===u&&this.size[1]===p||o),{context:_}=this,{gl:v}=_;if(this.useMipmap=!!(n&&n.useMipmap),v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!n||n.premultiply!==!1)),m)this.size=[u,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Pi(t)?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,u,p,0,this.format,v.UNSIGNED_BYTE,t.data);else{const{x:w,y:T}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Pi(t)?v.texSubImage2D(v.TEXTURE_2D,0,w,T,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,w,T,u,p,v.RGBA,v.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&v.generateMipmap(v.TEXTURE_2D),_.pixelStoreUnpackFlipY.setDefault(),_.pixelStoreUnpack.setDefault(),_.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Em{constructor(t,n,o,u=1,p=1,m=1,_=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Ot(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const v=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=m,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let w=0;w<v;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(v,w)]=this.data[this._idx(v-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,v)]=this.data[this._idx(w,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let w=0;w<v;w++)for(let T=0;T<v;T++){const P=this.get(w,T);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return Mm(t,this.getUnpackVector())}getPixels(){return new Xn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,p=n*this.dim+this.dim,m=o*this.dim,_=o*this.dim+this.dim;switch(n){case-1:u=p-1;break;case 1:p=u+1}switch(o){case-1:m=_-1;break;case 1:_=m+1}const v=-n*this.dim,w=-o*this.dim;for(let T=m;T<_;T++)for(let P=u;P<p;P++)this.data[this._idx(P,T)]=t.data[this._idx(P+v,T+w)]}}function Mm(r,t){const n=t[0],o=t[1],u=t[2],p=t[3],m=Math.min(n,o,u),_=Math.round((r+p)/m);return{r:Math.floor(_*m/n)%256,g:Math.floor(_*m/o)%256,b:Math.floor(_*m/u)%256}}_t("DEMData",Em);class $1 extends xn{constructor(t){super(t,N1)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Fa&&o._styleExpression.expression instanceof On){this.colorRampExpression=o;const m=o._styleExpression.expression;n.elevationStops=m.labels,n.colorStops=[];for(const _ of n.elevationStops)n.colorStops.push(m.evaluate({globals:{elevation:_}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[oi.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const u={elevationStops:[],colorStops:[]},p=(n.elevationStops.length-1)/(t-1);for(let m=0;m<n.elevationStops.length-.5;m+=p)u.elevationStops.push(n.elevationStops[Math.round(m)]),u.colorStops.push(n.colorStops[Math.round(m)]);return Ot(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),p=new Xn({width:u.colorStops.length,height:1}),m=new Xn({width:u.colorStops.length,height:1});for(let _=0;_<u.elevationStops.length;_++){const v=Mm(u.elevationStops[_],o);m.setPixel(0,_,new oi(v.r/255,v.g/255,v.b/255,1)),p.setPixel(0,_,u.colorStops[_])}return this.colorRampTextures={elevationTexture:new tp(t,m,t.gl.RGBA),colorTexture:new tp(t,p,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const V1=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:U1}=V1;function ip(r,t,n){const o=n.patternDependencies;let u=!1;for(const p of t){const m=p.paint.get(`${r}-pattern`);m.isConstant()||(u=!0);const _=m.constantOr(null);_&&(u=!0,o[_.to]=!0,o[_.from]=!0)}return u}function np(r,t,n,o,u){const p=u.patternDependencies;for(const m of t){const _=m.paint.get(`${r}-pattern`).value;if(_.kind!=="constant"){let v=_.evaluate({zoom:o-1},n,{},u.availableImages),w=_.evaluate({zoom:o},n,{},u.availableImages),T=_.evaluate({zoom:o+1},n,{},u.availableImages);v=v&&v.name?v.name:v,w=w&&w.name?w.name:w,T=T&&T.name?T.name:T,p[v]=!0,p[w]=!0,p[T]=!0,n.patterns[m.id]={min:v,mid:w,max:T}}}return n}function km(r,t,n,o,u){let p;if(u===function(m,_,v,w){let T=0;for(let P=_,D=v-w;P<v;P+=w)T+=(m[D]-m[P])*(m[P+1]+m[D+1]),D=P;return T}(r,t,n,o)>0)for(let m=t;m<n;m+=o)p=zm(m/o|0,r[m],r[m+1],p);else for(let m=n-o;m>=t;m-=o)p=zm(m/o|0,r[m],r[m+1],p);return p&&ol(p,p.next)&&(Dc(p),p=p.next),p}function is(r,t){if(!r)return r;t||(t=r);let n,o=r;do if(n=!1,o.steiner||!ol(o,o.next)&&Qi(o.prev,o,o.next)!==0)o=o.next;else{if(Dc(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Ic(r,t,n,o,u,p,m){if(!r)return;!m&&p&&function(v,w,T,P){let D=v;do D.z===0&&(D.z=rp(D.x,D.y,w,T,P)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==v);D.prevZ.nextZ=null,D.prevZ=null,function(F){let B,U=1;do{let W,te=F;F=null;let ye=null;for(B=0;te;){B++;let le=te,O=0;for(let ce=0;ce<U&&(O++,le=le.nextZ,le);ce++);let H=U;for(;O>0||H>0&&le;)O!==0&&(H===0||!le||te.z<=le.z)?(W=te,te=te.nextZ,O--):(W=le,le=le.nextZ,H--),ye?ye.nextZ=W:F=W,W.prevZ=ye,ye=W;te=le}ye.nextZ=null,U*=2}while(B>1)}(D)}(r,o,u,p);let _=r;for(;r.prev!==r.next;){const v=r.prev,w=r.next;if(p?G1(r,o,u,p):q1(r))t.push(v.i,r.i,w.i),Dc(r),r=w.next,_=w.next;else if((r=w)===_){m?m===1?Ic(r=Z1(is(r),t),t,n,o,u,p,2):m===2&&H1(r,t,n,o,u,p):Ic(is(r),t,n,o,u,p,1);break}}}function q1(r){const t=r.prev,n=r,o=r.next;if(Qi(t,n,o)>=0)return!1;const u=t.x,p=n.x,m=o.x,_=t.y,v=n.y,w=o.y,T=Math.min(u,p,m),P=Math.min(_,v,w),D=Math.max(u,p,m),F=Math.max(_,v,w);let B=o.next;for(;B!==t;){if(B.x>=T&&B.x<=D&&B.y>=P&&B.y<=F&&Ac(u,_,p,v,m,w,B.x,B.y)&&Qi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function G1(r,t,n,o){const u=r.prev,p=r,m=r.next;if(Qi(u,p,m)>=0)return!1;const _=u.x,v=p.x,w=m.x,T=u.y,P=p.y,D=m.y,F=Math.min(_,v,w),B=Math.min(T,P,D),U=Math.max(_,v,w),W=Math.max(T,P,D),te=rp(F,B,t,n,o),ye=rp(U,W,t,n,o);let le=r.prevZ,O=r.nextZ;for(;le&&le.z>=te&&O&&O.z<=ye;){if(le.x>=F&&le.x<=U&&le.y>=B&&le.y<=W&&le!==u&&le!==m&&Ac(_,T,v,P,w,D,le.x,le.y)&&Qi(le.prev,le,le.next)>=0||(le=le.prevZ,O.x>=F&&O.x<=U&&O.y>=B&&O.y<=W&&O!==u&&O!==m&&Ac(_,T,v,P,w,D,O.x,O.y)&&Qi(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;le&&le.z>=te;){if(le.x>=F&&le.x<=U&&le.y>=B&&le.y<=W&&le!==u&&le!==m&&Ac(_,T,v,P,w,D,le.x,le.y)&&Qi(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;O&&O.z<=ye;){if(O.x>=F&&O.x<=U&&O.y>=B&&O.y<=W&&O!==u&&O!==m&&Ac(_,T,v,P,w,D,O.x,O.y)&&Qi(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function Z1(r,t){let n=r;do{const o=n.prev,u=n.next.next;!ol(o,u)&&Im(o,n,n.next,u)&&zc(o,u)&&zc(u,o)&&(t.push(o.i,n.i,u.i),Dc(n),Dc(n.next),n=r=u),n=n.next}while(n!==r);return is(n)}function H1(r,t,n,o,u,p){let m=r;do{let _=m.next.next;for(;_!==m.prev;){if(m.i!==_.i&&J1(m,_)){let v=Am(m,_);return m=is(m,m.next),v=is(v,v.next),Ic(m,t,n,o,u,p,0),void Ic(v,t,n,o,u,p,0)}_=_.next}m=m.next}while(m!==r)}function W1(r,t){let n=r.x-t.x;return n===0&&(n=r.y-t.y,n===0)&&(n=(r.next.y-r.y)/(r.next.x-r.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Y1(r,t){const n=function(u,p){let m=p;const _=u.x,v=u.y;let w,T=-1/0;if(ol(u,m))return m;do{if(ol(u,m.next))return m.next;if(v<=m.y&&v>=m.next.y&&m.next.y!==m.y){const U=m.x+(v-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(U<=_&&U>T&&(T=U,w=m.x<m.next.x?m:m.next,U===_))return w}m=m.next}while(m!==p);if(!w)return null;const P=w,D=w.x,F=w.y;let B=1/0;m=w;do{if(_>=m.x&&m.x>=D&&_!==m.x&&Pm(v<F?_:T,v,D,F,v<F?T:_,v,m.x,m.y)){const U=Math.abs(v-m.y)/(_-m.x);zc(m,u)&&(U<B||U===B&&(m.x>w.x||m.x===w.x&&X1(w,m)))&&(w=m,B=U)}m=m.next}while(m!==P);return w}(r,t);if(!n)return t;const o=Am(n,r);return is(o,o.next),is(n,n.next)}function X1(r,t){return Qi(r.prev,r,t.prev)<0&&Qi(t.next,r,r.next)<0}function rp(r,t,n,o,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function K1(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function Pm(r,t,n,o,u,p,m,_){return(u-m)*(t-_)>=(r-m)*(p-_)&&(r-m)*(o-_)>=(n-m)*(t-_)&&(n-m)*(p-_)>=(u-m)*(o-_)}function Ac(r,t,n,o,u,p,m,_){return!(r===m&&t===_)&&Pm(r,t,n,o,u,p,m,_)}function J1(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&Im(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1}(r,t)&&(zc(r,t)&&zc(t,r)&&function(n,o){let u=n,p=!1;const m=(n.x+o.x)/2,_=(n.y+o.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&m<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==n);return p}(r,t)&&(Qi(r.prev,r,t.prev)||Qi(r,t.prev,t))||ol(r,t)&&Qi(r.prev,r,r.next)>0&&Qi(t.prev,t,t.next)>0)}function Qi(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function ol(r,t){return r.x===t.x&&r.y===t.y}function Im(r,t,n,o){const u=Eh(Qi(r,t,n)),p=Eh(Qi(r,t,o)),m=Eh(Qi(n,o,r)),_=Eh(Qi(n,o,t));return u!==p&&m!==_||!(u!==0||!Th(r,n,t))||!(p!==0||!Th(r,o,t))||!(m!==0||!Th(n,r,o))||!(_!==0||!Th(n,t,o))}function Th(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function Eh(r){return r>0?1:r<0?-1:0}function zc(r,t){return Qi(r.prev,r,r.next)<0?Qi(r,t,r.next)>=0&&Qi(r,r.prev,t)>=0:Qi(r,t,r.prev)<0||Qi(r,r.next,t)<0}function Am(r,t){const n=op(r.i,r.x,r.y),o=op(t.i,t.x,t.y),u=r.next,p=t.prev;return r.next=t,t.prev=r,n.next=u,u.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function zm(r,t,n,o){const u=op(r,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Dc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function op(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class al{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Mh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Mh.noSubdivision=new Mh({fill:new al(0,0),line:new al(0,0),tile:new al(0,0),stencil:new al(0,0),circle:1}),_t("SubdivisionGranularityExpression",al),_t("SubdivisionGranularitySetting",Mh);const sl=-32768,Lc=32767;class Q1{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=xt/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),u=0|Math.round(n),p=this._getKey(o,u);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,m),this._vertexBuffer.push(o,u),m}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(u,p){const m=[];for(let _=0;_<p.length;_+=3){const v=p[_],w=p[_+1],T=p[_+2],P=u[2*v],D=u[2*v+1];(u[2*w]-P)*(u[2*T+1]-D)-(u[2*w+1]-D)*(u[2*T]-P)>0?(m.push(v),m.push(T),m.push(w)):(m.push(v),m.push(w),m.push(T))}return m}(this._vertexBuffer,t);const n=[],o=t.length;for(let u=0;u<o;u+=3){const p=[t[u+0],t[u+1],t[u+2]],m=[this._vertexBuffer[2*t[u+0]+0],this._vertexBuffer[2*t[u+0]+1],this._vertexBuffer[2*t[u+1]+0],this._vertexBuffer[2*t[u+1]+1],this._vertexBuffer[2*t[u+2]+0],this._vertexBuffer[2*t[u+2]+1]];let _=1/0,v=1/0,w=-1/0,T=-1/0;for(let U=0;U<3;U++){const W=m[2*U],te=m[2*U+1];_=Math.min(_,W),w=Math.max(w,W),v=Math.min(v,te),T=Math.max(T,te)}if(_===w||v===T)continue;const P=Math.floor(_/this._granularityCellSize),D=Math.ceil(w/this._granularityCellSize),F=Math.floor(v/this._granularityCellSize),B=Math.ceil(T/this._granularityCellSize);if(P!==D||F!==B)for(let U=F;U<B;U++){const W=this._scanlineGenerateVertexRingForCellRow(U,m,p);ey(this._vertexBuffer,W,n)}else n.push(...p)}return n}_scanlineGenerateVertexRingForCellRow(t,n,o){const u=t*this._granularityCellSize,p=u+this._granularityCellSize,m=[];for(let _=0;_<3;_++){const v=n[2*_],w=n[2*_+1],T=n[2*(_+1)%6],P=n[(2*(_+1)+1)%6],D=n[2*(_+2)%6],F=n[(2*(_+2)+1)%6],B=T-v,U=P-w,W=B===0,te=U===0,ye=(u-w)/U,le=(p-w)/U,O=Math.min(ye,le),H=Math.max(ye,le);if(!te&&(O>=1||H<=0)||te&&(w<u||w>p)){P>=u&&P<=p&&m.push(o[(_+1)%3]);continue}!te&&O>0&&m.push(this._vertexToIndex(v+B*O,w+U*O));const ce=v+B*Math.max(O,0),ze=v+B*Math.min(H,1);W||this._generateIntraEdgeVertices(m,v,w,T,P,ce,ze),!te&&H<1&&m.push(this._vertexToIndex(v+B*H,w+U*H)),(te||P>=u&&P<=p)&&m.push(o[(_+1)%3]),!te&&(P<=u||P>=p)&&this._generateInterEdgeVertices(m,v,w,T,P,D,F,ze,u,p)}return m}_generateIntraEdgeVertices(t,n,o,u,p,m,_){const v=u-n,w=p-o,T=w===0,P=T?Math.min(n,u):Math.min(m,_),D=T?Math.max(n,u):Math.max(m,_),F=Math.floor(P/this._granularityCellSize)+1,B=Math.ceil(D/this._granularityCellSize)-1;if(T?n<u:m<_)for(let U=F;U<=B;U++){const W=U*this._granularityCellSize;t.push(this._vertexToIndex(W,o+w*(W-n)/v))}else for(let U=B;U>=F;U--){const W=U*this._granularityCellSize;t.push(this._vertexToIndex(W,o+w*(W-n)/v))}}_generateInterEdgeVertices(t,n,o,u,p,m,_,v,w,T){const P=p-o,D=m-u,F=_-p,B=(w-p)/F,U=(T-p)/F,W=Math.min(B,U),te=Math.max(B,U),ye=u+D*W;let le=Math.floor(Math.min(ye,v)/this._granularityCellSize)+1,O=Math.ceil(Math.max(ye,v)/this._granularityCellSize)-1,H=v<ye;const ce=F===0;if(ce&&(_===w||_===T))return;if(ce||W>=1||te<=0){const We=o-_,Oe=m+(n-m)*Math.min((w-_)/We,(T-_)/We);le=Math.floor(Math.min(Oe,v)/this._granularityCellSize)+1,O=Math.ceil(Math.max(Oe,v)/this._granularityCellSize)-1,H=v<Oe}const ze=P>0?T:w;if(H)for(let We=le;We<=O;We++)t.push(this._vertexToIndex(We*this._granularityCellSize,ze));else for(let We=O;We>=le;We--)t.push(this._vertexToIndex(We*this._granularityCellSize,ze))}_generateOutline(t){const n=[];for(const o of t){const u=ns(o,this._granularity,!0),p=this._pointArrayToIndices(u),m=[];for(let _=1;_<p.length;_++)m.push(p[_-1]),m.push(p[_]);n.push(m)}return n}_handlePoles(t){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(t,n,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const o=t[n+1];o===sl&&(t[n+1]=-32767),o===Lc&&(t[n+1]=32766)}}_generatePoleQuad(t,n,o,u,p,m){u>p!=(m===sl)?(t.push(n),t.push(o),t.push(this._vertexToIndex(u,m)),t.push(o),t.push(this._vertexToIndex(p,m)),t.push(this._vertexToIndex(u,m))):(t.push(o),t.push(n),t.push(this._vertexToIndex(u,m)),t.push(this._vertexToIndex(p,m)),t.push(o),t.push(this._vertexToIndex(u,m)))}_fillPoles(t,n,o){const u=this._vertexBuffer,p=xt,m=t.length;for(let _=2;_<m;_+=3){const v=t[_-2],w=t[_-1],T=t[_],P=u[2*v],D=u[2*v+1],F=u[2*w],B=u[2*w+1],U=u[2*T],W=u[2*T+1];n&&(D===0&&B===0&&this._generatePoleQuad(t,v,w,P,F,sl),B===0&&W===0&&this._generatePoleQuad(t,w,T,F,U,sl),W===0&&D===0&&this._generatePoleQuad(t,T,v,U,P,sl)),o&&(D===p&&B===p&&this._generatePoleQuad(t,v,w,P,F,Lc),B===p&&W===p&&this._generatePoleQuad(t,w,T,F,U,Lc),W===p&&D===p&&this._generatePoleQuad(t,T,v,U,P,Lc))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=function(_){const v=[],w=[];for(const T of _)if(T.length!==0){T!==_[0]&&v.push(w.length/2);for(let P=0;P<T.length;P++)w.push(T[P].x),w.push(T[P].y)}return{flattened:w,holeIndices:v}}(t);let p;this._initializeVertices(o);try{const _=function(w,T,P=2){const D=T&&T.length,F=D?T[0]*P:w.length;let B=km(w,0,F,P,!0);const U=[];if(!B||B.next===B.prev)return U;let W,te,ye;if(D&&(B=function(le,O,H,ce){const ze=[];for(let We=0,Oe=O.length;We<Oe;We++){const Fe=km(le,O[We]*ce,We<Oe-1?O[We+1]*ce:le.length,ce,!1);Fe===Fe.next&&(Fe.steiner=!0),ze.push(K1(Fe))}ze.sort(W1);for(let We=0;We<ze.length;We++)H=Y1(ze[We],H);return H}(w,T,B,P)),w.length>80*P){W=1/0,te=1/0;let le=-1/0,O=-1/0;for(let H=P;H<F;H+=P){const ce=w[H],ze=w[H+1];ce<W&&(W=ce),ze<te&&(te=ze),ce>le&&(le=ce),ze>O&&(O=ze)}ye=Math.max(le-W,O-te),ye=ye!==0?32767/ye:0}return Ic(B,U,P,W,te,ye,0),U}(o,u),v=this._convertIndices(o,_);p=this._subdivideTrianglesScanline(v)}catch(_){console.error(_)}let m=[];return n&&(m=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:m}}_convertIndices(t,n){const o=[];for(let u=0;u<n.length;u++)o.push(this._vertexToIndex(t[2*n[u]],t[2*n[u]+1]));return o}_pointArrayToIndices(t){const n=[];for(let o=0;o<t.length;o++){const u=t[o];n.push(this._vertexToIndex(u.x,u.y))}return n}}function Dm(r,t,n,o=!0){return new Q1(n,t).subdividePolygonInternal(r,o)}function ns(r,t,n=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const o=r[0],u=r[r.length-1],p=n&&(o.x!==u.x||o.y!==u.y);if(t<2)return p?[...r,r[0]]:[...r];const m=Math.floor(xt/t),_=[];_.push(new ge(r[0].x,r[0].y));const v=r.length,w=p?v:v-1;for(let T=0;T<w;T++){const P=r[T],D=T<v-1?r[T+1]:r[0],F=P.x,B=P.y,U=D.x,W=D.y,te=F!==U,ye=B!==W;if(!te&&!ye)continue;const le=U-F,O=W-B,H=Math.abs(le),ce=Math.abs(O);let ze=F,We=B;for(;;){const Fe=le>0?(Math.floor(ze/m)+1)*m:(Math.ceil(ze/m)-1)*m,it=O>0?(Math.floor(We/m)+1)*m:(Math.ceil(We/m)-1)*m,Je=Math.abs(ze-Fe),ot=Math.abs(We-it),Ne=Math.abs(ze-U),St=Math.abs(We-W),Nt=te?Je/H:Number.POSITIVE_INFINITY,Ft=ye?ot/ce:Number.POSITIVE_INFINITY;if((Ne<=Je||!te)&&(St<=ot||!ye))break;if(Nt<Ft&&te||!ye){ze=Fe,We+=O*Nt;const kt=new ge(ze,Math.round(We));_[_.length-1].x===kt.x&&_[_.length-1].y===kt.y||_.push(kt)}else{ze+=le*Ft,We=it;const kt=new ge(Math.round(ze),We);_[_.length-1].x===kt.x&&_[_.length-1].y===kt.y||_.push(kt)}}const Oe=new ge(U,W);_[_.length-1].x===Oe.x&&_[_.length-1].y===Oe.y||_.push(Oe)}return _}function ey(r,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=r[2*t[0]];for(let v=1;v<t.length;v++){const w=r[2*t[v]];w<u&&(u=w,o=v)}const p=t.length;let m=o,_=(m+1)%p;for(;;){const v=m-1>=0?m-1:p-1,w=(_+1)%p,T=r[2*t[v]],P=r[2*t[w]],D=r[2*t[m]],F=r[2*t[m]+1],B=r[2*t[_]+1];let U=!1;if(T<P)U=!0;else if(T>P)U=!1;else{const W=B-F,te=-(r[2*t[_]]-D),ye=F<B?1:-1;((T-D)*W+(r[2*t[v]+1]-F)*te)*ye>((P-D)*W+(r[2*t[w]+1]-F)*te)*ye&&(U=!0)}if(U){const W=t[v],te=t[m],ye=t[_];W!==te&&W!==ye&&te!==ye&&n.push(ye,te,W),m--,m<0&&(m=p-1)}else{const W=t[w],te=t[m],ye=t[_];W!==te&&W!==ye&&te!==ye&&n.push(ye,te,W),_++,_>=p&&(_=0)}if(v===w)break}}function Lm(r,t,n,o,u,p,m,_,v){const w=u.length/2,T=m&&_&&v;if(w<di.MAX_VERTEX_ARRAY_LENGTH){const P=t.prepareSegment(w,n,o),D=P.vertexLength;for(let U=0;U<p.length;U+=3)o.emplaceBack(D+p[U],D+p[U+1],D+p[U+2]);let F,B;P.vertexLength+=w,P.primitiveLength+=p.length/3,T&&(B=m.prepareSegment(w,n,_),F=B.vertexLength,B.vertexLength+=w);for(let U=0;U<u.length;U+=2)r(u[U],u[U+1]);if(T)for(let U=0;U<v.length;U++){const W=v[U];for(let te=1;te<W.length;te+=2)_.emplaceBack(F+W[te-1],F+W[te]);B.primitiveLength+=W.length/2}}else(function(P,D,F,B,U,W){const te=[];for(let ce=0;ce<B.length/2;ce++)te.push(-1);const ye={count:0};let le=0,O=P.getOrCreateLatestSegment(D,F),H=O.vertexLength;for(let ce=2;ce<U.length;ce+=3){const ze=U[ce-2],We=U[ce-1],Oe=U[ce];let Fe=te[ze]<le,it=te[We]<le,Je=te[Oe]<le;O.vertexLength+((Fe?1:0)+(it?1:0)+(Je?1:0))>di.MAX_VERTEX_ARRAY_LENGTH&&(O=P.createNewSegment(D,F),le=ye.count,Fe=!0,it=!0,Je=!0,H=0);const ot=Rc(te,B,W,ye,ze,Fe,O),Ne=Rc(te,B,W,ye,We,it,O),St=Rc(te,B,W,ye,Oe,Je,O);F.emplaceBack(H+ot-le,H+Ne-le,H+St-le),O.primitiveLength++}})(t,n,o,u,p,r),T&&function(P,D,F,B,U,W){const te=[];for(let ce=0;ce<B.length/2;ce++)te.push(-1);const ye={count:0};let le=0,O=P.getOrCreateLatestSegment(D,F),H=O.vertexLength;for(let ce=0;ce<U.length;ce++){const ze=U[ce];for(let We=1;We<U[ce].length;We+=2){const Oe=ze[We-1],Fe=ze[We];let it=te[Oe]<le,Je=te[Fe]<le;O.vertexLength+((it?1:0)+(Je?1:0))>di.MAX_VERTEX_ARRAY_LENGTH&&(O=P.createNewSegment(D,F),le=ye.count,it=!0,Je=!0,H=0);const ot=Rc(te,B,W,ye,Oe,it,O),Ne=Rc(te,B,W,ye,Fe,Je,O);F.emplaceBack(H+ot-le,H+Ne-le),O.primitiveLength++}}}(m,n,_,u,v,r),t.forceNewSegmentOnNextPrepare(),m==null||m.forceNewSegmentOnNextPrepare()}function Rc(r,t,n,o,u,p,m){if(p){const _=o.count;return n(t[2*u],t[2*u+1]),r[u]=o.count,o.count++,m.vertexLength++,_}return r[u]}class ap{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Re,this.indexArray=new Mi,this.indexArray2=new wi,this.programConfigurations=new io(t.layers,t.zoom),this.segments=new di,this.segments2=new di,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=ip("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),m=[];for(const{feature:_,id:v,index:w,sourceLayerIndex:T}of t){const P=this.layers[0]._featureFilter.needGeometry,D=ts(_,P);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom,{globalState:this.globalState}),D,o))continue;const F=p?u.evaluate(D,{},o,n.availableImages):void 0,B={id:v,properties:_.properties,type:_.type,sourceLayerIndex:T,index:w,geometry:P?D.geometry:es(_),patterns:{},sortKey:F};m.push(B)}p&&m.sort((_,v)=>_.sortKey-v.sortKey);for(const _ of m){const{geometry:v,index:w,sourceLayerIndex:T}=_;if(this.hasPattern){const P=np("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(_,v,w,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[w].feature,v,w,T,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,U1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,p,m){for(const _ of zs(n,500)){const v=Dm(_,u,m.fill.getGranularityForZoomLevel(u.z)),w=this.layoutVertexArray;Lm((T,P)=>{w.emplaceBack(T,P)},this.segments,this.layoutVertexArray,this.indexArray,v.verticesFlattened,v.indicesTriangles,this.segments2,this.indexArray2,v.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}}let Rm,Om;_t("FillBucket",ap,{omit:["layers","patternFeatures"]});var ty={get paint(){return Om=Om||new Bn({"fill-antialias":new Ct(k.paint_fill["fill-antialias"]),"fill-opacity":new Vt(k.paint_fill["fill-opacity"]),"fill-color":new Vt(k.paint_fill["fill-color"]),"fill-outline-color":new Vt(k.paint_fill["fill-outline-color"]),"fill-translate":new Ct(k.paint_fill["fill-translate"]),"fill-translate-anchor":new Ct(k.paint_fill["fill-translate-anchor"]),"fill-pattern":new tl(k.paint_fill["fill-pattern"])})},get layout(){return Rm=Rm||new Bn({"fill-sort-key":new Vt(k.layout_fill["fill-sort-key"])})}};class iy extends xn{constructor(t){super(t,ty)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ap(t)}queryRadius(){return Sh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:o,pixelsToTileUnits:u}){return fm(Ch(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),n)}isTileClipped(){return!0}}const ny=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ry=Gi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:oy}=ny;var sp,Fm,lp,Bm,cp,jm,Nm,kh={};function $m(){if(Fm)return sp;Fm=1;var r=Pe();function t(u,p,m,_,v){this.properties={},this.extent=m,this.type=0,this._pbf=u,this._geometry=-1,this._keys=_,this._values=v,u.readFields(n,this,p)}function n(u,p,m){u==1?p.id=m.readVarint():u==2?function(_,v){for(var w=_.readVarint()+_.pos;_.pos<w;){var T=v._keys[_.readVarint()],P=v._values[_.readVarint()];v.properties[T]=P}}(m,p):u==3?p.type=m.readVarint():u==4&&(p._geometry=m.pos)}function o(u){for(var p,m,_=0,v=0,w=u.length,T=w-1;v<w;T=v++)_+=((m=u[T]).x-(p=u[v]).x)*(p.y+m.y);return _}return sp=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var p,m=u.readVarint()+u.pos,_=1,v=0,w=0,T=0,P=[];u.pos<m;){if(v<=0){var D=u.readVarint();_=7&D,v=D>>3}if(v--,_===1||_===2)w+=u.readSVarint(),T+=u.readSVarint(),_===1&&(p&&P.push(p),p=[]),p.push(new r(w,T));else{if(_!==7)throw new Error("unknown command "+_);p&&p.push(p[0].clone())}}return p&&P.push(p),P},t.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var p=u.readVarint()+u.pos,m=1,_=0,v=0,w=0,T=1/0,P=-1/0,D=1/0,F=-1/0;u.pos<p;){if(_<=0){var B=u.readVarint();m=7&B,_=B>>3}if(_--,m===1||m===2)(v+=u.readSVarint())<T&&(T=v),v>P&&(P=v),(w+=u.readSVarint())<D&&(D=w),w>F&&(F=w);else if(m!==7)throw new Error("unknown command "+m)}return[T,D,P,F]},t.prototype.toGeoJSON=function(u,p,m){var _,v,w=this.extent*Math.pow(2,m),T=this.extent*u,P=this.extent*p,D=this.loadGeometry(),F=t.types[this.type];function B(te){for(var ye=0;ye<te.length;ye++){var le=te[ye];te[ye]=[360*(le.x+T)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(le.y+P)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(_=0;_<D.length;_++)U[_]=D[_][0];B(D=U);break;case 2:for(_=0;_<D.length;_++)B(D[_]);break;case 3:for(D=function(te){var ye=te.length;if(ye<=1)return[te];for(var le,O,H=[],ce=0;ce<ye;ce++){var ze=o(te[ce]);ze!==0&&(O===void 0&&(O=ze<0),O===ze<0?(le&&H.push(le),le=[te[ce]]):le.push(te[ce]))}return le&&H.push(le),H}(D),_=0;_<D.length;_++)for(v=0;v<D[_].length;v++)B(D[_][v])}D.length===1?D=D[0]:F="Multi"+F;var W={type:"Feature",geometry:{type:F,coordinates:D},properties:this.properties};return"id"in this&&(W.id=this.id),W},sp}function Vm(){if(Bm)return lp;Bm=1;var r=$m();function t(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(n,this,u),this.length=this._features.length}function n(o,u,p){o===15?u.version=p.readVarint():o===1?u.name=p.readString():o===5?u.extent=p.readVarint():o===2?u._features.push(p.pos):o===3?u._keys.push(p.readString()):o===4&&u._values.push(function(m){for(var _=null,v=m.readVarint()+m.pos;m.pos<v;){var w=m.readVarint()>>3;_=w===1?m.readString():w===2?m.readFloat():w===3?m.readDouble():w===4?m.readVarint64():w===5?m.readVarint():w===6?m.readSVarint():w===7?m.readBoolean():null}return _}(p))}return lp=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,u,this.extent,this._keys,this._values)},lp}function Um(){return Nm||(Nm=1,kh.VectorTile=function(){if(jm)return cp;jm=1;var r=Vm();function t(n,o,u){if(n===3){var p=new r(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}return cp=function(n,o){this.layers=n.readFields(t,{},o)},cp}(),kh.VectorTileFeature=$m(),kh.VectorTileLayer=Vm()),kh}var Oc=ae(Um());const ay=Oc.VectorTileFeature.types,up=Math.pow(2,13);function Fc(r,t,n,o,u,p,m,_){r.emplaceBack(t,n,2*Math.floor(o*up)+m,u*up*2,p*up*2,Math.round(_))}class hp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ct,this.centroidVertexArray=new ke,this.indexArray=new Mi,this.programConfigurations=new io(t.layers,t.zoom),this.segments=new di,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=ip("fill-extrusion",this.layers,n);for(const{feature:u,id:p,index:m,sourceLayerIndex:_}of t){const v=this.layers[0]._featureFilter.needGeometry,w=ts(u,v);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom,{globalState:this.globalState}),w,o))continue;const T={id:p,sourceLayerIndex:_,index:m,geometry:v?w.geometry:es(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(np("fill-extrusion",this.layers,T,this.zoom,n)):this.addFeature(T,T.geometry,m,o,{},n.subdivisionGranularity),n.featureIndex.insert(u,T.geometry,m,_,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,n,o,t.subdivisionGranularity)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oy),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ry.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,p,m){for(const _ of zs(n,500)){const v={x:0,y:0,sampleCount:0},w=this.layoutVertexArray.length;this.processPolygon(v,u,t,_,m);const T=this.layoutVertexArray.length-w,P=Math.floor(v.x/v.sampleCount),D=Math.floor(v.y/v.sampleCount);for(let F=0;F<T;F++)this.centroidVertexArray.emplaceBack(P,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}processPolygon(t,n,o,u,p){if(u.length<1||qm(u[0]))return;for(const P of u)P.length!==0&&sy(t,P);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},_=p.fill.getGranularityForZoomLevel(n.z),v=ay[o.type]==="Polygon";for(const P of u){if(P.length===0||qm(P))continue;const D=ns(P,_,v);this._generateSideFaces(D,m)}if(!v)return;const w=Dm(u,n,_,!1),T=this.layoutVertexArray;Lm((P,D)=>{Fc(T,P,D,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles)}_generateSideFaces(t,n){let o=0;for(let u=1;u<t.length;u++){const p=t[u],m=t[u-1];if(ly(p,m))continue;n.segment.vertexLength+4>di.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _=p.sub(m)._perp()._unit(),v=m.dist(p);o+v>32768&&(o=0),Fc(this.layoutVertexArray,p.x,p.y,_.x,_.y,0,0,o),Fc(this.layoutVertexArray,p.x,p.y,_.x,_.y,0,1,o),o+=v,Fc(this.layoutVertexArray,m.x,m.y,_.x,_.y,0,0,o),Fc(this.layoutVertexArray,m.x,m.y,_.x,_.y,0,1,o);const w=n.segment.vertexLength;this.indexArray.emplaceBack(w,w+2,w+1),this.indexArray.emplaceBack(w+1,w+2,w+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function sy(r,t){for(let n=0;n<t.length;n++){const o=t[n];n===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(r.x+=o.x,r.y+=o.y,r.sampleCount++)}}function ly(r,t){return r.x===t.x&&(r.x<0||r.x>xt)||r.y===t.y&&(r.y<0||r.y>xt)}function qm(r){return r.every(t=>t.x<0)||r.every(t=>t.x>xt)||r.every(t=>t.y<0)||r.every(t=>t.y>xt)}let Gm;_t("FillExtrusionBucket",hp,{omit:["layers","features"]});var cy={get paint(){return Gm=Gm||new Bn({"fill-extrusion-opacity":new Ct(k["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vt(k["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ct(k["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ct(k["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new tl(k["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Vt(k["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vt(k["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ct(k["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class uy extends xn{constructor(t){super(t,cy)}createBucket(t){return new hp(t)}queryRadius(){return Sh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:m,pixelPosMatrix:_}){const v=Ch(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,m),w=this.paint.get("fill-extrusion-height").evaluate(n,o),T=this.paint.get("fill-extrusion-base").evaluate(n,o),P=function(F,B){const U=[];for(const W of F){const te=[W.x,W.y,0,1];Zt(te,te,B),U.push(new ge(te[0]/te[3],te[1]/te[3]))}return U}(v,_),D=function(F,B,U,W){const te=[],ye=[],le=W[8]*B,O=W[9]*B,H=W[10]*B,ce=W[11]*B,ze=W[8]*U,We=W[9]*U,Oe=W[10]*U,Fe=W[11]*U;for(const it of F){const Je=[],ot=[];for(const Ne of it){const St=Ne.x,Nt=Ne.y,Ft=W[0]*St+W[4]*Nt+W[12],kt=W[1]*St+W[5]*Nt+W[13],li=W[2]*St+W[6]*Nt+W[14],Zi=W[3]*St+W[7]*Nt+W[15],cn=li+H,zn=Zi+ce,dr=Ft+ze,Kn=kt+We,Tn=li+Oe,$i=Zi+Fe,gn=new ge((Ft+le)/zn,(kt+O)/zn);gn.z=cn/zn,Je.push(gn);const En=new ge(dr/$i,Kn/$i);En.z=Tn/$i,ot.push(En)}te.push(Je),ye.push(ot)}return[te,ye]}(u,T,w,_);return function(F,B,U){let W=1/0;fm(U,B)&&(W=Zm(U,B[0]));for(let te=0;te<B.length;te++){const ye=B[te],le=F[te];for(let O=0;O<ye.length-1;O++){const H=ye[O],ce=[H,ye[O+1],le[O+1],le[O],H];pm(U,ce)&&(W=Math.min(W,Zm(U,ce)))}}return W!==1/0&&W}(D[0],D[1],P)}}function Bc(r,t){return r.x*t.x+r.y*t.y}function Zm(r,t){if(r.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const p=t[n],m=r[0],_=u.sub(o),v=p.sub(o),w=m.sub(o),T=Bc(_,_),P=Bc(_,v),D=Bc(v,v),F=Bc(w,_),B=Bc(w,v),U=T*D-P*P,W=(D*F-P*B)/U,te=(T*B-P*F)/U,ye=o.z*(1-W-te)+u.z*W+p.z*te;if(isFinite(ye))return ye}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const hy=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:dy}=hy,py=Gi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:fy}=py,my=Oc.VectorTileFeature.types,gy=Math.cos(Math.PI/180*37.5),Hm=Math.pow(2,14)/.5;class dp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new lt,this.layoutVertexArray2=new Xe,this.indexArray=new Mi,this.programConfigurations=new io(t.layers,t.zoom),this.segments=new di,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=ip("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),m=[];for(const{feature:_,id:v,index:w,sourceLayerIndex:T}of t){const P=this.layers[0]._featureFilter.needGeometry,D=ts(_,P);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom,{globalState:this.globalState}),D,o))continue;const F=p?u.evaluate(D,{},o):void 0,B={id:v,properties:_.properties,type:_.type,sourceLayerIndex:T,index:w,geometry:P?D.geometry:es(_),patterns:{},sortKey:F};m.push(B)}p&&m.sort((_,v)=>_.sortKey-v.sortKey);for(const _ of m){const{geometry:v,index:w,sourceLayerIndex:T}=_;if(this.hasPattern){const P=np("line",this.layers,_,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(_,v,w,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[w].feature,v,w,T,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,fy)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dy),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,p,m){const _=this.layers[0].layout,v=_.get("line-join").evaluate(t,{}),w=_.get("line-cap"),T=_.get("line-miter-limit"),P=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const D of n)this.addLine(D,t,v,w,T,P,u,m);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}addLine(t,n,o,u,p,m,_,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=ns(t,_?v.line.getGranularityForZoomLevel(_.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<t.length-1;le++)this.totalDistance+=t[le].dist(t[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=my[n.type]==="Polygon";let T=t.length;for(;T>=2&&t[T-1].equals(t[T-2]);)T--;let P=0;for(;P<T-1&&t[P].equals(t[P+1]);)P++;if(T<(w?3:2))return;o==="bevel"&&(p=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let B,U,W,te,ye;this.e1=this.e2=-1,w&&(B=t[T-2],ye=t[P].sub(B)._unit()._perp());for(let le=P;le<T;le++){if(W=le===T-1?w?t[P+1]:void 0:t[le+1],W&&t[le].equals(W))continue;ye&&(te=ye),B&&(U=B),B=t[le],ye=W?W.sub(B)._unit()._perp():te,te=te||ye;let O=te.add(ye);O.x===0&&O.y===0||O._unit();const H=te.x*ye.x+te.y*ye.y,ce=O.x*ye.x+O.y*ye.y,ze=ce!==0?1/ce:1/0,We=2*Math.sqrt(2-2*ce),Oe=ce<gy&&U&&W,Fe=te.x*ye.y-te.y*ye.x>0;if(Oe&&le>P){const ot=B.dist(U);if(ot>2*D){const Ne=B.sub(B.sub(U)._mult(D/ot)._round());this.updateDistance(U,Ne),this.addCurrentVertex(Ne,te,0,0,F),U=Ne}}const it=U&&W;let Je=it?o:w?"butt":u;if(it&&Je==="round"&&(ze<m?Je="miter":ze<=2&&(Je="fakeround")),Je==="miter"&&ze>p&&(Je="bevel"),Je==="bevel"&&(ze>2&&(Je="flipbevel"),ze<p&&(Je="miter")),U&&this.updateDistance(U,B),Je==="miter")O._mult(ze),this.addCurrentVertex(B,O,0,0,F);else if(Je==="flipbevel"){if(ze>100)O=ye.mult(-1);else{const ot=ze*te.add(ye).mag()/te.sub(ye).mag();O._perp()._mult(ot*(Fe?-1:1))}this.addCurrentVertex(B,O,0,0,F),this.addCurrentVertex(B,O.mult(-1),0,0,F)}else if(Je==="bevel"||Je==="fakeround"){const ot=-Math.sqrt(ze*ze-1),Ne=Fe?ot:0,St=Fe?0:ot;if(U&&this.addCurrentVertex(B,te,Ne,St,F),Je==="fakeround"){const Nt=Math.round(180*We/Math.PI/20);for(let Ft=1;Ft<Nt;Ft++){let kt=Ft/Nt;if(kt!==.5){const Zi=kt-.5;kt+=kt*Zi*(kt-1)*((1.0904+H*(H*(3.55645-1.43519*H)-3.2452))*Zi*Zi+(.848013+H*(.215638*H-1.06021)))}const li=ye.sub(te)._mult(kt)._add(te)._unit()._mult(Fe?-1:1);this.addHalfVertex(B,li.x,li.y,!1,Fe,0,F)}}W&&this.addCurrentVertex(B,ye,-Ne,-St,F)}else if(Je==="butt")this.addCurrentVertex(B,O,0,0,F);else if(Je==="square"){const ot=U?1:-1;this.addCurrentVertex(B,O,ot,ot,F)}else Je==="round"&&(U&&(this.addCurrentVertex(B,te,0,0,F),this.addCurrentVertex(B,te,1,1,F,!0)),W&&(this.addCurrentVertex(B,ye,-1,-1,F,!0),this.addCurrentVertex(B,ye,0,0,F)));if(Oe&&le<T-1){const ot=B.dist(W);if(ot>2*D){const Ne=B.add(W.sub(B)._mult(D/ot)._round());this.updateDistance(B,Ne),this.addCurrentVertex(Ne,ye,0,0,F),B=Ne}}}}addCurrentVertex(t,n,o,u,p,m=!1){const _=n.y*u-n.x,v=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,m,!1,o,p),this.addHalfVertex(t,_,v,m,!0,-u,p),this.distance>Hm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,u,p,m))}addHalfVertex({x:t,y:n},o,u,p,m,_,v){const w=.5*(this.lineClips?this.scaledDistance*(Hm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(n<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const T=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,T,this.e2),v.primitiveLength++),m?this.e2=T:this.e1=T}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let Wm,Ym;_t("LineBucket",dp,{omit:["layers","patternFeatures"]});var Xm={get paint(){return Ym=Ym||new Bn({"line-opacity":new Vt(k.paint_line["line-opacity"]),"line-color":new Vt(k.paint_line["line-color"]),"line-translate":new Ct(k.paint_line["line-translate"]),"line-translate-anchor":new Ct(k.paint_line["line-translate-anchor"]),"line-width":new Vt(k.paint_line["line-width"]),"line-gap-width":new Vt(k.paint_line["line-gap-width"]),"line-offset":new Vt(k.paint_line["line-offset"]),"line-blur":new Vt(k.paint_line["line-blur"]),"line-dasharray":new bc(k.paint_line["line-dasharray"]),"line-pattern":new tl(k.paint_line["line-pattern"]),"line-gradient":new Wa(k.paint_line["line-gradient"])})},get layout(){return Wm=Wm||new Bn({"line-cap":new Ct(k.layout_line["line-cap"]),"line-join":new Vt(k.layout_line["line-join"]),"line-miter-limit":new Ct(k.layout_line["line-miter-limit"]),"line-round-limit":new Ct(k.layout_line["line-round-limit"]),"line-sort-key":new Vt(k.layout_line["line-sort-key"])})}};class _y extends Vt{possiblyEvaluate(t,n){return n=new Li(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,u){return n=Ci({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,u)}}let Ph;class yy extends xn{constructor(t){super(t,Xm),this.gradientVersion=0,Ph||(Ph=new _y(Xm.paint.properties["line-width"].specification),Ph.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Fo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Ph.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new dp(t)}queryRadius(t){const n=t,o=Km(kc("line-width",this,n),kc("line-gap-width",this,n)),u=kc("line-offset",this,n);return o/2+Math.abs(u)+Sh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:m}){const _=Ch(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,m),v=m/2*Km(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),w=this.paint.get("line-offset").evaluate(n,o);return w&&(u=function(T,P){const D=[];for(let F=0;F<T.length;F++){const B=T[F],U=[];for(let W=0;W<B.length;W++){const te=B[W-1],ye=B[W],le=B[W+1],O=W===0?new ge(0,0):ye.sub(te)._unit()._perp(),H=W===B.length-1?new ge(0,0):le.sub(ye)._unit()._perp(),ce=O._add(H)._unit(),ze=ce.x*H.x+ce.y*H.y;ze!==0&&ce._mult(1/ze),U.push(ce._mult(P)._add(ye))}D.push(U)}return D}(u,w*m)),function(T,P,D){for(let F=0;F<P.length;F++){const B=P[F];if(T.length>=3){for(let U=0;U<B.length;U++)if(rl(T,B[U]))return!0}if(A1(T,B,D))return!0}return!1}(_,u,v)}isTileClipped(){return!0}}function Km(r,t){return t>0?t+2*r:r}const vy=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),by=Gi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xy=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jm=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wy=Gi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Sy(r,t,n){return r.sections.forEach(o=>{o.text=function(u,p,m){const _=p.layout.get("text-transform").evaluate(m,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),Yr.applyArabicShaping&&(u=Yr.applyArabicShaping(u)),u}(o.text,t,n)}),r}Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const jc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Qm,pp,eg,mn=24,fp={};function Cy(){return Qm||(Qm=1,fp.read=function(r,t,n,o,u){var p,m,_=8*u-o-1,v=(1<<_)-1,w=v>>1,T=-7,P=n?u-1:0,D=n?-1:1,F=r[t+P];for(P+=D,p=F&(1<<-T)-1,F>>=-T,T+=_;T>0;p=256*p+r[t+P],P+=D,T-=8);for(m=p&(1<<-T)-1,p>>=-T,T+=o;T>0;m=256*m+r[t+P],P+=D,T-=8);if(p===0)p=1-w;else{if(p===v)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,o),p-=w}return(F?-1:1)*m*Math.pow(2,p-o)},fp.write=function(r,t,n,o,u,p){var m,_,v,w=8*p-u-1,T=(1<<w)-1,P=T>>1,D=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=o?0:p-1,B=o?1:-1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,m=T):(m=Math.floor(Math.log(t)/Math.LN2),t*(v=Math.pow(2,-m))<1&&(m--,v*=2),(t+=m+P>=1?D/v:D*Math.pow(2,1-P))*v>=2&&(m++,v/=2),m+P>=T?(_=0,m=T):m+P>=1?(_=(t*v-1)*Math.pow(2,u),m+=P):(_=t*Math.pow(2,P-1)*Math.pow(2,u),m=0));u>=8;r[n+F]=255&_,F+=B,_/=256,u-=8);for(m=m<<u|_,w+=u;w>0;r[n+F]=255&m,F+=B,m/=256,w-=8);r[n+F-B]|=128*U}),fp}function tg(){if(eg)return pp;eg=1,pp=t;var r=Cy();function t(O){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(O)?O:new Uint8Array(O||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=4294967296,o=1/n,u=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function p(O){return O.type===t.Bytes?O.readVarint()+O.pos:O.pos+1}function m(O,H,ce){return ce?4294967296*H+(O>>>0):4294967296*(H>>>0)+(O>>>0)}function _(O,H,ce){var ze=H<=16383?1:H<=2097151?2:H<=268435455?3:Math.floor(Math.log(H)/(7*Math.LN2));ce.realloc(ze);for(var We=ce.pos-1;We>=O;We--)ce.buf[We+ze]=ce.buf[We]}function v(O,H){for(var ce=0;ce<O.length;ce++)H.writeVarint(O[ce])}function w(O,H){for(var ce=0;ce<O.length;ce++)H.writeSVarint(O[ce])}function T(O,H){for(var ce=0;ce<O.length;ce++)H.writeFloat(O[ce])}function P(O,H){for(var ce=0;ce<O.length;ce++)H.writeDouble(O[ce])}function D(O,H){for(var ce=0;ce<O.length;ce++)H.writeBoolean(O[ce])}function F(O,H){for(var ce=0;ce<O.length;ce++)H.writeFixed32(O[ce])}function B(O,H){for(var ce=0;ce<O.length;ce++)H.writeSFixed32(O[ce])}function U(O,H){for(var ce=0;ce<O.length;ce++)H.writeFixed64(O[ce])}function W(O,H){for(var ce=0;ce<O.length;ce++)H.writeSFixed64(O[ce])}function te(O,H){return(O[H]|O[H+1]<<8|O[H+2]<<16)+16777216*O[H+3]}function ye(O,H,ce){O[ce]=H,O[ce+1]=H>>>8,O[ce+2]=H>>>16,O[ce+3]=H>>>24}function le(O,H){return(O[H]|O[H+1]<<8|O[H+2]<<16)+(O[H+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(O,H,ce){for(ce=ce||this.length;this.pos<ce;){var ze=this.readVarint(),We=ze>>3,Oe=this.pos;this.type=7&ze,O(We,H,this),this.pos===Oe&&this.skip(ze)}return H},readMessage:function(O,H){return this.readFields(O,H,this.readVarint()+this.pos)},readFixed32:function(){var O=te(this.buf,this.pos);return this.pos+=4,O},readSFixed32:function(){var O=le(this.buf,this.pos);return this.pos+=4,O},readFixed64:function(){var O=te(this.buf,this.pos)+te(this.buf,this.pos+4)*n;return this.pos+=8,O},readSFixed64:function(){var O=te(this.buf,this.pos)+le(this.buf,this.pos+4)*n;return this.pos+=8,O},readFloat:function(){var O=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,O},readDouble:function(){var O=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,O},readVarint:function(O){var H,ce,ze=this.buf;return H=127&(ce=ze[this.pos++]),ce<128?H:(H|=(127&(ce=ze[this.pos++]))<<7,ce<128?H:(H|=(127&(ce=ze[this.pos++]))<<14,ce<128?H:(H|=(127&(ce=ze[this.pos++]))<<21,ce<128?H:function(We,Oe,Fe){var it,Je,ot=Fe.buf;if(it=(112&(Je=ot[Fe.pos++]))>>4,Je<128||(it|=(127&(Je=ot[Fe.pos++]))<<3,Je<128)||(it|=(127&(Je=ot[Fe.pos++]))<<10,Je<128)||(it|=(127&(Je=ot[Fe.pos++]))<<17,Je<128)||(it|=(127&(Je=ot[Fe.pos++]))<<24,Je<128)||(it|=(1&(Je=ot[Fe.pos++]))<<31,Je<128))return m(We,it,Oe);throw new Error("Expected varint not more than 10 bytes")}(H|=(15&(ce=ze[this.pos]))<<28,O,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var O=this.readVarint();return O%2==1?(O+1)/-2:O/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var O=this.readVarint()+this.pos,H=this.pos;return this.pos=O,O-H>=12&&u?function(ce,ze,We){return u.decode(ce.subarray(ze,We))}(this.buf,H,O):function(ce,ze,We){for(var Oe="",Fe=ze;Fe<We;){var it,Je,ot,Ne=ce[Fe],St=null,Nt=Ne>239?4:Ne>223?3:Ne>191?2:1;if(Fe+Nt>We)break;Nt===1?Ne<128&&(St=Ne):Nt===2?(192&(it=ce[Fe+1]))==128&&(St=(31&Ne)<<6|63&it)<=127&&(St=null):Nt===3?(Je=ce[Fe+2],(192&(it=ce[Fe+1]))==128&&(192&Je)==128&&((St=(15&Ne)<<12|(63&it)<<6|63&Je)<=2047||St>=55296&&St<=57343)&&(St=null)):Nt===4&&(Je=ce[Fe+2],ot=ce[Fe+3],(192&(it=ce[Fe+1]))==128&&(192&Je)==128&&(192&ot)==128&&((St=(15&Ne)<<18|(63&it)<<12|(63&Je)<<6|63&ot)<=65535||St>=1114112)&&(St=null)),St===null?(St=65533,Nt=1):St>65535&&(St-=65536,Oe+=String.fromCharCode(St>>>10&1023|55296),St=56320|1023&St),Oe+=String.fromCharCode(St),Fe+=Nt}return Oe}(this.buf,H,O)},readBytes:function(){var O=this.readVarint()+this.pos,H=this.buf.subarray(this.pos,O);return this.pos=O,H},readPackedVarint:function(O,H){if(this.type!==t.Bytes)return O.push(this.readVarint(H));var ce=p(this);for(O=O||[];this.pos<ce;)O.push(this.readVarint(H));return O},readPackedSVarint:function(O){if(this.type!==t.Bytes)return O.push(this.readSVarint());var H=p(this);for(O=O||[];this.pos<H;)O.push(this.readSVarint());return O},readPackedBoolean:function(O){if(this.type!==t.Bytes)return O.push(this.readBoolean());var H=p(this);for(O=O||[];this.pos<H;)O.push(this.readBoolean());return O},readPackedFloat:function(O){if(this.type!==t.Bytes)return O.push(this.readFloat());var H=p(this);for(O=O||[];this.pos<H;)O.push(this.readFloat());return O},readPackedDouble:function(O){if(this.type!==t.Bytes)return O.push(this.readDouble());var H=p(this);for(O=O||[];this.pos<H;)O.push(this.readDouble());return O},readPackedFixed32:function(O){if(this.type!==t.Bytes)return O.push(this.readFixed32());var H=p(this);for(O=O||[];this.pos<H;)O.push(this.readFixed32());return O},readPackedSFixed32:function(O){if(this.type!==t.Bytes)return O.push(this.readSFixed32());var H=p(this);for(O=O||[];this.pos<H;)O.push(this.readSFixed32());return O},readPackedFixed64:function(O){if(this.type!==t.Bytes)return O.push(this.readFixed64());var H=p(this);for(O=O||[];this.pos<H;)O.push(this.readFixed64());return O},readPackedSFixed64:function(O){if(this.type!==t.Bytes)return O.push(this.readSFixed64());var H=p(this);for(O=O||[];this.pos<H;)O.push(this.readSFixed64());return O},skip:function(O){var H=7&O;if(H===t.Varint)for(;this.buf[this.pos++]>127;);else if(H===t.Bytes)this.pos=this.readVarint()+this.pos;else if(H===t.Fixed32)this.pos+=4;else{if(H!==t.Fixed64)throw new Error("Unimplemented type: "+H);this.pos+=8}},writeTag:function(O,H){this.writeVarint(O<<3|H)},realloc:function(O){for(var H=this.length||16;H<this.pos+O;)H*=2;if(H!==this.length){var ce=new Uint8Array(H);ce.set(this.buf),this.buf=ce,this.length=H}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(O){this.realloc(4),ye(this.buf,O,this.pos),this.pos+=4},writeSFixed32:function(O){this.realloc(4),ye(this.buf,O,this.pos),this.pos+=4},writeFixed64:function(O){this.realloc(8),ye(this.buf,-1&O,this.pos),ye(this.buf,Math.floor(O*o),this.pos+4),this.pos+=8},writeSFixed64:function(O){this.realloc(8),ye(this.buf,-1&O,this.pos),ye(this.buf,Math.floor(O*o),this.pos+4),this.pos+=8},writeVarint:function(O){(O=+O||0)>268435455||O<0?function(H,ce){var ze,We;if(H>=0?(ze=H%4294967296|0,We=H/4294967296|0):(We=~(-H/4294967296),4294967295^(ze=~(-H%4294967296))?ze=ze+1|0:(ze=0,We=We+1|0)),H>=18446744073709552e3||H<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ce.realloc(10),function(Oe,Fe,it){it.buf[it.pos++]=127&Oe|128,Oe>>>=7,it.buf[it.pos++]=127&Oe|128,Oe>>>=7,it.buf[it.pos++]=127&Oe|128,Oe>>>=7,it.buf[it.pos++]=127&Oe|128,it.buf[it.pos]=127&(Oe>>>=7)}(ze,0,ce),function(Oe,Fe){var it=(7&Oe)<<4;Fe.buf[Fe.pos++]|=it|((Oe>>>=3)?128:0),Oe&&(Fe.buf[Fe.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Fe.buf[Fe.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Fe.buf[Fe.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Fe.buf[Fe.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Fe.buf[Fe.pos++]=127&Oe)))))}(We,ce)}(O,this):(this.realloc(4),this.buf[this.pos++]=127&O|(O>127?128:0),O<=127||(this.buf[this.pos++]=127&(O>>>=7)|(O>127?128:0),O<=127||(this.buf[this.pos++]=127&(O>>>=7)|(O>127?128:0),O<=127||(this.buf[this.pos++]=O>>>7&127))))},writeSVarint:function(O){this.writeVarint(O<0?2*-O-1:2*O)},writeBoolean:function(O){this.writeVarint(!!O)},writeString:function(O){O=String(O),this.realloc(4*O.length),this.pos++;var H=this.pos;this.pos=function(ze,We,Oe){for(var Fe,it,Je=0;Je<We.length;Je++){if((Fe=We.charCodeAt(Je))>55295&&Fe<57344){if(!it){Fe>56319||Je+1===We.length?(ze[Oe++]=239,ze[Oe++]=191,ze[Oe++]=189):it=Fe;continue}if(Fe<56320){ze[Oe++]=239,ze[Oe++]=191,ze[Oe++]=189,it=Fe;continue}Fe=it-55296<<10|Fe-56320|65536,it=null}else it&&(ze[Oe++]=239,ze[Oe++]=191,ze[Oe++]=189,it=null);Fe<128?ze[Oe++]=Fe:(Fe<2048?ze[Oe++]=Fe>>6|192:(Fe<65536?ze[Oe++]=Fe>>12|224:(ze[Oe++]=Fe>>18|240,ze[Oe++]=Fe>>12&63|128),ze[Oe++]=Fe>>6&63|128),ze[Oe++]=63&Fe|128)}return Oe}(this.buf,O,this.pos);var ce=this.pos-H;ce>=128&&_(H,ce,this),this.pos=H-1,this.writeVarint(ce),this.pos+=ce},writeFloat:function(O){this.realloc(4),r.write(this.buf,O,this.pos,!0,23,4),this.pos+=4},writeDouble:function(O){this.realloc(8),r.write(this.buf,O,this.pos,!0,52,8),this.pos+=8},writeBytes:function(O){var H=O.length;this.writeVarint(H),this.realloc(H);for(var ce=0;ce<H;ce++)this.buf[this.pos++]=O[ce]},writeRawMessage:function(O,H){this.pos++;var ce=this.pos;O(H,this);var ze=this.pos-ce;ze>=128&&_(ce,ze,this),this.pos=ce-1,this.writeVarint(ze),this.pos+=ze},writeMessage:function(O,H,ce){this.writeTag(O,t.Bytes),this.writeRawMessage(H,ce)},writePackedVarint:function(O,H){H.length&&this.writeMessage(O,v,H)},writePackedSVarint:function(O,H){H.length&&this.writeMessage(O,w,H)},writePackedBoolean:function(O,H){H.length&&this.writeMessage(O,D,H)},writePackedFloat:function(O,H){H.length&&this.writeMessage(O,T,H)},writePackedDouble:function(O,H){H.length&&this.writeMessage(O,P,H)},writePackedFixed32:function(O,H){H.length&&this.writeMessage(O,F,H)},writePackedSFixed32:function(O,H){H.length&&this.writeMessage(O,B,H)},writePackedFixed64:function(O,H){H.length&&this.writeMessage(O,U,H)},writePackedSFixed64:function(O,H){H.length&&this.writeMessage(O,W,H)},writeBytesField:function(O,H){this.writeTag(O,t.Bytes),this.writeBytes(H)},writeFixed32Field:function(O,H){this.writeTag(O,t.Fixed32),this.writeFixed32(H)},writeSFixed32Field:function(O,H){this.writeTag(O,t.Fixed32),this.writeSFixed32(H)},writeFixed64Field:function(O,H){this.writeTag(O,t.Fixed64),this.writeFixed64(H)},writeSFixed64Field:function(O,H){this.writeTag(O,t.Fixed64),this.writeSFixed64(H)},writeVarintField:function(O,H){this.writeTag(O,t.Varint),this.writeVarint(H)},writeSVarintField:function(O,H){this.writeTag(O,t.Varint),this.writeSVarint(H)},writeStringField:function(O,H){this.writeTag(O,t.Bytes),this.writeString(H)},writeFloatField:function(O,H){this.writeTag(O,t.Fixed32),this.writeFloat(H)},writeDoubleField:function(O,H){this.writeTag(O,t.Fixed64),this.writeDouble(H)},writeBooleanField:function(O,H){this.writeVarintField(O,!!H)}},pp}var oa,mp=ae(tg());function Ty(r,t,n){r===1&&n.readMessage(Ey,t)}function Ey(r,t,n){if(r===3){const{id:o,bitmap:u,width:p,height:m,left:_,top:v,advance:w}=n.readMessage(My,{});t.push({id:o,bitmap:new Pc({width:p+6,height:m+6},u),metrics:{width:p,height:m,left:_,top:v,advance:w}})}}function My(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}function ig(r){let t=0,n=0;for(const m of r)t+=m.w*m.h,n=Math.max(n,m.w);r.sort((m,_)=>_.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,p=0;for(const m of r)for(let _=o.length-1;_>=0;_--){const v=o[_];if(!(m.w>v.w||m.h>v.h)){if(m.x=v.x,m.y=v.y,p=Math.max(p,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===v.w&&m.h===v.h){const w=o.pop();_<o.length&&(o[_]=w)}else m.h===v.h?(v.x+=m.w,v.w-=m.w):m.w===v.w?(v.y+=m.h,v.h-=m.h):(o.push({x:v.x+m.w,y:v.y,w:v.w-m.w,h:m.h}),v.y+=m.h,v.h-=m.h);break}}return{w:u,h:p,fill:t/(u*p)||0}}class gp{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:p,content:m,textFitWidth:_,textFitHeight:v}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=p,this.content=m,this.version=o,this.textFitWidth=_,this.textFitHeight=v}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ng{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,o,p),this.addImages(n,u,p);const{w:m,h:_}=ig(p),v=new Xn({width:m||1,height:_||1});for(const w in t){const T=t[w],P=o[w].paddedRect;Xn.copy(T.data,v,{x:0,y:0},{x:P.x+1,y:P.y+1},T.data)}for(const w in n){const T=n[w],P=u[w].paddedRect,D=P.x+1,F=P.y+1,B=T.data.width,U=T.data.height;Xn.copy(T.data,v,{x:0,y:0},{x:D,y:F},T.data),Xn.copy(T.data,v,{x:0,y:U-1},{x:D,y:F-1},{width:B,height:1}),Xn.copy(T.data,v,{x:0,y:0},{x:D,y:F+U},{width:B,height:1}),Xn.copy(T.data,v,{x:B-1,y:0},{x:D-1,y:F},{width:1,height:U}),Xn.copy(T.data,v,{x:0,y:0},{x:D+B,y:F},{width:1,height:U})}this.image=v,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const p=t[u],m={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(m),n[u]=new gp(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,p]=t.tl;o.update(n.data,void 0,{x:u,y:p})}}_t("ImagePosition",gp),_t("ImageAtlas",ng),S.an=void 0,(oa=S.an||(S.an={}))[oa.none=0]="none",oa[oa.horizontal=1]="horizontal",oa[oa.vertical=2]="vertical",oa[oa.horizontalOnly=3]="horizontalOnly";class Nc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,o){const u=new Nc;return u.scale=t||1,u.fontStack=n,u.verticalAlign=o||"bottom",u}static forImage(t,n){const o=new Nc;return o.imageName=t,o.verticalAlign=n||"bottom",o}}class ll{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new ll;for(let u=0;u<t.sections.length;u++){const p=t.sections[u];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,p=t.charCodeAt(o-1)||null;n+=u&&_c(u)&&!jc[t[o+1]]||p&&_c(p)&&!jc[t[o-1]]||!jc[t[o]]?t[o]:jc[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Ah[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Ah[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new ll;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}getMaxImageSize(t){let n=0,o=0;for(let u=0;u<this.length();u++){const p=this.getSection(u);if(p.imageName){const m=t[p.imageName];if(!m)continue;const _=m.displaySize;n=Math.max(n,_[0]),o=Math.max(o,_[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(t,n){this.text+=t.text,this.sections.push(Nc.forText(t.scale,t.fontStack||n,t.verticalAlign));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Ot("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Nc.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ih(r,t,n,o,u,p,m,_,v,w,T,P,D,F,B){const U=ll.fromFeature(r,u);let W;P===S.an.vertical&&U.verticalizePunctuation();const{processBidirectionalText:te,processStyledBidirectionalText:ye}=Yr;if(te&&U.sections.length===1){W=[];const H=te(U.toString(),_p(U,w,p,t,o,F));for(const ce of H){const ze=new ll;ze.text=ce,ze.sections=U.sections;for(let We=0;We<ce.length;We++)ze.sectionIndex.push(0);W.push(ze)}}else if(ye){W=[];const H=ye(U.text,U.sectionIndex,_p(U,w,p,t,o,F));for(const ce of H){const ze=new ll;ze.text=ce[0],ze.sectionIndex=ce[1],ze.sections=U.sections,W.push(ze)}}else W=function(H,ce){const ze=[],We=H.text;let Oe=0;for(const Fe of ce)ze.push(H.substring(Oe,Fe)),Oe=Fe;return Oe<We.length&&ze.push(H.substring(Oe,We.length)),ze}(U,_p(U,w,p,t,o,F));const le=[],O={positionedLines:le,text:U.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(H,ce,ze,We,Oe,Fe,it,Je,ot,Ne,St,Nt){let Ft=0,kt=0,li=0,Zi=0;const cn=Je==="right"?1:Je==="left"?0:.5,zn=mn/Nt;let dr=0;for(const $i of Oe){$i.trim();const gn=$i.getMaxScale(),En={positionedGlyphs:[],lineOffset:0};H.positionedLines[dr]=En;const Mn=En.positionedGlyphs;let Zn=0;if(!$i.length()){kt+=Fe,++dr;continue}const pr=Ay(We,$i,zn);for(let Jn=0;Jn<$i.length();Jn++){const un=$i.getSection(Jn),yn=$i.getSectionIndex(Jn),vn=$i.getCharCode(Jn),an=zy(ot,St,vn);let zi;if(un.imageName){if(H.iconsInText=!0,un.scale=un.scale*zn,zi=Ly(un,an,gn,pr,We),!zi)continue;Zn=Math.max(Zn,zi.imageOffset)}else if(zi=Dy(un,vn,an,pr,ce,ze),!zi)continue;const{rect:Or,metrics:dl,baselineOffset:Fr}=zi;Mn.push({glyph:vn,imageName:un.imageName,x:Ft,y:kt+Fr+-17,vertical:an,scale:un.scale,fontStack:un.fontStack,sectionIndex:yn,metrics:dl,rect:Or}),an?(H.verticalizable=!0,Ft+=(un.imageName?dl.advance:mn)*un.scale+Ne):Ft+=dl.advance*un.scale+Ne}Mn.length!==0&&(li=Math.max(Ft-Ne,li),Ry(Mn,0,Mn.length-1,cn)),Ft=0,En.lineOffset=Math.max(Zn,(gn-1)*mn);const _n=Fe*gn+Zn;kt+=_n,Zi=Math.max(_n,Zi),++dr}const{horizontalAlign:Kn,verticalAlign:Tn}=yp(it);(function($i,gn,En,Mn,Zn,pr,_n,Jn,un){const yn=(gn-En)*Zn;let vn=0;vn=pr!==_n?-Jn*Mn- -17:-Mn*un*_n+.5*_n;for(const an of $i)for(const zi of an.positionedGlyphs)zi.x+=yn,zi.y+=vn})(H.positionedLines,cn,Kn,Tn,li,Zi,Fe,kt,Oe.length),H.top+=-Tn*kt,H.bottom=H.top+kt,H.left+=-Kn*li,H.right=H.left+li}(O,t,n,o,W,m,_,v,P,w,D,B),!function(H){for(const ce of H)if(ce.positionedGlyphs.length!==0)return!1;return!0}(le)&&O}const Ah={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ky={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Py={40:!0};function rg(r,t,n,o,u,p){if(t.imageName){const m=o[t.imageName];return m?m.displaySize[0]*t.scale*mn/p+u:0}{const m=n[t.fontStack],_=m&&m[r];return _?_.metrics.advance*t.scale+u:0}}function og(r,t,n,o){const u=Math.pow(r-t,2);return o?r<t?u/2:2*u:u+Math.abs(n)*n}function Iy(r,t,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function ag(r,t,n,o,u,p){let m=null,_=og(t,n,u,p);for(const v of o){const w=og(t-v.x,n,u,p)+v.badness;w<=_&&(m=v,_=w)}return{index:r,x:t,priorBreak:m,badness:_}}function sg(r){return r?sg(r.priorBreak).concat(r.index):[]}function _p(r,t,n,o,u,p){if(!r)return[];const m=[],_=function(P,D,F,B,U,W){let te=0;for(let ye=0;ye<P.length();ye++){const le=P.getSection(ye);te+=rg(P.getCharCode(ye),le,B,U,D,W)}return te/Math.max(1,Math.ceil(te/F))}(r,t,n,o,u,p),v=r.text.indexOf("")>=0;let w=0;for(let P=0;P<r.length();P++){const D=r.getSection(P),F=r.getCharCode(P);if(Ah[F]||(w+=rg(F,D,o,u,t,p)),P<r.length()-1){const B=!((T=F)<11904)&&(!!si["CJK Compatibility Forms"](T)||!!si["CJK Compatibility"](T)||!!si["CJK Strokes"](T)||!!si["CJK Symbols and Punctuation"](T)||!!si["Enclosed CJK Letters and Months"](T)||!!si["Halfwidth and Fullwidth Forms"](T)||!!si["Ideographic Description Characters"](T)||!!si["Vertical Forms"](T)||gc.test(String.fromCodePoint(T)));(ky[F]||B||D.imageName||P!==r.length()-2&&Py[r.getCharCode(P+1)])&&m.push(ag(P+1,w,_,m,Iy(F,r.getCharCode(P+1),B&&v),!1))}}var T;return sg(ag(r.length(),w,_,m,0,!0))}function yp(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Ay(r,t,n){const o=t.getMaxScale()*mn,{maxImageWidth:u,maxImageHeight:p}=t.getMaxImageSize(r),m=Math.max(o,p*n);return{verticalLineContentWidth:Math.max(o,u*n),horizontalLineContentHeight:m}}function lg(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function zy(r,t,n){return!(r===S.an.horizontal||!t&&!Js(n)||t&&(Ah[n]||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Dy(r,t,n,o,u,p){const m=p[r.fontStack],_=function(w,T,P,D){if(w&&w.rect)return w;const F=T[P.fontStack],B=F&&F[D];return B?{rect:null,metrics:B.metrics}:null}(m&&m[t],u,r,t);if(_===null)return null;let v;if(n)v=o.verticalLineContentWidth-r.scale*mn;else{const w=lg(r.verticalAlign);v=(o.horizontalLineContentHeight-r.scale*mn)*w}return{rect:_.rect,metrics:_.metrics,baselineOffset:v}}function Ly(r,t,n,o,u){const p=u[r.imageName];if(!p)return null;const m=p.paddedRect,_=p.displaySize,v={width:_[0],height:_[1],left:1,top:-3,advance:t?_[1]:_[0]};let w;if(t)w=o.verticalLineContentWidth-_[1]*r.scale;else{const T=lg(r.verticalAlign);w=(o.horizontalLineContentHeight-_[1]*r.scale)*T}return{rect:m,metrics:v,baselineOffset:w,imageOffset:(t?_[0]:_[1])*r.scale-mn*n}}function Ry(r,t,n,o){if(o===0)return;const u=r[n],p=(r[n].x+u.metrics.advance*u.scale)*o;for(let m=t;m<=n;m++)r[m].x-=p}function Oy(r,t,n){const{horizontalAlign:o,verticalAlign:u}=yp(n),p=t[0]-r.displaySize[0]*o,m=t[1]-r.displaySize[1]*u;return{image:r,top:m,bottom:m+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function cg(r){var t,n;let o=r.left,u=r.top,p=r.right-o,m=r.bottom-u;const _=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",v=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",w=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(v==="proportional"){if(_==="stretchOnly"&&p/m<w||_==="proportional"){const T=Math.ceil(m*w);o*=T/p,p=T}}else if(_==="proportional"&&v==="stretchOnly"&&w!==0&&p/m>w){const T=Math.ceil(p/w);u*=T/m,m=T}return{x1:o,y1:u,x2:o+p,y2:u+m}}function ug(r,t,n,o,u,p){const m=r.image;let _;if(m.content){const W=m.content,te=m.pixelRatio||1;_=[W[0]/te,W[1]/te,m.displaySize[0]-W[2]/te,m.displaySize[1]-W[3]/te]}const v=t.left*p,w=t.right*p;let T,P,D,F;n==="width"||n==="both"?(F=u[0]+v-o[3],P=u[0]+w+o[1]):(F=u[0]+(v+w-m.displaySize[0])/2,P=F+m.displaySize[0]);const B=t.top*p,U=t.bottom*p;return n==="height"||n==="both"?(T=u[1]+B-o[0],D=u[1]+U+o[2]):(T=u[1]+(B+U-m.displaySize[1])/2,D=T+m.displaySize[1]),{image:m,top:T,right:P,bottom:D,left:F,collisionPadding:_}}const wo=128,aa=32640;function hg(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Li(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let p=0;for(;p<o.length&&o[p]<=r;)p++;p=Math.max(0,p-1);let m=p;for(;m<o.length&&o[m]<r+1;)m++;m=Math.min(o.length-1,m);const _=o[p],v=o[m];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:v,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:v,minSize:n.evaluate(new Li(_)),maxSize:n.evaluate(new Li(v)),interpolationType:u}}}function vp(r,t,n){let o="never";const u=r.get(t);return u?o=u:r.get(n)&&(o="always"),o}const Fy=Oc.VectorTileFeature.types,By=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zh(r,t,n,o,u,p,m,_,v,w,T,P,D){const F=_?Math.min(aa,Math.round(_[0])):0,B=_?Math.min(aa,Math.round(_[1])):0;r.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),p,m,(F<<1)+(v?1:0),B,16*w,16*T,256*P,256*D)}function bp(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function jy(r){for(const t of r.sections)if(yc(t.text))return!0;return!1}class xp{constructor(t){this.layoutVertexArray=new Jt,this.indexArray=new Mi,this.programConfigurations=t,this.segments=new di,this.dynamicLayoutVertexArray=new vi,this.opacityVertexArray=new ji,this.hasVisibleVertices=!1,this.placedSymbolArray=new J}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vy.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,by.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,By,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_t("SymbolBuffers",xp);class wp{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new di,this.collisionVertexArray=new Ni}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,xy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}_t("CollisionBuffers",wp);class cl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hg(this.zoom,n["text-size"]),this.iconSizeData=hg(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=vp(o,"text-overlap","text-allow-overlap")!=="never"||vp(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>S.an[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new xp(new io(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new xp(new io(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new re,this.lineVertexArray=new he,this.symbolInstances=new se,this.textAnchorOffsets=new oe}calculateGlyphDependencies(t,n,o,u,p){for(let m=0;m<t.length;m++)if(n[t.charCodeAt(m)]=!0,(o||u)&&p){const _=jc[t.charAt(m)];_&&(n[_.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],p=u.layout,m=p.get("text-font"),_=p.get("text-field"),v=p.get("icon-image"),w=(_.value.kind!=="constant"||_.value.value instanceof Pn&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),T=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,P=p.get("symbol-sort-key");if(this.features=[],!w&&!T)return;const D=n.iconDependencies,F=n.glyphDependencies,B=n.availableImages,U=new Li(this.zoom,{globalState:this.globalState});for(const{feature:W,id:te,index:ye,sourceLayerIndex:le}of t){const O=u._featureFilter.needGeometry,H=ts(W,O);if(!u._featureFilter.filter(U,H,o))continue;let ce,ze;if(O||(H.geometry=es(W)),w){const Oe=u.getValueAndResolveTokens("text-field",H,o,B),Fe=Pn.factory(Oe),it=this.hasRTLText=this.hasRTLText||jy(Fe);(!it||Yr.getRTLTextPluginStatus()==="unavailable"||it&&Yr.isParsed())&&(ce=Sy(Fe,u,H))}if(T){const Oe=u.getValueAndResolveTokens("icon-image",H,o,B);ze=Oe instanceof $n?Oe:$n.fromString(Oe)}if(!ce&&!ze)continue;const We=this.sortFeaturesByKey?P.evaluate(H,{},o):void 0;if(this.features.push({id:te,text:ce,icon:ze,index:ye,sourceLayerIndex:le,geometry:H.geometry,properties:W.properties,type:Fy[W.type],sortKey:We}),ze&&(D[ze.name]=!0),ce){const Oe=m.evaluate(H,{},o).join(","),Fe=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.an.vertical)>=0;for(const it of ce.sections)if(it.image)D[it.image.name]=!0;else{const Je=mc(ce.toString()),ot=it.fontStack||Oe,Ne=F[ot]=F[ot]||{};this.calculateGlyphDependencies(it.text,Ne,Fe,this.allowVerticalPlacement,Je)}}}p.get("symbol-placement")==="line"&&(this.features=function(W){const te={},ye={},le=[];let O=0;function H(Oe){le.push(W[Oe]),O++}function ce(Oe,Fe,it){const Je=ye[Oe];return delete ye[Oe],ye[Fe]=Je,le[Je].geometry[0].pop(),le[Je].geometry[0]=le[Je].geometry[0].concat(it[0]),Je}function ze(Oe,Fe,it){const Je=te[Fe];return delete te[Fe],te[Oe]=Je,le[Je].geometry[0].shift(),le[Je].geometry[0]=it[0].concat(le[Je].geometry[0]),Je}function We(Oe,Fe,it){const Je=it?Fe[0][Fe[0].length-1]:Fe[0][0];return`${Oe}:${Je.x}:${Je.y}`}for(let Oe=0;Oe<W.length;Oe++){const Fe=W[Oe],it=Fe.geometry,Je=Fe.text?Fe.text.toString():null;if(!Je){H(Oe);continue}const ot=We(Je,it),Ne=We(Je,it,!0);if(ot in ye&&Ne in te&&ye[ot]!==te[Ne]){const St=ze(ot,Ne,it),Nt=ce(ot,Ne,le[St].geometry);delete te[ot],delete ye[Ne],ye[We(Je,le[Nt].geometry,!0)]=Nt,le[St].geometry=null}else ot in ye?ce(ot,Ne,it):Ne in te?ze(ot,Ne,it):(H(Oe),te[ot]=O-1,ye[Ne]=O-1)}return le.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,te)=>W.sortKey-te.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),p=t.dist(n[t.segment]);const m={};for(let _=t.segment+1;_<n.length;_++)m[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:u},_<n.length-1&&(u+=n[_+1].dist(n[_]));for(let _=t.segment||0;_>=0;_--)m[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:p},_>0&&(p+=n[_-1].dist(n[_]));for(let _=0;_<n.length;_++){const v=m[_];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,p,m,_,v,w,T,P,D){const F=t.indexArray,B=t.layoutVertexArray,U=t.segments.prepareSegment(4*n.length,B,F,this.canOverlap?m.sortKey:void 0),W=this.glyphOffsetArray.length,te=U.vertexLength,ye=this.allowVerticalPlacement&&_===S.an.vertical?Math.PI/2:0,le=m.text&&m.text.sections;for(let O=0;O<n.length;O++){const{tl:H,tr:ce,bl:ze,br:We,tex:Oe,pixelOffsetTL:Fe,pixelOffsetBR:it,minFontScaleX:Je,minFontScaleY:ot,glyphOffset:Ne,isSDF:St,sectionIndex:Nt}=n[O],Ft=U.vertexLength,kt=Ne[1];zh(B,v.x,v.y,H.x,kt+H.y,Oe.x,Oe.y,o,St,Fe.x,Fe.y,Je,ot),zh(B,v.x,v.y,ce.x,kt+ce.y,Oe.x+Oe.w,Oe.y,o,St,it.x,Fe.y,Je,ot),zh(B,v.x,v.y,ze.x,kt+ze.y,Oe.x,Oe.y+Oe.h,o,St,Fe.x,it.y,Je,ot),zh(B,v.x,v.y,We.x,kt+We.y,Oe.x+Oe.w,Oe.y+Oe.h,o,St,it.x,it.y,Je,ot),bp(t.dynamicLayoutVertexArray,v,ye),F.emplaceBack(Ft,Ft+2,Ft+1),F.emplaceBack(Ft+1,Ft+2,Ft+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),O!==n.length-1&&Nt===n[O+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,m,m.index,{},D,le&&le[Nt])}t.placedSymbolArray.emplaceBack(v.x,v.y,W,this.glyphOffsetArray.length-W,te,w,T,v.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],_,0,!1,0,P)}_addCollisionDebugVertex(t,n,o,u,p,m){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,p,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,n,o,u,p,m,_){const v=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),w=v.vertexLength,T=p.layoutVertexArray,P=p.collisionVertexArray,D=_.anchorX,F=_.anchorY;this._addCollisionDebugVertex(T,P,m,D,F,new ge(t,n)),this._addCollisionDebugVertex(T,P,m,D,F,new ge(o,n)),this._addCollisionDebugVertex(T,P,m,D,F,new ge(o,u)),this._addCollisionDebugVertex(T,P,m,D,F,new ge(t,u)),v.vertexLength+=4;const B=p.indexArray;B.emplaceBack(w,w+1),B.emplaceBack(w+1,w+2),B.emplaceBack(w+2,w+3),B.emplaceBack(w+3,w),v.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let p=t;p<n;p++){const m=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wp(xi,Jm.members,wi),this.iconCollisionBox=new wp(xi,Jm.members,wi);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,p,m,_,v,w){const T={};for(let P=n;P<o;P++){const D=t.get(P);T.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},T.textFeatureIndex=D.featureIndex;break}for(let P=u;P<p;P++){const D=t.get(P);T.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},T.verticalTextFeatureIndex=D.featureIndex;break}for(let P=m;P<_;P++){const D=t.get(P);T.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},T.iconFeatureIndex=D.featureIndex;break}for(let P=v;P<w;P++){const D=t.get(P);T.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},T.verticalIconFeatureIndex=D.featureIndex;break}return T}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<u;p+=4)t.indexArray.emplaceBack(p,p+2,p+1),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],p=[],m=[];for(let _=0;_<this.symbolInstances.length;++_){m.push(_);const v=this.symbolInstances.get(_);u.push(0|Math.round(n*v.anchorX+o*v.anchorY)),p.push(v.featureIndex)}return m.sort((_,v)=>u[_]-u[v]||p[v]-p[_]),m}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,p,m)=>{u>=0&&m.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let dg,pg;_t("SymbolBucket",cl,{omit:["layers","collisionBoxArray","features","compareText"]}),cl.MAX_GLYPHS=65535,cl.addDynamicAttributes=bp;var Sp={get paint(){return pg=pg||new Bn({"icon-opacity":new Vt(k.paint_symbol["icon-opacity"]),"icon-color":new Vt(k.paint_symbol["icon-color"]),"icon-halo-color":new Vt(k.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vt(k.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vt(k.paint_symbol["icon-halo-blur"]),"icon-translate":new Ct(k.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ct(k.paint_symbol["icon-translate-anchor"]),"text-opacity":new Vt(k.paint_symbol["text-opacity"]),"text-color":new Vt(k.paint_symbol["text-color"],{runtimeType:ti,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Vt(k.paint_symbol["text-halo-color"]),"text-halo-width":new Vt(k.paint_symbol["text-halo-width"]),"text-halo-blur":new Vt(k.paint_symbol["text-halo-blur"]),"text-translate":new Ct(k.paint_symbol["text-translate"]),"text-translate-anchor":new Ct(k.paint_symbol["text-translate-anchor"])})},get layout(){return dg=dg||new Bn({"symbol-placement":new Ct(k.layout_symbol["symbol-placement"]),"symbol-spacing":new Ct(k.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ct(k.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vt(k.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ct(k.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ct(k.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ct(k.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ct(k.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ct(k.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ct(k.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vt(k.layout_symbol["icon-size"]),"icon-text-fit":new Ct(k.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ct(k.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vt(k.layout_symbol["icon-image"]),"icon-rotate":new Vt(k.layout_symbol["icon-rotate"]),"icon-padding":new Vt(k.layout_symbol["icon-padding"]),"icon-keep-upright":new Ct(k.layout_symbol["icon-keep-upright"]),"icon-offset":new Vt(k.layout_symbol["icon-offset"]),"icon-anchor":new Vt(k.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ct(k.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ct(k.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ct(k.layout_symbol["text-rotation-alignment"]),"text-field":new Vt(k.layout_symbol["text-field"]),"text-font":new Vt(k.layout_symbol["text-font"]),"text-size":new Vt(k.layout_symbol["text-size"]),"text-max-width":new Vt(k.layout_symbol["text-max-width"]),"text-line-height":new Ct(k.layout_symbol["text-line-height"]),"text-letter-spacing":new Vt(k.layout_symbol["text-letter-spacing"]),"text-justify":new Vt(k.layout_symbol["text-justify"]),"text-radial-offset":new Vt(k.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ct(k.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Vt(k.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Vt(k.layout_symbol["text-anchor"]),"text-max-angle":new Ct(k.layout_symbol["text-max-angle"]),"text-writing-mode":new Ct(k.layout_symbol["text-writing-mode"]),"text-rotate":new Vt(k.layout_symbol["text-rotate"]),"text-padding":new Ct(k.layout_symbol["text-padding"]),"text-keep-upright":new Ct(k.layout_symbol["text-keep-upright"]),"text-transform":new Vt(k.layout_symbol["text-transform"]),"text-offset":new Vt(k.layout_symbol["text-offset"]),"text-allow-overlap":new Ct(k.layout_symbol["text-allow-overlap"]),"text-overlap":new Ct(k.layout_symbol["text-overlap"]),"text-ignore-placement":new Ct(k.layout_symbol["text-ignore-placement"]),"text-optional":new Ct(k.layout_symbol["text-optional"])})}};class fg{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Gt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t("FormatSectionOverride",fg,{omit:["defaultValue"]});class Dh extends xn{constructor(t){super(t,Sp)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const p of o)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const p=this.layout.get(t).evaluate(n,{},o,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||Ns(m.value)||!p?p:function(_,v){return v.replace(/{([^{}]+)}/g,(w,T)=>_&&T in _?String(_[T]):"")}(n.properties,p)}createBucket(t){return new cl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Sp.paint.overridableProperties){if(!Dh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new fg(n),u=new js(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new Fa("source",u):new Vs("composite",u,n.value.zoomStops),this.paint._values[t]=new xr(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Dh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=Sp.paint.properties[n];let p=!1;const m=_=>{for(const v of _)if(u.overrides&&u.overrides.hasOverride(v))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Pn)m(o.value.value.sections);else if(o.value.kind==="source"){const _=w=>{p||(w instanceof Rn&&Ut(w.value)===sn?m(w.value.sections):w instanceof Ia?m(w.sections):w.eachChild(_))},v=o.value;v._styleExpression&&_(v._styleExpression.expression)}return p}}let mg;var Ny={get paint(){return mg=mg||new Bn({"background-color":new Ct(k.paint_background["background-color"]),"background-pattern":new bc(k.paint_background["background-pattern"]),"background-opacity":new Ct(k.paint_background["background-opacity"])})}};class $y extends xn{constructor(t){super(t,Ny)}}let gg;var Vy={get paint(){return gg=gg||new Bn({"raster-opacity":new Ct(k.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ct(k.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ct(k.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ct(k.paint_raster["raster-brightness-max"]),"raster-saturation":new Ct(k.paint_raster["raster-saturation"]),"raster-contrast":new Ct(k.paint_raster["raster-contrast"]),"raster-resampling":new Ct(k.paint_raster["raster-resampling"]),"raster-fade-duration":new Ct(k.paint_raster["raster-fade-duration"])})}};class Uy extends xn{constructor(t){super(t,Vy)}}class qy extends xn{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Gy{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Zy={once:!0},Cp=63710088e-1;class sa{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new sa(fi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,p=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return Cp*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof sa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new sa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new sa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _g=2*Math.PI*Cp;function yg(r){return _g*Math.cos(r*Math.PI/180)}function vg(r){return(180+r)/360}function bg(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function xg(r,t){return r/yg(t)}function Tp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function wg(r,t){return r*yg(Tp(t))}class $c{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=sa.convert(t);return new $c(vg(o.lng),bg(o.lat),xg(n,o.lat))}toLngLat(){return new sa(360*this.x-180,Tp(this.y))}toAltitude(){return wg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/_g*(t=Tp(this.y),1/Math.cos(t*Math.PI/180));var t}}function Sg(r,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Ep{constructor(t,n,o){if(!function(u,p,m){return!(u<0||u>25||m<0||m>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=ul(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(m=this.y,_=this.z,v=Sg(256*(p=this.x),256*(m=Math.pow(2,_)-m-1),_),w=Sg(256*(p+1),256*(m+1),_),v[0]+","+v[1]+","+w[0]+","+w[1]);var p,m,_,v,w;const T=function(P,D,F){let B,U="";for(let W=P;W>0;W--)B=1<<W-1,U+=(D&B?1:0)+(F&B?2:0);return U}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,T).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new ge((t.x*n-this.x)*xt,(t.y*n-this.y)*xt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cg{constructor(t,n){this.wrap=t,this.canonical=n,this.key=ul(t,n.z,n.z,n.x,n.y)}}class hr{constructor(t,n,o,u,p){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Ep(o,+u,+p),this.key=ul(n,t,o,u,p)}clone(){return new hr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new hr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hr(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?ul(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):ul(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new hr(n,this.wrap,n,o,u),new hr(n,this.wrap,n,o+1,u),new hr(n,this.wrap,n,o,u+1),new hr(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new hr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new $c(t.x-this.wrap,t.y))}}function ul(r,t,n,o,u){(r*=2)<0&&(r=-1*r-1);const p=1<<n;return(p*p*r+p*u+o).toString(36)+n.toString(36)+t.toString(36)}_t("CanonicalTileID",Ep),_t("OverscaledTileID",hr,{omit:["terrainRttPosMatrix32f"]});class rs{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new rs;return n.extend(t(new ge(this.minX,this.minY))),n.extend(t(new ge(this.maxX,this.minY))),n.extend(t(new ge(this.minX,this.maxY))),n.extend(t(new ge(this.maxX,this.maxY))),n}static fromPoints(t){const n=new rs;for(const o of t)n.extend(o);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Tg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Eg{constructor(t,n,o,u,p){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Mg{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ta(xt,16,0),this.grid3D=new ta(xt,16,0),this.featureIndexArray=new Le,this.promoteId=n}insert(t,n,o,u,p,m){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,p);const v=m?this.grid3D:this.grid;for(let w=0;w<n.length;w++){const T=n[w],P=[1/0,1/0,-1/0,-1/0];for(let D=0;D<T.length;D++){const F=T[D];P[0]=Math.min(P[0],F.x),P[1]=Math.min(P[1],F.y),P[2]=Math.max(P[2],F.x),P[3]=Math.max(P[3],F.y)}P[0]<xt&&P[1]<xt&&P[2]>=0&&P[3]>=0&&v.insert(_,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Oc.VectorTile(new mp(this.rawTileData)).layers,this.sourceLayerCoder=new Tg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const p=t.params,m=xt/t.tileSize/t.scale,_=Hr(p.filter),v=t.queryGeometry,w=t.queryPadding*m,T=rs.fromPoints(v),P=this.grid.query(T.minX-w,T.minY-w,T.maxX+w,T.maxY+w),D=rs.fromPoints(t.cameraQueryGeometry).expandBy(w),F=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,(W,te,ye,le)=>function(O,H,ce,ze,We){for(const Fe of O)if(H<=Fe.x&&ce<=Fe.y&&ze>=Fe.x&&We>=Fe.y)return!0;const Oe=[new ge(H,ce),new ge(H,We),new ge(ze,We),new ge(ze,ce)];if(O.length>2){for(const Fe of Oe)if(rl(O,Fe))return!0}for(let Fe=0;Fe<O.length-1;Fe++)if(D1(O[Fe],O[Fe+1],Oe))return!0;return!1}(t.cameraQueryGeometry,W-w,te-w,ye+w,le+w));for(const W of F)P.push(W);P.sort(Hy);const B={};let U;for(let W=0;W<P.length;W++){const te=P[W];if(te===U)continue;U=te;const ye=this.featureIndexArray.get(te);let le=null;this.loadMatchingFeature(B,ye.bucketIndex,ye.sourceLayerIndex,ye.featureIndex,_,p.layers,p.availableImages,n,o,u,(O,H,ce)=>(le||(le=es(O)),H.queryIntersectsFeature({queryGeometry:v,feature:O,featureState:ce,geometry:le,zoom:this.z,transform:t.transform,pixelsToTileUnits:m,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return B}loadMatchingFeature(t,n,o,u,p,m,_,v,w,T,P){const D=this.bucketLayerIDs[n];if(m&&!D.some(W=>m.has(W)))return;const F=this.sourceLayerCoder.decode(o),B=this.vtLayers[F].feature(u);if(p.needGeometry){const W=ts(B,!0);if(!p.filter(new Li(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!p.filter(new Li(this.tileID.overscaledZ),B))return;const U=this.getId(B,F);for(let W=0;W<D.length;W++){const te=D[W];if(m&&!m.has(te))continue;const ye=v[te];if(!ye)continue;let le={};U&&T&&(le=T.getState(ye.sourceLayer||"_geojsonTileLayer",U));const O=Ci({},w[te]);O.paint=kg(O.paint,ye.paint,B,le,_),O.layout=kg(O.layout,ye.layout,B,le,_);const H=!P||P(B,ye,le);if(!H)continue;const ce=new Eg(B,this.z,this.x,this.y,U);ce.layer=O;let ze=t[te];ze===void 0&&(ze=t[te]=[]),ze.push({featureIndex:u,feature:ce,intersectionZ:H})}}lookupSymbolFeatures(t,n,o,u,p,m,_,v){const w={};this.loadVTLayers();const T=Hr(p);for(const P of t)this.loadMatchingFeature(w,o,u,P,T,m,_,v,n);return w}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){var o;let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(t.properties.cluster_id))),u}}function kg(r,t,n,o,u){return ut(r,(p,m)=>{const _=t instanceof el?t.get(m):null;return _&&_.evaluate?_.evaluate(n,o,u):_})}function Hy(r,t){return t-r}function Pg(r,t,n,o,u){const p=[];for(let m=0;m<r.length;m++){const _=r[m];let v;for(let w=0;w<_.length-1;w++){let T=_[w],P=_[w+1];T.x<t&&P.x<t||(T.x<t?T=new ge(t,T.y+(t-T.x)/(P.x-T.x)*(P.y-T.y))._round():P.x<t&&(P=new ge(t,T.y+(t-T.x)/(P.x-T.x)*(P.y-T.y))._round()),T.y<n&&P.y<n||(T.y<n?T=new ge(T.x+(n-T.y)/(P.y-T.y)*(P.x-T.x),n)._round():P.y<n&&(P=new ge(T.x+(n-T.y)/(P.y-T.y)*(P.x-T.x),n)._round()),T.x>=o&&P.x>=o||(T.x>=o?T=new ge(o,T.y+(o-T.x)/(P.x-T.x)*(P.y-T.y))._round():P.x>=o&&(P=new ge(o,T.y+(o-T.x)/(P.x-T.x)*(P.y-T.y))._round()),T.y>=u&&P.y>=u||(T.y>=u?T=new ge(T.x+(u-T.y)/(P.y-T.y)*(P.x-T.x),u)._round():P.y>=u&&(P=new ge(T.x+(u-T.y)/(P.y-T.y)*(P.x-T.x),u)._round()),v&&T.equals(v[v.length-1])||(v=[T],p.push(v)),v.push(P)))))}}return p}_t("FeatureIndex",Mg,{omit:["rawTileData","sourceLayerCoder"]});class la extends ge{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new la(this.x,this.y,this.angle,this.segment)}}function Ig(r,t,n,o,u){if(t.segment===void 0||n===0)return!0;let p=t,m=t.segment+1,_=0;for(;_>-n/2;){if(m--,m<0)return!1;_-=r[m].dist(p),p=r[m]}_+=r[m].dist(r[m+1]),m++;const v=[];let w=0;for(;_<n/2;){const T=r[m],P=r[m+1];if(!P)return!1;let D=r[m-1].angleTo(T)-T.angleTo(P);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:_,angleDelta:D}),w+=D;_-v[0].distance>o;)w-=v.shift().angleDelta;if(w>u)return!1;m++,_+=T.dist(P)}return!0}function Ag(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function zg(r,t,n){return r?.6*t*n:0}function Dg(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Wy(r,t,n,o,u,p){const m=zg(n,u,p),_=Dg(n,o)*p;let v=0;const w=Ag(r)/2;for(let T=0;T<r.length-1;T++){const P=r[T],D=r[T+1],F=P.dist(D);if(v+F>w){const B=(w-v)/F,U=Yn.number(P.x,D.x,B),W=Yn.number(P.y,D.y,B),te=new la(U,W,D.angleTo(P),T);return te._round(),!m||Ig(r,te,_,m,t)?te:void 0}v+=F}}function Yy(r,t,n,o,u,p,m,_,v){const w=zg(o,p,m),T=Dg(o,u),P=T*m,D=r[0].x===0||r[0].x===v||r[0].y===0||r[0].y===v;return t-P<t/4&&(t=P+t/4),Lg(r,D?t/2*_%t:(T/2+2*p)*m*_%t,t,w,n,P,D,!1,v)}function Lg(r,t,n,o,u,p,m,_,v){const w=p/2,T=Ag(r);let P=0,D=t-n,F=[];for(let B=0;B<r.length-1;B++){const U=r[B],W=r[B+1],te=U.dist(W),ye=W.angleTo(U);for(;D+n<P+te;){D+=n;const le=(D-P)/te,O=Yn.number(U.x,W.x,le),H=Yn.number(U.y,W.y,le);if(O>=0&&O<v&&H>=0&&H<v&&D-w>=0&&D+w<=T){const ce=new la(O,H,ye,B);ce._round(),o&&!Ig(r,ce,p,o,u)||F.push(ce)}}P+=te}return _||F.length||m||(F=Lg(r,P/2,n,o,u,p,m,!0,v)),F}function Rg(r,t,n,o){const u=[],p=r.image,m=p.pixelRatio,_=p.paddedRect.w-2,v=p.paddedRect.h-2;let w={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const T=p.stretchX||[[0,_]],P=p.stretchY||[[0,v]],D=(Ne,St)=>Ne+St[1]-St[0],F=T.reduce(D,0),B=P.reduce(D,0),U=_-F,W=v-B;let te=0,ye=F,le=0,O=B,H=0,ce=U,ze=0,We=W;if(p.content&&o){const Ne=p.content,St=Ne[2]-Ne[0],Nt=Ne[3]-Ne[1];(p.textFitWidth||p.textFitHeight)&&(w=cg(r)),te=Lh(T,0,Ne[0]),le=Lh(P,0,Ne[1]),ye=Lh(T,Ne[0],Ne[2]),O=Lh(P,Ne[1],Ne[3]),H=Ne[0]-te,ze=Ne[1]-le,ce=St-ye,We=Nt-O}const Oe=w.x1,Fe=w.y1,it=w.x2-Oe,Je=w.y2-Fe,ot=(Ne,St,Nt,Ft)=>{const kt=Rh(Ne.stretch-te,ye,it,Oe),li=Oh(Ne.fixed-H,ce,Ne.stretch,F),Zi=Rh(St.stretch-le,O,Je,Fe),cn=Oh(St.fixed-ze,We,St.stretch,B),zn=Rh(Nt.stretch-te,ye,it,Oe),dr=Oh(Nt.fixed-H,ce,Nt.stretch,F),Kn=Rh(Ft.stretch-le,O,Je,Fe),Tn=Oh(Ft.fixed-ze,We,Ft.stretch,B),$i=new ge(kt,Zi),gn=new ge(zn,Zi),En=new ge(zn,Kn),Mn=new ge(kt,Kn),Zn=new ge(li/m,cn/m),pr=new ge(dr/m,Tn/m),_n=t*Math.PI/180;if(_n){const yn=Math.sin(_n),vn=Math.cos(_n),an=[vn,-yn,yn,vn];$i._matMult(an),gn._matMult(an),Mn._matMult(an),En._matMult(an)}const Jn=Ne.stretch+Ne.fixed,un=St.stretch+St.fixed;return{tl:$i,tr:gn,bl:Mn,br:En,tex:{x:p.paddedRect.x+1+Jn,y:p.paddedRect.y+1+un,w:Nt.stretch+Nt.fixed-Jn,h:Ft.stretch+Ft.fixed-un},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zn,pixelOffsetBR:pr,minFontScaleX:ce/m/it,minFontScaleY:We/m/Je,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const Ne=Og(T,U,F),St=Og(P,W,B);for(let Nt=0;Nt<Ne.length-1;Nt++){const Ft=Ne[Nt],kt=Ne[Nt+1];for(let li=0;li<St.length-1;li++)u.push(ot(Ft,St[li],kt,St[li+1]))}}else u.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:v+1}));return u}function Lh(r,t,n){let o=0;for(const u of r)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function Og(r,t,n){const o=[{fixed:-1,stretch:0}];for(const[u,p]of r){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(p-u)})}return o.push({fixed:t+1,stretch:n}),o}function Rh(r,t,n,o){return r/t*n+o}function Oh(r,t,n,o){return r-t*n/o}_t("Anchor",la);class Fh{constructor(t,n,o,u,p,m,_,v,w,T){var P;if(this.boxStartIndex=t.length,w){let D=m.top,F=m.bottom;const B=m.collisionPadding;B&&(D-=B[1],F+=B[3]);let U=F-D;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const D=!((P=m.image)===null||P===void 0)&&P.content&&(m.image.textFitWidth||m.image.textFitHeight)?cg(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*_-v[0],D.y2=D.y2*_+v[2],D.x1=D.x1*_-v[3],D.x2=D.x2*_+v[1];const F=m.collisionPadding;if(F&&(D.x1-=F[0]*_,D.y1-=F[1]*_,D.x2+=F[2]*_,D.y2+=F[3]*_),T){const B=new ge(D.x1,D.y1),U=new ge(D.x2,D.y1),W=new ge(D.x1,D.y2),te=new ge(D.x2,D.y2),ye=T*Math.PI/180;B._rotate(ye),U._rotate(ye),W._rotate(ye),te._rotate(ye),D.x1=Math.min(B.x,U.x,W.x,te.x),D.x2=Math.max(B.x,U.x,W.x,te.x),D.y1=Math.min(B.y,U.y,W.y,te.y),D.y2=Math.max(B.y,U.y,W.y,te.y)}t.emplaceBack(n.x,n.y,D.x1,D.y1,D.x2,D.y2,o,u,p)}this.boxEndIndex=t.length}}class Xy{constructor(t=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const p=t-1>>1,m=n[p];if(o(u,m)>=0)break;n[t]=m,t=p}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,p=n[t];for(;t<u;){let m=1+(t<<1);const _=m+1;if(_<this.length&&o(n[_],n[m])<0&&(m=_),o(n[m],p)>=0)break;n[t]=n[m],t=m}n[t]=p}}function Ky(r,t=1,n=!1){const o=rs.fromPoints(r[0]),u=Math.min(o.width(),o.height());let p=u/2;const m=new Xy([],Jy),{minX:_,minY:v,maxX:w,maxY:T}=o;if(u===0)return new ge(_,v);for(let F=_;F<w;F+=u)for(let B=v;B<T;B+=u)m.push(new hl(F+p,B+p,p,r));let P=function(F){let B=0,U=0,W=0;const te=F[0];for(let ye=0,le=te.length,O=le-1;ye<le;O=ye++){const H=te[ye],ce=te[O],ze=H.x*ce.y-ce.x*H.y;U+=(H.x+ce.x)*ze,W+=(H.y+ce.y)*ze,B+=3*ze}return new hl(U/B,W/B,0,F)}(r),D=m.length;for(;m.length;){const F=m.pop();(F.d>P.d||!P.d)&&(P=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-P.d<=t||(p=F.h/2,m.push(new hl(F.p.x-p,F.p.y-p,p,r)),m.push(new hl(F.p.x+p,F.p.y-p,p,r)),m.push(new hl(F.p.x-p,F.p.y+p,p,r)),m.push(new hl(F.p.x+p,F.p.y+p,p,r)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${P.d}`)),P.p}function Jy(r,t){return t.max-r.max}function hl(r,t,n,o){this.p=new ge(r,t),this.h=n,this.d=function(u,p){let m=!1,_=1/0;for(let v=0;v<p.length;v++){const w=p[v];for(let T=0,P=w.length,D=P-1;T<P;D=T++){const F=w[T],B=w[D];F.y>u.y!=B.y>u.y&&u.x<(B.x-F.x)*(u.y-F.y)/(B.y-F.y)+F.x&&(m=!m),_=Math.min(_,mm(u,F,B))}}return(m?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var An;S.aD=void 0,(An=S.aD||(S.aD={}))[An.center=1]="center",An[An.left=2]="left",An[An.right=3]="right",An[An.top=4]="top",An[An.bottom=5]="bottom",An[An["top-left"]=6]="top-left",An[An["top-right"]=7]="top-right",An[An["bottom-left"]=8]="bottom-left",An[An["bottom-right"]=9]="bottom-right";const Mp=Number.POSITIVE_INFINITY;function Fg(r,t){return t[1]!==Mp?function(n,o,u){let p=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":m=u-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-u}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,m]}(r,t[0],t[1]):function(n,o){let u=0,p=0;o<0&&(o=0);const m=o/Math.SQRT2;switch(n){case"top-right":case"top-left":p=m-7;break;case"bottom-right":case"bottom-left":p=7-m;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,p]}(r,t[0])}function Bg(r,t,n){var o;const u=r.layout,p=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(p){const _=p.values,v=[];for(let w=0;w<_.length;w+=2){const T=v[w]=_[w],P=_[w+1].map(D=>D*mn);T.startsWith("top")?P[1]-=7:T.startsWith("bottom")&&(P[1]+=7),v[w+1]=P}return new hi(v)}const m=u.get("text-variable-anchor");if(m){let _;_=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},n)*mn,Mp]:u.get("text-offset").evaluate(t,{},n).map(w=>w*mn);const v=[];for(const w of m)v.push(w,Fg(w,_));return new hi(v)}return null}function kp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Qy(r,t,n,o,u,p,m,_,v,w,T,P){let D=p.textMaxSize.evaluate(t,{});D===void 0&&(D=m);const F=r.layers[0].layout,B=F.get("icon-offset").evaluate(t,{},T),U=Ng(n.horizontal),W=m/24,te=r.tilePixelRatio*W,ye=r.tilePixelRatio*D/24,le=r.tilePixelRatio*_,O=r.tilePixelRatio*F.get("symbol-spacing"),H=F.get("text-padding")*r.tilePixelRatio,ce=function(Nt,Ft,kt,li=1){const Zi=Nt.get("icon-padding").evaluate(Ft,{},kt),cn=Zi&&Zi.values;return[cn[0]*li,cn[1]*li,cn[2]*li,cn[3]*li]}(F,t,T,r.tilePixelRatio),ze=F.get("text-max-angle")/180*Math.PI,We=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",Oe=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Fe=F.get("symbol-placement"),it=O/2,Je=F.get("icon-text-fit");let ot;o&&Je!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(ot=ug(o,n.vertical,Je,F.get("icon-text-fit-padding"),B,W)),U&&(o=ug(o,U,Je,F.get("icon-text-fit-padding"),B,W)));const Ne=T?P.line.getGranularityForZoomLevel(T.z):1,St=(Nt,Ft)=>{Ft.x<0||Ft.x>=xt||Ft.y<0||Ft.y>=xt||function(kt,li,Zi,cn,zn,dr,Kn,Tn,$i,gn,En,Mn,Zn,pr,_n,Jn,un,yn,vn,an,zi,Or,dl,Fr,iv){const pl=kt.addToLineVertexArray(li,Zi);let os,fl,ml,gl,qg=0,Gg=0,Zg=0,Hg=0,Op=-1,Fp=-1;const So={};let Wg=Gn("");if(kt.allowVerticalPlacement&&cn.vertical){const Nn=Tn.layout.get("text-rotate").evaluate(zi,{},Fr)+90;ml=new Fh($i,li,gn,En,Mn,cn.vertical,Zn,pr,_n,Nn),Kn&&(gl=new Fh($i,li,gn,En,Mn,Kn,un,yn,_n,Nn))}if(zn){const Nn=Tn.layout.get("icon-rotate").evaluate(zi,{}),fr=Tn.layout.get("icon-text-fit")!=="none",as=Rg(zn,Nn,dl,fr),jr=Kn?Rg(Kn,Nn,dl,fr):void 0;fl=new Fh($i,li,gn,En,Mn,zn,un,yn,!1,Nn),qg=4*as.length;const ss=kt.iconSizeData;let no=null;ss.kind==="source"?(no=[wo*Tn.layout.get("icon-size").evaluate(zi,{})],no[0]>aa&&Ot(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ss.kind==="composite"&&(no=[wo*Or.compositeIconSizes[0].evaluate(zi,{},Fr),wo*Or.compositeIconSizes[1].evaluate(zi,{},Fr)],(no[0]>aa||no[1]>aa)&&Ot(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),kt.addSymbols(kt.icon,as,no,an,vn,zi,S.an.none,li,pl.lineStartIndex,pl.lineLength,-1,Fr),Op=kt.icon.placedSymbolArray.length-1,jr&&(Gg=4*jr.length,kt.addSymbols(kt.icon,jr,no,an,vn,zi,S.an.vertical,li,pl.lineStartIndex,pl.lineLength,-1,Fr),Fp=kt.icon.placedSymbolArray.length-1)}const Yg=Object.keys(cn.horizontal);for(const Nn of Yg){const fr=cn.horizontal[Nn];if(!os){Wg=Gn(fr.text);const jr=Tn.layout.get("text-rotate").evaluate(zi,{},Fr);os=new Fh($i,li,gn,En,Mn,fr,Zn,pr,_n,jr)}const as=fr.positionedLines.length===1;if(Zg+=jg(kt,li,fr,dr,Tn,_n,zi,Jn,pl,cn.vertical?S.an.horizontal:S.an.horizontalOnly,as?Yg:[Nn],So,Op,Or,Fr),as)break}cn.vertical&&(Hg+=jg(kt,li,cn.vertical,dr,Tn,_n,zi,Jn,pl,S.an.vertical,["vertical"],So,Fp,Or,Fr));const nv=os?os.boxStartIndex:kt.collisionBoxArray.length,rv=os?os.boxEndIndex:kt.collisionBoxArray.length,ov=ml?ml.boxStartIndex:kt.collisionBoxArray.length,av=ml?ml.boxEndIndex:kt.collisionBoxArray.length,sv=fl?fl.boxStartIndex:kt.collisionBoxArray.length,lv=fl?fl.boxEndIndex:kt.collisionBoxArray.length,cv=gl?gl.boxStartIndex:kt.collisionBoxArray.length,uv=gl?gl.boxEndIndex:kt.collisionBoxArray.length;let Br=-1;const jh=(Nn,fr)=>Nn&&Nn.circleDiameter?Math.max(Nn.circleDiameter,fr):fr;Br=jh(os,Br),Br=jh(ml,Br),Br=jh(fl,Br),Br=jh(gl,Br);const Xg=Br>-1?1:0;Xg&&(Br*=iv/mn),kt.glyphOffsetArray.length>=cl.MAX_GLYPHS&&Ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zi.sortKey!==void 0&&kt.addToSortKeyRanges(kt.symbolInstances.length,zi.sortKey);const hv=Bg(Tn,zi,Fr),[dv,pv]=function(Nn,fr){const as=Nn.length,jr=fr==null?void 0:fr.values;if((jr==null?void 0:jr.length)>0)for(let ss=0;ss<jr.length;ss+=2){const no=jr[ss+1];Nn.emplaceBack(S.aD[jr[ss]],no[0],no[1])}return[as,Nn.length]}(kt.textAnchorOffsets,hv);kt.symbolInstances.emplaceBack(li.x,li.y,So.right>=0?So.right:-1,So.center>=0?So.center:-1,So.left>=0?So.left:-1,So.vertical||-1,Op,Fp,Wg,nv,rv,ov,av,sv,lv,cv,uv,gn,Zg,Hg,qg,Gg,Xg,0,Zn,Br,dv,pv)}(r,Ft,Nt,n,o,u,ot,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,te,[H,H,H,H],We,v,le,ce,Oe,B,t,p,w,T,m)};if(Fe==="line")for(const Nt of Pg(t.geometry,0,0,xt,xt)){const Ft=ns(Nt,Ne),kt=Yy(Ft,O,ze,n.vertical||U,o,24,ye,r.overscaling,xt);for(const li of kt)U&&ev(r,U.text,it,li)||St(Ft,li)}else if(Fe==="line-center"){for(const Nt of t.geometry)if(Nt.length>1){const Ft=ns(Nt,Ne),kt=Wy(Ft,ze,n.vertical||U,o,24,ye);kt&&St(Ft,kt)}}else if(t.type==="Polygon")for(const Nt of zs(t.geometry,0)){const Ft=Ky(Nt,16);St(ns(Nt[0],Ne,!0),new la(Ft.x,Ft.y,0))}else if(t.type==="LineString")for(const Nt of t.geometry){const Ft=ns(Nt,Ne);St(Ft,new la(Ft[0].x,Ft[0].y,0))}else if(t.type==="Point")for(const Nt of t.geometry)for(const Ft of Nt)St([Ft],new la(Ft.x,Ft.y,0))}function jg(r,t,n,o,u,p,m,_,v,w,T,P,D,F,B){const U=function(ye,le,O,H,ce,ze,We,Oe){const Fe=H.layout.get("text-rotate").evaluate(ze,{})*Math.PI/180,it=[];for(const Je of le.positionedLines)for(const ot of Je.positionedGlyphs){if(!ot.rect)continue;const Ne=ot.rect||{};let St=4,Nt=!0,Ft=1,kt=0;const li=(ce||Oe)&&ot.vertical,Zi=ot.metrics.advance*ot.scale/2;if(Oe&&le.verticalizable&&(kt=Je.lineOffset/2-(ot.imageName?-(mn-ot.metrics.width*ot.scale)/2:(ot.scale-1)*mn)),ot.imageName){const yn=We[ot.imageName];Nt=yn.sdf,Ft=yn.pixelRatio,St=1/Ft}const cn=ce?[ot.x+Zi,ot.y]:[0,0];let zn=ce?[0,0]:[ot.x+Zi+O[0],ot.y+O[1]-kt],dr=[0,0];li&&(dr=zn,zn=[0,0]);const Kn=ot.metrics.isDoubleResolution?2:1,Tn=(ot.metrics.left-St)*ot.scale-Zi+zn[0],$i=(-ot.metrics.top-St)*ot.scale+zn[1],gn=Tn+Ne.w/Kn*ot.scale/Ft,En=$i+Ne.h/Kn*ot.scale/Ft,Mn=new ge(Tn,$i),Zn=new ge(gn,$i),pr=new ge(Tn,En),_n=new ge(gn,En);if(li){const yn=new ge(-Zi,Zi- -17),vn=-Math.PI/2,an=12-Zi,zi=new ge(22-an,-(ot.imageName?an:0)),Or=new ge(...dr);Mn._rotateAround(vn,yn)._add(zi)._add(Or),Zn._rotateAround(vn,yn)._add(zi)._add(Or),pr._rotateAround(vn,yn)._add(zi)._add(Or),_n._rotateAround(vn,yn)._add(zi)._add(Or)}if(Fe){const yn=Math.sin(Fe),vn=Math.cos(Fe),an=[vn,-yn,yn,vn];Mn._matMult(an),Zn._matMult(an),pr._matMult(an),_n._matMult(an)}const Jn=new ge(0,0),un=new ge(0,0);it.push({tl:Mn,tr:Zn,bl:pr,br:_n,tex:Ne,writingMode:le.writingMode,glyphOffset:cn,sectionIndex:ot.sectionIndex,isSDF:Nt,pixelOffsetTL:Jn,pixelOffsetBR:un,minFontScaleX:0,minFontScaleY:0})}return it}(0,n,_,u,p,m,o,r.allowVerticalPlacement),W=r.textSizeData;let te=null;W.kind==="source"?(te=[wo*u.layout.get("text-size").evaluate(m,{})],te[0]>aa&&Ot(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):W.kind==="composite"&&(te=[wo*F.compositeTextSizes[0].evaluate(m,{},B),wo*F.compositeTextSizes[1].evaluate(m,{},B)],(te[0]>aa||te[1]>aa)&&Ot(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,U,te,_,p,m,w,t,v.lineStartIndex,v.lineLength,D,B);for(const ye of T)P[ye]=r.text.placedSymbolArray.length-1;return 4*U.length}function Ng(r){for(const t in r)return r[t];return null}function ev(r,t,n,o){const u=r.compareText;if(t in u){const p=u[t];for(let m=p.length-1;m>=0;m--)if(o.dist(p[m])<n)return!0}else u[t]=[];return u[t].push(o),!1}const $g=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Pp{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=$g[15&o];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new Pp(_,m,p,t)}constructor(t,n=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=$g.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-_%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+v,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+_+v),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+v,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ip(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:_}=this,v=[0,p.length-1,0],w=[];for(;v.length;){const T=v.pop()||0,P=v.pop()||0,D=v.pop()||0;if(P-D<=_){for(let W=D;W<=P;W++){const te=m[2*W],ye=m[2*W+1];te>=t&&te<=o&&ye>=n&&ye<=u&&w.push(p[W])}continue}const F=D+P>>1,B=m[2*F],U=m[2*F+1];B>=t&&B<=o&&U>=n&&U<=u&&w.push(p[F]),(T===0?t<=B:n<=U)&&(v.push(D),v.push(F-1),v.push(1-T)),(T===0?o>=B:u>=U)&&(v.push(F+1),v.push(P),v.push(1-T))}return w}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:m}=this,_=[0,u.length-1,0],v=[],w=o*o;for(;_.length;){const T=_.pop()||0,P=_.pop()||0,D=_.pop()||0;if(P-D<=m){for(let W=D;W<=P;W++)Ug(p[2*W],p[2*W+1],t,n)<=w&&v.push(u[W]);continue}const F=D+P>>1,B=p[2*F],U=p[2*F+1];Ug(B,U,t,n)<=w&&v.push(u[F]),(T===0?t-o<=B:n-o<=U)&&(_.push(D),_.push(F-1),_.push(1-T)),(T===0?t+o>=B:n+o>=U)&&(_.push(F+1),_.push(P),_.push(1-T))}return v}}function Ip(r,t,n,o,u,p){if(u-o<=n)return;const m=o+u>>1;Vg(r,t,m,o,u,p),Ip(r,t,n,o,m-1,1-p),Ip(r,t,n,m+1,u,1-p)}function Vg(r,t,n,o,u,p){for(;u>o;){if(u-o>600){const w=u-o+1,T=n-o+1,P=Math.log(w),D=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*D*(w-D)/w)*(T-w/2<0?-1:1);Vg(r,t,n,Math.max(o,Math.floor(n-T*D/w+F)),Math.min(u,Math.floor(n+(w-T)*D/w+F)),p)}const m=t[2*n+p];let _=o,v=u;for(Vc(r,t,o,n),t[2*u+p]>m&&Vc(r,t,o,u);_<v;){for(Vc(r,t,_,v),_++,v--;t[2*_+p]<m;)_++;for(;t[2*v+p]>m;)v--}t[2*o+p]===m?Vc(r,t,o,v):(v++,Vc(r,t,v,u)),v<=n&&(o=v+1),n<=v&&(u=v-1)}}function Vc(r,t,n,o){Ap(r,n,o),Ap(t,2*n,2*o),Ap(t,2*n+1,2*o+1)}function Ap(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function Ug(r,t,n,o){const u=r-n,p=t-o;return u*u+p*p}var zp;S.cw=void 0,(zp=S.cw||(S.cw={})).create="create",zp.load="load",zp.fullLoad="fullLoad";let Bh=null,Uc=[];const Dp=1e3/60,Lp="loadTime",Rp="fullLoadTime",tv={mark(r){performance.mark(r)},frame(r){const t=r;Bh!=null&&Uc.push(t-Bh),Bh=t},clearMetrics(){Bh=null,Uc=[],performance.clearMeasures(Lp),performance.clearMeasures(Rp);for(const r in S.cw)performance.clearMarks(S.cw[r])},getPerformanceMetrics(){performance.measure(Lp,S.cw.create,S.cw.load),performance.measure(Rp,S.cw.create,S.cw.fullLoad);const r=performance.getEntriesByName(Lp)[0].duration,t=performance.getEntriesByName(Rp)[0].duration,n=Uc.length,o=1/(Uc.reduce((p,m)=>p+m,0)/n/1e3),u=Uc.filter(p=>p>Dp).reduce((p,m)=>p+(m-Dp)/Dp,0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};S.$=xt,S.A=pt,S.B=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},S.C=Yn,S.D=Ct,S.E=z,S.F=Li,S.G=Xs,S.H=function(r){if(jt==null){const t=r.navigator?r.navigator.userAgent:null;jt=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return jt},S.I=gp,S.J=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Gy(()=>this.process()),this.subscription=tn(this.target,"message",n=>this.receive(n),!1),this.globalScope=$t(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=t?tn(t.signal,"abort",()=>{p==null||p.unsubscribe(),delete this.resolveRejects[u];const v={id:u,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},Zy):null;this.resolveRejects[u]={resolve:v=>{p==null||p.unsubscribe(),n(v)},reject:v=>{p==null||p.unsubscribe(),o(v)}};const m=[],_=Object.assign(Object.assign({},r),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Ga(r.data,m)});this.target.postMessage(_,{transfer:m})})}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if($t(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return l(this,void 0,void 0,function*(){if(t.type==="<response>"){const u=this.resolveRejects[r];return delete this.resolveRejects[r],u?void(t.error?u.reject(ia(t.error)):u.resolve(ia(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=ia(t.data),o=new AbortController;this.abortControllers[r]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(r,null,u)}catch(u){this.completeTask(r,u)}})}completeTask(r,t,n){const o=[];delete this.abortControllers[r];const u={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ga(t):null,data:Ga(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.K=Z,S.L=function(){var r=new pt(16);return pt!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},S.M=function(r,t,n){var o,u,p,m,_,v,w,T,P,D,F,B,U=n[0],W=n[1],te=n[2];return t===r?(r[12]=t[0]*U+t[4]*W+t[8]*te+t[12],r[13]=t[1]*U+t[5]*W+t[9]*te+t[13],r[14]=t[2]*U+t[6]*W+t[10]*te+t[14],r[15]=t[3]*U+t[7]*W+t[11]*te+t[15]):(u=t[1],p=t[2],m=t[3],_=t[4],v=t[5],w=t[6],T=t[7],P=t[8],D=t[9],F=t[10],B=t[11],r[0]=o=t[0],r[1]=u,r[2]=p,r[3]=m,r[4]=_,r[5]=v,r[6]=w,r[7]=T,r[8]=P,r[9]=D,r[10]=F,r[11]=B,r[12]=o*U+_*W+P*te+t[12],r[13]=u*U+v*W+D*te+t[13],r[14]=p*U+w*W+F*te+t[14],r[15]=m*U+T*W+B*te+t[15]),r},S.N=function(r,t,n){var o=n[0],u=n[1],p=n[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*u,r[5]=t[5]*u,r[6]=t[6]*u,r[7]=t[7]*u,r[8]=t[8]*p,r[9]=t[9]*p,r[10]=t[10]*p,r[11]=t[11]*p,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.O=function(r,t,n){var o=t[0],u=t[1],p=t[2],m=t[3],_=t[4],v=t[5],w=t[6],T=t[7],P=t[8],D=t[9],F=t[10],B=t[11],U=t[12],W=t[13],te=t[14],ye=t[15],le=n[0],O=n[1],H=n[2],ce=n[3];return r[0]=le*o+O*_+H*P+ce*U,r[1]=le*u+O*v+H*D+ce*W,r[2]=le*p+O*w+H*F+ce*te,r[3]=le*m+O*T+H*B+ce*ye,r[4]=(le=n[4])*o+(O=n[5])*_+(H=n[6])*P+(ce=n[7])*U,r[5]=le*u+O*v+H*D+ce*W,r[6]=le*p+O*w+H*F+ce*te,r[7]=le*m+O*T+H*B+ce*ye,r[8]=(le=n[8])*o+(O=n[9])*_+(H=n[10])*P+(ce=n[11])*U,r[9]=le*u+O*v+H*D+ce*W,r[10]=le*p+O*w+H*F+ce*te,r[11]=le*m+O*T+H*B+ce*ye,r[12]=(le=n[12])*o+(O=n[13])*_+(H=n[14])*P+(ce=n[15])*U,r[13]=le*u+O*v+H*D+ce*W,r[14]=le*p+O*w+H*F+ce*te,r[15]=le*m+O*T+H*B+ce*ye,r},S.P=ge,S.Q=function(r,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in r&&(n[u]=r[u])}return n},S.R=Xn,S.S=sa,S.T=tp,S.U=bg,S.V=vg,S.W=Ye,S.X=mt,S.Y=Di,S.Z=hr,S._=l,S.a=j,S.a$=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r},S.a0=$c,S.a1=rs,S.a2=25,S.a3=Ep,S.a4=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of r){const u=window.document.createElement("source");Me(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}})},S.a5=K,S.a6=function(){return Wi++},S.a7=X,S.a8=cl,S.a9=Hr,S.aA=mn,S.aB=ii,S.aC=function(r,t,n,o,u=!1){if(!n[0]&&!n[1])return[0,0];const p=u?o==="map"?-r.bearingInRadians:0:o==="viewport"?r.bearingInRadians:0;if(p){const m=Math.sin(p),_=Math.cos(p);n=[n[0]*_-n[1]*m,n[0]*m+n[1]*_]}return[u?n[0]:ii(t,n[0],r.zoom),u?n[1]:ii(t,n[1],r.zoom)]},S.aE=vp,S.aF=kp,S.aG=yp,S.aH=Pp,S.aI=Gi,S.aJ=Mh,S.aK=ke,S.aL=di,S.aM=Mi,S.aN=fi,S.aO=Ui,S.aP=wg,S.aQ=rt,S.aR=et,S.aS=function(r){var t=new pt(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},S.aT=function(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r},S.aU=function(r,t){var n=t[0],o=t[1],u=t[2],p=n*n+o*o+u*u;return p>0&&(p=1/Math.sqrt(p)),r[0]=t[0]*p,r[1]=t[1]*p,r[2]=t[2]*p,r},S.aV=Dt,S.aW=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]},S.aX=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},S.aY=Qe,S.aZ=function(r,t,n){const o=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return o===0?null:(-(r[0]*n[0]+r[1]*n[1]+r[2]*n[2])-n[3])/o},S.a_=ei,S.aa=ts,S.ab=Eg,S.ac=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,u,p)=>{const m=u||p;return t[o]=!m||m.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},S.ad=Ti,S.ae=function(r){return Math.pow(2,r)},S.af=bt,S.ag=qt,S.ah=85.051129,S.ai=xg,S.aj=function(r){return Math.log(r)/Math.LN2},S.ak=function(r){var t=r[0],n=r[1];return t*t+n*n},S.al=function(r,t){const n=[];for(const o in r)o in t||n.push(o);return n},S.am=function(r,t){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:m}=r,_=u?qt(On.interpolationFactor(u,t,p,m),0,1):0;r.kind==="camera"?o=Yn.number(r.minSize,r.maxSize,_):n=_}return{uSizeT:n,uSize:o}},S.ao=function(r,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return r.kind==="source"?o/wo:r.kind==="composite"?Yn.number(o/wo,u/wo,n):t},S.ap=function(r,t){var n=t[0],o=t[1],u=t[2],p=t[3],m=t[4],_=t[5],v=t[6],w=t[7],T=t[8],P=t[9],D=t[10],F=t[11],B=t[12],U=t[13],W=t[14],te=t[15],ye=n*_-o*m,le=n*v-u*m,O=n*w-p*m,H=o*v-u*_,ce=o*w-p*_,ze=u*w-p*v,We=T*U-P*B,Oe=T*W-D*B,Fe=T*te-F*B,it=P*W-D*U,Je=P*te-F*U,ot=D*te-F*W,Ne=ye*ot-le*Je+O*it+H*Fe-ce*Oe+ze*We;return Ne?(r[0]=(_*ot-v*Je+w*it)*(Ne=1/Ne),r[1]=(u*Je-o*ot-p*it)*Ne,r[2]=(U*ze-W*ce+te*H)*Ne,r[3]=(D*ce-P*ze-F*H)*Ne,r[4]=(v*Fe-m*ot-w*Oe)*Ne,r[5]=(n*ot-u*Fe+p*Oe)*Ne,r[6]=(W*O-B*ze-te*le)*Ne,r[7]=(T*ze-D*O+F*le)*Ne,r[8]=(m*Je-_*Fe+w*We)*Ne,r[9]=(o*Fe-n*Je-p*We)*Ne,r[10]=(B*ce-U*O+te*ye)*Ne,r[11]=(P*O-T*ce-F*ye)*Ne,r[12]=(_*Oe-m*it-v*We)*Ne,r[13]=(n*it-o*Oe+u*We)*Ne,r[14]=(U*le-B*H-W*ye)*Ne,r[15]=(T*H-P*le+D*ye)*Ne,r):null},S.aq=at,S.ar=function(r){return Math.hypot(r[0],r[1])},S.as=function(r){return r[0]=0,r[1]=0,r},S.at=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r},S.au=bp,S.av=Zt,S.aw=function(r,t,n,o){const u=t.y-r.y,p=t.x-r.x,m=o.y-n.y,_=o.x-n.x,v=m*p-_*u;if(v===0)return null;const w=(_*(r.y-n.y)-m*(r.x-n.x))/v;return new ge(r.x+w*p,r.y+w*u)},S.ax=Pg,S.ay=pm,S.az=function(r){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const p of r)t=Math.min(t,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return[t,n,o,u]},S.b=Pi,S.b$=wy,S.b0=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]},S.b1=Cg,S.b2=ul,S.b3=function(r,t,n,o,u){var p,m=1/Math.tan(t/2);return r[0]=m/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0?(r[10]=(u+o)*(p=1/(o-u)),r[14]=2*u*o*p):(r[10]=-1,r[14]=-2*o),r},S.b4=function(r){var t=new pt(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},S.b5=function(r,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[0],m=t[1],_=t[2],v=t[3],w=t[4],T=t[5],P=t[6],D=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=p*u+w*o,r[1]=m*u+T*o,r[2]=_*u+P*o,r[3]=v*u+D*o,r[4]=w*u-p*o,r[5]=T*u-m*o,r[6]=P*u-_*o,r[7]=D*u-v*o,r},S.b6=function(r,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[4],m=t[5],_=t[6],v=t[7],w=t[8],T=t[9],P=t[10],D=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=p*u+w*o,r[5]=m*u+T*o,r[6]=_*u+P*o,r[7]=v*u+D*o,r[8]=w*u-p*o,r[9]=T*u-m*o,r[10]=P*u-_*o,r[11]=D*u-v*o,r},S.b7=function(){const r=new Float32Array(16);return bt(r),r},S.b8=function(){const r=new Float64Array(16);return bt(r),r},S.b9=function(){return new Float64Array(16)},S.bA=function(r){return r[0]=0,r[1]=0,r[2]=0,r},S.bB=function(r,t,n,o){const u=Math.sqrt(r*r+t*t),p=Math.sqrt(n*n+o*o);r/=u,t/=u,n/=p,o/=p;const m=Math.acos(r*n+t*o);return-t*n+r*o>0?m:-m},S.bC=function(r,t){const n=Qt(r,2*Math.PI),o=Qt(t,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},S.bD=function(){const r={},t=k.$version;for(const n in k.$root){const o=k.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(r[n]=u)}}return r},S.bE=fc,S.bF=pe,S.bG=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!r(t[o],n[o]))return!1;return!0}return t===n},S.bH=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=Q(r[n],t[r[n].ref]));return r},S.bI=function(r){if(r.type==="custom")return new qy(r);switch(r.type){case"background":return new $y(r);case"circle":return new R1(r);case"color-relief":return new $1(r);case"fill":return new iy(r);case"fill-extrusion":return new uy(r);case"heatmap":return new F1(r);case"hillshade":return new j1(r);case"line":return new yy(r);case"raster":return new Uy(r);case"symbol":return new Dh(r)}},S.bJ=we,S.bK=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!fe(r.version,t.version))return[{command:"setStyle",args:[t]}];fe(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),fe(r.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),fe(r.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),fe(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),fe(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),fe(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),fe(r.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),fe(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),fe(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),fe(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),fe(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),fe(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),fe(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),fe(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(m,_,v,w){let T;for(T in _=_||{},m=m||{})Object.prototype.hasOwnProperty.call(m,T)&&(Object.prototype.hasOwnProperty.call(_,T)||Ve(T,v,w));for(T in _)Object.prototype.hasOwnProperty.call(_,T)&&(Object.prototype.hasOwnProperty.call(m,T)?fe(m[T],_[T])||(m[T].type==="geojson"&&_[T].type==="geojson"&&Ze(m,_,T)?Se(v,{command:"setGeoJSONSourceData",args:[T,_[T].data]}):nt(T,_,v,w)):Be(T,_,v))})(r.sources,t.sources,u,o);const p=[];r.layers&&r.layers.forEach(m=>{"source"in m&&o[m.source]?n.push({command:"removeLayer",args:[m.id]}):p.push(m)}),n=n.concat(u),function(m,_,v){_=_||[];const w=(m=m||[]).map(yt),T=_.map(yt),P=m.reduce(Ht,{}),D=_.reduce(Ht,{}),F=w.slice(),B=Object.create(null);let U,W,te,ye,le;for(let O=0,H=0;O<w.length;O++)U=w[O],Object.prototype.hasOwnProperty.call(D,U)?H++:(Se(v,{command:"removeLayer",args:[U]}),F.splice(F.indexOf(U,H),1));for(let O=0,H=0;O<T.length;O++)U=T[T.length-1-O],F[F.length-1-O]!==U&&(Object.prototype.hasOwnProperty.call(P,U)?(Se(v,{command:"removeLayer",args:[U]}),F.splice(F.lastIndexOf(U,F.length-H),1)):H++,ye=F[F.length-O],Se(v,{command:"addLayer",args:[D[U],ye]}),F.splice(F.length-O,0,U),B[U]=!0);for(let O=0;O<T.length;O++)if(U=T[O],W=P[U],te=D[U],!B[U]&&!fe(W,te))if(fe(W.source,te.source)&&fe(W["source-layer"],te["source-layer"])&&fe(W.type,te.type)){for(le in qe(W.layout,te.layout,v,U,null,"setLayoutProperty"),qe(W.paint,te.paint,v,U,null,"setPaintProperty"),fe(W.filter,te.filter)||Se(v,{command:"setFilter",args:[U,te.filter]}),fe(W.minzoom,te.minzoom)&&fe(W.maxzoom,te.maxzoom)||Se(v,{command:"setLayerZoomRange",args:[U,te.minzoom,te.maxzoom]}),W)Object.prototype.hasOwnProperty.call(W,le)&&le!=="layout"&&le!=="paint"&&le!=="filter"&&le!=="metadata"&&le!=="minzoom"&&le!=="maxzoom"&&(le.indexOf("paint.")===0?qe(W[le],te[le],v,U,le.slice(6),"setPaintProperty"):fe(W[le],te[le])||Se(v,{command:"setLayerProperty",args:[U,le,te[le]]}));for(le in te)Object.prototype.hasOwnProperty.call(te,le)&&!Object.prototype.hasOwnProperty.call(W,le)&&le!=="layout"&&le!=="paint"&&le!=="filter"&&le!=="metadata"&&le!=="minzoom"&&le!=="maxzoom"&&(le.indexOf("paint.")===0?qe(W[le],te[le],v,U,le.slice(6),"setPaintProperty"):fe(W[le],te[le])||Se(v,{command:"setLayerProperty",args:[U,le,te[le]]}))}else Se(v,{command:"removeLayer",args:[U]}),ye=F[F.lastIndexOf(U)+1],Se(v,{command:"addLayer",args:[te,ye]})}(p,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},S.bL=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},S.bM=ut,S.bN=Xt,S.bO=class extends Ai{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},S.bP=wh,S.bQ=class extends Ai{constructor(r,t){super(r,t),this.current=Wd}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},S.bR=ln,S.bS=class extends Ai{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},S.bT=class extends Ai{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},S.bU=$e,S.bV=function(r,t){var n=Math.sin(t),o=Math.cos(t);return r[0]=o,r[1]=n,r[2]=0,r[3]=-n,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},S.bW=function(r,t,n){var o=t[0],u=t[1],p=t[2];return r[0]=o*n[0]+u*n[3]+p*n[6],r[1]=o*n[1]+u*n[4]+p*n[7],r[2]=o*n[2]+u*n[5]+p*n[8],r},S.bX=function(r,t,n,o,u,p,m){var _=1/(t-n),v=1/(o-u),w=1/(p-m);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*w,r[11]=0,r[12]=(t+n)*_,r[13]=(u+o)*v,r[14]=(m+p)*w,r[15]=1,r},S.bY=class extends Ai{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(4*r.length);for(let n=0;n<r.length;n++)t[4*n]=r[n].r,t[4*n+1]=r[n].g,t[4*n+2]=r[n].b,t[4*n+3]=r[n].a;this.gl.uniform4fv(this.location,t)}}},S.bZ=class extends Ai{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(r);this.gl.uniform1fv(this.location,t)}}},S.b_=class extends a{},S.ba=function(r,t,n){const o=new Float64Array(4);return Tt(o,r,t-90,n),o},S.bb=function(r,t,n,o){var u,p,m,_,v,w=t[0],T=t[1],P=t[2],D=t[3],F=n[0],B=n[1],U=n[2],W=n[3];return(p=w*F+T*B+P*U+D*W)<0&&(p=-p,F=-F,B=-B,U=-U,W=-W),1-p>dt?(u=Math.acos(p),m=Math.sin(u),_=Math.sin((1-o)*u)/m,v=Math.sin(o*u)/m):(_=1-o,v=o),r[0]=_*w+v*F,r[1]=_*T+v*B,r[2]=_*P+v*U,r[3]=_*D+v*W,r},S.bc=function(r){const t=new Float64Array(9);var n,o,u,p,m,_,v,w,T,P,D,F,B,U,W,te,ye,le;P=(u=(o=r)[0])*(v=u+u),D=(p=o[1])*v,B=(m=o[2])*v,U=m*(w=p+p),te=(_=o[3])*v,ye=_*w,le=_*(T=m+m),(n=t)[0]=1-(F=p*w)-(W=m*T),n[3]=D-le,n[6]=B+ye,n[1]=D+le,n[4]=1-P-W,n[7]=U-te,n[2]=B-ye,n[5]=U+te,n[8]=1-P-F;const O=Ui(-Math.asin(qt(t[2],-1,1)));let H,ce;return Math.hypot(t[5],t[8])<.001?(H=0,ce=-Ui(Math.atan2(t[3],t[4]))):(H=Ui(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),ce=Ui(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:H,pitch:O+90,bearing:ce}},S.bd=function(r,t){return r.roll==t.roll&&r.pitch==t.pitch&&r.bearing==t.bearing},S.be=oi,S.bf=jn,S.bg=sl,S.bh=Lc,S.bi=al,S.bj=gi,S.bk=st,S.bl=Wt,S.bm=function(r,t,n,o,u){return gi(o,u,qt((r-t)/(n-t),0,1))},S.bn=Qt,S.bo=function(){return new Float64Array(3)},S.bp=function(r,t,n,o){return r[0]=t[0]+n[0]*o,r[1]=t[1]+n[1]*o,r[2]=t[2]+n[2]*o,r},S.bq=Tt,S.br=function(r,t,n){var o=n[0],u=n[1],p=n[2],m=t[0],_=t[1],v=t[2],w=u*v-p*_,T=p*m-o*v,P=o*_-u*m,D=u*P-p*T,F=p*w-o*P,B=o*T-u*w,U=2*n[3];return T*=U,P*=U,F*=2,B*=2,r[0]=m+(w*=U)+(D*=2),r[1]=_+T+F,r[2]=v+P+B,r},S.bs=function(r,t,n){const o=(u=[r[0],r[1],r[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((T=u[8])*(m=u[4])-(_=u[5])*(w=u[7]))+u[1]*(-T*(p=u[3])+_*(v=u[6]))+u[2]*(w*p-m*v);var u,p,m,_,v,w,T;if(o===0)return null;const P=Dt([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),D=Dt([],[n[0],n[1],n[2]],[r[0],r[1],r[2]]),F=Dt([],[r[0],r[1],r[2]],[t[0],t[1],t[2]]),B=rt([],P,-r[3]);return et(B,B,rt([],D,-t[3])),et(B,B,rt([],F,-n[3])),rt(B,B,1/o),B},S.bt=Cp,S.bu=function(){return new Float64Array(4)},S.bv=function(r,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),p[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),p[2]=u[2],r[0]=p[0]+n[0],r[1]=p[1]+n[1],r[2]=p[2]+n[2],r},S.bw=function(r,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[0],p[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),p[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),r[0]=p[0]+n[0],r[1]=p[1]+n[1],r[2]=p[2]+n[2],r},S.bx=function(r,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),p[1]=u[1],p[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),r[0]=p[0]+n[0],r[1]=p[1]+n[1],r[2]=p[2]+n[2],r},S.by=function(r,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[0],m=t[1],_=t[2],v=t[3],w=t[8],T=t[9],P=t[10],D=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=p*u-w*o,r[1]=m*u-T*o,r[2]=_*u-P*o,r[3]=v*u-D*o,r[8]=p*o+w*u,r[9]=m*o+T*u,r[10]=_*o+P*u,r[11]=v*o+D*u,r},S.bz=function(r,t){const n=Qt(r,360),o=Qt(t,360),u=o-n,p=o>n?u-360:u+360;return Math.abs(u)<Math.abs(p)?u:p},S.c=ue,S.c0=class extends d{},S.c1=ep,S.c2=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},S.c3=Sm,S.c4=function(r,t,n){var o=t[0],u=t[1],p=t[2],m=n[3]*o+n[7]*u+n[11]*p+n[15];return r[0]=(n[0]*o+n[4]*u+n[8]*p+n[12])/(m=m||1),r[1]=(n[1]*o+n[5]*u+n[9]*p+n[13])/m,r[2]=(n[2]*o+n[6]*u+n[10]*p+n[14])/m,r},S.c5=class extends xc{},S.c6=class extends I{},S.c7=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},S.c8=function(r,t){var n=r[0],o=r[1],u=r[2],p=r[3],m=r[4],_=r[5],v=r[6],w=r[7],T=r[8],P=r[9],D=r[10],F=r[11],B=r[12],U=r[13],W=r[14],te=r[15],ye=t[0],le=t[1],O=t[2],H=t[3],ce=t[4],ze=t[5],We=t[6],Oe=t[7],Fe=t[8],it=t[9],Je=t[10],ot=t[11],Ne=t[12],St=t[13],Nt=t[14],Ft=t[15];return Math.abs(n-ye)<=dt*Math.max(1,Math.abs(n),Math.abs(ye))&&Math.abs(o-le)<=dt*Math.max(1,Math.abs(o),Math.abs(le))&&Math.abs(u-O)<=dt*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(p-H)<=dt*Math.max(1,Math.abs(p),Math.abs(H))&&Math.abs(m-ce)<=dt*Math.max(1,Math.abs(m),Math.abs(ce))&&Math.abs(_-ze)<=dt*Math.max(1,Math.abs(_),Math.abs(ze))&&Math.abs(v-We)<=dt*Math.max(1,Math.abs(v),Math.abs(We))&&Math.abs(w-Oe)<=dt*Math.max(1,Math.abs(w),Math.abs(Oe))&&Math.abs(T-Fe)<=dt*Math.max(1,Math.abs(T),Math.abs(Fe))&&Math.abs(P-it)<=dt*Math.max(1,Math.abs(P),Math.abs(it))&&Math.abs(D-Je)<=dt*Math.max(1,Math.abs(D),Math.abs(Je))&&Math.abs(F-ot)<=dt*Math.max(1,Math.abs(F),Math.abs(ot))&&Math.abs(B-Ne)<=dt*Math.max(1,Math.abs(B),Math.abs(Ne))&&Math.abs(U-St)<=dt*Math.max(1,Math.abs(U),Math.abs(St))&&Math.abs(W-Nt)<=dt*Math.max(1,Math.abs(W),Math.abs(Nt))&&Math.abs(te-Ft)<=dt*Math.max(1,Math.abs(te),Math.abs(Ft))},S.c9=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.cA=function(r){delete j.REGISTERED_PROTOCOLS[r]},S.cB=function(r,t){const n={};for(let u=0;u<r.length;u++){const p=t&&t[r[u].id]||Gs(r[u]);t&&(t[r[u].id]=p);let m=n[p];m||(m=n[p]=[]),m.push(r[u])}const o=[];for(const u in n)o.push(n[u]);return o},S.cC=_t,S.cD=Tg,S.cE=Mg,S.cF=ng,S.cG=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=xt/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Li(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Li(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Li(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:T}=r.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Li(w),r.canonical),o["text-size"].possiblyEvaluate(new Li(T),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:T}=r.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Li(w),r.canonical),o["icon-size"].possiblyEvaluate(new Li(T),r.canonical)]}const p=n.get("text-line-height")*mn,m=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",_=n.get("text-keep-upright"),v=n.get("text-size");for(const w of r.bucket.features){const T=n.get("text-font").evaluate(w,{},r.canonical).join(","),P=v.evaluate(w,{},r.canonical),D=u.layoutTextSize.evaluate(w,{},r.canonical),F=u.layoutIconSize.evaluate(w,{},r.canonical),B={horizontal:{},vertical:void 0},U=w.text;let W,te=[0,0];if(U){const O=U.toString(),H=n.get("text-letter-spacing").evaluate(w,{},r.canonical)*mn,ce=mh(O)?H:0,ze=n.get("text-anchor").evaluate(w,{},r.canonical),We=Bg(t,w,r.canonical);if(!We){const Je=n.get("text-radial-offset").evaluate(w,{},r.canonical);te=Je?Fg(ze,[Je*mn,Mp]):n.get("text-offset").evaluate(w,{},r.canonical).map(ot=>ot*mn)}let Oe=m?"center":n.get("text-justify").evaluate(w,{},r.canonical);const Fe=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(w,{},r.canonical)*mn:1/0,it=()=>{r.bucket.allowVerticalPlacement&&mc(O)&&(B.vertical=Ih(U,r.glyphMap,r.glyphPositions,r.imagePositions,T,Fe,p,ze,"left",ce,te,S.an.vertical,!0,D,P))};if(!m&&We){const Je=new Set;if(Oe==="auto")for(let Ne=0;Ne<We.values.length;Ne+=2)Je.add(kp(We.values[Ne]));else Je.add(Oe);let ot=!1;for(const Ne of Je)if(!B.horizontal[Ne])if(ot)B.horizontal[Ne]=B.horizontal[0];else{const St=Ih(U,r.glyphMap,r.glyphPositions,r.imagePositions,T,Fe,p,"center",Ne,ce,te,S.an.horizontal,!1,D,P);St&&(B.horizontal[Ne]=St,ot=St.positionedLines.length===1)}it()}else{Oe==="auto"&&(Oe=kp(ze));const Je=Ih(U,r.glyphMap,r.glyphPositions,r.imagePositions,T,Fe,p,ze,Oe,ce,te,S.an.horizontal,!1,D,P);Je&&(B.horizontal[Oe]=Je),it(),mc(O)&&m&&_&&(B.vertical=Ih(U,r.glyphMap,r.glyphPositions,r.imagePositions,T,Fe,p,ze,Oe,ce,te,S.an.vertical,!1,D,P))}}let ye=!1;if(w.icon&&w.icon.name){const O=r.imageMap[w.icon.name];O&&(W=Oy(r.imagePositions[w.icon.name],n.get("icon-offset").evaluate(w,{},r.canonical),n.get("icon-anchor").evaluate(w,{},r.canonical)),ye=!!O.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ye:r.bucket.sdfIcons!==ye&&Ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(O.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const le=Ng(B.horizontal)||B.vertical;r.bucket.iconsInText=!!le&&le.iconsInText,(le||W)&&Qy(r.bucket,w,B,W,r.imageMap,u,D,F,te,ye,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},S.cH=dp,S.cI=ap,S.cJ=hp,S.cK=Oc,S.cL=mp,S.cM=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},S.cN=function(r,t,n,o,u){return l(this,void 0,void 0,function*(){if(mt())try{return yield Di(r,t,n,o,u)}catch{}return function(p,m,_,v,w){const T=p.width,P=p.height;Ii&&ni||(Ii=new OffscreenCanvas(T,P),ni=Ii.getContext("2d",{willReadFrequently:!0})),Ii.width=T,Ii.height=P,ni.drawImage(p,0,0,T,P);const D=ni.getImageData(m,_,v,w);return ni.clearRect(0,0,T,P),D.data}(r,t,n,o,u)})},S.cO=Em,S.cP=ae,S.cQ=Pe,S.cR=Um,S.cS=tg,S.cT=$s,S.cU=Yr,S.ca=r=>r.type==="symbol",S.cb=r=>r.type==="circle",S.cc=r=>r.type==="heatmap",S.cd=r=>r.type==="line",S.ce=r=>r.type==="fill",S.cf=r=>r.type==="fill-extrusion",S.cg=r=>r.type==="hillshade",S.ch=r=>r.type==="color-relief",S.ci=r=>r.type==="raster",S.cj=r=>r.type==="background",S.ck=r=>r.type==="custom",S.cl=Yt,S.cm=function(r,t,n){const o=ft(t.x-n.x,t.y-n.y),u=ft(r.x-n.x,r.y-n.y);var p,m;return Ui(Math.atan2(o[0]*u[1]-o[1]*u[0],(p=o)[0]*(m=u)[0]+p[1]*m[1]))},S.cn=_i,S.co=function(r,t){return hn[t]&&(r instanceof MouseEvent||r instanceof WheelEvent)},S.cp=function(r,t){return nn[t]&&"touches"in r},S.cq=function(r){return nn[r]||hn[r]},S.cr=function(r,t,n){var o=t[0],u=t[1];return r[0]=n[0]*o+n[4]*u+n[12],r[1]=n[1]*o+n[5]*u+n[13],r},S.cs=function(r,t){const{x:n,y:o}=$c.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||n<0||n>=1)},S.ct=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},S.cu=class extends Kr{},S.cv=tv,S.cx=function(r){return r.message===At},S.cy=ne,S.cz=function(r,t){j.REGISTERED_PROTOCOLS[r]=t},S.d=Me,S.e=Ci,S.f=r=>l(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.g=q,S.h=r=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Yi})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(u):Yi}),S.i=$t,S.j=(r,t)=>be(Ci(r,{type:"json"}),t),S.k=de,S.l=Te,S.m=be,S.n=(r,t)=>be(Ci(r,{type:"arrayBuffer"}),t),S.o=function(r){return new mp(r).readFields(Ty,[])},S.p=ig,S.q=Pc,S.r=Bn,S.s=tn,S.t=vc,S.u=si,S.v=k,S.w=Ot,S.x=Vd,S.y=Ua,S.z=ea}),R("worker",["./shared"],function(S){class l{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,q){for(const ne of j){this._layerConfigs[ne.id]=ne;const pe=this._layers[ne.id]=S.bI(ne);pe._featureFilter=S.a9(pe.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of q)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const Z=S.cB(Object.values(this._layerConfigs),this.keyCache);for(const ne of Z){const pe=ne.map(de=>this._layers[de.id]),be=pe[0];if(be.visibility==="none")continue;const Me=be.source||"";let ve=this.familiesBySource[Me];ve||(ve=this.familiesBySource[Me]={});const Ae=be.sourceLayer||"_geojsonTileLayer";let Te=ve[Ae];Te||(Te=ve[Ae]=[]),Te.push(pe)}}}class ae{constructor(j){const q={},Z=[];for(const Me in j){const ve=j[Me],Ae=q[Me]={};for(const Te in ve){const de=ve[+Te];if(!de||de.bitmap.width===0||de.bitmap.height===0)continue;const z={x:0,y:0,w:de.bitmap.width+2,h:de.bitmap.height+2};Z.push(z),Ae[Te]={rect:z,metrics:de.metrics}}}const{w:ne,h:pe}=S.p(Z),be=new S.q({width:ne||1,height:pe||1});for(const Me in j){const ve=j[Me];for(const Ae in ve){const Te=ve[+Ae];if(!Te||Te.bitmap.width===0||Te.bitmap.height===0)continue;const de=q[Me][Ae].rect;S.q.copy(Te.bitmap,be,{x:0,y:0},{x:de.x+1,y:de.y+1},Te.bitmap)}}this.image=be,this.positions=q}}S.cC("GlyphAtlas",ae);class _e{constructor(j){this.tileID=new S.Z(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[],this.globalState=j.globalState}parse(j,q,Z,ne,pe){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new S.a7;const be=new S.cD(Object.keys(j.layers).sort()),Me=new S.cE(this.tileID,this.promoteId);Me.bucketLayerIDs=[];const ve={},Ae={featureIndex:Me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z,subdivisionGranularity:pe},Te=q.familiesBySource[this.source];for(const qe in Te){const yt=j.layers[qe];if(!yt)continue;yt.version===1&&S.w(`Vector tile source "${this.source}" layer "${qe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ht=be.encode(qe),K=[];for(let De=0;De<yt.length;De++){const je=yt.feature(De),Mt=Me.getId(je,qe);K.push({feature:je,id:Mt,index:De,sourceLayerIndex:Ht})}for(const De of Te[qe]){const je=De[0];je.source!==this.source&&S.w(`layer.source = ${je.source} does not equal this.source = ${this.source}`),je.minzoom&&this.zoom<Math.floor(je.minzoom)||je.maxzoom&&this.zoom>=je.maxzoom||je.visibility!=="none"&&(ee(De,this.zoom,Z),(ve[je.id]=je.createBucket({index:Me.bucketLayerIDs.length,layers:De,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ht,sourceID:this.source,globalState:this.globalState})).populate(K,Ae,this.tileID.canonical),Me.bucketLayerIDs.push(De.map(Mt=>Mt.id)))}}const de=S.bM(Ae.glyphDependencies,qe=>Object.keys(qe).map(Number));this.inFlightDependencies.forEach(qe=>qe==null?void 0:qe.abort()),this.inFlightDependencies=[];let z=Promise.resolve({});if(Object.keys(de).length){const qe=new AbortController;this.inFlightDependencies.push(qe),z=ne.sendAsync({type:"GG",data:{stacks:de,source:this.source,tileID:this.tileID,type:"glyphs"}},qe)}const k=Object.keys(Ae.iconDependencies);let V=Promise.resolve({});if(k.length){const qe=new AbortController;this.inFlightDependencies.push(qe),V=ne.sendAsync({type:"GI",data:{icons:k,source:this.source,tileID:this.tileID,type:"icons"}},qe)}const Q=Object.keys(Ae.patternDependencies);let fe=Promise.resolve({});if(Q.length){const qe=new AbortController;this.inFlightDependencies.push(qe),fe=ne.sendAsync({type:"GI",data:{icons:Q,source:this.source,tileID:this.tileID,type:"patterns"}},qe)}const[Se,Be,Ve]=yield Promise.all([z,V,fe]),nt=new ae(Se),Ze=new S.cF(Be,Ve);for(const qe in ve){const yt=ve[qe];yt instanceof S.a8?(ee(yt.layers,this.zoom,Z),S.cG({bucket:yt,glyphMap:Se,glyphPositions:nt.positions,imageMap:Be,imagePositions:Ze.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ae.subdivisionGranularity})):yt.hasPattern&&(yt instanceof S.cH||yt instanceof S.cI||yt instanceof S.cJ)&&(ee(yt.layers,this.zoom,Z),yt.addFeatures(Ae,this.tileID.canonical,Ze.patternPositions))}return this.status="done",{buckets:Object.values(ve).filter(qe=>!qe.isEmpty()),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nt.image,imageAtlas:Ze,glyphMap:this.returnDependencies?Se:null,iconMap:this.returnDependencies?Be:null,glyphPositions:this.returnDependencies?nt.positions:null}})}}function ee(ue,j,q){const Z=new S.F(j);for(const ne of ue)ne.recalculate(Z,q)}class Pe{constructor(j,q,Z){this.actor=j,this.layerIndex=q,this.availableImages=Z,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,q){return S._(this,void 0,void 0,function*(){const Z=yield S.n(j.request,q);try{return{vectorTile:new S.cK.VectorTile(new S.cL(Z.data)),rawData:Z.data,cacheControl:Z.cacheControl,expires:Z.expires}}catch(ne){const pe=new Uint8Array(Z.data);let be=`Unable to parse the tile at ${j.request.url}, `;throw be+=pe[0]===31&&pe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ne.message}`,new Error(be)}})}loadTile(j){return S._(this,void 0,void 0,function*(){const q=j.uid,Z=!!(j&&j.request&&j.request.collectResourceTiming)&&new S.cM(j.request),ne=new _e(j);this.loading[q]=ne;const pe=new AbortController;ne.abort=pe;try{const be=yield this.loadVectorTile(j,pe);if(delete this.loading[q],!be)return null;const Me=be.rawData,ve={};be.expires&&(ve.expires=be.expires),be.cacheControl&&(ve.cacheControl=be.cacheControl);const Ae={};if(Z){const de=Z.finish();de&&(Ae.resourceTiming=JSON.parse(JSON.stringify(de)))}ne.vectorTile=be.vectorTile;const Te=ne.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);this.loaded[q]=ne,this.fetching[q]={rawTileData:Me,cacheControl:ve,resourceTiming:Ae};try{const de=yield Te;return S.e({rawTileData:Me.slice(0)},de,ve,Ae)}finally{delete this.fetching[q]}}catch(be){throw delete this.loading[q],ne.status="done",this.loaded[q]=ne,be}})}reloadTile(j){return S._(this,void 0,void 0,function*(){const q=j.uid;if(!this.loaded||!this.loaded[q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Z=this.loaded[q];if(Z.showCollisionBoxes=j.showCollisionBoxes,Z.globalState=j.globalState,Z.status==="parsing"){const ne=yield Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);let pe;if(this.fetching[q]){const{rawTileData:be,cacheControl:Me,resourceTiming:ve}=this.fetching[q];delete this.fetching[q],pe=S.e({rawTileData:be.slice(0)},ne,Me,ve)}else pe=ne;return pe}if(Z.status==="done"&&Z.vectorTile)return Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity)})}abortTile(j){return S._(this,void 0,void 0,function*(){const q=this.loading,Z=j.uid;q&&q[Z]&&q[Z].abort&&(q[Z].abort.abort(),delete q[Z])})}removeTile(j){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class Ce{constructor(){this.loaded={}}loadTile(j){return S._(this,void 0,void 0,function*(){const{uid:q,encoding:Z,rawImageData:ne,redFactor:pe,greenFactor:be,blueFactor:Me,baseShift:ve}=j,Ae=ne.width+2,Te=ne.height+2,de=S.b(ne)?new S.R({width:Ae,height:Te},yield S.cN(ne,-1,-1,Ae,Te)):ne,z=new S.cO(q,de,Z,pe,be,Me,ve);return this.loaded=this.loaded||{},this.loaded[q]=z,z})}removeTile(j){const q=this.loaded,Z=j.uid;q&&q[Z]&&delete q[Z]}}var N,ge,Ee=function(){if(ge)return N;function ue(q,Z){if(q.length!==0){j(q[0],Z);for(var ne=1;ne<q.length;ne++)j(q[ne],!Z)}}function j(q,Z){for(var ne=0,pe=0,be=0,Me=q.length,ve=Me-1;be<Me;ve=be++){var Ae=(q[be][0]-q[ve][0])*(q[ve][1]+q[be][1]),Te=ne+Ae;pe+=Math.abs(ne)>=Math.abs(Ae)?ne-Te+Ae:Ae-Te+ne,ne=Te}ne+pe>=0!=!!Z&&q.reverse()}return ge=1,N=function q(Z,ne){var pe,be=Z&&Z.type;if(be==="FeatureCollection")for(pe=0;pe<Z.features.length;pe++)q(Z.features[pe],ne);else if(be==="GeometryCollection")for(pe=0;pe<Z.geometries.length;pe++)q(Z.geometries[pe],ne);else if(be==="Feature")q(Z.geometry,ne);else if(be==="Polygon")ue(Z.coordinates,ne);else if(be==="MultiPolygon")for(pe=0;pe<Z.coordinates.length;pe++)ue(Z.coordinates[pe],ne);return Z}}(),He=S.cP(Ee);const tt=S.cK.VectorTileFeature.prototype.toGeoJSON;class Ge{constructor(j){this._feature=j,this.extent=S.$,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))}loadGeometry(){if(this._feature.type===1){const j=[];for(const q of this._feature.geometry)j.push([new S.P(q[0],q[1])]);return j}{const j=[];for(const q of this._feature.geometry){const Z=[];for(const ne of q)Z.push(new S.P(ne[0],ne[1]));j.push(Z)}return j}}toGeoJSON(j,q,Z){return tt.call(this,j,q,Z)}}class Ye{constructor(j){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.$,this.length=j.length,this._features=j}feature(j){return new Ge(this._features[j])}}var mt,dt,pt,$e={exports:{}},bt=function(){if(pt)return $e.exports;pt=1;var ue=S.cS(),j=function(){if(dt)return mt;dt=1;var Te=S.cQ(),de=S.cR().VectorTileFeature;function z(V,Q){this.options=Q||{},this.features=V,this.length=V.length}function k(V,Q){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=Q||4096}return mt=z,z.prototype.feature=function(V){return new k(this.features[V],this.options.extent)},k.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var Q=0;Q<V.length;Q++){for(var fe=V[Q],Se=[],Be=0;Be<fe.length;Be++)Se.push(new Te(fe[Be][0],fe[Be][1]));this.geometry.push(Se)}return this.geometry},k.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,Q=1/0,fe=-1/0,Se=1/0,Be=-1/0,Ve=0;Ve<V.length;Ve++)for(var nt=V[Ve],Ze=0;Ze<nt.length;Ze++){var qe=nt[Ze];Q=Math.min(Q,qe.x),fe=Math.max(fe,qe.x),Se=Math.min(Se,qe.y),Be=Math.max(Be,qe.y)}return[Q,Se,fe,Be]},k.prototype.toGeoJSON=de.prototype.toGeoJSON,mt}();function q(Te){var de=new ue;return function(z,k){for(var V in z.layers)k.writeMessage(3,Z,z.layers[V])}(Te,de),de.finish()}function Z(Te,de){var z;de.writeVarintField(15,Te.version||1),de.writeStringField(1,Te.name||""),de.writeVarintField(5,Te.extent||4096);var k={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<Te.length;z++)k.feature=Te.feature(z),de.writeMessage(2,ne,k);var V=k.keys;for(z=0;z<V.length;z++)de.writeStringField(3,V[z]);var Q=k.values;for(z=0;z<Q.length;z++)de.writeMessage(4,Ae,Q[z])}function ne(Te,de){var z=Te.feature;z.id!==void 0&&de.writeVarintField(1,z.id),de.writeMessage(2,pe,Te),de.writeVarintField(3,z.type),de.writeMessage(4,ve,z)}function pe(Te,de){var z=Te.feature,k=Te.keys,V=Te.values,Q=Te.keycache,fe=Te.valuecache;for(var Se in z.properties){var Be=z.properties[Se],Ve=Q[Se];if(Be!==null){Ve===void 0&&(k.push(Se),Q[Se]=Ve=k.length-1),de.writeVarint(Ve);var nt=typeof Be;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(Be=JSON.stringify(Be));var Ze=nt+":"+Be,qe=fe[Ze];qe===void 0&&(V.push(Be),fe[Ze]=qe=V.length-1),de.writeVarint(qe)}}}function be(Te,de){return(de<<3)+(7&Te)}function Me(Te){return Te<<1^Te>>31}function ve(Te,de){for(var z=Te.loadGeometry(),k=Te.type,V=0,Q=0,fe=z.length,Se=0;Se<fe;Se++){var Be=z[Se],Ve=1;k===1&&(Ve=Be.length),de.writeVarint(be(1,Ve));for(var nt=k===3?Be.length-1:Be.length,Ze=0;Ze<nt;Ze++){Ze===1&&k!==1&&de.writeVarint(be(2,nt-1));var qe=Be[Ze].x-V,yt=Be[Ze].y-Q;de.writeVarint(Me(qe)),de.writeVarint(Me(yt)),V+=qe,Q+=yt}k===3&&de.writeVarint(be(7,1))}}function Ae(Te,de){var z=typeof Te;z==="string"?de.writeStringField(1,Te):z==="boolean"?de.writeBooleanField(7,Te):z==="number"&&(Te%1!=0?de.writeDoubleField(3,Te):Te<0?de.writeSVarintField(6,Te):de.writeVarintField(5,Te))}return $e.exports=q,$e.exports.fromVectorTileJs=q,$e.exports.fromGeojsonVt=function(Te,de){de=de||{};var z={};for(var k in Te)z[k]=new j(Te[k].features,de),z[k].name=k,z[k].version=de.version,z[k].extent=de.extent;return q({layers:z})},$e.exports.GeoJSONWrapper=j,$e.exports}(),Pt=S.cP(bt);const Qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},Ke=Math.fround||(et=new Float32Array(1),ue=>(et[0]=+ue,et[0]));var et;class rt{constructor(j){this.options=Object.assign(Object.create(Qe),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:q,minZoom:Z,maxZoom:ne}=this.options;q&&console.time("total time");const pe=`prepare ${j.length} points`;q&&console.time(pe),this.points=j;const be=[];for(let ve=0;ve<j.length;ve++){const Ae=j[ve];if(!Ae.geometry)continue;const[Te,de]=Ae.geometry.coordinates,z=Ke(ei(Te)),k=Ke(Zt(de));be.push(z,k,1/0,ve,-1,1),this.options.reduce&&be.push(0)}let Me=this.trees[ne+1]=this._createTree(be);q&&console.timeEnd(pe);for(let ve=ne;ve>=Z;ve--){const Ae=+Date.now();Me=this.trees[ve]=this._createTree(this._cluster(Me,ve)),q&&console.log("z%d: %d clusters in %dms",ve,Me.numItems,+Date.now()-Ae)}return q&&console.timeEnd("total time"),this}getClusters(j,q){let Z=((j[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,j[1]));let pe=j[2]===180?180:((j[2]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)Z=-180,pe=180;else if(Z>pe){const de=this.getClusters([Z,ne,180,be],q),z=this.getClusters([-180,ne,pe,be],q);return de.concat(z)}const Me=this.trees[this._limitZoom(q)],ve=Me.range(ei(Z),Zt(be),ei(pe),Zt(ne)),Ae=Me.data,Te=[];for(const de of ve){const z=this.stride*de;Te.push(Ae[z+5]>1?Dt(Ae,z,this.clusterProps):this.points[Ae[z+3]])}return Te}getChildren(j){const q=this._getOriginId(j),Z=this._getOriginZoom(j),ne="No cluster with the specified id.",pe=this.trees[Z];if(!pe)throw new Error(ne);const be=pe.data;if(q*this.stride>=be.length)throw new Error(ne);const Me=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),ve=pe.within(be[q*this.stride],be[q*this.stride+1],Me),Ae=[];for(const Te of ve){const de=Te*this.stride;be[de+4]===j&&Ae.push(be[de+5]>1?Dt(be,de,this.clusterProps):this.points[be[de+3]])}if(Ae.length===0)throw new Error(ne);return Ae}getLeaves(j,q,Z){const ne=[];return this._appendLeaves(ne,j,q=q||10,Z=Z||0,0),ne}getTile(j,q,Z){const ne=this.trees[this._limitZoom(j)],pe=Math.pow(2,j),{extent:be,radius:Me}=this.options,ve=Me/be,Ae=(Z-ve)/pe,Te=(Z+1+ve)/pe,de={features:[]};return this._addTileFeatures(ne.range((q-ve)/pe,Ae,(q+1+ve)/pe,Te),ne.data,q,Z,pe,de),q===0&&this._addTileFeatures(ne.range(1-ve/pe,Ae,1,Te),ne.data,pe,Z,pe,de),q===pe-1&&this._addTileFeatures(ne.range(0,Ae,ve/pe,Te),ne.data,-1,Z,pe,de),de.features.length?de:null}getClusterExpansionZoom(j){let q=this._getOriginZoom(j)-1;for(;q<=this.options.maxZoom;){const Z=this.getChildren(j);if(q++,Z.length!==1)break;j=Z[0].properties.cluster_id}return q}_appendLeaves(j,q,Z,ne,pe){const be=this.getChildren(q);for(const Me of be){const ve=Me.properties;if(ve&&ve.cluster?pe+ve.point_count<=ne?pe+=ve.point_count:pe=this._appendLeaves(j,ve.cluster_id,Z,ne,pe):pe<ne?pe++:j.push(Me),j.length===Z)break}return pe}_createTree(j){const q=new S.aH(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<j.length;Z+=this.stride)q.add(j[Z],j[Z+1]);return q.finish(),q.data=j,q}_addTileFeatures(j,q,Z,ne,pe,be){for(const Me of j){const ve=Me*this.stride,Ae=q[ve+5]>1;let Te,de,z;if(Ae)Te=It(q,ve,this.clusterProps),de=q[ve],z=q[ve+1];else{const Q=this.points[q[ve+3]];Te=Q.properties;const[fe,Se]=Q.geometry.coordinates;de=ei(fe),z=Zt(Se)}const k={type:1,geometry:[[Math.round(this.options.extent*(de*pe-Z)),Math.round(this.options.extent*(z*pe-ne))]],tags:Te};let V;V=Ae||this.options.generateId?q[ve+3]:this.points[q[ve+3]].id,V!==void 0&&(k.id=V),be.features.push(k)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,q){const{radius:Z,extent:ne,reduce:pe,minPoints:be}=this.options,Me=Z/(ne*Math.pow(2,q)),ve=j.data,Ae=[],Te=this.stride;for(let de=0;de<ve.length;de+=Te){if(ve[de+2]<=q)continue;ve[de+2]=q;const z=ve[de],k=ve[de+1],V=j.within(ve[de],ve[de+1],Me),Q=ve[de+5];let fe=Q;for(const Se of V){const Be=Se*Te;ve[Be+2]>q&&(fe+=ve[Be+5])}if(fe>Q&&fe>=be){let Se,Be=z*Q,Ve=k*Q,nt=-1;const Ze=(de/Te<<5)+(q+1)+this.points.length;for(const qe of V){const yt=qe*Te;if(ve[yt+2]<=q)continue;ve[yt+2]=q;const Ht=ve[yt+5];Be+=ve[yt]*Ht,Ve+=ve[yt+1]*Ht,ve[yt+4]=Ze,pe&&(Se||(Se=this._map(ve,de,!0),nt=this.clusterProps.length,this.clusterProps.push(Se)),pe(Se,this._map(ve,yt)))}ve[de+4]=Ze,Ae.push(Be/fe,Ve/fe,1/0,Ze,-1,fe),pe&&Ae.push(nt)}else{for(let Se=0;Se<Te;Se++)Ae.push(ve[de+Se]);if(fe>1)for(const Se of V){const Be=Se*Te;if(!(ve[Be+2]<=q)){ve[Be+2]=q;for(let Ve=0;Ve<Te;Ve++)Ae.push(ve[Be+Ve])}}}}return Ae}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,q,Z){if(j[q+5]>1){const be=this.clusterProps[j[q+6]];return Z?Object.assign({},be):be}const ne=this.points[j[q+3]].properties,pe=this.options.map(ne);return Z&&pe===ne?Object.assign({},pe):pe}}function Dt(ue,j,q){return{type:"Feature",id:ue[j+3],properties:It(ue,j,q),geometry:{type:"Point",coordinates:[(Z=ue[j],360*(Z-.5)),Rt(ue[j+1])]}};var Z}function It(ue,j,q){const Z=ue[j+5],ne=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,pe=ue[j+6],be=pe===-1?{}:Object.assign({},q[pe]);return Object.assign(be,{cluster:!0,cluster_id:ue[j+3],point_count:Z,point_count_abbreviated:ne})}function ei(ue){return ue/360+.5}function Zt(ue){const j=Math.sin(ue*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function Rt(ue){const j=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function Tt(ue,j,q,Z){let ne=Z;const pe=j+(q-j>>1);let be,Me=q-j;const ve=ue[j],Ae=ue[j+1],Te=ue[q],de=ue[q+1];for(let z=j+3;z<q;z+=3){const k=at(ue[z],ue[z+1],ve,Ae,Te,de);if(k>ne)be=z,ne=k;else if(k===ne){const V=Math.abs(z-pe);V<Me&&(be=z,Me=V)}}ne>Z&&(be-j>3&&Tt(ue,j,be,Z),ue[be+2]=ne,q-be>3&&Tt(ue,be,q,Z))}function at(ue,j,q,Z,ne,pe){let be=ne-q,Me=pe-Z;if(be!==0||Me!==0){const ve=((ue-q)*be+(j-Z)*Me)/(be*be+Me*Me);ve>1?(q=ne,Z=pe):ve>0&&(q+=be*ve,Z+=Me*ve)}return be=ue-q,Me=j-Z,be*be+Me*Me}function ft(ue,j,q,Z){const ne={id:ue??null,type:j,geometry:q,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")xt(ne,q);else if(j==="Polygon")xt(ne,q[0]);else if(j==="MultiLineString")for(const pe of q)xt(ne,pe);else if(j==="MultiPolygon")for(const pe of q)xt(ne,pe[0]);return ne}function xt(ue,j){for(let q=0;q<j.length;q+=3)ue.minX=Math.min(ue.minX,j[q]),ue.minY=Math.min(ue.minY,j[q+1]),ue.maxX=Math.max(ue.maxX,j[q]),ue.maxY=Math.max(ue.maxY,j[q+1])}function ii(ue,j,q,Z){if(!j.geometry)return;const ne=j.geometry.coordinates;if(ne&&ne.length===0)return;const pe=j.geometry.type,be=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2);let Me=[],ve=j.id;if(q.promoteId?ve=j.properties[q.promoteId]:q.generateId&&(ve=Z||0),pe==="Point")Qt(ne,Me);else if(pe==="MultiPoint")for(const Ae of ne)Qt(Ae,Me);else if(pe==="LineString")gi(ne,Me,be,!1);else if(pe==="MultiLineString"){if(q.lineMetrics){for(const Ae of ne)Me=[],gi(Ae,Me,be,!1),ue.push(ft(ve,"LineString",Me,j.properties));return}st(ne,Me,be,!1)}else if(pe==="Polygon")st(ne,Me,be,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(const Ae of j.geometry.geometries)ii(ue,{id:ve,geometry:Ae,properties:j.properties},q,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ae of ne){const Te=[];st(Ae,Te,be,!0),Me.push(Te)}}ue.push(ft(ve,pe,Me,j.properties))}function Qt(ue,j){j.push(Yt(ue[0]),_i(ue[1]),0)}function gi(ue,j,q,Z){let ne,pe,be=0;for(let ve=0;ve<ue.length;ve++){const Ae=Yt(ue[ve][0]),Te=_i(ue[ve][1]);j.push(Ae,Te,0),ve>0&&(be+=Z?(ne*Te-Ae*pe)/2:Math.sqrt(Math.pow(Ae-ne,2)+Math.pow(Te-pe,2))),ne=Ae,pe=Te}const Me=j.length-3;j[2]=1,Tt(j,0,Me,q),j[Me+2]=1,j.size=Math.abs(be),j.start=0,j.end=j.size}function st(ue,j,q,Z){for(let ne=0;ne<ue.length;ne++){const pe=[];gi(ue[ne],pe,q,Z),j.push(pe)}}function Yt(ue){return ue/360+.5}function _i(ue){const j=Math.sin(ue*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function qt(ue,j,q,Z,ne,pe,be,Me){if(Z/=j,pe>=(q/=j)&&be<Z)return ue;if(be<q||pe>=Z)return null;const ve=[];for(const Ae of ue){const Te=Ae.geometry;let de=Ae.type;const z=ne===0?Ae.minX:Ae.minY,k=ne===0?Ae.maxX:Ae.maxY;if(z>=q&&k<Z){ve.push(Ae);continue}if(k<q||z>=Z)continue;let V=[];if(de==="Point"||de==="MultiPoint")fi(Te,V,q,Z,ne);else if(de==="LineString")Ci(Te,V,q,Z,ne,!1,Me.lineMetrics);else if(de==="MultiLineString")ut(Te,V,q,Z,ne,!1);else if(de==="Polygon")ut(Te,V,q,Z,ne,!0);else if(de==="MultiPolygon")for(const Q of Te){const fe=[];ut(Q,fe,q,Z,ne,!0),fe.length&&V.push(fe)}if(V.length){if(Me.lineMetrics&&de==="LineString"){for(const Q of V)ve.push(ft(Ae.id,de,Q,Ae.tags));continue}de!=="LineString"&&de!=="MultiLineString"||(V.length===1?(de="LineString",V=V[0]):de="MultiLineString"),de!=="Point"&&de!=="MultiPoint"||(de=V.length===3?"Point":"MultiPoint"),ve.push(ft(Ae.id,de,V,Ae.tags))}}return ve.length?ve:null}function fi(ue,j,q,Z,ne){for(let pe=0;pe<ue.length;pe+=3){const be=ue[pe+ne];be>=q&&be<=Z&&Xt(j,ue[pe],ue[pe+1],ue[pe+2])}}function Ci(ue,j,q,Z,ne,pe,be){let Me=Wi(ue);const ve=ne===0?we:ht;let Ae,Te,de=ue.start;for(let fe=0;fe<ue.length-3;fe+=3){const Se=ue[fe],Be=ue[fe+1],Ve=ue[fe+2],nt=ue[fe+3],Ze=ue[fe+4],qe=ne===0?Se:Be,yt=ne===0?nt:Ze;let Ht=!1;be&&(Ae=Math.sqrt(Math.pow(Se-nt,2)+Math.pow(Be-Ze,2))),qe<q?yt>q&&(Te=ve(Me,Se,Be,nt,Ze,q),be&&(Me.start=de+Ae*Te)):qe>Z?yt<Z&&(Te=ve(Me,Se,Be,nt,Ze,Z),be&&(Me.start=de+Ae*Te)):Xt(Me,Se,Be,Ve),yt<q&&qe>=q&&(Te=ve(Me,Se,Be,nt,Ze,q),Ht=!0),yt>Z&&qe<=Z&&(Te=ve(Me,Se,Be,nt,Ze,Z),Ht=!0),!pe&&Ht&&(be&&(Me.end=de+Ae*Te),j.push(Me),Me=Wi(ue)),be&&(de+=Ae)}let z=ue.length-3;const k=ue[z],V=ue[z+1],Q=ne===0?k:V;Q>=q&&Q<=Z&&Xt(Me,k,V,ue[z+2]),z=Me.length-3,pe&&z>=3&&(Me[z]!==Me[0]||Me[z+1]!==Me[1])&&Xt(Me,Me[0],Me[1],Me[2]),Me.length&&j.push(Me)}function Wi(ue){const j=[];return j.size=ue.size,j.start=ue.start,j.end=ue.end,j}function ut(ue,j,q,Z,ne,pe){for(const be of ue)Ci(be,j,q,Z,ne,pe,!1)}function Xt(ue,j,q,Z){ue.push(j,q,Z)}function we(ue,j,q,Z,ne,pe){const be=(pe-j)/(Z-j);return Xt(ue,pe,q+(ne-q)*be,1),be}function ht(ue,j,q,Z,ne,pe){const be=(pe-q)/(ne-q);return Xt(ue,j+(Z-j)*be,pe,1),be}function Ot(ue,j){const q=[];for(let Z=0;Z<ue.length;Z++){const ne=ue[Z],pe=ne.type;let be;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")be=Et(ne.geometry,j);else if(pe==="MultiLineString"||pe==="Polygon"){be=[];for(const Me of ne.geometry)be.push(Et(Me,j))}else if(pe==="MultiPolygon"){be=[];for(const Me of ne.geometry){const ve=[];for(const Ae of Me)ve.push(Et(Ae,j));be.push(ve)}}q.push(ft(ne.id,pe,be,ne.tags))}return q}function Et(ue,j){const q=[];q.size=ue.size,ue.start!==void 0&&(q.start=ue.start,q.end=ue.end);for(let Z=0;Z<ue.length;Z+=3)q.push(ue[Z]+j,ue[Z+1],ue[Z+2]);return q}function $t(ue,j){if(ue.transformed)return ue;const q=1<<ue.z,Z=ue.x,ne=ue.y;for(const pe of ue.features){const be=pe.geometry,Me=pe.type;if(pe.geometry=[],Me===1)for(let ve=0;ve<be.length;ve+=2)pe.geometry.push(jt(be[ve],be[ve+1],j,q,Z,ne));else for(let ve=0;ve<be.length;ve++){const Ae=[];for(let Te=0;Te<be[ve].length;Te+=2)Ae.push(jt(be[ve][Te],be[ve][Te+1],j,q,Z,ne));pe.geometry.push(Ae)}}return ue.transformed=!0,ue}function jt(ue,j,q,Z,ne,pe){return[Math.round(q*(ue*Z-ne)),Math.round(q*(j*Z-pe))]}function Pi(ue,j,q,Z,ne){const pe=j===ne.maxZoom?0:ne.tolerance/((1<<j)*ne.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:ue.length,source:null,x:q,y:Z,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Me of ue)Yi(be,Me,pe,ne);return be}function Yi(ue,j,q,Z){const ne=j.geometry,pe=j.type,be=[];if(ue.minX=Math.min(ue.minX,j.minX),ue.minY=Math.min(ue.minY,j.minY),ue.maxX=Math.max(ue.maxX,j.maxX),ue.maxY=Math.max(ue.maxY,j.maxY),pe==="Point"||pe==="MultiPoint")for(let Me=0;Me<ne.length;Me+=3)be.push(ne[Me],ne[Me+1]),ue.numPoints++,ue.numSimplified++;else if(pe==="LineString")Di(be,ne,ue,q,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(let Me=0;Me<ne.length;Me++)Di(be,ne[Me],ue,q,pe==="Polygon",Me===0);else if(pe==="MultiPolygon")for(let Me=0;Me<ne.length;Me++){const ve=ne[Me];for(let Ae=0;Ae<ve.length;Ae++)Di(be,ve[Ae],ue,q,!0,Ae===0)}if(be.length){let Me=j.tags||null;if(pe==="LineString"&&Z.lineMetrics){Me={};for(const Ae in j.tags)Me[Ae]=j.tags[Ae];Me.mapbox_clip_start=ne.start/ne.size,Me.mapbox_clip_end=ne.end/ne.size}const ve={geometry:be,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Me};j.id!==null&&(ve.id=j.id),ue.features.push(ve)}}function Di(ue,j,q,Z,ne,pe){const be=Z*Z;if(Z>0&&j.size<(ne?be:Z))return void(q.numPoints+=j.length/3);const Me=[];for(let ve=0;ve<j.length;ve+=3)(Z===0||j[ve+2]>be)&&(q.numSimplified++,Me.push(j[ve],j[ve+1])),q.numPoints++;ne&&function(ve,Ae){let Te=0;for(let de=0,z=ve.length,k=z-2;de<z;k=de,de+=2)Te+=(ve[de]-ve[k])*(ve[de+1]+ve[k+1]);if(Te>0===Ae)for(let de=0,z=ve.length;de<z/2;de+=2){const k=ve[de],V=ve[de+1];ve[de]=ve[z-2-de],ve[de+1]=ve[z-1-de],ve[z-2-de]=k,ve[z-1-de]=V}}(Me,pe),ue.push(Me)}const Ii={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ni{constructor(j,q){const Z=(q=this.options=function(pe,be){for(const Me in be)pe[Me]=be[Me];return pe}(Object.create(Ii),q)).debug;if(Z&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");let ne=function(pe,be){const Me=[];if(pe.type==="FeatureCollection")for(let ve=0;ve<pe.features.length;ve++)ii(Me,pe.features[ve],be,ve);else ii(Me,pe.type==="Feature"?pe:{geometry:pe},be);return Me}(j,q);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=function(pe,be){const Me=be.buffer/be.extent;let ve=pe;const Ae=qt(pe,1,-1-Me,Me,0,-1,2,be),Te=qt(pe,1,1-Me,2+Me,0,-1,2,be);return(Ae||Te)&&(ve=qt(pe,1,-Me,1+Me,0,-1,2,be)||[],Ae&&(ve=Ot(Ae,1).concat(ve)),Te&&(ve=ve.concat(Ot(Te,-1)))),ve}(ne,q),ne.length&&this.splitTile(ne,0,0,0),Z&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,q,Z,ne,pe,be,Me){const ve=[j,q,Z,ne],Ae=this.options,Te=Ae.debug;for(;ve.length;){ne=ve.pop(),Z=ve.pop(),q=ve.pop(),j=ve.pop();const de=1<<q,z=tn(q,Z,ne);let k=this.tiles[z];if(!k&&(Te>1&&console.time("creation"),k=this.tiles[z]=Pi(j,q,Z,ne,Ae),this.tileCoords.push({z:q,x:Z,y:ne}),Te)){Te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,Z,ne,k.numFeatures,k.numPoints,k.numSimplified),console.timeEnd("creation"));const Ht=`z${q}`;this.stats[Ht]=(this.stats[Ht]||0)+1,this.total++}if(k.source=j,pe==null){if(q===Ae.indexMaxZoom||k.numPoints<=Ae.indexMaxPoints)continue}else{if(q===Ae.maxZoom||q===pe)continue;if(pe!=null){const Ht=pe-q;if(Z!==be>>Ht||ne!==Me>>Ht)continue}}if(k.source=null,j.length===0)continue;Te>1&&console.time("clipping");const V=.5*Ae.buffer/Ae.extent,Q=.5-V,fe=.5+V,Se=1+V;let Be=null,Ve=null,nt=null,Ze=null,qe=qt(j,de,Z-V,Z+fe,0,k.minX,k.maxX,Ae),yt=qt(j,de,Z+Q,Z+Se,0,k.minX,k.maxX,Ae);j=null,qe&&(Be=qt(qe,de,ne-V,ne+fe,1,k.minY,k.maxY,Ae),Ve=qt(qe,de,ne+Q,ne+Se,1,k.minY,k.maxY,Ae),qe=null),yt&&(nt=qt(yt,de,ne-V,ne+fe,1,k.minY,k.maxY,Ae),Ze=qt(yt,de,ne+Q,ne+Se,1,k.minY,k.maxY,Ae),yt=null),Te>1&&console.timeEnd("clipping"),ve.push(Be||[],q+1,2*Z,2*ne),ve.push(Ve||[],q+1,2*Z,2*ne+1),ve.push(nt||[],q+1,2*Z+1,2*ne),ve.push(Ze||[],q+1,2*Z+1,2*ne+1)}}getTile(j,q,Z){j=+j,q=+q,Z=+Z;const ne=this.options,{extent:pe,debug:be}=ne;if(j<0||j>24)return null;const Me=1<<j,ve=tn(j,q=q+Me&Me-1,Z);if(this.tiles[ve])return $t(this.tiles[ve],pe);be>1&&console.log("drilling down to z%d-%d-%d",j,q,Z);let Ae,Te=j,de=q,z=Z;for(;!Ae&&Te>0;)Te--,de>>=1,z>>=1,Ae=this.tiles[tn(Te,de,z)];return Ae&&Ae.source?(be>1&&(console.log("found parent tile z%d-%d-%d",Te,de,z),console.time("drilling down")),this.splitTile(Ae.source,Te,de,z,j,q,Z),be>1&&console.timeEnd("drilling down"),this.tiles[ve]?$t(this.tiles[ve],pe):null):null}}function tn(ue,j,q){return 32*((1<<ue)*q+j)+ue}function Ti(ue,j){return j?ue.properties[j]:ue.id}function Ui(ue,j){if(ue==null)return!0;if(ue.type==="Feature")return Ti(ue,j)!=null;if(ue.type==="FeatureCollection"){const q=new Set;for(const Z of ue.features){const ne=Ti(Z,j);if(ne==null||q.has(ne))return!1;q.add(ne)}return!0}return!1}function nn(ue,j){const q=new Map;if(ue!=null)if(ue.type==="Feature")q.set(Ti(ue,j),ue);else for(const Z of ue.features)q.set(Ti(Z,j),Z);return q}class hn extends Pe{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,q){return S._(this,void 0,void 0,function*(){const Z=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ne=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!ne)return null;const pe=new Ye(ne.features);let be=Pt(pe);return be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),{vectorTile:pe,rawData:be.buffer}})}loadData(j){return S._(this,void 0,void 0,function*(){var q;(q=this._pendingRequest)===null||q===void 0||q.abort();const Z=!!(j&&j.request&&j.request.collectResourceTiming)&&new S.cM(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new rt(function({superclusterOptions:be,clusterProperties:Me}){if(!Me||!be)return be;const ve={},Ae={},Te={accumulated:null,zoom:0},de={properties:null},z=Object.keys(Me);for(const k of z){const[V,Q]=Me[k],fe=S.cT(Q),Se=S.cT(typeof V=="string"?[V,["accumulated"],["get",k]]:V);ve[k]=fe.value,Ae[k]=Se.value}return be.map=k=>{de.properties=k;const V={};for(const Q of z)V[Q]=ve[Q].evaluate(Te,de);return V},be.reduce=(k,V)=>{de.properties=V;for(const Q of z)Te.accumulated=k[Q],k[Q]=Ae[Q].evaluate(Te,de)},be}(j)).load((yield this._pendingData).features):(ne=yield this._pendingData,new ni(ne,j.geojsonVtOptions)),this.loaded={};const pe={};if(Z){const be=Z.finish();be&&(pe.resourceTiming={},pe.resourceTiming[j.source]=JSON.parse(JSON.stringify(be)))}return pe}catch(pe){if(delete this._pendingRequest,S.cx(pe))return{abandoned:!0};throw pe}var ne})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(j){const q=this.loaded;return q&&q[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,q){return S._(this,void 0,void 0,function*(){let Z=yield this.loadGeoJSON(j,q);if(delete this._pendingRequest,typeof Z!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(He(Z,!0),j.filter){const ne=S.cT(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(be=>`${be.key}: ${be.message}`).join(", "));Z={type:"FeatureCollection",features:Z.features.filter(be=>ne.value.evaluate({zoom:0},be))}}return Z})}loadGeoJSON(j,q){return S._(this,void 0,void 0,function*(){const{promoteId:Z}=j;if(j.request){const ne=yield S.j(j.request,q);return this._dataUpdateable=Ui(ne.data,Z)?nn(ne.data,Z):void 0,ne.data}if(typeof j.data=="string")try{const ne=JSON.parse(j.data);return this._dataUpdateable=Ui(ne,Z)?nn(ne,Z):void 0,ne}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return function(ne,pe,be){var Me,ve,Ae,Te;if(pe.removeAll&&ne.clear(),pe.remove)for(const de of pe.remove)ne.delete(de);if(pe.add)for(const de of pe.add){const z=Ti(de,be);z!=null&&ne.set(z,de)}if(pe.update)for(const de of pe.update){let z=ne.get(de.id);if(z==null)continue;const k=!de.removeAllProperties&&(((Me=de.removeProperties)===null||Me===void 0?void 0:Me.length)>0||((ve=de.addOrUpdateProperties)===null||ve===void 0?void 0:ve.length)>0);if((de.newGeometry||de.removeAllProperties||k)&&(z=Object.assign({},z),ne.set(de.id,z),k&&(z.properties=Object.assign({},z.properties))),de.newGeometry&&(z.geometry=de.newGeometry),de.removeAllProperties)z.properties={};else if(((Ae=de.removeProperties)===null||Ae===void 0?void 0:Ae.length)>0)for(const V of de.removeProperties)Object.prototype.hasOwnProperty.call(z.properties,V)&&delete z.properties[V];if(((Te=de.addOrUpdateProperties)===null||Te===void 0?void 0:Te.length)>0)for(const{key:V,value:Q}of de.addOrUpdateProperties)z.properties[V]=Q}}(this._dataUpdateable,j.dataDiff,Z),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class At{constructor(j){this.self=j,this.actor=new S.J(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(q,Z)=>{if(this.externalWorkerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.externalWorkerSourceTypes[q]=Z},this.self.addProtocol=S.cz,this.self.removeProtocol=S.cA,this.self.registerRTLTextPlugin=q=>{S.cU.setMethods(q)},this.actor.registerMessageHandler("LDT",(q,Z)=>this._getDEMWorkerSource(q,Z.source).loadTile(Z)),this.actor.registerMessageHandler("RDT",(q,Z)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(q,Z.source).removeTile(Z)})),this.actor.registerMessageHandler("GCEZ",(q,Z)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(q,Z.type,Z.source).getClusterExpansionZoom(Z)})),this.actor.registerMessageHandler("GCC",(q,Z)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(q,Z.type,Z.source).getClusterChildren(Z)})),this.actor.registerMessageHandler("GCL",(q,Z)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(q,Z.type,Z.source).getClusterLeaves(Z)})),this.actor.registerMessageHandler("LD",(q,Z)=>this._getWorkerSource(q,Z.type,Z.source).loadData(Z)),this.actor.registerMessageHandler("GD",(q,Z)=>this._getWorkerSource(q,Z.type,Z.source).getData()),this.actor.registerMessageHandler("LT",(q,Z)=>this._getWorkerSource(q,Z.type,Z.source).loadTile(Z)),this.actor.registerMessageHandler("RT",(q,Z)=>this._getWorkerSource(q,Z.type,Z.source).reloadTile(Z)),this.actor.registerMessageHandler("AT",(q,Z)=>this._getWorkerSource(q,Z.type,Z.source).abortTile(Z)),this.actor.registerMessageHandler("RMT",(q,Z)=>this._getWorkerSource(q,Z.type,Z.source).removeTile(Z)),this.actor.registerMessageHandler("RS",(q,Z)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[q]||!this.workerSources[q][Z.type]||!this.workerSources[q][Z.type][Z.source])return;const ne=this.workerSources[q][Z.type][Z.source];delete this.workerSources[q][Z.type][Z.source],ne.removeSource!==void 0&&ne.removeSource(Z)})),this.actor.registerMessageHandler("RM",q=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q]})),this.actor.registerMessageHandler("SR",(q,Z)=>S._(this,void 0,void 0,function*(){this.referrer=Z})),this.actor.registerMessageHandler("SRPS",(q,Z)=>this._syncRTLPluginState(q,Z)),this.actor.registerMessageHandler("IS",(q,Z)=>S._(this,void 0,void 0,function*(){this.self.importScripts(Z)})),this.actor.registerMessageHandler("SI",(q,Z)=>this._setImages(q,Z)),this.actor.registerMessageHandler("UL",(q,Z)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(q).update(Z.layers,Z.removedIds)})),this.actor.registerMessageHandler("SL",(q,Z)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(q).replace(Z)}))}_setImages(j,q){return S._(this,void 0,void 0,function*(){this.availableImages[j]=q;for(const Z in this.workerSources[j]){const ne=this.workerSources[j][Z];for(const pe in ne)ne[pe].availableImages=q}})}_syncRTLPluginState(j,q){return S._(this,void 0,void 0,function*(){return yield S.cU.syncState(q,this.self.importScripts)})}_getAvailableImages(j){let q=this.availableImages[j];return q||(q=[]),q}_getLayerIndex(j){let q=this.layerIndexes[j];return q||(q=this.layerIndexes[j]=new l),q}_getWorkerSource(j,q,Z){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][q]||(this.workerSources[j][q]={}),!this.workerSources[j][q][Z]){const ne={sendAsync:(pe,be)=>(pe.targetMapId=j,this.actor.sendAsync(pe,be))};switch(q){case"vector":this.workerSources[j][q][Z]=new Pe(ne,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][q][Z]=new hn(ne,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][q][Z]=new this.externalWorkerSourceTypes[q](ne,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][q][Z]}_getDEMWorkerSource(j,q){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][q]||(this.demWorkerSources[j][q]=new Ce),this.demWorkerSources[j][q]}}return S.i(self)&&(self.worker=new At(self)),At}),R("index",["exports","./shared"],function(S,l){var ae="5.6.1";function _e(){var h=new l.A(4);return l.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}let ee,Pe;const Ce={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h,e,i){const a=requestAnimationFrame(d=>{c(),e(d)}),{unsubscribe:c}=l.s(h.signal,"abort",()=>{c(),cancelAnimationFrame(a),i(l.c())},!1)},frameAsync(h){return new Promise((e,i)=>{this.frame(h,e,i)})},getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,i.drawImage(h,0,0,h.width,h.height),i},resolveURL:h=>(ee||(ee=document.createElement("a")),ee.href=h,ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Pe==null&&(Pe=matchMedia("(prefers-reduced-motion: reduce)")),Pe.matches)}};class N{static testProp(e){if(!N.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in N.docStyle)return e[i];return e[0]}static create(e,i,a){const c=window.document.createElement(e);return i!==void 0&&(c.className=i),a&&a.appendChild(c),c}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(e,i){e.style[N.transformProp]=i}static addEventListener(e,i,a,c={}){e.addEventListener(i,a,"passive"in c?c:c.capture)}static removeEventListener(e,i,a,c={}){e.removeEventListener(i,a,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,a){const c=i.boundingClientRect;return new l.P((a.clientX-c.left)/i.x-e.clientLeft,(a.clientY-c.top)/i.y-e.clientTop)}static mousePos(e,i){const a=N.getScale(e);return N.getPoint(e,a,i)}static touchPos(e,i){const a=[],c=N.getScale(e);for(let d=0;d<i.length;d++)a.push(N.getPoint(e,c,i[d]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),a=i.querySelectorAll("script");for(const c of a)c.remove();return N.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const a=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!a.includes("javascript:")&&!a.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const a of i)N.removeAttributes(a),N.clean(a)}static removeAttributes(e){for(const{name:i,value:a}of e.attributes)N.isPossiblyDangerous(i,a)&&e.removeAttribute(i)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const ge={supported:!1,testSupport:function(h){!tt&&He&&(Ge?Ye(h):Ee=h)}};let Ee,He,tt=!1,Ge=!1;function Ye(h){const e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,He),h.isContextLost())return;ge.supported=!0}catch{}h.deleteTexture(e),tt=!0}var mt;typeof document<"u"&&(He=document.createElement("img"),He.onload=()=>{Ee&&Ye(Ee),Ee=null,Ge=!0},He.onerror=()=>{tt=!0,Ee=null},He.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(h){let e,i,a,c;h.resetRequestQueue=()=>{e=[],i=0,a=0,c={}},h.addThrottleControl=x=>{const C=a++;return c[C]=x,C},h.removeThrottleControl=x=>{delete c[x],g()},h.getImage=(x,C,M=!0)=>new Promise((A,I)=>{ge.supported&&(x.headers||(x.headers={}),x.headers.accept="image/webp,*/*"),l.e(x,{type:"image"}),e.push({abortController:C,requestParameters:x,supportImageRefresh:M,state:"queued",onError:L=>{I(L)},onSuccess:L=>{A(L)}}),g()});const d=x=>l._(this,void 0,void 0,function*(){x.state="running";const{requestParameters:C,supportImageRefresh:M,onError:A,onSuccess:I,abortController:L}=x,$=M===!1&&!l.i(self)&&!l.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((J,ie)=>J&&ie==="accept",!0));i++;const X=$?y(C,L):l.m(C,L);try{const J=yield X;delete x.abortController,x.state="completed",J.data instanceof HTMLImageElement||l.b(J.data)?I(J):J.data&&I({data:yield(Y=J.data,typeof createImageBitmap=="function"?l.f(Y):l.h(Y)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete x.abortController,A(J)}finally{i--,g()}var Y}),g=()=>{const x=(()=>{for(const C of Object.keys(c))if(c[C]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=i;C<x&&e.length>0;C++){const M=e.shift();M.abortController.signal.aborted?C--:d(M)}},y=(x,C)=>new Promise((M,A)=>{const I=new Image,L=x.url,$=x.credentials;$&&$==="include"?I.crossOrigin="use-credentials":($&&$==="same-origin"||!l.d(L))&&(I.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{I.src="",A(l.c())}),I.fetchPriority="high",I.onload=()=>{I.onerror=I.onload=null,M({data:I})},I.onerror=()=>{I.onerror=I.onload=null,C.signal.aborted||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},I.src=L})}(mt||(mt={})),mt.resetRequestQueue();class dt{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function pt(h){const e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){const i=[];for(const{id:a,url:c}of h){const d=`${a}${c}`;i.indexOf(d)===-1&&(i.push(d),e.push({id:a,url:c}))}}return e}function $e(h,e,i){try{const a=new URL(h);return a.pathname+=`${e}${i}`,a.toString()}catch{throw new Error(`Invalid sprite URL "${h}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function bt(h){const{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class Pt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:a}of this.requestors)a(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const a=i.spriteData;i.data=new l.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let a=!0;const c=i.data||i.spriteData;return this._validateStretch(i.stretchX,c&&c.width)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(i.stretchY,c&&c.height)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(i.content,i)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,i){if(!e)return!0;let a=0;for(const c of e){if(c[0]<a||c[1]<c[0]||i<c[1])return!1;a=c[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const a=i.spriteData,c=a&&a.width||i.data.width,d=a&&a.height||i.data.height;return!(e[0]<0||c<e[0]||e[1]<0||d<e[1]||e[2]<0||c<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,a=!0){const c=this.getImage(e);if(a&&(c.data.width!==i.data.width||c.data.height!==i.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=c.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,a)=>{let c=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(c=!1);this.isLoaded()||c?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const a of e){let c=this.getImage(a);c||(this.fire(new l.l("styleimagemissing",{id:a})),c=this.getImage(a)),c?i[a]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:l.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],a=this.getImage(e);if(!a)return null;if(i&&i.position.version===a.version)return i.position;if(i)i.position.version=a.version;else{const c={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new l.I(c,a);this.patterns[e]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:i,h:a}=l.p(e),c=this.atlasImage;c.resize({width:i||1,height:a||1});for(const d in this.patterns){const{bin:g}=this.patterns[d],y=g.x+1,x=g.y+1,C=this.getImage(d).data,M=C.width,A=C.height;l.R.copy(C,c,{x:0,y:0},{x:y,y:x},{width:M,height:A}),l.R.copy(C,c,{x:0,y:A-1},{x:y,y:x-1},{width:M,height:1}),l.R.copy(C,c,{x:0,y:0},{x:y,y:x+A},{width:M,height:1}),l.R.copy(C,c,{x:M-1,y:0},{x:y-1,y:x},{width:1,height:A}),l.R.copy(C,c,{x:0,y:0},{x:y+M,y:x},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const a=this.getImage(i);a||l.w(`Image with ID: "${i}" was not found`),bt(a)&&this.updateImage(i,a)}}}const Qe=1e20;function Ke(h,e,i,a,c,d,g,y,x){for(let C=e;C<e+a;C++)et(h,i*d+C,d,c,g,y,x);for(let C=i;C<i+c;C++)et(h,C*d+e,1,a,g,y,x)}function et(h,e,i,a,c,d,g){d[0]=0,g[0]=-Qe,g[1]=Qe,c[0]=h[e];for(let y=1,x=0,C=0;y<a;y++){c[y]=h[e+y*i];const M=y*y;do{const A=d[x];C=(c[y]-c[A]+M-A*A)/(y-A)/2}while(C<=g[x]&&--x>-1);x++,d[x]=y,g[x]=C,g[x+1]=Qe}for(let y=0,x=0;y<a;y++){for(;g[x+1]<y;)x++;const C=d[x],M=y-C;h[e+y*i]=c[C]+M*M}}class rt{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return l._(this,void 0,void 0,function*(){const i=[];for(const d in e)for(const g of e[d])i.push(this._getAndCacheGlyphsPromise(d,g));const a=yield Promise.all(i),c={};for(const{stack:d,id:g,glyph:y}of a)c[d]||(c[d]={}),c[d][g]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics};return c})}_getAndCacheGlyphsPromise(e,i){return l._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=a.glyphs[i];if(c!==void 0)return{stack:e,id:i,glyph:c};if(c=this._tinySDF(a,e,i),c)return a.glyphs[i]=c,{stack:e,id:i,glyph:c};const d=Math.floor(i/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[d])return{stack:e,id:i,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[d]){const y=rt.loadGlyphRange(e,d,this.url,this.requestManager);a.requests[d]=y}const g=yield a.requests[d];for(const y in g)this._doesCharSupportLocalGlyph(+y)||(a.glyphs[+y]=g[+y]);return a.ranges[d]=!0,{stack:e,id:i,glyph:g[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||l.u["CJK Unified Ideographs"](e)||l.u["Hangul Syllables"](e)||l.u.Hiragana(e)||l.u.Katakana(e)||l.u["CJK Symbols and Punctuation"](e)||l.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,a){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let y="400";/bold/i.test(i)?y="900":/medium/i.test(i)?y="500":/light/i.test(i)&&(y="200"),d=e.tinySDF=new rt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:y})}const g=d.draw(String.fromCharCode(a));return{id:a,bitmap:new l.q({width:g.width||60,height:g.height||60},g.data),metrics:{width:g.glyphWidth/2||24,height:g.glyphHeight/2||24,left:g.glyphLeft/2+.5||0,top:g.glyphTop/2-27.5||-8,advance:g.glyphAdvance/2||24,isDoubleResolution:!0}}}}rt.loadGlyphRange=function(h,e,i,a){return l._(this,void 0,void 0,function*(){const c=256*e,d=c+255,g=a.transformRequest(i.replace("{fontstack}",h).replace("{range}",`${c}-${d}`),"Glyphs"),y=yield l.n(g,new AbortController);if(!y||!y.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${d}`);const x={};for(const C of l.o(y.data))x[C.id]=C;return x})},rt.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const y=this.size=h+4*e,x=this._createCanvas(y),C=this.ctx=x.getContext("2d",{willReadFrequently:!0});C.font=`${g} ${d} ${h}px ${c}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(h){const e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(h),g=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,g+Math.ceil(a)),C=y+2*this.buffer,M=x+2*this.buffer,A=Math.max(C*M,0),I=new Uint8ClampedArray(A),L={data:I,width:C,height:M,glyphWidth:y,glyphHeight:x,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(y===0||x===0)return L;const{ctx:$,buffer:X,gridInner:Y,gridOuter:J}=this;$.clearRect(X,X,y,x),$.fillText(h,X,X+g);const ie=$.getImageData(X,X,y,x);J.fill(Qe,0,A),Y.fill(0,0,A);for(let se=0;se<x;se++)for(let re=0;re<y;re++){const he=ie.data[4*(se*y+re)+3]/255;if(he===0)continue;const me=(se+X)*C+re+X;if(he===1)J[me]=0,Y[me]=Qe;else{const oe=.5-he;J[me]=oe>0?oe*oe:0,Y[me]=oe<0?oe*oe:0}}Ke(J,0,0,C,M,C,this.f,this.v,this.z),Ke(Y,X,X,y,x,C,this.f,this.v,this.z);for(let se=0;se<A;se++){const re=Math.sqrt(J[se])-Math.sqrt(Y[se]);I[se]=Math.round(255-255*(re/this.radius+this.cutoff))}return L}};class Dt{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,i){return l.B(e.expression.evaluate(i))}interpolate(e,i,a){return{x:l.C.number(e.x,i.x,a),y:l.C.number(e.y,i.y,a),z:l.C.number(e.z,i.z,a)}}}let It;class ei extends l.E{constructor(e){super(),It=It||new l.r({anchor:new l.D(l.v.light.anchor),position:new Dt,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.t(It),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(l.x,e,i))for(const a in e){const c=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),c):this._transitionable.setValue(a,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,a){return(!a||a.validate!==!1)&&l.y(this,e.call(l.z,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const Zt=new l.r({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class Rt extends l.E{constructor(e){super(),this._transitionable=new l.t(Zt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0))}setSky(e,i={}){if(!this._validate(l.G,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const c=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),c):this._transitionable.setValue(a,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,a={}){return(a==null?void 0:a.validate)!==!1&&l.y(this,e.call(l.z,l.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Tt{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const a=e.join(",")+String(i);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,i)),this.dashEntry[a]}getDashRanges(e,i,a){const c=[];let d=e.length%2==1?-e[e.length-1]*a:0,g=e[0]*a,y=!0;c.push({left:d,right:g,isDash:y,zeroLength:e[0]===0});let x=e[0];for(let C=1;C<e.length;C++){y=!y;const M=e[C];d=x*a,x+=M,g=x*a,c.push({left:d,right:g,isDash:y,zeroLength:M===0})}return c}addRoundDash(e,i,a){const c=i/2;for(let d=-a;d<=a;d++){const g=this.width*(this.nextRow+a+d);let y=0,x=e[y];for(let C=0;C<this.width;C++){C/x.right>1&&(x=e[++y]);const M=Math.abs(C-x.left),A=Math.abs(C-x.right),I=Math.min(M,A);let L;const $=d/a*(c+1);if(x.isDash){const X=c-Math.abs($);L=Math.sqrt(I*I+X*X)}else L=c-Math.sqrt(I*I+$*$);this.data[g+C]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e){for(let y=e.length-1;y>=0;--y){const x=e[y],C=e[y+1];x.zeroLength?e.splice(y,1):C&&C.isDash===x.isDash&&(C.left=x.left,e.splice(y,1))}const i=e[0],a=e[e.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);const c=this.width*this.nextRow;let d=0,g=e[d];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++d]);const x=Math.abs(y-g.left),C=Math.abs(y-g.right),M=Math.min(x,C);this.data[c+y]=Math.max(0,Math.min(255,(g.isDash?M:-M)+128))}}addDash(e,i){const a=i?7:0,c=2*a+1;if(this.nextRow+c>this.height)return l.w("LineAtlas out of space"),null;let d=0;for(let y=0;y<e.length;y++)d+=e[y];if(d!==0){const y=this.width/d,x=this.getDashRanges(e,this.width,y);i?this.addRoundDash(x,y,a):this.addRegularDash(x)}const g={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=c,this.dirty=!0,g}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const at="maplibre_preloaded_worker_pool";class ft{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ft.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[at]}numActive(){return Object.keys(this.active).length}}const xt=Math.floor(Ce.hardwareConcurrency/2);let ii,Qt;function gi(){return ii||(ii=new ft),ii}ft.workerCount=l.H(globalThis)?Math.max(Math.min(xt,3),1):1;class st{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const a=this.workerPool.acquire(i);for(let c=0;c<a.length;c++){const d=new l.J(a[c],i);d.name=`Worker ${c}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const a=[];for(const c of this.actors)a.push(c.sendAsync({type:e,data:i}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const a of this.actors)a.registerMessageHandler(e,i)}}function Yt(){return Qt||(Qt=new st(gi(),l.K),Qt.registerMessageHandler("GR",(h,e,i)=>l.m(e,i))),Qt}function _i(h,e){const i=l.L();return l.M(i,i,[1,1,0]),l.N(i,i,[.5*h.width,.5*h.height,1]),h.calculatePosMatrix?l.O(i,i,h.calculatePosMatrix(e.toUnwrapped())):i}function qt(h,e,i,a,c,d,g){var y;const x=function(I,L,$){if(I)for(const X of I){const Y=L[X];if(Y&&Y.source===$&&Y.type==="fill-extrusion")return!0}else for(const X in L){const Y=L[X];if(Y.source===$&&Y.type==="fill-extrusion")return!0}return!1}((y=c==null?void 0:c.layers)!==null&&y!==void 0?y:null,e,h.id),C=d.maxPitchScaleFactor(),M=h.tilesIn(a,C,x);M.sort(fi);const A=[];for(const I of M)A.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(e,i,h._state,I.queryGeometry,I.cameraQueryGeometry,I.scale,c,d,C,_i(h.transform,I.tileID),g?(L,$)=>g(I.tileID,L,$):void 0)});return function(I,L){for(const $ in I)for(const X of I[$])Ci(X,L);return I}(function(I){const L={},$={};for(const X of I){const Y=X.queryResults,J=X.wrappedTileID,ie=$[J]=$[J]||{};for(const se in Y){const re=Y[se],he=ie[se]=ie[se]||{},me=L[se]=L[se]||[];for(const oe of re)he[oe.featureIndex]||(he[oe.featureIndex]=!0,me.push(oe))}}return L}(A),h)}function fi(h,e){const i=h.tileID,a=e.tileID;return i.overscaledZ-a.overscaledZ||i.canonical.y-a.canonical.y||i.wrap-a.wrap||i.canonical.x-a.canonical.x}function Ci(h,e){const i=h.feature,a=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=a}function Wi(h,e,i){return l._(this,void 0,void 0,function*(){let a=h;if(h.url?a=(yield l.j(e.transformRequest(h.url,"Source"),i)).data:yield Ce.frameAsync(i),!a)return null;const c=l.Q(l.e(a,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(c.vectorLayerIds=a.vector_layers.map(d=>d.id)),c})}class ut{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}extend(e){const i=this._sw,a=this._ne;let c,d;if(e instanceof l.S)c=e,d=e;else{if(!(e instanceof ut))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ut.convert(e)):this.extend(l.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.S.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return i||a?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new l.S(c.lng,c.lat),this._ne=new l.S(d.lng,d.lat)),this}getCenter(){return new l.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.S(this.getWest(),this.getNorth())}getSouthEast(){return new l.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=l.S.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return e instanceof ut?e:e&&new ut(e)}static fromLngLat(e,i=0){const a=360*i/40075017,c=a/Math.cos(Math.PI/180*e.lat);return new ut(new l.S(e.lng-c,e.lat-a),new l.S(e.lng+c,e.lat+a))}adjustAntiMeridian(){const e=new l.S(this._sw.lng,this._sw.lat),i=new l.S(this._ne.lng,this._ne.lat);return new ut(e,e.lng>i.lng?new l.S(i.lng+360,i.lat):i)}}class Xt{constructor(e,i,a){this.bounds=ut.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),a=Math.floor(l.V(this.bounds.getWest())*i),c=Math.floor(l.U(this.bounds.getNorth())*i),d=Math.ceil(l.V(this.bounds.getEast())*i),g=Math.ceil(l.U(this.bounds.getSouth())*i);return e.x>=a&&e.x<d&&e.y>=c&&e.y<g}}class we extends l.E{constructor(e,i,a,c){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.Q(i,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Wi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(l.e(this,e),e.bounds&&(this.tileBounds=new Xt(e.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new l.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(e){return l._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};a.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((d,g)=>{e.reloadPromise={resolve:d,reject:g}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:c,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ht extends l.E{constructor(e,i,a,c){super(),this.id=e,this.dispatcher=a,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},i),l.e(this,l.Q(i,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Wi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(l.e(this,i),i.bounds&&(this.tileBounds=new Xt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new l.k(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return l._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield mt.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&(a.cacheControl||a.expires)&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const c=this.map.painter.context,d=c.gl,g=a.data;e.texture=this.map.painter.getTileTexture(g.width),e.texture?e.texture.update(g,{useMipmap:!0}):(e.texture=new l.T(c,g,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Ot extends ht{constructor(e,i,a,c){super(e,i,a,c),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return l._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield mt.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const d=c.data;this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const g=l.b(d)&&l.W()?d:yield this.readImageNow(d),y={type:this.type,uid:e.uid,source:this.id,rawImageData:g,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const x=yield e.actor.sendAsync({type:"LDT",data:y});e.dem=x,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.X()){const i=e.width+2,a=e.height+2;try{return new l.R({width:i,height:a},yield l.Y(e,-1,-1,i,a))}catch{}}return Ce.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,a=Math.pow(2,i.z),c=(i.x-1+a)%a,d=i.x===0?e.wrap-1:e.wrap,g=(i.x+1+a)%a,y=i.x+1===a?e.wrap+1:e.wrap,x={};return x[new l.Z(e.overscaledZ,d,i.z,c,i.y).key]={backfilled:!1},x[new l.Z(e.overscaledZ,y,i.z,g,i.y).key]={backfilled:!1},i.y>0&&(x[new l.Z(e.overscaledZ,d,i.z,c,i.y-1).key]={backfilled:!1},x[new l.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},x[new l.Z(e.overscaledZ,y,i.z,g,i.y-1).key]={backfilled:!1}),i.y+1<a&&(x[new l.Z(e.overscaledZ,d,i.z,c,i.y+1).key]={backfilled:!1},x[new l.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},x[new l.Z(e.overscaledZ,y,i.z,g,i.y+1).key]={backfilled:!1}),x}unloadTile(e){return l._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Et extends l.E{constructor(e,i,a,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(c),this._data=i.data,this._options=l.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:l.$,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(i.clusterMaxZoom),minPoints:Math.max(2,i.clusterMinPoints||2),extent:l.$,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(l.$/this.tileSize)}_getClusterMaxZoom(e){const i=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${i}"`),i}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return l._(this,void 0,void 0,function*(){const e=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(i=>i.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return l._(this,void 0,void 0,function*(){const e=new ut,i=yield this.getData();let a;switch(i.type){case"FeatureCollection":a=i.features.map(c=>this.getCoordinatesFromGeometry(c.geometry)).flat(1/0);break;case"Feature":a=this.getCoordinatesFromGeometry(i.geometry);break;default:a=this.getCoordinatesFromGeometry(i)}if(a.length==0)return e;for(let c=0;c<a.length-1;c+=2)e.extend([a[c],a[c+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:a}})}_updateWorkerData(e){return l._(this,void 0,void 0,function*(){const i=l.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(Ce.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.l("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));let c=null;a.resourceTiming&&a.resourceTiming[this.id]&&(c=a.resourceTiming[this.id].slice(0));const d={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&l.e(d,{resourceTiming:c}),this.fire(new l.l("data",Object.assign(Object.assign({},d),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},d),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return l._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:i,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,i==="RT")})}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class $t extends l.E{constructor(e,i,a,c){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=i}load(e){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield mt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new l.k(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(l.a0.fromLngLat);var a;return this.tileID=function(c){const d=l.a1.fromPoints(c),g=d.width(),y=d.height(),x=Math.max(g,y),C=Math.max(0,Math.floor(-Math.log(x)/Math.LN2)),M=Math.pow(2,C);return new l.a3(C,Math.floor((d.minX+d.maxX)/2*M),Math.floor((d.minY+d.maxY)/2*M))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(c=>this.tileID.getTilePoint(c)._round()),this.flippedWindingOrder=((a=this.tileCoords)[1].x-a[0].x)*(a[2].y-a[0].y)-(a[1].y-a[0].y)*(a[2].x-a[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new l.T(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:i,minY:a,maxX:c,maxY:d}=l.a1.fromPoints(e),g={};for(let y=0;y<=l.a2;y++){const x=Math.pow(2,y),C=Math.floor(i*x),M=Math.floor(a*x),A=Math.floor(c*x),I=Math.floor(d*x);g[y]={minTileX:C,minTileY:M,maxTileX:A,maxTileY:I}}return g}}class jt extends $t{constructor(e,i,a,c){super(e,i,a,c),this.roundZoom=!0,this.type="video",this.options=i}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield l.a4(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new l.k(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new l.k(new l.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Pi extends $t{constructor(e,i,a,c){super(e,i,a,c),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(g=>typeof g!="number"))||this.fire(new l.k(new l.a5(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.a5(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new l.k(new l.a5(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.a5(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.a5(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,a=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.T(i,this.canvas,a.RGBA,{premultiply:!0});let c=!1;for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Yi={},Di=h=>{switch(h){case"geojson":return Et;case"image":return $t;case"raster":return ht;case"raster-dem":return Ot;case"vector":return we;case"video":return jt;case"canvas":return Pi}return Yi[h]},Ii="RTLPluginLoaded";class ni extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Yt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return l._(this,arguments,void 0,function*(i,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ce.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(Ii))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let tn=null;function Ti(){return tn||(tn=new ni),tn}class Ui{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a6(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const g={};if(!d)return g;for(const y of c){const x=y.layerIds.map(C=>d.getLayer(C)).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(C=>x.filter(M=>M.id===C)[0]));for(const C of x)g[C.id]=y}}return g}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof l.a8){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof l.a8&&d.hasRTLText){this.hasRTLText=!0,Ti().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a7}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,a,c,d,g,y,x,C,M,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:M,transform:x,params:y,queryPadding:this.queryPadding*C,getElevation:A},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),d=i&&i.sourceLayer?i.sourceLayer:"",g=c._geojsonTileLayer||c[d];if(!g)return;const y=l.a9(i&&i.filter),{z:x,x:C,y:M}=this.tileID.canonical,A={z:x,x:C,y:M};for(let I=0;I<g.length;I++){const L=g.feature(I);if(y.needGeometry){const Y=l.aa(L,!0);if(!y.filter(new l.F(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!y.filter(new l.F(this.tileID.overscaledZ),L))continue;const $=a.getId(L,d),X=new l.ab(L,x,C,M,$);X.tile=A,e.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=l.ac(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const d=this.expirationTime-i;d?this.expirationTime=a+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const d=this.buckets[c],g=d.layers[0].sourceLayer||"_geojsonTileLayer",y=a[g],x=e[g];if(!y||!x||Object.keys(x).length===0)continue;d.update(x,y,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=i&&i.style&&i.style.getLayer(c);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ce.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ce.now()+e}setDependencies(e,i){const a={};for(const c of i)a[c]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const c=this.dependencies[a];if(c){for(const d of i)if(c[d])return!0}}return!1}}class nn{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:i,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,c=i===void 0?0:this.data[a].indexOf(i),d=this.data[a][c];return this.data[a].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const c of this.data[a])e(c.value)||i.push(c);for(const a of i)this.remove(a.value.tileID,a)}}class hn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},l.e(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])a[d]||(this.deletedStates[e][c][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,i,a){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),c=l.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][i];if(d===null)return{};for(const g in d)delete c[g]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),l.e(this.state[c][g],this.stateChanges[c][g]),d[g]=this.state[c][g];a[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const g in this.state[c])d[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(this.deletedStates[c][g]===null)this.state[c][g]={};else for(const y of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][y];d[g]=this.state[c][g]}a[c]=a[c]||{},l.e(a[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const c in e)e[c].setFeatureState(a,i)}}const At=89.25;function ue(h,e){const i=l.ag(e.lat,-l.ah,l.ah);return new l.P(l.V(e.lng)*h,l.U(i)*h)}function j(h,e){return new l.a0(e.x/h,e.y/h).toLngLat()}function q(h){return h.cameraToCenterDistance*Math.min(.85*Math.tan(l.ad(90-h.pitch)),Math.tan(l.ad(At-h.pitch)))}function Z(h,e){const i=h.canonical,a=e/l.ae(i.z),c=i.x+Math.pow(2,i.z)*h.wrap,d=l.af(new Float64Array(16));return l.M(d,d,[c*a,i.y*a,0]),l.N(d,d,[a/l.$,a/l.$,1]),d}function ne(h,e,i,a,c){const d=l.a0.fromLngLat(h,e),g=c*l.ai(1,h.lat),y=g*Math.cos(l.ad(i)),x=Math.sqrt(g*g-y*y),C=x*Math.sin(l.ad(-a)),M=x*Math.cos(l.ad(-a));return new l.a0(d.x+C,d.y+M,d.z+y)}function pe(h,e,i){const a=e.intersectsFrustum(h);if(!i||a===0)return a;const c=e.intersectsPlane(i);return c===0?0:a===2&&c===2?2:1}function be(h,e,i){let a=0;const c=(i-e)/10;for(let d=0;d<10;d++)a+=c*Math.pow(Math.cos(e+(d+.5)/10*(i-e)),h);return a}function Me(h,e){return function(i,a,c,d,g){const y=2*((h-1)/l.aj(Math.cos(l.ad(At-g))/Math.cos(l.ad(At)))-1),x=Math.acos(c/d),C=2*be(y-1,0,l.ad(g/2)),M=Math.min(l.ad(At),x+l.ad(g/2)),A=be(y-1,Math.min(M,x-l.ad(g/2)),M),I=Math.atan(a/c),L=Math.hypot(a,c);let $=i;return $+=l.aj(d/L/Math.max(.5,Math.cos(l.ad(g/2)))),$+=y*l.aj(Math.cos(I))/2,$-=l.aj(Math.max(1,A/C/e))/2,$}}const ve=Me(9.314,3);function Ae(h,e){const i=(e.roundZoom?Math.round:Math.floor)(h.zoom+l.aj(h.tileSize/e.tileSize));return Math.max(0,i)}function Te(h,e){const i=h.getCameraFrustum(),a=h.getClippingPlane(),c=h.screenPointToMercatorCoordinate(h.getCameraPoint()),d=l.a0.fromLngLat(h.center,h.elevation);c.z=d.z+Math.cos(h.pitchInRadians)*h.cameraToCenterDistance/h.worldSize;const g=h.getCoveringTilesDetailsProvider(),y=g.allowVariableZoom(h,e),x=Ae(h,e),C=e.minzoom||0,M=e.maxzoom!==void 0?e.maxzoom:h.maxZoom,A=Math.min(Math.max(0,x),M),I=Math.pow(2,A),L=[I*c.x,I*c.y,0],$=[I*d.x,I*d.y,0],X=Math.hypot(d.x-c.x,d.y-c.y),Y=Math.abs(d.z-c.z),J=Math.hypot(X,Y),ie=he=>({zoom:0,x:0,y:0,wrap:he,fullyVisible:!1}),se=[],re=[];if(h.renderWorldCopies&&g.allowWorldCopies())for(let he=1;he<=3;he++)se.push(ie(-he)),se.push(ie(he));for(se.push(ie(0));se.length>0;){const he=se.pop(),me=he.x,oe=he.y;let xe=he.fullyVisible;const Le={x:me,y:oe,z:he.zoom},ke=g.getTileBoundingVolume(Le,he.wrap,h.elevation,e);if(!xe){const lt=pe(i,ke,a);if(lt===0)continue;xe=lt===2}const Ie=g.distanceToTile2d(c.x,c.y,Le,ke);let Re=x;y&&(Re=(e.calculateTileZoom||ve)(h.zoom+l.aj(h.tileSize/e.tileSize),Ie,Y,J,h.fov)),Re=(e.roundZoom?Math.round:Math.floor)(Re),Re=Math.max(0,Re);const ct=Math.min(Re,M);if(he.wrap=g.getWrap(d,Le,he.wrap),he.zoom>=ct){if(he.zoom<C)continue;const lt=A-he.zoom,Xe=L[0]-.5-(me<<lt),wt=L[1]-.5-(oe<<lt),Jt=e.reparseOverscaled?Math.max(he.zoom,Re):he.zoom;re.push({tileID:new l.Z(he.zoom===M?Jt:he.zoom,he.wrap,he.zoom,me,oe),distanceSq:l.ak([$[0]-.5-me,$[1]-.5-oe]),tileDistanceToCamera:Math.sqrt(Xe*Xe+wt*wt)})}else for(let lt=0;lt<4;lt++)se.push({zoom:he.zoom+1,x:(me<<1)+lt%2,y:(oe<<1)+(lt>>1),wrap:he.wrap,fullyVisible:xe})}return re.sort((he,me)=>he.distanceSq-me.distanceSq).map(he=>he.tileID)}const de=l.a1.fromPoints([new l.P(0,0),new l.P(l.$,l.$)]);class z extends l.E{constructor(e,i,a){super(),this.id=e,this.dispatcher=a,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,d,g,y)=>{const x=new(Di(d.type))(c,d,g,y);if(x.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${x.id}`);return x})(e,i,a,this),this._tiles={},this._cache=new nn(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new hn,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,a){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,a)}catch(c){e.state="errored",c.status!==404?this._source.fire(new l.k(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new l.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(k).map(e=>e.key)}getRenderableIds(e){const i=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&i.push(this._tiles[a]);return e?i.sort((a,c)=>{const d=a.tileID,g=c.tileID,y=new l.P(d.canonical.x,d.canonical.y)._rotate(-this.transform.bearingInRadians),x=new l.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians);return d.overscaledZ-g.overscaledZ||x.y-y.y||x.x-y.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(k).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)e?this._reloadTile(i,"expired"):this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return l._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=i),yield this._loadTile(a,e,i))})}_tileLoaded(e,i,a){e.timeAdded=Ce.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const d=i[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const g=this.getTileByID(d);a(e,g),a(g,e)}}function a(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let g=d.tileID.canonical.x-c.tileID.canonical.x;const y=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),C=d.tileID.key;g===0&&y===0||Math.abs(y)>1||(Math.abs(g)>1&&(Math.abs(g+x)===1?g+=x:Math.abs(g-x)===1&&(g-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,g,y),c.neighboringTiles&&c.neighboringTiles[C]&&(c.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,c){for(const d in this._tiles){let g=this._tiles[d];if(c[d]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>a)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const C=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[C.key],g&&g.hasData()&&(y=C)}let x=y;for(;x.overscaledZ>i;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]||e[x.canonical.key]){c[y.key]=y;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const c=e.scaledTo(a),d=this._getLoadedTile(c);if(d)return d}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(i*a*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),a[d.tileID.key]=d}this._tiles=a;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,i,a,c,d,g){const y={},x={},C=Object.keys(e),M=Ce.now();for(const A of C){const I=e[A],L=this._tiles[A];if(!L||L.fadeEndTime!==0&&L.fadeEndTime<=M)continue;const $=this.findLoadedParent(I,i),X=this.findLoadedSibling(I),Y=$||X||null;Y&&(this._addTile(Y.tileID),y[Y.tileID.key]=Y.tileID),x[A]=I}this._retainLoadedChildren(x,c,a,e);for(const A in y)e[A]||(this._coveredTiles[A]=!0,e[A]=y[A]);if(g){const A={},I={};for(const L of d)this._tiles[L.key].hasData()?A[L.key]=L:I[L.key]=L;for(const L in I){const $=I[L].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(A[$[0].key]=e[$[0].key]=$[0],A[$[1].key]=e[$[1].key]=$[1],A[$[2].key]=e[$[2].key]=$[2],A[$[3].key]=e[$[3].key]=$[3],delete I[L])}for(const L in I){const $=I[L],X=this.findLoadedParent($,this._source.minzoom),Y=this.findLoadedSibling($),J=X||Y||null;if(J){A[J.tileID.key]=e[J.tileID.key]=J.tileID;for(const ie in A)A[ie].isChildOf(J.tileID)&&delete A[ie]}}for(const L in this._tiles)A[L]||(this._coveredTiles[L]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new l.Z(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(a=Te(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(a=a.filter(M=>this._source.hasTile(M)))):a=[];const c=Ae(e,this._source),d=Math.max(c-z.maxOverzooming,this._source.minzoom),g=Math.max(c+z.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const A of a)if(A.canonical.z>this._source.minzoom){const I=A.scaledTo(A.canonical.z-1);M[I.key]=I;const L=A.scaledTo(Math.max(this._source.minzoom,Math.min(A.canonical.z,5)));M[L.key]=L}a=a.concat(Object.values(M))}const y=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=this._updateRetainedTiles(a,c);V(this._source.type)&&this._updateCoveredAndRetainedTiles(x,d,g,c,a,i);for(const M in x)this._tiles[M].clearFadeHold();const C=l.al(this._tiles,x);for(const M of C){const A=this._tiles[M];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var a;const c={},d={},g=Math.max(i-z.maxOverzooming,this._source.minzoom),y=Math.max(i+z.maxUnderzooming,this._source.minzoom),x={};for(const C of e){const M=this._addTile(C);c[C.key]=C,M.hasData()||i<this._source.maxzoom&&(x[C.key]=C)}this._retainLoadedChildren(x,i,y,c);for(const C of e){let M=this._tiles[C.key];if(M.hasData())continue;if(i+1>this._source.maxzoom){const I=C.children(this._source.maxzoom)[0],L=this.getTile(I);if(L&&L.hasData()){c[I.key]=I;continue}}else{const I=C.children(this._source.maxzoom);if(c[I[0].key]&&c[I[1].key]&&c[I[2].key]&&c[I[3].key])continue}let A=M.wasRequested();for(let I=C.overscaledZ-1;I>=g;--I){const L=C.scaledTo(I);if(d[L.key])break;if(d[L.key]=!0,M=this.getTile(L),!M&&A&&(M=this._addTile(L)),M){const $=M.hasData();if(($||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||A)&&(c[L.key]=L),A=M.wasRequested(),$)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}i.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;c=d}for(const d of i)this._loadedParentTiles[d]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,a=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=i;return i||(i=new Ui(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,a||this._source.fire(new l.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}refreshTiles(e){for(const i in this._tiles)(this._isIdRenderable(i)||this._tiles[i].state=="errored")&&e.some(a=>a.equals(this._tiles[i].tileID.canonical))&&this._reloadTile(i,"expired")}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,a){const c=[],d=this.transform;if(!d)return c;const g=d.getCoveringTilesDetailsProvider().allowWorldCopies(),y=a?d.getCameraQueryGeometry(e):e,x=L=>d.screenPointToMercatorCoordinate(L,this.terrain),C=this.transformBbox(e,x,!g),M=this.transformBbox(y,x,!g),A=this.getIds(),I=l.a1.fromPoints(M);for(let L=0;L<A.length;L++){const $=this._tiles[A[L]];if($.holdingForFade())continue;const X=g?[$.tileID]:[$.tileID.unwrapTo(-1),$.tileID.unwrapTo(0)],Y=Math.pow(2,d.zoom-$.tileID.overscaledZ),J=i*$.queryPadding*l.$/$.tileSize/Y;for(const ie of X){const se=I.map(re=>ie.getTilePoint(new l.a0(re.x,re.y)));if(se.expandBy(J),se.intersects(de)){const re=C.map(me=>ie.getTilePoint(me)),he=M.map(me=>ie.getTilePoint(me));c.push({tile:$,tileID:g?ie:ie.unwrapTo(0),queryGeometry:re,cameraQueryGeometry:he,scale:Y})}}}return c}transformBbox(e,i,a){let c=e.map(i);if(a){const d=l.a1.fromPoints(e);d.shrinkBy(.001*Math.min(d.width(),d.height()));const g=d.map(i);l.a1.fromPoints(c).covers(g)||(c=c.map(y=>y.x>.5?new l.a0(y.x-1,y.y,y.z):y))}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(V(this._source.type)){const e=Ce.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const c=this._tiles[e];c&&c.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}}function k(h,e){const i=Math.abs(2*h.wrap)-+(h.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||a-i||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function V(h){return h==="raster"||h==="image"||h==="video"}z.maxOverzooming=10,z.maxUnderzooming=3;class Q{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ag(e,0,1);let i=1,a=this._distances[i];const c=e*this.paddedLength+this.padding;for(;a<c&&i<this._distances.length;)a=this._distances[++i];const d=i-1,g=this._distances[d],y=a-g,x=y>0?(c-g)/y:0;return this.points[d].mult(1-x).add(this.points[i].mult(x))}}function fe(h,e){let i=!0;return h==="always"||h!=="never"&&e!=="never"||(i=!1),i}class Se{constructor(e,i,a){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(i/a);for(let g=0;g<this.xCellCount*this.yCellCount;g++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,a,c,d){this._forEachCell(i,a,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(e,i,a,c){this._forEachCell(i-c,a-c,i+c,a+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(a),this.circles.push(c)}_insertBoxCell(e,i,a,c,d,g){this.boxCells[d].push(g)}_insertCircleCell(e,i,a,c,d,g){this.circleCells[d].push(g)}_query(e,i,a,c,d,g,y){if(a<0||e>this.width||c<0||i>this.height)return[];const x=[];if(e<=0&&i<=0&&this.width<=a&&this.height<=c){if(d)return[{key:null,x1:e,y1:i,x2:a,y2:c}];for(let C=0;C<this.boxKeys.length;C++)x.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const M=this.circles[3*C],A=this.circles[3*C+1],I=this.circles[3*C+2];x.push({key:this.circleKeys[C],x1:M-I,y1:A-I,x2:M+I,y2:A+I})}}else this._forEachCell(e,i,a,c,this._queryCell,x,{hitTest:d,overlapMode:g,seenUids:{box:{},circle:{}}},y);return x}query(e,i,a,c){return this._query(e,i,a,c,!1,null)}hitTest(e,i,a,c,d,g){return this._query(e,i,a,c,!0,d,g).length>0}hitTestCircle(e,i,a,c,d){const g=e-a,y=e+a,x=i-a,C=i+a;if(y<0||g>this.width||C<0||x>this.height)return!1;const M=[];return this._forEachCell(g,x,y,C,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:e,y:i,radius:a},seenUids:{box:{},circle:{}}},d),M.length>0}_queryCell(e,i,a,c,d,g,y,x){const{seenUids:C,hitTest:M,overlapMode:A}=y,I=this.boxCells[d];if(I!==null){const $=this.bboxes;for(const X of I)if(!C.box[X]){C.box[X]=!0;const Y=4*X,J=this.boxKeys[X];if(e<=$[Y+2]&&i<=$[Y+3]&&a>=$[Y+0]&&c>=$[Y+1]&&(!x||x(J))&&(!M||!fe(A,J.overlapMode))&&(g.push({key:J,x1:$[Y],y1:$[Y+1],x2:$[Y+2],y2:$[Y+3]}),M))return!0}}const L=this.circleCells[d];if(L!==null){const $=this.circles;for(const X of L)if(!C.circle[X]){C.circle[X]=!0;const Y=3*X,J=this.circleKeys[X];if(this._circleAndRectCollide($[Y],$[Y+1],$[Y+2],e,i,a,c)&&(!x||x(J))&&(!M||!fe(A,J.overlapMode))){const ie=$[Y],se=$[Y+1],re=$[Y+2];if(g.push({key:J,x1:ie-re,y1:se-re,x2:ie+re,y2:se+re}),M)return!0}}}return!1}_queryCellCircle(e,i,a,c,d,g,y,x){const{circle:C,seenUids:M,overlapMode:A}=y,I=this.boxCells[d];if(I!==null){const $=this.bboxes;for(const X of I)if(!M.box[X]){M.box[X]=!0;const Y=4*X,J=this.boxKeys[X];if(this._circleAndRectCollide(C.x,C.y,C.radius,$[Y+0],$[Y+1],$[Y+2],$[Y+3])&&(!x||x(J))&&!fe(A,J.overlapMode))return g.push(!0),!0}}const L=this.circleCells[d];if(L!==null){const $=this.circles;for(const X of L)if(!M.circle[X]){M.circle[X]=!0;const Y=3*X,J=this.circleKeys[X];if(this._circlesCollide($[Y],$[Y+1],$[Y+2],C.x,C.y,C.radius)&&(!x||x(J))&&!fe(A,J.overlapMode))return g.push(!0),!0}}}_forEachCell(e,i,a,c,d,g,y,x){const C=this._convertToXCellCoord(e),M=this._convertToYCellCoord(i),A=this._convertToXCellCoord(a),I=this._convertToYCellCoord(c);for(let L=C;L<=A;L++)for(let $=M;$<=I;$++)if(d.call(this,e,i,a,c,this.xCellCount*$+L,g,y,x))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,a,c,d,g){const y=c-e,x=d-i,C=a+g;return C*C>y*y+x*x}_circleAndRectCollide(e,i,a,c,d,g,y){const x=(g-c)/2,C=Math.abs(e-(c+x));if(C>x+a)return!1;const M=(y-d)/2,A=Math.abs(i-(d+M));if(A>M+a)return!1;if(C<=x||A<=M)return!0;const I=C-x,L=A-M;return I*I+L*L<=a*a}}function Be(h,e,i){const a=l.L();if(!h){const{vecSouth:A,vecEast:I}=nt(e),L=_e();L[0]=I[0],L[1]=I[1],L[2]=A[0],L[3]=A[1],c=L,(M=(g=(d=L)[0])*(C=d[3])-(x=d[2])*(y=d[1]))&&(c[0]=C*(M=1/M),c[1]=-y*M,c[2]=-x*M,c[3]=g*M),a[0]=L[0],a[1]=L[1],a[4]=L[2],a[5]=L[3]}var c,d,g,y,x,C,M;return l.N(a,a,[1/i,1/i,1]),a}function Ve(h,e,i,a){if(h){const c=l.L();if(!e){const{vecSouth:d,vecEast:g}=nt(i);c[0]=g[0],c[1]=g[1],c[4]=d[0],c[5]=d[1]}return l.N(c,c,[a,a,1]),c}return i.pixelsToClipSpaceMatrix}function nt(h){const e=Math.cos(h.rollInRadians),i=Math.sin(h.rollInRadians),a=Math.cos(h.pitchInRadians),c=Math.cos(h.bearingInRadians),d=Math.sin(h.bearingInRadians),g=l.aq();g[0]=-c*a*i-d*e,g[1]=-d*a*i+c*e;const y=l.ar(g);y<1e-9?l.as(g):l.at(g,g,1/y);const x=l.aq();x[0]=c*a*e-d*i,x[1]=d*a*e+c*i;const C=l.ar(x);return C<1e-9?l.as(x):l.at(x,x,1/C),{vecEast:x,vecSouth:g}}function Ze(h,e,i,a){let c;a?(c=[h,e,a(h,e),1],l.av(c,c,i)):(c=[h,e,0,1],sn(c,c,i));const d=c[3];return{point:new l.P(c[0]/d,c[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function qe(h,e){return .5+h/e*.5}function yt(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function Ht(h,e,i,a,c,d,g,y,x,C,M,A,I){const L=i?h.textSizeData:h.iconSizeData,$=l.am(L,e.transform.zoom),X=[256/e.width*2+1,256/e.height*2+1],Y=i?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Y.clear();const J=h.lineVertexArray,ie=i?h.text.placedSymbolArray:h.icon.placedSymbolArray,se=e.transform.width/e.transform.height;let re=!1;for(let he=0;he<ie.length;he++){const me=ie.get(he);if(me.hidden||me.writingMode===l.an.vertical&&!re){Ri(me.numGlyphs,Y);continue}re=!1;const oe=new l.P(me.anchorX,me.anchorY),xe={getElevation:I,pitchedLabelPlaneMatrix:a,lineVertexArray:J,pitchWithMap:d,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:oe,unwrappedTileID:x,width:C,height:M,translation:A},Le=Lt(me.anchorX,me.anchorY,xe);if(!yt(Le.point,X)){Ri(me.numGlyphs,Y);continue}const ke=qe(e.transform.cameraToCenterDistance,Le.signedDistanceFromCamera),Ie=l.ao(L,$,me),Re=d?Ie*e.transform.getPitchedTextCorrection(me.anchorX,me.anchorY,x)/ke:Ie*ke,ct=je({projectionContext:xe,pitchedLabelPlaneMatrixInverse:c,symbol:me,fontSize:Re,flip:!1,keepUpright:g,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:Y,aspectRatio:se,rotateToLine:y});re=ct.useVertical,(ct.notEnoughRoom||re||ct.needsFlipping&&je({projectionContext:xe,pitchedLabelPlaneMatrixInverse:c,symbol:me,fontSize:Re,flip:!0,keepUpright:g,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:Y,aspectRatio:se,rotateToLine:y}).notEnoughRoom)&&Ri(me.numGlyphs,Y)}i?h.text.dynamicLayoutVertexBuffer.updateData(Y):h.icon.dynamicLayoutVertexBuffer.updateData(Y)}function K(h,e,i,a,c,d,g,y){const x=d.glyphStartIndex+d.numGlyphs,C=d.lineStartIndex,M=d.lineStartIndex+d.lineLength,A=e.getoffsetX(d.glyphStartIndex),I=e.getoffsetX(x-1),L=ui(h*A,i,a,c,d.segment,C,M,y,g);if(!L)return null;const $=ui(h*I,i,a,c,d.segment,C,M,y,g);return $?y.projectionCache.anyProjectionOccluded?null:{first:L,last:$}:null}function De(h,e,i,a){return h===l.an.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*a?{useVertical:!0}:(h===l.an.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function je(h){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:a,fontSize:c,flip:d,keepUpright:g,glyphOffsetArray:y,dynamicLayoutVertexArray:x,aspectRatio:C,rotateToLine:M}=h,A=c/24,I=a.lineOffsetX*A,L=a.lineOffsetY*A;let $;if(a.numGlyphs>1){const X=a.glyphStartIndex+a.numGlyphs,Y=a.lineStartIndex,J=a.lineStartIndex+a.lineLength,ie=K(A,y,I,L,d,a,M,e);if(!ie)return{notEnoughRoom:!0};const se=zt(ie.first.point.x,ie.first.point.y,e,i),re=zt(ie.last.point.x,ie.last.point.y,e,i);if(g&&!d){const he=De(a.writingMode,se,re,C);if(he)return he}$=[ie.first];for(let he=a.glyphStartIndex+1;he<X-1;he++){const me=ui(A*y.getoffsetX(he),I,L,d,a.segment,Y,J,e,M);if(!me)return{notEnoughRoom:!0};$.push(me)}$.push(ie.last)}else{if(g&&!d){const Y=Ue(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,J=a.lineStartIndex+a.segment+1,ie=new l.P(e.lineVertexArray.getx(J),e.lineVertexArray.gety(J)),se=Ue(ie.x,ie.y,e),re=se.signedDistanceFromCamera>0?se.point:Mt(e.tileAnchorPoint,ie,Y,1,e),he=zt(Y.x,Y.y,e,i),me=zt(re.x,re.y,e,i),oe=De(a.writingMode,he,me,C);if(oe)return oe}const X=ui(A*y.getoffsetX(a.glyphStartIndex),I,L,d,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,e,M);if(!X||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};$=[X]}for(const X of $)l.au(x,X.point,X.angle);return{}}function Mt(h,e,i,a,c){const d=h.add(h.sub(e)._unit()),g=Ue(d.x,d.y,c).point,y=i.sub(g);return i.add(y._mult(a/y.mag()))}function Gt(h,e,i){const a=e.projectionCache;if(a.projections[h])return a.projections[h];const c=new l.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),d=Ue(c.x,c.y,e);if(d.signedDistanceFromCamera>0)return a.projections[h]=d.point,a.anyProjectionOccluded=a.anyProjectionOccluded||d.isOccluded,d.point;const g=h-i.direction;return Mt(i.distanceFromAnchor===0?e.tileAnchorPoint:new l.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),c,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function Ue(h,e,i){const a=h+i.translation[0],c=e+i.translation[1];let d;return i.pitchWithMap?(d=Ze(a,c,i.pitchedLabelPlaneMatrix,i.getElevation),d.isOccluded=!1):(d=i.transform.projectTileCoordinates(a,c,i.unwrappedTileID,i.getElevation),d.point.x=(.5*d.point.x+.5)*i.width,d.point.y=(.5*-d.point.y+.5)*i.height),d}function zt(h,e,i,a){if(i.pitchWithMap){const c=[h,e,0,1];return l.av(c,c,a),i.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],i.unwrappedTileID,i.getElevation).point}return{x:h/i.width*2-1,y:1-e/i.height*2}}function Lt(h,e,i){return i.transform.projectTileCoordinates(h,e,i.unwrappedTileID,i.getElevation)}function ti(h,e,i){return h._unit()._perp()._mult(e*i)}function bi(h,e,i,a,c,d,g,y,x){if(y.projectionCache.offsets[h])return y.projectionCache.offsets[h];const C=i.add(e);if(h+x.direction<a||h+x.direction>=c)return y.projectionCache.offsets[h]=C,C;const M=Gt(h+x.direction,y,x),A=ti(M.sub(i),g,x.direction),I=i.add(A),L=M.add(A);return y.projectionCache.offsets[h]=l.aw(d,C,I,L)||C,y.projectionCache.offsets[h]}function ui(h,e,i,a,c,d,g,y,x){const C=a?h-e:h+e;let M=C>0?1:-1,A=0;a&&(M*=-1,A=Math.PI),M<0&&(A+=Math.PI);let I,L=M>0?d+c:d+c+1;y.projectionCache.cachedAnchorPoint?I=y.projectionCache.cachedAnchorPoint:(I=Ue(y.tileAnchorPoint.x,y.tileAnchorPoint.y,y).point,y.projectionCache.cachedAnchorPoint=I);let $,X,Y=I,J=I,ie=0,se=0;const re=Math.abs(C),he=[];let me;for(;ie+se<=re;){if(L+=M,L<d||L>=g)return null;ie+=se,J=Y,X=$;const Le={absOffsetX:re,direction:M,distanceFromAnchor:ie,previousVertex:J};if(Y=Gt(L,y,Le),i===0)he.push(J),me=Y.sub(J);else{let ke;const Ie=Y.sub(J);ke=Ie.mag()===0?ti(Gt(L+M,y,Le).sub(Y),i,M):ti(Ie,i,M),X||(X=J.add(ke)),$=bi(L,ke,Y,d,g,X,i,y,Le),he.push(X),me=$.sub(X)}se=me.mag()}const oe=me._mult((re-ie)/se)._add(X||J),xe=A+Math.atan2(Y.y-J.y,Y.x-J.x);return he.push(oe),{point:oe,angle:x?xe:0,path:he}}const gt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ri(h,e){for(let i=0;i<h;i++){const a=e.length;e.resize(a+4),e.float32.set(gt,3*a)}}function sn(h,e,i){const a=e[0],c=e[1];return h[0]=i[0]*a+i[4]*c+i[12],h[1]=i[1]*a+i[5]*c+i[13],h[3]=i[3]*a+i[7]*c+i[15],h}const Ei=100;class lo{constructor(e,i=new Se(e.width+200,e.height+200,25),a=new Se(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=a,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ei,this.screenBottomBoundary=e.height+Ei,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,a,c,d,g,y,x,C,M,A,I){const L=this.projectAndGetPerspectiveRatio(e.anchorPointX+x[0],e.anchorPointY+x[1],d,M,I),$=a*L.perspectiveRatio;let X;if(g||y)X=this._projectCollisionBox(e,$,c,d,g,y,x,L,M,A,I);else{const me=L.x+(A?A.x*$:0),oe=L.y+(A?A.y*$:0);X={allPointsOccluded:!1,box:[me+e.x1*$,oe+e.y1*$,me+e.x2*$,oe+e.y2*$]}}const[Y,J,ie,se]=X.box,re=g?X.allPointsOccluded:L.isOccluded;let he=re;return he||(he=L.perspectiveRatio<this.perspectiveRatioCutoff),he||(he=!this.isInsideGrid(Y,J,ie,se)),he||i!=="always"&&this.grid.hitTest(Y,J,ie,se,i,C)?{box:[Y,J,ie,se],placeable:!1,offscreen:!1,occluded:re}:{box:[Y,J,ie,se],placeable:!0,offscreen:this.isOffscreen(Y,J,ie,se),occluded:re}}placeCollisionCircles(e,i,a,c,d,g,y,x,C,M,A,I,L,$){const X=[],Y=new l.P(i.anchorX,i.anchorY),J=this.getPerspectiveRatio(Y.x,Y.y,g,$),ie=(C?d*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,g)/J:d*J)/l.aA,se={getElevation:$,pitchedLabelPlaneMatrix:y,lineVertexArray:a,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Y,unwrappedTileID:g,width:this.transform.width,height:this.transform.height,translation:L},re=K(ie,c,i.lineOffsetX*ie,i.lineOffsetY*ie,!1,i,!1,se);let he=!1,me=!1,oe=!0;if(re){const xe=.5*A*J+I,Le=new l.P(-100,-100),ke=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Ie=new Q,Re=re.first,ct=re.last;let lt=[];for(let Jt=Re.path.length-1;Jt>=1;Jt--)lt.push(Re.path[Jt]);for(let Jt=1;Jt<ct.path.length;Jt++)lt.push(ct.path[Jt]);const Xe=2.5*xe;if(C){const Jt=this.projectPathToScreenSpace(lt,se);lt=Jt.some(vi=>vi.signedDistanceFromCamera<=0)?[]:Jt.map(vi=>vi.point)}let wt=[];if(lt.length>0){const Jt=lt[0].clone(),vi=lt[0].clone();for(let ji=1;ji<lt.length;ji++)Jt.x=Math.min(Jt.x,lt[ji].x),Jt.y=Math.min(Jt.y,lt[ji].y),vi.x=Math.max(vi.x,lt[ji].x),vi.y=Math.max(vi.y,lt[ji].y);wt=Jt.x>=Le.x&&vi.x<=ke.x&&Jt.y>=Le.y&&vi.y<=ke.y?[lt]:vi.x<Le.x||Jt.x>ke.x||vi.y<Le.y||Jt.y>ke.y?[]:l.ax([lt],Le.x,Le.y,ke.x,ke.y)}for(const Jt of wt){Ie.reset(Jt,.25*xe);let vi=0;vi=Ie.length<=.5*xe?1:Math.ceil(Ie.paddedLength/Xe)+1;for(let ji=0;ji<vi;ji++){const xi=ji/Math.max(vi-1,1),Ni=Ie.lerp(xi),Mi=Ni.x+Ei,wi=Ni.y+Ei;X.push(Mi,wi,xe,0);const ki=Mi-xe,wn=wi-xe,di=Mi+xe,fn=wi+xe;if(oe=oe&&this.isOffscreen(ki,wn,di,fn),me=me||this.isInsideGrid(ki,wn,di,fn),e!=="always"&&this.grid.hitTestCircle(Mi,wi,xe,e,M)&&(he=!0,!x))return{circles:[],offscreen:!1,collisionDetected:he}}}}return{circles:!x&&he||!me||J<this.perspectiveRatioCutoff?[]:X,offscreen:oe,collisionDetected:he}}projectPathToScreenSpace(e,i){const a=function(c,d){const g=l.L();return l.ap(g,d.pitchedLabelPlaneMatrix),c.map(y=>{const x=Ze(y.x,y.y,g,d.getElevation),C=d.transform.projectTileCoordinates(x.point.x,x.point.y,d.unwrappedTileID,d.getElevation);return C.point.x=(.5*C.point.x+.5)*d.width,C.point.y=(.5*-C.point.y+.5)*d.height,C})}(e,i);return function(c){let d=0,g=0,y=0,x=0;for(let C=0;C<c.length;C++)c[C].isOccluded?(y=C+1,x=0):(x++,x>g&&(g=x,d=y));return c.slice(d,d+g)}(a)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[],a=new l.a1;for(const A of e){const I=new l.P(A.x+Ei,A.y+Ei);a.extend(I),i.push(I)}const{minX:c,minY:d,maxX:g,maxY:y}=a,x=this.grid.query(c,d,g,y).concat(this.ignoredGrid.query(c,d,g,y)),C={},M={};for(const A of x){const I=A.key;if(C[I.bucketInstanceId]===void 0&&(C[I.bucketInstanceId]={}),C[I.bucketInstanceId][I.featureIndex])continue;const L=[new l.P(A.x1,A.y1),new l.P(A.x2,A.y1),new l.P(A.x2,A.y2),new l.P(A.x1,A.y2)];l.ay(i,L)&&(C[I.bucketInstanceId][I.featureIndex]=!0,M[I.bucketInstanceId]===void 0&&(M[I.bucketInstanceId]=[]),M[I.bucketInstanceId].push(I.featureIndex))}return M}insertCollisionBox(e,i,a,c,d,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:g,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,a,c,d,g){const y=a?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:d,collisionGroupID:g,overlapMode:i};for(let C=0;C<e.length;C+=4)y.insertCircle(x,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,i,a,c,d){if(d){let g;c?(g=[e,i,c(e,i),1],l.av(g,g,d)):(g=[e,i,0,1],sn(g,g,d));const y=g[3];return{x:(g[0]/y+1)/2*this.transform.width+Ei,y:(-g[1]/y+1)/2*this.transform.height+Ei,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y*.5,isOccluded:!1,signedDistanceFromCamera:y}}{const g=this.transform.projectTileCoordinates(e,i,a,c);return{x:(g.point.x+1)/2*this.transform.width+Ei,y:(1-g.point.y)/2*this.transform.height+Ei,perspectiveRatio:.5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5,isOccluded:g.isOccluded,signedDistanceFromCamera:g.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,a,c){const d=this.transform.projectTileCoordinates(e,i,a,c);return .5+this.transform.cameraToCenterDistance/d.signedDistanceFromCamera*.5}isOffscreen(e,i,a,c){return a<Ei||e>=this.screenRightBoundary||c<Ei||i>this.screenBottomBoundary}isInsideGrid(e,i,a,c){return a>=0&&e<this.gridRightBoundary&&c>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=l.af([]);return l.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,a,c,d,g,y,x,C,M,A){let I=1,L=0,$=0,X=1;const Y=e.anchorPointX+y[0],J=e.anchorPointY+y[1];if(g&&!d){const lt=this.projectAndGetPerspectiveRatio(Y+1,J,c,C,A),Xe=lt.x-x.x,wt=Math.atan((lt.y-x.y)/Xe)+(Xe<0?Math.PI:0),Jt=Math.sin(wt),vi=Math.cos(wt);I=vi,L=Jt,$=-Jt,X=vi}else if(!g&&d){const lt=nt(this.transform);I=lt.vecEast[0],L=lt.vecEast[1],$=lt.vecSouth[0],X=lt.vecSouth[1]}let ie=x.x,se=x.y,re=i;d&&(ie=Y,se=J,re=Math.pow(2,-(this.transform.zoom-a.overscaledZ)),re*=this.transform.getPitchedTextCorrection(Y,J,c),M||(re*=l.ag(.5+x.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),M&&(ie+=I*M.x*re+$*M.y*re,se+=L*M.x*re+X*M.y*re);const he=e.x1*re,me=e.x2*re,oe=(he+me)/2,xe=e.y1*re,Le=e.y2*re,ke=(xe+Le)/2,Ie=[{offsetX:he,offsetY:xe},{offsetX:oe,offsetY:xe},{offsetX:me,offsetY:xe},{offsetX:me,offsetY:ke},{offsetX:me,offsetY:Le},{offsetX:oe,offsetY:Le},{offsetX:he,offsetY:Le},{offsetX:he,offsetY:ke}];let Re=[];for(const{offsetX:lt,offsetY:Xe}of Ie)Re.push(new l.P(ie+I*lt+$*Xe,se+L*lt+X*Xe));let ct=!1;if(d){const lt=Re.map(Xe=>this.projectAndGetPerspectiveRatio(Xe.x,Xe.y,c,C,A));ct=lt.some(Xe=>!Xe.isOccluded),Re=lt.map(Xe=>new l.P(Xe.x,Xe.y))}else ct=!0;return{box:l.az(Re),allPointsOccluded:!ct}}}class va{constructor(e,i,a,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):c&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Pr{constructor(e,i,a,c,d){this.text=new va(e?e.text:null,i,a,d),this.icon=new va(e?e.icon:null,i,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ba{constructor(e,i,a){this.text=e,this.icon=i,this.skipFade=a}}class Wn{constructor(e,i,a,c,d){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=a,this.bucketIndex=c,this.tileID=d}}class Oi{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:a=>a.collisionGroupID===i}}return this.collisionGroups[e]}}function Pu(h,e,i,a,c){const{horizontalAlign:d,verticalAlign:g}=l.aG(h);return new l.P(-(d-.5)*e+a[0]*c,-(g-.5)*i+a[1]*c)}class xa{constructor(e,i,a,c,d){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new lo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Oi(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(a,c)=>i.getElevation(e,a,c):null}getBucketParts(e,i,a,c){const d=a.getBucket(i),g=a.latestFeatureIndex;if(!d||!g||i.id!==d.layerIds[0])return;const y=a.collisionBoxArray,x=d.layers[0].layout,C=d.layers[0].paint,M=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),A=a.tileSize/l.$,I=a.tileID.toUnwrapped(),L=x.get("text-rotation-alignment")==="map",$=l.aB(a,1,this.transform.zoom),X=l.aC(this.collisionIndex.transform,a,C.get("text-translate"),C.get("text-translate-anchor")),Y=l.aC(this.collisionIndex.transform,a,C.get("icon-translate"),C.get("icon-translate-anchor")),J=Be(L,this.transform,$);this.retainedQueryData[d.bucketInstanceId]=new Wn(d.bucketInstanceId,g,d.sourceLayerIndex,d.index,a.tileID);const ie={bucket:d,layout:x,translationText:X,translationIcon:Y,unwrappedTileID:I,pitchedLabelPlaneMatrix:J,scale:M,textPixelRatio:A,holdingForFade:a.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:l.am(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const se of d.sortKeyRanges){const{sortKey:re,symbolInstanceStart:he,symbolInstanceEnd:me}=se;e.push({sortKey:re,symbolInstanceStart:he,symbolInstanceEnd:me,parameters:ie})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(e,i,a,c,d,g,y,x,C,M,A,I,L,$,X,Y,J,ie,se,re){const he=l.aD[e.textAnchor],me=[e.textOffset0,e.textOffset1],oe=Pu(he,a,c,me,d),xe=this.collisionIndex.placeCollisionBox(i,I,x,C,M,y,g,Y,A.predicate,se,oe,re);if((!ie||this.collisionIndex.placeCollisionBox(ie,I,x,C,M,y,g,J,A.predicate,se,oe,re).placeable)&&xe.placeable){let Le;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(Le=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:me,width:a,height:c,anchor:he,textBoxScale:d,prevAnchor:Le},this.markUsedJustification($,he,L,X),$.allowVerticalPlacement&&(this.markUsedOrientation($,X,L),this.placedOrientations[L.crossTileID]=X),{shift:oe,placedGlyphBoxes:xe}}}placeLayerBucketPart(e,i,a){const{bucket:c,layout:d,translationText:g,translationIcon:y,unwrappedTileID:x,pitchedLabelPlaneMatrix:C,textPixelRatio:M,holdingForFade:A,collisionBoxArray:I,partiallyEvaluatedTextSize:L,collisionGroup:$}=e.parameters,X=d.get("text-optional"),Y=d.get("icon-optional"),J=l.aE(d,"text-overlap","text-allow-overlap"),ie=J==="always",se=l.aE(d,"icon-overlap","icon-allow-overlap"),re=se==="always",he=d.get("text-rotation-alignment")==="map",me=d.get("text-pitch-alignment")==="map",oe=d.get("icon-text-fit")!=="none",xe=d.get("symbol-z-order")==="viewport-y",Le=ie&&(re||!c.hasIconData()||Y),ke=re&&(ie||!c.hasTextData()||X);!c.collisionArrays&&I&&c.deserializeCollisionBoxes(I);const Ie=this.retainedQueryData[c.bucketInstanceId].tileID,Re=this._getTerrainElevationFunc(Ie),ct=this.transform.getFastPathSimpleProjectionMatrix(Ie),lt=(Xe,wt,Jt)=>{var vi,ji;if(i[Xe.crossTileID])return;if(A)return void(this.placements[Xe.crossTileID]=new ba(!1,!1,!1));let xi=!1,Ni=!1,Mi=!0,wi=null,ki={box:null,placeable:!1,offscreen:null,occluded:!1},wn={placeable:!1},di=null,fn=null,Sn=null,Jr=0,Qr=0,eo=0;wt.textFeatureIndex?Jr=wt.textFeatureIndex:Xe.useRuntimeCollisionCircles&&(Jr=Xe.featureIndex),wt.verticalTextFeatureIndex&&(Qr=wt.verticalTextFeatureIndex);const wr=wt.textBox;if(wr){const Gn=Xi=>{let Ai=l.an.horizontal;if(c.allowVerticalPlacement&&!Xi&&this.prevPlacement){const jn=this.prevPlacement.placedOrientations[Xe.crossTileID];jn&&(this.placedOrientations[Xe.crossTileID]=jn,Ai=jn,this.markUsedOrientation(c,Ai,Xe))}return Ai},ur=(Xi,Ai)=>{if(c.allowVerticalPlacement&&Xe.numVerticalGlyphVertices>0&&wt.verticalTextBox){for(const jn of c.writingModes)if(jn===l.an.vertical?(ki=Ai(),wn=ki):ki=Xi(),ki&&ki.placeable)break}else ki=Xi()},to=Xe.textAnchorOffsetStartIndex,xo=Xe.textAnchorOffsetEndIndex;if(xo===to){const Xi=(Ai,jn)=>{const ln=this.collisionIndex.placeCollisionBox(Ai,J,M,Ie,x,me,he,g,$.predicate,Re,void 0,ct);return ln&&ln.placeable&&(this.markUsedOrientation(c,jn,Xe),this.placedOrientations[Xe.crossTileID]=jn),ln};ur(()=>Xi(wr,l.an.horizontal),()=>{const Ai=wt.verticalTextBox;return c.allowVerticalPlacement&&Xe.numVerticalGlyphVertices>0&&Ai?Xi(Ai,l.an.vertical):{box:null,offscreen:null}}),Gn(ki&&ki.placeable)}else{let Xi=l.aD[(ji=(vi=this.prevPlacement)===null||vi===void 0?void 0:vi.variableOffsets[Xe.crossTileID])===null||ji===void 0?void 0:ji.anchor];const Ai=(ln,wh,Wd)=>{const Cc=ln.x2-ln.x1,Ja=ln.y2-ln.y1,ra=Xe.textBoxScale,Lr=oe&&se==="never"?wh:null;let Cn=null,Rr=J==="never"?1:2,Tc="never";Xi&&Rr++;for(let io=0;io<Rr;io++){for(let Ec=to;Ec<xo;Ec++){const Mc=c.textAnchorOffsets.get(Ec);if(Xi&&Mc.textAnchor!==Xi)continue;const Qa=this.attemptAnchorPlacement(Mc,ln,Cc,Ja,ra,he,me,M,Ie,x,$,Tc,Xe,c,Wd,g,y,Lr,Re);if(Qa&&(Cn=Qa.placedGlyphBoxes,Cn&&Cn.placeable))return xi=!0,wi=Qa.shift,Cn}Xi?Xi=null:Tc=J}return a&&!Cn&&(Cn={box:this.collisionIndex.placeCollisionBox(wr,"always",M,Ie,x,me,he,g,$.predicate,Re,void 0,ct).box,offscreen:!1,placeable:!1,occluded:!1}),Cn};ur(()=>Ai(wr,wt.iconBox,l.an.horizontal),()=>{const ln=wt.verticalTextBox;return c.allowVerticalPlacement&&(!ki||!ki.placeable)&&Xe.numVerticalGlyphVertices>0&&ln?Ai(ln,wt.verticalIconBox,l.an.vertical):{box:null,occluded:!0,offscreen:null}}),ki&&(xi=ki.placeable,Mi=ki.offscreen);const jn=Gn(ki&&ki.placeable);if(!xi&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[Xe.crossTileID];ln&&(this.variableOffsets[Xe.crossTileID]=ln,this.markUsedJustification(c,ln.anchor,Xe,jn))}}}if(di=ki,xi=di&&di.placeable,Mi=di&&di.offscreen,Xe.useRuntimeCollisionCircles){const Gn=c.text.placedSymbolArray.get(Xe.centerJustifiedTextSymbolIndex),ur=l.ao(c.textSizeData,L,Gn),to=d.get("text-padding");fn=this.collisionIndex.placeCollisionCircles(J,Gn,c.lineVertexArray,c.glyphOffsetArray,ur,x,C,a,me,$.predicate,Xe.collisionCircleDiameter,to,g,Re),fn.circles.length&&fn.collisionDetected&&!a&&l.w("Collisions detected, but collision boxes are not shown"),xi=ie||fn.circles.length>0&&!fn.collisionDetected,Mi=Mi&&fn.offscreen}if(wt.iconFeatureIndex&&(eo=wt.iconFeatureIndex),wt.iconBox){const Gn=ur=>this.collisionIndex.placeCollisionBox(ur,se,M,Ie,x,me,he,y,$.predicate,Re,oe&&wi?wi:void 0,ct);wn&&wn.placeable&&wt.verticalIconBox?(Sn=Gn(wt.verticalIconBox),Ni=Sn.placeable):(Sn=Gn(wt.iconBox),Ni=Sn.placeable),Mi=Mi&&Sn.offscreen}const Xa=X||Xe.numHorizontalGlyphVertices===0&&Xe.numVerticalGlyphVertices===0,Ka=Y||Xe.numIconVertices===0;Xa||Ka?Ka?Xa||(Ni=Ni&&xi):xi=Ni&&xi:Ni=xi=Ni&&xi;const na=Ni&&Sn.placeable;if(xi&&di.placeable&&this.collisionIndex.insertCollisionBox(di.box,J,d.get("text-ignore-placement"),c.bucketInstanceId,wn&&wn.placeable&&Qr?Qr:Jr,$.ID),na&&this.collisionIndex.insertCollisionBox(Sn.box,se,d.get("icon-ignore-placement"),c.bucketInstanceId,eo,$.ID),fn&&xi&&this.collisionIndex.insertCollisionCircles(fn.circles,J,d.get("text-ignore-placement"),c.bucketInstanceId,Jr,$.ID),a&&this.storeCollisionData(c.bucketInstanceId,Jt,wt,di,Sn,fn),Xe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Xe.crossTileID]=new ba((xi||Le)&&!(di!=null&&di.occluded),(Ni||ke)&&!(Sn!=null&&Sn.occluded),Mi||c.justReloaded),i[Xe.crossTileID]=!0};if(xe){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Xe=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let wt=Xe.length-1;wt>=0;--wt){const Jt=Xe[wt];lt(c.symbolInstances.get(Jt),c.collisionArrays[Jt],Jt)}}else for(let Xe=e.symbolInstanceStart;Xe<e.symbolInstanceEnd;Xe++)lt(c.symbolInstances.get(Xe),c.collisionArrays[Xe],Xe);c.justReloaded=!1}storeCollisionData(e,i,a,c,d,g){if(a.textBox||a.iconBox){let y,x;this.collisionBoxArrays.has(e)?y=this.collisionBoxArrays.get(e):(y=new Map,this.collisionBoxArrays.set(e,y)),y.has(i)?x=y.get(i):(x={text:null,icon:null},y.set(i,x)),a.textBox&&(x.text=c.box),a.iconBox&&(x.icon=d.box)}if(g){let y=this.collisionCircleArrays[e];y===void 0&&(y=this.collisionCircleArrays[e]=[]);for(let x=0;x<g.circles.length;x+=4)y.push(g.circles[x+0]-Ei),y.push(g.circles[x+1]-Ei),y.push(g.circles[x+2]),y.push(g.collisionDetected?1:0)}}markUsedJustification(e,i,a,c){let d;d=c===l.an.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[l.aF(i)];const g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const y of g)y>=0&&(e.text.placedSymbolArray.get(y).crossTileID=d>=0&&y!==d?0:a.crossTileID)}markUsedOrientation(e,i,a){const c=i===l.an.horizontal||i===l.an.horizontalOnly?i:0,d=i===l.an.vertical?i:0,g=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const y of g)e.text.placedSymbolArray.get(y).placedOrientation=c;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let a=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const c=i?i.symbolFadeChange(e):1,d=i?i.opacities:{},g=i?i.variableOffsets:{},y=i?i.placedOrientations:{};for(const x in this.placements){const C=this.placements[x],M=d[x];M?(this.opacities[x]=new Pr(M,c,C.text,C.icon),a=a||C.text!==M.text.placed||C.icon!==M.icon.placed):(this.opacities[x]=new Pr(null,c,C.text,C.icon,C.skipFade),a=a||C.text||C.icon)}for(const x in d){const C=d[x];if(!this.opacities[x]){const M=new Pr(C,c,!1,!1);M.isHidden()||(this.opacities[x]=M,a=a||C.text.placed||C.icon.placed)}}for(const x in g)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=g[x]);for(const x in y)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=y[x]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const a={};for(const c of i){const d=c.getBucket(e);d&&c.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,c.tileID,a,c.collisionBoxArray)}}updateBucketOpacities(e,i,a,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],g=d.layout,y=new Pr(null,0,!1,!1,!0),x=g.get("text-allow-overlap"),C=g.get("icon-allow-overlap"),M=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=g.get("text-rotation-alignment")==="map",I=g.get("text-pitch-alignment")==="map",L=g.get("icon-text-fit")!=="none",$=new Pr(null,0,x&&(C||!e.hasIconData()||g.get("icon-optional")),C&&(x||!e.hasTextData()||g.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const X=(J,ie,se)=>{for(let re=0;re<ie/4;re++)J.opacityVertexArray.emplaceBack(se);J.hasVisibleVertices=J.hasVisibleVertices||se!==wa},Y=this.collisionBoxArrays.get(e.bucketInstanceId);for(let J=0;J<e.symbolInstances.length;J++){const ie=e.symbolInstances.get(J),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:re,crossTileID:he}=ie;let me=this.opacities[he];a[he]?me=y:me||(me=$,this.opacities[he]=me),a[he]=!0;const oe=ie.numIconVertices>0,xe=this.placedOrientations[ie.crossTileID],Le=xe===l.an.vertical,ke=xe===l.an.horizontal||xe===l.an.horizontalOnly;if(se>0||re>0){const Re=Lu(me.text);X(e.text,se,Le?wa:Re),X(e.text,re,ke?wa:Re);const ct=me.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(wt=>{wt>=0&&(e.text.placedSymbolArray.get(wt).hidden=ct||Le?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=ct||ke?1:0);const lt=this.variableOffsets[ie.crossTileID];lt&&this.markUsedJustification(e,lt.anchor,ie,xe);const Xe=this.placedOrientations[ie.crossTileID];Xe&&(this.markUsedJustification(e,"left",ie,Xe),this.markUsedOrientation(e,Xe,ie))}if(oe){const Re=Lu(me.icon),ct=!(L&&ie.verticalPlacedIconSymbolIndex&&Le);ie.placedIconSymbolIndex>=0&&(X(e.icon,ie.numIconVertices,ct?Re:wa),e.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=me.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(X(e.icon,ie.numVerticalIconVertices,ct?wa:Re),e.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=me.icon.isHidden())}const Ie=Y&&Y.has(J)?Y.get(J):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Re=e.collisionArrays[J];if(Re){let ct=new l.P(0,0);if(Re.textBox||Re.verticalTextBox){let lt=!0;if(M){const Xe=this.variableOffsets[he];Xe?(ct=Pu(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textBoxScale),A&&ct._rotate(I?-this.transform.bearingInRadians:this.transform.bearingInRadians)):lt=!1}if(Re.textBox||Re.verticalTextBox){let Xe;Re.textBox&&(Xe=Le),Re.verticalTextBox&&(Xe=ke),ws(e.textCollisionBox.collisionVertexArray,me.text.placed,!lt||Xe,Ie.text,ct.x,ct.y)}}if(Re.iconBox||Re.verticalIconBox){const lt=!!(!ke&&Re.verticalIconBox);let Xe;Re.iconBox&&(Xe=lt),Re.verticalIconBox&&(Xe=!lt),ws(e.iconCollisionBox.collisionVertexArray,me.icon.placed,Xe,Ie.icon,L?ct.x:0,L?ct.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const a=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function ws(h,e,i,a,c,d){a&&a.length!==0||(a=[0,0,0,0]);const g=a[0]-Ei,y=a[1]-Ei,x=a[2]-Ei,C=a[3]-Ei;h.emplaceBack(e?1:0,i?1:0,c||0,d||0,g,y),h.emplaceBack(e?1:0,i?1:0,c||0,d||0,x,y),h.emplaceBack(e?1:0,i?1:0,c||0,d||0,x,C),h.emplaceBack(e?1:0,i?1:0,c||0,d||0,g,C)}const co=Math.pow(2,25),Gr=Math.pow(2,24),Iu=Math.pow(2,17),Au=Math.pow(2,16),zu=Math.pow(2,9),Ao=Math.pow(2,8),Du=Math.pow(2,1);function Lu(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const e=h.placed?1:0,i=Math.floor(127*h.opacity);return i*co+e*Gr+i*Iu+e*Au+i*zu+e*Ao+i*Du+e}const wa=0;class wd{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,a,c,d){const g=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(g,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((y,x)=>y.sortKey-x.sortKey));this._currentPartIndex<g.length;)if(i.placeLayerBucketPart(g[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class Ru{constructor(e,i,a,c,d,g,y,x){this.placement=new xa(e,i,g,y,x),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,i,a){const c=Ce.now(),d=()=>!this._forceFullPlacement&&Ce.now()-c>2;for(;this._currentPlacementIndex>=0;){const g=i[e[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=y)&&(!g.maxzoom||g.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new wd(g)),this._inProgressLayer.continuePlacement(a[g.source],this.placement,this._showCollisionBoxes,g,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const zo=512/l.$/2;class Dl{constructor(e,i,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const c=new Map;for(let d=0;d<i.length;d++){const g=i.get(d),y=g.key,x=c.get(y);x?x.push(g):c.set(y,[g])}for(const[d,g]of c){const y={positions:g.map(x=>({x:Math.floor(x.anchorX*zo),y:Math.floor(x.anchorY*zo)})),crossTileIDs:g.map(x=>x.crossTileID)};if(y.positions.length>128){const x=new l.aH(y.positions.length,16,Uint16Array);for(const{x:C,y:M}of y.positions)x.add(C,M);x.finish(),delete y.positions,y.index=x}this._symbolsByKey[d]=y}}getScaledCoordinates(e,i){const{x:a,y:c,z:d}=this.tileID.canonical,{x:g,y,z:x}=i.canonical,C=zo/Math.pow(2,x-d),M=(y*l.$+e.anchorY)*C,A=c*l.$*zo;return{x:Math.floor((g*l.$+e.anchorX)*C-a*l.$*zo),y:Math.floor(M-A)}}findMatches(e,i,a){const c=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let d=0;d<e.length;d++){const g=e.get(d);if(g.crossTileID)continue;const y=this._symbolsByKey[g.key];if(!y)continue;const x=this.getScaledCoordinates(g,i);if(y.index){const C=y.index.range(x.x-c,x.y-c,x.x+c,x.y+c).sort();for(const M of C){const A=y.crossTileIDs[M];if(!a[A]){a[A]=!0,g.crossTileID=A;break}}}else if(y.positions)for(let C=0;C<y.positions.length;C++){const M=y.positions[C],A=y.crossTileIDs[C];if(Math.abs(M.x-x.x)<=c&&Math.abs(M.y-x.y)<=c&&!a[A]){a[A]=!0,g.crossTileID=A;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ll{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ou{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const a in this.indexes){const c=this.indexes[a],d={};for(const g in c){const y=c[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+i),d[y.tileID.key]=y}this.indexes[a]=d}this.lng=e}addBucket(e,i,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<i.symbolInstances.length;d++)i.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const g=this.indexes[d];if(Number(d)>e.overscaledZ)for(const y in g){const x=g[y];x.tileID.isChildOf(e)&&x.findMatches(i.symbolInstances,e,c)}else{const y=g[e.scaledTo(Number(d)).key];y&&y.findMatches(i.symbolInstances,e,c)}}for(let d=0;d<i.symbolInstances.length;d++){const g=i.symbolInstances.get(d);g.crossTileID||(g.crossTileID=a.generate(),c[g.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Dl(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const a of i.getCrossTileIDsLists())for(const c of a)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let i=!1;for(const a in this.indexes){const c=this.indexes[a];for(const d in c)e[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,c[d]),delete c[d],i=!0)}return i}}class Ss{constructor(){this.layerIndexes={},this.crossTileIDs=new Ll,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,a){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new Ou);let d=!1;const g={};c.handleWrapJump(a);for(const y of i){const x=y.getBucket(e);x&&e.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(y.tileID,x,this.crossTileIDs)&&(d=!0),g[x.bucketInstanceId]=!0)}return c.removeStaleBuckets(g)&&(d=!0),d}pruneUnusedLayers(e){const i={};e.forEach(a=>{i[a]=!0});for(const a in this.layerIndexes)i[a]||delete this.layerIndexes[a]}}var Cs="void main() {fragColor=vec4(1.0);}";const _r={prelude:ri(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ri("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ri("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ri(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ri(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ri(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ri(Cs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ri(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ri("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ri("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ri(Cs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ri(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ri(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ri(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ri(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ri(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ri(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ri(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ri(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ri(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ri(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ri(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ri("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ri("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ri("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ri("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ri(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ri("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ri(h,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/in ([\w]+) ([\w]+)/g),c=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=d?d.concat(c):c,y={};return{fragmentSource:h=h.replace(i,(x,C,M,A,I)=>(y[I]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${I}
in ${M} ${A} ${I};
#else
uniform ${M} ${A} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${M} ${A} ${I} = u_${I};
#endif
`)),vertexSource:e=e.replace(i,(x,C,M,A,I)=>{const L=A==="float"?"vec2":"vec4",$=I.match(/color/)?"color":L;return y[I]?C==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${M} ${L} a_${I};
out ${M} ${A} ${I};
#else
uniform ${M} ${A} u_${I};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${M} ${A} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${$}(a_${I}, u_${I}_t);
#else
    ${M} ${A} ${I} = u_${I};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${M} ${L} a_${I};
#else
uniform ${M} ${A} u_${I};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${M} ${A} ${I} = a_${I};
#else
    ${M} ${A} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${M} ${A} ${I} = unpack_mix_${$}(a_${I}, u_${I}_t);
#else
    ${M} ${A} ${I} = u_${I};
#endif
`}),staticAttributes:a,staticUniforms:g}}class Ir{constructor(e,i,a){this.vertexBuffer=e,this.indexBuffer=i,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ar=l.aI([{name:"a_pos",type:"Int16",components:2}]);const uo="#define PROJECTION_MERCATOR",Rl="mercator";class Ol{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Rl}get shaderDefine(){return uo}get shaderPreludeCode(){return _r.projectionMercator}get vertexShaderPreludeCode(){return _r.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,a,c,d){if(this._cachedMesh)return this._cachedMesh;const g=new l.aK;g.emplaceBack(0,0),g.emplaceBack(l.$,0),g.emplaceBack(0,l.$),g.emplaceBack(l.$,l.$);const y=e.createVertexBuffer(g,Ar.members),x=l.aL.simpleSegment(0,0,4,2),C=new l.aM;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3);const M=e.createIndexBuffer(C);return this._cachedMesh=new Ir(y,M,x),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class er{constructor(e=0,i=0,a=0,c=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(a)||a<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=a,this.right=c}interpolate(e,i,a){return i.top!=null&&e.top!=null&&(this.top=l.C.number(e.top,i.top,a)),i.bottom!=null&&e.bottom!=null&&(this.bottom=l.C.number(e.bottom,i.bottom,a)),i.left!=null&&e.left!=null&&(this.left=l.C.number(e.left,i.left,a)),i.right!=null&&e.right!=null&&(this.right=l.C.number(e.right,i.right,a)),this}getCenter(e,i){const a=l.ag((this.left+e-this.right)/2,0,e),c=l.ag((this.top+i-this.bottom)/2,0,i);return new l.P(a,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new er(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function zr(h,e){if(!h.renderWorldCopies||h.lngRange)return;const i=e.lng-h.center.lng;e.lng+=i>180?-360:i<-180?360:0}function oi(h){return Math.max(0,Math.floor(h))}class Sa{constructor(e,i,a,c,d,g){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=g===void 0||!!g,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=c??0,this._maxPitch=d??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=oi(this._zoom),this._scale=l.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new er,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,a){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=oi(this._zoom),this._scale=l.ae(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new er(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!a&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=l.aN(e,-180,180)*Math.PI/180;var a,c,d,g,y,x,C,M,A;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=_e(),a=this._rotationMatrix,d=-this._bearingInRadians,g=(c=this._rotationMatrix)[0],y=c[1],x=c[2],C=c[3],M=Math.sin(d),A=Math.cos(d),a[0]=g*A+x*M,a[1]=y*A+C*M,a[2]=g*-M+x*A,a[3]=y*-M+C*A)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=l.ag(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aO(this._fovInRadians)}setFov(e){e=l.ag(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=l.ad(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=l.ae(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,a){this._unmodified=!1,this._edgeInsets.interpolate(e,i,a),this._constrain(),this._calcMatrices()}resize(e,i,a=!0){this._width=e,this._height=i,a&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ut([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-l.ah,l.ah])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{const{minX:a,minY:c,maxX:d,maxY:g}=l.a1.fromPoints(i).extend(e);return[new l.P(a,c),new l.P(d,c),new l.P(d,g),new l.P(a,g),new l.P(a,c)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:a}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(a),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=l.af(new Float64Array(16));l.N(e,e,[this._width/2,-this._height/2,1]),l.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=l.af(new Float64Array(16)),l.N(e,e,[1,-1,1]),l.M(e,e,[-1,-1,0]),l.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,a,c){const d=a!==void 0?a:this.bearing,g=c=c!==void 0?c:this.pitch,y=l.a0.fromLngLat(e,i),x=-Math.cos(l.ad(g)),C=Math.sin(l.ad(g)),M=C*Math.sin(l.ad(d)),A=-C*Math.cos(l.ad(d));let I=this.elevation;const L=i-I;let $;x*L>=0||Math.abs(x)<.1?($=1e4,I=i+$*x):$=-L/x;let X,Y,J=l.aP(1,y.y),ie=0;do{if(ie+=1,ie>10)break;Y=$/J,X=new l.a0(y.x+M*Y,y.y+A*Y),J=1/X.meterInMercatorCoordinateUnits()}while(Math.abs($-Y*J)>1e-12);return{center:X.toLngLat(),elevation:I,zoom:l.aj(this.height/2/Math.tan(this.fovInRadians/2)/Y/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=l.ai(1,this.center.lat)*this.worldSize,a=this.cameraToCenterDistance/i,c=l.a0.fromLngLat(this.center,this.elevation),d=ne(this.center,this.elevation,this.pitch,this.bearing,a);this._elevation=e;const g=this.calculateCenterFromCameraLngLatAlt(d.toLngLat(),l.aP(d.z,c.y),this.bearing,this.pitch);this._elevation=g.elevation,this._center=g.center,this.setZoom(g.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=l.ai(1,this.center.lat)*this.worldSize;return ne(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/l.$,1/i/l.$]}}class Ts{constructor(e,i){this.min=e,this.max=i,this.center=l.aQ([],l.aR([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=l.aS(this.min),c=l.aS(this.max);for(let d=0;d<i.length;d++)a[d]=i[d]?this.min[d]:this.center[d],c[d]=i[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new Ts(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let a=0;a<e.planes.length;a++){const c=this.intersectsPlane(e.planes[a]);if(c===0)return 0;c===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],a=e[3];for(let c=0;c<3;c++)e[c]>0?(i+=e[c]*this.min[c],a+=e[c]*this.max[c]):(a+=e[c]*this.min[c],i+=e[c]*this.max[c]);return i>=0?2:a<0?0:1}}class Fl{distanceToTile2d(e,i,a,c){const d=c.distanceX([e,i]),g=c.distanceY([e,i]);return Math.hypot(d,g)}getWrap(e,i,a){return a}getTileBoundingVolume(e,i,a,c){var d,g;let y=a,x=a;if(c!=null&&c.terrain){const M=new l.Z(e.z,i,e.z,e.x,e.y),A=c.terrain.getMinMaxElevation(M);y=(d=A.minElevation)!==null&&d!==void 0?d:a,x=(g=A.maxElevation)!==null&&g!==void 0?g:a}const C=1<<e.z;return new Ts([i+e.x/C,e.y/C,y],[i+(e.x+1)/C,(e.y+1)/C,x])}allowVariableZoom(e,i){const a=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,c=l.ag(78.5-a/2,0,60);return!!i.terrain||e.pitch>c}allowWorldCopies(){return!0}prepareNextFrame(){}}class Pn{constructor(e,i,a){this.points=e,this.planes=i,this.aabb=a}static fromInvProjectionMatrix(e,i=1,a=0,c,d){const g=d?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],y=Math.pow(2,a),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>function(L,$,X,Y){const J=l.av([],L,$),ie=1/J[3]/X*Y;return l.aX(J,J,[ie,ie,1/J[3],ie])}(I,e,i,y));c&&function(I,L,$,X){const Y=X?4:0,J=X?0:4;let ie=0;const se=[],re=[];for(let oe=0;oe<4;oe++){const xe=l.aT([],I[oe+J],I[oe+Y]),Le=l.aY(xe);l.aQ(xe,xe,1/Le),se.push(Le),re.push(xe)}for(let oe=0;oe<4;oe++){const xe=l.aZ(I[oe+Y],re[oe],$);ie=xe!==null&&xe>=0?Math.max(ie,xe):Math.max(ie,se[oe])}const he=function(oe,xe){const Le=l.aT([],oe[xe[0]],oe[xe[1]]),ke=l.aT([],oe[xe[2]],oe[xe[1]]),Ie=[0,0,0,0];return l.aU(Ie,l.aV([],Le,ke)),Ie[3]=-l.aW(Ie,oe[xe[0]]),Ie}(I,L),me=function(oe,xe){const Le=l.a_(oe),ke=l.a$([],oe,1/Le),Ie=l.aT([],xe,l.aQ([],ke,l.aW(xe,ke))),Re=l.a_(Ie);if(Re>0){const ct=Math.sqrt(1-ke[3]*ke[3]),lt=l.aQ([],ke,-ke[3]),Xe=l.aR([],lt,l.aQ([],Ie,ct/Re));return l.b0(xe,Xe)}return null}($,he);if(me!==null){const oe=me/l.aW(re[0],he);ie=Math.min(ie,oe)}for(let oe=0;oe<4;oe++){const xe=Math.min(ie,se[oe]);I[oe+J]=[I[oe+Y][0]+re[oe][0]*xe,I[oe+Y][1]+re[oe][1]*xe,I[oe+Y][2]+re[oe][2]*xe,1]}}(x,g[0],c,d);const C=g.map(I=>{const L=l.aT([],x[I[0]],x[I[1]]),$=l.aT([],x[I[2]],x[I[1]]),X=l.aU([],l.aV([],L,$)),Y=-l.aW(X,x[I[1]]);return X.concat(Y)}),M=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],A=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const I of x)for(let L=0;L<3;L++)M[L]=Math.min(M[L],I[L]),A[L]=Math.max(A[L],I[L]);return new Pn(x,C,new Ts(M,A))}}class rn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,a=!0){this._helper.resize(e,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,a,c,d){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Sa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(g,y)=>this.getConstrained(g,y)},e,i,a,c,d),this._coveringTilesDetailsProvider=new Fl}clone(){const e=new rn;return e.apply(this),e}apply(e,i,a){this._helper.apply(e,i,a)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new l.b1(0,e)];if(this._helper._renderWorldCopies){const a=this.screenPointToMercatorCoordinate(new l.P(0,0)),c=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),d=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),g=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),y=Math.floor(Math.min(a.x,c.x,d.x,g.x)),x=Math.floor(Math.max(a.x,c.x,d.x,g.x)),C=1;for(let M=y-C;M<=x+C;M++)M!==0&&i.push(new l.b1(M,e))}return i}getCameraFrustum(){return Pn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),a=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(a)}setLocationAtPoint(e,i){const a=l.ai(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(i,a),d=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,a),g=l.a0.fromLngLat(e),y=new l.a0(g.x-(c.x-d.x),g.y-(c.y-d.y));this.setCenter(y==null?void 0:y.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(l.a0.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(l.a0.fromLngLat(e))}screenPointToLocation(e,i){var a;return(a=this.screenPointToMercatorCoordinate(e,i))===null||a===void 0?void 0:a.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const a=i.pointCoordinate(e);if(a!=null)return a}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const a=i||0,c=[e.x,e.y,0,1],d=[e.x,e.y,1,1];l.av(c,c,this._pixelMatrixInverse),l.av(d,d,this._pixelMatrixInverse);const g=c[3],y=d[3],x=c[1]/g,C=d[1]/y,M=c[2]/g,A=d[2]/y,I=M===A?0:(a-M)/(A-M);return new l.a0(l.C.number(c[0]/g,d[0]/y,I)/this.worldSize,l.C.number(x,C,I)/this.worldSize,a)}coordinatePoint(e,i=0,a=this._pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,i,1];return l.av(c,c,a),new l.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this._helper._height/2-q(this));return new ut().extend(this.screenPointToLocation(new l.P(0,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-q(this)}calculatePosMatrix(e,i=!1,a){var c;const d=(c=e.key)!==null&&c!==void 0?c:l.b2(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),g=i?this._alignedPosMatrixCache:this._posMatrixCache;if(g.has(d)){const C=g.get(d);return a?C.f32:C.f64}const y=Z(e,this.worldSize);l.O(y,i?this._alignedProjMatrix:this._viewProjMatrix,y);const x={f64:y,f32:new Float32Array(y)};return g.set(d,x),a?x.f32:x.f64}calculateFogMatrix(e){const i=e.key,a=this._fogMatrixCacheF32;if(a.has(i))return a.get(i);const c=Z(e,this.worldSize);return l.O(c,this._fogMatrix,c),a.set(i,new Float32Array(c)),a.get(i)}getConstrained(e,i){i=l.ag(+i,this.minZoom,this.maxZoom);const a={center:new l.S(e.lng,e.lat),zoom:i};let c=this._helper._lngRange;if(!this._helper._renderWorldCopies&&c===null){const se=179.9999999999;c=[-se,se]}const d=this.tileSize*l.ae(a.zoom);let g=0,y=d,x=0,C=d,M=0,A=0;const{x:I,y:L}=this.size;if(this._helper._latRange){const se=this._helper._latRange;g=l.U(se[1])*d,y=l.U(se[0])*d,y-g<L&&(M=L/(y-g))}c&&(x=l.aN(l.V(c[0])*d,0,d),C=l.aN(l.V(c[1])*d,0,d),C<x&&(C+=d),C-x<I&&(A=I/(C-x)));const{x:$,y:X}=ue(d,e);let Y,J;const ie=Math.max(A||0,M||0);if(ie){const se=new l.P(A?(C+x)/2:$,M?(y+g)/2:X);return a.center=j(d,se).wrap(),a.zoom+=l.aj(ie),a}if(this._helper._latRange){const se=L/2;X-se<g&&(J=g+se),X+se>y&&(J=y-se)}if(c){const se=(x+C)/2;let re=$;this._helper._renderWorldCopies&&(re=l.aN($,se-d/2,se+d/2));const he=I/2;re-he<x&&(Y=x+he),re+he>C&&(Y=C-he)}if(Y!==void 0||J!==void 0){const se=new l.P(Y??$,J??X);a.center=j(d,se).wrap()}return a}calculateCenterFromCameraLngLatAlt(e,i,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,c)}_calculateNearFarZIfNeeded(e,i,a){if(!this._helper.autoCalculateNearFarZ)return;const c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),d=e-c*this._helper._pixelPerMeter/Math.cos(i),g=c<0?d:e,y=Math.PI/2+this.pitchInRadians,x=l.ad(this.fov)*(Math.abs(Math.cos(l.ad(this.roll)))*this.height+Math.abs(Math.sin(l.ad(this.roll)))*this.width)/this.height*(.5+a.y/this.height),C=Math.sin(x)*g/Math.sin(l.ag(Math.PI-y-x,.01,Math.PI-.01)),M=q(this),A=Math.atan(M/this._helper.cameraToCenterDistance),I=l.ad(.75),L=A>I?2*A*(.5+a.y/(2*M)):I,$=Math.sin(L)*g/Math.sin(l.ag(Math.PI-y-L,.01,Math.PI-.01)),X=Math.min(C,$);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*X+g),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=ue(this.worldSize,this.center),a=i.x,c=i.y;this._helper._pixelPerMeter=l.ai(1,this.center.lat)*this.worldSize;const d=l.ad(Math.min(this.pitch,At)),g=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(d));let y;this._calculateNearFarZIfNeeded(g,d,e),y=new Float64Array(16),l.b3(y,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.ap(this._invProjMatrix,y),y[8]=2*-e.x/this._helper._width,y[9]=2*e.y/this._helper._height,this._projectionMatrix=l.b4(y),l.N(y,y,[1,-1,1]),l.M(y,y,[0,0,-this._helper.cameraToCenterDistance]),l.b5(y,y,-this.rollInRadians),l.b6(y,y,this.pitchInRadians),l.b5(y,y,-this.bearingInRadians),l.M(y,y,[-a,-c,0]),this._mercatorMatrix=l.N([],y,[this.worldSize,this.worldSize,this.worldSize]),l.N(y,y,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,y),l.M(y,y,[0,0,-this.elevation]),this._viewProjMatrix=y,this._invViewProjMatrix=l.ap([],y);const x=[0,0,-1,1];l.av(x,x,this._invViewProjMatrix),this._cameraPosition=[x[0]/x[3],x[1]/x[3],x[2]/x[3]],this._fogMatrix=new Float64Array(16),l.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,g,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,l.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.M(this._fogMatrix,this._fogMatrix,[-a,-c,0]),l.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,y);const C=this._helper._width%2/2,M=this._helper._height%2/2,A=Math.cos(this.bearingInRadians),I=Math.sin(-this.bearingInRadians),L=a-Math.round(a)+A*C+I*M,$=c-Math.round(c)+A*M+I*C,X=new Float64Array(y);if(l.M(X,X,[L>.5?L-1:L,$>.5?$-1:$,0]),this._alignedProjMatrix=X,y=l.ap(new Float64Array(16),this._pixelMatrix),!y)throw new Error("failed to invert matrix");this._pixelMatrixInverse=y,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new l.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.av(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=l.ai(1,this.center.lat)*this.worldSize;return ne(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const a=l.a0.fromLngLat(e),c=[a.x*this.worldSize,a.y*this.worldSize,i,1];return l.av(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(e){const{overscaledTileID:i,aligned:a,applyTerrainMatrix:c}=e,d=this._helper.getMercatorTileCoordinates(i),g=i?this.calculatePosMatrix(i,a,!0):null;let y;return y=i&&i.terrainRttPosMatrix32f&&c?i.terrainRttPosMatrix32f:g||l.b7(),{mainMatrix:y,tileMercatorCoords:d,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:y}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,a){return 1}transformLightDirection(e){return l.aS(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,a,c){const d=this.calculatePosMatrix(a);let g;c?(g=[e,i,c(e,i),1],l.av(g,g,d)):(g=[e,i,0,1],sn(g,g,d));const y=g[3];return{point:new l.P(g[0]/y,g[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const a=l.a0.fromLngLat(e,i),c=a.meterInMercatorCoordinateUnits(),d=l.b8();return l.M(d,d,[a.x,a.y,a.z]),l.b5(d,d,Math.PI),l.b6(d,d,Math.PI/2),l.N(d,d,[-c,c,c]),d}getProjectionDataForCustomLayer(e=!0){const i=new l.Z(0,0,0,0,0),a=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),c=Z(i,this.worldSize);l.O(c,this._viewProjMatrix,c),a.tileMercatorCoords=[0,0,1,1];const d=[l.$,l.$,this.worldSize/this._helper.pixelsPerMeter],g=l.b9();return l.N(g,c,d),a.fallbackMatrix=g,a.mainMatrix=g,a}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function In(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function dn(h){if(h.useSlerp)if(h.k<1){const e=l.ba(h.startEulerAngles.roll,h.startEulerAngles.pitch,h.startEulerAngles.bearing),i=l.ba(h.endEulerAngles.roll,h.endEulerAngles.pitch,h.endEulerAngles.bearing),a=new Float64Array(4);l.bb(a,e,i,h.k);const c=l.bc(a);h.tr.setRoll(c.roll),h.tr.setPitch(c.pitch),h.tr.setBearing(c.bearing)}else h.tr.setRoll(h.endEulerAngles.roll),h.tr.setPitch(h.endEulerAngles.pitch),h.tr.setBearing(h.endEulerAngles.bearing);else h.tr.setRoll(l.C.number(h.startEulerAngles.roll,h.endEulerAngles.roll,h.k)),h.tr.setPitch(l.C.number(h.startEulerAngles.pitch,h.endEulerAngles.pitch,h.k)),h.tr.setBearing(l.C.number(h.startEulerAngles.bearing,h.endEulerAngles.bearing,h.k))}function Fi(h,e,i,a,c){const d=c.padding,g=ue(c.worldSize,i.getNorthWest()),y=ue(c.worldSize,i.getNorthEast()),x=ue(c.worldSize,i.getSouthEast()),C=ue(c.worldSize,i.getSouthWest()),M=l.ad(-a),A=g.rotate(M),I=y.rotate(M),L=x.rotate(M),$=C.rotate(M),X=new l.P(Math.max(A.x,I.x,$.x,L.x),Math.max(A.y,I.y,$.y,L.y)),Y=new l.P(Math.min(A.x,I.x,$.x,L.x),Math.min(A.y,I.y,$.y,L.y)),J=X.sub(Y),ie=(c.width-(d.left+d.right+e.left+e.right))/J.x,se=(c.height-(d.top+d.bottom+e.top+e.bottom))/J.y;if(se<0||ie<0)return void In();const re=Math.min(l.aj(c.scale*Math.min(ie,se)),h.maxZoom),he=l.P.convert(h.offset),me=new l.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(l.ad(a)),oe=he.add(me).mult(c.scale/l.ae(re));return{center:j(c.worldSize,g.add(x).div(2).sub(oe)),zoom:re,bearing:a}}class Es{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,a){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(a,e.around)}cameraForBoxAndBearing(e,i,a,c,d){return Fi(e,i,a,c,d)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(l.S.convert(i.center))}handleEaseTo(e,i){const a=e.zoom,c=e.padding,d={roll:e.roll,pitch:e.pitch,bearing:e.bearing},g={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},y=i.zoom!==void 0,x=!e.isPaddingEqual(i.padding);let C=!1;const M=y?+i.zoom:e.zoom;let A=e.centerPoint.add(i.offsetAsPoint);const I=e.screenPointToLocation(A),{center:L,zoom:$}=e.getConstrained(l.S.convert(i.center||I),M??a);zr(e,L);const X=ue(e.worldSize,I),Y=ue(e.worldSize,L).sub(X),J=l.ae($-a);return C=$!==a,{easeFunc:ie=>{if(C&&e.setZoom(l.C.number(a,$,ie)),l.bd(d,g)||dn({startEulerAngles:d,endEulerAngles:g,tr:e,k:ie,useSlerp:d.roll!=g.roll}),x&&(e.interpolatePadding(c,i.padding,ie),A=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const se=l.ae(e.zoom-a),re=$>a?Math.min(2,J):Math.max(.5,J),he=Math.pow(re,1-ie),me=j(e.worldSize,X.add(Y.mult(ie*he)).mult(se));e.setLocationAtPoint(e.renderWorldCopies?me.wrap():me,A)}},isZooming:C,elevationCenter:L}}handleFlyTo(e,i){const a=i.zoom!==void 0,c=e.zoom,d=e.getConstrained(l.S.convert(i.center||i.locationAtOffset),a?+i.zoom:c),g=d.center,y=d.zoom;zr(e,g);const x=ue(e.worldSize,i.locationAtOffset),C=ue(e.worldSize,g).sub(x),M=C.mag(),A=l.ae(y-c);let I;if(i.minZoom!==void 0){const L=Math.min(+i.minZoom,c,y),$=e.getConstrained(g,L).zoom;I=l.ae($-c)}return{easeFunc:(L,$,X,Y)=>{e.setZoom(L===1?y:c+l.aj($));const J=L===1?g:j(e.worldSize,x.add(C.mult(X)).mult($));e.setLocationAtPoint(e.renderWorldCopies?J.wrap():J,Y)},scaleOfZoom:A,targetCenter:g,scaleOfMinZoom:I,pixelPathLength:M}}}class hi{constructor(e,i,a){this.blendFunction=e,this.blendColor=i,this.mask=a}}hi.Replace=[1,0],hi.disabled=new hi(hi.Replace,l.be.transparent,[!1,!1,!1,!1]),hi.unblended=new hi(hi.Replace,l.be.transparent,[!0,!0,!0,!0]),hi.alphaBlended=new hi([1,771],l.be.transparent,[!0,!0,!0,!0]);const $n=2305;class Wt{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}Wt.disabled=new Wt(!1,1029,$n),Wt.backCCW=new Wt(!0,1029,$n),Wt.frontCCW=new Wt(!0,1028,$n);class Kt{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const ho=7680;class Ut{constructor(e,i,a,c,d,g){this.test=e,this.ref=i,this.mask=a,this.fail=c,this.depthFail=d,this.pass=g}}Ut.disabled=new Ut({func:519,mask:0},0,0,ho,ho,ho);const po=new WeakMap;function Rn(h){var e;if(po.has(h))return po.get(h);{const i=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return po.set(h,i),i}}class Do{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,a=i.gl;this._texFormat=a.RGBA,this._texType=a.UNSIGNED_BYTE;const c=new l.aK;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);const d=new l.aM;d.emplaceBack(0,1,2),this._fullscreenTriangle=new Ir(i.createVertexBuffer(c,Ar.members),i.createIndexBuffer(d),l.aL.simpleSegment(0,0,c.length,d.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(a.TEXTURE1);const g=a.createTexture();a.bindTexture(a.TEXTURE_2D,g),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(g),Rn(a)&&(this._pbo=a.createBuffer(),a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.bufferData(a.PIXEL_PACK_BUFFER,4,a.STREAM_READ),a.bindBuffer(a.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const a=this._updateCount;return this._readbackQueue?a>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():a>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const a=this._cachedRenderContext.context,c=a.gl;if(this._bindFramebuffer(),a.viewport.set([0,0,this._texWidth,this._texHeight]),a.clear({color:l.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(a,c.TRIANGLES,Kt.disabled,Ut.disabled,hi.unblended,Wt.disabled,((d,g)=>({u_input:d,u_output_expected:g}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Rn(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const d=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:d}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Rn(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Do._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const Vn=l.$/128;function Bl(h,e){const i=h.granularity!==void 0?Math.max(h.granularity,1):1,a=i+(h.generateBorders?2:0),c=i+(h.extendToNorthPole||h.generateBorders?1:0)+(h.extendToSouthPole||h.generateBorders?1:0),d=a+1,g=c+1,y=h.generateBorders?-1:0,x=h.generateBorders||h.extendToNorthPole?-1:0,C=i+(h.generateBorders?1:0),M=i+(h.generateBorders||h.extendToSouthPole?1:0),A=d*g,I=a*c*6,L=d*g>65536;if(L&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const $=L||e==="32bit",X=new Int16Array(2*A);let Y=0;for(let se=x;se<=M;se++)for(let re=y;re<=C;re++){let he=re/i*l.$;re===-1&&(he=-Vn),re===i+1&&(he=l.$+Vn);let me=se/i*l.$;se===-1&&(me=h.extendToNorthPole?l.bg:-Vn),se===i+1&&(me=h.extendToSouthPole?l.bh:l.$+Vn),X[Y++]=he,X[Y++]=me}const J=$?new Uint32Array(I):new Uint16Array(I);let ie=0;for(let se=0;se<c;se++)for(let re=0;re<a;re++){const he=re+1+se*d,me=re+(se+1)*d,oe=re+1+(se+1)*d;J[ie++]=re+se*d,J[ie++]=me,J[ie++]=he,J[ie++]=he,J[ie++]=me,J[ie++]=oe}return{vertices:X.buffer.slice(0),indices:J.buffer.slice(0),uses32bitIndices:$}}const yr=new l.aJ({fill:new l.bi(128,2),line:new l.bi(512,0),tile:new l.bi(128,32),stencil:new l.bi(128,1),circle:3});class Fu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return _r.projectionGlobe}get vertexShaderPreludeCode(){return _r.projectionMercator.vertexSource}get subdivisionGranularity(){return yr}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Do(e));const i=l.U(this._errorQueryLatitudeDegrees),a=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(i,a),d=Ce.now();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=d);const g=Math.min(Math.max((d-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bk(g))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,a,c,d){const g=(d==="stencil"?yr.stencil:yr.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:g,generateBorders:a,extendToNorthPole:i.y===0&&c,extendToSouthPole:i.y===(1<<i.z)-1&&c})}_getMesh(e,i){const a=this._getMeshKey(i);if(a in this._tileMeshCache)return this._tileMeshCache[a];const c=function(d,g){const y=Bl(g,"16bit"),x=l.aK.deserialize({arrayBuffer:y.vertices,length:y.vertices.byteLength/2/2}),C=l.aM.deserialize({arrayBuffer:y.indices,length:y.indices.byteLength/2/3});return new Ir(d.createVertexBuffer(x,Ar.members),d.createIndexBuffer(C),l.aL.simpleSegment(0,0,x.length,C.length))}(e,i);return this._tileMeshCache[a]=c,c}recalculate(e){}hasTransition(){const e=Ce.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Bu=new l.r({type:new l.D(l.v.projection.type)});class Ca extends l.E{constructor(e){super(),this._transitionable=new l.t(Bu),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0)),this._mercatorProjection=new Ol,this._verticalPerspectiveProjection=new Fu}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof l.bl){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,a,c,d){return this.currentProjection.getMeshFromTileID(e,i,a,c,d)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Ta(h){const e=Lo(h.worldSize,h.center.lat);return 2*Math.PI*e}function sr(h,e,i,a,c){const d=1/(1<<c),g=e/l.$*d+a*d,y=l.bn((h/l.$*d+i*d)*Math.PI*2+Math.PI,2*Math.PI),x=2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI,C=Math.cos(x),M=new Float64Array(3);return M[0]=Math.sin(y)*C,M[1]=Math.sin(x),M[2]=Math.cos(y)*C,M}function pn(h){return function(e,i){const a=Math.cos(i),c=new Float64Array(3);return c[0]=Math.sin(e)*a,c[1]=Math.sin(i),c[2]=Math.cos(e)*a,c}(h.lng*Math.PI/180,h.lat*Math.PI/180)}function Lo(h,e){return h/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Ea(h){const e=Math.asin(h[1])/Math.PI*180,i=Math.sqrt(h[0]*h[0]+h[2]*h[2]);if(i>1e-6){const a=h[0]/i,c=Math.acos(h[2]/i),d=(a>0?c:-c)/Math.PI*180;return new l.S(l.aN(d,-180,180),e)}return new l.S(0,e)}function Ro(h){return Math.cos(h*Math.PI/180)}function on(h,e){const i=Ro(h),a=Ro(e);return l.aj(a/i)}function Ma(h,e){const i=h.rotate(e.bearingInRadians),a=e.zoom+on(e.center.lat,0),c=l.bj(1/Ro(e.center.lat),1/Ro(Math.min(Math.abs(e.center.lat),60)),l.bm(a,7,3,0,1)),d=360/Ta({worldSize:e.worldSize,center:{lat:e.center.lat}});return new l.S(e.center.lng-i.x*d*c,l.ag(e.center.lat+i.y*d,-l.ah,l.ah))}function Oo(h){const e=.5*h,i=Math.sin(e),a=Math.cos(e);return Math.log(i+a)-Math.log(a-i)}function Fo(h,e,i,a){const c=h.lat+i*a;if(Math.abs(i)>1){const d=(Math.sign(h.lat+i)!==Math.sign(h.lat)?-Math.abs(h.lat):Math.abs(h.lat))*Math.PI/180,g=Math.abs(h.lat+i)*Math.PI/180,y=Oo(d+a*(g-d)),x=Oo(d),C=Oo(g);return new l.S(h.lng+e*((y-x)/(C-x)),c)}return new l.S(h.lng+e*a,c)}class Sd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,i,a,c){const d=`${e.z}_${e.x}_${e.y}_${c!=null&&c.terrain?"t":""}`,g=this._cache.get(d);if(g)return g;const y=this._cachePrevious.get(d);if(y)return this._cache.set(d,y),y;const x=this._boundingVolumeFactory(e,i,a,c);return this._cache.set(d,x),this._hadAnyChanges=!0,x}}class Zr{constructor(e,i,a,c){this.min=a,this.max=c,this.points=e,this.planes=i}static fromAabb(e,i){const a=[];for(let c=0;c<8;c++)a.push([1&~c?e[0]:i[0],(c>>1&1)==1?i[1]:e[1],(c>>2&1)==1?i[2]:e[2]]);return new Zr(a,[[-1,0,0,i[0]],[1,0,0,-e[0]],[0,-1,0,i[1]],[0,1,0,-e[1]],[0,0,-1,i[2]],[0,0,1,-e[2]]],e,i)}static fromCenterSizeAngles(e,i,a){const c=l.bq([],a[0],a[1],a[2]),d=l.br([],[i[0],0,0],c),g=l.br([],[0,i[1],0],c),y=l.br([],[0,0,i[2]],c),x=[...e],C=[...e];for(let A=0;A<8;A++)for(let I=0;I<3;I++){const L=e[I]+d[I]*(1&~A?-1:1)+g[I]*((A>>1&1)==1?1:-1)+y[I]*((A>>2&1)==1?1:-1);x[I]=Math.min(x[I],L),C[I]=Math.max(C[I],L)}const M=[];for(let A=0;A<8;A++){const I=[...e];l.aR(I,I,l.aQ([],d,1&~A?-1:1)),l.aR(I,I,l.aQ([],g,(A>>1&1)==1?1:-1)),l.aR(I,I,l.aQ([],y,(A>>2&1)==1?1:-1)),M.push(I)}return new Zr(M,[[...d,-l.aW(d,M[0])],[...g,-l.aW(g,M[0])],[...y,-l.aW(y,M[0])],[-d[0],-d[1],-d[2],-l.aW(d,M[7])],[-g[0],-g[1],-g[2],-l.aW(g,M[7])],[-y[0],-y[1],-y[2],-l.aW(y,M[7])]],x,C)}intersectsFrustum(e){let i=!0;const a=this.points.length,c=this.planes.length,d=e.planes.length,g=e.points.length;for(let y=0;y<d;y++){const x=e.planes[y];let C=0;for(let M=0;M<a;M++){const A=this.points[M];x[0]*A[0]+x[1]*A[1]+x[2]*A[2]+x[3]>=0&&C++}if(C===0)return 0;C<a&&(i=!1)}if(i)return 2;for(let y=0;y<c;y++){const x=this.planes[y];let C=0;for(let M=0;M<g;M++){const A=e.points[M];x[0]*A[0]+x[1]*A[1]+x[2]*A[2]+x[3]>=0&&C++}if(C===0)return 0}return 1}intersectsPlane(e){const i=this.points.length;let a=0;for(let c=0;c<i;c++){const d=this.points[c];e[0]*d[0]+e[1]*d[1]+e[2]*d[2]+e[3]>=0&&a++}return a===i?2:a===0?0:1}}function ka(h,e,i){const a=h-e;return a<0?-a:Math.max(0,a-i)}function jl(h,e,i,a,c){const d=h-i;let g;return g=d<0?Math.min(-d,1+d-c):d>1?Math.min(Math.max(d-c,0),1-d):0,Math.max(g,ka(e,a,c))}class Cd{constructor(){this._boundingVolumeCache=new Sd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,i,a,c){const d=1<<a.z,g=1/d,y=a.x/d,x=a.y/d;let C=2;return C=Math.min(C,jl(e,i,y,x,g)),C=Math.min(C,jl(e,i,y+.5,-x-g,g)),C=Math.min(C,jl(e,i,y+.5,2-x-g,g)),C}getWrap(e,i,a){const c=1<<i.z,d=1/c,g=i.x/c,y=ka(e.x,g,d),x=ka(e.x,g-1,d),C=ka(e.x,g+1,d),M=Math.min(y,x,C);return M===C?1:M===x?-1:0}allowVariableZoom(e,i){return Ae(e,i)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,i,a,c){return this._boundingVolumeCache.getTileBoundingVolume(e,i,a,c)}_computeTileBoundingVolume(e,i,a,c){var d,g;let y=a,x=a;if(c!=null&&c.terrain){const C=new l.Z(e.z,i,e.z,e.x,e.y),M=c.terrain.getMinMaxElevation(C);y=(d=M.minElevation)!==null&&d!==void 0?d:a,x=(g=M.maxElevation)!==null&&g!==void 0?g:a}if(y/=l.bt,x/=l.bt,y+=1,x+=1,e.z<=0)return Zr.fromAabb([-x,-x,-x],[x,x,x]);if(e.z===1)return Zr.fromAabb([e.x===0?-x:0,e.y===0?0:-x,-x],[e.x===0?0:x,e.y===0?x:0,x]);{const C=[sr(0,0,e.x,e.y,e.z),sr(l.$,0,e.x,e.y,e.z),sr(l.$,l.$,e.x,e.y,e.z),sr(0,l.$,e.x,e.y,e.z)],M=[];for(const Ie of C)M.push(l.aQ([],Ie,x));if(x!==y)for(const Ie of C)M.push(l.aQ([],Ie,y));e.y===0&&M.push([0,1,0]),e.y===(1<<e.z)-1&&M.push([0,-1,0]);const A=[1,1,1],I=[-1,-1,-1];for(const Ie of M)for(let Re=0;Re<3;Re++)A[Re]=Math.min(A[Re],Ie[Re]),I[Re]=Math.max(I[Re],Ie[Re]);const L=sr(l.$/2,l.$/2,e.x,e.y,e.z),$=l.aV([],[0,1,0],L);l.aU($,$);const X=l.aV([],L,$);l.aU(X,X);const Y=l.aV([],C[2],C[1]);l.aU(Y,Y);const J=l.aV([],C[0],C[3]);l.aU(J,J),M.push(l.aQ([],L,x)),e.y>=(1<<e.z)/2&&M.push(l.aQ([],sr(l.$/2,0,e.x,e.y,e.z),x)),e.y<(1<<e.z)/2&&M.push(l.aQ([],sr(l.$/2,l.$,e.x,e.y,e.z),x));const ie=On(L,M),se=On(X,M),re=[-L[0],-L[1],-L[2],ie.max],he=[L[0],L[1],L[2],-ie.min],me=[-X[0],-X[1],-X[2],se.max],oe=[X[0],X[1],X[2],-se.min],xe=[...Y,0],Le=[...J,0],ke=[];return e.y===0?ke.push(l.bs(Le,xe,re),l.bs(Le,xe,he)):ke.push(l.bs(me,xe,re),l.bs(me,xe,he),l.bs(me,Le,re),l.bs(me,Le,he)),e.y===(1<<e.z)-1?ke.push(l.bs(Le,xe,re),l.bs(Le,xe,he)):ke.push(l.bs(oe,xe,re),l.bs(oe,xe,he),l.bs(oe,Le,re),l.bs(oe,Le,he)),new Zr(ke,[re,he,me,oe,xe,Le],A,I)}}}function On(h,e){let i=1/0,a=-1/0;for(const c of e){const d=l.aW(h,c);i=Math.min(i,d),a=Math.max(a,d)}return{min:i,max:a}}class Bo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=l.bu(),this._projectionMatrix=l.b8(),this._globeViewProjMatrix32f=l.b7(),this._globeViewProjMatrixNoCorrection=l.b8(),this._globeViewProjMatrixNoCorrectionInverted=l.b8(),this._globeProjMatrixInverted=l.b8(),this._cameraPosition=l.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Sa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new Cd}clone(){const e=new Bo;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=l.bo();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:a}=e,c=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:a?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,a=this.cameraToCenterDistance/e,c=Math.sin(i)*a,d=Math.cos(i)*a+1,g=1/Math.sqrt(c*c+d*d)*1;let y=-c,x=d;const C=Math.sqrt(y*y+x*x);y/=C,x/=C;const M=[0,y,x];l.bv(M,M,[0,0,0],-this.bearingInRadians),l.bw(M,M,[0,0,0],-1*this.center.lat*Math.PI/180),l.bx(M,M,[0,0,0],this.center.lng*Math.PI/180);const A=1/l.aY(M);return l.aQ(M,M,A),[...M,-g*A]}isLocationOccluded(e){return!this.isSurfacePointVisible(pn(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,a=this._helper._center.lat*Math.PI/180,c=Math.cos(a),d=[Math.sin(i)*c,Math.sin(a),Math.cos(i)*c],g=[d[2],0,-d[0]],y=[0,0,0];l.aV(y,g,d),l.aU(g,g),l.aU(y,y);const x=[0,0,0];return l.aU(x,[g[0]*e[0]+y[0]*e[1]+d[0]*e[2],g[1]*e[0]+y[1]*e[1]+d[1]*e[2],g[2]*e[0]+y[2]*e[1]+d[2]*e[2]]),x}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,a){const c=function(y,x,C){const M=1/(1<<C.z);return new l.a0(y/l.$*M+C.x*M,x/l.$*M+C.y*M)}(e,i,a.canonical),d=(g=c.y,[l.bn(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI]);var g;return this.getCircleRadiusCorrection()/Math.cos(d[1])}projectTileCoordinates(e,i,a,c){const d=a.canonical,g=sr(e,i,d.x,d.y,d.z),y=1+(c?c(e,i):0)/l.bt,x=[g[0]*y,g[1]*y,g[2]*y,1];l.av(x,x,this._globeViewProjMatrixNoCorrection);const C=this._cachedClippingPlane,M=C[0]*g[0]+C[1]*g[1]+C[2]*g[2]+C[3]<0;return{point:new l.P(x[0]/x[3],x[1]/x[3]),signedDistanceFromCamera:x[3],isOccluded:M}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Lo(this.worldSize,this.center.lat),i=l.b9(),a=l.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),l.b3(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const c=this.centerOffset;i[8]=2*-c.x/this._helper._width,i[9]=2*c.y/this._helper._height,this._projectionMatrix=l.b4(i),this._globeProjMatrixInverted=l.b9(),l.ap(this._globeProjMatrixInverted,i),l.M(i,i,[0,0,-this.cameraToCenterDistance]),l.b5(i,i,this.rollInRadians),l.b6(i,i,-this.pitchInRadians),l.b5(i,i,this.bearingInRadians),l.M(i,i,[0,0,-e]);const d=l.bo();d[0]=e,d[1]=e,d[2]=e,l.b6(a,i,this.center.lat*Math.PI/180),l.by(a,a,-this.center.lng*Math.PI/180),l.N(a,a,d),this._globeViewProjMatrixNoCorrection=a,l.b6(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.by(i,i,-this.center.lng*Math.PI/180),l.N(i,i,d),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=l.b9(),l.ap(this._globeViewProjMatrixNoCorrectionInverted,a);const g=l.bo();this._cameraPosition=l.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/e,l.bv(this._cameraPosition,this._cameraPosition,g,-this.rollInRadians),l.bw(this._cameraPosition,this._cameraPosition,g,this.pitchInRadians),l.bv(this._cameraPosition,this._cameraPosition,g,-this.bearingInRadians),l.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bw(this._cameraPosition,this._cameraPosition,g,-this.center.lat*Math.PI/180),l.bx(this._cameraPosition,this._cameraPosition,g,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const y=l.b4(this._globeViewProjMatrixNoCorrectionInverted);l.N(y,y,[1,1,-1]),this._cachedFrustum=Pn.fromInvProjectionMatrix(y,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){l.w("calculateFogMatrix is not supported on globe projection.");const i=l.b9();return l.af(i),i}getVisibleUnwrappedCoordinates(e){return[new l.b1(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const a=pn(e);l.aQ(a,a,1+i/l.bt);const c=l.bu();return l.av(c,[a[0],a[1],a[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,a=[new l.P(0,0),new l.P(e,0),new l.P(this.width,0),new l.P(this.width,i),new l.P(this.width,this.height),new l.P(e,this.height),new l.P(0,this.height),new l.P(0,i)],c=[];for(const A of a)c.push(this.unprojectScreenPoint(A));let d=0,g=0,y=0,x=0;const C=this.center;for(const A of c){const I=l.bz(C.lng,A.lng),L=l.bz(C.lat,A.lat);I<g&&(g=I),I>d&&(d=I),L<x&&(x=L),L>y&&(y=L)}const M=[C.lng+g,C.lat+x,C.lng+d,C.lat+y];return this.isSurfacePointOnScreen([0,1,0])&&(M[3]=90,M[0]=-180,M[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(M[1]=-90,M[0]=-180,M[2]=180),new ut(M)}getConstrained(e,i){const a=l.ag(e.lat,-l.ah,l.ah),c=l.ag(+i,this.minZoom+on(0,a),this.maxZoom);return{center:new l.S(e.lng,a),zoom:c}}calculateCenterFromCameraLngLatAlt(e,i,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,c)}setLocationAtPoint(e,i){const a=pn(this.unprojectScreenPoint(i)),c=pn(e),d=l.bo();l.bA(d);const g=l.bo();l.bx(g,a,d,-this.center.lng*Math.PI/180),l.bw(g,g,d,this.center.lat*Math.PI/180);const y=c[0]*c[0]+c[2]*c[2],x=g[0]*g[0];if(y<x)return;const C=Math.sqrt(y-x),M=-C,A=l.bB(c[0],c[2],g[0],C),I=l.bB(c[0],c[2],g[0],M),L=l.bo();l.bx(L,c,d,-A);const $=l.bB(L[1],L[2],g[1],g[2]),X=l.bo();l.bx(X,c,d,-I);const Y=l.bB(X[1],X[2],g[1],g[2]),J=.5*Math.PI,ie=$>=-J&&$<=J,se=Y>=-J&&Y<=J;let re,he;if(ie&&se){const Le=this.center.lng*Math.PI/180,ke=this.center.lat*Math.PI/180;l.bC(A,Le)+l.bC($,ke)<l.bC(I,Le)+l.bC(Y,ke)?(re=A,he=$):(re=I,he=Y)}else if(ie)re=A,he=$;else{if(!se)return;re=I,he=Y}const me=re/Math.PI*180,oe=he/Math.PI*180,xe=this.center.lat;this.setCenter(new l.S(me,l.ag(oe,-90,90))),this.setZoom(this.zoom+on(xe,this.center.lat))}locationToScreenPoint(e,i){const a=pn(e);if(i){const c=i.getElevationForLngLatZoom(e,this._helper._tileZoom);l.aQ(a,a,1+c/l.bt)}return this._projectSurfacePointToScreen(a)}_projectSurfacePointToScreen(e){const i=l.bu();return l.av(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new l.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const a=i.pointCoordinate(e);if(a)return a}return l.a0.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var a;return(a=this.screenPointToMercatorCoordinate(e,i))===null||a===void 0?void 0:a.toLngLat()}isPointOnMapSurface(e,i){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(a,c)}getRayDirectionFromPixel(e){const i=l.bu();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,l.av(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const a=l.bo();a[0]=i[0]-this._cameraPosition[0],a[1]=i[1]-this._cameraPosition[1],a[2]=i[2]-this._cameraPosition[2];const c=l.bo();return l.aU(c,a),c}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=l.bu();return l.av(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const a=l.aW(e,i),c=l.bo(),d=l.bo();l.aQ(d,i,a),l.aT(c,e,d);const g=1-l.aW(c,c);if(g<0)return null;const y=l.aW(e,e)-1,x=-a+(a<0?1:-1)*Math.sqrt(g),C=y/x,M=x;return{tMin:Math.min(C,M),tMax:Math.max(C,M)}}unprojectScreenPoint(e){const i=this._cameraPosition,a=this.getRayDirectionFromPixel(e),c=this.rayPlanetIntersection(i,a);if(c){const M=l.bo();l.aR(M,i,[a[0]*c.tMin,a[1]*c.tMin,a[2]*c.tMin]);const A=l.bo();return l.aU(A,M),Ea(A)}const d=this._cachedClippingPlane,g=d[0]*a[0]+d[1]*a[1]+d[2]*a[2],y=-l.b0(d,i)/g,x=l.bo();if(y>0)l.aR(x,i,[a[0]*y,a[1]*y,a[2]*y]);else{const M=l.bo();l.aR(M,i,[2*a[0],2*a[1],2*a[2]]);const A=l.b0(this._cachedClippingPlane,M);l.aT(x,M,[this._cachedClippingPlane[0]*A,this._cachedClippingPlane[1]*A,this._cachedClippingPlane[2]*A])}const C=function(M){const A=l.bo();return A[0]=M[0]*-M[3],A[1]=M[1]*-M[3],A[2]=M[2]*-M[3],{center:A,radius:Math.sqrt(1-M[3]*M[3])}}(d);return Ea(function(M,A,I){const L=l.bo();l.aT(L,I,M);const $=l.bo();return l.bp($,M,L,A/l.a_(L)),$}(C.center,C.radius,x))}getMatrixForModel(e,i){const a=l.S.convert(e),c=1/l.bt,d=l.b8();return l.by(d,d,a.lng/180*Math.PI),l.b6(d,d,-a.lat/180*Math.PI),l.M(d,d,[0,0,1+i/l.bt]),l.b6(d,d,.5*Math.PI),l.N(d,d,[c,c,c]),d}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new l.Z(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Yn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,a=!0){this._helper.resize(e,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Sa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new rn,this._verticalPerspectiveTransform=new Bo}clone(){const e=new Yn;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),a=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?a.mainMatrix:i.mainMatrix,clippingPlane:a.clippingPlane,tileMercatorCoords:a.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return l.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,a){const c=this._mercatorTransform.getPitchedTextCorrection(e,i,a),d=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,a);return l.bj(c,d,this._globeness)}projectTileCoordinates(e,i,a,c){return this.currentTransform.projectTileCoordinates(e,i,a,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,c)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const a=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return a.fallbackMatrix=i.mainMatrix,a}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Un{get useGlobeControls(){return!0}handlePanInertia(e,i){const a=Ma(e,i);return Math.abs(a.lng-i.center.lng)>180&&(a.lng=i.center.lng+179.5*Math.sign(a.lng-i.center.lng)),{easingCenter:a,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const a=e.around,c=i.screenPointToLocation(a);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const d=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const g=i.zoom-d;if(g===0)return;const y=l.bz(i.center.lng,c.lng),x=y/(Math.abs(y/180)+1),C=l.bz(i.center.lat,c.lat),M=i.getRayDirectionFromPixel(a),A=i.cameraPosition,I=-1*l.aW(A,M),L=l.bo();l.aR(L,A,[M[0]*I,M[1]*I,M[2]*I]);const $=l.aY(L)-1,X=Math.exp(.5*-Math.max($-.3,0)),Y=Lo(i.worldSize,i.center.lat)/Math.min(i.width,i.height),J=l.bm(Y,.9,.5,1,.25),ie=(1-l.ae(-g))*Math.min(X,J),se=i.center.lat,re=i.zoom,he=new l.S(i.center.lng+x*ie,l.ag(i.center.lat+C*ie,-l.ah,l.ah));i.setLocationAtPoint(c,a);const me=i.center,oe=l.bm(Math.abs(y),45,85,0,1),xe=l.bm(Y,.75,.35,0,1),Le=Math.pow(Math.max(oe,xe),.25),ke=l.bz(me.lng,he.lng),Ie=l.bz(me.lat,he.lat);i.setCenter(new l.S(me.lng+ke*Le,me.lat+Ie*Le).wrap()),i.setZoom(re+on(se,i.center.lat))}handleMapControlsPan(e,i,a){if(!e.panDelta)return;const c=i.center.lat,d=i.zoom;i.setCenter(Ma(e.panDelta,i).wrap()),i.setZoom(d+on(c,i.center.lat))}cameraForBoxAndBearing(e,i,a,c,d){const g=Fi(e,i,a,c,d),y=i.left/d.width*2-1,x=(d.width-i.right)/d.width*2-1,C=i.top/d.height*-2+1,M=(d.height-i.bottom)/d.height*-2+1,A=l.bz(a.getWest(),a.getEast())<0,I=A?a.getEast():a.getWest(),L=A?a.getWest():a.getEast(),$=Math.max(a.getNorth(),a.getSouth()),X=Math.min(a.getNorth(),a.getSouth()),Y=I+.5*l.bz(I,L),J=$+.5*l.bz($,X),ie=d.clone();ie.setCenter(g.center),ie.setBearing(g.bearing),ie.setPitch(0),ie.setRoll(0),ie.setZoom(g.zoom);const se=ie.modelViewProjectionMatrix,re=[pn(a.getNorthWest()),pn(a.getNorthEast()),pn(a.getSouthWest()),pn(a.getSouthEast()),pn(new l.S(L,J)),pn(new l.S(I,J)),pn(new l.S(Y,$)),pn(new l.S(Y,X))],he=pn(g.center);let me=Number.POSITIVE_INFINITY;for(const oe of re)y<0&&(me=Un.getLesserNonNegativeNonNull(me,Un.solveVectorScale(oe,he,se,"x",y))),x>0&&(me=Un.getLesserNonNegativeNonNull(me,Un.solveVectorScale(oe,he,se,"x",x))),C>0&&(me=Un.getLesserNonNegativeNonNull(me,Un.solveVectorScale(oe,he,se,"y",C))),M<0&&(me=Un.getLesserNonNegativeNonNull(me,Un.solveVectorScale(oe,he,se,"y",M)));if(Number.isFinite(me)&&me!==0)return g.zoom=ie.zoom+l.aj(me),g;In()}handleJumpToCenterZoom(e,i){const a=e.center.lat,c=e.getConstrained(i.center?l.S.convert(i.center):e.center,e.zoom).center;e.setCenter(c.wrap());const d=i.zoom!==void 0?+i.zoom:e.zoom+on(a,c.lat);e.zoom!==d&&e.setZoom(d)}handleEaseTo(e,i){const a=e.zoom,c=e.center,d=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},x=i.zoom!==void 0,C=!e.isPaddingEqual(i.padding);let M=!1;const A=i.center?l.S.convert(i.center):c,I=e.getConstrained(A,a).center;zr(e,I);const L=e.clone();L.setCenter(I),L.setZoom(x?+i.zoom:a+on(c.lat,A.lat)),L.setBearing(i.bearing);const $=new l.P(l.ag(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),l.ag(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));L.setLocationAtPoint(I,$);const X=(i.offset&&i.offsetAsPoint.mag())>0?L.center:I,Y=x?+i.zoom:a+on(c.lat,X.lat),J=a+on(c.lat,0),ie=Y+on(X.lat,0),se=l.bz(c.lng,X.lng),re=l.bz(c.lat,X.lat),he=l.ae(ie-J);return M=Y!==a,{easeFunc:me=>{if(l.bd(g,y)||dn({startEulerAngles:g,endEulerAngles:y,tr:e,k:me,useSlerp:g.roll!=y.roll}),C&&e.interpolatePadding(d,i.padding,me),i.around)l.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const oe=ie>J?Math.min(2,he):Math.max(.5,he),xe=Math.pow(oe,1-me),Le=Fo(c,se,re,me*xe);e.setCenter(Le.wrap())}if(M){const oe=l.C.number(J,ie,me)+on(0,e.center.lat);e.setZoom(oe)}},isZooming:M,elevationCenter:X}}handleFlyTo(e,i){const a=i.zoom!==void 0,c=e.center,d=e.zoom,g=e.padding,y=!e.isPaddingEqual(i.padding),x=e.getConstrained(l.S.convert(i.center||i.locationAtOffset),d).center,C=a?+i.zoom:e.zoom+on(e.center.lat,x.lat),M=e.clone();M.setCenter(x),M.setZoom(C),M.setBearing(i.bearing);const A=new l.P(l.ag(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),l.ag(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));M.setLocationAtPoint(x,A);const I=M.center;zr(e,I);const L=function(re,he,me){const oe=pn(he),xe=pn(me),Le=l.aW(oe,xe),ke=Math.acos(Le),Ie=Ta(re);return ke/(2*Math.PI)*Ie}(e,c,I),$=d+on(c.lat,0),X=C+on(I.lat,0),Y=l.ae(X-$);let J;if(typeof i.minZoom=="number"){const re=+i.minZoom+on(I.lat,0),he=Math.min(re,$,X)+on(0,I.lat),me=e.getConstrained(I,he).zoom+on(I.lat,0);J=l.ae(me-$)}const ie=l.bz(c.lng,I.lng),se=l.bz(c.lat,I.lat);return{easeFunc:(re,he,me,oe)=>{const xe=Fo(c,ie,se,me);y&&e.interpolatePadding(g,i.padding,re);const Le=re===1?I:xe;e.setCenter(Le.wrap());const ke=$+l.aj(he);e.setZoom(re===1?C:ke+on(0,Le.lat))},scaleOfZoom:Y,targetCenter:I,scaleOfMinZoom:J,pixelPathLength:L}}static solveVectorScale(e,i,a,c,d){const g=c==="x"?[a[0],a[4],a[8],a[12]]:[a[1],a[5],a[9],a[13]],y=[a[3],a[7],a[11],a[15]],x=e[0]*g[0]+e[1]*g[1]+e[2]*g[2],C=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],M=i[0]*g[0]+i[1]*g[1]+i[2]*g[2],A=i[0]*y[0]+i[1]*y[1]+i[2]*y[2];return M+d*C===x+d*A||y[3]*(x-M)+g[3]*(A-C)+x*A==M*C?null:(M+g[3]-d*A-d*y[3])/(M-x-d*A+d*C)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class Nl{constructor(e){this._globe=e,this._mercatorCameraHelper=new Es,this._verticalPerspectiveCameraHelper=new Un}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,a){this.currentHelper.handleMapControlsPan(e,i,a)}cameraForBoxAndBearing(e,i,a,c,d){return this.currentHelper.cameraForBoxAndBearing(e,i,a,c,d)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const Pa=(h,e)=>l.y(h,e&&e.filter(i=>i.identifier!=="source.canvas")),jo=l.bD();class $l extends l.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const c=this.sourceCaches[a].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new st(gi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,c)=>this.getGlyphs(a,c)),this.dispatcher.registerMessageHandler("GI",(a,c)=>this.getImages(a,c)),this.imageManager=new Pt,this.imageManager.setEventedParent(this),this.glyphManager=new rt(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new Tt(256,512),this.crossTileSymbolIndex=new Ss,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",l.bF()),Ti().on(Ii,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const c=this.sourceCaches[a.sourceId];if(!c)return;const d=c.getSource();if(d&&d.vectorLayerIds)for(const g in this._layers){const y=this._layers[g];y.source===d.id&&this._validateLayer(y)}})}setGlobalStateProperty(e,i){var a,c,d;this._checkLoaded();const g=i===null?(d=(c=(a=this.stylesheet.state)===null||a===void 0?void 0:a[e])===null||c===void 0?void 0:c.default)!==null&&d!==void 0?d:null:i;if(l.bG(g,this._globalState[e]))return this;this._globalState[e]=g;const y=this._findGlobalStateAffectedSources([e]);for(const x in this.sourceCaches)y.has(x)&&(this._reloadSource(x),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const i=[];for(const c in e)!l.bG(this._globalState[c],e[c].default)&&(i.push(c),this._globalState[c]=e[c].default);const a=this._findGlobalStateAffectedSources(i);for(const c in this.sourceCaches)a.has(c)&&(this._reloadSource(c),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const i=new Set;for(const a in this._layers){const c=this._layers[a],d=c.getLayoutAffectingGlobalStateRefs();for(const g of e)d.has(g)&&i.add(c.source)}return i}loadURL(e,i={},a){this.fire(new l.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;l.j(c,this._loadStyleRequest).then(g=>{this._loadStyleRequest=null,this._load(g.data,i,a)}).catch(g=>{this._loadStyleRequest=null,g&&!d.signal.aborted&&this.fire(new l.k(g))})}loadJSON(e,i={},a){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ce.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,a)}).catch(()=>{})}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(jo,{validate:!1})}_load(e,i,a){var c,d,g;const y=i.transformStyle?i.transformStyle(a,e):e;if(!i.validate||!Pa(this,l.z(y))){this._loaded=!0,this.stylesheet=y;for(const x in y.sources)this.addSource(x,y.sources[x],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new ei(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new Rt(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.setGlobalState((g=this.stylesheet.state)!==null&&g!==void 0?g:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){const e=l.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const a=l.bI(i);a.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=a}}_loadSprite(e,i=!1,a=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(d,g,y,x){return l._(this,void 0,void 0,function*(){const C=pt(d),M=y>1?"@2x":"",A={},I={};for(const{id:L,url:$}of C){const X=g.transformRequest($e($,M,".json"),"SpriteJSON");A[L]=l.j(X,x);const Y=g.transformRequest($e($,M,".png"),"SpriteImage");I[L]=mt.getImage(Y,x)}return yield Promise.all([...Object.values(A),...Object.values(I)]),function(L,$){return l._(this,void 0,void 0,function*(){const X={};for(const Y in L){X[Y]={};const J=Ce.getImageCanvasContext((yield $[Y]).data),ie=(yield L[Y]).data;for(const se in ie){const{width:re,height:he,x:me,y:oe,sdf:xe,pixelRatio:Le,stretchX:ke,stretchY:Ie,content:Re,textFitWidth:ct,textFitHeight:lt}=ie[se];X[Y][se]={data:null,pixelRatio:Le,sdf:xe,stretchX:ke,stretchY:Ie,content:Re,textFitWidth:ct,textFitHeight:lt,spriteData:{width:re,height:he,x:me,y:oe,context:J}}}}return X})}(A,I)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(d=>{if(this._spriteRequest=null,d)for(const g in d){this._spritesImagesIds[g]=[];const y=this._spritesImagesIds[g]?this._spritesImagesIds[g].filter(x=>!(x in d)):[];for(const x of y)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(const x in d[g]){const C=g==="default"?x:`${g}:${x}`;this._spritesImagesIds[g].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,d[g][x],!1):this.imageManager.addImage(C,d[g][x]),i&&(this._changedImages[C]=!0)}}}).catch(d=>{this._spriteRequest=null,c=d,this.fire(new l.k(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),a&&a(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const a=e.sourceLayer;if(!a)return;const c=i.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(a)===-1)&&this.fire(new l.k(new Error(`Source layer "${a}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?l.bJ(a):a);const c=[];for(const d of e)if(a[d]){const g=i?l.bJ(a[d]):a[d];c.push(g)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const a of i){const c=this._layers[a];c.type!=="custom"&&(e[a]=c.serialize())}return e}hasTransitions(){var e,i,a;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((a=this.projection)===null||a===void 0)&&a.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const g in this._updatedSources){const y=this._updatedSources[g];if(y==="reload")this._reloadSource(g);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(g)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];a[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in a){const d=this.sourceCaches[c];!!a[c]!=!!d.used&&d.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var a;this._checkLoaded();const c=this.serialize();if(e=i.transformStyle?i.transformStyle(c,e):e,((a=i.validate)===null||a===void 0||a)&&Pa(this,l.z(e)))return!1;(e=l.bJ(e)).layers=l.bH(e.layers);const d=l.bK(c,e),g=this._getOperationsToPerform(d);if(g.unimplemented.length>0)throw new Error(`Unimplemented: ${g.unimplemented.join(", ")}.`);if(g.operations.length===0)return!1;for(const y of g.operations)y();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],a=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":i.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":i.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setSky":i.push(()=>this.setSky.apply(this,c.args));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setGlobalState":i.push(()=>this.setGlobalState.apply(this,c.args));break;case"setTransition":i.push(()=>{});break;default:a.push(c.command)}return{operations:i,unimplemented:a}}addImage(e,i){if(this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(l.z.source,`sources.${e}`,i,null,a))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const c=this.sourceCaches[e]=new z(e,i,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new l.k(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,a={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new l.k(new Error(`Layer "${c}" already exists on this map.`)));let d;if(e.type==="custom"){if(Pa(this,l.bL(e)))return;d=l.bI(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=l.bJ(e),e=l.e(e,{source:c})),this._validate(l.z.layer,`layers.${c}`,e,{arrayIndex:-1},a))return;d=l.bI(e),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}})}const g=i?this._order.indexOf(i):this._order.length;if(i&&g===-1)this.fire(new l.k(new Error(`Cannot add layer "${c}" before non-existing layer "${i}".`)));else{if(this._order.splice(g,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const y=this._removedLayers[c];delete this._removedLayers[c],y.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const a=this._order.indexOf(e);this._order.splice(a,1);const c=i?this._order.indexOf(i):this._order.length;i&&c===-1?this.fire(new l.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,a){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===i&&c.maxzoom===a||(i!=null&&(c.minzoom=i),a!=null&&(c.maxzoom=a),this._updateLayer(c)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,a={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!l.bG(c.filter,i))return i==null?(c.setFilter(void 0),void this._updateLayer(c)):void(this._validate(l.z.filter,`layers.${c.id}.filter`,i,null,a)||(c.setFilter(l.bJ(i)),this._updateLayer(c)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.bJ(this.getLayer(e).filter)}setLayoutProperty(e,i,a,c={}){this._checkLoaded();const d=this.getLayer(e);d?l.bG(d.getLayoutProperty(i),a)||(d.setLayoutProperty(i,a,c),this._updateLayer(d)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const a=this.getLayer(e);if(a)return a.getLayoutProperty(i);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,a,c={}){this._checkLoaded();const d=this.getLayer(e);d?l.bG(d.getPaintProperty(i),a)||(d.setPaintProperty(i,a,c)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const a=e.source,c=e.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)));const g=d.getSource().type;g==="geojson"&&c?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):g!=="vector"||c?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,e.id,i)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const a=e.source,c=this.sourceCaches[a];if(c===void 0)return void this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)));const d=c.getSource().type,g=d==="vector"?e.sourceLayer:void 0;d!=="vector"||g?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(g,e.id,i):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,a=e.sourceLayer,c=this.sourceCaches[i];if(c!==void 0)return c.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),c.getFeatureState(a,e.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=l.bM(this.sourceCaches,d=>d.serialize()),i=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,c=this.stylesheet;return l.bN({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:e,layers:i,terrain:a},d=>d!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=g=>this._layers[g].type==="fill-extrusion",a={},c=[];for(let g=this._order.length-1;g>=0;g--){const y=this._order[g];if(i(y)){a[y]=g;for(const x of e){const C=x[y];if(C)for(const M of C)c.push(M)}}}c.sort((g,y)=>y.intersectionZ-g.intersectionZ);const d=[];for(let g=this._order.length-1;g>=0;g--){const y=this._order[g];if(i(y))for(let x=c.length-1;x>=0;x--){const C=c[x].feature;if(a[C.layer.id]<g)break;d.push(C),c.pop()}else for(const x of e){const C=x[y];if(C)for(const M of C)d.push(M.feature)}}return d}queryRenderedFeatures(e,i,a){i&&i.filter&&this._validate(l.z.filter,"queryRenderedFeatures.filter",i.filter,null,i);const c={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const C of i.layers){const M=this._layers[C];if(!M)return this.fire(new l.k(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];c[M.source]=!0}}const d=[];i.availableImages=this._availableImages;const g=this._serializedAllLayers(),y=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,x=Object.assign(Object.assign({},i),{layers:y});for(const C in this.sourceCaches)i.layers&&!c[C]||d.push(qt(this.sourceCaches[C],this._layers,g,e,x,a,this.map.terrain?(M,A,I)=>this.map.terrain.getElevation(M,A,I):void 0));return this.placement&&d.push(function(C,M,A,I,L,$,X){const Y={},J=$.queryRenderedSymbols(I),ie=[];for(const se of Object.keys(J).map(Number))ie.push(X[se]);ie.sort(fi);for(const se of ie){const re=se.featureIndex.lookupSymbolFeatures(J[se.bucketInstanceId],M,se.bucketIndex,se.sourceLayerIndex,L.filter,L.layers,L.availableImages,C);for(const he in re){const me=Y[he]=Y[he]||[],oe=re[he];oe.sort((xe,Le)=>{const ke=se.featureSortOrder;if(ke){const Ie=ke.indexOf(xe.featureIndex);return ke.indexOf(Le.featureIndex)-Ie}return Le.featureIndex-xe.featureIndex});for(const xe of oe)me.push(xe)}}return function(se,re,he){for(const me in se)for(const oe of se[me])Ci(oe,he[re[me].source]);return se}(Y,C,A)}(this._layers,g,this.sourceCaches,e,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,i){i&&i.filter&&this._validate(l.z.filter,"querySourceFeatures.filter",i.filter,null,i);const a=this.sourceCaches[e];return a?function(c,d){const g=c.getRenderableIds().map(C=>c.getTileByID(C)),y=[],x={};for(let C=0;C<g.length;C++){const M=g[C],A=M.tileID.canonical.key;x[A]||(x[A]=!0,M.querySourceFeatures(y,d))}return y}(a,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const a=this.light.getLight();let c=!1;for(const g in e)if(!l.bG(e[g],a[g])){c=!0;break}if(!c)return;const d={now:Ce.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(d)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const a=this.getSky();let c=!1;if(!e&&!a)return;if(e&&!a)c=!0;else if(!e&&a)c=!0;else for(const g in e)if(!l.bG(e[g],a[g])){c=!0;break}if(!c)return;const d={now:Ce.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(d)}_setProjectionInternal(e){const i=function(a){if(Array.isArray(a)){const c=new Ca({type:a});return{projection:c,transform:new Yn,cameraHelper:new Nl(c)}}switch(a){case"mercator":return{projection:new Ol,transform:new rn,cameraHelper:new Es};case"globe":{const c=new Ca({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:c,transform:new Yn,cameraHelper:new Nl(c)}}case"vertical-perspective":return{projection:new Fu,transform:new Bo,cameraHelper:new Un};default:return l.w(`Unknown projection name: ${a}. Falling back to mercator projection.`),{projection:new Ol,transform:new rn,cameraHelper:new Es}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const a in this.sourceCaches)this.sourceCaches[a].reload()}_validate(e,i,a,c,d={}){return(!d||d.validate!==!1)&&Pa(this,e.call(l.z,l.e({key:i,style:this.serialize(),value:a,styleSpec:l.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ti().off(Ii,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const a=this.sourceCaches[i];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,a,c,d=!1){let g=!1,y=!1;const x={};for(const C of this._order){const M=this._layers[C];if(M.type!=="symbol")continue;if(!x[M.source]){const I=this.sourceCaches[M.source];x[M.source]=I.getRenderableIds(!0).map(L=>I.getTileByID(L)).sort((L,$)=>$.tileID.overscaledZ-L.tileID.overscaledZ||(L.tileID.isLessThan($.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(M,x[M.source],e.center.lng);g=g||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ce.now(),e.zoom))&&(this.pauseablePlacement=new Ru(e,this.map.terrain,this._order,d,i,a,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ce.now()),y=!0),g&&this.pauseablePlacement.placement.setStale()),y||g)for(const C of this._order){const M=this._layers[C];M.type==="symbol"&&this.placement.updateLayerOpacities(M,x[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ce.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return l._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[i.source];return c&&c.setDependencies(i.tileID.key,i.type,i.icons),a})}getGlyphs(e,i){return l._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(i.stacks),c=this.sourceCaches[i.source];return c&&c.setDependencies(i.tileID.key,i.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(l.z.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,a={},c){this._checkLoaded();const d=[{id:e,url:i}],g=[...pt(this.stylesheet.sprite),...d];this._validate(l.z.sprite,"sprite",g,null,a)||(this.stylesheet.sprite=g,this._loadSprite(d,!0,c))}removeSprite(e){this._checkLoaded();const i=pt(this.stylesheet.sprite);if(i.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;i.splice(i.findIndex(a=>a.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return pt(this.stylesheet.sprite)}setSprite(e,i={},a){this._checkLoaded(),e&&this._validate(l.z.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var Td=l.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ed{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,a,c,d,g,y,x,C){this.context=e;let M=this.boundPaintVertexBuffers.length!==c.length;for(let A=0;!M&&A<c.length;A++)this.boundPaintVertexBuffers[A]!==c[A]&&(M=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==a||M||this.boundIndexBuffer!==d||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==y||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==C?this.freshBind(i,a,c,d,g,y,x,C):(e.bindVertexArray.set(this.vao),y&&y.bind(),d&&d.dynamicDraw&&d.bind(),x&&x.bind(),C&&C.bind())}freshBind(e,i,a,c,d,g,y,x){const C=e.numAttributes,M=this.context,A=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=x,i.enableAttributes(A,e);for(const I of a)I.enableAttributes(A,e);g&&g.enableAttributes(A,e),y&&y.enableAttributes(A,e),x&&x.enableAttributes(A,e),i.bind(),i.setVertexAttribPointers(A,e,d);for(const I of a)I.bind(),I.setVertexAttribPointers(A,e,d);g&&(g.bind(),g.setVertexAttribPointers(A,e,d)),c&&c.bind(),y&&(y.bind(),y.setVertexAttribPointers(A,e,d)),x&&(x.bind(),x.setVertexAttribPointers(A,e,d)),M.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Md=(h,e,i,a,c)=>({u_texture:0,u_ele_delta:h,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):l.be.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:i?i.calculateFogBlendOpacity(a):0,u_horizon_color:i?i.properties.get("horizon-color"):l.be.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),kd={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ms(h){const e=[];for(let i=0;i<h.length;i++){if(h[i]===null)continue;const a=h[i].split(" ");e.push(a.pop())}return e}class ks{constructor(e,i,a,c,d,g,y,x,C=[]){const M=e.gl;this.program=M.createProgram();const A=Ms(i.staticAttributes),I=a?a.getBinderAttributes():[],L=A.concat(I),$=_r.prelude.staticUniforms?Ms(_r.prelude.staticUniforms):[],X=y.staticUniforms?Ms(y.staticUniforms):[],Y=i.staticUniforms?Ms(i.staticUniforms):[],J=a?a.getBinderUniforms():[],ie=$.concat(X).concat(Y).concat(J),se=[];for(const ke of ie)se.indexOf(ke)<0&&se.push(ke);const re=a?a.defines():[];Rn(M)&&re.unshift("#version 300 es"),d&&re.push("#define OVERDRAW_INSPECTOR;"),g&&re.push("#define TERRAIN3D;"),x&&re.push(x),C&&re.push(...C);let he=re.concat(_r.prelude.fragmentSource,y.fragmentSource,i.fragmentSource).join(`
`),me=re.concat(_r.prelude.vertexSource,y.vertexSource,i.vertexSource).join(`
`);Rn(M)||(he=function(ke){return ke.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(he),me=function(ke){return ke.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(me));const oe=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(oe,he),M.compileShader(oe),!M.getShaderParameter(oe,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(oe)}`);M.attachShader(this.program,oe);const xe=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(xe,me),M.compileShader(xe),!M.getShaderParameter(xe,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(xe)}`);M.attachShader(this.program,xe),this.attributes={};const Le={};this.numAttributes=L.length;for(let ke=0;ke<this.numAttributes;ke++)L[ke]&&(M.bindAttribLocation(this.program,ke,L[ke]),this.attributes[L[ke]]=ke);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(xe),M.deleteShader(oe);for(let ke=0;ke<se.length;ke++){const Ie=se[ke];if(Ie&&!Le[Ie]){const Re=M.getUniformLocation(this.program,Ie);Re&&(Le[Ie]=Re)}}this.fixedUniforms=c(e,Le),this.terrainUniforms=((ke,Ie)=>({u_depth:new l.bO(ke,Ie.u_depth),u_terrain:new l.bO(ke,Ie.u_terrain),u_terrain_dim:new l.bf(ke,Ie.u_terrain_dim),u_terrain_matrix:new l.bQ(ke,Ie.u_terrain_matrix),u_terrain_unpack:new l.bR(ke,Ie.u_terrain_unpack),u_terrain_exaggeration:new l.bf(ke,Ie.u_terrain_exaggeration)}))(e,Le),this.projectionUniforms=((ke,Ie)=>({u_projection_matrix:new l.bQ(ke,Ie.u_projection_matrix),u_projection_tile_mercator_coords:new l.bR(ke,Ie.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.bR(ke,Ie.u_projection_clipping_plane),u_projection_transition:new l.bf(ke,Ie.u_projection_transition),u_projection_fallback_matrix:new l.bQ(ke,Ie.u_projection_fallback_matrix)}))(e,Le),this.binderUniforms=a?a.getUniforms(e,Le):[]}draw(e,i,a,c,d,g,y,x,C,M,A,I,L,$,X,Y,J,ie,se){const re=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(c),e.setColorMode(d),e.setCullFace(g),x){e.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,x.depthTexture),e.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,x.texture);for(const me in this.terrainUniforms)this.terrainUniforms[me].set(x[me])}if(C)for(const me in C)this.projectionUniforms[kd[me]].set(C[me]);if(y)for(const me in this.fixedUniforms)this.fixedUniforms[me].set(y[me]);Y&&Y.setUniforms(e,this.binderUniforms,$,{zoom:X});let he=0;switch(i){case re.LINES:he=2;break;case re.TRIANGLES:he=3;break;case re.LINE_STRIP:he=1}for(const me of L.get()){const oe=me.vaos||(me.vaos={});(oe[M]||(oe[M]=new Ed)).bind(e,this,A,Y?Y.getPaintVertexBuffers():[],I,me.vertexOffset,J,ie,se),re.drawElements(i,me.primitiveLength*he,re.UNSIGNED_SHORT,me.primitiveOffset*he*2)}}}function Ps(h,e,i){const a=1/l.aB(i,1,e.transform.tileZoom),c=Math.pow(2,i.tileID.overscaledZ),d=i.tileSize*Math.pow(2,e.transform.tileZoom)/c,g=d*(i.tileID.canonical.x+i.tileID.wrap*c),y=d*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[a,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[g>>16,y>>16],u_pixel_coord_lower:[65535&g,65535&y]}}const Ia=(h,e,i,a)=>{const c=h.style.light,d=c.properties.get("position"),g=[d.x,d.y,d.z],y=l.bU();c.properties.get("anchor")==="viewport"&&l.bV(y,h.transform.bearingInRadians),l.bW(g,g,y);const x=h.transform.transformLightDirection(g),C=c.properties.get("color");return{u_lightpos:g,u_lightpos_globe:x,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:a}},Vl=(h,e,i,a,c,d,g)=>l.e(Ia(h,e,i,a),Ps(d,h,g),{u_height_factor:-Math.pow(2,c.overscaledZ)/g.tileSize/8}),Is=(h,e,i,a)=>l.e(Ps(e,h,i),{u_fill_translate:a}),vr=(h,e)=>({u_world:h,u_fill_translate:e}),Pd=(h,e,i,a,c)=>l.e(Is(h,e,i,c),{u_world:a}),Ul=(h,e,i,a,c)=>{const d=h.transform;let g,y,x=0;if(i.paint.get("circle-pitch-alignment")==="map"){const C=l.aB(e,1,d.zoom);g=!0,y=[C,C],x=C/(l.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*c}else g=!1,y=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+g,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:y,u_globe_extrude_scale:x,u_translate:a}},Aa=h=>({u_pixel_extrude_scale:[1/h.width,1/h.height]}),za=h=>({u_viewport_size:[h.width,h.height]}),ju=(h,e=1)=>({u_color:h,u_overlay:0,u_overlay_scale:e}),Da=(h,e,i,a)=>{const c=l.aB(h,1,e)/(l.$*Math.pow(2,h.tileID.overscaledZ))*2*Math.PI*a;return{u_extrude_scale:l.aB(h,1,e),u_intensity:i,u_globe_extrude_scale:c}},Nu=(h,e,i,a)=>{const c=l.L();l.bX(c,0,h.width,h.height,0,0,1);const d=h.context.gl;return{u_matrix:c,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:i,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}},No=(h,e,i)=>{const a=i.paint.get("hillshade-accent-color");let c;switch(i.paint.get("hillshade-method")){case"basic":c=4;break;case"combined":c=1;break;case"igor":c=2;break;case"multidirectional":c=3;break;default:c=0}const d=i.getIlluminationProperties();for(let g=0;g<d.directionRadians.length;g++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(d.directionRadians[g]+=h.transform.bearingInRadians);return{u_image:0,u_latrange:$u(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:d.altitudeRadians,u_azimuths:d.directionRadians,u_accent:a,u_method:c,u_highlights:d.highlightColor,u_shadows:d.shadowColor}},Id=(h,e)=>{const i=e.stride,a=l.L();return l.bX(a,0,l.$,-l.$,0,0,1),l.M(a,a,[0,-l.$,0]),{u_matrix:a,u_image:1,u_dimension:[i,i],u_zoom:h.overscaledZ,u_unpack:e.getUnpackVector()}};function $u(h,e){const i=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new l.a0(0,a/i).toLngLat().lat,new l.a0(0,(a+1)/i).toLngLat().lat]}const Ad=(h,e,i=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:i,u_opacity:h.paint.get("color-relief-opacity")}),As=(h,e,i,a)=>{const c=h.transform;return{u_translation:Zl(h,e,i),u_ratio:a/l.aB(e,1,c.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},ql=(h,e,i,a,c)=>l.e(As(h,e,i,a),{u_image:0,u_image_height:c}),Vu=(h,e,i,a,c)=>{const d=h.transform,g=Gl(e,d);return{u_translation:Zl(h,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:a/l.aB(e,1,d.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[g,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Uu=(h,e,i,a,c,d)=>{const g=h.lineAtlas,y=Gl(e,h.transform),x=i.layout.get("line-cap")==="round",C=g.getDash(c.from,x),M=g.getDash(c.to,x),A=C.width*d.fromScale,I=M.width*d.toScale;return l.e(As(h,e,i,a),{u_patternscale_a:[y/A,-C.height/2],u_patternscale_b:[y/I,-M.height/2],u_sdfgamma:g.width/(256*Math.min(A,I)*h.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:M.y,u_mix:d.t})};function Gl(h,e){return 1/l.aB(h,1,e.tileZoom)}function Zl(h,e,i){return l.aC(h.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const fo=(h,e,i,a,c)=>{return{u_tl_parent:h,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(g=a.paint.get("raster-saturation"),g>0?1-1/(1.001-g):-g),u_contrast_factor:(d=a.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:qu(a.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var d,g};function qu(h){h*=Math.PI/180;const e=Math.sin(h),i=Math.cos(h);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Hl=(h,e,i,a,c,d,g,y,x,C,M,A,I)=>{const L=g.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:L.width/L.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_label_plane_matrix:y,u_coord_matrix:x,u_is_text:+M,u_pitch_with_map:+a,u_is_along_line:c,u_is_variable_anchor:d,u_texsize:A,u_texture:0,u_translation:C,u_pitched_scale:I}},$o=(h,e,i,a,c,d,g,y,x,C,M,A,I,L)=>{const $=g.transform;return l.e(Hl(h,e,i,a,c,d,g,y,x,C,M,A,L),{u_gamma_scale:a?Math.cos($.pitch*Math.PI/180)*$.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:1})},zd=(h,e,i,a,c,d,g,y,x,C,M,A,I)=>l.e($o(h,e,i,a,c,d,g,y,x,C,!0,M,0,I),{u_texsize_icon:A,u_texture_icon:1}),zs=(h,e)=>({u_opacity:h,u_color:e}),Dd=(h,e,i,a,c)=>l.e(function(d,g,y,x){const C=y.imageManager.getPattern(d.from.toString()),M=y.imageManager.getPattern(d.to.toString()),{width:A,height:I}=y.imageManager.getPixelSize(),L=Math.pow(2,x.tileID.overscaledZ),$=x.tileSize*Math.pow(2,y.transform.tileZoom)/L,X=$*(x.tileID.canonical.x+x.tileID.wrap*L),Y=$*x.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[A,I],u_mix:g.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:g.fromScale,u_scale_b:g.toScale,u_tile_units_to_pixels:1/l.aB(x,1,y.transform.tileZoom),u_pixel_coord_upper:[X>>16,Y>>16],u_pixel_coord_lower:[65535&X,65535&Y]}}(i,c,e,a),{u_opacity:h}),Gu=(h,e)=>{},Zu={fillExtrusion:(h,e)=>({u_lightpos:new l.bS(h,e.u_lightpos),u_lightpos_globe:new l.bS(h,e.u_lightpos_globe),u_lightintensity:new l.bf(h,e.u_lightintensity),u_lightcolor:new l.bS(h,e.u_lightcolor),u_vertical_gradient:new l.bf(h,e.u_vertical_gradient),u_opacity:new l.bf(h,e.u_opacity),u_fill_translate:new l.bT(h,e.u_fill_translate)}),fillExtrusionPattern:(h,e)=>({u_lightpos:new l.bS(h,e.u_lightpos),u_lightpos_globe:new l.bS(h,e.u_lightpos_globe),u_lightintensity:new l.bf(h,e.u_lightintensity),u_lightcolor:new l.bS(h,e.u_lightcolor),u_vertical_gradient:new l.bf(h,e.u_vertical_gradient),u_height_factor:new l.bf(h,e.u_height_factor),u_opacity:new l.bf(h,e.u_opacity),u_fill_translate:new l.bT(h,e.u_fill_translate),u_image:new l.bO(h,e.u_image),u_texsize:new l.bT(h,e.u_texsize),u_pixel_coord_upper:new l.bT(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bT(h,e.u_pixel_coord_lower),u_scale:new l.bS(h,e.u_scale),u_fade:new l.bf(h,e.u_fade)}),fill:(h,e)=>({u_fill_translate:new l.bT(h,e.u_fill_translate)}),fillPattern:(h,e)=>({u_image:new l.bO(h,e.u_image),u_texsize:new l.bT(h,e.u_texsize),u_pixel_coord_upper:new l.bT(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bT(h,e.u_pixel_coord_lower),u_scale:new l.bS(h,e.u_scale),u_fade:new l.bf(h,e.u_fade),u_fill_translate:new l.bT(h,e.u_fill_translate)}),fillOutline:(h,e)=>({u_world:new l.bT(h,e.u_world),u_fill_translate:new l.bT(h,e.u_fill_translate)}),fillOutlinePattern:(h,e)=>({u_world:new l.bT(h,e.u_world),u_image:new l.bO(h,e.u_image),u_texsize:new l.bT(h,e.u_texsize),u_pixel_coord_upper:new l.bT(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bT(h,e.u_pixel_coord_lower),u_scale:new l.bS(h,e.u_scale),u_fade:new l.bf(h,e.u_fade),u_fill_translate:new l.bT(h,e.u_fill_translate)}),circle:(h,e)=>({u_camera_to_center_distance:new l.bf(h,e.u_camera_to_center_distance),u_scale_with_map:new l.bO(h,e.u_scale_with_map),u_pitch_with_map:new l.bO(h,e.u_pitch_with_map),u_extrude_scale:new l.bT(h,e.u_extrude_scale),u_device_pixel_ratio:new l.bf(h,e.u_device_pixel_ratio),u_globe_extrude_scale:new l.bf(h,e.u_globe_extrude_scale),u_translate:new l.bT(h,e.u_translate)}),collisionBox:(h,e)=>({u_pixel_extrude_scale:new l.bT(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_viewport_size:new l.bT(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new l.bP(h,e.u_color),u_overlay:new l.bO(h,e.u_overlay),u_overlay_scale:new l.bf(h,e.u_overlay_scale)}),depth:Gu,clippingMask:Gu,heatmap:(h,e)=>({u_extrude_scale:new l.bf(h,e.u_extrude_scale),u_intensity:new l.bf(h,e.u_intensity),u_globe_extrude_scale:new l.bf(h,e.u_globe_extrude_scale)}),heatmapTexture:(h,e)=>({u_matrix:new l.bQ(h,e.u_matrix),u_world:new l.bT(h,e.u_world),u_image:new l.bO(h,e.u_image),u_color_ramp:new l.bO(h,e.u_color_ramp),u_opacity:new l.bf(h,e.u_opacity)}),hillshade:(h,e)=>({u_image:new l.bO(h,e.u_image),u_latrange:new l.bT(h,e.u_latrange),u_exaggeration:new l.bf(h,e.u_exaggeration),u_altitudes:new l.bZ(h,e.u_altitudes),u_azimuths:new l.bZ(h,e.u_azimuths),u_accent:new l.bP(h,e.u_accent),u_method:new l.bO(h,e.u_method),u_shadows:new l.bY(h,e.u_shadows),u_highlights:new l.bY(h,e.u_highlights)}),hillshadePrepare:(h,e)=>({u_matrix:new l.bQ(h,e.u_matrix),u_image:new l.bO(h,e.u_image),u_dimension:new l.bT(h,e.u_dimension),u_zoom:new l.bf(h,e.u_zoom),u_unpack:new l.bR(h,e.u_unpack)}),colorRelief:(h,e)=>({u_image:new l.bO(h,e.u_image),u_unpack:new l.bR(h,e.u_unpack),u_dimension:new l.bT(h,e.u_dimension),u_elevation_stops:new l.bO(h,e.u_elevation_stops),u_color_stops:new l.bO(h,e.u_color_stops),u_color_ramp_size:new l.bO(h,e.u_color_ramp_size),u_opacity:new l.bf(h,e.u_opacity)}),line:(h,e)=>({u_translation:new l.bT(h,e.u_translation),u_ratio:new l.bf(h,e.u_ratio),u_device_pixel_ratio:new l.bf(h,e.u_device_pixel_ratio),u_units_to_pixels:new l.bT(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_translation:new l.bT(h,e.u_translation),u_ratio:new l.bf(h,e.u_ratio),u_device_pixel_ratio:new l.bf(h,e.u_device_pixel_ratio),u_units_to_pixels:new l.bT(h,e.u_units_to_pixels),u_image:new l.bO(h,e.u_image),u_image_height:new l.bf(h,e.u_image_height)}),linePattern:(h,e)=>({u_translation:new l.bT(h,e.u_translation),u_texsize:new l.bT(h,e.u_texsize),u_ratio:new l.bf(h,e.u_ratio),u_device_pixel_ratio:new l.bf(h,e.u_device_pixel_ratio),u_image:new l.bO(h,e.u_image),u_units_to_pixels:new l.bT(h,e.u_units_to_pixels),u_scale:new l.bS(h,e.u_scale),u_fade:new l.bf(h,e.u_fade)}),lineSDF:(h,e)=>({u_translation:new l.bT(h,e.u_translation),u_ratio:new l.bf(h,e.u_ratio),u_device_pixel_ratio:new l.bf(h,e.u_device_pixel_ratio),u_units_to_pixels:new l.bT(h,e.u_units_to_pixels),u_patternscale_a:new l.bT(h,e.u_patternscale_a),u_patternscale_b:new l.bT(h,e.u_patternscale_b),u_sdfgamma:new l.bf(h,e.u_sdfgamma),u_image:new l.bO(h,e.u_image),u_tex_y_a:new l.bf(h,e.u_tex_y_a),u_tex_y_b:new l.bf(h,e.u_tex_y_b),u_mix:new l.bf(h,e.u_mix)}),raster:(h,e)=>({u_tl_parent:new l.bT(h,e.u_tl_parent),u_scale_parent:new l.bf(h,e.u_scale_parent),u_buffer_scale:new l.bf(h,e.u_buffer_scale),u_fade_t:new l.bf(h,e.u_fade_t),u_opacity:new l.bf(h,e.u_opacity),u_image0:new l.bO(h,e.u_image0),u_image1:new l.bO(h,e.u_image1),u_brightness_low:new l.bf(h,e.u_brightness_low),u_brightness_high:new l.bf(h,e.u_brightness_high),u_saturation_factor:new l.bf(h,e.u_saturation_factor),u_contrast_factor:new l.bf(h,e.u_contrast_factor),u_spin_weights:new l.bS(h,e.u_spin_weights),u_coords_top:new l.bR(h,e.u_coords_top),u_coords_bottom:new l.bR(h,e.u_coords_bottom)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new l.bO(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bO(h,e.u_is_size_feature_constant),u_size_t:new l.bf(h,e.u_size_t),u_size:new l.bf(h,e.u_size),u_camera_to_center_distance:new l.bf(h,e.u_camera_to_center_distance),u_pitch:new l.bf(h,e.u_pitch),u_rotate_symbol:new l.bO(h,e.u_rotate_symbol),u_aspect_ratio:new l.bf(h,e.u_aspect_ratio),u_fade_change:new l.bf(h,e.u_fade_change),u_label_plane_matrix:new l.bQ(h,e.u_label_plane_matrix),u_coord_matrix:new l.bQ(h,e.u_coord_matrix),u_is_text:new l.bO(h,e.u_is_text),u_pitch_with_map:new l.bO(h,e.u_pitch_with_map),u_is_along_line:new l.bO(h,e.u_is_along_line),u_is_variable_anchor:new l.bO(h,e.u_is_variable_anchor),u_texsize:new l.bT(h,e.u_texsize),u_texture:new l.bO(h,e.u_texture),u_translation:new l.bT(h,e.u_translation),u_pitched_scale:new l.bf(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new l.bO(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bO(h,e.u_is_size_feature_constant),u_size_t:new l.bf(h,e.u_size_t),u_size:new l.bf(h,e.u_size),u_camera_to_center_distance:new l.bf(h,e.u_camera_to_center_distance),u_pitch:new l.bf(h,e.u_pitch),u_rotate_symbol:new l.bO(h,e.u_rotate_symbol),u_aspect_ratio:new l.bf(h,e.u_aspect_ratio),u_fade_change:new l.bf(h,e.u_fade_change),u_label_plane_matrix:new l.bQ(h,e.u_label_plane_matrix),u_coord_matrix:new l.bQ(h,e.u_coord_matrix),u_is_text:new l.bO(h,e.u_is_text),u_pitch_with_map:new l.bO(h,e.u_pitch_with_map),u_is_along_line:new l.bO(h,e.u_is_along_line),u_is_variable_anchor:new l.bO(h,e.u_is_variable_anchor),u_texsize:new l.bT(h,e.u_texsize),u_texture:new l.bO(h,e.u_texture),u_gamma_scale:new l.bf(h,e.u_gamma_scale),u_device_pixel_ratio:new l.bf(h,e.u_device_pixel_ratio),u_is_halo:new l.bO(h,e.u_is_halo),u_translation:new l.bT(h,e.u_translation),u_pitched_scale:new l.bf(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new l.bO(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bO(h,e.u_is_size_feature_constant),u_size_t:new l.bf(h,e.u_size_t),u_size:new l.bf(h,e.u_size),u_camera_to_center_distance:new l.bf(h,e.u_camera_to_center_distance),u_pitch:new l.bf(h,e.u_pitch),u_rotate_symbol:new l.bO(h,e.u_rotate_symbol),u_aspect_ratio:new l.bf(h,e.u_aspect_ratio),u_fade_change:new l.bf(h,e.u_fade_change),u_label_plane_matrix:new l.bQ(h,e.u_label_plane_matrix),u_coord_matrix:new l.bQ(h,e.u_coord_matrix),u_is_text:new l.bO(h,e.u_is_text),u_pitch_with_map:new l.bO(h,e.u_pitch_with_map),u_is_along_line:new l.bO(h,e.u_is_along_line),u_is_variable_anchor:new l.bO(h,e.u_is_variable_anchor),u_texsize:new l.bT(h,e.u_texsize),u_texsize_icon:new l.bT(h,e.u_texsize_icon),u_texture:new l.bO(h,e.u_texture),u_texture_icon:new l.bO(h,e.u_texture_icon),u_gamma_scale:new l.bf(h,e.u_gamma_scale),u_device_pixel_ratio:new l.bf(h,e.u_device_pixel_ratio),u_is_halo:new l.bO(h,e.u_is_halo),u_translation:new l.bT(h,e.u_translation),u_pitched_scale:new l.bf(h,e.u_pitched_scale)}),background:(h,e)=>({u_opacity:new l.bf(h,e.u_opacity),u_color:new l.bP(h,e.u_color)}),backgroundPattern:(h,e)=>({u_opacity:new l.bf(h,e.u_opacity),u_image:new l.bO(h,e.u_image),u_pattern_tl_a:new l.bT(h,e.u_pattern_tl_a),u_pattern_br_a:new l.bT(h,e.u_pattern_br_a),u_pattern_tl_b:new l.bT(h,e.u_pattern_tl_b),u_pattern_br_b:new l.bT(h,e.u_pattern_br_b),u_texsize:new l.bT(h,e.u_texsize),u_mix:new l.bf(h,e.u_mix),u_pattern_size_a:new l.bT(h,e.u_pattern_size_a),u_pattern_size_b:new l.bT(h,e.u_pattern_size_b),u_scale_a:new l.bf(h,e.u_scale_a),u_scale_b:new l.bf(h,e.u_scale_b),u_pixel_coord_upper:new l.bT(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bT(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bf(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_texture:new l.bO(h,e.u_texture),u_ele_delta:new l.bf(h,e.u_ele_delta),u_fog_matrix:new l.bQ(h,e.u_fog_matrix),u_fog_color:new l.bP(h,e.u_fog_color),u_fog_ground_blend:new l.bf(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bf(h,e.u_fog_ground_blend_opacity),u_horizon_color:new l.bP(h,e.u_horizon_color),u_horizon_fog_blend:new l.bf(h,e.u_horizon_fog_blend),u_is_globe_mode:new l.bf(h,e.u_is_globe_mode)}),terrainDepth:(h,e)=>({u_ele_delta:new l.bf(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_texture:new l.bO(h,e.u_texture),u_terrain_coords_id:new l.bf(h,e.u_terrain_coords_id),u_ele_delta:new l.bf(h,e.u_ele_delta)}),projectionErrorMeasurement:(h,e)=>({u_input:new l.bf(h,e.u_input),u_output_expected:new l.bf(h,e.u_output_expected)}),atmosphere:(h,e)=>({u_sun_pos:new l.bS(h,e.u_sun_pos),u_atmosphere_blend:new l.bf(h,e.u_atmosphere_blend),u_globe_position:new l.bS(h,e.u_globe_position),u_globe_radius:new l.bf(h,e.u_globe_radius),u_inv_proj_matrix:new l.bQ(h,e.u_inv_proj_matrix)}),sky:(h,e)=>({u_sky_color:new l.bP(h,e.u_sky_color),u_horizon_color:new l.bP(h,e.u_horizon_color),u_horizon:new l.bT(h,e.u_horizon),u_horizon_normal:new l.bT(h,e.u_horizon_normal),u_sky_horizon_blend:new l.bf(h,e.u_sky_horizon_blend),u_sky_blend:new l.bf(h,e.u_sky_blend)})};class Hu{constructor(e,i,a){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wl{constructor(e,i,a,c){this.length=i.length,this.attributes=a,this.itemSize=i.bytesPerElement,this.dynamicDraw=c,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let a=0;a<this.attributes.length;a++){const c=i.attributes[this.attributes[a].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,i,a){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],g=i.attributes[d.name];g!==void 0&&e.vertexAttribPointer(g,d.components,e[Wu[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ds extends yi{getDefault(){return l.be.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Dr extends yi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Yl extends yi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Xl extends yi{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Kl extends yi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Yu extends yi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Jl extends yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class mo extends yi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Ql extends yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ld extends yi{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Rd extends yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class Od extends yi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Fd extends yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class Xu extends yi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Bd extends yi{getDefault(){return l.be.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ku extends yi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ls extends yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class Rs extends yi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Os extends yi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ec extends yi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class go extends yi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class La extends yi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Vo extends yi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class tr extends yi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ju extends yi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Qu extends yi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class tc extends yi{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _o extends yi{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const a=this.gl;Rn(a)?a.bindVertexArray(e):(i=a.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Fs extends yi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Bs extends yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Ra extends yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Uo extends yi{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class eh extends Uo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class qo extends Uo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Go extends Uo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const ic="Framebuffer is not complete";class nc{constructor(e,i,a,c,d){this.context=e,this.width=i,this.height=a;const g=e.gl,y=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new eh(e,y),c)this.depthAttachment=d?new Go(e,y):new qo(e,y);else if(d)throw new Error("Stencil cannot be set without depth");if(g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error(ic)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class ai{constructor(e){var i,a;if(this.gl=e,this.clearColor=new Ds(this),this.clearDepth=new Dr(this),this.clearStencil=new Yl(this),this.colorMask=new Xl(this),this.depthMask=new Kl(this),this.stencilMask=new Yu(this),this.stencilFunc=new Jl(this),this.stencilOp=new mo(this),this.stencilTest=new Ql(this),this.depthRange=new Ld(this),this.depthTest=new Rd(this),this.depthFunc=new Od(this),this.blend=new Fd(this),this.blendFunc=new Xu(this),this.blendColor=new Bd(this),this.blendEquation=new Ku(this),this.cullFace=new Ls(this),this.cullFaceSide=new Rs(this),this.frontFace=new Os(this),this.program=new ec(this),this.activeTexture=new go(this),this.viewport=new La(this),this.bindFramebuffer=new Vo(this),this.bindRenderbuffer=new tr(this),this.bindTexture=new Ju(this),this.bindVertexBuffer=new Qu(this),this.bindElementBuffer=new tc(this),this.bindVertexArray=new _o(this),this.pixelStoreUnpack=new Fs(this),this.pixelStoreUnpackPremultiplyAlpha=new Bs(this),this.pixelStoreUnpackFlipY=new Ra(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Rn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new Hu(this,e,i)}createVertexBuffer(e,i,a){return new Wl(this,e,i,a)}createRenderbuffer(e,i,a){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,e,i,a),this.bindRenderbuffer.set(null),d}createFramebuffer(e,i,a,c){return new nc(this,e,i,a,c)}clear({color:e,depth:i,stencil:a}){const c=this.gl;let d=0;e&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),a!==void 0&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),c.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.bG(e.blendFunction,hi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Rn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return Rn(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let yo;function th(h,e,i,a,c){const d=h.context,g=h.transform,y=d.gl,x=h.useProgram("collisionBox"),C=[];let M=0,A=0;for(let J=0;J<a.length;J++){const ie=a[J],se=e.getTile(ie).getBucket(i);if(!se)continue;const re=c?se.textCollisionBox:se.iconCollisionBox,he=se.collisionCircleArray;he.length>0&&(C.push({circleArray:he,circleOffset:A,coord:ie}),M+=he.length/4,A=M),re&&x.draw(d,y.LINES,Kt.disabled,Ut.disabled,h.colorModeForRenderPass(),Wt.disabled,Aa(h.transform),h.style.map.terrain&&h.style.map.terrain.getTerrainData(ie),g.getProjectionData({overscaledTileID:ie,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,null,h.transform.zoom,null,null,re.collisionVertexBuffer)}if(!c||!C.length)return;const I=h.useProgram("collisionCircle"),L=new l.b_;L.resize(4*M),L._trim();let $=0;for(const J of C)for(let ie=0;ie<J.circleArray.length/4;ie++){const se=4*ie,re=J.circleArray[se+0],he=J.circleArray[se+1],me=J.circleArray[se+2],oe=J.circleArray[se+3];L.emplace($++,re,he,me,oe,0),L.emplace($++,re,he,me,oe,1),L.emplace($++,re,he,me,oe,2),L.emplace($++,re,he,me,oe,3)}(!yo||yo.length<2*M)&&(yo=function(J){const ie=2*J,se=new l.c0;se.resize(ie),se._trim();for(let re=0;re<ie;re++){const he=6*re;se.uint16[he+0]=4*re+0,se.uint16[he+1]=4*re+1,se.uint16[he+2]=4*re+2,se.uint16[he+3]=4*re+2,se.uint16[he+4]=4*re+3,se.uint16[he+5]=4*re+0}return se}(M));const X=d.createIndexBuffer(yo,!0),Y=d.createVertexBuffer(L,l.b$.members,!0);for(const J of C){const ie=za(h.transform);I.draw(d,y.TRIANGLES,Kt.disabled,Ut.disabled,h.colorModeForRenderPass(),Wt.disabled,ie,h.style.map.terrain&&h.style.map.terrain.getTerrainData(J.coord),null,i.id,Y,X,l.aL.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,h.transform.zoom,null,null,null)}Y.destroy(),X.destroy()}const ih=l.af(new Float32Array(16));function Oa(h,e,i,a,c,d){const{horizontalAlign:g,verticalAlign:y}=l.aG(h);return new l.P((-(g-.5)*e/c+a[0])*d,(-(y-.5)*i/c+a[1])*d)}function jd(h,e,i,a,c,d){const g=e.tileAnchorPoint.add(new l.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let y=a.mult(d);i||(y=y.rotate(-c));const x=g.add(y);return Ze(x.x,x.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const y=Ue(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),x=Math.atan(y.y/y.x)+(y.x<0?Math.PI:0);return h.add(a.rotate(x))}return h.add(a)}function Nd(h,e,i,a,c,d,g,y,x,C,M,A){const I=h.text.placedSymbolArray,L=h.text.dynamicLayoutVertexArray,$=h.icon.dynamicLayoutVertexArray,X={};L.clear();for(let Y=0;Y<I.length;Y++){const J=I.get(Y),ie=J.hidden||!J.crossTileID||h.allowVerticalPlacement&&!J.placedOrientation?null:a[J.crossTileID];if(ie){const se=new l.P(J.anchorX,J.anchorY),re={getElevation:A,width:c.width,height:c.height,pitchedLabelPlaneMatrix:d,pitchWithMap:i,transform:c,tileAnchorPoint:se,translation:C,unwrappedTileID:M},he=i?Lt(se.x,se.y,re):Ue(se.x,se.y,re),me=qe(c.cameraToCenterDistance,he.signedDistanceFromCamera);let oe=l.ao(h.textSizeData,y,J)*me/l.aA;i&&(oe*=h.tilePixelRatio/g);const{width:xe,height:Le,anchor:ke,textOffset:Ie,textBoxScale:Re}=ie,ct=Oa(ke,xe,Le,Ie,Re,oe),lt=c.getPitchedTextCorrection(se.x+C[0],se.y+C[1],M),Xe=jd(he.point,re,e,ct,-c.bearingInRadians,lt),wt=h.allowVerticalPlacement&&J.placedOrientation===l.an.vertical?Math.PI/2:0;for(let Jt=0;Jt<J.numGlyphs;Jt++)l.au(L,Xe,wt);x&&J.associatedIconIndex>=0&&(X[J.associatedIconIndex]={shiftedAnchor:Xe,angle:wt})}else Ri(J.numGlyphs,L)}if(x){$.clear();const Y=h.icon.placedSymbolArray;for(let J=0;J<Y.length;J++){const ie=Y.get(J);if(ie.hidden)Ri(ie.numGlyphs,$);else{const se=X[J];if(se)for(let re=0;re<ie.numGlyphs;re++)l.au($,se.shiftedAnchor,se.angle);else Ri(ie.numGlyphs,$)}}h.icon.dynamicLayoutVertexBuffer.updateData($)}h.text.dynamicLayoutVertexBuffer.updateData(L)}function nh(h,e,i){return i.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function rh(h,e,i,a,c,d,g,y,x,C,M,A,I){const L=h.context,$=L.gl,X=h.transform,Y=y==="map",J=x==="map",ie=y!=="viewport"&&i.layout.get("symbol-placement")!=="point",se=Y&&!J&&!ie,re=!i.layout.get("symbol-sort-key").isConstant();let he=!1;const me=h.getDepthModeForSublayer(0,Kt.ReadOnly),oe=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),xe=[],Le=X.getCircleRadiusCorrection();for(const ke of a){const Ie=e.getTile(ke),Re=Ie.getBucket(i);if(!Re)continue;const ct=c?Re.text:Re.icon;if(!ct||!ct.segments.get().length||!ct.hasVisibleVertices)continue;const lt=ct.programConfigurations.get(i.id),Xe=c||Re.sdfIcons,wt=c?Re.textSizeData:Re.iconSizeData,Jt=J||X.pitch!==0,vi=h.useProgram(nh(Xe,c,Re),lt),ji=l.am(wt,X.zoom),xi=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ke);let Ni,Mi,wi,ki,wn=[0,0],di=null;if(c)Mi=Ie.glyphAtlasTexture,wi=$.LINEAR,Ni=Ie.glyphAtlasTexture.size,Re.iconsInText&&(wn=Ie.imageAtlasTexture.size,di=Ie.imageAtlasTexture,ki=Jt||h.options.rotating||h.options.zooming||wt.kind==="composite"||wt.kind==="camera"?$.LINEAR:$.NEAREST);else{const Xi=i.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear;Mi=Ie.imageAtlasTexture,wi=Xe||h.options.rotating||h.options.zooming||Xi||Jt?$.LINEAR:$.NEAREST,Ni=Ie.imageAtlasTexture.size}const fn=l.aB(Ie,1,h.transform.zoom),Sn=Be(Y,h.transform,fn),Jr=l.L();l.ap(Jr,Sn);const Qr=Ve(J,Y,h.transform,fn),eo=l.aC(X,Ie,d,g),wr=X.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),Xa=oe&&Re.hasTextData(),Ka=i.layout.get("icon-text-fit")!=="none"&&Xa&&Re.hasIconData();if(ie){const Xi=h.style.map.terrain?(jn,ln)=>h.style.map.terrain.getElevation(ke,jn,ln):null,Ai=i.layout.get("text-rotation-alignment")==="map";Ht(Re,h,c,Sn,Jr,J,C,Ai,ke.toUnwrapped(),X.width,X.height,eo,Xi)}const na=c&&oe||Ka,Gn=ie||na?ih:J?Sn:h.transform.clipSpaceToPixelsMatrix,ur=Xe&&i.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let to;to=Xe?Re.iconsInText?zd(wt.kind,ji,se,J,ie,na,h,Gn,Qr,eo,Ni,wn,Le):$o(wt.kind,ji,se,J,ie,na,h,Gn,Qr,eo,c,Ni,0,Le):Hl(wt.kind,ji,se,J,ie,na,h,Gn,Qr,eo,c,Ni,Le);const xo={program:vi,buffers:ct,uniformValues:to,projectionData:wr,atlasTexture:Mi,atlasTextureIcon:di,atlasInterpolation:wi,atlasInterpolationIcon:ki,isSDF:Xe,hasHalo:ur};if(re&&Re.canOverlap){he=!0;const Xi=ct.segments.get();for(const Ai of Xi)xe.push({segments:new l.aL([Ai]),sortKey:Ai.sortKey,state:xo,terrainData:xi})}else xe.push({segments:ct.segments,sortKey:0,state:xo,terrainData:xi})}he&&xe.sort((ke,Ie)=>ke.sortKey-Ie.sortKey);for(const ke of xe){const Ie=ke.state;if(L.activeTexture.set($.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,$.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(L.activeTexture.set($.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Ie.isSDF){const Re=Ie.uniformValues;Ie.hasHalo&&(Re.u_is_halo=1,js(Ie.buffers,ke.segments,i,h,Ie.program,me,M,A,Re,Ie.projectionData,ke.terrainData)),Re.u_is_halo=0}js(Ie.buffers,ke.segments,i,h,Ie.program,me,M,A,Ie.uniformValues,Ie.projectionData,ke.terrainData)}}function js(h,e,i,a,c,d,g,y,x,C,M){const A=a.context;c.draw(A,A.gl.TRIANGLES,d,g,y,Wt.backCCW,x,M,C,i.id,h.layoutVertexBuffer,h.indexBuffer,e,i.paint,a.transform.zoom,h.programConfigurations.get(i.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Ns(h,e,i,a,c){const d=h.context,g=d.gl,y=Ut.disabled,x=new hi([g.ONE,g.ONE],l.be.transparent,[!0,!0,!0,!0]),C=e.getBucket(i);if(!C)return;const M=a.key;let A=i.heatmapFbos.get(M);A||(A=Fa(d,e.tileSize,e.tileSize),i.heatmapFbos.set(M,A)),d.bindFramebuffer.set(A.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:l.be.transparent});const I=C.programConfigurations.get(i.id),L=h.useProgram("heatmap",I,!c),$=h.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),X=h.style.map.terrain.getTerrainData(a);L.draw(d,g.TRIANGLES,Kt.disabled,y,x,Wt.disabled,Da(e,h.transform.zoom,i.paint.get("heatmap-intensity"),1),X,$,i.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,i.paint,h.transform.zoom,I)}function $s(h,e,i,a,c){const d=h.context,g=d.gl,y=h.transform;d.setColorMode(h.colorModeForRenderPass());const x=Vs(d,e),C=i.key,M=e.heatmapFbos.get(C);if(!M)return;d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,M.colorAttachment.get()),d.activeTexture.set(g.TEXTURE1),x.bind(g.LINEAR,g.CLAMP_TO_EDGE);const A=y.getProjectionData({overscaledTileID:i,applyTerrainMatrix:c,applyGlobeMatrix:!a});h.useProgram("heatmapTexture").draw(d,g.TRIANGLES,Kt.disabled,Ut.disabled,h.colorModeForRenderPass(),Wt.disabled,Nu(h,e,0,1),null,A,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,y.zoom),M.destroy(),e.heatmapFbos.delete(C)}function Fa(h,e,i){var a,c;const d=h.gl,g=d.createTexture();d.bindTexture(d.TEXTURE_2D,g),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const y=(a=h.HALF_FLOAT)!==null&&a!==void 0?a:d.UNSIGNED_BYTE,x=(c=h.RGBA16F)!==null&&c!==void 0?c:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,x,e,i,0,d.RGBA,y,null);const C=h.createFramebuffer(e,i,!1,!1);return C.colorAttachment.set(g),C}function Vs(h,e){return e.colorRampTexture||(e.colorRampTexture=new l.T(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function rc(h,e,i,a,c){if(!i||!a||!a.imageAtlas)return;const d=a.imageAtlas.patternPositions;let g=d[i.to.toString()],y=d[i.from.toString()];if(!g&&y&&(g=y),!y&&g&&(y=g),!g||!y){const x=c.getPaintProperty(e);g=d[x],y=d[x]}g&&y&&h.setConstantPatternPositions(g,y)}function Ba(h,e,i,a,c,d,g,y){const x=h.context.gl,C="fill-pattern",M=i.paint.get(C),A=M&&M.constantOr(1),I=i.getCrossfadeParameters();let L,$,X,Y,J;const ie=h.transform,se=i.paint.get("fill-translate"),re=i.paint.get("fill-translate-anchor");g?($=A&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=x.LINES):($=A?"fillPattern":"fill",L=x.TRIANGLES);const he=M.constantOr(null);for(const me of a){const oe=e.getTile(me);if(A&&!oe.patternsLoaded())continue;const xe=oe.getBucket(i);if(!xe)continue;const Le=xe.programConfigurations.get(i.id),ke=h.useProgram($,Le),Ie=h.style.map.terrain&&h.style.map.terrain.getTerrainData(me);A&&(h.context.activeTexture.set(x.TEXTURE0),oe.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),Le.updatePaintBuffers(I)),rc(Le,C,he,oe,i);const Re=ie.getProjectionData({overscaledTileID:me,applyGlobeMatrix:!y,applyTerrainMatrix:!0}),ct=l.aC(ie,oe,se,re);if(g){Y=xe.indexBuffer2,J=xe.segments2;const Xe=[x.drawingBufferWidth,x.drawingBufferHeight];X=$==="fillOutlinePattern"&&A?Pd(h,I,oe,Xe,ct):vr(Xe,ct)}else Y=xe.indexBuffer,J=xe.segments,X=A?Is(h,I,oe,ct):{u_fill_translate:ct};const lt=h.stencilModeForClipping(me);ke.draw(h.context,L,c,lt,d,Wt.backCCW,X,Ie,Re,i.id,xe.layoutVertexBuffer,Y,J,i.paint,h.transform.zoom,Le)}}function Zo(h,e,i,a,c,d,g,y){const x=h.context,C=x.gl,M="fill-extrusion-pattern",A=i.paint.get(M),I=A.constantOr(1),L=i.getCrossfadeParameters(),$=i.paint.get("fill-extrusion-opacity"),X=A.constantOr(null),Y=h.transform;for(const J of a){const ie=e.getTile(J),se=ie.getBucket(i);if(!se)continue;const re=h.style.map.terrain&&h.style.map.terrain.getTerrainData(J),he=se.programConfigurations.get(i.id),me=h.useProgram(I?"fillExtrusionPattern":"fillExtrusion",he);I&&(h.context.activeTexture.set(C.TEXTURE0),ie.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),he.updatePaintBuffers(L));const oe=Y.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!y,applyTerrainMatrix:!0});rc(he,M,X,ie,i);const xe=l.aC(Y,ie,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Le=i.paint.get("fill-extrusion-vertical-gradient"),ke=I?Vl(h,Le,$,xe,J,L,ie):Ia(h,Le,$,xe);me.draw(x,x.gl.TRIANGLES,c,d,g,Wt.backCCW,ke,re,oe,i.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,i.paint,h.transform.zoom,he,h.style.map.terrain&&se.centroidVertexBuffer)}}function Ho(h,e,i,a,c,d,g,y,x){var C;const M=h.style.projection,A=h.context,I=h.transform,L=A.gl,$=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],X=h.useProgram("hillshade",null,!1,$),Y=!h.options.moving;for(const J of a){const ie=e.getTile(J),se=ie.fbo;if(!se)continue;const re=M.getMeshFromTileID(A,J.canonical,y,!0,"raster"),he=(C=h.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(J);A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,se.colorAttachment.get());const me=I.getProjectionData({overscaledTileID:J,aligned:Y,applyGlobeMatrix:!x,applyTerrainMatrix:!0});X.draw(A,L.TRIANGLES,d,c[J.overscaledZ],g,Wt.backCCW,No(h,ie,i),he,me,i.id,re.vertexBuffer,re.indexBuffer,re.segments)}}function ja(h,e,i,a,c,d,g,y,x){var C;const M=h.style.projection,A=h.context,I=h.transform,L=A.gl,$=h.useProgram("colorRelief"),X=!h.options.moving;let Y=!0,J=0;for(const ie of a){const se=e.getTile(ie),re=se.dem;if(Y){const ke=L.getParameter(L.MAX_TEXTURE_SIZE),{elevationTexture:Ie,colorTexture:Re}=i.getColorRampTextures(A,ke,re.getUnpackVector());A.activeTexture.set(L.TEXTURE1),Ie.bind(L.NEAREST,L.CLAMP_TO_EDGE),A.activeTexture.set(L.TEXTURE4),Re.bind(L.LINEAR,L.CLAMP_TO_EDGE),Y=!1,J=Ie.size[0]}if(!re||!re.data)continue;const he=re.stride,me=re.getPixels();if(A.activeTexture.set(L.TEXTURE0),A.pixelStoreUnpackPremultiplyAlpha.set(!1),se.demTexture=se.demTexture||h.getTileTexture(he),se.demTexture){const ke=se.demTexture;ke.update(me,{premultiply:!1}),ke.bind(L.LINEAR,L.CLAMP_TO_EDGE)}else se.demTexture=new l.T(A,me,L.RGBA,{premultiply:!1}),se.demTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const oe=M.getMeshFromTileID(A,ie.canonical,y,!0,"raster"),xe=(C=h.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(ie),Le=I.getProjectionData({overscaledTileID:ie,aligned:X,applyGlobeMatrix:!x,applyTerrainMatrix:!0});$.draw(A,L.TRIANGLES,d,c[ie.overscaledZ],g,Wt.backCCW,Ad(i,se.dem,J),xe,Le,i.id,oe.vertexBuffer,oe.indexBuffer,oe.segments)}}const oc=[new l.P(0,0),new l.P(l.$,0),new l.P(l.$,l.$),new l.P(0,l.$)];function Hr(h,e,i,a,c,d,g,y,x=!1,C=!1){const M=a[a.length-1].overscaledZ,A=h.context,I=A.gl,L=h.useProgram("raster"),$=h.transform,X=h.style.projection,Y=h.colorModeForRenderPass(),J=!h.options.moving;for(const ie of a){const se=h.getDepthModeForSublayer(ie.overscaledZ-M,i.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,I.LESS),re=e.getTile(ie);re.registerFadeDuration(i.paint.get("raster-fade-duration"));const he=e.findLoadedParent(ie,0),me=e.findLoadedSibling(ie),oe=$d(re,he||me||null,e,i,h.transform,h.style.map.terrain);let xe,Le;const ke=i.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;A.activeTexture.set(I.TEXTURE0),re.texture.bind(ke,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(I.TEXTURE1),he?(he.texture.bind(ke,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,he.tileID.overscaledZ-re.tileID.overscaledZ),Le=[re.tileID.canonical.x*xe%1,re.tileID.canonical.y*xe%1]):re.texture.bind(ke,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),re.texture.useMipmap&&A.extTextureFilterAnisotropic&&h.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const Ie=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ie),Re=$.getProjectionData({overscaledTileID:ie,aligned:J,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),ct=fo(Le||[0,0],xe||1,oe,i,y),lt=X.getMeshFromTileID(A,ie.canonical,d,g,"raster");L.draw(A,I.TRIANGLES,se,c?c[ie.overscaledZ]:Ut.disabled,Y,x?Wt.frontCCW:Wt.backCCW,ct,Ie,Re,i.id,lt.vertexBuffer,lt.indexBuffer,lt.segments)}}function $d(h,e,i,a,c,d){const g=a.paint.get("raster-fade-duration");if(!d&&g>0){const y=Ce.now(),x=(y-h.timeAdded)/g,C=e?(y-e.timeAdded)/g:-1,M=i.getSource(),A=Ae(c,{tileSize:M.tileSize,roundZoom:M.roundZoom}),I=!e||Math.abs(e.tileID.overscaledZ-A)>Math.abs(h.tileID.overscaledZ-A),L=I&&h.refreshedUponExpiration?1:l.ag(I?x:1-C,0,1);return h.refreshedUponExpiration&&x>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}const oh=new l.be(1,0,0,1),Us=new l.be(0,1,0,1),ac=new l.be(0,0,1,1),ah=new l.be(1,0,1,1),sh=new l.be(0,1,1,1);function Na(h,e,i,a){Gs(h,0,e+i/2,h.transform.width,i,a)}function qs(h,e,i,a){Gs(h,e-i/2,0,i,h.transform.height,a)}function Gs(h,e,i,a,c,d){const g=h.context,y=g.gl;y.enable(y.SCISSOR_TEST),y.scissor(e*h.pixelRatio,i*h.pixelRatio,a*h.pixelRatio,c*h.pixelRatio),g.clear({color:d}),y.disable(y.SCISSOR_TEST)}function lh(h,e,i){const a=h.context,c=a.gl,d=h.useProgram("debug"),g=Kt.disabled,y=Ut.disabled,x=h.colorModeForRenderPass(),C="$debug",M=h.style.map.terrain&&h.style.map.terrain.getTerrainData(i);a.activeTexture.set(c.TEXTURE0);const A=e.getTileByID(i.key).latestRawTileData,I=Math.floor((A&&A.byteLength||0)/1024),L=e.getTile(i).tileSize,$=512/Math.min(L,512)*(i.overscaledZ/h.transform.zoom)*.5;let X=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(X+=` => ${i.overscaledZ}`),function(J,ie){J.initDebugOverlayCanvas();const se=J.debugOverlayCanvas,re=J.context.gl,he=J.debugOverlayCanvas.getContext("2d");he.clearRect(0,0,se.width,se.height),he.shadowColor="white",he.shadowBlur=2,he.lineWidth=1.5,he.strokeStyle="white",he.textBaseline="top",he.font="bold 36px Open Sans, sans-serif",he.fillText(ie,5,5),he.strokeText(ie,5,5),J.debugOverlayTexture.update(se),J.debugOverlayTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE)}(h,`${X} ${I}kB`);const Y=h.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});d.draw(a,c.TRIANGLES,g,y,hi.alphaBlended,Wt.disabled,ju(l.be.transparent,$),null,Y,C,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),d.draw(a,c.LINE_STRIP,g,y,x,Wt.disabled,ju(l.be.red),M,Y,C,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function qi(h,e,i,a){const{isRenderingGlobe:c}=a,d=h.context,g=d.gl,y=h.transform,x=h.colorModeForRenderPass(),C=h.getDepthModeFor3D(),M=h.useProgram("terrain");d.bindFramebuffer.set(null),d.viewport.set([0,0,h.width,h.height]);for(const A of i){const I=e.getTerrainMesh(A.tileID),L=h.renderToTexture.getTexture(A),$=e.getTerrainData(A.tileID);d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,L.texture);const X=e.getMeshFrameDelta(y.zoom),Y=y.calculateFogMatrix(A.tileID.toUnwrapped()),J=Md(X,Y,h.style.sky,y.pitch,c),ie=y.getProjectionData({overscaledTileID:A.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});M.draw(d,g.TRIANGLES,C,Ut.disabled,x,Wt.backCCW,J,$,ie,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}function Wr(h,e){if(!e.mesh){const i=new l.aK;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const a=new l.aM;a.emplaceBack(0,1,2),a.emplaceBack(0,2,3),e.mesh=new Ir(h.createVertexBuffer(i,Ar.members),h.createIndexBuffer(a),l.aL.simpleSegment(0,0,i.length,a.length))}return e.mesh}class ir{constructor(e,i){this.context=new ai(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=z.maxUnderzooming+z.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ss}resize(e,i,a){if(this.width=Math.floor(e*a),this.height=Math.floor(i*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,i=new l.aK;i.emplaceBack(0,0),i.emplaceBack(l.$,0),i.emplaceBack(0,l.$),i.emplaceBack(l.$,l.$),this.tileExtentBuffer=e.createVertexBuffer(i,Ar.members),this.tileExtentSegments=l.aL.simpleSegment(0,0,4,2);const a=new l.aK;a.emplaceBack(0,0),a.emplaceBack(l.$,0),a.emplaceBack(0,l.$),a.emplaceBack(l.$,l.$),this.debugBuffer=e.createVertexBuffer(a,Ar.members),this.debugSegments=l.aL.simpleSegment(0,0,4,5);const c=new l.c5;c.emplaceBack(0,0,0,0),c.emplaceBack(l.$,0,l.$,0),c.emplaceBack(0,l.$,0,l.$),c.emplaceBack(l.$,l.$,l.$,l.$),this.rasterBoundsBuffer=e.createVertexBuffer(c,Td.members),this.rasterBoundsSegments=l.aL.simpleSegment(0,0,4,2);const d=new l.aK;d.emplaceBack(0,0),d.emplaceBack(l.$,0),d.emplaceBack(0,l.$),d.emplaceBack(l.$,l.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(d,Ar.members),this.rasterBoundsSegmentsPosOnly=l.aL.simpleSegment(0,0,4,5);const g=new l.aK;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(g,Ar.members),this.viewportSegments=l.aL.simpleSegment(0,0,4,2);const y=new l.c6;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const x=new l.aM;x.emplaceBack(1,0,2),x.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(x);const C=this.context.gl;this.stencilClearMode=new Ut({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.tileExtentMesh=new Ir(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=l.L();l.bX(a,0,this.width,this.height,0,0,1),l.N(a,a,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const c={mainMatrix:a,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,Kt.disabled,this.stencilClearMode,hi.disabled,Wt.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const c=this.context;c.setColorMode(hi.disabled),c.setDepthMode(Kt.disabled);const d={};for(const g of i)d[g.key]=this.nextStencilID++;this._renderTileMasks(d,i,a,!0),this._renderTileMasks(d,i,a,!1),this._tileClippingMaskIDs=d}_renderTileMasks(e,i,a,c){const d=this.context,g=d.gl,y=this.style.projection,x=this.transform,C=this.useProgram("clippingMask");for(const M of i){const A=e[M.key],I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),L=y.getMeshFromTileID(this.context,M.canonical,c,!0,"stencil"),$=x.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!a,applyTerrainMatrix:!0});C.draw(d,g.TRIANGLES,Kt.disabled,new Ut({func:g.ALWAYS,mask:0},A,255,g.KEEP,g.KEEP,g.REPLACE),hi.disabled,a?Wt.disabled:Wt.backCCW,null,I,$,"$clipping",L.vertexBuffer,L.indexBuffer,L.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,a=this.style.projection,c=this.transform,d=this.useProgram("depth"),g=this.getDepthModeFor3D(),y=Te(c,{tileSize:c.tileSize});for(const x of y){const C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x),M=a.getMeshFromTileID(this.context,x.canonical,!0,!0,"raster"),A=c.getProjectionData({overscaledTileID:x,applyGlobeMatrix:!0,applyTerrainMatrix:!0});d.draw(e,i.TRIANGLES,g,Ut.disabled,hi.disabled,Wt.backCCW,null,C,A,"$clipping",M.vertexBuffer,M.indexBuffer,M.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new Ut({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new Ut({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,a=e.sort((g,y)=>y.overscaledZ-g.overscaledZ),c=a[a.length-1].overscaledZ,d=a[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const g={};for(let y=0;y<d;y++)g[y+c]=new Ut({func:i.GEQUAL,mask:255},y+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=d,[g,a]}return[{[c]:Ut.disabled},a]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,a=e.sort((g,y)=>y.overscaledZ-g.overscaledZ),c=a[a.length-1].overscaledZ,d=a[0].overscaledZ-c+1;if(this.clearStencil(),d>1){const g={},y={};for(let x=0;x<d;x++)g[x+c]=new Ut({func:i.GREATER,mask:255},d+1+x,255,i.KEEP,i.KEEP,i.REPLACE),y[x+c]=new Ut({func:i.GREATER,mask:255},1+x,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*d+1,[g,y,a]}return this.nextStencilID=3,[{[c]:new Ut({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[c]:new Ut({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new hi([e.CONSTANT_COLOR,e.ONE],new l.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hi.unblended:hi.alphaBlended}getDepthModeForSublayer(e,i,a){if(!this.opaquePassEnabledForLayer())return Kt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Kt(a||this.context.gl.LEQUAL,i,[c,c])}getDepthModeFor3D(){return new Kt(this.context.gl.LEQUAL,Kt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var a,c;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Ce.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,y={},x={},C={},M={isRenderingToTexture:!1,isRenderingGlobe:((a=e.projection)===null||a===void 0?void 0:a.transitionState)>0};for(const I in g){const L=g[I];L.used&&L.prepare(this.context),y[I]=L.getVisibleCoordinates(!1),x[I]=y[I].slice().reverse(),C[I]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<d.length;I++)if(this.style._layers[d[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of d){const L=this.style._layers[I];if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const $=x[L.source];(L.type==="custom"||$.length)&&this.renderLayer(this,g[L.source],L,$,M)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:I=>this.useProgram(I)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?l.be.black:l.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(I,L){const $=I.context,X=$.gl,Y=((me,oe,xe)=>{const Le=Math.cos(oe.rollInRadians),ke=Math.sin(oe.rollInRadians),Ie=q(oe),Re=oe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:me.properties.get("sky-color"),u_horizon_color:me.properties.get("horizon-color"),u_horizon:[(oe.width/2-Ie*ke)*xe,(oe.height/2+Ie*Le)*xe],u_horizon_normal:[-ke,Le],u_sky_horizon_blend:me.properties.get("sky-horizon-blend")*oe.height/2*xe,u_sky_blend:Re}})(L,I.style.map.transform,I.pixelRatio),J=new Kt(X.LEQUAL,Kt.ReadWrite,[0,1]),ie=Ut.disabled,se=I.colorModeForRenderPass(),re=I.useProgram("sky"),he=Wr($,L);re.draw($,X.TRIANGLES,J,ie,se,Wt.disabled,Y,null,void 0,"sky",he.vertexBuffer,he.indexBuffer,he.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[d[this.currentLayer]],L=g[I.source],$=y[I.source];this._renderTileClippingMasks(I,$,!1),this.renderLayer(this,L,I,$,M)}this.renderPass="translucent";let A=!1;for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const I=this.style._layers[d[this.currentLayer]],L=g[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I,M))continue;this.opaquePassEnabledForLayer()||A||(A=!0,M.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const $=(I.type==="symbol"?C:x)[I.source];this._renderTileClippingMasks(I,y[I.source],!!this.renderToTexture),this.renderLayer(this,L,I,$,M)}if(M.isRenderingGlobe&&function(I,L,$){const X=I.context,Y=X.gl,J=I.useProgram("atmosphere"),ie=new Kt(Y.LEQUAL,Kt.ReadOnly,[0,1]),se=I.transform,re=function(Re,ct){const lt=Re.properties.get("position"),Xe=[-lt.x,-lt.y,-lt.z],wt=l.af(new Float64Array(16));return Re.properties.get("anchor")==="map"&&(l.b5(wt,wt,ct.rollInRadians),l.b6(wt,wt,-ct.pitchInRadians),l.b5(wt,wt,ct.bearingInRadians),l.b6(wt,wt,ct.center.lat*Math.PI/180),l.by(wt,wt,-ct.center.lng*Math.PI/180)),l.c4(Xe,Xe,wt),Xe}($,I.transform),he=se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),me=L.properties.get("atmosphere-blend")*he.projectionTransition;if(me===0)return;const oe=Lo(se.worldSize,se.center.lat),xe=se.inverseProjectionMatrix,Le=new Float64Array(4);Le[3]=1,l.av(Le,Le,se.modelViewProjectionMatrix),Le[0]/=Le[3],Le[1]/=Le[3],Le[2]/=Le[3],Le[3]=1,l.av(Le,Le,xe),Le[0]/=Le[3],Le[1]/=Le[3],Le[2]/=Le[3],Le[3]=1;const ke=((Re,ct,lt,Xe,wt)=>({u_sun_pos:Re,u_atmosphere_blend:ct,u_globe_position:lt,u_globe_radius:Xe,u_inv_proj_matrix:wt}))(re,me,[Le[0],Le[1],Le[2]],oe,xe),Ie=Wr(X,L);J.draw(X,Y.TRIANGLES,ie,Ut.disabled,hi.alphaBlended,Wt.disabled,ke,null,null,"atmosphere",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const I=function(L,$){let X=null;const Y=Object.values(L._layers).flatMap(re=>re.source&&!re.isHidden($)?[L.sourceCaches[re.source]]:[]),J=Y.filter(re=>re.getSource().type==="vector"),ie=Y.filter(re=>re.getSource().type!=="vector"),se=re=>{(!X||X.getSource().maxzoom<re.getSource().maxzoom)&&(X=re)};return J.forEach(re=>se(re)),X||ie.forEach(re=>se(re)),X}(this.style,this.transform.zoom);I&&function(L,$,X){for(let Y=0;Y<X.length;Y++)lh(L,$,X[Y])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const L=I.transform.padding;Na(I,I.transform.height-(L.top||0),3,oh),Na(I,L.bottom||0,3,Us),qs(I,L.left||0,3,ac),qs(I,I.transform.width-(L.right||0),3,ah);const $=I.transform.centerPoint;(function(X,Y,J,ie){Gs(X,Y-1,J-10,2,20,ie),Gs(X,Y-10,J-1,20,2,ie)})(I,$.x,I.transform.height-$.y,sh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!l.c7(i,a):!l.c8(i,a)),c||(c=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(l.c9(i,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(d,g){const y=d.context,x=y.gl,C=d.transform,M=hi.unblended,A=new Kt(x.LEQUAL,Kt.ReadWrite,[0,1]),I=g.sourceCache.getRenderableTiles(),L=d.useProgram("terrainDepth");y.bindFramebuffer.set(g.getFramebuffer("depth").framebuffer),y.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),y.clear({color:l.be.transparent,depth:1});for(const $ of I){const X=g.getTerrainMesh($.tileID),Y=g.getTerrainData($.tileID),J=C.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ie={u_ele_delta:g.getMeshFrameDelta(C.zoom)};L.draw(y,x.TRIANGLES,A,Ut.disabled,M,Wt.backCCW,ie,Y,J,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain),function(d,g){const y=d.context,x=y.gl,C=d.transform,M=hi.unblended,A=new Kt(x.LEQUAL,Kt.ReadWrite,[0,1]),I=g.getCoordsTexture(),L=g.sourceCache.getRenderableTiles(),$=d.useProgram("terrainCoords");y.bindFramebuffer.set(g.getFramebuffer("coords").framebuffer),y.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),y.clear({color:l.be.transparent,depth:1}),g.coordsIndex=[];for(const X of L){const Y=g.getTerrainMesh(X.tileID),J=g.getTerrainData(X.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,I.texture);const ie={u_terrain_coords_id:(255-g.coordsIndex.length)/255,u_texture:0,u_ele_delta:g.getMeshFrameDelta(C.zoom)},se=C.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});$.draw(y,x.TRIANGLES,A,Ut.disabled,M,Wt.backCCW,ie,J,se,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),g.coordsIndex.push(X.tileID.key)}y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain))}renderLayer(e,i,a,c,d){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(c||[]).length)&&(this.id=a.id,l.ca(a)?function(g,y,x,C,M,A){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:I}=A,L=Ut.disabled,$=g.colorModeForRenderPass();(x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(X,Y,J,ie,se,re,he,me,oe){const xe=Y.transform,Le=Y.style.map.terrain,ke=se==="map",Ie=re==="map";for(const Re of X){const ct=ie.getTile(Re),lt=ct.getBucket(J);if(!lt||!lt.text||!lt.text.segments.get().length)continue;const Xe=l.am(lt.textSizeData,xe.zoom),wt=l.aB(ct,1,Y.transform.zoom),Jt=Be(ke,Y.transform,wt),vi=J.layout.get("icon-text-fit")!=="none"&&lt.hasIconData();if(Xe){const ji=Math.pow(2,xe.zoom-ct.tileID.overscaledZ),xi=Le?(Ni,Mi)=>Le.getElevation(Re,Ni,Mi):null;Nd(lt,ke,Ie,oe,xe,Jt,ji,Xe,vi,l.aC(xe,ct,he,me),Re.toUnwrapped(),xi)}}}(C,g,x,y,x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),M),x.paint.get("icon-opacity").constantOr(1)!==0&&rh(g,y,x,C,!1,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),x.layout.get("icon-rotation-alignment"),x.layout.get("icon-pitch-alignment"),x.layout.get("icon-keep-upright"),L,$,I),x.paint.get("text-opacity").constantOr(1)!==0&&rh(g,y,x,C,!0,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.layout.get("text-keep-upright"),L,$,I),y.map.showCollisionBoxes&&(th(g,y,x,C,!0),th(g,y,x,C,!1))}(e,i,a,c,this.style.placement.variableOffsets,d):l.cb(a)?function(g,y,x,C,M){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:A}=M,I=x.paint.get("circle-opacity"),L=x.paint.get("circle-stroke-width"),$=x.paint.get("circle-stroke-opacity"),X=!x.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(L.constantOr(1)===0||$.constantOr(1)===0))return;const Y=g.context,J=Y.gl,ie=g.transform,se=g.getDepthModeForSublayer(0,Kt.ReadOnly),re=Ut.disabled,he=g.colorModeForRenderPass(),me=[],oe=ie.getCircleRadiusCorrection();for(let xe=0;xe<C.length;xe++){const Le=C[xe],ke=y.getTile(Le),Ie=ke.getBucket(x);if(!Ie)continue;const Re=x.paint.get("circle-translate"),ct=x.paint.get("circle-translate-anchor"),lt=l.aC(ie,ke,Re,ct),Xe=Ie.programConfigurations.get(x.id),wt=g.useProgram("circle",Xe),Jt=Ie.layoutVertexBuffer,vi=Ie.indexBuffer,ji=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Le),xi={programConfiguration:Xe,program:wt,layoutVertexBuffer:Jt,indexBuffer:vi,uniformValues:Ul(g,ke,x,lt,oe),terrainData:ji,projectionData:ie.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!A,applyTerrainMatrix:!0})};if(X){const Ni=Ie.segments.get();for(const Mi of Ni)me.push({segments:new l.aL([Mi]),sortKey:Mi.sortKey,state:xi})}else me.push({segments:Ie.segments,sortKey:0,state:xi})}X&&me.sort((xe,Le)=>xe.sortKey-Le.sortKey);for(const xe of me){const{programConfiguration:Le,program:ke,layoutVertexBuffer:Ie,indexBuffer:Re,uniformValues:ct,terrainData:lt,projectionData:Xe}=xe.state;ke.draw(Y,J.TRIANGLES,se,re,he,Wt.backCCW,ct,lt,Xe,x.id,Ie,Re,xe.segments,x.paint,g.transform.zoom,Le)}}(e,i,a,c,d):l.cc(a)?function(g,y,x,C,M){if(x.paint.get("heatmap-opacity")===0)return;const A=g.context,{isRenderingToTexture:I,isRenderingGlobe:L}=M;if(g.style.map.terrain){for(const $ of C){const X=y.getTile($);y.hasRenderableParent($)||(g.renderPass==="offscreen"?Ns(g,X,x,$,L):g.renderPass==="translucent"&&$s(g,x,$,I,L))}A.viewport.set([0,0,g.width,g.height])}else g.renderPass==="offscreen"?function($,X,Y,J){const ie=$.context,se=ie.gl,re=$.transform,he=Ut.disabled,me=new hi([se.ONE,se.ONE],l.be.transparent,[!0,!0,!0,!0]);(function(oe,xe,Le){const ke=oe.gl;oe.activeTexture.set(ke.TEXTURE1),oe.viewport.set([0,0,xe.width/4,xe.height/4]);let Ie=Le.heatmapFbos.get(l.c1);Ie?(ke.bindTexture(ke.TEXTURE_2D,Ie.colorAttachment.get()),oe.bindFramebuffer.set(Ie.framebuffer)):(Ie=Fa(oe,xe.width/4,xe.height/4),Le.heatmapFbos.set(l.c1,Ie))})(ie,$,Y),ie.clear({color:l.be.transparent});for(let oe=0;oe<J.length;oe++){const xe=J[oe];if(X.hasRenderableParent(xe))continue;const Le=X.getTile(xe),ke=Le.getBucket(Y);if(!ke)continue;const Ie=ke.programConfigurations.get(Y.id),Re=$.useProgram("heatmap",Ie),ct=re.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),lt=re.getCircleRadiusCorrection();Re.draw(ie,se.TRIANGLES,Kt.disabled,he,me,Wt.backCCW,Da(Le,re.zoom,Y.paint.get("heatmap-intensity"),lt),null,ct,Y.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,Y.paint,re.zoom,Ie)}ie.viewport.set([0,0,$.width,$.height])}(g,y,x,C):g.renderPass==="translucent"&&function($,X){const Y=$.context,J=Y.gl;Y.setColorMode($.colorModeForRenderPass());const ie=X.heatmapFbos.get(l.c1);ie&&(Y.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,ie.colorAttachment.get()),Y.activeTexture.set(J.TEXTURE1),Vs(Y,X).bind(J.LINEAR,J.CLAMP_TO_EDGE),$.useProgram("heatmapTexture").draw(Y,J.TRIANGLES,Kt.disabled,Ut.disabled,$.colorModeForRenderPass(),Wt.disabled,Nu($,X,0,1),null,null,X.id,$.viewportBuffer,$.quadTriangleIndexBuffer,$.viewportSegments,X.paint,$.transform.zoom))}(g,x)}(e,i,a,c,d):l.cd(a)?function(g,y,x,C,M){if(g.renderPass!=="translucent")return;const{isRenderingToTexture:A}=M,I=x.paint.get("line-opacity"),L=x.paint.get("line-width");if(I.constantOr(1)===0||L.constantOr(1)===0)return;const $=g.getDepthModeForSublayer(0,Kt.ReadOnly),X=g.colorModeForRenderPass(),Y=x.paint.get("line-dasharray"),J=x.paint.get("line-pattern"),ie=J.constantOr(1),se=x.paint.get("line-gradient"),re=x.getCrossfadeParameters(),he=ie?"linePattern":Y?"lineSDF":se?"lineGradient":"line",me=g.context,oe=me.gl,xe=g.transform;let Le=!0;for(const ke of C){const Ie=y.getTile(ke);if(ie&&!Ie.patternsLoaded())continue;const Re=Ie.getBucket(x);if(!Re)continue;const ct=Re.programConfigurations.get(x.id),lt=g.context.program.get(),Xe=g.useProgram(he,ct),wt=Le||Xe.program!==lt,Jt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ke),vi=J.constantOr(null);if(vi&&Ie.imageAtlas){const wi=Ie.imageAtlas,ki=wi.patternPositions[vi.to.toString()],wn=wi.patternPositions[vi.from.toString()];ki&&wn&&ct.setConstantPatternPositions(ki,wn)}const ji=xe.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),xi=xe.getPixelScale(),Ni=ie?Vu(g,Ie,x,xi,re):Y?Uu(g,Ie,x,xi,Y,re):se?ql(g,Ie,x,xi,Re.lineClipsArray.length):As(g,Ie,x,xi);if(ie)me.activeTexture.set(oe.TEXTURE0),Ie.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),ct.updatePaintBuffers(re);else if(Y&&(wt||g.lineAtlas.dirty))me.activeTexture.set(oe.TEXTURE0),g.lineAtlas.bind(me);else if(se){const wi=Re.gradients[x.id];let ki=wi.texture;if(x.gradientVersion!==wi.version){let wn=256;if(x.stepInterpolant){const di=y.getSource().maxzoom,fn=ke.canonical.z===di?Math.ceil(1<<g.transform.maxZoom-ke.canonical.z):1;wn=l.ag(l.c2(Re.maxLineLength/l.$*1024*fn),256,me.maxTextureSize)}wi.gradient=l.c3({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:wn,image:wi.gradient||void 0,clips:Re.lineClipsArray}),wi.texture?wi.texture.update(wi.gradient):wi.texture=new l.T(me,wi.gradient,oe.RGBA),wi.version=x.gradientVersion,ki=wi.texture}me.activeTexture.set(oe.TEXTURE0),ki.bind(x.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}const Mi=g.stencilModeForClipping(ke);Xe.draw(me,oe.TRIANGLES,$,Mi,X,Wt.disabled,Ni,Jt,ji,x.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,x.paint,g.transform.zoom,ct,Re.layoutVertexBuffer2),Le=!1}}(e,i,a,c,d):l.ce(a)?function(g,y,x,C,M){const A=x.paint.get("fill-color"),I=x.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const{isRenderingToTexture:L}=M,$=g.colorModeForRenderPass(),X=x.paint.get("fill-pattern"),Y=g.opaquePassEnabledForLayer()&&!X.constantOr(1)&&A.constantOr(l.be.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===Y){const J=g.getDepthModeForSublayer(1,g.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly);Ba(g,y,x,C,J,$,!1,L)}if(g.renderPass==="translucent"&&x.paint.get("fill-antialias")){const J=g.getDepthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly);Ba(g,y,x,C,J,$,!0,L)}}(e,i,a,c,d):l.cf(a)?function(g,y,x,C,M){const A=x.paint.get("fill-extrusion-opacity");if(A===0)return;const{isRenderingToTexture:I}=M;if(g.renderPass==="translucent"){const L=new Kt(g.context.gl.LEQUAL,Kt.ReadWrite,g.depthRangeFor3D);if(A!==1||x.paint.get("fill-extrusion-pattern").constantOr(1))Zo(g,y,x,C,L,Ut.disabled,hi.disabled,I),Zo(g,y,x,C,L,g.stencilModeFor3D(),g.colorModeForRenderPass(),I);else{const $=g.colorModeForRenderPass();Zo(g,y,x,C,L,Ut.disabled,$,I)}}}(e,i,a,c,d):l.cg(a)?function(g,y,x,C,M){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const{isRenderingToTexture:A}=M,I=g.context,L=g.style.projection.useSubdivision,$=g.getDepthModeForSublayer(0,Kt.ReadOnly),X=g.colorModeForRenderPass();if(g.renderPass==="offscreen")(function(Y,J,ie,se,re,he,me){const oe=Y.context,xe=oe.gl;for(const Le of ie){const ke=J.getTile(Le),Ie=ke.dem;if(!Ie||!Ie.data||!ke.needsHillshadePrepare)continue;const Re=Ie.dim,ct=Ie.stride,lt=Ie.getPixels();if(oe.activeTexture.set(xe.TEXTURE1),oe.pixelStoreUnpackPremultiplyAlpha.set(!1),ke.demTexture=ke.demTexture||Y.getTileTexture(ct),ke.demTexture){const wt=ke.demTexture;wt.update(lt,{premultiply:!1}),wt.bind(xe.NEAREST,xe.CLAMP_TO_EDGE)}else ke.demTexture=new l.T(oe,lt,xe.RGBA,{premultiply:!1}),ke.demTexture.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);oe.activeTexture.set(xe.TEXTURE0);let Xe=ke.fbo;if(!Xe){const wt=new l.T(oe,{width:Re,height:Re,data:null},xe.RGBA);wt.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Xe=ke.fbo=oe.createFramebuffer(Re,Re,!0,!1),Xe.colorAttachment.set(wt.texture)}oe.bindFramebuffer.set(Xe.framebuffer),oe.viewport.set([0,0,Re,Re]),Y.useProgram("hillshadePrepare").draw(oe,xe.TRIANGLES,re,he,me,Wt.disabled,Id(ke.tileID,Ie),null,null,se.id,Y.rasterBoundsBuffer,Y.quadTriangleIndexBuffer,Y.rasterBoundsSegments),ke.needsHillshadePrepare=!1}})(g,y,C,x,$,Ut.disabled,X),I.viewport.set([0,0,g.width,g.height]);else if(g.renderPass==="translucent")if(L){const[Y,J,ie]=g.stencilConfigForOverlapTwoPass(C);Ho(g,y,x,ie,Y,$,X,!1,A),Ho(g,y,x,ie,J,$,X,!0,A)}else{const[Y,J]=g.getStencilConfigForOverlapAndUpdateStencilID(C);Ho(g,y,x,J,Y,$,X,!1,A)}}(e,i,a,c,d):l.ch(a)?function(g,y,x,C,M){if(g.renderPass!=="translucent"||!C.length)return;const{isRenderingToTexture:A}=M,I=g.style.projection.useSubdivision,L=g.getDepthModeForSublayer(0,Kt.ReadOnly),$=g.colorModeForRenderPass();if(I){const[X,Y,J]=g.stencilConfigForOverlapTwoPass(C);ja(g,y,x,J,X,L,$,!1,A),ja(g,y,x,J,Y,L,$,!0,A)}else{const[X,Y]=g.getStencilConfigForOverlapAndUpdateStencilID(C);ja(g,y,x,Y,X,L,$,!1,A)}}(e,i,a,c,d):l.ci(a)?function(g,y,x,C,M){if(g.renderPass!=="translucent"||x.paint.get("raster-opacity")===0||!C.length)return;const{isRenderingToTexture:A}=M,I=y.getSource(),L=g.style.projection.useSubdivision;if(I instanceof $t)Hr(g,y,x,C,null,!1,!1,I.tileCoords,I.flippedWindingOrder,A);else if(L){const[$,X,Y]=g.stencilConfigForOverlapTwoPass(C);Hr(g,y,x,Y,$,!1,!0,oc,!1,A),Hr(g,y,x,Y,X,!0,!0,oc,!1,A)}else{const[$,X]=g.getStencilConfigForOverlapAndUpdateStencilID(C);Hr(g,y,x,X,$,!1,!0,oc,!1,A)}}(e,i,a,c,d):l.cj(a)?function(g,y,x,C,M){const A=x.paint.get("background-color"),I=x.paint.get("background-opacity");if(I===0)return;const{isRenderingToTexture:L}=M,$=g.context,X=$.gl,Y=g.style.projection,J=g.transform,ie=J.tileSize,se=x.paint.get("background-pattern");if(g.isPatternMissing(se))return;const re=!se&&A.a===1&&I===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==re)return;const he=Ut.disabled,me=g.getDepthModeForSublayer(0,re==="opaque"?Kt.ReadWrite:Kt.ReadOnly),oe=g.colorModeForRenderPass(),xe=g.useProgram(se?"backgroundPattern":"background"),Le=C||Te(J,{tileSize:ie,terrain:g.style.map.terrain});se&&($.activeTexture.set(X.TEXTURE0),g.imageManager.bind(g.context));const ke=x.getCrossfadeParameters();for(const Ie of Le){const Re=J.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),ct=se?Dd(I,g,se,{tileID:Ie,tileSize:ie},ke):zs(I,A),lt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ie),Xe=Y.getMeshFromTileID($,Ie.canonical,!1,!0,"raster");xe.draw($,X.TRIANGLES,me,he,oe,Wt.backCCW,ct,lt,Re,x.id,Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)}}(e,0,a,c,d):l.ck(a)&&function(g,y,x,C){const{isRenderingGlobe:M}=C,A=g.context,I=x.implementation,L=g.style.projection,$=g.transform,X=$.getProjectionDataForCustomLayer(M),Y={farZ:$.farZ,nearZ:$.nearZ,fov:$.fov*Math.PI/180,modelViewProjectionMatrix:$.modelViewProjectionMatrix,projectionMatrix:$.projectionMatrix,shaderData:{variantName:L.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${L.shaderPreludeCode.vertexSource}`,define:L.shaderDefine},defaultProjectionData:X},J=I.renderingMode?I.renderingMode:"2d";if(g.renderPass==="offscreen"){const ie=I.prerender;ie&&(g.setCustomLayerDefaults(),A.setColorMode(g.colorModeForRenderPass()),ie.call(I,A.gl,Y),A.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),A.setColorMode(g.colorModeForRenderPass()),A.setStencilMode(Ut.disabled);const ie=J==="3d"?g.getDepthModeFor3D():g.getDepthModeForSublayer(0,Kt.ReadOnly);A.setDepthMode(ie),I.render(A.gl,Y),A.setDirty(),g.setBaseState(),A.bindFramebuffer.set(null)}}(e,0,a,d))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!i||!a}useProgram(e,i,a=!1,c=[]){this.cache=this.cache||{};const d=!!this.style.map.terrain,g=this.style.projection,y=a?_r.projectionMercator:g.shaderPreludeCode,x=a?uo:g.shaderDefine,C=e+(i?i.cacheKey:"")+`/${a?Rl:g.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(d?"/terrain":"")+(c?`/${c.join("/")}`:"");return this.cache[C]||(this.cache[C]=new ks(this.context,_r[e],i,Zu[e],this._showOverdrawInspector,d,y,x,c)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function Zs(h,e){let i,a=!1,c=null,d=null;const g=()=>{c=null,a&&(h.apply(d,i),c=setTimeout(g,e),a=!1)};return(...y)=>(a=!0,d=this,i=y,c||g(),c)}class $a{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(a=c)}),(a&&a[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:a,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const a=i.join("/");let c=a;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${a}`);let d=window.location.hash.replace(c,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let g=window.location.href.replace(/(#.+)?$/,d);g=g.replace("&&","&"),window.history.replaceState(window.history.state,null,g)},this._updateHash=Zs(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,c=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),g=Math.round(i.lng*d)/d,y=Math.round(i.lat*d)/d,x=this._map.getBearing(),C=this._map.getPitch();let M="";if(M+=e?`/${g}/${y}/${a}`:`${a}/${y}/${g}`,(x||C)&&(M+="/"+Math.round(10*x)/10),C&&(M+=`/${Math.round(C)}`),this._hashName){const A=this._hashName;let I=!1;const L=window.location.hash.slice(1).split("&").map($=>{const X=$.split("=")[0];return X===A?(I=!0,`${X}=${M}`):$}).filter($=>$);return I||L.push(`${A}=${M}`),`#${L.join("&")}`}return`#${M}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new l.S(+e[2],+e[1])}catch{return!1}const i=+e[0],a=+(e[3]||0),c=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&a>=-180&&a<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}const Wo={linearity:.3,easing:l.cl(0,0,.3,1)},Yo=l.e({deceleration:2500,maxSpeed:1400},Wo),sc=l.e({deceleration:20,maxSpeed:1400},Wo),Va=l.e({deceleration:1e3,maxSpeed:360},Wo),lc=l.e({deceleration:1e3,maxSpeed:90},Wo),ch=l.e({deceleration:1e3,maxSpeed:360},Wo);class uh{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ce.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=Ce.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)i.zoom+=d.zoomDelta||0,i.bearing+=d.bearingDelta||0,i.pitch+=d.pitchDelta||0,i.roll+=d.rollDelta||0,d.panDelta&&i.pan._add(d.panDelta),d.around&&(i.around=d.around),d.pinchAround&&(i.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(i.pan.mag()){const d=Ko(i.pan.mag(),a,l.e({},Yo,e||{})),g=i.pan.mult(d.amount/i.pan.mag()),y=this._map.cameraHelper.handlePanInertia(g,this._map.transform);c.center=y.easingCenter,c.offset=y.easingOffset,Xo(c,d)}if(i.zoom){const d=Ko(i.zoom,a,sc);c.zoom=this._map.transform.zoom+d.amount,Xo(c,d)}if(i.bearing){const d=Ko(i.bearing,a,Va);c.bearing=this._map.transform.bearing+l.ag(d.amount,-179,179),Xo(c,d)}if(i.pitch){const d=Ko(i.pitch,a,lc);c.pitch=this._map.transform.pitch+d.amount,Xo(c,d)}if(i.roll){const d=Ko(i.roll,a,ch);c.roll=this._map.transform.roll+l.ag(d.amount,-179,179),Xo(c,d)}if(c.zoom||c.bearing){const d=i.pinchAround===void 0?i.around:i.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),l.e(c,{noMoveStart:!0})}}function Xo(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function Ko(h,e,i){const{maxSpeed:a,linearity:c,deceleration:d}=i,g=l.ag(h*c/(e/1e3),-a,a),y=Math.abs(g)/(d*c);return{easing:i.easing,duration:1e3*y,amount:g*(y/2)}}class qn extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a,c={}){a=a instanceof MouseEvent?a:new MouseEvent(e,a);const d=N.mousePos(i.getCanvas(),a),g=i.unproject(d);super(e,l.e({point:d,lngLat:g,originalEvent:a},c)),this._defaultPrevented=!1,this.target=i}}class lr extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a){const c=e==="touchend"?a.changedTouches:a.touches,d=N.touchPos(i.getCanvasContainer(),c),g=d.map(x=>i.unproject(x)),y=d.reduce((x,C,M,A)=>x.add(C.div(A.length)),new l.P(0,0));super(e,{points:d,point:y,lngLats:g,lngLat:i.unproject(y),originalEvent:a}),this._defaultPrevented=!1}}class cc extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class hh{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new cc(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new qn(e.type,this._map,e))}mouseup(e){this._map.fire(new qn(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new qn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new qn(e.type,this._map,e))}mouseover(e){this._map.fire(new qn(e.type,this._map,e))}mouseout(e){this._map.fire(new qn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new lr(e.type,this._map,e))}touchmove(e){this._map.fire(new lr(e.type,this._map,e))}touchend(e){this._map.fire(new lr(e.type,this._map,e))}touchcancel(e){this._map.fire(new lr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dh{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new qn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new qn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(l.P.convert(e),this._map.terrain)}}class uc{constructor(e,i){this._map=e,this._tr=new Jo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(N.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const a=i;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=a,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(c.x,a.x),g=Math.max(c.x,a.x),y=Math.min(c.y,a.y),x=Math.max(c.y,a.y);N.setTransform(this._box,`translate(${d}px,${y}px)`),this._box.style.width=g-d+"px",this._box.style.height=x-y+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const a=this._startPos,c=i;if(this.reset(),N.suppressClick(),a.x!==c.x||a.y!==c.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(a,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new l.l(e,{originalEvent:i}))}}function Hs(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);const i={};for(let a=0;a<h.length;a++)i[h[a].identifier]=e[a];return i}class ph{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(c){const d=new l.P(0,0);for(const g of c)d._add(g);return d.div(c.length)}(i),this.touches=Hs(a,i)))}touchmove(e,i,a){if(this.aborted||!this.centroid)return;const c=Hs(a,i);for(const d in this.touches){const g=c[d];(!g||g.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,i,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class Ws{constructor(e){this.singleTap=new ph(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,a){this.singleTap.touchstart(e,i,a)}touchmove(e,i,a){this.singleTap.touchmove(e,i,a)}touchend(e,i,a){const c=this.singleTap.touchend(e,i,a);if(c){const d=e.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(c)<30;if(d&&g||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class Ys{constructor(e){this._tr=new Jo(e),this._zoomIn=new Ws({numTouches:1,numTaps:2}),this._zoomOut=new Ws({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,a){this._zoomIn.touchstart(e,i,a),this._zoomOut.touchstart(e,i,a)}touchmove(e,i,a){this._zoomIn.touchmove(e,i,a),this._zoomOut.touchmove(e,i,a)}touchend(e,i,a){const c=this._zoomIn.touchend(e,i,a),d=this._zoomOut.touchend(e,i,a),g=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:g.zoom+1,around:g.unproject(c)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:g.zoom-1,around:g.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qo{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=Array.isArray(i)?i[0]:i;return!this._moved&&c.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(a,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&N.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const nr=0,cr=2,fh={[nr]:1,[cr]:2};class Fn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=N.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,a){const c=fh[a];return i.buttons===void 0||(i.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return N.mouseButton(e)===this._eventButton}}class ea{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Vd{constructor(e=new Fn({checkCorrectEvent:()=>!0}),i=new ea){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,a){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?a(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const Xs=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}};class Ud{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,a){return this._calculateTransform(e,i,a)}touchmove(e,i,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,i,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,a){this._calculateTransform(e,i,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,a){a.length>0&&(this._active=!0);const c=Hs(a,i),d=new l.P(0,0),g=new l.P(0,0);let y=0;for(const C in c){const M=c[C],A=this._touches[C];A&&(d._add(M),g._add(M.sub(A)),y++,c[C]=M)}if(this._touches=c,this._shouldBePrevented(y)||!g.mag())return;const x=g.div(y);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(y),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,a){if(!this._firstTwoTouches)return;e.preventDefault();const[c,d]=this._firstTwoTouches,g=Ua(a,i,c),y=Ua(a,i,d);if(!g||!y)return;const x=this._aroundCenter?null:g.add(y).div(2);return this._move([g,y],x,e)}touchend(e,i,a){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,g=Ua(a,i,c),y=Ua(a,i,d);g&&y||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ua(h,e,i){for(let a=0;a<h.length;a++)if(h[a].identifier===i)return e[a]}function ta(h,e){return Math.log(h/e)/Math.LN2}class br extends hc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ta(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ta(this._distance,a),pinchAround:i}}}function _t(h,e){return 180*h.angleWith(e)/Math.PI}class dc extends hc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,a){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_t(this._vector,c),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,a=_t(e,this._startVector);return Math.abs(a)<i}}function qa(h){return Math.abs(h.y)>Math.abs(h.x)}class pc extends hc{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,a){super.touchstart(e,i,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,qa(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,a){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,d=i.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const g=e.y>0==i.y>0;return qa(e)&&qa(i)&&g}}const Ga={panStep:100,bearingStep:15,pitchStep:10};class ia{constructor(e){this._tr=new Jo(e);const i=Ga;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,a=0,c=0,d=0,g=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),g=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(a=0,c=0),{cameraAnimation:y=>{const x=this._tr;y.easeTo({duration:300,easeId:"keyboardHandler",easing:fc,zoom:i?Math.round(x.zoom)+i*(e.shiftKey?2:1):x.zoom,bearing:x.bearing+a*this._bearingStep,pitch:x.pitch+c*this._pitchStep,offset:[-d*this._panStep,-g*this._panStep],center:x.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function fc(h){return h*(2-h)}const si=4.000244140625,mc=1/450;class mh{constructor(e,i){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new Jo(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=mc}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=Ce.now(),c=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,i!==0&&i%si==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=N.mousePos(this._map.getCanvas(),e),a=this._tr;this._aroundPoint=this._aroundCenter?a.transform.locationToScreenPoint(l.S.convert(a.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const y=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=y),typeof this._targetZoom=="number"&&(this._targetZoom+=y)}if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>si?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&x!==0&&(x=1/x);const C=typeof this._targetZoom!="number"?e.scale:l.ae(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),l.aj(C*x)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,a=this._startZoom,c=this._easing;let d,g=!1;if(this._type==="wheel"&&a&&c){const y=Ce.now()-this._lastWheelEventTime,x=Math.min((y+5)/200,1),C=c(x);d=l.C.number(a,i,C),x<1?this._frameId||(this._frameId=!0):g=!0}else d=i,g=!0;return this._active=!0,g&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=d,{noInertia:!0,needsRenderFrame:!g,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=l.cn;if(this._prevEase){const a=this._prevEase,c=(Ce.now()-a.start)/a.duration,d=a.easing(c+.01)-a.easing(c),g=.27/Math.sqrt(d*d+1e-4)*.01,y=Math.sqrt(.0729-g*g);i=l.cl(g,y,.25,1)}return this._prevEase={start:Ce.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ks{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qd{constructor(e){this._tr=new Jo(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gd{constructor(){this._tap=new Ws({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,a){if(!this._swipePoint)if(this._tapTime){const c=i[0],d=e.timeStamp-this._tapTime<500,g=this._tapPoint.dist(c)<30;d&&g?a.length>0&&(this._swipePoint=c,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,i,a)}touchmove(e,i,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const c=i[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,i,a)}touchend(e,i,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const c=this._tap.touchend(e,i,a);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gc{constructor(e,i,a){this._el=e,this._mousePan=i,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Js{constructor(e,i,a,c){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=a,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class _c{constructor(e,i,a,c){this._el=e,this._touchZoom=i,this._touchRotate=a,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class gh{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=i,this._container.appendChild(c);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=a,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Za=h=>h.zoom||h.drag||h.roll||h.pitch||h.rotate;class Zd extends l.l{}function yc(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta||h.rollDelta}class Yr{constructor(e,i){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,d)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const g=c.type==="renderFrame"?void 0:c,y={needsRenderFrame:!1},x={},C={};for(const{handlerName:I,handler:L,allowed:$}of this._handlers){if(!L.isEnabled())continue;let X;if(this._blockedByActive(C,$,I))L.reset();else if(L[d||c.type]){if(l.co(c,d||c.type)){const Y=N.mousePos(this._map.getCanvas(),c);X=L[d||c.type](c,Y)}else if(l.cp(c,d||c.type)){const Y=this._getMapTouches(c.touches),J=N.touchPos(this._map.getCanvas(),Y);X=L[d||c.type](c,J,Y)}else l.cq(d||c.type)||(X=L[d||c.type](c));this.mergeHandlerResult(y,x,X,I,g),X&&X.needsRenderFrame&&this._triggerRenderFrame()}(X||L.isActive())&&(C[I]=L)}const M={};for(const I in this._previousActiveHandlers)C[I]||(M[I]=g);this._previousActiveHandlers=C,(Object.keys(M).length||yc(y))&&(this._changes.push([y,x,M]),this._triggerRenderFrame()),(Object.keys(C).length||yc(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:A}=y;A&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],A(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new uh(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,g]of this._listeners)N.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[e,i,a]of this._listeners)N.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const i=this._map,a=i.getCanvasContainer();this._add("mapEvent",new hh(i,e));const c=i.boxZoom=new uc(i,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const d=i.cooperativeGestures=new gh(i,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const g=new Ys(i),y=new qd(i);i.doubleClickZoom=new Ks(y,g),this._add("tapZoom",g),this._add("clickZoom",y),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const x=new Gd;this._add("tapDragZoom",x);const C=i.touchPitch=new pc(i);this._add("touchPitch",C),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const M=()=>i.project(i.getCenter()),A=function({enable:re,clickTolerance:he,aroundCenter:me=!0,minPixelCenterThreshold:oe=100,rotateDegreesPerPixelMoved:xe=.8},Le){const ke=new Fn({checkCorrectEvent:Ie=>N.mouseButton(Ie)===0&&Ie.ctrlKey||N.mouseButton(Ie)===2&&!Ie.ctrlKey});return new Qo({clickTolerance:he,move:(Ie,Re)=>{const ct=Le();if(me&&Math.abs(ct.y-Ie.y)>oe)return{bearingDelta:l.cm(new l.P(Ie.x,Re.y),Re,ct)};let lt=(Re.x-Ie.x)*xe;return me&&Re.y<ct.y&&(lt=-lt),{bearingDelta:lt}},moveStateManager:ke,enable:re,assignEvents:Xs})}(e,M),I=function({enable:re,clickTolerance:he,pitchDegreesPerPixelMoved:me=-.5}){const oe=new Fn({checkCorrectEvent:xe=>N.mouseButton(xe)===0&&xe.ctrlKey||N.mouseButton(xe)===2});return new Qo({clickTolerance:he,move:(xe,Le)=>({pitchDelta:(Le.y-xe.y)*me}),moveStateManager:oe,enable:re,assignEvents:Xs})}(e),L=function({enable:re,clickTolerance:he,rollDegreesPerPixelMoved:me=.3},oe){const xe=new Fn({checkCorrectEvent:Le=>N.mouseButton(Le)===2&&Le.ctrlKey});return new Qo({clickTolerance:he,move:(Le,ke)=>{const Ie=oe();let Re=(ke.x-Le.x)*me;return ke.y<Ie.y&&(Re=-Re),{rollDelta:Re}},moveStateManager:xe,enable:re,assignEvents:Xs})}(e,M);i.dragRotate=new Js(e,A,I,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",I,["mouseRotate","mouseRoll"]),this._add("mouseRoll",L,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const $=function({enable:re,clickTolerance:he}){const me=new Fn({checkCorrectEvent:oe=>N.mouseButton(oe)===0&&!oe.ctrlKey});return new Qo({clickTolerance:he,move:(oe,xe)=>({around:xe,panDelta:xe.sub(oe)}),activateOnStart:!0,moveStateManager:me,enable:re,assignEvents:Xs})}(e),X=new Ud(e,i);i.dragPan=new gc(a,$,X),this._add("mousePan",$),this._add("touchPan",X,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const Y=new dc,J=new br;i.touchZoomRotate=new _c(a,J,Y,x),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const ie=i.scrollZoom=new mh(i,()=>this._triggerRenderFrame());this._add("scrollZoom",ie,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const se=i.keyboard=new ia(i);this._add("keyboard",se),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new dh(i))}_add(e,i,a){this._handlers.push({handlerName:e,handler:i,allowed:a}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Za(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,a){for(const c in e)if(c!==a&&(!i||i.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const a of e)this._el.contains(a.target)&&i.push(a);return i}mergeHandlerResult(e,i,a,c,d){if(!a)return;l.e(e,a);const g={handlerName:c,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(i.zoom=g),a.panDelta!==void 0&&(i.drag=g),a.rollDelta!==void 0&&(i.roll=g),a.pitchDelta!==void 0&&(i.pitch=g),a.bearingDelta!==void 0&&(i.rotate=g)}_applyChanges(){const e={},i={},a={};for(const[c,d,g]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(e.rollDelta=(e.rollDelta||0)+c.rollDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),l.e(i,d),l.e(a,g);this._updateMapTransform(e,i,a),this._changes=[]}_updateMapTransform(e,i,a){const c=this._map,d=c._getTransformForUpdate(),g=c.terrain;if(!(yc(e)||g&&this._terrainMovement))return this._fireEvents(i,a,!0);c._stop(!0);let{panDelta:y,zoomDelta:x,bearingDelta:C,pitchDelta:M,rollDelta:A,around:I,pinchAround:L}=e;L!==void 0&&(I=L),I=I||c.transform.centerPoint,g&&!d.isPointOnMapSurface(I)&&(I=d.centerPoint);const $={panDelta:y,zoomDelta:x,rollDelta:A,pitchDelta:M,bearingDelta:C,around:I};this._map.cameraHelper.useGlobeControls&&!d.isPointOnMapSurface(I)&&(I=d.centerPoint);const X=I.distSqr(d.centerPoint)<.01?d.center:d.screenPointToLocation(y?I.sub(y):I);g?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom($,d),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?d.setCenter(d.screenPointToLocation(d.centerPoint.sub(y))):this._map.cameraHelper.handleMapControlsPan($,d,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan($,d,X))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom($,d),this._map.cameraHelper.handleMapControlsPan($,d,X)),c._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,a,!0)}_fireEvents(e,i,a){const c=Za(this._eventsInProgress),d=Za(e),g={};for(const A in e){const{originalEvent:I}=e[A];this._eventsInProgress[A]||(g[`${A}start`]=I),this._eventsInProgress[A]=e[A]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const A in g)this._fireEvent(A,g[A]);d&&this._fireEvent("move",d.originalEvent);for(const A in e){const{originalEvent:I}=e[A];this._fireEvent(A,I)}const y={};let x;for(const A in this._eventsInProgress){const{handlerName:I,originalEvent:L}=this._eventsInProgress[A];this._handlersById[I].isActive()||(delete this._eventsInProgress[A],x=i[I]||L,y[`${A}end`]=x)}for(const A in y)this._fireEvent(A,y[A]);const C=Za(this._eventsInProgress),M=(c||d)&&!C;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const A=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&A.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(A)}if(a&&M){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!A||!A.essential&&Ce.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:x})),I(this._map.getBearing())&&this._map.resetNorth()):(I(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new l.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Zd("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Li extends l.E{constructor(e,i,a){super(),this._renderFrameCallback=()=>{const c=Math.min((Ce.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new l.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,a){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},i),a)}panTo(e,i,a){return this.easeTo(l.e({center:e},i),a)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,a){return this.easeTo(l.e({zoom:e},i),a)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new l.l("movestart",i)).fire(new l.l("move",i)).fire(new l.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,a){return this.easeTo(l.e({bearing:e},i),a)}resetNorth(e,i){return this.rotateTo(0,l.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=ut.convert(e).adjustAntiMeridian();const a=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,i)}_cameraForBoxAndBearing(e,i,a,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=l.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const C=c.padding;c.padding={top:C,bottom:C,right:C,left:C}}const g=l.e(d,c.padding);c.padding=g;const y=this.transform,x=new ut(e,i);return this.cameraHelper.cameraForBoxAndBearing(c,g,x,a,y)}fitBounds(e,i,a){return this._fitInternal(this.cameraForBounds(e,i),i,a)}fitScreenCoordinates(e,i,a,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(e)),this.transform.screenPointToLocation(l.P.convert(i)),a,c),c,d)}_fitInternal(e,i,a){return e?(delete(i=l.e(e,i)).padding,i.linear?this.easeTo(i,a):this.flyTo(i,a)):this}jumpTo(e,i){this.stop();const a=this._getTransformForUpdate();let c=!1,d=!1,g=!1;const y=a.zoom;this.cameraHelper.handleJumpToCenterZoom(a,e);const x=a.zoom!==y;return"elevation"in e&&a.elevation!==+e.elevation&&a.setElevation(+e.elevation),"bearing"in e&&a.bearing!==+e.bearing&&(c=!0,a.setBearing(+e.bearing)),"pitch"in e&&a.pitch!==+e.pitch&&(d=!0,a.setPitch(+e.pitch)),"roll"in e&&a.roll!==+e.roll&&(g=!0,a.setRoll(+e.roll)),e.padding==null||a.isPaddingEqual(e.padding)||a.setPadding(e.padding),this._applyUpdatedTransform(a),this.fire(new l.l("movestart",i)).fire(new l.l("move",i)),x&&this.fire(new l.l("zoomstart",i)).fire(new l.l("zoom",i)).fire(new l.l("zoomend",i)),c&&this.fire(new l.l("rotatestart",i)).fire(new l.l("rotate",i)).fire(new l.l("rotateend",i)),d&&this.fire(new l.l("pitchstart",i)).fire(new l.l("pitch",i)).fire(new l.l("pitchend",i)),g&&this.fire(new l.l("rollstart",i)).fire(new l.l("roll",i)).fire(new l.l("rollend",i)),this.fire(new l.l("moveend",i))}calculateCameraOptionsFromTo(e,i,a,c=0){const d=l.a0.fromLngLat(e,i),g=l.a0.fromLngLat(a,c),y=g.x-d.x,x=g.y-d.y,C=g.z-d.z,M=Math.hypot(y,x,C);if(M===0)throw new Error("Can't calculate camera options with same From and To");const A=Math.hypot(y,x),I=l.aj(this.transform.cameraToCenterDistance/M/this.transform.tileSize),L=180*Math.atan2(y,-x)/Math.PI;let $=180*Math.acos(A/M)/Math.PI;return $=C<0?90-$:90+$,{center:g.toLngLat(),elevation:c,zoom:I,pitch:$,bearing:L}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,a,c,d){const g=this.transform.calculateCenterFromCameraLngLatAlt(e,i,a,c);return{center:g.center,elevation:g.elevation,zoom:g.zoom,bearing:a,pitch:c,roll:d}}easeTo(e,i){this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.cn},e)).animate===!1||!e.essential&&Ce.prefersReducedMotion)&&(e.duration=0);const a=this._getTransformForUpdate(),c=this.getBearing(),d=a.pitch,g=a.roll,y="bearing"in e?this._normalizeBearing(e.bearing,c):c,x="pitch"in e?+e.pitch:d,C="roll"in e?this._normalizeBearing(e.roll,g):g,M="padding"in e?e.padding:a.padding,A=l.P.convert(e.offset);let I,L;e.around&&(I=l.S.convert(e.around),L=a.locationToScreenPoint(I));const $={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},X=this.cameraHelper.handleEaseTo(a,{bearing:y,pitch:x,roll:C,padding:M,around:I,aroundPoint:L,offsetAsPoint:A,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||c!==y,this._pitching=this._pitching||x!==d,this._rolling=this._rolling||C!==g,this._padding=!a.isPaddingEqual(M),this._zooming=this._zooming||X.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,$),this.terrain&&this._prepareElevation(X.elevationCenter),this._ease(Y=>{X.easeFunc(Y),this.terrain&&!e.freezeElevation&&this._updateElevation(Y),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},Y=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,Y)},e),this}_prepareEase(e,i,a={}){this._moving=!0,i||a.moving||this.fire(new l.l("movestart",e)),this._zooming&&!a.zooming&&this.fire(new l.l("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new l.l("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new l.l("pitchstart",e)),this._rolling&&!a.rolling&&this.fire(new l.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(i-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(l.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),a=e.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(a<c){const d=this.calculateCameraOptionsFromTo(i,c,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&i.push(c=>this.transformCameraUpdate(c)),!i.length)return;const a=e.clone();for(const c of i){const d=a.clone(),{center:g,zoom:y,roll:x,pitch:C,bearing:M,elevation:A}=c(d);g&&d.setCenter(g),A!==void 0&&d.setElevation(A),y!==void 0&&d.setZoom(y),x!==void 0&&d.setRoll(x),C!==void 0&&d.setPitch(C),M!==void 0&&d.setBearing(M),a.apply(d)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new l.l("move",e)),this._zooming&&this.fire(new l.l("zoom",e)),this._rotating&&this.fire(new l.l("rotate",e)),this._pitching&&this.fire(new l.l("pitch",e)),this._rolling&&this.fire(new l.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const a=this._zooming,c=this._rotating,d=this._pitching,g=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,a&&this.fire(new l.l("zoomend",e)),c&&this.fire(new l.l("rotateend",e)),d&&this.fire(new l.l("pitchend",e)),g&&this.fire(new l.l("rollend",e)),this.fire(new l.l("moveend",e))}flyTo(e,i){if(!e.essential&&Ce.prefersReducedMotion){const Re=l.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Re,i)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cn},e);const a=this._getTransformForUpdate(),c=a.bearing,d=a.pitch,g=a.roll,y=a.padding,x="bearing"in e?this._normalizeBearing(e.bearing,c):c,C="pitch"in e?+e.pitch:d,M="roll"in e?this._normalizeBearing(e.roll,g):g,A="padding"in e?e.padding:a.padding,I=l.P.convert(e.offset);let L=a.centerPoint.add(I);const $=a.screenPointToLocation(L),X=this.cameraHelper.handleFlyTo(a,{bearing:x,pitch:C,roll:M,padding:A,locationAtOffset:$,offsetAsPoint:I,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let Y=e.curve;const J=Math.max(a.width,a.height),ie=J/X.scaleOfZoom,se=X.pixelPathLength;typeof X.scaleOfMinZoom=="number"&&(Y=Math.sqrt(J/X.scaleOfMinZoom/se*2));const re=Y*Y;function he(Re){const ct=(ie*ie-J*J+(Re?-1:1)*re*re*se*se)/(2*(Re?ie:J)*re*se);return Math.log(Math.sqrt(ct*ct+1)-ct)}function me(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function oe(Re){return(Math.exp(Re)+Math.exp(-Re))/2}const xe=he(!1);let Le=function(Re){return oe(xe)/oe(xe+Y*Re)},ke=function(Re){return J*((oe(xe)*(me(ct=xe+Y*Re)/oe(ct))-me(xe))/re)/se;var ct},Ie=(he(!0)-xe)/Y;if(Math.abs(se)<2e-6||!isFinite(Ie)){if(Math.abs(J-ie)<1e-6)return this.easeTo(e,i);const Re=ie<J?-1:1;Ie=Math.abs(Math.log(ie/J))/Y,ke=()=>0,Le=ct=>Math.exp(Re*Y*ct)}return e.duration="duration"in e?+e.duration:1e3*Ie/("screenSpeed"in e?+e.screenSpeed/Y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=c!==x,this._pitching=C!==d,this._rolling=M!==g,this._padding=!a.isPaddingEqual(A),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(X.targetCenter),this._ease(Re=>{const ct=Re*Ie,lt=1/Le(ct),Xe=ke(ct);this._rotating&&a.setBearing(l.C.number(c,x,Re)),this._pitching&&a.setPitch(l.C.number(d,C,Re)),this._rolling&&a.setRoll(l.C.number(g,M,Re)),this._padding&&(a.interpolatePadding(y,A,Re),L=a.centerPoint.add(I)),X.easeFunc(Re,lt,Xe,L),this.terrain&&!e.freezeElevation&&this._updateElevation(Re),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,i)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,i,a){a.animate===!1||a.duration===0?(e(1),i()):(this._easeStart=Ce.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=l.aN(e,-180,180);const a=Math.abs(e-i);return Math.abs(e-360-i)<a&&(e-=360),Math.abs(e+360-i)<a&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.S.convert(e),this.transform.tileZoom):null}}const Ha={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Qs{constructor(e=Ha){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const a=this._map._getUIString(`AttributionControl.${i}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const i=this._map.style.sourceCaches;for(const c in i){const d=i[c];if(d.used||d.usedForTerrain){const g=d.getSource();g.attribution&&e.indexOf(g.attribution)<0&&e.push(g.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,d)=>c.length-d.length),e=e.filter((c,d)=>{for(let g=d+1;g<e.length;g++)if(e[g].indexOf(c)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=N.sanitize(a),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class vc{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const i=N.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class _h{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,a=i?this._queue.concat(i):this._queue;for(const c of a)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const a of i)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var yh=l.aI([{name:"a_pos3d",type:"Int16",components:3}]);class Hd extends l.E{constructor(e){super(),this._lastTilesetChange=Ce.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const a={};for(const c of Te(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))a[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),l.bX(c.terrainRttPosMatrix32f,0,l.$,l.$,0,0,1),this._tiles[c.key]=new Ui(c,this.tileSize),this._lastTilesetChange=Ce.now());for(const c in this._tiles)a[c]||delete this._tiles[c]}freeRtt(e){for(const i in this._tiles){const a=this._tiles[i];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,i){return i?this._getTerrainCoordsForTileRanges(e,i):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const a of this._renderableTilesKeys){const c=this._tiles[a].tileID,d=e.clone(),g=l.b9();if(c.canonical.equals(e.canonical))l.bX(g,0,l.$,l.$,0,0,1);else if(c.canonical.isChildOf(e.canonical)){const y=c.canonical.z-e.canonical.z,x=c.canonical.x-(c.canonical.x>>y<<y),C=c.canonical.y-(c.canonical.y>>y<<y),M=l.$>>y;l.bX(g,0,M,M,0,0,1),l.M(g,g,[-x*M,-C*M,0])}else{if(!e.canonical.isChildOf(c.canonical))continue;{const y=e.canonical.z-c.canonical.z,x=e.canonical.x-(e.canonical.x>>y<<y),C=e.canonical.y-(e.canonical.y>>y<<y),M=l.$>>y;l.bX(g,0,l.$,l.$,0,0,1),l.M(g,g,[x*M,C*M,0]),l.N(g,g,[1/2**y,1/2**y,0])}}d.terrainRttPosMatrix32f=new Float32Array(g),i[a]=d}return i}_getTerrainCoordsForTileRanges(e,i){const a={};for(const c of this._renderableTilesKeys){const d=this._tiles[c].tileID;if(!this._isWithinTileRanges(d,i))continue;const g=e.clone(),y=l.b9();if(d.canonical.z===e.canonical.z){const x=e.canonical.x-d.canonical.x,C=e.canonical.y-d.canonical.y;l.bX(y,0,l.$,l.$,0,0,1),l.M(y,y,[x*l.$,C*l.$,0])}else if(d.canonical.z>e.canonical.z){const x=d.canonical.z-e.canonical.z,C=d.canonical.x-(d.canonical.x>>x<<x),M=d.canonical.y-(d.canonical.y>>x<<x),A=e.canonical.x-(d.canonical.x>>x),I=e.canonical.y-(d.canonical.y>>x),L=l.$>>x;l.bX(y,0,L,L,0,0,1),l.M(y,y,[-C*L+A*l.$,-M*L+I*l.$,0])}else{const x=e.canonical.z-d.canonical.z,C=e.canonical.x-(e.canonical.x>>x<<x),M=e.canonical.y-(e.canonical.y>>x<<x),A=(e.canonical.x>>x)-d.canonical.x,I=(e.canonical.y>>x)-d.canonical.y,L=l.$<<x;l.bX(y,0,L,L,0,0,1),l.M(y,y,[C*l.$+A*L,M*l.$+I*L,0])}g.terrainRttPosMatrix32f=new Float32Array(y),a[c]=g}return a}getSourceTile(e,i){const a=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>a.maxzoom&&(c=a.maxzoom),c<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&i)for(;c>=a.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(c--).key);return d}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,i){return i[e.canonical.z]&&e.canonical.x>=i[e.canonical.z].minTileX&&e.canonical.x<=i[e.canonical.z].maxTileX&&e.canonical.y>=i[e.canonical.z].minTileY&&e.canonical.y<=i[e.canonical.z].maxTileY}}class xr{constructor(e,i,a){this._meshCache={},this.painter=e,this.sourceCache=new Hd(i),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,a,c=l.$){var d;if(!(i>=0&&i<c&&a>=0&&a<c))return 0;const g=this.getTerrainData(e),y=(d=g.tile)===null||d===void 0?void 0:d.dem;if(!y)return 0;const x=l.cr([],[i/c*l.$,a/c*l.$],g.u_terrain_matrix),C=[x[0]*y.dim,x[1]*y.dim],M=Math.floor(C[0]),A=Math.floor(C[1]),I=C[0]-M,L=C[1]-A;return y.get(M,A)*(1-I)*(1-L)+y.get(M+1,A)*I*(1-L)+y.get(M,A+1)*(1-I)*L+y.get(M+1,A+1)*I*L}getElevationForLngLatZoom(e,i){if(!l.cs(i,e.wrap()))return 0;const{tileID:a,mercatorX:c,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(a,c%l.$,d%l.$,l.$)}getElevation(e,i,a,c=l.$){return this.getDEMElevation(e,i,a,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,d=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(c,new l.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.af([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const c=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new l.T(c,i.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),i.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const a=i&&i+i.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?d=e.canonical.z-c:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const g=e.canonical.x-(e.canonical.x>>d<<d),y=e.canonical.y-(e.canonical.y>>d<<d),x=l.ct(new Float64Array(16),[1/(l.$<<d),1/(l.$<<d),0]);l.M(x,x,[g*l.$,y*l.$,0]),this._demMatrixCache[e.key]={matrix:x,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,a=i.width/devicePixelRatio,c=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(i.context,{width:a,height:c,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(i.context,{width:a,height:c,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(a,c,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,a,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,g=0;d<this._coordsTextureSize;d++)for(let y=0;y<this._coordsTextureSize;y++,g+=4)i[g+0]=255&y,i[g+1]=255&d,i[g+2]=y>>8<<4|d>>8,i[g+3]=0;const a=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),c=new l.T(e,a,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),a=this.painter.context,c=a.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),g=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),y=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(d,y-g-1,1,1,c.RGBA,c.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null);const x=i[0]+(i[2]>>4<<8),C=i[1]+((15&i[2])<<8),M=this.coordsIndex[255-i[3]],A=M&&this.sourceCache.getTileByID(M);if(!A)return null;const I=this._coordsTextureSize,L=(1<<A.tileID.canonical.z)*I;return new l.a0((A.tileID.canonical.x*I+x)/L+A.tileID.wrap,(A.tileID.canonical.y*I+C)/L,this.getElevation(A.tileID,x,C,I))}depthAtPoint(e){const i=new Uint8Array(4),a=this.painter.context,c=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const a=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,c=a&&e.canonical.y===0,d=a&&e.canonical.y===(1<<e.canonical.z)-1,g=`m_${c?"n":""}_${d?"s":""}`;if(this._meshCache[g])return this._meshCache[g];const y=this.painter.context,x=new l.cu,C=new l.aM,M=this.meshSize,A=l.$/M,I=M*M;for(let oe=0;oe<=M;oe++)for(let xe=0;xe<=M;xe++)x.emplaceBack(xe*A,oe*A,0);for(let oe=0;oe<I;oe+=M+1)for(let xe=0;xe<M;xe++)C.emplaceBack(xe+oe,M+xe+oe+1,M+xe+oe+2),C.emplaceBack(xe+oe,M+xe+oe+2,xe+oe+1);const L=x.length,$=L+(M+1),X=(M+1)*M,Y=c?l.bg:0,J=c?0:1,ie=d?l.bh:l.$,se=d?0:1;for(let oe=0;oe<=M;oe++)x.emplaceBack(oe*A,Y,J);for(let oe=0;oe<=M;oe++)x.emplaceBack(oe*A,ie,se);for(let oe=0;oe<M;oe++)C.emplaceBack(X+oe,$+oe,$+oe+1),C.emplaceBack(X+oe,$+oe+1,X+oe+1),C.emplaceBack(0+oe,L+oe+1,L+oe),C.emplaceBack(0+oe,0+oe+1,L+oe+1);const re=x.length,he=re+2*(M+1);for(const oe of[0,1])for(let xe=0;xe<=M;xe++)for(const Le of[0,1])x.emplaceBack(oe*l.$,xe*A,Le);for(let oe=0;oe<2*M;oe+=2)C.emplaceBack(re+oe,re+oe+1,re+oe+3),C.emplaceBack(re+oe,re+oe+3,re+oe+2),C.emplaceBack(he+oe,he+oe+3,he+oe+1),C.emplaceBack(he+oe,he+oe+2,he+oe+3);const me=new Ir(y.createVertexBuffer(x,yh.members),y.createIndexBuffer(C),l.aL.simpleSegment(0,0,x.length,C.length));return this._meshCache[g]=me,me}getMeshFrameDelta(e){return 2*Math.PI*l.bt/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var a;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(a=this.getMinMaxElevation(c).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return i&&i.dem&&(a.minElevation=i.dem.min*this.exaggeration,a.maxElevation=i.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,i){const a=l.a0.fromLngLat(e.wrap()),c=(1<<i)*l.$,d=a.x*c,g=a.y*c,y=Math.floor(d/l.$),x=Math.floor(g/l.$);return{tileID:new l.Z(i,0,i,y,x),mercatorX:d,mercatorY:g}}}class el{constructor(e,i,a){this._context=e,this._size=i,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(a.texture),{id:e,fbo:i,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Ct={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Vt{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new el(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(i)),this._coordsAscending={};for(const a in e.sourceCaches){this._coordsAscending[a]={};const c=e.sourceCaches[a].getVisibleCoordinates(),d=e.sourceCaches[a].getSource(),g=d instanceof $t?d.terrainTileRanges:null;for(const y of c){const x=this.terrain.sourceCache.getTerrainCoords(y,g);for(const C in x)this._coordsAscending[a][C]||(this._coordsAscending[a][C]=[]),this._coordsAscending[a][C].push(x[C])}}this._coordsAscendingStr={};for(const a of e._order){const c=e._layers[a],d=c.source;if(Ct[c.type]&&!this._coordsAscendingStr[d]){this._coordsAscendingStr[d]={};for(const g in this._coordsAscending[d])this._coordsAscendingStr[d][g]=this._coordsAscending[d][g].map(y=>y.key).sort().join()}}for(const a of this._renderableTiles)for(const c in this._coordsAscendingStr){const d=this._coordsAscendingStr[c][a.tileID.key];d&&d!==a.rttCoords[c]&&(a.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const a=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),c=e.type,d=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ct[c]&&(this._prevType&&Ct[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!g))return!0;if(Ct[this._prevType]||Ct[c]&&g){this._prevType=c;const y=this._stacks.length-1,x=this._stacks[y]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(qi(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[y]){const A=this.pool.getObjectForId(C.rtt[y].id);if(A.stamp===C.rtt[y].stamp){this.pool.useObject(A);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),C.rtt[y]={id:M.id,stamp:M.stamp},d.context.bindFramebuffer.set(M.fbo.framebuffer),d.context.clear({color:l.be.transparent,stencil:0}),d.currentStencilSource=void 0;for(let A=0;A<x.length;A++){const I=d.style._layers[x[A]],L=I.source?this._coordsAscending[I.source][C.tileID.key]:[C.tileID];d.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),d._renderTileClippingMasks(I,L,!0),d.renderLayer(d,d.style.sourceCaches[I.source],I,L,a),I.source&&(C.rttCoords[I.source]=this._coordsAscendingStr[I.source][C.tileID.key])}}return qi(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects(),Ct[c]}return!1}}const tl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},bc=ae,Wa={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ha,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Bn={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class vh{constructor(e,i,a=!1){this.mousedown=d=>{this.startMove(d,N.mousePos(this.element,d)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=d=>{this.move(d,N.mousePos(this.element,d))},this.mouseup=d=>{this._rotatePitchHanlder.dragEnd(d),this.offTemp()},this.touchstart=d=>{d.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,d.targetTouches)[0],this.startMove(d,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=d=>{d.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,d.targetTouches)[0],this.move(d,this._lastPos))},this.touchend=d=>{d.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const c=new Vd;this._rotatePitchHanlder=new Qo({clickTolerance:3,move:(d,g)=>{const y=i.getBoundingClientRect(),x=new l.P((y.bottom-y.top)/2,(y.right-y.left)/2);return{bearingDelta:l.cm(new l.P(d.x,g.y),g,x),pitchDelta:a?-.5*(g.y-d.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=e,N.addEventListener(i,"mousedown",this.mousedown),N.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),N.disableDrag()}move(e,i){const a=this.map,{bearingDelta:c,pitchDelta:d}=this._rotatePitchHanlder.dragMove(e,i)||{};c&&a.setBearing(a.getBearing()+c),d&&a.setPitch(a.getPitch()+d)}off(){const e=this.element;N.removeEventListener(e,"mousedown",this.mousedown),N.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let xn;function bh(h,e,i,a=!1){if(a||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return h==null?void 0:h.wrap();const c=new l.S(h.lng,h.lat);if(h=new l.S(h.lng,h.lat),e){const d=new l.S(h.lng-360,h.lat),g=new l.S(h.lng+360,h.lat),y=i.locationToScreenPoint(h).distSqr(e);i.locationToScreenPoint(d).distSqr(e)<y?h=d:i.locationToScreenPoint(g).distSqr(e)<y&&(h=g)}for(;Math.abs(h.lng-i.center.lng)>180;){const d=i.locationToScreenPoint(h);if(d.x>=0&&d.y>=0&&d.x<=i.width&&d.y<=i.height)break;h.lng>i.center.lng?h.lng-=360:h.lng+=360}return h.lng!==c.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(h))?h:c}const vo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bi(h,e,i){const a=h.classList;for(const c in vo)a.remove(`maplibregl-${i}-anchor-${c}`);a.add(`maplibregl-${i}-anchor-${e}`)}class Gi extends l.E{constructor(e){if(super(),this._onKeyPress=i=>{const a=i.code,c=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=i=>{const a=i.originalEvent.target,c=this._element;this._popup&&(a===c||c.contains(a))&&this.togglePopup()},this._update=i=>{if(!this._map)return;const a=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!a)&&this._map.once("render",this._update),this._lngLat=bh(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${vo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),Ce.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const i=N.createNS("http://www.w3.org/2000/svg","svg"),a=41,c=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${a}px`),i.setAttributeNS(null,"width",`${c}px`),i.setAttributeNS(null,"viewBox",`0 0 ${c} ${a}`);const d=N.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const g=N.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"fill-rule","nonzero");const y=N.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of x){const ie=N.createNS("http://www.w3.org/2000/svg","ellipse");ie.setAttributeNS(null,"opacity","0.04"),ie.setAttributeNS(null,"cx","10.5"),ie.setAttributeNS(null,"cy","5.80029008"),ie.setAttributeNS(null,"rx",J.rx),ie.setAttributeNS(null,"ry",J.ry),y.appendChild(ie)}const C=N.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const M=N.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(M);const A=N.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"opacity","0.25"),A.setAttributeNS(null,"fill","#000000");const I=N.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),A.appendChild(I);const L=N.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(6.0, 7.0)"),L.setAttributeNS(null,"fill","#FFFFFF");const $=N.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=N.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const Y=N.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#FFFFFF"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962"),$.appendChild(X),$.appendChild(Y),g.appendChild(y),g.appendChild(C),g.appendChild(A),g.appendChild(L),g.appendChild($),i.appendChild(g),i.setAttributeNS(null,"height",a*this._scale+"px"),i.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(i),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),Bi(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,a;const c=(i=this._map)===null||i===void 0?void 0:i.terrain,d=this._map.transform.isLocationOccluded(this._lngLat);if(!c||d){const L=d?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==L&&(this._element.style.opacity=L))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,y=g.terrain.depthAtPoint(this._pos),x=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,x)-y<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/g.transform.pixelsPerMeter,M=Math.sin(g.getPitch()*Math.PI/180)*C,A=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),I=g.transform.lngLatToCameraDepth(this._lngLat,x+M)-A>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&I&&this._popup.remove(),this._element.style.opacity=I?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const xh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Xr=0,Kr=!1;const xc={maxWidth:100,unit:"metric"};function il(h,e,i){const a=i&&i.maxWidth||100,c=h._container.clientHeight/2,d=h._container.clientWidth/2,g=h.unproject([d-a/2,c]),y=h.unproject([d+a/2,c]),x=Math.round(h.project(y).x-h.project(g).x),C=Math.min(a,x,h._container.clientWidth),M=g.distanceTo(y);if(i&&i.unit==="imperial"){const A=3.2808*M;A>5280?bo(e,C,A/5280,h._getUIString("ScaleControl.Miles")):bo(e,C,A,h._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?bo(e,C,M/1852,h._getUIString("ScaleControl.NauticalMiles")):M>=1e3?bo(e,C,M/1e3,h._getUIString("ScaleControl.Kilometers")):bo(e,C,M,h._getUIString("ScaleControl.Meters"))}function bo(h,e,i,a){const c=function(d){const g=Math.pow(10,`${Math.floor(d)}`.length-1);let y=d/g;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(x){const C=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*C)/C}(y),g*y}(i);h.style.width=e*(c/i)+"px",h.innerHTML=`${c}&nbsp;${a}`}const Ya={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},wc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nl(h){if(h){if(typeof h=="number"){const e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,h),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-h),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(h,0),right:new l.P(-h,0)}}if(h instanceof l.P||Array.isArray(h)){const e=l.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(h.center||[0,0]),top:l.P.convert(h.top||[0,0]),"top-left":l.P.convert(h["top-left"]||[0,0]),"top-right":l.P.convert(h["top-right"]||[0,0]),bottom:l.P.convert(h.bottom||[0,0]),"bottom-left":l.P.convert(h["bottom-left"]||[0,0]),"bottom-right":l.P.convert(h["bottom-right"]||[0,0]),left:l.P.convert(h.left||[0,0]),right:l.P.convert(h.right||[0,0])}}return nl(new l.P(0,0))}const Sc=ae;S.AJAXError=l.cy,S.Event=l.l,S.Evented=l.E,S.LngLat=l.S,S.MercatorCoordinate=l.a0,S.Point=l.P,S.addProtocol=l.cz,S.config=l.a,S.removeProtocol=l.cA,S.AttributionControl=Qs,S.BoxZoomHandler=uc,S.CanvasSource=Pi,S.CooperativeGesturesHandler=gh,S.DoubleClickZoomHandler=Ks,S.DragPanHandler=gc,S.DragRotateHandler=Js,S.EdgeInsets=er,S.FullscreenControl=class extends l.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const h=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Et,S.GeolocateControl=class extends l.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new l.S(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,c=this._map.getBearing(),d=l.e({bearing:c},this.options.fitBoundsOptions),g=ut.fromLngLat(i,a);this._map.fitBounds(g,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new l.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Kr)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gi({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))})}},this.options=l.e({},xh,h)}onAdd(h){return this._map=h,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(e=!1){if(xn!==void 0&&!e)return xn;if(window.navigator.permissions===void 0)return xn=!!window.navigator.geolocation,xn;try{xn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{xn=!!window.navigator.geolocation}return xn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Xr=0,Kr=!1}_isOutOfMapMaxBounds(h){const e=this._map.getMaxBounds(),i=h.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const h=this._map.getBounds(),e=h.getSouthEast(),i=h.getNorthEast(),a=e.distanceTo(i),c=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xr--,Kr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Xr++,Xr>1?(h={maximumAge:6e5,timeout:0},Kr=!0):(h=this.options.positionOptions,Kr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.GlobeControl=class{constructor(){this._toggleProjection=()=>{var h;const e=(h=this._map.getProjection())===null||h===void 0?void 0:h.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var h;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((h=this._map.getProjection())===null||h===void 0?void 0:h.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(h){return this._map=h,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=N.create("button","maplibregl-ctrl-globe",this._container),N.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},S.Hash=$a,S.ImageSource=$t,S.KeyboardHandler=ia,S.LngLatBounds=ut,S.LogoControl=vc,S.Map=class extends Li{constructor(h){var e,i;l.cv.mark(l.cw.create);const a=Object.assign(Object.assign(Object.assign({},Wa),h),{canvasContextAttributes:Object.assign(Object.assign({},Wa.canvasContextAttributes),h.canvasContextAttributes)});if(a.minZoom!=null&&a.maxZoom!=null&&a.minZoom>a.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(a.minPitch!=null&&a.maxPitch!=null&&a.minPitch>a.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(a.minPitch!=null&&a.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(a.maxPitch!=null&&a.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const c=new rn,d=new Es;if(a.minZoom!==void 0&&c.setMinZoom(a.minZoom),a.maxZoom!==void 0&&c.setMaxZoom(a.maxZoom),a.minPitch!==void 0&&c.setMinPitch(a.minPitch),a.maxPitch!==void 0&&c.setMaxPitch(a.maxPitch),a.renderWorldCopies!==void 0&&c.setRenderWorldCopies(a.renderWorldCopies),super(c,d,{bearingSnap:a.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new _h,this._controls=[],this._mapId=l.a6(),this._contextLost=y=>{y.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.l("webglcontextlost",{originalEvent:y}))},this._contextRestored=y=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:y}))},this._onMapScroll=y=>{if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=a.interactive,this._maxTileCacheSize=a.maxTileCacheSize,this._maxTileCacheZoomLevels=a.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},a.canvasContextAttributes),this._trackResize=a.trackResize===!0,this._bearingSnap=a.bearingSnap,this._centerClampedToGround=a.centerClampedToGround,this._refreshExpiredTiles=a.refreshExpiredTiles===!0,this._fadeDuration=a.fadeDuration,this._crossSourceCollisions=a.crossSourceCollisions===!0,this._collectResourceTiming=a.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},tl),a.locale),this._clickTolerance=a.clickTolerance,this._overridePixelRatio=a.pixelRatio,this._maxCanvasSize=a.maxCanvasSize,this.transformCameraUpdate=a.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=a.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=mt.addThrottleControl(()=>this.isMoving()),this._requestManager=new dt(a.transformRequest),typeof a.container=="string"){if(this._container=document.getElementById(a.container),!this._container)throw new Error(`Container '${a.container}' not found.`)}else{if(!(a.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=a.container}if(a.maxBounds&&this.setMaxBounds(a.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let y=!1;const x=Zs(C=>{this._trackResize&&!this._removed&&(this.resize(C),this.redraw())},50);this._resizeObserver=new ResizeObserver(C=>{y?x(C):y=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Yr(this,a),this._hash=a.hash&&new $a(typeof a.hash=="string"&&a.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,roll:a.roll}),a.bounds&&(this.resize(),this.fitBounds(a.bounds,l.e({},a.fitBoundsOptions,{duration:0}))));const g=typeof a.style=="string"||((i=(e=a.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,g),this._localIdeographFontFamily=a.localIdeographFontFamily,this._validateStyle=a.validateStyle,a.style&&this.setStyle(a.style,{localIdeographFontFamily:a.localIdeographFontFamily}),a.attributionControl&&this.addControl(new Qs(typeof a.attributionControl=="boolean"?void 0:a.attributionControl)),a.maplibreLogo&&this.addControl(new vc,a.logoPosition),this.on("style.load",()=>{if(g||this._resizeTransform(),this.transform.unmodified){const y=l.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(y)}}),this.on("data",y=>{this._update(y.dataType==="style"),this.fire(new l.l(`${y.dataType}data`,y))}),this.on("dataloading",y=>{this.fire(new l.l(`${y.dataType}dataloading`,y))}),this.on("dataabort",y=>{this.fire(new l.l("sourcedataabort",y))})}_getMapId(){return this._mapId}setGlobalStateProperty(h,e){return this.style.setGlobalStateProperty(h,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=h.onAdd(this);this._controls.push(h);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(i,a.firstChild):a.appendChild(i),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,i,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,i,a)}resize(h,e=!0){const[i,a]=this._containerDimensions(),c=this._getClampedPixelRatio(i,a);if(this._resizeCanvas(i,a,c),this.painter.resize(i,a,c),this.painter.overLimit()){const g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];const y=this._getClampedPixelRatio(i,a);this._resizeCanvas(i,a,y),this.painter.resize(i,a,y)}this._resizeTransform(e);const d=!this._moving;return d&&(this.stop(),this.fire(new l.l("movestart",h)).fire(new l.l("move",h))),this.fire(new l.l("resize",h)),d&&this.fire(new l.l("moveend",h)),this}_resizeTransform(h=!0){var e;const[i,a]=this._containerDimensions();this.transform.resize(i,a,h),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,a,h)}_getClampedPixelRatio(h,e){const{0:i,1:a}=this._maxCanvasSize,c=this.getPixelRatio(),d=h*c,g=e*c;return Math.min(d>i?i/d:1,g>a?a/g:1)*c}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(ut.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.setMinZoom(h),this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.setMaxZoom(h),this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.setMinPitch(h),this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(h>=this.transform.minPitch)return this.transform.setMaxPitch(h),this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.setRenderWorldCopies(h),this._update()}project(h){return this.transform.locationToScreenPoint(l.S.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.screenPointToLocation(l.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,i){if(h==="mouseenter"||h==="mouseover"){let a=!1;return{layers:e,listener:i,delegates:{mousemove:d=>{const g=e.filter(x=>this.getLayer(x)),y=g.length!==0?this.queryRenderedFeatures(d.point,{layers:g}):[];y.length?a||(a=!0,i.call(this,new qn(h,this,d.originalEvent,{features:y}))):a=!1},mouseout:()=>{a=!1}}}}if(h==="mouseleave"||h==="mouseout"){let a=!1;return{layers:e,listener:i,delegates:{mousemove:g=>{const y=e.filter(x=>this.getLayer(x));(y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[]).length?a=!0:a&&(a=!1,i.call(this,new qn(h,this,g.originalEvent)))},mouseout:g=>{a&&(a=!1,i.call(this,new qn(h,this,g.originalEvent)))}}}}{const a=c=>{const d=e.filter(y=>this.getLayer(y)),g=d.length!==0?this.queryRenderedFeatures(c.point,{layers:d}):[];g.length&&(c.features=g,i.call(this,c),delete c.features)};return{layers:e,listener:i,delegates:{[h]:a}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,i){if(!this._delegatedListeners||!this._delegatedListeners[h])return;const a=this._delegatedListeners[h];for(let c=0;c<a.length;c++){const d=a[c];if(d.listener===i&&d.layers.length===e.length&&d.layers.every(g=>e.includes(g))){for(const g in d.delegates)this.off(g,d.delegates[g]);return void a.splice(c,1)}}}on(h,e,i){if(i===void 0)return super.on(h,e);const a=typeof e=="string"?[e]:e,c=this._createDelegatedListener(h,a,i);this._saveDelegatedListener(h,c);for(const d in c.delegates)this.on(d,c.delegates[d]);return{unsubscribe:()=>{this._removeDelegatedListener(h,a,i)}}}once(h,e,i){if(i===void 0)return super.once(h,e);const a=typeof e=="string"?[e]:e,c=this._createDelegatedListener(h,a,i);for(const d in c.delegates){const g=c.delegates[d];c.delegates[d]=(...y)=>{this._removeDelegatedListener(h,a,i),g(...y)}}this._saveDelegatedListener(h,c);for(const d in c.delegates)this.once(d,c.delegates[d]);return this}off(h,e,i){return i===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let i;const a=h instanceof l.P||Array.isArray(h),c=a?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:h)||{},c instanceof l.P||typeof c[0]=="number")i=[l.P.convert(c)];else{const d=l.P.convert(c[0]),g=l.P.convert(c[1]);i=[d,new l.P(g.x,d.y),g,new l.P(d.x,g.y),d]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){var i,a;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,e));const c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new $l(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,c):this.style.loadJSON(h,e,c),this):((a=(i=this.style)===null||i===void 0?void 0:i.projection)===null||a===void 0||a.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $l(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){const i=this._requestManager.transformRequest(h,"Style");l.j(i,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new l.k(a))})}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(i){l.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){const e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new l.k(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){const e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const a=this.style._layers[i];a.type==="hillshade"&&a.source===h.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),a.type==="color-relief"&&a.source===h.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new xr(this.painter,e,h),this.painter.renderToTexture=new Vt(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var a;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==h.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((a=i.source)===null||a===void 0?void 0:a.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const e in h){const i=h[e]._tiles;for(const a in i){const c=i[a];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}setSourceTileLodParams(h,e,i){if(i){const a=this.getSource(i);if(!a)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);a.calculateTileZoom=Me(Math.max(1,h),Math.max(1,e))}else for(const a in this.style.sourceCaches)this.style.sourceCaches[a].getSource().calculateTileZoom=Me(Math.max(1,h),Math.max(1,e));return this._update(!0),this}refreshTiles(h,e){const i=this.style.sourceCaches[h];if(!i)throw new Error(`There is no source cache with ID "${h}", cannot refresh tile`);e===void 0?i.reload(!0):i.refreshTiles(e.map(a=>new l.a3(a.z,a.x,a.y)))}addImage(h,e,i={}){const{pixelRatio:a=1,sdf:c=!1,stretchX:d,stretchY:g,content:y,textFitWidth:x,textFitHeight:C}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:A,data:I}=e,L=e;return this.style.addImage(h,{data:new l.R({width:M,height:A},new Uint8Array(I)),pixelRatio:a,stretchX:d,stretchY:g,content:y,textFitWidth:x,textFitHeight:C,sdf:c,version:0,userImage:L}),L.onAdd&&L.onAdd(this,h),this}}{const{width:M,height:A,data:I}=Ce.getImageData(e);this.style.addImage(h,{data:new l.R({width:M,height:A},I),pixelRatio:a,stretchX:d,stretchY:g,content:y,textFitWidth:x,textFitHeight:C,sdf:c,version:0})}}updateImage(h,e){const i=this.style.getImage(h);if(!i)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||l.b(e)?Ce.getImageData(e):e,{width:c,height:d,data:g}=a;if(c===void 0||d===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==i.data.width||d!==i.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(e instanceof HTMLImageElement||l.b(e));return i.data.replace(g,y),this.style.updateImage(h,i),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return mt.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,i){return this.style.setLayerZoomRange(h,e,i),this._update(!0)}setFilter(h,e,i={}){return this.style.setFilter(h,e,i),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,i,a={}){return this.style.setPaintProperty(h,e,i,a),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,i,a={}){return this.style.setLayoutProperty(h,e,i,a),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,i,a=>{a||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,i=>{i||this._update(!0)}),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(h,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map");const e=this._canvasContainer=N.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),a=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],a);const c=this._controlContainer=N.create("div","maplibregl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{d[g]=N.create("div",`maplibregl-ctrl-${g} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,i){this._canvas.width=Math.floor(i*h),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const h=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:h},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,h):this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h),!i){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new ir(i,this.transform),ge.testSupport(i)}migrateProjection(h,e){super.migrateProjection(h,e),this.painter.transform=h,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){var e,i,a,c,d;const g=this._idleTriggered?this._fadeDuration:0,y=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,I=Ce.now();this.style.zoomHistory.update(A,I);const L=new l.F(A,{now:I,fadeDuration:g,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),$=L.crossFadingFactor();$===1&&$===this._crossFadingFactor||(x=!0,this._crossFadingFactor=$),this.style.update(L)}const C=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==y;(a=this.style.projection)===null||a===void 0||a.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(d=this.style.projection)===null||d===void 0?void 0:d.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||C)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,C),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cv.mark(l.cw.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const M=this._sourcesDirty||this._styleDirty||this._placementDirty;return M||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,l.cv.mark(l.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),mt.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cv.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ce.frame(this._frameRequest,h=>{l.cv.frame(h),this._frameRequest=null;try{this._render(h)}catch(e){if(!l.cx(e)&&!function(i){return i.message===ic}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return bc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),this.style.setProjection(h),this._update(!0)}},S.MapMouseEvent=qn,S.MapTouchEvent=lr,S.MapWheelEvent=cc,S.Marker=Gi,S.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const a=this._map._getUIString(`NavigationControl.${i}`);e.title=a,e.setAttribute("aria-label",a)},this.options=l.e({},Bn,h),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){const i=N.create("button",h,this._container);return i.type="button",i.addEventListener("click",e),i}},S.Popup=class extends l.E{constructor(h){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const g of this.options.className.split(" "))this._container.classList.add(g);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=bh(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const i=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let a=this.options.anchor;const c=nl(this.options.offset);if(!a){const g=this._container.offsetWidth,y=this._container.offsetHeight;let x;x=i.y+c.bottom.y<y?["top"]:i.y>this._map.transform.height-y?["bottom"]:[],i.x<g/2?x.push("left"):i.x>this._map.transform.width-g/2&&x.push("right"),a=x.length===0?"bottom":x.join("-")}let d=i.add(c[a]);this.options.subpixelPositioning||(d=d.round()),N.setTransform(this._container,`${vo[a]} translate(${d.x}px,${d.y}px)`),Bi(this._container,a,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Ya),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=l.S.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const e=document.createDocumentFragment(),i=document.createElement("body");let a;for(i.innerHTML=h;a=i.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(wc);h&&h.focus()}},S.RasterDEMTileSource=Ot,S.RasterTileSource=ht,S.ScaleControl=class{constructor(h){this._onMove=()=>{il(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,il(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xc),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=mh,S.Style=$l,S.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=pc,S.TwoFingersTouchRotateHandler=dc,S.TwoFingersTouchZoomHandler=br,S.TwoFingersTouchZoomRotateHandler=_c,S.VectorTileSource=we,S.VideoSource=jt,S.addSourceType=(h,e)=>l._(void 0,void 0,void 0,function*(){if(Di(h))throw new Error(`A source type called "${h}" already exists.`);((i,a)=>{Yi[i]=a})(h,e)}),S.clearPrewarmedResources=function(){const h=ii;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(at),ii=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.createTileMesh=Bl,S.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return Ti().getRTLTextPluginStatus()},S.getVersion=function(){return Sc},S.getWorkerCount=function(){return ft.workerCount},S.getWorkerUrl=function(){return l.a.WORKER_URL},S.importScriptInWorkers=function(h){return Yt().broadcast("IS",h)},S.prewarm=function(){gi().acquire(at)},S.setMaxParallelImageRequests=function(h){l.a.MAX_PARALLEL_IMAGE_REQUESTS=h},S.setRTLTextPlugin=function(h,e){return Ti().setRTLTextPlugin(h,e)},S.setWorkerCount=function(h){ft.workerCount=h},S.setWorkerUrl=function(h){l.a.WORKER_URL=h}});var G=s;return G})})(E_);var Wv=E_.exports;const da=__(Wv);function Yv(b){return b.indexOf("mapbox:")===0}function Xv(b,f,s){if(b.indexOf("/styles/")>-1&&b.indexOf("/sprite")===-1)return{url:Kv(b,s)};if(b.indexOf("/sprites/")>-1)return{url:Qv(b,s)};if(b.indexOf("/fonts/")>-1)return{url:Jv(b,s)};if(b.indexOf("/v4/")>-1)return{url:p0(b,s)};if(f==="Source")return{url:p0(b,s)}}function yu(b){const f=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/,s=b.match(f);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function ud(b,f){const s=yu("https://api.mapbox.com");b.protocol=s.protocol,b.authority=s.authority,b.params.push(`access_token=${f}`);const E=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${E}`}function Kv(b,f){const s=yu(b);return s.path=`/styles/v1${s.path}`,ud(s,f)}function Jv(b,f){const s=yu(b);return s.path=`/fonts/v1${s.path}`,ud(s,f)}function p0(b,f){const s=yu(b);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),ud(s,f)}function Qv(b,f){const s=yu(b);let E=s.path.split("."),R=E[0];const G=E[1];let S="";return R.indexOf("@2x")&&(R=R.split("@2x")[0],S="@2x"),s.path=`/styles/v1${R}/sprite${S}.${G}`,ud(s,f)}function k_(b,f){return f||(f=b.slice(0)),Object.freeze(Object.defineProperties(b,{raw:{value:Object.freeze(f)}}))}var f0,eb=bn(f0||(f0=k_([`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:-webkit-full-screen{height:100%;width:100%}.maplibregl-map:-ms-fullscreen{height:100%;width:100%}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{-ms-touch-action:none;touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{-ms-touch-action:none;touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (forced-colors:active){.maplibregl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}@media (hover:hover){.maplibregl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}}.maplibregl-ctrl button:not(:disabled):active{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-globe .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%23333' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-globe-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%2333b5e5' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{-webkit-animation:maplibregl-spin 2s linear infinite;animation:maplibregl-spin 2s linear infinite}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@-webkit-keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:hsla(0,0%,100%,.5);margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;-webkit-box-sizing:content-box;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:hsla(0,0%,100%,.5);background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:hsla(0,0%,100%,.75);border:2px solid #333;border-top:#333;-webkit-box-sizing:border-box;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:-webkit-box;display:-ms-flexbox;display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.maplibregl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.maplibregl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{-ms-flex-item-align:start;align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{-ms-flex-item-align:end;align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{-ms-flex-item-align:center;align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.maplibregl-popup-content{background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;-webkit-transition:opacity .2s;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{-webkit-animation:maplibregl-user-location-dot-pulse 2s infinite;animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35);-webkit-box-sizing:border-box;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@-webkit-keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:rgba(0,0,0,.4);color:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:1.4em;inset:0;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;-webkit-transition:opacity 1s ease 1s;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;-webkit-transition:opacity .05s;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none), (pointer:coarse){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}:host {
    position: relative;
    display: block;
    height: 100%;
}#map {
    width: 100%;
    height: 100%;
}slot:not([name]) {
    display: none;
}/* OVERWRITE SOME MAPBOX DEFAULT STYLES */#map .maplibregl-popup {
    will-change: auto;
    max-width: 90vw !important;
    width: 320px;
}#map .maplibregl-popup-content {
    padding: 0;
}#map .geocoder__custom-icon {
    height: var(--toujou-location-finder-geocoder-icon-height, 2rem);
    width: var(--toujou-location-finder-geocoder-icon-width, 2rem);
    background-color: var(--toujou-location-finder-geocoder-icon-color, var(--primary-color));
    mask-size: contain;
    -webkit-mask-size: contain;
    mask-position: center;
    -webkit-mask-position: center;
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    mask-image: var(--toujou-location-finder-geocoder-icon-image);
    -webkit-mask-image: var(--toujou-location-finder-geocoder-icon-image);
}#map .maplibregl-control-container {
    display: var(--toujou-map-control-container-display, inherit);
}#map .maplibregl-ctrl-top-left {
    display: var(--toujou-map-ctrl-top-left-display, inherit);
}#map .maplibregl-ctrl-top-right {
    display: var(--toujou-map-ctrl-top-right-display, inherit);
}#map .maplibregl-ctrl-bottom-left {
    display: var(--toujou-map-ctrl-bottom-left-display, inherit);
}#map .maplibregl-ctrl-bottom-right {
    display: var(--toujou-map-ctrl-bottom-right-display, inherit);
}
`])));const m0={transformStyle:(b,f)=>({...f,layers:[...f.layers.map(s=>{try{if(!Object.prototype.hasOwnProperty.call(s,"filter"))return s;const E=s.filter;return Array.isArray(E[1])&&E[1][0]==="pitch"?(delete s.filter,s):{...s,filter:s.filter.filter(R=>!Array.isArray(R[1])||R[1][0]!=="pitch")}}catch{return s}})]})};let g0=class extends mi{static get is(){return"toujou-map"}static get styles(){return eb}render(){return pi`
      <div id="map"></div>
      <slot @toujou-map-element-attached="${this.updateMapElements}"
            @toujou-map-layer-added="${this.onLayerAdded}"
            @toujou-map-layer-removed="${this.onLayerRemoved}"
            @slotchange="${this.updateMapElements}"></slot>
    `}static get properties(){return{mapboxStyles:{type:String},interactive:{type:Boolean},fullscreenControl:{type:Boolean,attribute:"fullscreen-control"},reducedMotion:{type:Boolean,attribute:"reduced-motion"},noNavigation:{type:Boolean,attribute:"no-navigation"},accessToken:{type:String,attribute:"access-token"},center:{type:Array},zoom:{type:Number},maxZoom:{type:Number},fitBoundsMaxZoom:{type:Number,attribute:"fit-bounds-max-zoom"},minZoom:{type:Number},pitch:{type:Number},bearing:{type:Number},mapStyle:{type:String,attribute:"map-style"},loaded:{type:Boolean},zoomOnScroll:{type:Boolean,attribute:"zoom-on-scroll"},initialBounds:{type:Array,attribute:"initial-bounds"},mapPadding:{type:Object,attribute:"map-padding"},layers:{type:Array}}}constructor(){super(),this.accessToken=null,this.initialMapOptions={style:"mapbox://styles/mapbox/light-v10",minZoom:0,maxZoom:20,pitch:0,bearing:0,attributionControl:!1},this.initialControls={noNavigation:!1},this.targets=[],this.markers=[],this.zoomOnScroll=!1,this.mapPadding={top:16,bottom:16,left:16,right:16},this.fullscreenControl=!1,this.reducedMotion=!1,this.layers=[],this.reorderLayers=this.reorderLayers.bind(this)}set mapStyle(f){this.map&&this.map.setStyle(f,m0),this.initialMapOptions.style=f}get mapStyle(){return this.map?this.map.getStyle():this.initialMapOptions.style}set center(f){this.map&&this.map.setCenter(f),this.initialMapOptions.center=f}get center(){return this.map?this.map.getCenter():this.initialMapOptions.center}set zoom(f){this.map&&this.map.setZoom(f),this.initialMapOptions.zoom=f}get zoom(){return this.map?this.map.getZoom():this.initialMapOptions.zoom}set pitch(f){this.map&&this.map.setPitch(f),this.initialMapOptions.pitch=f}get pitch(){return this.map?this.map.getPitch():this.initialMapOptions.pitch}set bearing(f){this.map&&this.map.setBearing(f),this.initialMapOptions.bearing=f}get bearing(){return this.map?this.map.getBearing():this.initialMapOptions.bearing}set noNavigation(f){this.map||(this.initialControls={...this.initialControls,noNavigation:!!f}),f?f&&this._navigationControl&&this.map.removeControl(this._navigationControl):(!this._navigationControl&&(this._navigationControl=new da.NavigationControl),this.map.addControl(this._navigationControl))}get noNavigation(){return this.map?!!this._navigationControl:this.initialControls.noNavigation}set interactive(f){this.initialMapOptions.interactive=!!f}get interactive(){return this.initialMapOptions.interactive}set maxZoom(f){this.map&&this.map.setMaxZoom(f),this.initialMapOptions.maxZoom=f}get maxZoom(){return this.map?this.map.getMaxZoom():this.initialMapOptions.maxZoom}set minZoom(f){this.map&&this.map.setMinZoom(f),this.initialMapOptions.minZoom=f}get minZoom(){return this.map?this.map.getMinZoom():this.initialMapOptions.minZoom}get stylesCompatibleWithMapboxLanguage(){return this.initialMapOptions&&this.initialMapOptions.style&&this.initialMapOptions.style.startsWith("mapbox://")}connectedCallback(){super.connectedCallback(),window.maplibregl=da,this.loaded=!0}updated(f){f.has("loaded")&&this.loaded&&!this.map&&this.createMap(),f.has("layers")&&this.reorderLayers()}createMap(){this.map=new da.Map({container:this.shadowRoot.querySelector("#map"),...this.initialMapOptions,style:null,transformRequest:(f,s)=>Yv(f)?Xv(f,s,this.accessToken):{url:f}}),this.map.setStyle(this.initialMapOptions.style,m0),this.fullscreenControl&&this.map.addControl(new da.FullscreenControl),this.map.addControl(new da.AttributionControl({compact:!0})),Object.keys(this.initialControls).forEach(f=>{this[f]=this.initialControls[f]}),this.zoomOnScroll?this.map.scrollZoom.enable():this.map.scrollZoom.disable(),this.map.setPadding(this.mapPadding),this.initialBounds&&this.map.fitBounds(this.initialBounds,{maxZoom:this.fitBoundsMaxZoom||22,animate:!this.reducedMotion}),this.map.on("load",f=>{if(this.stylesCompatibleWithMapboxLanguage){const s=document.documentElement.lang.slice(0,2)||"de";this.map.getStyle().layers.map(E=>E.id).filter(E=>/label$/.test(E)).forEach(E=>{try{const R=this.map.getLayoutProperty(E,"text-field");this.map.setLayoutProperty(E,"text-field",((G,S)=>(G[0]==="coalesce"&&G.splice(1,0,["get",`name_${S}`]),G))(R,s))}catch(R){console.warn(R)}})}this.dispatchEvent(new CustomEvent("toujou-map-loaded",{detail:f}))}),this.map.on("error",f=>{this.dispatchEvent(new CustomEvent("toujou-map-error",{detail:f})),console.error(f)}),this.map.once("load",()=>this.map.resize()),this.map.on("sourcedata",()=>{this.dispatchEvent(new CustomEvent("toujou-map-source-data-loaded",{bubbles:!0,composed:!0}))}),this.updateMapElements(),this.dispatchEvent(new CustomEvent("toujou-map-ready",{bubbles:!0,composed:!0,detail:this.map}))}updateMapElements(){const f=this.shadowRoot.querySelector("slot").assignedNodes({flatten:!0}).filter(s=>s.nodeName.slice(0,10)==="TOUJOU-MAP");this.markers=f.filter(s=>s.nodeName==="TOUJOU-MAP-MARKER"),this.map&&f.forEach(s=>{s.map=this.map})}onLayerAdded(f){this.layers=this.layers.concat([f.detail])}onLayerRemoved(f){this.layers=this.layers.filter(s=>s.id!==f.detail.id)}reorderLayers(){this.layers.forEach(f=>{f.id&&f.metadata&&f.metadata.beforeLayerId&&this.map.getLayer(f.metadata.beforeLayerId)&&this.map.moveLayer(f.id,f.metadata.beforeLayerId)})}};customElements.define(g0.is,g0);let _0=class extends Uf{static get is(){return"toujou-map-geojson"}static get properties(){return{sourceId:{type:String,attribute:"source-id"},sourceData:{type:Object,attribute:"source-data"},sourceUrl:{type:String,attribute:"source-url"},maxZoom:{type:Number,attribute:"max-zoom"},buffer:{type:Number},tolerance:{type:Number},cluster:{type:Boolean},clusterRadius:{type:Number,attribute:"cluster-radius"},clusterMaxZoom:{type:Number,attribute:"cluster-max-zoom"}}}set map(f){f!==this._map&&(this._map&&this.removeSource(),this._map=f,f&&(this.map.isStyleLoaded()?this.initSource():this.map.once("load",()=>this.initSource())))}get map(){return this._map}set sourceData(f){this.source&&this.source.setData(f),this.data=f}get sourceData(){return typeof this.data=="object"?this.data:null}set sourceUrl(f){this.source&&this.source.setData(f),this.data=f}get sourceUrl(){return typeof this.data=="string"?this.data:null}get clusterConf(){return this.cluster?{cluster:!0,clusterRadius:this.clusterRadius,clusterMaxZoom:this.clusterMaxZoom||this.maxZoom-1}:{}}constructor(){super(),this.maxZoom=18,this.buffer=128,this.tolerance=.375,this.clusterRadius=50,this.clusterMaxZoom=null,this._map=null,this.source=null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new CustomEvent("toujou-map-element-attached",{detail:this,bubbles:!0,composed:!0}))}disconnectedCallback(){super.disconnectedCallback(),this.map&&this.removeSource()}initSource(){this.map.addSource(this.sourceId,{type:"geojson",data:this.data,maxzoom:this.maxZoom,buffer:this.buffer,tolerance:this.tolerance,...this.clusterConf}),this.source=this.map.getSource(this.sourceId)}removeSource(){this.map.getSource(this.sourceId)&&this.map.removeSource(this.sourceId)}};customElements.define(_0.is,_0);let y0=class extends Uf{static get is(){return"toujou-map-layer"}static get properties(){return{layerId:{type:String,attribute:"layer-id"},source:{type:String},sourceLayer:{type:String,attribute:"source-layer"},type:{type:String},minzoom:{type:Number},maxzoom:{type:Number,attribute:"maxzoom"},filter:{type:Array},layout:{type:Object},paint:{type:Object},beforeLayerId:{type:String}}}set map(f){f!==this._map&&(this._map&&this.removeLayer(),this._map=f,f&&this.initLayer())}get map(){return this._map}get layerConf(){const f={id:this.layerId,source:this.source,type:this.type,minzoom:this.minzoom,maxzoom:this.maxzoom,metadata:{beforeLayerId:this.beforeLayerId}};return this.filter&&this.filter.length>0&&(f.filter=this.filter),this.layout&&(f.layout=this.layout),this.paint&&(f.paint=this.paint),f}constructor(){super(),this.minzoom=0,this.maxzoom=24,this.initLayer=this.initLayer.bind(this),this.initWhenSourceIsAvailable=this.initWhenSourceIsAvailable.bind(this)}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new CustomEvent("toujou-map-element-attached",{detail:this,bubbles:!0,composed:!0}))}disconnectedCallback(){super.disconnectedCallback(),this.map&&this.removeLayer()}initLayer(){if(!this.map.style)return this.map.once("load",this.initLayer);this.map.getSource(this.source)?(this.map.addLayer(this.layerConf),this.dispatchEvent(new CustomEvent("toujou-map-layer-added",{detail:this.layerConf,bubbles:!0,composed:!0})),this.layer=this.map.getLayer(this.layerId)):this.map.on("sourcedata",this.initWhenSourceIsAvailable)}initWhenSourceIsAvailable(f){f.sourceId===this.source&&(this.map.off("sourcedata",this.initWhenSourceIsAvailable),this.initLayer())}removeLayer(){this.map.getLayer(this.layerId)&&(this.dispatchEvent(new CustomEvent("toujou-map-layer-removed",{detail:this.layerConf,bubbles:!0,composed:!0})),this.map.removeLayer(this.layerId))}};customElements.define(y0.is,y0);let Xp=class extends mi{constructor(){super(...arguments),this.initialMarkerOptions={element:null,offset:[0,0],color:"#77b800"},this._lngLat=[0,0]}static get is(){return"toujou-map-marker"}static get styles(){return bn`
        :host {
          display: block;
          padding: 0;
        }
    `}render(){return pi`<slot></slot>`}static get properties(){return{coordinates:{type:Array},color:{type:String},offset:{type:Array}}}set map(f){f!==this._map&&(this._map=f,f?this.initMarker(f):this.marker&&this.marker.remove())}get map(){return this._map}set color(f){this.initialMarkerOptions.color=f}get color(){return this.initialMarkerOptions.color}set coordinates(f){this.marker&&this.marker.setLngLat(f),this._lngLat=f}get coordinates(){return this.marker?this.marker.getLngLat():this._lngLat}set element(f){this.initialMarkerOptions.element=f}get element(){return this.marker?this.marker.getElement():this.initialMarkerOptions.element}setElementToAssignedElementIfNotSet(){this.element===null&&this.markerElements!==null&&this.markerElements.length>0&&(this.element=this.markerElements[0])}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new CustomEvent("toujou-map-element-attached",{detail:this,bubbles:!0,composed:!0}))}disconnectedCallback(){super.disconnectedCallback(),this.marker&&this.marker.remove()}initMarker(f){setTimeout(()=>{this.setElementToAssignedElementIfNotSet(),this.marker=new da.Marker(this.initialMarkerOptions).setLngLat(this._lngLat),!this._element&&(this.marker.getElement().style.position="absolute"),this.marker.addTo(f)})}};var v0;Bt([zv()],Xp.prototype,"markerElements",void 0),customElements.define(Xp.is,Xp);var tb=bn(v0||(v0=k_([`:host {
    display: block;
    max-width: var(--toujou-map-popup-max-width, 100%);
    width: var(--toujou-map-popup-width, 320px);
}

@media screen and (max-width: 479px) {
    :host {
        width: var(--toujou-map-popup-width, 240px);
    }
}
`])));let b0=class extends mi{static get is(){return"toujou-map-popup"}static get styles(){return tb}render(){return pi`<slot></slot>`}static get properties(){return{coordinates:{type:Array},closeButton:{type:Boolean,attribute:"close-button"},closeOnOutsideClick:{type:Boolean,attribute:"close-on-outside-click"}}}set map(f){f!==this._map&&(this._map=f,f?this.initPopup():this.popup&&this.popup.remove())}get map(){return this._map}set marker(f){f!==this._marker&&(this._marker=f,f?this.initPopup():this.popup&&this.popup.remove())}get marker(){return this._marker}set coordinates(f){this.popup&&this.popup.setLngLat(f),this._lngLat=f}get coordinates(){return this.popup?this.popup.getLngLat():this._lngLat}set closeButton(f){this.initialPopupOptions.closeButton=!!f}get closeButton(){return this.initialPopupOptions.closeButton}set closeOnOutsideClick(f){this.initialPopupOptions.closeOnClick=!!f}get closeOnOutsideClick(){return this.initialPopupOptions.closeOnClick}constructor(){super(),this.initialPopupOptions={closeButton:!1,closeOnClick:!1},this.popupSlotName=`popup-${function(f){let s="";const E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",R=E.length;for(let G=0;G<f;G++)s+=E.charAt(Math.floor(Math.random()*R));return s}(6)}`,this._lngLat=[0,0],this.forwardPopupEvent=this.forwardPopupEvent.bind(this)}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new CustomEvent("toujou-map-element-attached",{detail:this,bubbles:!0,composed:!0}))}disconnectedCallback(){super.disconnectedCallback(),this.popup&&this.popup.remove()}initPopup(){this.popup=new da.Popup(this.initialPopupOptions),this.popup.setLngLat(this._lngLat),this.popup.on("open",this.forwardPopupEvent),this.popup.on("close",this.forwardPopupEvent),this.transferToPopupSlot(),this.map?this.popup.addTo(this.map):this.marker?this.marker.setPopup(this.popup):console.error("toujou-map-popup could not be added to a map or marker")}forwardPopupEvent(f){switch(f.type){case"open":this.dispatchEvent(new CustomEvent("toujou-map-popup-opened",{detail:this.popup,bubbles:!0,composed:!0}));break;case"close":this.dispatchEvent(new CustomEvent("toujou-map-popup-closed",{detail:this.popup,bubbles:!0,composed:!0}))}}transferToPopupSlot(){const f=document.createElement("slot");f.name=this.popupSlotName,this.popup.setDOMContent(f),this.slot=this.popupSlotName,window.ShadyCSS&&window.ShadyCSS.styleElement(this)}};customElements.define(b0.is,b0);let x0=class extends Uf{static get is(){return"toujou-map-spiderfy"}static get properties(){return{sourceId:{type:String,attribute:"source-id"},source:{type:String},leavesSeparation:{type:Number},leavesOffset:{type:Array},minZoom:{type:Number},zoomIncrement:{type:Number},selectedCluster:{type:Object},selectedClusterFeatures:{type:Array}}}set map(f){f!==this._map&&(this._map&&this.removeSource(),this._map=f,f&&(this.map.isStyleLoaded()?this.initSource():this.map.once("load",()=>this.initSource())))}get map(){return this._map}constructor(){super(),this.data=null,this.source=null,this.leavesSeparation=50,this.leavesOffset=[0,0],this.minZoom=0,this.zoomIncrement=2,this.selectedCluster=null,this.selectedClusterFeatures=[],this.handleClusterSelection=this.handleClusterSelection.bind(this),this.renderFeatures=this.renderFeatures.bind(this)}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new CustomEvent("toujou-map-element-attached",{detail:this,bubbles:!0,composed:!0}))}disconnectedCallback(){super.disconnectedCallback(),this.map&&this.removeSource(),this.selectedCluster=null,this.selectedClusterFeatures=[]}updated(f){f.has("selectedClusterFeatures")&&this.spiderfySource&&this.renderFeatures()}initSource(){this.map.addSource(this.sourceId,{type:"geojson",data:this.data}),this.spiderfySource=this.map.getSource(this.sourceId),this.map.on("click",this.handleClusterSelection),this.map.on("zoomend",this.renderFeatures)}removeSource(){this.map.getSource(this.sourceId)&&this.map.removeSource(this.sourceId)}handleClusterSelection(f){const s=this.map.queryRenderedFeatures(f.point),E=s.find(R=>R.properties&&R.properties.cluster&&R.source===this.source);if(!s.find(R=>R.properties&&!R.properties.cluster&&R.source===this.sourceId))return E?void(this.map.getZoom()<this.minZoom?this.map.flyTo({center:f.lngLat,zoom:this.map.getZoom()+this.zoomIncrement}):(this.selectedCluster=E,this.map.getSource(this.source).getClusterLeaves(E.properties.cluster_id,99,0,(R,G)=>{this.selectedClusterFeatures=(G||[]).filter(S=>S.geometry.type==="Point")}))):(this.selectedCluster=null,void(this.selectedClusterFeatures=[]))}renderFeatures(){const f=this.selectedClusterFeatures.length?this.calculatePointsInCircle(this.selectedClusterFeatures.length):[],s=this.selectedCluster?this.map.project(this.selectedCluster.geometry.coordinates):null,E=[],R=this.selectedClusterFeatures.map((G,S)=>{const l=G,ae=this.map.unproject(s.add(f[S]));return l.geometry.coordinates=ae.toArray(),E.push({type:"Feature",geometry:{type:"LineString",coordinates:[this.selectedCluster.geometry.coordinates,l.geometry.coordinates]}}),l});this.spiderfySource.setData({type:"FeatureCollection",features:R.concat(E)})}calculatePointsInCircle(f){const s=[],E=2*Math.PI/f;let R=E;for(let G=0;G<f;G+=1){R=E*G;const S=this.leavesSeparation*Math.cos(R)+this.leavesOffset[0],l=this.leavesSeparation*Math.sin(R)+this.leavesOffset[1];s.push(new da.Point(S,l))}return s}};customElements.define(x0.is,x0);let w0=class P_ extends mi{static get is(){return"toujou-map-static"}static get styles(){return bn`
      :host {
        display: inline-block;
        overflow: hidden;
        position: relative;
      }
      #img {
        position: absolute;
        top: 0px;
        right: 0px;
        bottom: 0px;
        left: 0px;
      }
    `}render(){return pi`
      <img id="img" src="${this.mapSource}" alt="Map Image">
      <slot @toujou-map-element-attached="${this.updateMapElements}" @slotchange="${this.updateMapElements}"></slot>
    `}static get properties(){return{accessToken:{type:String,attribute:"access-token"},mapStyle:{type:String,attribute:"map-style"},username:{type:String},styleId:{type:String,attribute:"style-id"},overlay:{type:String},center:{type:Array},zoom:{type:Number},pitch:{type:Number},bearing:{type:Number},auto:{type:Boolean},width:{type:Number},height:{type:Number},markers:{type:Array},slotRendered:{type:Boolean}}}get mapStyleParts(){return this.mapStyle.replace(/^mapbox:\/\/styles\//,"")}get renderedOverlay(){const f=this.markers.map(P_.renderMarker);return this.overlay&&f.push(this.overlay),f.join(",")}get mapSource(){if(!this.slotRendered)return"";const f=["https://api.mapbox.com","styles","v1",this.mapStyleParts,"static"],{renderedOverlay:s}=this;return s&&f.push(s),this.auto?f.push("auto"):f.push(this.center.concat([this.zoom,this.bearing,this.pitch]).join(",")),f.push(`${this.width}x${this.height}`),`${f.join("/")}?access_token=${this.accessToken}`}set width(f){this.style.width=isNaN(f)?f:`${f}px`}get width(){return this.style.width.replace(/px$/,"")}set height(f){this.style.height=isNaN(f)?f:`${f}px`}get height(){return this.style.height.replace(/px$/,"")}constructor(){super(),this.accessToken="pk.eyJ1IjoiZml0cmVpc2VuIiwiYSI6ImNqdHppeXlkMDBiazk0M3QxZDFpNGNqYmgifQ.f6VsL4UgB13NPCXv9-vJGQ",this.mapStyle="mapbox://styles/mapbox/light-v10",this.center=[0,0],this.overlay="",this.zoom=8,this.pitch=0,this.bearing=0,this.auto=!1,this.markers=[],this.slotRendered=!1,this.width=300,this.height=200}firstUpdated(){this.slotRendered=!!this.shadowRoot.querySelector("slot")}updateMapElements(){const f=this.shadowRoot.querySelector("slot").assignedNodes({flatten:!0}).filter(s=>s.nodeName.slice(0,10)==="TOUJOU-MAP");this.markers=f.filter(s=>s.nodeName==="TOUJOU-MAP-MARKER")}static renderMarker(f){const s={name:"pin-l",label:"",color:"77b800",coordinates:[0,0]};return customElements.get(f.nodeName)?(s.color=f.color||s.color,s.coordinates=f.coordinates||s.coordinates):(s.color=(f.hasAttribute("color")?f.getAttribute("color"):"")||s.color,s.coordinates=(f.hasAttribute("coordinates")?JSON.parse(f.getAttribute("coordinates")):null)||s.coordinates),`${s.name}${s.color?`+${s.color.replace(/^#/,"")}`:""}(${s.coordinates.join(",")})`}};customElements.define(w0.is,w0);var S0,Kp,Jp,ib=bn(S0||(Kp=[` .open-button {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
  }

  :host([open]) .open-button {
    display: none;
  }

  .close-button {
    display: none;
  }

  :host([open]) .close-button {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
  }
`],Jp||(Jp=Kp.slice(0)),S0=Object.freeze(Object.defineProperties(Kp,{raw:{value:Object.freeze(Jp)}}))));let Nh=class extends mi{constructor(){super(...arguments),this.isOpen=!1,this.isOpenParentAttribute="media-info-child-is-open",this._handleClick=f=>{f.preventDefault(),f.stopPropagation()},this.handleToggleClick=()=>{this.isOpen=!this.isOpen}}render(){return pi`
            <slot name="open-button" class="open-button"  @click="${this.handleToggleClick}"></slot>
            <slot name="close-button" class="close-button" @click="${this.handleToggleClick}"></slot>
            <slot name="figcaption"></slot>
            <slot name="copyright"></slot>
        `}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this._handleClick)}updated(f){var s,E;f.has("isOpen")&&(this.isOpen?(s=this.parentElement)===null||s===void 0||s.setAttribute(this.isOpenParentAttribute,""):(E=this.parentElement)===null||E===void 0||E.removeAttribute(this.isOpenParentAttribute))}};Nh.styles=[ib],Bt([vt({type:Boolean,reflect:!0,attribute:"open"})],Nh.prototype,"isOpen",void 0),Nh=Bt([Ln("toujou-media-info")],Nh);var C0,Qp,ef,nb=bn(C0||(Qp=[`* {
    -webkit-box-sizing: border-box;
            box-sizing: border-box;
}

:host {
    --toujou-spinner-size: 5rem;
    --toujou-spinner-thickness: 4;
    --toujou-spinner-start-color: var(--primary-color--light);
    --toujou-spinner-end-color: var(--primary-color--dark);
    --toujou-spinner-animation-duration: 2s;
    --toujou-spinner-dash-animation-duration: 1.4s;
    --toujou-spinner-display: inline-flex;

    width: var(--toujou-spinner-size);
    height: var(--toujou-spinner-size);
    position: relative;
    display: var(--toujou-spinner-display);
    -webkit-box-align: center;
        -ms-flex-align: center;
            align-items: center;
    -webkit-box-pack: center;
        -ms-flex-pack: center;
            justify-content: center;
}

:host([centered-on-page]) {
    position: fixed;
    top: 50%;
    left: 50%;
    -webkit-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
    z-index: 100;
}

.toujou-spinner__spinner::before {
    content: '';
    display: block;
    padding-top: 100%;
}

.toujou-spinner__svg {
    -webkit-animation: rotationAnimation var(--toujou-spinner-animation-duration) linear infinite;
            animation: rotationAnimation var(--toujou-spinner-animation-duration) linear infinite;
    height: 100%;
    -webkit-transform-origin: center center;
            transform-origin: center center;
    width: 100%;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;
}

.toujou-spinner__circle {
    stroke-dasharray: 1, 200;
    stroke-dashoffset: 0;
    -webkit-animation: dashAnimation var(--toujou-spinner-dash-animation-duration) ease-in-out infinite,
               colorAnimation var(--toujou-spinner-dash-animation-duration) ease-in-out infinite;
            animation: dashAnimation var(--toujou-spinner-dash-animation-duration) ease-in-out infinite,
               colorAnimation var(--toujou-spinner-dash-animation-duration) ease-in-out infinite;
    stroke-linecap: round;
    stroke-width: var(--toujou-spinner-thickness);
    fill: none;
}

@-webkit-keyframes rotationAnimation {
    100% {
        -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
    }
}

@keyframes rotationAnimation {
    100% {
        -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
    }
}

@-webkit-keyframes dashAnimation {
    0% {
        stroke-dasharray: 1, 200;
        stroke-dashoffset: 0;
    }
    50% {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: -35px;
    }
    100% {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: -124px;
    }
}

@keyframes dashAnimation {
    0% {
        stroke-dasharray: 1, 200;
        stroke-dashoffset: 0;
    }
    50% {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: -35px;
    }
    100% {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: -124px;
    }
}

@-webkit-keyframes colorAnimation {
    0%, 20% {
        stroke: var(--toujou-spinner-start-color);
    }
    80%, 100% {
        stroke: var(--toujou-spinner-end-color);
    }
}

@keyframes colorAnimation {
    0%, 20% {
        stroke: var(--toujou-spinner-start-color);
    }
    80%, 100% {
        stroke: var(--toujou-spinner-end-color);
    }
}
`],ef||(ef=Qp.slice(0)),C0=Object.freeze(Object.defineProperties(Qp,{raw:{value:Object.freeze(ef)}}))));let T0=class extends mi{static get is(){return"toujou-spinner"}static get styles(){return nb}render(){return pi`
      <svg class="toujou-spinner__svg" viewBox="25 25 50 50">
        <circle class="toujou-spinner__circle" cx="50" cy="50" r="20" stroke-miterlimit="10"/>
      </svg>
    `}};customElements.define(T0.is,T0);let Zc=class extends mi{constructor(){super(...arguments),this.rating=0,this.total=5,this.suffix=""}createRenderRoot(){return this}render(){const f=[];for(let s=0;s<this.total;s++){let E=0;this.rating>=s+1?E=100:this.rating>s&&(E=Math.round(100*(this.rating-s))),f.push(pi`
        <span class="rating-stars__star" aria-hidden="true" star-value="${E}"></span>
      `)}return pi`
      ${f}
      ${this.suffix.length?pi`<span class="rating-stars__suffix" aria-hidden="true">${this.suffix}</span>`:""}
    `}};Bt([vt({type:Number,attribute:"rating-value"})],Zc.prototype,"rating",void 0),Bt([vt({type:Number,attribute:"rating-total"})],Zc.prototype,"total",void 0),Bt([vt({type:String,attribute:"rating-suffix"})],Zc.prototype,"suffix",void 0),Zc=Bt([Ln("toujou-rating-stars")],Zc);var E0,tf,nf,rb=bn(E0||(tf=[`:host {
    background-color: var(--toujou-snackbar-bg-color, #2c2c2c);
    border: var(--toujou-snackbar-border, 1px solid var(--bg-color));
    display: var(--toujou-snackbar-display, flex);
    width: var(--toujou-snackbar-width, calc(100% - 2rem));
    max-width: var(--toujou-snackbar-max-width, 640px);
    position: var(--toujou-snackbar-position, fixed);
    bottom: var(--toujou-snackbar-bottom, 1rem);
    left: var(--toujou-snackbar-left, 1rem);
    padding: var(--toujou-snackbar-padding, 1rem);
    border-radius: var(--toujou-snackbar-border-radius, .25rem);
    z-index: var(--toujou-snackbar-z-index, 100);
    -webkit-transform: var(--toujou-snackbar-transform, translateY(calc(100% + 1rem)));
            transform: var(--toujou-snackbar-transform, translateY(calc(100% + 1rem)));
    opacity: var(--toujou-snackbar-opacity, 0);
    -webkit-transition: var(--toujou-snackbar-transition, all .25s ease-out);
    transition: var(--toujou-snackbar-transition, all .25s ease-out);
}

:host([visible]) {
    -webkit-transform: var(--toujou-snackbar-visible-transform, translateY(0));
            transform: var(--toujou-snackbar-visible-transform, translateY(0));
    opacity: var(--toujou-snackbar-visible-opacity, 1);
}

:host(:focus-visible) {
    outline: var(--toujou-snackbar-focus-outline);
    outline-offset: var(--toujou-snackbar-focus-outline-offset);
}

.snackbar__message {
    -webkit-box-flex: var(--toujou-snackbar-message-grow, 1);
        -ms-flex-positive: var(--toujou-snackbar-message-grow, 1);
            flex-grow: var(--toujou-snackbar-message-grow, 1);
    color: var(--toujou-snackbar-message-color, white);
    margin: var(--toujou-snackbar-message-margin, 0);
    padding: var(--toujou-snackbar-message-padding, 0 1rem 0 0);
}

.snackbar__button {
    border: var(--toujou-snackbar-button-border, none);
    background: var(--toujou-snackbar-button-bg, none);
    font-size: var(--toujou-snackbar-button-font-size, .875rem);
    font-family: var(--toujou-snackbar-button-font-family, var(--paragraph__family));
    text-transform: var(--toujou-snackbar-button--text-transform, uppercase);
    color: var(--toujou-snackbar-button-color, var(--primary-color));
    margin: var(--toujou-snackbar-button-margin, 0);
    outline: var(--toujou-snackbar-button-outline, none);
}

.snackbar__button:hover {
    cursor: var(--toujou-snackbar-button-hover-cursor, pointer);
    opacity: var(--toujou-snackbar-button-hover-opacity, .75);
}

:host([snackbartype='auto']) .snackbar__button {
    display: none;
}

/* VARIANT SUCCESS */

:host([success]) {
    border: var(--toujou-snackbar-success-border, 1px solid var(--success-color));
}

:host([success]) .snackbar__message {
    color: var(--toujou-snackbar-success-message-color, var(--success-color));
}

:host([success]) .snackbar__button {
    color: var(--toujou-snackbar-success-button-color, white);
}

/* VARIANT WARNING */

:host([warning]) {
    border: var(--toujou-snackbar-warning-border, 1px solid var(--warning-color));
}

:host([warning]) .snackbar__message {
    color: var(--toujou-snackbar-warning-message-color, var(--warning-color));
}

:host([warning]) .snackbar__button {
    color: var(--toujou-snackbar-warning-button-color, white);
}

/* VARIANT ERROR */

:host([error]) {
    border: var(--toujou-snackbar-error-border, 1px solid var(--error-color));
}

:host([error]) .snackbar__message {
    color: var(--toujou-snackbar-error-message-color, var(--error-color));
}

:host([error]) .snackbar__button {
    color: var(--toujou-snackbar-error-button-color, white);
}

/* VARIANT INFO */

:host([info]) {
    border: var(--toujou-snackbar-info-border, 1px solid #81d4fa);
}

:host([info]) .snackbar__message {
    color: var(--toujou-snackbar-info-message-color, #81d4fa);
}

:host([info]) .snackbar__button {
    color: var(--toujou-snackbar-info-button-color, white);
}
`],nf||(nf=tf.slice(0)),E0=Object.freeze(Object.defineProperties(tf,{raw:{value:Object.freeze(nf)}}))));let M0=class extends mi{static get is(){return"toujou-snackbar"}render(){return pi`
      <p class="snackbar__message">${this.message}</p>
      <button
        class="snackbar__button"
        @click="${this._handleButtonClick}"
        aria-label="${this.buttonAriaLabel}"
      >${this.buttonText}</button>
    `}static get styles(){return[rb]}static get properties(){return{showing:{type:Boolean},cue:{type:Array},message:{type:String},buttonText:{type:String},snackbarType:{type:String},buttonAriaLabel:{type:String,attribute:"button-aria-label"}}}set showing(f){f?(this.setAttribute("visible",""),this.setAttribute("tabindex","0"),this.focus()):(this.removeAttribute("visible"),this.setAttribute("tabindex","-1"),this.blur())}set snackbarType(f){this.setAttribute("snackbarType",f)}set variant(f){this.setAttribute(f,"")}constructor(){super(),this.keyCodes={escape:27,enter:13},this.cue=[],this._animationStart=null,this._possibleVariants=["success","warning","error","info"],this.buttonAriaLabel="Close the snackbar",window.addEventListener("toujou-add-snackbar",()=>{this._removeHiddenState()},{once:!0}),window.addEventListener("toujou-add-snackbar",f=>{this._handleAddSnackbar(f)})}connectedCallback(){super.connectedCallback(),this.showing=!1,this._timer=this._timer.bind(this),this.addEventListener("keydown",this._handleKeyDown.bind(this))}updated(f){f.has("cue")&&this.cue.length>0?this._showSnackbar():f.has("cue")&&this.cue.length>1&&this.cue[0].type==="auto"?this._checkAutoReplacement():f.has("cue")&&this.cue.length===0&&this._resetVisibleValues()}_handleAddSnackbar(f){this.cue=[...this.cue,f.detail]}_checkAutoReplacement(){this.cue.length>1&&this.cue[0].type==="auto"&&(this._wasReplaced=!0)}_handleButtonClick(){this._hideSnackbar()}_hideSnackbar(){this.showing=!1,this.addEventListener("transitionend",this._afterHide)}_afterHide(){this._removeSnackbarFromCue(),this._removeSnackbarVariantAttribute(),this.removeEventListener("transitionend",this._afterHide)}_removeSnackbarFromCue(){this.cue=this.cue.slice(1)}_removeSnackbarVariantAttribute(){this._possibleVariants.forEach(f=>{this.hasAttribute(f)&&this.removeAttribute(f)})}_resetVisibleValues(){this.message=null,this.buttonText=null}_showSnackbar(){setTimeout(()=>{this._setSnackbarValues(this.cue[0]),this.cue[0].type==="auto"&&(this._animationStart=Date.now(),this._timer()),this.showing=!0,this.snackbarType=this.cue[0].type})}_removeHiddenState(){this.removeAttribute("hidden")}_timer(){const f=Date.now();if(this._wasReplaced)return this._removeSnackbarFromCue(),this._wasReplaced=!1,void cancelAnimationFrame(this._animationRequest);f-this._animationStart>=this._duration?(this._hideSnackbar(),cancelAnimationFrame(this._animationRequest)):this._animationRequest=requestAnimationFrame(this._timer)}_setSnackbarValues(f){f.message&&(this.message=f.message),f.variant&&this._possibleVariants.includes(f.variant)&&(this.variant=f.variant),this.buttonText=f.buttonText||"OK",this._duration=f.duration||2500}_handleKeyDown(f){this.getAttribute("snackbartype")!=="auto"&&(f.key!=="Escape"&&f.keyCode!==this.keyCodes.escape&&f.key!=="Enter"&&f.keyCode!==this.keyCodes.enter||(this._hideSnackbar(),this._afterHide()))}};customElements.define(M0.is,M0);const If="toujou-timeline-new-observation",I_="toujou-timeline-legend-year-click";let k0=class extends mi{constructor(){super(...arguments),this._checkForLocationHash=()=>{const f=window.location.hash;f&&this.querySelector(`${f}`)&&(this._timelineContainerEl.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),this._scrollToYear(f.substring(1)))}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this._init()}_init(){if(this._years=this.querySelectorAll(".timeline-item__year"),!this._years)return;this._timelineContainerEl=this.querySelector(".timeline__container"),this._isHorizontalTimeline=this.getAttribute("timeline-direction")==="horizontal",this._isHorizontalTimeline&&this._checkForLocationHash();const f={rootMargin:"-100px -100px -100px -100px",threshold:this._createThresholdList(50)};this.observer=new IntersectionObserver(this._handleObserver.bind(this),f),this._years.forEach(s=>{this.observer.observe(s)}),this.dispatchEvent(new CustomEvent("toujou-timeline-ready",{bubbles:!0,composed:!0,detail:this})),this.addEventListener(I_,this._onLegendYearClick)}_handleObserver(f){const s=[];f.forEach(E=>{const R=E.target.id;R&&(s.push({yearId:R,isIntersecting:E.isIntersecting}),this.dispatchEvent(new CustomEvent(If,{bubbles:!0,composed:!0,detail:s})))})}_createThresholdList(f){return[...Array(f).keys()].map(s=>s/f)}_onLegendYearClick(f){const s=f.detail;s&&this._scrollToYear(s)}_scrollToYear(f){const s=this.querySelector(`#${f}`);if(!s)return;const E=s.closest(".timeline-item");if(!E)return;const R=E.offsetLeft;this._timelineContainerEl.scrollTo({left:R,behavior:"smooth"})}};k0=Bt([Ln("toujou-timeline")],k0);let P0=class extends mi{constructor(){super(...arguments),this.isActiveAttribute="is-active"}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this._yearLinks=this.querySelectorAll(".timeline-legend__link"),this._yearLinks&&this._init()}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener(If,this._onTimelineObservations.bind(this))}_init(){window.addEventListener(If,this._onTimelineObservations.bind(this)),this._yearLinks.forEach(f=>{f.addEventListener("keyup",this._handleYearLinkKeyUp)}),this._isHorizontalTimeline=!!this.closest('.timeline[timeline-direction="horizontal"]'),this._isHorizontalTimeline&&this._initYearClicks(),this.dispatchEvent(new CustomEvent("toujou-timeline-legend-ready",{bubbles:!0,composed:!0,detail:this}))}_initYearClicks(){this._yearLinks.forEach(f=>{f.addEventListener("click",this._onYearLinkClick)})}_onTimelineObservations(f){const s=f.detail;s&&s.forEach(E=>{const R=this.querySelector(`.timeline-legend__link[href="#${E.yearId}"]`);R&&(E.isIntersecting?R.setAttribute(this.isActiveAttribute,""):R.removeAttribute(this.isActiveAttribute))})}_onYearLinkClick(f){let s;const E=f.currentTarget;if(!E)return;const R=E.href;if(!R)return;const G=R.split("#");G.length>1&&(s=G.pop()),s&&(f.preventDefault(),f.stopPropagation(),this.dispatchEvent(new CustomEvent(I_,{bubbles:!0,composed:!0,detail:s})))}_handleYearLinkKeyUp(f){(f.key==="Enter"||f.code==="Enter"||f.code==="Space"||f.key===" ")&&(f.preventDefault(),f.stopPropagation(),f.currentTarget.click())}};P0=Bt([Ln("toujou-timeline-legend")],P0);let rf=class extends mi{static get is(){return"toujou-topbutton"}constructor(){super(),this.visible=!1,this._checkVisibility=()=>{this.visible=document.body.scrollTop>this._viewportHeight||document.documentElement.scrollTop>this._viewportHeight},this._checkVisibility=this._checkVisibility.bind(this)}render(){return pi`
            <slot id="content"></slot>
        `}connectedCallback(){super.connectedCallback(),this.setAttribute("role","button"),this._checkVisibility(),window.addEventListener("scroll",this._checkVisibility),window.addEventListener("resize",this._checkVisibility),this.addEventListener("click",this._handleClick),this.addEventListener("keyup",this._handleKeyUp)}disconnectedCallback(){window.removeEventListener("scroll",this._checkVisibility),window.addEventListener("resize",this._checkVisibility),this.removeEventListener("click",this._handleClick),this.removeEventListener("keyup",this._handleKeyUp),super.disconnectedCallback()}updated(f){super.updated(f),f.has("visible")&&this.setAttribute("aria-hidden",(!this.visible).toString())}get _viewportHeight(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}_handleClick(){window.scrollTo({top:0,left:0,behavior:"smooth"}),this._resetFocus()}_handleKeyUp(f){f.key!=="Enter"&&f.code!=="Enter"&&f.code!=="Space"&&f.key!==" "||this._handleClick()}_resetFocus(){const f=document.activeElement;f&&f.blur()}};Bt([vt({type:Boolean,attribute:"is-visible",reflect:!0})],rf.prototype,"visible",void 0),customElements.define(rf.is,rf);const ob=.75,ab=1,sb=3e3,lb="medium",cb="de-DE",ub="toujou-counter-init",hb="toujou-counter-animation-start",db="toujou-counter-animation-end";let of=class extends mi{constructor(){super(...arguments),this._frameDuration=1e3/60,this._observer=new IntersectionObserver((f,s)=>{f.forEach(E=>{E.isIntersecting&&E.intersectionRatio>=ob&&(this._dispatchCounterEvent(hb),this._animate(),this._observer.unobserve(this._numberEl))})},{threshold:ab}),this._init=()=>{this._startNumberVal=parseFloat(this.startNumber),this._endNumberVal=parseFloat(this.endNumber),this._animationDuration=this._getAnimationDuration(),this._totalFrames=Math.round(this._animationDuration/this._frameDuration),this._pageLang=document.documentElement.getAttribute("lang")||cb,this._observer.observe(this._numberEl),this._dispatchCounterEvent(ub)},this._animate=()=>{let f=0;const s=()=>{f++;const E=(R=f/this._totalFrames)*(2-R);var R;const G=this._endNumberVal>=this._startNumberVal?Math.round(this._startNumberVal+(this._endNumberVal-this._startNumberVal)*E):Math.round(this._startNumberVal-(this._startNumberVal-this._endNumberVal)*E);parseFloat(this._numberEl.textContent.replace(/,/g,""))!==G&&(this._numberEl.textContent=new Intl.NumberFormat(this._pageLang).format(G)),f<this._totalFrames?requestAnimationFrame(s):(this._numberEl.textContent=new Intl.NumberFormat(this._pageLang).format(this._endNumberVal),this._dispatchCounterEvent(db))};requestAnimationFrame(s)},this._getAnimationDuration=()=>{this._animationSpeedVarName=`--counter-animation-duration-${this.animationSpeed?this.animationSpeed:lb}`;const f=getComputedStyle(this);let s=parseInt(f.getPropertyValue(`${this._animationSpeedVarName}`));return s||(console.warn("TOUJOU: could not get the counter animation duration variable. Using fallback value",this),s=sb),s},this._dispatchCounterEvent=f=>{this.dispatchEvent(new CustomEvent(f,{bubbles:!0,composed:!0,detail:{counter:this}}))}}static get is(){return"toujou-counter"}createRenderRoot(){return this}firstUpdated(f){super.firstUpdated(f),this.startNumber&&this.endNumber?(this._numberEl=this.querySelector(".counter__number-text"),this._numberEl?(this.animationSpeed||console.warn("TOUJOU: could not get the counter animation speed. Using default value!",this),window.matchMedia("(prefers-reduced-motion: reduce)").matches?this._numberEl.textContent=this.endNumber:this._init()):console.error("TOUJOU: could not get the counter number element!",this)):console.error("TOUJOU: could not get start and end values for the counter animation!",this)}};of.properties={startNumber:{type:String,attribute:"start-number"},endNumber:{type:String,attribute:"end-number"},animationSpeed:{type:String,attribute:"animation-speed"}},customElements.define(of.is,of);function I0(b,f){var s=Object.keys(b);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(b);f&&(E=E.filter(function(R){return Object.getOwnPropertyDescriptor(b,R).enumerable})),s.push.apply(s,E)}return s}function A0(b){for(var f=1;f<arguments.length;f++){var s=arguments[f]!=null?arguments[f]:{};f%2?I0(Object(s),!0).forEach(function(E){pb(b,E,s[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(s)):I0(Object(s)).forEach(function(E){Object.defineProperty(b,E,Object.getOwnPropertyDescriptor(s,E))})}return b}function z0(b,f,s,E,R,G,S){try{var l=b[G](S),ae=l.value}catch(_e){return void s(_e)}l.done?f(ae):Promise.resolve(ae).then(E,R)}function ms(b){return function(){var f=this,s=arguments;return new Promise(function(E,R){var G=b.apply(f,s);function S(ae){z0(G,E,R,S,l,"next",ae)}function l(ae){z0(G,E,R,S,l,"throw",ae)}S(void 0)})}}function pb(b,f,s){return(f=function(E){var R=function(G,S){if(typeof G!="object"||G===null)return G;var l=G[Symbol.toPrimitive];if(l!==void 0){var ae=l.call(G,S||"default");if(typeof ae!="object")return ae;throw new TypeError("@@toPrimitive must return a primitive value.")}return(S==="string"?String:Number)(G)}(E,"string");return typeof R=="symbol"?R:String(R)}(f))in b?Object.defineProperty(b,f,{value:s,enumerable:!0,configurable:!0,writable:!0}):b[f]=s,b}function Hf(b,f){return f||(f=b.slice(0)),Object.freeze(Object.defineProperties(b,{raw:{value:Object.freeze(f)}}))}var D0,L0,fb=bn(D0||(D0=Hf([`:host {
    display: var(--toujou-consent-display, block);
}`])));class R0 extends mi{static get is(){return"toujou-consent"}render(){return pi`
      <slot id="content"></slot>
    `}static get styles(){return fb}static get properties(){return{consentState:{type:Boolean},listenTo:{type:String},listenOn:{type:String}}}set consentState(f){this.consentInputType==="checkbox"&&(this.querySelector(".consent__checkbox").checked=f)}set listenTo(f){f.split(/\s+/).forEach(s=>{this.addEventListener(s,this._handleEvent)})}constructor(){super(),this._handleEvent=this._handleEvent.bind(this),this.listenOn="*",this._consentType=this.getAttribute("consenttype"),this._getConsentInputType(),this.consentState=null}connectedCallback(){super.connectedCallback()}_handleEvent(f){f.type==="click"?this._dispatchClickEvent():f.type==="change"&&this._dispatchChangeEvent()}firstUpdated(){this._dispatchReadyEvent()}_dispatchChangeEvent(){const f=new CustomEvent("toujou-consent-checkbox-changed",{bubbles:!0,composed:!0,detail:{consentElement:this}});this.dispatchEvent(f)}_dispatchClickEvent(){const f=new CustomEvent("toujou-consent-button-clicked",{bubbles:!0,composed:!0});this.dispatchEvent(f)}_dispatchReadyEvent(){const f=new CustomEvent("toujou-consent-connected",{bubbles:!0,composed:!0,detail:{consentType:this._consentType}});this.dispatchEvent(f)}_getConsentInputType(){const f=this.querySelectorAll(".consent__checkbox"),s=this.querySelectorAll(".consent__button");f.length>0?this.consentInputType="checkbox":s.length>0&&(this.consentInputType="button")}}customElements.define(R0.is,R0);var mb=bn(L0||(L0=Hf([`:host {
    display: var(--toujou-consent-widget-display, block);
}

`])));const A_="CHECK_CONSENT_EXPIRY",z_="SAVE_ALL_CONSENTS",D_="SAVE_SINGLE_CONSENT",L_="DISMISS_CONSENT_BOX",R_="UNDISMISS_CONSENT_BOX",gb={consents:{consentBoxDismissed:!1}};let O0=!1;function _b(b=gb,f){const s=function(E,R){var G,S,l,ae;switch(R.type){case A_:{const _e=Date.now(),ee={...E.consents};for(const Pe in ee)Pe!=="consentBoxDismissed"&&((S=(G=ee[Pe])===null||G===void 0?void 0:G.consentLifetime)!==null&&S!==void 0?S:0)>0&&((ae=(l=ee[Pe])===null||l===void 0?void 0:l.consentExpirationDate)!==null&&ae!==void 0?ae:0)<=_e&&(delete ee[Pe],ee.consentBoxDismissed=!1);return{...E,consents:ee}}case"CLEAR_CONSENT_TYPE_DATA":{const _e={...E.consents};return delete _e[R.payload],{...E,consents:_e}}case z_:{const _e={...E.consents,...R.payload};return{...E,consents:_e}}case D_:{const _e={...E.consents};return _e[R.payload.consentType]={...R.payload.consentData},{...E,consents:_e}}case L_:{const _e={...E.consents};return _e.consentBoxDismissed=!0,{...E,consents:_e}}case R_:{const _e={...E.consents};return _e.consentBoxDismissed=!1,{...E,consents:_e}}}return E}(b,f);return typeof window.dataLayer=="object"&&(!O0||s.consents.consentBoxDismissed!==void 0&&s.consents.consentBoxDismissed)&&(window.dataLayer.push({event:"consent-changed",...s.consents}),O0=!0),s}const O_={setItem(b,f){document.cookie=`${b}=${f};path=/;`},getItem(b){const f=`${b}=`,s=document.cookie.split(";");for(let E=0,R=s.length;E<R;E++){let G=s[E];for(;G.charAt(0)===" ";)G=G.substring(1,G.length);if(G.indexOf(f)===0)return G.substring(f.length,G.length)}return null}},F0=(b,f,s)=>{try{const E=JSON.stringify(b);return void f.setItem(s,E)}catch(E){console.error(`There was an error while saving the consents data to storage: Error: ${E}`)}},B0=(b,f)=>{try{const s=b.getItem(f);return s===null?{}:JSON.parse(s)}catch(s){return console.error(`There was a problem loading the consents data from storage. Error: ${s}`),{}}},yb=b=>{const f={},s={};for(const E in b)E==="consentBoxDismissed"?s[E]=b[E]:b[E].consentLifetime===0?f[E]=b[E]:b[E].consentLifetime>0&&(s[E]=b[E]);F0({consents:f},O_,"consentsState"),F0({consents:s},localStorage,"consentsState")},vu=function(b={},f=[]){const s=(window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({trace:!0,traceLimit:25}):bv)(...f),E=xv(_b,b,s);return E.dispatch({type:A_}),E}((()=>{const b=B0(O_,"consentsState"),f=B0(localStorage,"consentsState");return{consents:{...b.consents,...f.consents}}})(),[wv(({getState:b})=>f=>s=>{const E=f(s),R=b();for(const G in R){if(G!=="consents")return void console.error('Unknown data "key" found while saving to session / local Storage');yb(R.consents)}return E})]),F_=["tracking","html","maps","video","ads"];class B_{constructor(f){this.isRendered=!1,this.templateElement=f}renderInto(f){this.isRendered||(f.insertNode(this.getContent(f)),this.isRendered=!0)}getContent(f){if(!this.isCommentedTemplate(this.templateElement))return document.importNode(this.templateElement.content,!0);const s=this.uncommentTemplate(this.templateElement);return f.createContextualFragment(s)}isCommentedTemplate(f){const s=f.innerHTML.trim();return s.startsWith("<!--")&&s.endsWith("-->")}uncommentTemplate(f){const s=f.innerHTML.trim();return s.substring(4,s.length-3).trim()}}class vb{constructor(f,s=B_,E="template[data-toujou-third-party-content]"){(this.host=f).addController(this),this.selector=E,this.templateRenderer=s}hostConnected(){}hostDisconnected(){}onConsentsChanged(f){for(const[s,E]of Object.entries(f))typeof E=="object"&&E.consentGiven&&document.querySelectorAll(this.selector+'[data-content-type="'+s+'"]').forEach(R=>{const G=document.createRange();G.setStartAfter(R),G.collapse(!0),new this.templateRenderer(R).renderInto(G),R.remove()})}}class j0 extends mi{static get is(){return"toujou-consent-widget"}render(){return pi`
      <slot name="consentWidgetHeader"></slot>
      <slot id="consentElements"></slot>
      <slot name="consentWarning" id="consentWarning"></slot>
    `}static get styles(){return mb}set _warningVisible(f){this.setAttribute("warningvisible",f)}static get properties(){return{inPage:{type:Boolean},listenTo:{type:String},listenOn:{type:String},_warningVisible:{type:Boolean},deactivated:{type:Boolean}}}set listenTo(f){f.split(/\s+/).forEach(s=>{this.addEventListener(s,this._handleEvent)})}set _dismissedBox(f){this.inPage||(f?this.setAttribute("hidden",""):this.removeAttribute("hidden")),this._warningVisible=this.inPage&&!f}constructor(){var f;super(),this.inPage=!1,this.deactivated=!1,this.consentTypeNames=F_,this.listenOn="*",this.templateController=new vb(this),this.onStateChange=this.onStateChange.bind(this),this._handleEvent=this._handleEvent.bind(this),this.store=vu,this.store.subscribe(this.onStateChange),this._state=this.store.getState(),this._warningVisible=this.inPage,this.templateController.onConsentsChanged((f=this._state.consents)!==null&&f!==void 0?f:{}),window.location.hash==="#aaa"&&(this.deactivated=!0),this.addEventListener("toujou-consent-connected",this._handleConsentConnected),this.addEventListener("toujou-consent-checkbox-changed",this._handleConsentCheckboxChanged)}connectedCallback(){super.connectedCallback(),this._dismissedBox=!!this._state.consents&&this._state.consents.consentBoxDismissed,this.deactivated?setTimeout(()=>{this._prepareToSaveConsents(),this._dismissConsentBox(),this._dispatchConsentDeactivated()}):setTimeout(()=>{const f=this.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');f.length>0&&f[0].focus()})}firstUpdated(){this.consentTypeNames.forEach(f=>{const s=this.querySelector(`toujou-consent[consenttype="${f}"]`);this._state.consents.consentBoxDismissed&&!this._state.consents[f]&&s&&this._undismissConsentBox()})}onStateChange(){var f;this._state=this.store.getState(),this._dismissedBox=this._state.consents.consentBoxDismissed,this.templateController.onConsentsChanged((f=this._state.consents)!==null&&f!==void 0?f:{}),this._updateAllConsentElementsStates()}_handleEvent(f){f.stopPropagation(),f.type==="click"&&!this.inPage&&f.target.matches(this.listenOn)&&this._handleConsentBoxSaveButtonClick(f.target)}_handleConsentCheckboxChanged(f){this.inPage&&this._state.consents.consentBoxDismissed===!0&&(this._prepareToSaveConsents(),this._dispatchAddSnackbar(f.target.getAttribute("snackbarmessage")))}_handleConsentBoxSaveButtonClick(f){f.hasAttribute("accept-all")?this._prepareToSaveConsents(!0):f.hasAttribute("deny-all")?this._prepareToSaveConsents(!1):this._prepareToSaveConsents(null),this._dismissConsentBox()}_prepareToSaveConsents(f=null){const s=this._getAllConsents(f);this._saveAllConsents(s)}_getAllConsents(f=null){const s={},E=this.querySelectorAll("toujou-consent");return E&&E.forEach(R=>{const G=R.getAttribute("consenttype");s[G]=this._createNewConsentData(R,f)}),s}_createNewConsentData(f,s=null){const E=f.querySelector(".consent__checkbox");s!==null&&(E.checked=s);const R=this._createConsentLifeInMillis(f.getAttribute("consenttype"),f.getAttribute("consentlifetime")),G=E.checked,S=Date.now();return{consentGiven:G,consentCreationDate:S,consentExpirationDate:S+R,consentLifetime:R}}_createConsentLifeInMillis(f,s){return f==="tracking"?s==="0"?63072e6:0:24*s*60*60*1e3}_dismissConsentBox(){this.store.dispatch({type:L_}),this._dispatchConsentWidgetDismissedEvent()}_undismissConsentBox(){this.store.dispatch({type:R_})}_saveAllConsents(f){this.store.dispatch((s=>({type:z_,payload:s}))(f))}_handleConsentConnected(f){this._setConsentElementState(f.target)}_setConsentElementState(f){if(f.tagName==="TOUJOU-CONSENT"){const s=f.getAttribute("consenttype"),E=f.getAttribute("prechecked")==="1";f.consentState=this._getConsentTypeState(this._state,s,E)}}_updateAllConsentElementsStates(){this.querySelectorAll("toujou-consent").forEach(f=>{this._setConsentElementState(f)})}_getConsentTypeState(f,s,E){var R;let G=null;return(R=f==null?void 0:f.consents[s])!==null&&R!==void 0&&R&&(G=f.consents[s]),G?G.consentGiven:E}_dispatchAddSnackbar(f){const s=new CustomEvent("toujou-add-snackbar",{bubbles:!0,composed:!0,detail:{message:f,type:"auto",duration:2500,variant:"success"}});this.dispatchEvent(s)}_dispatchConsentWidgetDismissedEvent(){const f=new CustomEvent("toujou-consent-widget-dismissed",{bubbles:!0,composed:!0});this.dispatchEvent(f)}_dispatchConsentDeactivated(){const f=new CustomEvent("toujou-consent-widget-deactivated",{bubbles:!0,composed:!0});this.dispatchEvent(f)}}customElements.define(j0.is,j0);/*!
  * Cookie-store v4.0.0-next.2
  * https://github.com/markcellus/cookie-store
  *
  * Copyright (c) 2022 Mark
  * Licensed under the MIT license
 */var ua,bb=decodeURIComponent,xb=/; */;function wb(b,f){try{return typeof f=="boolean"?decodeURIComponent(b):f(b)}catch{return b}}(function(b){b.strict="strict",b.lax="lax",b.none="none"})(ua||(ua={}));class Sb extends Event{constructor(f){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{changed:[],deleted:[]};super(f,s),this.changed=s.changed||[],this.deleted=s.deleted||[]}}class Cb extends EventTarget{constructor(){throw super(),new TypeError("Illegal Constructor")}get[Symbol.toStringTag](){return"CookieStore"}get(f){var s=this;return ms(function*(){if(f==null)throw new TypeError("CookieStoreGetOptions must not be empty");if(f instanceof Object&&!Object.keys(f).length)throw new TypeError("CookieStoreGetOptions must not be empty");return(yield s.getAll(f))[0]})()}set(f,s){var E=this;return ms(function*(){var R,G,S,l={name:"",value:"",path:"/",secure:!1,sameSite:ua.strict,expires:null,domain:null};if(typeof f=="string")l.name=f,l.value=s;else{if(Object.assign(l,f),l.path&&!l.path.startsWith("/"))throw new TypeError('Cookie path must start with "/"');if(!((R=l.domain)===null||R===void 0)&&R.startsWith("."))throw new TypeError('Cookie domain cannot start with "."');if(l.domain&&l.domain!==window.location.hostname)throw new TypeError("Cookie domain must domain-match current host");if(!((G=l.name)===null||G===void 0)&&G.startsWith("__Host")&&l.domain)throw new TypeError("Cookie domain must not be specified for host cookies");if(!((S=l.name)===null||S===void 0)&&S.startsWith("__Host")&&l.path!="/")throw new TypeError("Cookie path must not be specified for host cookies");l.path&&l.path.endsWith("/")&&(l.path=l.path.slice(0,-1)),l.path===""&&(l.path="/")}if(l.name===""&&l.value&&l.value.includes("="))throw new TypeError("Cookie value cannot contain '=' if the name is empty");l.name&&l.name.startsWith("__Host")&&(l.secure=!0);var ae="".concat(l.name,"=").concat(encodeURIComponent(l.value));switch(l.domain&&(ae+="; Domain="+l.domain),l.path&&(ae+="; Path="+l.path),typeof l.expires=="number"?ae+="; Expires="+new Date(l.expires).toUTCString():l.expires instanceof Date&&(ae+="; Expires="+l.expires.toUTCString()),(l.name&&l.name.startsWith("__Secure")||l.secure)&&(l.sameSite=ua.lax,ae+="; Secure"),l.sameSite){case ua.lax:ae+="; SameSite=Lax";break;case ua.strict:ae+="; SameSite=Strict";break;case ua.none:ae+="; SameSite=None"}var _e=E.get(l);if(document.cookie=ae,E.onchange){var ee=[],Pe=[];_e&&!(yield E.get(l))?Pe.push(A0(A0({},l),{},{value:void 0})):ee.push(l);var Ce=new Sb("change",{changed:ee,deleted:Pe});E.onchange(Ce)}})()}getAll(f){return ms(function*(){var s,E,R=function(S){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof S!="string")throw new TypeError("argument str must be a string");for(var ae=[],_e=l||{},ee=S.split(xb),Pe=_e.decode||bb,Ce=0;Ce<ee.length;Ce++){var N=ee[Ce],ge=N.indexOf("=");if(!(ge<0)){var Ee=N.substr(0,ge).trim(),He=N.substr(++ge,N.length).trim();He[0]=='"'&&(He=He.slice(1,-1)),ae[Ee]==null&&ae.push({name:Ee,value:wb(He,Pe)})}}return ae}(document.cookie);if(f==null||Object.keys(f).length===0)return R;if(typeof f=="string"?s=f:(s=f.name,E=f.url),E){var G=new URL(E,window.location.origin);if(window.location.href!==G.href||window.location.origin!==G.origin)throw new TypeError("URL must match the document URL");return R.slice(0,1)}return R.filter(S=>S.name===s)})()}delete(f){var s=this;return ms(function*(){var E={name:"",value:"",path:"/",secure:!1,sameSite:ua.strict,expires:null,domain:null};typeof f=="string"?E.name=f:Object.assign(E,f),E.expires=0,yield s.set(E)})()}}var Hc=new WeakMap,Af=new WeakMap;class Tb{get[Symbol.toStringTag](){return"CookieStoreManager"}constructor(){throw new TypeError("Illegal Constructor")}subscribe(f){var s=this;return ms(function*(){var E=Hc.get(s)||[],R=Af.get(s);if(!R)throw new TypeError("Illegal invocation");var G=function*(){var l=S.name,ae=new URL(S.url||"",R.scope).toString();if(E.some(_e=>_e.name===l&&_e.url===ae))return"continue";E.push({name:S.name,url:ae})};for(var S of f)yield*G();Hc.set(s,E)})()}getSubscriptions(){var f=this;return ms(function*(){return(Hc.get(f)||[]).map(s=>{var{name:E,url:R}=s;return{name:E,url:R}})})()}unsubscribe(f){var s=this;return ms(function*(){var E=Hc.get(s)||[],R=Af.get(s);if(!R)throw new TypeError("Illegal invocation");var G=function*(){var l=S.name,ae=new URL(S.url||"",R.scope).toString();E=E.filter(_e=>_e.name!==l||_e.url!==ae)};for(var S of f)yield*G();Hc.set(s,E)})()}}typeof ServiceWorkerRegistration>"u"||"cookies"in ServiceWorkerRegistration.prototype||Object.defineProperty(ServiceWorkerRegistration.prototype,"cookies",{configurable:!0,enumerable:!0,get(){var b=Object.create(Tb.prototype);return Af.set(b,this),Object.defineProperty(this,"cookies",{value:b}),b}});var N0,zf=Object.create(Cb.prototype);window.dataLayer=window.dataLayer||[];class Eb extends HTMLElement{get analyticsid(){return this.getAttribute("analyticsid")}constructor(){super(),this.hidden=!0,this.style.display="contents",this.onStateChange=this.onStateChange.bind(this),this.store=vu}connectedCallback(){this._storeUnsubscribe=this.store.subscribe(this.onStateChange),this.onStateChange()}disconnectedCallback(){this._storeUnsubscribe&&this._storeUnsubscribe()}onStateChange(){const f=this.store.getState().consents.tracking||null;JSON.stringify(f)!==JSON.stringify(this.consentState)&&(this.consentState=f,this._handleConsentState(this.consentState))}_handleConsentState(f){typeof f=="object"&&f!==null&&f.consentGiven?this._instantiateGoogleAnalytics(f):this._disableGoogleAnalytics()}_instantiateGoogleAnalytics(f){if(this.gaIsInstantiated)return;const s=this.analyticsid;window[`ga-disable-${s}`]=!1;const E={cookie_expires:f.consentExpirationDate,anonymize_ip:!0};function R(...G){window.dataLayer.push(G)}window.gtag=R,this._ga||(this._ga=this._addAnalyticsScriptTag(s),R("js",new Date)),R("config",s,E),this.gaIsInstantiated=!0,this._dispatchGtagLoadedEvent()}_addAnalyticsScriptTag(f){const s=`https://www.googletagmanager.com/gtag/js?id=${f}`,E=document.createElement("script"),R=document.getElementsByTagName("script")[0];return E.async=!0,E.src=s,R.parentNode.insertBefore(E,R),!0}_disableGoogleAnalytics(){["_ga","_gid","_gat"].forEach(f=>{zf.delete(f)}),window[`ga-disable-${this.analyticsid}`]=!0,this.gaIsInstantiated=!1}_dispatchGtagLoadedEvent(){const f=new CustomEvent("toujou-gtag-loaded",{bubbles:!0,composed:!0});this.dispatchEvent(f)}}customElements.define("toujou-tracking-google-analytics",Eb),window._paq=window._paq||[];class Mb extends HTMLElement{get url(){return this.getAttribute("url").replace(/^\/\//,`${window.location.protocol}//`)}get siteid(){return this.getAttribute("siteid")}constructor(){super(),this.hidden=!0,this.style.display="contents",this.onStateChange=this.onStateChange.bind(this),this.store=vu}connectedCallback(){this._instantiateMatomo(),this._storeUnsubscribe=this.store.subscribe(this.onStateChange),this.onStateChange()}disconnectedCallback(){this._storeUnsubscribe&&this._storeUnsubscribe()}onStateChange(){const f=this.store.getState().consents.tracking||null;JSON.stringify(f)!==JSON.stringify(this.consentState)&&(this.consentState=f,this._handleConsentState(this.consentState))}_handleConsentState(f){const{_paq:s}=window;typeof f=="object"&&f!==null&&f.consentGiven?this._enableAnonymizedTracking(f,s):this._disableAnonymizedTracking(s)}_enableAnonymizedTracking(f,s){s.push(["setCookieConsentGiven"])}_disableAnonymizedTracking(f){f.push(["forgetCookieConsentGiven"]),zf.getAll().then(s=>s.forEach(E=>{(E.name.match(/^_pk_.*$/)||E.name.match(/^_mtm_.*$/)||E.name.match(/^MATOMO.*$/))&&zf.delete(E.name)}))}_instantiateMatomo(){if(this.matomoIsInstantiated)return;const f=new URL(this.url),s=new URL(f);s.pathname="/matomo.php";const E=new URL(f);E.pathname="/matomo.js";const{_paq:R}=window;R.push(["requireCookieConsent"]),R.push(["trackPageView"]),R.push(["enableLinkTracking"]),R.push(["setTrackerUrl",s.toString()]),R.push(["setSiteId",this.siteid]),this._matomo||(this._matomo=this._addMatomoScriptTag(E)),this.matomoIsInstantiated=!0,this._dispatchMatomoLoadedEvent()}_addMatomoScriptTag(f){const s=document.createElement("script"),E=document.getElementsByTagName("script")[0];return s.async=!0,s.src=f.toString(),E.parentNode.insertBefore(s,E),!0}_dispatchMatomoLoadedEvent(){const f=new CustomEvent("toujou-matomo-loaded",{bubbles:!0,composed:!0});this.dispatchEvent(f)}}customElements.define("toujou-tracking-matomo",Mb);var kb=bn(N0||(N0=Hf([`:host {
    display: var(--toujou-third-party-content-display, flex);
    -webkit-box-align: var(--toujou-third-party-content-align-items, stretch);
        -ms-flex-align: var(--toujou-third-party-content-align-items, stretch);
            align-items: var(--toujou-third-party-content-align-items, stretch);
    -webkit-box-pack: var(--toujou-third-party-content-justify-content, center);
        -ms-flex-pack: var(--toujou-third-party-content-justify-content, center);
            justify-content: var(--toujou-third-party-content-justify-content, center);
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: var(--toujou-third-party-content-flex-direction, column);
            flex-direction: var(--toujou-third-party-content-flex-direction, column);
    position: var(--toujou-third-party-content-position, relative);
    top: var(--toujou-third-party-content-top, 0);
    left: var(--toujou-third-party-content-left, 0);
    height: var(--toujou-third-party-content-height, 100%);
    width: var(--toujou-third-party-content-width, 100%);
}

:host([contenttype='maps']) {
    position: var(--toujou-third-party-content-maps-position, absolute);
}

iframe {
    border: var(--toujou-third-party-content-iframe-border, none);
    position: var(--toujou-third-party-content-iframe-position, absolute);
    height: var(--toujou-third-party-content-iframe-height, 100%);
    width: var(--toujou-third-party-content-iframe-width, 100%);
}

:host([contenttype='html']) iframe {
    position: var(--toujou-third-party-content-html-iframe-position, relative);
}
`])));class ca extends mi{set store(f){this._storeUnsubscribe&&(this._storeUnsubscribe(),this._storeUnsubscribe=this._store=null,this.consent=null),f&&(this._storeUnsubscribe=f.subscribe(this.onStateChange),this._store=f,this.onStateChange())}get store(){return this._store}static get is(){return"toujou-third-party-content"}static get styles(){return kb}render(){return pi`
      <slot id="templatedContent" @slotchange="${this._handleSlotChange}"></slot>
      <div @click="${this._handlePlaceholderClick}">
        <slot name="placeholder" id="placeholderContainer" class="placeholder-slot"></slot>
      </div>
    `}constructor(){super(),this._store=null,this._storeUnsubscribe=null,this.isIntersecting=!1,this.contentTypeAllowed=!1,this.show=!1,this.consent=null,this.onStateChange=this.onStateChange.bind(this),this._handleConsentButtonClick=this._handleConsentButtonClick.bind(this)}connectedCallback(){super.connectedCallback(),this.store||(this.store=vu),this._isContentTypeAllowed(this.consent),this._addEventListeners(),this._addIntersectionObserver()}updated(f){f.has("isIntersecting")&&this.isIntersecting&&!this.show&&(this.show=!0),(f.has("contentTypeAllowed")||f.has("show"))&&this.contentTypeAllowed&&this.show&&this._showContent()}onStateChange(){var f,s,E;this.consent=(E=(s=(f=this._store.getState())===null||f===void 0?void 0:f.consents)===null||s===void 0?void 0:s[this.contentType])!==null&&E!==void 0&&E,this._isContentTypeAllowed(this.consent)}_addEventListeners(){window.addEventListener("toujou-consent-widget-dismissed",()=>{this._isContentTypeAllowed(this.consent)}),window.addEventListener("toujou-consent-button-clicked",this._handleConsentButtonClick)}_handleConsentButtonClick(f){const s=f.target;this.querySelectorAll(".consent").forEach(E=>{E===s&&(this._saveSingleConsent(f.target.getAttribute("consenttype"),this._createNewConsentData(f.target)),this._dispatchAddSnackbar(f.target.getAttribute("snackbarmessage")))})}_createNewConsentData(f){const s=24*f.getAttribute("consentLifetime")*60*60*1e3;return{consentGiven:!0,consentCreationDate:Date.now(),consentExpirationDate:Date.now()+s,consentLifetime:s}}_saveSingleConsent(f,s){this.store.dispatch(((E,R)=>({type:D_,payload:{consentType:E,consentData:R}}))(f,s))}_dispatchAddSnackbar(f){const s=new CustomEvent("toujou-add-snackbar",{bubbles:!0,composed:!0,detail:{message:f,type:"auto",duration:2500,variant:"success"}});this.dispatchEvent(s)}_handlePlaceholderClick(f){f.target.hasAttribute("ttpc-showcontentonce")&&this._handleShowContentOnceClick()}_handleShowContentOnceClick(){this._showContent()}_addIntersectionObserver(){new IntersectionObserver((f,s)=>{this.isIntersecting=f[0].isIntersecting,this.isIntersecting&&s.unobserve(this)}).observe(this)}_clearRenderedContent(){this.querySelector(".toujou-third-party-content__templated-content").innerHTML=""}_handleSlotChange(){}_isContentTypeAllowed(f){this.contentTypeAllowed=f!==null&&(f.consentGiven||!1),window.location.hash==="#aaa"&&(this.contentTypeAllowed=!0)}_showContent(){this._clearRenderedContent();const f=this.shadowRoot.querySelector("#templatedContent").assignedNodes({flatten:!0}).filter(R=>R.tagName==="TEMPLATE"),s=this.querySelector(".toujou-third-party-content__templated-content"),E=document.createRange();E.selectNodeContents(s),f.forEach(R=>{new B_(R).renderInto(E)}),this.setAttribute("showingcontent","")}}Bt([vt()],ca.prototype,"contentType",void 0),Bt([vt()],ca.prototype,"store",null),Bt([vt({type:Boolean})],ca.prototype,"isIntersecting",void 0),Bt([Yc()],ca.prototype,"contentTypeAllowed",void 0),Bt([Yc()],ca.prototype,"show",void 0),Bt([Yc()],ca.prototype,"consent",void 0),customElements.define(ca.is,ca);class Pb extends mi{createRenderRoot(){return this}constructor(){super(),this.consentTypeNames=F_,this.onStateChange=this.onStateChange.bind(this),this.store=vu,this.store.subscribe(this.onStateChange),this.state=this.store.getState()}}class $0 extends Pb{static get is(){return"toujou-consent-state-emitter-gtm"}onStateChange(){if(this.state=this.store.getState(),!window.gtag)throw new Error("TOUJOU: Could not get the gtag library to set the ads consent state!");this._updateGtmTrackingState(),this._updateGtmAdsState()}_updateGtmTrackingState(){const f=this.state.consents.tracking,s={analytics_storage:(f==null?void 0:f.consentGiven)===!0?"granted":"denied"};this._sendGtagConsentUpdate(s)}_updateGtmAdsState(){const f=this.state.consents.ads,s=(f==null?void 0:f.consentGiven)===!0?"granted":"denied",E={ad_storage:s,ad_user_data:s,ad_personalization:s};this._sendGtagConsentUpdate(E)}_sendGtagConsentUpdate(f){window.gtag("consent","update",f)}}customElements.define($0.is,$0);var j_={exports:{}};(function(b){console.info(`
IFRAME-RESIZER

Iframe-Resizer 5 is now available via the following two packages:

 * @iframe-resizer/parent
 * @iframe-resizer/child

Additionally their are also new versions of iframe-resizer for React, Vue, and jQuery.

Version 5 of iframe-resizer has been extensively rewritten to use modern browser APIs, which has enabled significantly better performance and greater accuracy in the detection of content resizing events.

Please see https://iframe-resizer.com/upgrade for more details.
`),function(f){if(typeof window>"u")return;var s=0,E,R=!1,G=!1,S="message",l=S.length,ae="[iFrameSizer]",_e=ae.length,ee=null,Pe=window.requestAnimationFrame,Ce=Object.freeze({max:1,scroll:1,bodyScroll:1,documentElementScroll:1}),N={},ge=null,Ee=Object.freeze({autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,license:"1jqr0si6pnt",log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,mouseEvents:!0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",onClose:function(){return!0},onClosed:function(){},onInit:function(){},onMessage:function(){Pt("onMessage function not defined")},onMouseEnter:function(){},onMouseLeave:function(){},onResized:function(){},onScroll:function(){return!0}});function He(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}function tt(we,ht,Ot){we.addEventListener(ht,Ot,!1)}function Ge(we,ht,Ot){we.removeEventListener(ht,Ot,!1)}function Ye(){var we=["moz","webkit","o","ms"],ht;for(ht=0;ht<we.length&&!Pe;ht+=1)Pe=window[we[ht]+"RequestAnimationFrame"];Pe?Pe=Pe.bind(window):$e("setup","RequestAnimationFrame not supported")}function mt(we){var ht="Host page: "+we;return window.top!==window.self&&(ht=window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+we:"Nested host page: "+we),ht}function dt(we){return ae+"["+mt(we)+"]"}function pt(we){return N[we]?N[we].log:R}function $e(we,ht){Qe("log",we,ht,pt(we))}function bt(we,ht){Qe("info",we,ht,pt(we))}function Pt(we,ht){Qe("warn",we,ht,!0)}function Qe(we,ht,Ot,Et){Et===!0&&typeof window.console=="object"&&console[we](dt(ht),Ot)}function Ke(we){function ht(){function z(){Tt(Te),ei(de),ne("onResized",Te)}jt("Height"),jt("Width"),at(z,Te,"init")}function Ot(){var z=Ae.slice(_e).split(":"),k=z[1]?parseInt(z[1],10):0,V=N[z[0]]&&N[z[0]].iframe,Q=getComputedStyle(V);return{iframe:V,id:z[0],height:k+Et(Q)+$t(Q),width:z[2],type:z[3]}}function Et(z){if(z.boxSizing!=="border-box")return 0;var k=z.paddingTop?parseInt(z.paddingTop,10):0,V=z.paddingBottom?parseInt(z.paddingBottom,10):0;return k+V}function $t(z){if(z.boxSizing!=="border-box")return 0;var k=z.borderTopWidth?parseInt(z.borderTopWidth,10):0,V=z.borderBottomWidth?parseInt(z.borderBottomWidth,10):0;return k+V}function jt(z){var k=Number(N[de]["max"+z]),V=Number(N[de]["min"+z]),Q=z.toLowerCase(),fe=Number(Te[Q]);$e(de,"Checking "+Q+" is in range "+V+"-"+k),fe<V&&(fe=V,$e(de,"Set "+Q+" to min value")),fe>k&&(fe=k,$e(de,"Set "+Q+" to max value")),Te[Q]=""+fe}function Pi(){function z(){function Q(){var Se=0,Be=!1;for($e(de,"Checking connection is from allowed list of origins: "+V);Se<V.length;Se++)if(V[Se]===k){Be=!0;break}return Be}function fe(){var Se=N[de]&&N[de].remoteHost;return $e(de,"Checking connection is from: "+Se),k===Se}return V.constructor===Array?Q():fe()}var k=we.origin,V=N[de]&&N[de].checkOrigin;if(V&&""+k!="null"&&!z())throw new Error("Unexpected message received from: "+k+" for "+Te.iframe.id+". Message was: "+we.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}function Yi(){return ae===(""+Ae).slice(0,_e)&&Ae.slice(_e).split(":")[0]in N}function Di(){var z=Te.type in{true:1,false:1,undefined:1};return z&&$e(de,"Ignoring init message from meta parent page"),z}function Ii(z){return Ae.slice(Ae.indexOf(":")+l+z)}function ni(z){$e(de,"onMessage passed: {iframe: "+Te.iframe.id+", message: "+z+"}"),ne("onMessage",{iframe:Te.iframe,message:JSON.parse(z)}),$e(de,"--")}function tn(){var z=document.body.getBoundingClientRect(),k=Te.iframe.getBoundingClientRect();return JSON.stringify({iframeHeight:k.height,iframeWidth:k.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(k.top-z.top,10),offsetLeft:parseInt(k.left-z.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,documentHeight:document.documentElement.clientHeight,documentWidth:document.documentElement.clientWidth,windowHeight:window.innerHeight,windowWidth:window.innerWidth})}function Ti(z,k){function V(){ft("Send Page Info","pageInfo:"+tn(),z,k)}Yt(V,32,k)}function Ui(){function z(fe,Se){function Be(){N[Q]?Ti(N[Q].iframe,Q):k()}["scroll","resize"].forEach(function(Ve){$e(Q,fe+Ve+" listener for sendPageInfo"),Se(window,Ve,Be)})}function k(){z("Remove ",Ge)}function V(){z("Add ",tt)}var Q=de;V(),N[Q]&&(N[Q].stopPageInfo=k)}function nn(){N[de]&&N[de].stopPageInfo&&(N[de].stopPageInfo(),delete N[de].stopPageInfo)}function hn(){var z=!0;return Te.iframe===null&&(Pt(de,"IFrame ("+Te.id+") not found"),z=!1),z}function At(z){var k=z.getBoundingClientRect();return It(de),{x:Math.floor(Number(k.left)+Number(ee.x)),y:Math.floor(Number(k.top)+Number(ee.y))}}function ue(z){function k(){ee=Se,j(),$e(de,"--")}function V(){return{x:Number(Te.width)+fe.x,y:Number(Te.height)+fe.y}}function Q(){window.parentIFrame?window.parentIFrame["scrollTo"+(z?"Offset":"")](Se.x,Se.y):Pt(de,"Unable to scroll to requested position, window.parentIFrame not found")}var fe=z?At(Te.iframe):{x:0,y:0},Se=V();$e(de,"Reposition requested from iFrame (offset x:"+fe.x+" y:"+fe.y+")"),window.top===window.self?k():Q()}function j(){ne("onScroll",ee)===!1?Zt():ei(de)}function q(z){function k(){var Be=At(Se);$e(de,"Moving to in page link (#"+Q+") at x: "+Be.x+" y: "+Be.y),ee={x:Be.x,y:Be.y},j(),$e(de,"--")}function V(){window.parentIFrame?window.parentIFrame.moveToAnchor(Q):$e(de,"In page link #"+Q+" not found and window.parentIFrame not found")}var Q=z.split("#")[1]||"",fe=decodeURIComponent(Q),Se=document.getElementById(fe)||document.getElementsByName(fe)[0];Se?k():window.top===window.self?$e(de,"In page link #"+Q+" not found"):V()}function Z(z){var k={};if(Number(Te.width)===0&&Number(Te.height)===0){var V=Ii(9).split(":");k={x:V[1],y:V[0]}}else k={x:Te.width,y:Te.height};ne(z,{iframe:Te.iframe,screenX:Number(k.x),screenY:Number(k.y),type:Te.type})}function ne(z,k){return et(de,z,k)}function pe(){switch(N[de]&&N[de].firstRun&&ve(),Te.type){case"close":{Dt(Te.iframe);break}case"message":{ni(Ii(6));break}case"mouseenter":{Z("onMouseEnter");break}case"mouseleave":{Z("onMouseLeave");break}case"autoResize":{N[de].autoResize=JSON.parse(Ii(9));break}case"scrollTo":{ue(!1);break}case"scrollToOffset":{ue(!0);break}case"pageInfo":{Ti(N[de]&&N[de].iframe,de),Ui();break}case"pageInfoStop":{nn();break}case"inPageLink":{q(Ii(9));break}case"reset":{Rt(Te);break}case"init":{ht(),ne("onInit",Te.iframe);break}default:Number(Te.width)===0&&Number(Te.height)===0?Pt("Unsupported message received ("+Te.type+"), this is likely due to the iframe containing a later version of iframe-resizer than the parent page"):ht()}}function be(z){var k=!0;return N[z]||(k=!1,Pt(Te.type+" No settings for "+z+". Message was: "+Ae)),k}function Me(){for(var z in N)ft("iFrame requested init",xt(z),N[z].iframe,z)}function ve(){N[de]&&(N[de].firstRun=!1)}var Ae=we.data,Te={},de=null;Ae==="[iFrameResizerChild]Ready"?Me():Yi()?(Te=Ot(),de=Te.id,N[de]&&(N[de].loaded=!0),!Di()&&be(de)&&($e(de,"Received: "+Ae),hn()&&Pi()&&pe())):bt(de,"Ignored: "+Ae)}function et(we,ht,Ot){var Et=null,$t=null;if(N[we])if(Et=N[we][ht],typeof Et=="function")$t=Et(Ot);else throw new TypeError(ht+" on iFrame["+we+"] is not a function");return $t}function rt(we){var ht=we.id;delete N[ht]}function Dt(we){var ht=we.id;if(et(ht,"onClose",ht)===!1){$e(ht,"Close iframe cancelled by onClose event");return}$e(ht,"Removing iFrame: "+ht);try{we.parentNode&&we.parentNode.removeChild(we)}catch(Ot){Pt(Ot)}et(ht,"onClosed",ht),$e(ht,"--"),rt(we),E&&(E.disconnect(),E=null)}function It(we){ee===null&&(ee={x:window.pageXOffset===f?document.documentElement.scrollLeft:window.pageXOffset,y:window.pageYOffset===f?document.documentElement.scrollTop:window.pageYOffset},$e(we,"Get page position: "+ee.x+","+ee.y))}function ei(we){ee!==null&&(window.scrollTo(ee.x,ee.y),$e(we,"Set page position: "+ee.x+","+ee.y),Zt())}function Zt(){ee=null}function Rt(we){function ht(){Tt(we),ft("reset","reset",we.iframe,we.id)}$e(we.id,"Size reset requested by "+(we.type==="init"?"host page":"iFrame")),It(we.id),at(ht,we,"reset")}function Tt(we){function ht(jt){if(!we.id){$e("undefined","messageData id not set");return}we.iframe.style[jt]=we[jt]+"px",$e(we.id,"IFrame ("+$t+") "+jt+" set to "+we[jt]+"px")}function Ot(jt){!G&&we[jt]==="0"&&(G=!0,$e($t,"Hidden iFrame detected, creating visibility listener"),_i())}function Et(jt){ht(jt),Ot(jt)}var $t=we.iframe.id;N[$t]&&(N[$t].sizeHeight&&Et("height"),N[$t].sizeWidth&&Et("width"))}function at(we,ht,Ot){Ot!==ht.type&&Pe&&!window.jasmine?($e(ht.id,"Requesting animation frame"),Pe(we)):we()}function ft(we,ht,Ot,Et,$t){function jt(){var ni=N[Et]&&N[Et].targetOrigin;$e(Et,"["+we+"] Sending msg to iframe["+Et+"] ("+ht+") targetOrigin: "+ni),Ot.contentWindow.postMessage(ae+ht,ni)}function Pi(){Pt(Et,"["+we+"] IFrame("+Et+") not found")}function Yi(){Ot&&"contentWindow"in Ot&&Ot.contentWindow!==null?jt():Pi()}function Di(){function ni(){N[Et]&&!N[Et].loaded&&!Ii&&(Ii=!0,Pt(Et,"IFrame has not responded within "+N[Et].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ignored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))}$t&&N[Et]&&N[Et].warningTimeout&&(N[Et].msgTimeout=setTimeout(ni,N[Et].warningTimeout))}var Ii=!1;Et=Et||Ot.id,N[Et]&&(Yi(),Di())}function xt(we){return we+":"+N[we].bodyMarginV1+":"+N[we].sizeWidth+":"+N[we].log+":"+N[we].interval+":"+N[we].enablePublicMethods+":"+N[we].autoResize+":"+N[we].bodyMargin+":"+N[we].heightCalculationMethod+":"+N[we].bodyBackground+":"+N[we].bodyPadding+":"+N[we].tolerance+":"+N[we].inPageLinks+":"+N[we].resizeFrom+":"+N[we].widthCalculationMethod+":"+N[we].mouseEvents}function ii(we){return typeof we=="number"}function Qt(we,ht){function Ot(){function ue(q){var Z=N[At][q];Z!==1/0&&Z!==0&&(we.style[q]=ii(Z)?Z+"px":Z,$e(At,"Set "+q+" = "+we.style[q]))}function j(q){if(N[At]["min"+q]>N[At]["max"+q])throw new Error("Value for min"+q+" can not be greater than max"+q)}j("Height"),j("Width"),ue("maxHeight"),ue("minHeight"),ue("maxWidth"),ue("minWidth")}function Et(){var ue=ht&&ht.id||Ee.id+s++;return document.getElementById(ue)!==null&&(ue+=s++),ue}function $t(ue){if(typeof ue!="string")throw new TypeError("Invaild id for iFrame. Expected String");return ue===""&&(we.id=ue=Et(),R=(ht||{}).log,$e(ue,"Added missing iframe ID: "+ue+" ("+we.src+")")),ue}function jt(){switch($e(At,"IFrame scrolling "+(N[At]&&N[At].scrolling?"enabled":"disabled")+" for "+At),we.style.overflow=(N[At]&&N[At].scrolling)===!1?"hidden":"auto",N[At]&&N[At].scrolling){case"omit":break;case!0:{we.scrolling="yes";break}case!1:{we.scrolling="no";break}default:we.scrolling=N[At]?N[At].scrolling:"no"}}function Pi(){(typeof(N[At]&&N[At].bodyMargin)=="number"||(N[At]&&N[At].bodyMargin)==="0")&&(N[At].bodyMarginV1=N[At].bodyMargin,N[At].bodyMargin=""+N[At].bodyMargin+"px")}function Yi(){var ue=N[At]&&N[At].firstRun,j=N[At]&&N[At].heightCalculationMethod in Ce;!ue&&j&&Rt({iframe:we,height:0,width:0,type:"init"})}function Di(){N[At]&&(N[At].iframe.iFrameResizer={close:Dt.bind(null,N[At].iframe),removeListeners:rt.bind(null,N[At].iframe),resize:ft.bind(null,"Window resize","resize",N[At].iframe),moveToAnchor:function(ue){ft("Move to anchor","moveToAnchor:"+ue,N[At].iframe,At)},sendMessage:function(ue){ue=JSON.stringify(ue),ft("Send Message","message:"+ue,N[At].iframe,At)}})}function Ii(ue){function j(){ft("iFrame.onload",ue,we,f,!0),Yi()}function q(ne){if(!we.parentNode)return null;var pe=new ne(function(be){be.forEach(function(Me){var ve=Array.prototype.slice.call(Me.removedNodes);ve.forEach(function(Ae){Ae===we&&Dt(we)})})});return pe.observe(we.parentNode,{childList:!0}),pe}var Z=He();Z&&(E=q(Z)),tt(we,"load",j),ft("init",ue,we,f,!0)}function ni(ue){if(typeof ue!="object")throw new TypeError("Options is not an object")}function tn(ue){for(var j in Ee)Object.prototype.hasOwnProperty.call(Ee,j)&&(N[At][j]=Object.prototype.hasOwnProperty.call(ue,j)?ue[j]:Ee[j])}function Ti(ue){return ue===""||ue.match(/^(about:blank|javascript:|file:\/\/)/)!==null?"*":ue}function Ui(ue){var j=ue.split("Callback");if(j.length===2){var q="on"+j[0].charAt(0).toUpperCase()+j[0].slice(1);this[q]=this[ue],delete this[ue],Pt(At,"Deprecated: '"+ue+"' has been renamed '"+q+"'. The old method will be removed in the next major version.")}}function nn(ue){ue=ue||{},N[At]=Object.create(null),N[At].iframe=we,N[At].firstRun=!0,N[At].remoteHost=we.src&&we.src.split("/").slice(0,3).join("/"),ni(ue),Object.keys(ue).forEach(Ui,ue),tn(ue),N[At]&&(N[At].targetOrigin=N[At].checkOrigin===!0?Ti(N[At].remoteHost):"*")}function hn(){return At in N&&"iFrameResizer"in we}var At=$t(we.id);hn()?Pt(At,"Ignored iFrame, already setup."):(nn(ht),jt(),Ot(),Pi(),Ii(xt(At)),Di())}function gi(we,ht){ge===null&&(ge=setTimeout(function(){ge=null,we()},ht))}var st={};function Yt(we,ht,Ot){st[Ot]||(st[Ot]=setTimeout(function(){st[Ot]=null,we()},ht))}function _i(){function we(){function $t(jt){function Pi(Di){return(N[jt]&&N[jt].iframe.style[Di])==="0px"}function Yi(Di){return Di.offsetParent!==null}N[jt]&&Yi(N[jt].iframe)&&(Pi("height")||Pi("width"))&&ft("Visibility change","resize",N[jt].iframe,jt)}Object.keys(N).forEach(function(jt){$t(jt)})}function ht($t){$e("window","Mutation observed: "+$t[0].target+" "+$t[0].type),gi(we,16)}function Ot(){var $t=document.querySelector("body"),jt={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0},Pi=new Et(ht);Pi.observe($t,jt)}var Et=He();Et&&Ot()}function qt(we){function ht(){Ci("Window "+we,"resize")}$e("window","Trigger event: "+we),gi(ht,16)}function fi(){function we(){Ci("Tab Visible","resize")}document.visibilityState!=="hidden"&&($e("document","Trigger event: Visibility change"),gi(we,16))}function Ci(we,ht){function Ot(Et){return N[Et]&&N[Et].resizeFrom==="parent"&&N[Et].autoResize&&!N[Et].firstRun}Object.keys(N).forEach(function(Et){Ot(Et)&&ft(we,ht,N[Et].iframe,Et)})}function Wi(){tt(window,"message",Ke),tt(window,"resize",function(){qt("resize")}),tt(document,"visibilitychange",fi),tt(document,"-webkit-visibilitychange",fi)}function ut(){function we(Et,$t){function jt(){if($t.tagName){if($t.tagName.toUpperCase()!=="IFRAME")throw new TypeError("Expected <IFRAME> tag, found <"+$t.tagName+">")}else throw new TypeError("Object is not a valid DOM element")}$t&&(jt(),Qt($t,Et),Ot.push($t))}function ht(Et){Et&&Et.enablePublicMethods&&Pt("enablePublicMethods option has been removed, public methods are now always available in the iFrame")}var Ot;return Ye(),Wi(),function($t,jt){switch(Ot=[],ht($t),typeof jt){case"undefined":case"string":{Array.prototype.forEach.call(document.querySelectorAll(jt||"iframe"),we.bind(f,$t));break}case"object":{we($t,jt);break}default:throw new TypeError("Unexpected data type ("+typeof jt+")")}return Ot}}function Xt(we){we.fn?we.fn.iFrameResize||(we.fn.iFrameResize=function(Ot){function Et($t,jt){Qt(jt,Ot)}return this.filter("iframe").each(Et).end()}):bt("","Unable to bind to jQuery, it is not fully loaded.")}window.jQuery!==f&&Xt(window.jQuery),b.exports=ut(),window.iFrameResize=window.iFrameResize||ut()}()})(j_);var Ib=j_.exports,N_={exports:{}};(function(b){(function(f){if(typeof window>"u")return;var s=!0,E=10,R="",G=0,S="",l=null,ae="",_e=!1,ee={resize:1,click:1},Pe=128,Ce=!0,N=1,ge="bodyOffset",Ee=ge,He=!0,tt="",Ge={},Ye=32,mt=null,dt=!1,pt=!1,$e="[iFrameSizer]",bt=$e.length,Pt="",Qe={max:1,min:1,bodyScroll:1,documentElementScroll:1},Ke="child",et=window.parent,rt="*",Dt=0,It=!1,ei=null,Zt=16,Rt=1,Tt="scroll",at=Tt,ft=window,xt=function(){ht("onMessage function not defined")},ii=function(){},Qt=function(){},gi={height:function(){return ht("Custom height calculation function not defined"),document.documentElement.offsetHeight},width:function(){return ht("Custom width calculation function not defined"),document.body.scrollWidth}},st={},Yt=!1;function _i(){}try{var qt=Object.create({},{passive:{get:function(){Yt=!0}}});window.addEventListener("test",_i,qt),window.removeEventListener("test",_i,qt)}catch{}function fi(K,De,je,Mt){K.addEventListener(De,je,Yt?Mt||{}:!1)}function Ci(K,De,je){K.removeEventListener(De,je,!1)}function Wi(K){return K.charAt(0).toUpperCase()+K.slice(1)}function ut(K){var De,je,Mt,Gt=null,Ue=0,zt=function(){Ue=Date.now(),Gt=null,Mt=K.apply(De,je),Gt||(De=je=null)};return function(){var Lt=Date.now();Ue||(Ue=Lt);var ti=Zt-(Lt-Ue);return De=this,je=arguments,ti<=0||ti>Zt?(Gt&&(clearTimeout(Gt),Gt=null),Ue=Lt,Mt=K.apply(De,je),Gt||(De=je=null)):Gt||(Gt=setTimeout(zt,ti)),Mt}}function Xt(K){return $e+"["+Pt+"] "+K}function we(K){dt&&typeof window.console=="object"&&console.log(Xt(K))}function ht(K){typeof window.console=="object"&&console.warn(Xt(K))}function Ot(){Et(),we("Initialising iFrame ("+window.location.href+")"),jt(),Di(),Yi("background",R),Yi("padding",ae),j(),Ui(),nn(),Ii(),ne(),Z(),hn(),Ge=q(),Be("init","Init message from host page"),ii()}function Et(){function K(je){return je==="true"}var De=tt.slice(bt).split(":");Pt=De[0],G=f===De[1]?G:Number(De[1]),_e=f===De[2]?_e:K(De[2]),dt=f===De[3]?dt:K(De[3]),Ye=f===De[4]?Ye:Number(De[4]),s=f===De[6]?s:K(De[6]),S=De[7],Ee=f===De[8]?Ee:De[8],R=De[9],ae=De[10],Dt=f===De[11]?Dt:Number(De[11]),Ge.enable=f===De[12]?!1:K(De[12]),Ke=f===De[13]?Ke:De[13],at=f===De[14]?at:De[14],pt=f===De[15]?pt:K(De[15])}function $t(K){var De=K.split("Callback");if(De.length===2){var je="on"+De[0].charAt(0).toUpperCase()+De[0].slice(1);this[je]=this[K],delete this[K],ht("Deprecated: '"+K+"' has been renamed '"+je+"'. The old method will be removed in the next major version.")}}function jt(){function K(){var je=window.iFrameResizer;we("Reading data from page: "+JSON.stringify(je)),Object.keys(je).forEach($t,je),xt="onMessage"in je?je.onMessage:xt,ii="onReady"in je?je.onReady:ii,rt="targetOrigin"in je?je.targetOrigin:rt,Ee="heightCalculationMethod"in je?je.heightCalculationMethod:Ee,at="widthCalculationMethod"in je?je.widthCalculationMethod:at}function De(je,Mt){return typeof je=="function"&&(we("Setup custom "+Mt+"CalcMethod"),gi[Mt]=je,je="custom"),je}"iFrameResizer"in window&&Object===window.iFrameResizer.constructor&&(K(),Ee=De(Ee,"height"),at=De(at,"width")),we("TargetOrigin for parent set to: "+rt)}function Pi(K,De){return De.indexOf("-")!==-1&&(ht("Negative CSS value ignored for "+K),De=""),De}function Yi(K,De){f!==De&&De!==""&&De!=="null"&&(document.body.style[K]=De,we("Body "+K+' set to "'+De+'"'))}function Di(){f===S&&(S=G+"px"),Yi("margin",Pi("margin",S))}function Ii(){document.documentElement.style.height="",document.body.style.height="",we('HTML & body height set to "auto"')}function ni(K){var De={add:function(je){function Mt(){Be(K.eventName,K.eventType)}st[je]=Mt,fi(window,je,Mt,{passive:!0})},remove:function(je){var Mt=st[je];delete st[je],Ci(window,je,Mt)}};K.eventNames&&Array.prototype.map?(K.eventName=K.eventNames[0],K.eventNames.map(De[K.method])):De[K.method](K.eventName),we(Wi(K.method)+" event listener: "+K.eventType)}function tn(K){ni({method:K,eventType:"Animation Start",eventNames:["animationstart","webkitAnimationStart"]}),ni({method:K,eventType:"Animation Iteration",eventNames:["animationiteration","webkitAnimationIteration"]}),ni({method:K,eventType:"Animation End",eventNames:["animationend","webkitAnimationEnd"]}),ni({method:K,eventType:"Input",eventName:"input"}),ni({method:K,eventType:"Mouse Up",eventName:"mouseup"}),ni({method:K,eventType:"Mouse Down",eventName:"mousedown"}),ni({method:K,eventType:"Orientation Change",eventName:"orientationchange"}),ni({method:K,eventType:"Print",eventNames:["afterprint","beforeprint"]}),ni({method:K,eventType:"Ready State Change",eventName:"readystatechange"}),ni({method:K,eventType:"Touch Start",eventName:"touchstart"}),ni({method:K,eventType:"Touch End",eventName:"touchend"}),ni({method:K,eventType:"Touch Cancel",eventName:"touchcancel"}),ni({method:K,eventType:"Transition Start",eventNames:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]}),ni({method:K,eventType:"Transition Iteration",eventNames:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]}),ni({method:K,eventType:"Transition End",eventNames:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]}),Ke==="child"&&ni({method:K,eventType:"IFrame Resized",eventName:"resize"})}function Ti(K,De,je,Mt){return De!==K&&(K in je||(ht(K+" is not a valid option for "+Mt+"CalculationMethod."),K=De),we(Mt+' calculation method set to "'+K+'"')),K}function Ui(){Ee=Ti(Ee,ge,V,"height")}function nn(){at=Ti(at,Tt,Q,"width")}function hn(){s===!0?(tn("add"),Me()):we("Auto Resize disabled")}function At(){l!==null&&l.disconnect()}function ue(){tn("remove"),At(),clearInterval(mt)}function j(){var K=document.createElement("div");K.style.clear="both",K.style.display="block",K.style.height="0",document.body.appendChild(K)}function q(){function K(){return{x:window.pageXOffset===f?document.documentElement.scrollLeft:window.pageXOffset,y:window.pageYOffset===f?document.documentElement.scrollTop:window.pageYOffset}}function De(ti){var bi=ti.getBoundingClientRect(),ui=K();return{x:parseInt(bi.left,10)+parseInt(ui.x,10),y:parseInt(bi.top,10)+parseInt(ui.y,10)}}function je(ti){function bi(sn){var Ei=De(sn);we("Moving to in page link (#"+ui+") at x: "+Ei.x+" y: "+Ei.y),qe(Ei.y,Ei.x,"scrollToOffset")}var ui=ti.split("#")[1]||ti,gt=decodeURIComponent(ui),Ri=document.getElementById(gt)||document.getElementsByName(gt)[0];f===Ri?(we("In page link (#"+ui+") not found in iFrame, so sending to parent"),qe(0,0,"inPageLink","#"+ui)):bi(Ri)}function Mt(){var ti=window.location.hash,bi=window.location.href;ti!==""&&ti!=="#"&&je(bi)}function Gt(){function ti(bi){function ui(gt){gt.preventDefault(),je(this.getAttribute("href"))}bi.getAttribute("href")!=="#"&&fi(bi,"click",ui)}Array.prototype.forEach.call(document.querySelectorAll('a[href^="#"]'),ti)}function Ue(){fi(window,"hashchange",Mt)}function zt(){setTimeout(Mt,Pe)}function Lt(){Array.prototype.forEach&&document.querySelectorAll?(we("Setting up location.hash handlers"),Gt(),Ue(),zt()):ht("In page linking not fully supported in this browser! (See README.md for IE8 workaround)")}return Ge.enable?Lt():we("In page linking not enabled"),{findTarget:je}}function Z(){if(pt!==!0)return;function K(je){qe(0,0,je.type,je.screenY+":"+je.screenX)}function De(je,Mt){we("Add event listener: "+Mt),fi(window.document,je,K)}De("mouseenter","Mouse Enter"),De("mouseleave","Mouse Leave")}function ne(){we("Enable public methods"),ft.parentIFrame={autoResize:function(De){return De===!0&&s===!1?(s=!0,hn()):De===!1&&s===!0&&(s=!1,ue()),qe(0,0,"autoResize",JSON.stringify(s)),s},close:function(){qe(0,0,"close")},getId:function(){return Pt},getPageInfo:function(De){typeof De=="function"?(Qt=De,qe(0,0,"pageInfo")):(Qt=function(){},qe(0,0,"pageInfoStop"))},moveToAnchor:function(De){Ge.findTarget(De)},reset:function(){Ze("parentIFrame.reset")},scrollTo:function(De,je){qe(je,De,"scrollTo")},scrollToOffset:function(De,je){qe(je,De,"scrollToOffset")},sendMessage:function(De,je){qe(0,0,"message",JSON.stringify(De),je)},setHeightCalculationMethod:function(De){Ee=De,Ui()},setWidthCalculationMethod:function(De){at=De,nn()},setTargetOrigin:function(De){we("Set targetOrigin: "+De),rt=De},size:function(De,je){var Mt=""+(De||"")+(je?","+je:"");Be("size","parentIFrame.size("+Mt+")",De,je)}}}function pe(){Ye!==0&&(we("setInterval: "+Ye+"ms"),mt=setInterval(function(){Be("interval","setInterval: "+Ye)},Math.abs(Ye)))}function be(){function K(gt){function Ri(sn){sn.complete===!1&&(we("Attach listeners to "+sn.src),sn.addEventListener("load",Gt,!1),sn.addEventListener("error",Ue,!1),ti.push(sn))}gt.type==="attributes"&&gt.attributeName==="src"?Ri(gt.target):gt.type==="childList"&&Array.prototype.forEach.call(gt.target.querySelectorAll("img"),Ri)}function De(gt){ti.splice(ti.indexOf(gt),1)}function je(gt){we("Remove listeners from "+gt.src),gt.removeEventListener("load",Gt,!1),gt.removeEventListener("error",Ue,!1),De(gt)}function Mt(gt,Ri,sn){je(gt.target),Be(Ri,sn+": "+gt.target.src)}function Gt(gt){Mt(gt,"imageLoad","Image loaded")}function Ue(gt){Mt(gt,"imageLoadFailed","Image load failed")}function zt(gt){Be("mutationObserver","mutationObserver: "+gt[0].target+" "+gt[0].type),gt.forEach(K)}function Lt(){var gt=document.querySelector("body"),Ri={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0};return ui=new bi(zt),we("Create body MutationObserver"),ui.observe(gt,Ri),ui}var ti=[],bi=window.MutationObserver||window.WebKitMutationObserver,ui=Lt();return{disconnect:function(){"disconnect"in ui&&(we("Disconnect body MutationObserver"),ui.disconnect(),ti.forEach(je))}}}function Me(){var K=0>Ye;window.MutationObserver||window.WebKitMutationObserver?K?pe():l=be():(we("MutationObserver not supported in this browser!"),pe())}function ve(K,De){var je=0;return De=De||document.body,je=document.defaultView.getComputedStyle(De,null),je=je===null?0:je[K],parseInt(je,E)}function Ae(K){K>Zt/2&&(Zt=2*K,we("Event throttle increased to "+Zt+"ms"))}function Te(K,De){for(var je=De.length,Mt=0,Gt=0,Ue=Wi(K),zt=Date.now(),Lt=0;Lt<je;Lt++)Mt=De[Lt].getBoundingClientRect()[K]+ve("margin"+Ue,De[Lt]),Mt>Gt&&(Gt=Mt);return zt=Date.now()-zt,we("Parsed "+je+" HTML elements"),we("Element position calculated in "+zt+"ms"),Ae(zt),Gt}function de(K){return[K.bodyOffset(),K.bodyScroll(),K.documentElementOffset(),K.documentElementScroll()]}function z(K,De){function je(){return ht("No tagged elements ("+De+") found on page"),document.querySelectorAll("body *")}var Mt=document.querySelectorAll("["+De+"]");return Mt.length===0&&je(),Te(K,Mt)}function k(){return document.querySelectorAll("body *")}var V={bodyOffset:function(){return document.body.offsetHeight+ve("marginTop")+ve("marginBottom")},offset:function(){return V.bodyOffset()},bodyScroll:function(){return document.body.scrollHeight},custom:function(){return gi.height()},documentElementOffset:function(){return document.documentElement.offsetHeight},documentElementScroll:function(){return document.documentElement.scrollHeight},max:function(){return Math.max.apply(null,de(V))},min:function(){return Math.min.apply(null,de(V))},grow:function(){return V.max()},lowestElement:function(){return Math.max(V.bodyOffset()||V.documentElementOffset(),Te("bottom",k()))},taggedElement:function(){return z("bottom","data-iframe-height")}},Q={bodyScroll:function(){return document.body.scrollWidth},bodyOffset:function(){return document.body.offsetWidth},custom:function(){return gi.width()},documentElementScroll:function(){return document.documentElement.scrollWidth},documentElementOffset:function(){return document.documentElement.offsetWidth},scroll:function(){return Math.max(Q.bodyScroll(),Q.documentElementScroll())},max:function(){return Math.max.apply(null,de(Q))},min:function(){return Math.min.apply(null,de(Q))},rightMostElement:function(){return Te("right",k())},taggedElement:function(){return z("right","data-iframe-width")}};function fe(K,De,je,Mt){function Gt(){N=ui,Rt=gt,qe(N,Rt,K)}function Ue(){function Ri(sn,Ei){var lo=Math.abs(sn-Ei)<=Dt;return!lo}return ui=f===je?V[Ee]():je,gt=f===Mt?Q[at]():Mt,Ri(N,ui)||_e&&Ri(Rt,gt)}function zt(){return!(K in{init:1,interval:1,size:1})}function Lt(){return Ee in Qe||_e&&at in Qe}function ti(){we("No change in size detected")}function bi(){zt()&&Lt()?Ze(De):K in{interval:1}||ti()}var ui,gt;Ue()||K==="init"?(Ve(),Gt()):bi()}var Se=ut(fe);function Be(K,De,je,Mt){function Gt(){K in{reset:1,resetPage:1,init:1}||we("Trigger event: "+De)}function Ue(){return It&&K in ee}Ue()?we("Trigger event cancelled: "+K):(Gt(),K==="init"?fe(K,De,je,Mt):Se(K,De,je,Mt))}function Ve(){It||(It=!0,we("Trigger event lock on")),clearTimeout(ei),ei=setTimeout(function(){It=!1,we("Trigger event lock off"),we("--")},Pe)}function nt(K){N=V[Ee](),Rt=Q[at](),qe(N,Rt,K)}function Ze(K){var De=Ee;Ee=ge,we("Reset trigger event: "+K),Ve(),nt("reset"),Ee=De}function qe(K,De,je,Mt,Gt){function Ue(){f===Gt?Gt=rt:we("Message targetOrigin: "+Gt)}function zt(){var Lt=K+":"+De,ti=Pt+":"+Lt+":"+je+(f===Mt?"":":"+Mt);we("Sending message to host page ("+ti+")"),et.postMessage($e+ti,Gt)}Ue(),zt()}function yt(K){var De={init:function(){tt=K.data,et=K.source,Ot(),Ce=!1,setTimeout(function(){He=!1},Pe)},reset:function(){He?we("Page reset ignored by init"):(we("Page size reset by host page"),nt("resetPage"))},resize:function(){Be("resizeParent","Parent window requested size check")},moveToAnchor:function(){Ge.findTarget(Gt())},inPageLink:function(){this.moveToAnchor()},pageInfo:function(){var ui=Gt();we("PageInfoFromParent called from parent: "+ui),Qt(JSON.parse(ui)),we(" --")},message:function(){var ui=Gt();we("onMessage called from parent: "+ui),xt(JSON.parse(ui)),we(" --")}};function je(){return $e===(""+K.data).slice(0,bt)}function Mt(){return K.data.split("]")[1].split(":")[0]}function Gt(){return K.data.slice(K.data.indexOf(":")+1)}function Ue(){return!b.exports&&"iFrameResize"in window||window.jQuery!==f&&"iFrameResize"in window.jQuery.prototype}function zt(){return K.data.split(":")[2]in{true:1,false:1}}function Lt(){var bi=Mt();bi in De?De[bi]():!Ue()&&!zt()&&ht("Unexpected message ("+K.data+")")}function ti(){Ce===!1?Lt():zt()?De.init():we('Ignored message of type "'+Mt()+'". Received before initialization.')}je()&&ti()}function Ht(){document.readyState!=="loading"&&window.parent.postMessage("[iFrameResizerChild]Ready","*")}"iframeResizer"in window||(window.iframeChildListener=function(K){yt({data:K,sameDomian:!0})},fi(window,"message",yt),fi(window,"readystatechange",Ht),Ht())})()})(N_);var Ab=N_.exports;const V0=Ib;var $_={iframeResize:V0,iframeResizer:V0,contentWindow:Ab};let U0=class extends mi{static get is(){return"toujou-iframe-resizer"}render(){return pi`
      <slot @slotchange="${this.handleSlotChange}"></slot>`}handleSlotChange(f){f.target.assignedNodes({flatten:!0}).filter(s=>s instanceof HTMLIFrameElement).forEach(s=>{let E={};try{E=JSON.parse(s.getAttribute("toujou-iframe"))||{}}catch(R){(console.error||console.log).call(console,R.stack||R)}$_.iframeResizer(E,s)})}};customElements.define(U0.is,U0);var af=["onChange","onClose","onDayCreate","onDestroy","onKeyDown","onMonthChange","onOpen","onParseConfig","onReady","onValueUpdate","onYearChange","onPreCalendarPosition"],xl={_disable:[],allowInput:!1,allowInvalidPreload:!1,altFormat:"F j, Y",altInput:!1,altInputClass:"form-control input",animate:typeof window=="object"&&window.navigator.userAgent.indexOf("MSIE")===-1,ariaDateFormat:"F j, Y",autoFillDefaultTime:!0,clickOpens:!0,closeOnSelect:!0,conjunction:", ",dateFormat:"Y-m-d",defaultHour:12,defaultMinute:0,defaultSeconds:0,disable:[],disableMobile:!1,enableSeconds:!1,enableTime:!1,errorHandler:function(b){return typeof console<"u"&&console.warn(b)},getWeek:function(b){var f=new Date(b.getTime());f.setHours(0,0,0,0),f.setDate(f.getDate()+3-(f.getDay()+6)%7);var s=new Date(f.getFullYear(),0,4);return 1+Math.round(((f.getTime()-s.getTime())/864e5-3+(s.getDay()+6)%7)/7)},hourIncrement:1,ignoredFocusElements:[],inline:!1,locale:"default",minuteIncrement:5,mode:"single",monthSelectorType:"dropdown",nextArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>",noCalendar:!1,now:new Date,onChange:[],onClose:[],onDayCreate:[],onDestroy:[],onKeyDown:[],onMonthChange:[],onOpen:[],onParseConfig:[],onReady:[],onValueUpdate:[],onYearChange:[],onPreCalendarPosition:[],plugins:[],position:"auto",positionElement:void 0,prevArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>",shorthandCurrentMonth:!1,showMonths:1,static:!1,time_24hr:!1,weekNumbers:!1,wrap:!1},su={weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:function(b){var f=b%100;if(f>3&&f<21)return"th";switch(f%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" to ",weekAbbreviation:"Wk",scrollTitle:"Scroll to increment",toggleTitle:"Click to toggle",amPM:["AM","PM"],yearAriaLabel:"Year",monthAriaLabel:"Month",hourAriaLabel:"Hour",minuteAriaLabel:"Minute",time_24hr:!1},rr=function(b,f){return f===void 0&&(f=2),("000"+b).slice(f*-1)},Cr=function(b){return b===!0?1:0};function q0(b,f){var s;return function(){var E=this,R=arguments;clearTimeout(s),s=setTimeout(function(){return b.apply(E,R)},f)}}var sf=function(b){return b instanceof Array?b:[b]};function Qn(b,f,s){if(s===!0)return b.classList.add(f);b.classList.remove(f)}function Si(b,f,s){var E=window.document.createElement(b);return f=f||"",s=s||"",E.className=f,s!==void 0&&(E.textContent=s),E}function $h(b){for(;b.firstChild;)b.removeChild(b.firstChild)}function V_(b,f){if(f(b))return b;if(b.parentNode)return V_(b.parentNode,f)}function Vh(b,f){var s=Si("div","numInputWrapper"),E=Si("input","numInput "+b),R=Si("span","arrowUp"),G=Si("span","arrowDown");if(navigator.userAgent.indexOf("MSIE 9.0")===-1?E.type="number":(E.type="text",E.pattern="\\d*"),f!==void 0)for(var S in f)E.setAttribute(S,f[S]);return s.appendChild(E),s.appendChild(R),s.appendChild(G),s}function mr(b){try{if(typeof b.composedPath=="function"){var f=b.composedPath();return f[0]}return b.target}catch{return b.target}}var lf=function(){},nd=function(b,f,s){return s.months[f?"shorthand":"longhand"][b]},zb={D:lf,F:function(b,f,s){b.setMonth(s.months.longhand.indexOf(f))},G:function(b,f){b.setHours((b.getHours()>=12?12:0)+parseFloat(f))},H:function(b,f){b.setHours(parseFloat(f))},J:function(b,f){b.setDate(parseFloat(f))},K:function(b,f,s){b.setHours(b.getHours()%12+12*Cr(new RegExp(s.amPM[1],"i").test(f)))},M:function(b,f,s){b.setMonth(s.months.shorthand.indexOf(f))},S:function(b,f){b.setSeconds(parseFloat(f))},U:function(b,f){return new Date(parseFloat(f)*1e3)},W:function(b,f,s){var E=parseInt(f),R=new Date(b.getFullYear(),0,2+(E-1)*7,0,0,0,0);return R.setDate(R.getDate()-R.getDay()+s.firstDayOfWeek),R},Y:function(b,f){b.setFullYear(parseFloat(f))},Z:function(b,f){return new Date(f)},d:function(b,f){b.setDate(parseFloat(f))},h:function(b,f){b.setHours((b.getHours()>=12?12:0)+parseFloat(f))},i:function(b,f){b.setMinutes(parseFloat(f))},j:function(b,f){b.setDate(parseFloat(f))},l:lf,m:function(b,f){b.setMonth(parseFloat(f)-1)},n:function(b,f){b.setMonth(parseFloat(f)-1)},s:function(b,f){b.setSeconds(parseFloat(f))},u:function(b,f){return new Date(parseFloat(f))},w:lf,y:function(b,f){b.setFullYear(2e3+parseFloat(f))}},ds={D:"",F:"",G:"(\\d\\d|\\d)",H:"(\\d\\d|\\d)",J:"(\\d\\d|\\d)\\w+",K:"",M:"",S:"(\\d\\d|\\d)",U:"(.+)",W:"(\\d\\d|\\d)",Y:"(\\d{4})",Z:"(.+)",d:"(\\d\\d|\\d)",h:"(\\d\\d|\\d)",i:"(\\d\\d|\\d)",j:"(\\d\\d|\\d)",l:"",m:"(\\d\\d|\\d)",n:"(\\d\\d|\\d)",s:"(\\d\\d|\\d)",u:"(.+)",w:"(\\d\\d|\\d)",y:"(\\d{2})"},Jc={Z:function(b){return b.toISOString()},D:function(b,f,s){return f.weekdays.shorthand[Jc.w(b,f,s)]},F:function(b,f,s){return nd(Jc.n(b,f,s)-1,!1,f)},G:function(b,f,s){return rr(Jc.h(b,f,s))},H:function(b){return rr(b.getHours())},J:function(b,f){return f.ordinal!==void 0?b.getDate()+f.ordinal(b.getDate()):b.getDate()},K:function(b,f){return f.amPM[Cr(b.getHours()>11)]},M:function(b,f){return nd(b.getMonth(),!0,f)},S:function(b){return rr(b.getSeconds())},U:function(b){return b.getTime()/1e3},W:function(b,f,s){return s.getWeek(b)},Y:function(b){return rr(b.getFullYear(),4)},d:function(b){return rr(b.getDate())},h:function(b){return b.getHours()%12?b.getHours()%12:12},i:function(b){return rr(b.getMinutes())},j:function(b){return b.getDate()},l:function(b,f){return f.weekdays.longhand[b.getDay()]},m:function(b){return rr(b.getMonth()+1)},n:function(b){return b.getMonth()+1},s:function(b){return b.getSeconds()},u:function(b){return b.getTime()},w:function(b){return b.getDay()},y:function(b){return String(b.getFullYear()).substring(2)}},U_=function(b){var f=b.config,s=f===void 0?xl:f,E=b.l10n,R=E===void 0?su:E,G=b.isMobile,S=G===void 0?!1:G;return function(l,ae,_e){var ee=_e||R;return s.formatDate!==void 0&&!S?s.formatDate(l,ae,ee):ae.split("").map(function(Pe,Ce,N){return Jc[Pe]&&N[Ce-1]!=="\\"?Jc[Pe](l,ee,s):Pe!=="\\"?Pe:""}).join("")}},Df=function(b){var f=b.config,s=f===void 0?xl:f,E=b.l10n,R=E===void 0?su:E;return function(G,S,l,ae){if(!(G!==0&&!G)){var _e=ae||R,ee,Pe=G;if(G instanceof Date)ee=new Date(G.getTime());else if(typeof G!="string"&&G.toFixed!==void 0)ee=new Date(G);else if(typeof G=="string"){var Ce=S||(s||xl).dateFormat,N=String(G).trim();if(N==="today")ee=new Date,l=!0;else if(s&&s.parseDate)ee=s.parseDate(G,Ce);else if(/Z$/.test(N)||/GMT$/.test(N))ee=new Date(G);else{for(var ge=void 0,Ee=[],He=0,tt=0,Ge="";He<Ce.length;He++){var Ye=Ce[He],mt=Ye==="\\",dt=Ce[He-1]==="\\"||mt;if(ds[Ye]&&!dt){Ge+=ds[Ye];var pt=new RegExp(Ge).exec(G);pt&&(ge=!0)&&Ee[Ye!=="Y"?"push":"unshift"]({fn:zb[Ye],val:pt[++tt]})}else mt||(Ge+=".")}ee=!s||!s.noCalendar?new Date(new Date().getFullYear(),0,1,0,0,0,0):new Date(new Date().setHours(0,0,0,0)),Ee.forEach(function($e){var bt=$e.fn,Pt=$e.val;return ee=bt(ee,Pt,_e)||ee}),ee=ge?ee:void 0}}if(!(ee instanceof Date&&!isNaN(ee.getTime()))){s.errorHandler(new Error("Invalid date provided: "+Pe));return}return l===!0&&ee.setHours(0,0,0,0),ee}}};function gr(b,f,s){return s===void 0&&(s=!0),s!==!1?new Date(b.getTime()).setHours(0,0,0,0)-new Date(f.getTime()).setHours(0,0,0,0):b.getTime()-f.getTime()}var Db=function(b,f,s){return b>Math.min(f,s)&&b<Math.max(f,s)},cf=function(b,f,s){return b*3600+f*60+s},Lb=function(b){var f=Math.floor(b/3600),s=(b-f*3600)/60;return[f,s,b-f*3600-s*60]},Rb={DAY:864e5};function uf(b){var f=b.defaultHour,s=b.defaultMinute,E=b.defaultSeconds;if(b.minDate!==void 0){var R=b.minDate.getHours(),G=b.minDate.getMinutes(),S=b.minDate.getSeconds();f<R&&(f=R),f===R&&s<G&&(s=G),f===R&&s===G&&E<S&&(E=b.minDate.getSeconds())}if(b.maxDate!==void 0){var l=b.maxDate.getHours(),ae=b.maxDate.getMinutes();f=Math.min(f,l),f===l&&(s=Math.min(ae,s)),f===l&&s===ae&&(E=b.maxDate.getSeconds())}return{hours:f,minutes:s,seconds:E}}typeof Object.assign!="function"&&(Object.assign=function(b){for(var f=[],s=1;s<arguments.length;s++)f[s-1]=arguments[s];if(!b)throw TypeError("Cannot convert undefined or null to object");for(var E=function(l){l&&Object.keys(l).forEach(function(ae){return b[ae]=l[ae]})},R=0,G=f;R<G.length;R++){var S=G[R];E(S)}return b});var Hn=function(){return Hn=Object.assign||function(b){for(var f,s=1,E=arguments.length;s<E;s++){f=arguments[s];for(var R in f)Object.prototype.hasOwnProperty.call(f,R)&&(b[R]=f[R])}return b},Hn.apply(this,arguments)},G0=function(){for(var b=0,f=0,s=arguments.length;f<s;f++)b+=arguments[f].length;for(var E=Array(b),R=0,f=0;f<s;f++)for(var G=arguments[f],S=0,l=G.length;S<l;S++,R++)E[R]=G[S];return E},Ob=300;function Fb(b,f){var s={config:Hn(Hn({},xl),Ki.defaultConfig),l10n:su};s.parseDate=Df({config:s.config,l10n:s.l10n}),s._handlers=[],s.pluginElements=[],s.loadedPlugins=[],s._bind=Ee,s._setHoursFromDate=Ce,s._positionCalendar=$t,s.changeMonth=ft,s.changeYear=Yt,s.clear=xt,s.close=ii,s.onMouseOver=Wi,s._createElement=Si,s.createDay=pt,s.destroy=Qt,s.isEnabled=_i,s.jumpToDate=Ge,s.updateValue=Ae,s.open=Xt,s.redraw=Yi,s.set=tn,s.setDate=Ui,s.toggle=q;function E(){s.utils={getDaysInMonth:function(z,k){return z===void 0&&(z=s.currentMonth),k===void 0&&(k=s.currentYear),z===1&&(k%4===0&&k%100!==0||k%400===0)?29:s.l10n.daysInMonth[z]}}}function R(){s.element=s.input=b,s.isOpen=!1,ht(),Et(),At(),hn(),E(),s.isMobile||dt(),tt(),(s.selectedDates.length||s.config.noCalendar)&&(s.config.enableTime&&Ce(s.config.noCalendar?s.latestSelectedDateObj:void 0),Ae(!1)),l();var z=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);!s.isMobile&&z&&$t(),Z("onReady")}function G(){var z;return((z=s.calendarContainer)===null||z===void 0?void 0:z.getRootNode()).activeElement||document.activeElement}function S(z){return z.bind(s)}function l(){var z=s.config;z.weekNumbers===!1&&z.showMonths===1||z.noCalendar!==!0&&window.requestAnimationFrame(function(){if(s.calendarContainer!==void 0&&(s.calendarContainer.style.visibility="hidden",s.calendarContainer.style.display="block"),s.daysContainer!==void 0){var k=(s.days.offsetWidth+1)*z.showMonths;s.daysContainer.style.width=k+"px",s.calendarContainer.style.width=k+(s.weekWrapper!==void 0?s.weekWrapper.offsetWidth:0)+"px",s.calendarContainer.style.removeProperty("visibility"),s.calendarContainer.style.removeProperty("display")}})}function ae(z){if(s.selectedDates.length===0){var k=s.config.minDate===void 0||gr(new Date,s.config.minDate)>=0?new Date:new Date(s.config.minDate.getTime()),V=uf(s.config);k.setHours(V.hours,V.minutes,V.seconds,k.getMilliseconds()),s.selectedDates=[k],s.latestSelectedDateObj=k}z!==void 0&&z.type!=="blur"&&de(z);var Q=s._input.value;Pe(),Ae(),s._input.value!==Q&&s._debouncedChange()}function _e(z,k){return z%12+12*Cr(k===s.l10n.amPM[1])}function ee(z){switch(z%24){case 0:case 12:return 12;default:return z%12}}function Pe(){if(!(s.hourElement===void 0||s.minuteElement===void 0)){var z=(parseInt(s.hourElement.value.slice(-2),10)||0)%24,k=(parseInt(s.minuteElement.value,10)||0)%60,V=s.secondElement!==void 0?(parseInt(s.secondElement.value,10)||0)%60:0;s.amPM!==void 0&&(z=_e(z,s.amPM.textContent));var Q=s.config.minTime!==void 0||s.config.minDate&&s.minDateHasTime&&s.latestSelectedDateObj&&gr(s.latestSelectedDateObj,s.config.minDate,!0)===0,fe=s.config.maxTime!==void 0||s.config.maxDate&&s.maxDateHasTime&&s.latestSelectedDateObj&&gr(s.latestSelectedDateObj,s.config.maxDate,!0)===0;if(s.config.maxTime!==void 0&&s.config.minTime!==void 0&&s.config.minTime>s.config.maxTime){var Se=cf(s.config.minTime.getHours(),s.config.minTime.getMinutes(),s.config.minTime.getSeconds()),Be=cf(s.config.maxTime.getHours(),s.config.maxTime.getMinutes(),s.config.maxTime.getSeconds()),Ve=cf(z,k,V);if(Ve>Be&&Ve<Se){var nt=Lb(Se);z=nt[0],k=nt[1],V=nt[2]}}else{if(fe){var Ze=s.config.maxTime!==void 0?s.config.maxTime:s.config.maxDate;z=Math.min(z,Ze.getHours()),z===Ze.getHours()&&(k=Math.min(k,Ze.getMinutes())),k===Ze.getMinutes()&&(V=Math.min(V,Ze.getSeconds()))}if(Q){var qe=s.config.minTime!==void 0?s.config.minTime:s.config.minDate;z=Math.max(z,qe.getHours()),z===qe.getHours()&&k<qe.getMinutes()&&(k=qe.getMinutes()),k===qe.getMinutes()&&(V=Math.max(V,qe.getSeconds()))}}N(z,k,V)}}function Ce(z){var k=z||s.latestSelectedDateObj;k&&k instanceof Date&&N(k.getHours(),k.getMinutes(),k.getSeconds())}function N(z,k,V){s.latestSelectedDateObj!==void 0&&s.latestSelectedDateObj.setHours(z%24,k,V||0,0),!(!s.hourElement||!s.minuteElement||s.isMobile)&&(s.hourElement.value=rr(s.config.time_24hr?z:(12+z)%12+12*Cr(z%12===0)),s.minuteElement.value=rr(k),s.amPM!==void 0&&(s.amPM.textContent=s.l10n.amPM[Cr(z>=12)]),s.secondElement!==void 0&&(s.secondElement.value=rr(V)))}function ge(z){var k=mr(z),V=parseInt(k.value)+(z.delta||0);(V/1e3>1||z.key==="Enter"&&!/[^\d]/.test(V.toString()))&&Yt(V)}function Ee(z,k,V,Q){if(k instanceof Array)return k.forEach(function(fe){return Ee(z,fe,V,Q)});if(z instanceof Array)return z.forEach(function(fe){return Ee(fe,k,V,Q)});z.addEventListener(k,V,Q),s._handlers.push({remove:function(){return z.removeEventListener(k,V,Q)}})}function He(){Z("onChange")}function tt(){if(s.config.wrap&&["open","close","toggle","clear"].forEach(function(V){Array.prototype.forEach.call(s.element.querySelectorAll("[data-"+V+"]"),function(Q){return Ee(Q,"click",s[V])})}),s.isMobile){j();return}var z=q0(ut,50);if(s._debouncedChange=q0(He,Ob),s.daysContainer&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&Ee(s.daysContainer,"mouseover",function(V){s.config.mode==="range"&&Wi(mr(V))}),Ee(s._input,"keydown",Ci),s.calendarContainer!==void 0&&Ee(s.calendarContainer,"keydown",Ci),!s.config.inline&&!s.config.static&&Ee(window,"resize",z),window.ontouchstart!==void 0?Ee(window.document,"touchstart",st):Ee(window.document,"mousedown",st),Ee(window.document,"focus",st,{capture:!0}),s.config.clickOpens===!0&&(Ee(s._input,"focus",s.open),Ee(s._input,"click",s.open)),s.daysContainer!==void 0&&(Ee(s.monthNav,"click",Te),Ee(s.monthNav,["keyup","increment"],ge),Ee(s.daysContainer,"click",Ii)),s.timeContainer!==void 0&&s.minuteElement!==void 0&&s.hourElement!==void 0){var k=function(V){return mr(V).select()};Ee(s.timeContainer,["increment"],ae),Ee(s.timeContainer,"blur",ae,{capture:!0}),Ee(s.timeContainer,"click",Ye),Ee([s.hourElement,s.minuteElement],["focus","click"],k),s.secondElement!==void 0&&Ee(s.secondElement,"focus",function(){return s.secondElement&&s.secondElement.select()}),s.amPM!==void 0&&Ee(s.amPM,"click",function(V){ae(V)})}s.config.allowInput&&Ee(s._input,"blur",fi)}function Ge(z,k){var V=z!==void 0?s.parseDate(z):s.latestSelectedDateObj||(s.config.minDate&&s.config.minDate>s.now?s.config.minDate:s.config.maxDate&&s.config.maxDate<s.now?s.config.maxDate:s.now),Q=s.currentYear,fe=s.currentMonth;try{V!==void 0&&(s.currentYear=V.getFullYear(),s.currentMonth=V.getMonth())}catch(Se){Se.message="Invalid date supplied: "+V,s.config.errorHandler(Se)}k&&s.currentYear!==Q&&(Z("onYearChange"),rt()),k&&(s.currentYear!==Q||s.currentMonth!==fe)&&Z("onMonthChange"),s.redraw()}function Ye(z){var k=mr(z);~k.className.indexOf("arrow")&&mt(z,k.classList.contains("arrowUp")?1:-1)}function mt(z,k,V){var Q=z&&mr(z),fe=V||Q&&Q.parentNode&&Q.parentNode.firstChild,Se=ne("increment");Se.delta=k,fe&&fe.dispatchEvent(Se)}function dt(){var z=window.document.createDocumentFragment();if(s.calendarContainer=Si("div","flatpickr-calendar"),s.calendarContainer.tabIndex=-1,!s.config.noCalendar){if(z.appendChild(ei()),s.innerContainer=Si("div","flatpickr-innerContainer"),s.config.weekNumbers){var k=at(),V=k.weekWrapper,Q=k.weekNumbers;s.innerContainer.appendChild(V),s.weekNumbers=Q,s.weekWrapper=V}s.rContainer=Si("div","flatpickr-rContainer"),s.rContainer.appendChild(Rt()),s.daysContainer||(s.daysContainer=Si("div","flatpickr-days"),s.daysContainer.tabIndex=-1),et(),s.rContainer.appendChild(s.daysContainer),s.innerContainer.appendChild(s.rContainer),z.appendChild(s.innerContainer)}s.config.enableTime&&z.appendChild(Zt()),Qn(s.calendarContainer,"rangeMode",s.config.mode==="range"),Qn(s.calendarContainer,"animate",s.config.animate===!0),Qn(s.calendarContainer,"multiMonth",s.config.showMonths>1),s.calendarContainer.appendChild(z);var fe=s.config.appendTo!==void 0&&s.config.appendTo.nodeType!==void 0;if((s.config.inline||s.config.static)&&(s.calendarContainer.classList.add(s.config.inline?"inline":"static"),s.config.inline&&(!fe&&s.element.parentNode?s.element.parentNode.insertBefore(s.calendarContainer,s._input.nextSibling):s.config.appendTo!==void 0&&s.config.appendTo.appendChild(s.calendarContainer)),s.config.static)){var Se=Si("div","flatpickr-wrapper");s.element.parentNode&&s.element.parentNode.insertBefore(Se,s.element),Se.appendChild(s.element),s.altInput&&Se.appendChild(s.altInput),Se.appendChild(s.calendarContainer)}!s.config.static&&!s.config.inline&&(s.config.appendTo!==void 0?s.config.appendTo:window.document.body).appendChild(s.calendarContainer)}function pt(z,k,V,Q){var fe=_i(k,!0),Se=Si("span",z,k.getDate().toString());return Se.dateObj=k,Se.$i=Q,Se.setAttribute("aria-label",s.formatDate(k,s.config.ariaDateFormat)),z.indexOf("hidden")===-1&&gr(k,s.now)===0&&(s.todayDateElem=Se,Se.classList.add("today"),Se.setAttribute("aria-current","date")),fe?(Se.tabIndex=-1,pe(k)&&(Se.classList.add("selected"),s.selectedDateElem=Se,s.config.mode==="range"&&(Qn(Se,"startRange",s.selectedDates[0]&&gr(k,s.selectedDates[0],!0)===0),Qn(Se,"endRange",s.selectedDates[1]&&gr(k,s.selectedDates[1],!0)===0),z==="nextMonthDay"&&Se.classList.add("inRange")))):Se.classList.add("flatpickr-disabled"),s.config.mode==="range"&&be(k)&&!pe(k)&&Se.classList.add("inRange"),s.weekNumbers&&s.config.showMonths===1&&z!=="prevMonthDay"&&Q%7===6&&s.weekNumbers.insertAdjacentHTML("beforeend","<span class='flatpickr-day'>"+s.config.getWeek(k)+"</span>"),Z("onDayCreate",Se),Se}function $e(z){z.focus(),s.config.mode==="range"&&Wi(z)}function bt(z){for(var k=z>0?0:s.config.showMonths-1,V=z>0?s.config.showMonths:-1,Q=k;Q!=V;Q+=z)for(var fe=s.daysContainer.children[Q],Se=z>0?0:fe.children.length-1,Be=z>0?fe.children.length:-1,Ve=Se;Ve!=Be;Ve+=z){var nt=fe.children[Ve];if(nt.className.indexOf("hidden")===-1&&_i(nt.dateObj))return nt}}function Pt(z,k){for(var V=z.className.indexOf("Month")===-1?z.dateObj.getMonth():s.currentMonth,Q=k>0?s.config.showMonths:-1,fe=k>0?1:-1,Se=V-s.currentMonth;Se!=Q;Se+=fe)for(var Be=s.daysContainer.children[Se],Ve=V-s.currentMonth===Se?z.$i+k:k<0?Be.children.length-1:0,nt=Be.children.length,Ze=Ve;Ze>=0&&Ze<nt&&Ze!=(k>0?nt:-1);Ze+=fe){var qe=Be.children[Ze];if(qe.className.indexOf("hidden")===-1&&_i(qe.dateObj)&&Math.abs(z.$i-Ze)>=Math.abs(k))return $e(qe)}s.changeMonth(fe),Qe(bt(fe),0)}function Qe(z,k){var V=G(),Q=qt(V||document.body),fe=z!==void 0?z:Q?V:s.selectedDateElem!==void 0&&qt(s.selectedDateElem)?s.selectedDateElem:s.todayDateElem!==void 0&&qt(s.todayDateElem)?s.todayDateElem:bt(k>0?1:-1);fe===void 0?s._input.focus():Q?Pt(fe,k):$e(fe)}function Ke(z,k){for(var V=(new Date(z,k,1).getDay()-s.l10n.firstDayOfWeek+7)%7,Q=s.utils.getDaysInMonth((k-1+12)%12,z),fe=s.utils.getDaysInMonth(k,z),Se=window.document.createDocumentFragment(),Be=s.config.showMonths>1,Ve=Be?"prevMonthDay hidden":"prevMonthDay",nt=Be?"nextMonthDay hidden":"nextMonthDay",Ze=Q+1-V,qe=0;Ze<=Q;Ze++,qe++)Se.appendChild(pt("flatpickr-day "+Ve,new Date(z,k-1,Ze),Ze,qe));for(Ze=1;Ze<=fe;Ze++,qe++)Se.appendChild(pt("flatpickr-day",new Date(z,k,Ze),Ze,qe));for(var yt=fe+1;yt<=42-V&&(s.config.showMonths===1||qe%7!==0);yt++,qe++)Se.appendChild(pt("flatpickr-day "+nt,new Date(z,k+1,yt%fe),yt,qe));var Ht=Si("div","dayContainer");return Ht.appendChild(Se),Ht}function et(){if(s.daysContainer!==void 0){$h(s.daysContainer),s.weekNumbers&&$h(s.weekNumbers);for(var z=document.createDocumentFragment(),k=0;k<s.config.showMonths;k++){var V=new Date(s.currentYear,s.currentMonth,1);V.setMonth(s.currentMonth+k),z.appendChild(Ke(V.getFullYear(),V.getMonth()))}s.daysContainer.appendChild(z),s.days=s.daysContainer.firstChild,s.config.mode==="range"&&s.selectedDates.length===1&&Wi()}}function rt(){if(!(s.config.showMonths>1||s.config.monthSelectorType!=="dropdown")){var z=function(Q){return s.config.minDate!==void 0&&s.currentYear===s.config.minDate.getFullYear()&&Q<s.config.minDate.getMonth()?!1:!(s.config.maxDate!==void 0&&s.currentYear===s.config.maxDate.getFullYear()&&Q>s.config.maxDate.getMonth())};s.monthsDropdownContainer.tabIndex=-1,s.monthsDropdownContainer.innerHTML="";for(var k=0;k<12;k++)if(z(k)){var V=Si("option","flatpickr-monthDropdown-month");V.value=new Date(s.currentYear,k).getMonth().toString(),V.textContent=nd(k,s.config.shorthandCurrentMonth,s.l10n),V.tabIndex=-1,s.currentMonth===k&&(V.selected=!0),s.monthsDropdownContainer.appendChild(V)}}}function Dt(){var z=Si("div","flatpickr-month"),k=window.document.createDocumentFragment(),V;s.config.showMonths>1||s.config.monthSelectorType==="static"?V=Si("span","cur-month"):(s.monthsDropdownContainer=Si("select","flatpickr-monthDropdown-months"),s.monthsDropdownContainer.setAttribute("aria-label",s.l10n.monthAriaLabel),Ee(s.monthsDropdownContainer,"change",function(Be){var Ve=mr(Be),nt=parseInt(Ve.value,10);s.changeMonth(nt-s.currentMonth),Z("onMonthChange")}),rt(),V=s.monthsDropdownContainer);var Q=Vh("cur-year",{tabindex:"-1"}),fe=Q.getElementsByTagName("input")[0];fe.setAttribute("aria-label",s.l10n.yearAriaLabel),s.config.minDate&&fe.setAttribute("min",s.config.minDate.getFullYear().toString()),s.config.maxDate&&(fe.setAttribute("max",s.config.maxDate.getFullYear().toString()),fe.disabled=!!s.config.minDate&&s.config.minDate.getFullYear()===s.config.maxDate.getFullYear());var Se=Si("div","flatpickr-current-month");return Se.appendChild(V),Se.appendChild(Q),k.appendChild(Se),z.appendChild(k),{container:z,yearElement:fe,monthElement:V}}function It(){$h(s.monthNav),s.monthNav.appendChild(s.prevMonthNav),s.config.showMonths&&(s.yearElements=[],s.monthElements=[]);for(var z=s.config.showMonths;z--;){var k=Dt();s.yearElements.push(k.yearElement),s.monthElements.push(k.monthElement),s.monthNav.appendChild(k.container)}s.monthNav.appendChild(s.nextMonthNav)}function ei(){return s.monthNav=Si("div","flatpickr-months"),s.yearElements=[],s.monthElements=[],s.prevMonthNav=Si("span","flatpickr-prev-month"),s.prevMonthNav.innerHTML=s.config.prevArrow,s.nextMonthNav=Si("span","flatpickr-next-month"),s.nextMonthNav.innerHTML=s.config.nextArrow,It(),Object.defineProperty(s,"_hidePrevMonthArrow",{get:function(){return s.__hidePrevMonthArrow},set:function(z){s.__hidePrevMonthArrow!==z&&(Qn(s.prevMonthNav,"flatpickr-disabled",z),s.__hidePrevMonthArrow=z)}}),Object.defineProperty(s,"_hideNextMonthArrow",{get:function(){return s.__hideNextMonthArrow},set:function(z){s.__hideNextMonthArrow!==z&&(Qn(s.nextMonthNav,"flatpickr-disabled",z),s.__hideNextMonthArrow=z)}}),s.currentYearElement=s.yearElements[0],Me(),s.monthNav}function Zt(){s.calendarContainer.classList.add("hasTime"),s.config.noCalendar&&s.calendarContainer.classList.add("noCalendar");var z=uf(s.config);s.timeContainer=Si("div","flatpickr-time"),s.timeContainer.tabIndex=-1;var k=Si("span","flatpickr-time-separator",":"),V=Vh("flatpickr-hour",{"aria-label":s.l10n.hourAriaLabel});s.hourElement=V.getElementsByTagName("input")[0];var Q=Vh("flatpickr-minute",{"aria-label":s.l10n.minuteAriaLabel});if(s.minuteElement=Q.getElementsByTagName("input")[0],s.hourElement.tabIndex=s.minuteElement.tabIndex=-1,s.hourElement.value=rr(s.latestSelectedDateObj?s.latestSelectedDateObj.getHours():s.config.time_24hr?z.hours:ee(z.hours)),s.minuteElement.value=rr(s.latestSelectedDateObj?s.latestSelectedDateObj.getMinutes():z.minutes),s.hourElement.setAttribute("step",s.config.hourIncrement.toString()),s.minuteElement.setAttribute("step",s.config.minuteIncrement.toString()),s.hourElement.setAttribute("min",s.config.time_24hr?"0":"1"),s.hourElement.setAttribute("max",s.config.time_24hr?"23":"12"),s.hourElement.setAttribute("maxlength","2"),s.minuteElement.setAttribute("min","0"),s.minuteElement.setAttribute("max","59"),s.minuteElement.setAttribute("maxlength","2"),s.timeContainer.appendChild(V),s.timeContainer.appendChild(k),s.timeContainer.appendChild(Q),s.config.time_24hr&&s.timeContainer.classList.add("time24hr"),s.config.enableSeconds){s.timeContainer.classList.add("hasSeconds");var fe=Vh("flatpickr-second");s.secondElement=fe.getElementsByTagName("input")[0],s.secondElement.value=rr(s.latestSelectedDateObj?s.latestSelectedDateObj.getSeconds():z.seconds),s.secondElement.setAttribute("step",s.minuteElement.getAttribute("step")),s.secondElement.setAttribute("min","0"),s.secondElement.setAttribute("max","59"),s.secondElement.setAttribute("maxlength","2"),s.timeContainer.appendChild(Si("span","flatpickr-time-separator",":")),s.timeContainer.appendChild(fe)}return s.config.time_24hr||(s.amPM=Si("span","flatpickr-am-pm",s.l10n.amPM[Cr((s.latestSelectedDateObj?s.hourElement.value:s.config.defaultHour)>11)]),s.amPM.title=s.l10n.toggleTitle,s.amPM.tabIndex=-1,s.timeContainer.appendChild(s.amPM)),s.timeContainer}function Rt(){s.weekdayContainer?$h(s.weekdayContainer):s.weekdayContainer=Si("div","flatpickr-weekdays");for(var z=s.config.showMonths;z--;){var k=Si("div","flatpickr-weekdaycontainer");s.weekdayContainer.appendChild(k)}return Tt(),s.weekdayContainer}function Tt(){if(s.weekdayContainer){var z=s.l10n.firstDayOfWeek,k=G0(s.l10n.weekdays.shorthand);z>0&&z<k.length&&(k=G0(k.splice(z,k.length),k.splice(0,z)));for(var V=s.config.showMonths;V--;)s.weekdayContainer.children[V].innerHTML=`
      <span class='flatpickr-weekday'>
        `+k.join("</span><span class='flatpickr-weekday'>")+`
      </span>
      `}}function at(){s.calendarContainer.classList.add("hasWeeks");var z=Si("div","flatpickr-weekwrapper");z.appendChild(Si("span","flatpickr-weekday",s.l10n.weekAbbreviation));var k=Si("div","flatpickr-weeks");return z.appendChild(k),{weekWrapper:z,weekNumbers:k}}function ft(z,k){k===void 0&&(k=!0);var V=k?z:z-s.currentMonth;V<0&&s._hidePrevMonthArrow===!0||V>0&&s._hideNextMonthArrow===!0||(s.currentMonth+=V,(s.currentMonth<0||s.currentMonth>11)&&(s.currentYear+=s.currentMonth>11?1:-1,s.currentMonth=(s.currentMonth+12)%12,Z("onYearChange"),rt()),et(),Z("onMonthChange"),Me())}function xt(z,k){if(z===void 0&&(z=!0),k===void 0&&(k=!0),s.input.value="",s.altInput!==void 0&&(s.altInput.value=""),s.mobileInput!==void 0&&(s.mobileInput.value=""),s.selectedDates=[],s.latestSelectedDateObj=void 0,k===!0&&(s.currentYear=s._initialDate.getFullYear(),s.currentMonth=s._initialDate.getMonth()),s.config.enableTime===!0){var V=uf(s.config),Q=V.hours,fe=V.minutes,Se=V.seconds;N(Q,fe,Se)}s.redraw(),z&&Z("onChange")}function ii(){s.isOpen=!1,s.isMobile||(s.calendarContainer!==void 0&&s.calendarContainer.classList.remove("open"),s._input!==void 0&&s._input.classList.remove("active")),Z("onClose")}function Qt(){s.config!==void 0&&Z("onDestroy");for(var z=s._handlers.length;z--;)s._handlers[z].remove();if(s._handlers=[],s.mobileInput)s.mobileInput.parentNode&&s.mobileInput.parentNode.removeChild(s.mobileInput),s.mobileInput=void 0;else if(s.calendarContainer&&s.calendarContainer.parentNode)if(s.config.static&&s.calendarContainer.parentNode){var k=s.calendarContainer.parentNode;if(k.lastChild&&k.removeChild(k.lastChild),k.parentNode){for(;k.firstChild;)k.parentNode.insertBefore(k.firstChild,k);k.parentNode.removeChild(k)}}else s.calendarContainer.parentNode.removeChild(s.calendarContainer);s.altInput&&(s.input.type="text",s.altInput.parentNode&&s.altInput.parentNode.removeChild(s.altInput),delete s.altInput),s.input&&(s.input.type=s.input._type,s.input.classList.remove("flatpickr-input"),s.input.removeAttribute("readonly")),["_showTimeInput","latestSelectedDateObj","_hideNextMonthArrow","_hidePrevMonthArrow","__hideNextMonthArrow","__hidePrevMonthArrow","isMobile","isOpen","selectedDateElem","minDateHasTime","maxDateHasTime","days","daysContainer","_input","_positionElement","innerContainer","rContainer","monthNav","todayDateElem","calendarContainer","weekdayContainer","prevMonthNav","nextMonthNav","monthsDropdownContainer","currentMonthElement","currentYearElement","navigationCurrentMonth","selectedDateElem","config"].forEach(function(V){try{delete s[V]}catch{}})}function gi(z){return s.calendarContainer.contains(z)}function st(z){if(s.isOpen&&!s.config.inline){var k=mr(z),V=gi(k),Q=k===s.input||k===s.altInput||s.element.contains(k)||z.path&&z.path.indexOf&&(~z.path.indexOf(s.input)||~z.path.indexOf(s.altInput)),fe=!Q&&!V&&!gi(z.relatedTarget),Se=!s.config.ignoredFocusElements.some(function(Be){return Be.contains(k)});fe&&Se&&(s.config.allowInput&&s.setDate(s._input.value,!1,s.config.altInput?s.config.altFormat:s.config.dateFormat),s.timeContainer!==void 0&&s.minuteElement!==void 0&&s.hourElement!==void 0&&s.input.value!==""&&s.input.value!==void 0&&ae(),s.close(),s.config&&s.config.mode==="range"&&s.selectedDates.length===1&&s.clear(!1))}}function Yt(z){if(!(!z||s.config.minDate&&z<s.config.minDate.getFullYear()||s.config.maxDate&&z>s.config.maxDate.getFullYear())){var k=z,V=s.currentYear!==k;s.currentYear=k||s.currentYear,s.config.maxDate&&s.currentYear===s.config.maxDate.getFullYear()?s.currentMonth=Math.min(s.config.maxDate.getMonth(),s.currentMonth):s.config.minDate&&s.currentYear===s.config.minDate.getFullYear()&&(s.currentMonth=Math.max(s.config.minDate.getMonth(),s.currentMonth)),V&&(s.redraw(),Z("onYearChange"),rt())}}function _i(z,k){var V;k===void 0&&(k=!0);var Q=s.parseDate(z,void 0,k);if(s.config.minDate&&Q&&gr(Q,s.config.minDate,k!==void 0?k:!s.minDateHasTime)<0||s.config.maxDate&&Q&&gr(Q,s.config.maxDate,k!==void 0?k:!s.maxDateHasTime)>0)return!1;if(!s.config.enable&&s.config.disable.length===0)return!0;if(Q===void 0)return!1;for(var fe=!!s.config.enable,Se=(V=s.config.enable)!==null&&V!==void 0?V:s.config.disable,Be=0,Ve=void 0;Be<Se.length;Be++){if(Ve=Se[Be],typeof Ve=="function"&&Ve(Q))return fe;if(Ve instanceof Date&&Q!==void 0&&Ve.getTime()===Q.getTime())return fe;if(typeof Ve=="string"){var nt=s.parseDate(Ve,void 0,!0);return nt&&nt.getTime()===Q.getTime()?fe:!fe}else if(typeof Ve=="object"&&Q!==void 0&&Ve.from&&Ve.to&&Q.getTime()>=Ve.from.getTime()&&Q.getTime()<=Ve.to.getTime())return fe}return!fe}function qt(z){return s.daysContainer!==void 0?z.className.indexOf("hidden")===-1&&z.className.indexOf("flatpickr-disabled")===-1&&s.daysContainer.contains(z):!1}function fi(z){var k=z.target===s._input,V=s._input.value.trimEnd()!==ve();k&&V&&!(z.relatedTarget&&gi(z.relatedTarget))&&s.setDate(s._input.value,!0,z.target===s.altInput?s.config.altFormat:s.config.dateFormat)}function Ci(z){var k=mr(z),V=s.config.wrap?b.contains(k):k===s._input,Q=s.config.allowInput,fe=s.isOpen&&(!Q||!V),Se=s.config.inline&&V&&!Q;if(z.keyCode===13&&V){if(Q)return s.setDate(s._input.value,!0,k===s.altInput?s.config.altFormat:s.config.dateFormat),s.close(),k.blur();s.open()}else if(gi(k)||fe||Se){var Be=!!s.timeContainer&&s.timeContainer.contains(k);switch(z.keyCode){case 13:Be?(z.preventDefault(),ae(),Di()):Ii(z);break;case 27:z.preventDefault(),Di();break;case 8:case 46:V&&!s.config.allowInput&&(z.preventDefault(),s.clear());break;case 37:case 39:if(!Be&&!V){z.preventDefault();var Ve=G();if(s.daysContainer!==void 0&&(Q===!1||Ve&&qt(Ve))){var nt=z.keyCode===39?1:-1;z.ctrlKey?(z.stopPropagation(),ft(nt),Qe(bt(1),0)):Qe(void 0,nt)}}else s.hourElement&&s.hourElement.focus();break;case 38:case 40:z.preventDefault();var Ze=z.keyCode===40?1:-1;s.daysContainer&&k.$i!==void 0||k===s.input||k===s.altInput?z.ctrlKey?(z.stopPropagation(),Yt(s.currentYear-Ze),Qe(bt(1),0)):Be||Qe(void 0,Ze*7):k===s.currentYearElement?Yt(s.currentYear-Ze):s.config.enableTime&&(!Be&&s.hourElement&&s.hourElement.focus(),ae(z),s._debouncedChange());break;case 9:if(Be){var qe=[s.hourElement,s.minuteElement,s.secondElement,s.amPM].concat(s.pluginElements).filter(function(K){return K}),yt=qe.indexOf(k);if(yt!==-1){var Ht=qe[yt+(z.shiftKey?-1:1)];z.preventDefault(),(Ht||s._input).focus()}}else!s.config.noCalendar&&s.daysContainer&&s.daysContainer.contains(k)&&z.shiftKey&&(z.preventDefault(),s._input.focus());break}}if(s.amPM!==void 0&&k===s.amPM)switch(z.key){case s.l10n.amPM[0].charAt(0):case s.l10n.amPM[0].charAt(0).toLowerCase():s.amPM.textContent=s.l10n.amPM[0],Pe(),Ae();break;case s.l10n.amPM[1].charAt(0):case s.l10n.amPM[1].charAt(0).toLowerCase():s.amPM.textContent=s.l10n.amPM[1],Pe(),Ae();break}(V||gi(k))&&Z("onKeyDown",z)}function Wi(z,k){if(k===void 0&&(k="flatpickr-day"),!(s.selectedDates.length!==1||z&&(!z.classList.contains(k)||z.classList.contains("flatpickr-disabled")))){for(var V=z?z.dateObj.getTime():s.days.firstElementChild.dateObj.getTime(),Q=s.parseDate(s.selectedDates[0],void 0,!0).getTime(),fe=Math.min(V,s.selectedDates[0].getTime()),Se=Math.max(V,s.selectedDates[0].getTime()),Be=!1,Ve=0,nt=0,Ze=fe;Ze<Se;Ze+=Rb.DAY)_i(new Date(Ze),!0)||(Be=Be||Ze>fe&&Ze<Se,Ze<Q&&(!Ve||Ze>Ve)?Ve=Ze:Ze>Q&&(!nt||Ze<nt)&&(nt=Ze));var qe=Array.from(s.rContainer.querySelectorAll("*:nth-child(-n+"+s.config.showMonths+") > ."+k));qe.forEach(function(yt){var Ht=yt.dateObj,K=Ht.getTime(),De=Ve>0&&K<Ve||nt>0&&K>nt;if(De){yt.classList.add("notAllowed"),["inRange","startRange","endRange"].forEach(function(je){yt.classList.remove(je)});return}else if(Be&&!De)return;["startRange","inRange","endRange","notAllowed"].forEach(function(je){yt.classList.remove(je)}),z!==void 0&&(z.classList.add(V<=s.selectedDates[0].getTime()?"startRange":"endRange"),Q<V&&K===Q?yt.classList.add("startRange"):Q>V&&K===Q&&yt.classList.add("endRange"),K>=Ve&&(nt===0||K<=nt)&&Db(K,Q,V)&&yt.classList.add("inRange"))})}}function ut(){s.isOpen&&!s.config.static&&!s.config.inline&&$t()}function Xt(z,k){if(k===void 0&&(k=s._positionElement),s.isMobile===!0){if(z){z.preventDefault();var V=mr(z);V&&V.blur()}s.mobileInput!==void 0&&(s.mobileInput.focus(),s.mobileInput.click()),Z("onOpen");return}else if(s._input.disabled||s.config.inline)return;var Q=s.isOpen;s.isOpen=!0,Q||(s.calendarContainer.classList.add("open"),s._input.classList.add("active"),Z("onOpen"),$t(k)),s.config.enableTime===!0&&s.config.noCalendar===!0&&s.config.allowInput===!1&&(z===void 0||!s.timeContainer.contains(z.relatedTarget))&&setTimeout(function(){return s.hourElement.select()},50)}function we(z){return function(k){var V=s.config["_"+z+"Date"]=s.parseDate(k,s.config.dateFormat),Q=s.config["_"+(z==="min"?"max":"min")+"Date"];V!==void 0&&(s[z==="min"?"minDateHasTime":"maxDateHasTime"]=V.getHours()>0||V.getMinutes()>0||V.getSeconds()>0),s.selectedDates&&(s.selectedDates=s.selectedDates.filter(function(fe){return _i(fe)}),!s.selectedDates.length&&z==="min"&&Ce(V),Ae()),s.daysContainer&&(Yi(),V!==void 0?s.currentYearElement[z]=V.getFullYear().toString():s.currentYearElement.removeAttribute(z),s.currentYearElement.disabled=!!Q&&V!==void 0&&Q.getFullYear()===V.getFullYear())}}function ht(){var z=["wrap","weekNumbers","allowInput","allowInvalidPreload","clickOpens","time_24hr","enableTime","noCalendar","altInput","shorthandCurrentMonth","inline","static","enableSeconds","disableMobile"],k=Hn(Hn({},JSON.parse(JSON.stringify(b.dataset||{}))),f),V={};s.config.parseDate=k.parseDate,s.config.formatDate=k.formatDate,Object.defineProperty(s.config,"enable",{get:function(){return s.config._enable},set:function(qe){s.config._enable=nn(qe)}}),Object.defineProperty(s.config,"disable",{get:function(){return s.config._disable},set:function(qe){s.config._disable=nn(qe)}});var Q=k.mode==="time";if(!k.dateFormat&&(k.enableTime||Q)){var fe=Ki.defaultConfig.dateFormat||xl.dateFormat;V.dateFormat=k.noCalendar||Q?"H:i"+(k.enableSeconds?":S":""):fe+" H:i"+(k.enableSeconds?":S":"")}if(k.altInput&&(k.enableTime||Q)&&!k.altFormat){var Se=Ki.defaultConfig.altFormat||xl.altFormat;V.altFormat=k.noCalendar||Q?"h:i"+(k.enableSeconds?":S K":" K"):Se+(" h:i"+(k.enableSeconds?":S":"")+" K")}Object.defineProperty(s.config,"minDate",{get:function(){return s.config._minDate},set:we("min")}),Object.defineProperty(s.config,"maxDate",{get:function(){return s.config._maxDate},set:we("max")});var Be=function(qe){return function(yt){s.config[qe==="min"?"_minTime":"_maxTime"]=s.parseDate(yt,"H:i:S")}};Object.defineProperty(s.config,"minTime",{get:function(){return s.config._minTime},set:Be("min")}),Object.defineProperty(s.config,"maxTime",{get:function(){return s.config._maxTime},set:Be("max")}),k.mode==="time"&&(s.config.noCalendar=!0,s.config.enableTime=!0),Object.assign(s.config,V,k);for(var Ve=0;Ve<z.length;Ve++)s.config[z[Ve]]=s.config[z[Ve]]===!0||s.config[z[Ve]]==="true";af.filter(function(qe){return s.config[qe]!==void 0}).forEach(function(qe){s.config[qe]=sf(s.config[qe]||[]).map(S)}),s.isMobile=!s.config.disableMobile&&!s.config.inline&&s.config.mode==="single"&&!s.config.disable.length&&!s.config.enable&&!s.config.weekNumbers&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(var Ve=0;Ve<s.config.plugins.length;Ve++){var nt=s.config.plugins[Ve](s)||{};for(var Ze in nt)af.indexOf(Ze)>-1?s.config[Ze]=sf(nt[Ze]).map(S).concat(s.config[Ze]):typeof k[Ze]>"u"&&(s.config[Ze]=nt[Ze])}k.altInputClass||(s.config.altInputClass=Ot().className+" "+s.config.altInputClass),Z("onParseConfig")}function Ot(){return s.config.wrap?b.querySelector("[data-input]"):b}function Et(){typeof s.config.locale!="object"&&typeof Ki.l10ns[s.config.locale]>"u"&&s.config.errorHandler(new Error("flatpickr: invalid locale "+s.config.locale)),s.l10n=Hn(Hn({},Ki.l10ns.default),typeof s.config.locale=="object"?s.config.locale:s.config.locale!=="default"?Ki.l10ns[s.config.locale]:void 0),ds.D="("+s.l10n.weekdays.shorthand.join("|")+")",ds.l="("+s.l10n.weekdays.longhand.join("|")+")",ds.M="("+s.l10n.months.shorthand.join("|")+")",ds.F="("+s.l10n.months.longhand.join("|")+")",ds.K="("+s.l10n.amPM[0]+"|"+s.l10n.amPM[1]+"|"+s.l10n.amPM[0].toLowerCase()+"|"+s.l10n.amPM[1].toLowerCase()+")";var z=Hn(Hn({},f),JSON.parse(JSON.stringify(b.dataset||{})));z.time_24hr===void 0&&Ki.defaultConfig.time_24hr===void 0&&(s.config.time_24hr=s.l10n.time_24hr),s.formatDate=U_(s),s.parseDate=Df({config:s.config,l10n:s.l10n})}function $t(z){if(typeof s.config.position=="function")return void s.config.position(s,z);if(s.calendarContainer!==void 0){Z("onPreCalendarPosition");var k=z||s._positionElement,V=Array.prototype.reduce.call(s.calendarContainer.children,function(gt,Ri){return gt+Ri.offsetHeight},0),Q=s.calendarContainer.offsetWidth,fe=s.config.position.split(" "),Se=fe[0],Be=fe.length>1?fe[1]:null,Ve=k.getBoundingClientRect(),nt=window.innerHeight-Ve.bottom,Ze=Se==="above"||Se!=="below"&&nt<V&&Ve.top>V,qe=window.pageYOffset+Ve.top+(Ze?-V-2:k.offsetHeight+2);if(Qn(s.calendarContainer,"arrowTop",!Ze),Qn(s.calendarContainer,"arrowBottom",Ze),!s.config.inline){var yt=window.pageXOffset+Ve.left,Ht=!1,K=!1;Be==="center"?(yt-=(Q-Ve.width)/2,Ht=!0):Be==="right"&&(yt-=Q-Ve.width,K=!0),Qn(s.calendarContainer,"arrowLeft",!Ht&&!K),Qn(s.calendarContainer,"arrowCenter",Ht),Qn(s.calendarContainer,"arrowRight",K);var De=window.document.body.offsetWidth-(window.pageXOffset+Ve.right),je=yt+Q>window.document.body.offsetWidth,Mt=De+Q>window.document.body.offsetWidth;if(Qn(s.calendarContainer,"rightMost",je),!s.config.static)if(s.calendarContainer.style.top=qe+"px",!je)s.calendarContainer.style.left=yt+"px",s.calendarContainer.style.right="auto";else if(!Mt)s.calendarContainer.style.left="auto",s.calendarContainer.style.right=De+"px";else{var Gt=jt();if(Gt===void 0)return;var Ue=window.document.body.offsetWidth,zt=Math.max(0,Ue/2-Q/2),Lt=".flatpickr-calendar.centerMost:before",ti=".flatpickr-calendar.centerMost:after",bi=Gt.cssRules.length,ui="{left:"+Ve.left+"px;right:auto;}";Qn(s.calendarContainer,"rightMost",!1),Qn(s.calendarContainer,"centerMost",!0),Gt.insertRule(Lt+","+ti+ui,bi),s.calendarContainer.style.left=zt+"px",s.calendarContainer.style.right="auto"}}}}function jt(){for(var z=null,k=0;k<document.styleSheets.length;k++){var V=document.styleSheets[k];if(V.cssRules){try{V.cssRules}catch{continue}z=V;break}}return z??Pi()}function Pi(){var z=document.createElement("style");return document.head.appendChild(z),z.sheet}function Yi(){s.config.noCalendar||s.isMobile||(rt(),Me(),et())}function Di(){s._input.focus(),window.navigator.userAgent.indexOf("MSIE")!==-1||navigator.msMaxTouchPoints!==void 0?setTimeout(s.close,0):s.close()}function Ii(z){z.preventDefault(),z.stopPropagation();var k=function(qe){return qe.classList&&qe.classList.contains("flatpickr-day")&&!qe.classList.contains("flatpickr-disabled")&&!qe.classList.contains("notAllowed")},V=V_(mr(z),k);if(V!==void 0){var Q=V,fe=s.latestSelectedDateObj=new Date(Q.dateObj.getTime()),Se=(fe.getMonth()<s.currentMonth||fe.getMonth()>s.currentMonth+s.config.showMonths-1)&&s.config.mode!=="range";if(s.selectedDateElem=Q,s.config.mode==="single")s.selectedDates=[fe];else if(s.config.mode==="multiple"){var Be=pe(fe);Be?s.selectedDates.splice(parseInt(Be),1):s.selectedDates.push(fe)}else s.config.mode==="range"&&(s.selectedDates.length===2&&s.clear(!1,!1),s.latestSelectedDateObj=fe,s.selectedDates.push(fe),gr(fe,s.selectedDates[0],!0)!==0&&s.selectedDates.sort(function(qe,yt){return qe.getTime()-yt.getTime()}));if(Pe(),Se){var Ve=s.currentYear!==fe.getFullYear();s.currentYear=fe.getFullYear(),s.currentMonth=fe.getMonth(),Ve&&(Z("onYearChange"),rt()),Z("onMonthChange")}if(Me(),et(),Ae(),!Se&&s.config.mode!=="range"&&s.config.showMonths===1?$e(Q):s.selectedDateElem!==void 0&&s.hourElement===void 0&&s.selectedDateElem&&s.selectedDateElem.focus(),s.hourElement!==void 0&&s.hourElement!==void 0&&s.hourElement.focus(),s.config.closeOnSelect){var nt=s.config.mode==="single"&&!s.config.enableTime,Ze=s.config.mode==="range"&&s.selectedDates.length===2&&!s.config.enableTime;(nt||Ze)&&Di()}He()}}var ni={locale:[Et,Tt],showMonths:[It,l,Rt],minDate:[Ge],maxDate:[Ge],positionElement:[ue],clickOpens:[function(){s.config.clickOpens===!0?(Ee(s._input,"focus",s.open),Ee(s._input,"click",s.open)):(s._input.removeEventListener("focus",s.open),s._input.removeEventListener("click",s.open))}]};function tn(z,k){if(z!==null&&typeof z=="object"){Object.assign(s.config,z);for(var V in z)ni[V]!==void 0&&ni[V].forEach(function(Q){return Q()})}else s.config[z]=k,ni[z]!==void 0?ni[z].forEach(function(Q){return Q()}):af.indexOf(z)>-1&&(s.config[z]=sf(k));s.redraw(),Ae(!0)}function Ti(z,k){var V=[];if(z instanceof Array)V=z.map(function(Q){return s.parseDate(Q,k)});else if(z instanceof Date||typeof z=="number")V=[s.parseDate(z,k)];else if(typeof z=="string")switch(s.config.mode){case"single":case"time":V=[s.parseDate(z,k)];break;case"multiple":V=z.split(s.config.conjunction).map(function(Q){return s.parseDate(Q,k)});break;case"range":V=z.split(s.l10n.rangeSeparator).map(function(Q){return s.parseDate(Q,k)});break}else s.config.errorHandler(new Error("Invalid date supplied: "+JSON.stringify(z)));s.selectedDates=s.config.allowInvalidPreload?V:V.filter(function(Q){return Q instanceof Date&&_i(Q,!1)}),s.config.mode==="range"&&s.selectedDates.sort(function(Q,fe){return Q.getTime()-fe.getTime()})}function Ui(z,k,V){if(k===void 0&&(k=!1),V===void 0&&(V=s.config.dateFormat),z!==0&&!z||z instanceof Array&&z.length===0)return s.clear(k);Ti(z,V),s.latestSelectedDateObj=s.selectedDates[s.selectedDates.length-1],s.redraw(),Ge(void 0,k),Ce(),s.selectedDates.length===0&&s.clear(!1),Ae(k),k&&Z("onChange")}function nn(z){return z.slice().map(function(k){return typeof k=="string"||typeof k=="number"||k instanceof Date?s.parseDate(k,void 0,!0):k&&typeof k=="object"&&k.from&&k.to?{from:s.parseDate(k.from,void 0),to:s.parseDate(k.to,void 0)}:k}).filter(function(k){return k})}function hn(){s.selectedDates=[],s.now=s.parseDate(s.config.now)||new Date;var z=s.config.defaultDate||((s.input.nodeName==="INPUT"||s.input.nodeName==="TEXTAREA")&&s.input.placeholder&&s.input.value===s.input.placeholder?null:s.input.value);z&&Ti(z,s.config.dateFormat),s._initialDate=s.selectedDates.length>0?s.selectedDates[0]:s.config.minDate&&s.config.minDate.getTime()>s.now.getTime()?s.config.minDate:s.config.maxDate&&s.config.maxDate.getTime()<s.now.getTime()?s.config.maxDate:s.now,s.currentYear=s._initialDate.getFullYear(),s.currentMonth=s._initialDate.getMonth(),s.selectedDates.length>0&&(s.latestSelectedDateObj=s.selectedDates[0]),s.config.minTime!==void 0&&(s.config.minTime=s.parseDate(s.config.minTime,"H:i")),s.config.maxTime!==void 0&&(s.config.maxTime=s.parseDate(s.config.maxTime,"H:i")),s.minDateHasTime=!!s.config.minDate&&(s.config.minDate.getHours()>0||s.config.minDate.getMinutes()>0||s.config.minDate.getSeconds()>0),s.maxDateHasTime=!!s.config.maxDate&&(s.config.maxDate.getHours()>0||s.config.maxDate.getMinutes()>0||s.config.maxDate.getSeconds()>0)}function At(){if(s.input=Ot(),!s.input){s.config.errorHandler(new Error("Invalid input element specified"));return}s.input._type=s.input.type,s.input.type="text",s.input.classList.add("flatpickr-input"),s._input=s.input,s.config.altInput&&(s.altInput=Si(s.input.nodeName,s.config.altInputClass),s._input=s.altInput,s.altInput.placeholder=s.input.placeholder,s.altInput.disabled=s.input.disabled,s.altInput.required=s.input.required,s.altInput.tabIndex=s.input.tabIndex,s.altInput.type="text",s.input.setAttribute("type","hidden"),!s.config.static&&s.input.parentNode&&s.input.parentNode.insertBefore(s.altInput,s.input.nextSibling)),s.config.allowInput||s._input.setAttribute("readonly","readonly"),ue()}function ue(){s._positionElement=s.config.positionElement||s._input}function j(){var z=s.config.enableTime?s.config.noCalendar?"time":"datetime-local":"date";s.mobileInput=Si("input",s.input.className+" flatpickr-mobile"),s.mobileInput.tabIndex=1,s.mobileInput.type=z,s.mobileInput.disabled=s.input.disabled,s.mobileInput.required=s.input.required,s.mobileInput.placeholder=s.input.placeholder,s.mobileFormatStr=z==="datetime-local"?"Y-m-d\\TH:i:S":z==="date"?"Y-m-d":"H:i:S",s.selectedDates.length>0&&(s.mobileInput.defaultValue=s.mobileInput.value=s.formatDate(s.selectedDates[0],s.mobileFormatStr)),s.config.minDate&&(s.mobileInput.min=s.formatDate(s.config.minDate,"Y-m-d")),s.config.maxDate&&(s.mobileInput.max=s.formatDate(s.config.maxDate,"Y-m-d")),s.input.getAttribute("step")&&(s.mobileInput.step=String(s.input.getAttribute("step"))),s.input.type="hidden",s.altInput!==void 0&&(s.altInput.type="hidden");try{s.input.parentNode&&s.input.parentNode.insertBefore(s.mobileInput,s.input.nextSibling)}catch{}Ee(s.mobileInput,"change",function(k){s.setDate(mr(k).value,!1,s.mobileFormatStr),Z("onChange"),Z("onClose")})}function q(z){if(s.isOpen===!0)return s.close();s.open(z)}function Z(z,k){if(s.config!==void 0){var V=s.config[z];if(V!==void 0&&V.length>0)for(var Q=0;V[Q]&&Q<V.length;Q++)V[Q](s.selectedDates,s.input.value,s,k);z==="onChange"&&(s.input.dispatchEvent(ne("change")),s.input.dispatchEvent(ne("input")))}}function ne(z){var k=document.createEvent("Event");return k.initEvent(z,!0,!0),k}function pe(z){for(var k=0;k<s.selectedDates.length;k++){var V=s.selectedDates[k];if(V instanceof Date&&gr(V,z)===0)return""+k}return!1}function be(z){return s.config.mode!=="range"||s.selectedDates.length<2?!1:gr(z,s.selectedDates[0])>=0&&gr(z,s.selectedDates[1])<=0}function Me(){s.config.noCalendar||s.isMobile||!s.monthNav||(s.yearElements.forEach(function(z,k){var V=new Date(s.currentYear,s.currentMonth,1);V.setMonth(s.currentMonth+k),s.config.showMonths>1||s.config.monthSelectorType==="static"?s.monthElements[k].textContent=nd(V.getMonth(),s.config.shorthandCurrentMonth,s.l10n)+" ":s.monthsDropdownContainer.value=V.getMonth().toString(),z.value=V.getFullYear().toString()}),s._hidePrevMonthArrow=s.config.minDate!==void 0&&(s.currentYear===s.config.minDate.getFullYear()?s.currentMonth<=s.config.minDate.getMonth():s.currentYear<s.config.minDate.getFullYear()),s._hideNextMonthArrow=s.config.maxDate!==void 0&&(s.currentYear===s.config.maxDate.getFullYear()?s.currentMonth+1>s.config.maxDate.getMonth():s.currentYear>s.config.maxDate.getFullYear()))}function ve(z){var k=z||(s.config.altInput?s.config.altFormat:s.config.dateFormat);return s.selectedDates.map(function(V){return s.formatDate(V,k)}).filter(function(V,Q,fe){return s.config.mode!=="range"||s.config.enableTime||fe.indexOf(V)===Q}).join(s.config.mode!=="range"?s.config.conjunction:s.l10n.rangeSeparator)}function Ae(z){z===void 0&&(z=!0),s.mobileInput!==void 0&&s.mobileFormatStr&&(s.mobileInput.value=s.latestSelectedDateObj!==void 0?s.formatDate(s.latestSelectedDateObj,s.mobileFormatStr):""),s.input.value=ve(s.config.dateFormat),s.altInput!==void 0&&(s.altInput.value=ve(s.config.altFormat)),z!==!1&&Z("onValueUpdate")}function Te(z){var k=mr(z),V=s.prevMonthNav.contains(k),Q=s.nextMonthNav.contains(k);V||Q?ft(V?-1:1):s.yearElements.indexOf(k)>=0?k.select():k.classList.contains("arrowUp")?s.changeYear(s.currentYear+1):k.classList.contains("arrowDown")&&s.changeYear(s.currentYear-1)}function de(z){z.preventDefault();var k=z.type==="keydown",V=mr(z),Q=V;s.amPM!==void 0&&V===s.amPM&&(s.amPM.textContent=s.l10n.amPM[Cr(s.amPM.textContent===s.l10n.amPM[0])]);var fe=parseFloat(Q.getAttribute("min")),Se=parseFloat(Q.getAttribute("max")),Be=parseFloat(Q.getAttribute("step")),Ve=parseInt(Q.value,10),nt=z.delta||(k?z.which===38?1:-1:0),Ze=Ve+Be*nt;if(typeof Q.value<"u"&&Q.value.length===2){var qe=Q===s.hourElement,yt=Q===s.minuteElement;Ze<fe?(Ze=Se+Ze+Cr(!qe)+(Cr(qe)&&Cr(!s.amPM)),yt&&mt(void 0,-1,s.hourElement)):Ze>Se&&(Ze=Q===s.hourElement?Ze-Se-Cr(!s.amPM):fe,yt&&mt(void 0,1,s.hourElement)),s.amPM&&qe&&(Be===1?Ze+Ve===23:Math.abs(Ze-Ve)>Be)&&(s.amPM.textContent=s.l10n.amPM[Cr(s.amPM.textContent===s.l10n.amPM[0])]),Q.value=rr(Ze)}}return R(),s}function wl(b,f){for(var s=Array.prototype.slice.call(b).filter(function(S){return S instanceof HTMLElement}),E=[],R=0;R<s.length;R++){var G=s[R];try{if(G.getAttribute("data-fp-omit")!==null)continue;G._flatpickr!==void 0&&(G._flatpickr.destroy(),G._flatpickr=void 0),G._flatpickr=Fb(G,f||{}),E.push(G._flatpickr)}catch(S){console.error(S)}}return E.length===1?E[0]:E}typeof HTMLElement<"u"&&typeof HTMLCollection<"u"&&typeof NodeList<"u"&&(HTMLCollection.prototype.flatpickr=NodeList.prototype.flatpickr=function(b){return wl(this,b)},HTMLElement.prototype.flatpickr=function(b){return wl([this],b)});var Ki=function(b,f){return typeof b=="string"?wl(window.document.querySelectorAll(b),f):b instanceof Node?wl([b],f):wl(b,f)};Ki.defaultConfig={};Ki.l10ns={en:Hn({},su),default:Hn({},su)};Ki.localize=function(b){Ki.l10ns.default=Hn(Hn({},Ki.l10ns.default),b)};Ki.setDefaults=function(b){Ki.defaultConfig=Hn(Hn({},Ki.defaultConfig),b)};Ki.parseDate=Df({});Ki.formatDate=U_({});Ki.compareDates=gr;typeof jQuery<"u"&&typeof jQuery.fn<"u"&&(jQuery.fn.flatpickr=function(b){return wl(this,b)});Date.prototype.fp_incr=function(b){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+(typeof b=="string"?parseInt(b,10):b))};typeof window<"u"&&(window.flatpickr=Ki);var q_={exports:{}};(function(b,f){(function(s,E){b.exports=E()})(qf,function(){/*! *****************************************************************************
	    Copyright (c) Microsoft Corporation.

	    Permission to use, copy, modify, and/or distribute this software for any
	    purpose with or without fee is hereby granted.

	    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	    PERFORMANCE OF THIS SOFTWARE.
	    ***************************************************************************** */var s=function(){return s=Object.assign||function(_e){for(var ee,Pe=1,Ce=arguments.length;Pe<Ce;Pe++){ee=arguments[Pe];for(var N in ee)Object.prototype.hasOwnProperty.call(ee,N)&&(_e[N]=ee[N])}return _e},s.apply(this,arguments)},E=function(ae,_e,ee){return ee.months[_e?"shorthand":"longhand"][ae]};function R(ae){for(;ae.firstChild;)ae.removeChild(ae.firstChild)}function G(ae){try{if(typeof ae.composedPath=="function"){var _e=ae.composedPath();return _e[0]}return ae.target}catch{return ae.target}}var S={shorthand:!1,dateFormat:"F Y",altFormat:"F Y",theme:"light"};function l(ae){var _e=s(s({},S),ae);return function(ee){ee.config.dateFormat=_e.dateFormat,ee.config.altFormat=_e.altFormat;var Pe={monthsContainer:null};function Ce(){if(ee.rContainer){R(ee.rContainer);for(var Qe=0;Qe<ee.monthElements.length;Qe++){var Ke=ee.monthElements[Qe];Ke.parentNode&&Ke.parentNode.removeChild(Ke)}}}function N(){ee.rContainer&&(Pe.monthsContainer=ee._createElement("div","flatpickr-monthSelect-months"),Pe.monthsContainer.tabIndex=-1,ge(),ee.rContainer.appendChild(Pe.monthsContainer),ee.calendarContainer.classList.add("flatpickr-monthSelect-theme-"+_e.theme))}function ge(){if(Pe.monthsContainer){R(Pe.monthsContainer);for(var Qe=document.createDocumentFragment(),Ke=0;Ke<12;Ke++){var et=ee.createDay("flatpickr-monthSelect-month",new Date(ee.currentYear,Ke),0,Ke);et.dateObj.getMonth()===new Date().getMonth()&&et.dateObj.getFullYear()===new Date().getFullYear()&&et.classList.add("today"),et.textContent=E(Ke,_e.shorthand,ee.l10n),et.addEventListener("click",Ge),Qe.appendChild(et)}Pe.monthsContainer.appendChild(Qe),ee.config.minDate&&ee.currentYear===ee.config.minDate.getFullYear()?ee.prevMonthNav.classList.add("flatpickr-disabled"):ee.prevMonthNav.classList.remove("flatpickr-disabled"),ee.config.maxDate&&ee.currentYear===ee.config.maxDate.getFullYear()?ee.nextMonthNav.classList.add("flatpickr-disabled"):ee.nextMonthNav.classList.remove("flatpickr-disabled")}}function Ee(){ee._bind(ee.prevMonthNav,"click",function(Qe){Qe.preventDefault(),Qe.stopPropagation(),ee.changeYear(ee.currentYear-1),tt(),ge()}),ee._bind(ee.nextMonthNav,"click",function(Qe){Qe.preventDefault(),Qe.stopPropagation(),ee.changeYear(ee.currentYear+1),tt(),ge()}),ee._bind(Pe.monthsContainer,"mouseover",function(Qe){ee.config.mode==="range"&&ee.onMouseOver(G(Qe),"flatpickr-monthSelect-month")})}function He(){if(ee.rContainer&&ee.selectedDates.length){for(var Qe=ee.rContainer.querySelectorAll(".flatpickr-monthSelect-month.selected"),Ke=0;Ke<Qe.length;Ke++)Qe[Ke].classList.remove("selected");var et=ee.selectedDates[0].getMonth(),rt=ee.rContainer.querySelector(".flatpickr-monthSelect-month:nth-child("+(et+1)+")");rt&&rt.classList.add("selected")}}function tt(){var Qe=ee.selectedDates[0];if(Qe&&(Qe=new Date(Qe),Qe.setFullYear(ee.currentYear),ee.config.minDate&&Qe<ee.config.minDate&&(Qe=ee.config.minDate),ee.config.maxDate&&Qe>ee.config.maxDate&&(Qe=ee.config.maxDate),ee.currentYear=Qe.getFullYear()),ee.currentYearElement.value=String(ee.currentYear),ee.rContainer){var Ke=ee.rContainer.querySelectorAll(".flatpickr-monthSelect-month");Ke.forEach(function(et){et.dateObj.setFullYear(ee.currentYear),ee.config.minDate&&et.dateObj<ee.config.minDate||ee.config.maxDate&&et.dateObj>ee.config.maxDate?et.classList.add("flatpickr-disabled"):et.classList.remove("flatpickr-disabled")})}He()}function Ge(Qe){Qe.preventDefault(),Qe.stopPropagation();var Ke=G(Qe);if(Ke instanceof Element&&!Ke.classList.contains("flatpickr-disabled")&&!Ke.classList.contains("notAllowed")&&(Ye(Ke.dateObj),ee.config.closeOnSelect)){var et=ee.config.mode==="single",rt=ee.config.mode==="range"&&ee.selectedDates.length===2;(et||rt)&&ee.close()}}function Ye(Qe){var Ke=new Date(ee.currentYear,Qe.getMonth(),Qe.getDate()),et=[];switch(ee.config.mode){case"single":et=[Ke];break;case"multiple":et.push(Ke);break;case"range":ee.selectedDates.length===2?et=[Ke]:(et=ee.selectedDates.concat([Ke]),et.sort(function(rt,Dt){return rt.getTime()-Dt.getTime()}));break}ee.setDate(et,!0),He()}var mt={37:-1,39:1,40:3,38:-3};function dt(Qe,Ke,et,rt){var Dt=mt[rt.keyCode]!==void 0;if(!(!Dt&&rt.keyCode!==13)&&!(!ee.rContainer||!Pe.monthsContainer)){var It=ee.rContainer.querySelector(".flatpickr-monthSelect-month.selected"),ei=Array.prototype.indexOf.call(Pe.monthsContainer.children,document.activeElement);if(ei===-1){var Zt=It||Pe.monthsContainer.firstElementChild;Zt.focus(),ei=Zt.$i}Dt?Pe.monthsContainer.children[(12+ei+mt[rt.keyCode])%12].focus():rt.keyCode===13&&Pe.monthsContainer.contains(document.activeElement)&&Ye(document.activeElement.dateObj)}}function pt(){var Qe;((Qe=ee.config)===null||Qe===void 0?void 0:Qe.mode)==="range"&&ee.selectedDates.length===1&&ee.clear(!1),ee.selectedDates.length||ge()}function $e(){_e._stubbedCurrentMonth=ee._initialDate.getMonth(),ee._initialDate.setMonth(_e._stubbedCurrentMonth),ee.currentMonth=_e._stubbedCurrentMonth}function bt(){_e._stubbedCurrentMonth&&(ee._initialDate.setMonth(_e._stubbedCurrentMonth),ee.currentMonth=_e._stubbedCurrentMonth,delete _e._stubbedCurrentMonth)}function Pt(){if(Pe.monthsContainer!==null)for(var Qe=Pe.monthsContainer.querySelectorAll(".flatpickr-monthSelect-month"),Ke=0;Ke<Qe.length;Ke++)Qe[Ke].removeEventListener("click",Ge)}return{onParseConfig:function(){ee.config.enableTime=!1},onValueUpdate:He,onKeyDown:dt,onReady:[$e,Ce,N,Ee,He,function(){ee.config.onClose.push(pt),ee.loadedPlugins.push("monthSelect")}],onDestroy:[bt,Pt,function(){ee.config.onClose=ee.config.onClose.filter(function(Qe){return Qe!==pt})}]}}}return l})})(q_);var Bb=q_.exports;const jb=__(Bb);var Z0={exports:{}};(function(b,f){(function(s,E){E(f)})(qf,function(s){var E=typeof window<"u"&&window.flatpickr!==void 0?window.flatpickr:{l10ns:{}},R={weekdays:{shorthand:["So","Mo","Di","Mi","Do","Fr","Sa"],longhand:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"]},months:{shorthand:["Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],longhand:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"]},firstDayOfWeek:1,weekAbbreviation:"KW",rangeSeparator:" bis ",scrollTitle:"Zum ndern scrollen",toggleTitle:"Zum Umschalten klicken",time_24hr:!0};E.l10ns.de=R;var G=E.l10ns;s.German=R,s.default=G,Object.defineProperty(s,"__esModule",{value:!0})})})(Z0,Z0.exports);const H0=b=>String(b).padStart(2,"0");function W0(b){return`${b.getFullYear()}-${H0(b.getMonth()+1)}-${H0(b.getDate())}`}function Y0(b){const f=b.match(/\d+/g);if(!f||f.length<3)throw new Error("Invalid ISO date string");return new Date(Number(f[0]),Number(f[1])-1,Number(f[2]))}let ro=class extends mi{constructor(){super(...arguments),this.mode="single",this.dateFormat="d.m.Y",this.altFormat=null,this.minDate=null,this.maxDate=null,this.enableTime=!1,this.monthPicker=!1}createRenderRoot(){return this}connectedCallback(){super.connectedCallback();const f=(document.documentElement.getAttribute("lang")||"en-US").substring(0,2);Ki.l10ns[f]&&Ki.localize(Ki.l10ns[f]);const s=this.querySelector("input");s&&this._initDatepicker(s)}_initDatepicker(f){const s={dateFormat:this.dateFormat,altInput:this.altFormat!==null,altFormat:this.altFormat||this.dateFormat,minDate:this.minDate,maxDate:this.maxDate,enableTime:this.enableTime,time_24hr:!0,allowInput:!1,mode:this.mode,onClose:(R,G,S)=>{const l=new CustomEvent("close",{bubbles:!0,composed:!0,detail:{selectedDates:R,dateStr:G,instance:S}});f.dispatchEvent(l)}};if(this.monthPicker){const R="F Y";s.altInput=!0,window.navigator.maxTouchPoints!==0&&function(){const G=document.createElement("input");return G.setAttribute("type","month"),G.type==="month"}()?s.altFormat=R:s.plugins=[jb({altFormat:R})]}const E=f.getAttribute("value");if(E&&E!=="")try{s.defaultDate=Ki.parseDate(E,this.dateFormat)}catch{}Ki(f,s)}};Bt([vt({type:String})],ro.prototype,"mode",void 0),Bt([vt({type:String,attribute:"date-format"})],ro.prototype,"dateFormat",void 0),Bt([vt({type:String,attribute:"alt-format"})],ro.prototype,"altFormat",void 0),Bt([vt({type:String})],ro.prototype,"minDate",void 0),Bt([vt({type:String})],ro.prototype,"maxDate",void 0),Bt([vt({type:Boolean})],ro.prototype,"enableTime",void 0),Bt([vt({type:Boolean})],ro.prototype,"monthPicker",void 0),ro=Bt([Ln("toujou-datepicker")],ro);let hf=class extends ro{constructor(){super(),this.mode="range",this._onDateRangeChange=this._onDateRangeChange.bind(this)}createRenderRoot(){return this}get dateFromInput(){return this.querySelector(".date-range--from")}get dateUntilInput(){return this.querySelector(".date-range--until")}get dateFacedInput(){return this.querySelector(".date-range--facade")}get flatpickr(){if(!this.dateFacedInput)throw new Error("Facade is missing");if(Object.prototype.hasOwnProperty.call(this.dateFacedInput,"_flatpickr")===!1)throw new Error("Flatpickr is not initialized");return this.dateFacedInput._flatpickr}connectedCallback(){super.connectedCallback(),this.dateFacedInput&&(this._initDatepicker(this.dateFacedInput),this.dateFacedInput.addEventListener("change",this._onDateRangeChange))}disconnectedCallback(){super.disconnectedCallback(),this.dateFacedInput&&this.dateFacedInput.removeEventListener("change",this._onDateRangeChange)}firstUpdated(f){var s,E;super.firstUpdated(f);const R=[],G=(s=this.dateFromInput)===null||s===void 0?void 0:s.value,S=(E=this.dateUntilInput)===null||E===void 0?void 0:E.value;G&&G!==""&&R.push(Y0(G)),S&&S!==""&&R.push(Y0(S)),this.flatpickr.setDate(R)}_onDateRangeChange(){const{selectedDates:f}=this.flatpickr;this.dateFromInput&&f[0]&&(this.dateFromInput.value=W0(f[0])),this.dateUntilInput&&f[f.length-1]&&(this.dateUntilInput.value=W0(f[f.length-1]))}};Bt([vt({type:String})],hf.prototype,"mode",void 0),hf=Bt([Ln("toujou-daterangepicker")],hf);var X0,df,pf,Nb=bn(X0||(df=[`:host {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-pack: center;
        -ms-flex-pack: center;
            justify-content: center;
}
`],pf||(pf=df.slice(0)),X0=Object.freeze(Object.defineProperties(df,{raw:{value:Object.freeze(pf)}}))));let Wc=class G_ extends mi{constructor(){super(...arguments),this.isLoading=!1,this.itemsContainerSelector=""}static get is(){return"toujou-collection-load-more"}render(){return this.isLoading?pi`<slot name="spinner"></slot>`:pi`<slot @click="${this._handleLoadMoreClick}"></slot>`}_handleLoadMoreClick(f){let s;f.preventDefault();const E=f.target;if(E===null)return;const R=E.getAttribute("href");if(R===null||R==="")throw"Missing or empty href on toujou-collection-load-more link";const G=new URL(R,document.baseURI).href;this.isLoading=!0,fetch(G).then(S=>S.text()).then(S=>{const l=document.createElement("div");return l.innerHTML=S,l}).then(S=>{const l=[].slice.call(S.querySelector(this.itemsContainerSelector).children),ae=l[0];s=ae==null?void 0:ae.querySelector("a");const _e=S.querySelector(G_.is);document.querySelector(this.itemsContainerSelector).append(...l),_e?this.replaceWith(_e):this.remove()}).catch(S=>{window.dispatchEvent(new CustomEvent("toujou-collection-load-more-error",{bubbles:!0,composed:!0,detail:S}))}).finally(()=>{this.isLoading=!1,s&&requestAnimationFrame(()=>{s.focus()}),window.dispatchEvent(new CustomEvent("toujou-collection-load-more-done",{bubbles:!0,composed:!0}))})}};Wc.styles=[Nb],Bt([vt({type:Boolean,reflect:!0,attribute:"is-loading"})],Wc.prototype,"isLoading",void 0),Bt([vt({type:String,attribute:"items-container-selector"})],Wc.prototype,"itemsContainerSelector",void 0),customElements.define(Wc.is,Wc);var K0,ff,mf,gs,$b=bn(K0||(ff=[`:host {
    --toujou-details-border: var(--border-width-normal) solid var(--color-font-light);
    --toujou-details-border-top: var(--toujou-details-border);
    --toujou-details-border-bottom: var(--toujou-details-border);

    --toujou-details-summary-padding: var(--spacing-normal) var(--spacing-s);
    --toujou-details-summary-gap: 0;
    --toujou-details-summary-display: grid;
    --toujou-details-summary-grid-templte-columns: 1fr auto;
    --toujou-details-summary-grid-templte-areas: "title chevron" "subtitle chevron";

    --toujou-details-content-padding: var(--spacing-normal) var(--spacing-s);

    display: block;
    border-bottom: var(--toujou-details-border-bottom);
    border-top: var(--toujou-details-border-top);
}

.details__summary {
    list-style: none;
    display: grid;
    grid-template-columns: 1fr auto;
    grid-template-areas: var(--toujou-details-summary-grid-templte-areas);
    grid-gap: var(--toujou-details-summary-gap);
    -webkit-box-align: center;
        -ms-flex-align: center;
            align-items: center;
    padding: var(--toujou-details-summary-padding);
}

:host(:focus-visible) .details__summary {
    outline: var(--focus-outline-width) solid var(--focus-outline-color);
    outline-offset: var(--focus-outline-offset);
}

.details__summary::-webkit-details-marker {
    display: none;
}

.details__content {
    padding: var(--toujou-details-content-padding);
}

@media (hover: hover) {
    .details__summary:hover {
        --details-title-color: var(--details-title-active-color);
        --details-chevron-color: var(--details-chevron-active-color);

        cursor: pointer;
    }
}
`],mf||(mf=ff.slice(0)),K0=Object.freeze(Object.defineProperties(ff,{raw:{value:Object.freeze(mf)}}))));(function(b){b.DETAILS_CONNECTED="toujou-details-connected",b.DETAILS_TOGGLE="toujou-details-toggle",b.DETAILS_ACCORDION_CONNECTED="toujou-details-accordion-connected"})(gs||(gs={}));let gf=class extends mi{constructor(){super(...arguments),this.detailsEl=null,this.isOpen=!1}static get styles(){return $b}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new CustomEvent(gs.DETAILS_CONNECTED,{bubbles:!0,composed:!0,detail:{detailsEl:this}})),typeof window<"u"&&window.matchMedia("print").matches&&(this.isOpen=!0)}firstUpdated(){var f,s;this.detailsEl=(f=this.shadowRoot)===null||f===void 0?void 0:f.querySelector(".details"),this.isOpen=((s=this.detailsEl)===null||s===void 0?void 0:s.hasAttribute("open"))||!1}render(){return pi`
      <details
        class="details"
        part="details"
        ?open="${this.isOpen}"
        @toggle="${this._handleDetailsChange}"
        exportparts="details details-summary details-content"
      >
        <summary class="details__summary" part="details-summary">
          <slot name="summary"></slot>
          <slot name="chevron"></slot>
        </summary>
        <section class="details__content" part="details-content">
          <slot name="content"></slot>
        </section>
      </details>
    `}_handleDetailsChange(f){const s=f.target;this.isOpen=s.hasAttribute("open")||!1,this.dispatchEvent(new CustomEvent(gs.DETAILS_TOGGLE,{bubbles:!0,composed:!0,detail:{detailsEl:this,state:this.isOpen}}))}};Bt([vt({type:Boolean,reflect:!0,attribute:"is-open"})],gf.prototype,"isOpen",void 0),gf=Bt([Ln("toujou-details")],gf);let Uh=class extends mi{constructor(){super(...arguments),this.singleExpandMode=!1,this.toujouDetailsElements=new Set}connectedCallback(){super.connectedCallback(),this.addEventListener(gs.DETAILS_TOGGLE,this._handleDetailsToggle),this.dispatchEvent(new CustomEvent(gs.DETAILS_ACCORDION_CONNECTED,{bubbles:!0,composed:!0,detail:{accordionEl:this}}))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener(gs.DETAILS_TOGGLE,this._handleDetailsToggle)}firstUpdated(){var b;const f=(b=this.shadowRoot)===null||b===void 0?void 0:b.querySelector("slot");f&&(f.assignedElements({flatten:!0}).forEach(s=>{s.nodeName==="TOUJOU-DETAILS"&&this.toujouDetailsElements.add(s)}),this.toujouDetailsElements.size===0&&(this.setAttribute("has-no-children",""),console.warn("TOUJOU-DETAILS-ACCORDION has no valid children!",this)))}_handleDetailsToggle(b){const f=b,{detailsEl:s,state:E}=f.detail;this.singleExpandMode&&E&&this.toujouDetailsElements.forEach(R=>{R!==s&&(R.isOpen=!1)})}render(){return pi`<slot></slot>`}};Bt([vt({type:Boolean,attribute:"single-expand-mode"})],Uh.prototype,"singleExpandMode",void 0),Bt([vt({attribute:!1})],Uh.prototype,"toujouDetailsElements",void 0),Uh=Bt([Ln("toujou-details-accordion")],Uh);var J0,_f,yf,Vb=bn(J0||(_f=[`:host {
    --toujou-clamped-content-number-of-lines: 3;
    --toujou-clamped-content-word-break: 'none';
    --toujou-clamped-content-button-visible-display: flex;
    --toujou-clamped-content-button-hidden-display: none;
    --toujou-clamped-content-button-slot-display: flex;
    --toujou-clamped-content-button-slot-justify-content: flex-end;
}

:host([is-open]) {
    --toujou-clamped-content-number-of-lines: 9999;
}

:host([clamp-disabled]) {
    --toujou-clamped-content-number-of-lines: 9999;
    --toujou-clamped-content-button-visible-display: none;
}

.clamped-content {
    display: -webkit-box;
    -webkit-line-clamp: var(--toujou-clamped-content-number-of-lines);
    -webkit-box-orient: vertical;
    word-break: var(--toujou-clamped-content-word-break);
    overflow: hidden;
    -ms-hyphens: auto;
        hyphens: auto;
}

:host slot[name="show-button"] {
    display: var(--toujou-clamped-content-button-visible-display);
}

:host([is-open]) slot[name="show-button"] {
    display: var(--toujou-clamped-content-button-hidden-display);
}

:host slot[name="hide-button"] {
    display: var(--toujou-clamped-content-button-hidden-display);
}

:host([is-open]) slot[name="hide-button"] {
    display: var(--toujou-clamped-content-button-visible-display);
}

.button-slot {
    margin-top: var(--spacing-normal);
    display: var(--toujou-clamped-content-button-slot-display);
    -webkit-box-pack: var(--toujou-clamped-content-button-slot-justify-content);
        -ms-flex-pack: var(--toujou-clamped-content-button-slot-justify-content);
            justify-content: var(--toujou-clamped-content-button-slot-justify-content);
}
`],yf||(yf=_f.slice(0)),J0=Object.freeze(Object.defineProperties(_f,{raw:{value:Object.freeze(yf)}}))));let qh=class extends mi{constructor(){super(...arguments),this.isOpen=!1,this.clampDisabled=!1,this.toggleIsOpen=()=>{this.isOpen=!this.isOpen,this.dispatchEvent(new CustomEvent("toujou-clamped-content-changed",{bubbles:!0,composed:!0,detail:{isOpen:this.isOpen}}))},this.updateClampEnabledState=()=>{var b;const f=(b=this.shadowRoot)===null||b===void 0?void 0:b.querySelector("slot[name=clamped-content]"),s=f==null?void 0:f.assignedElements({flatten:!0});if(s&&s.length!==0){const E=s[0];this.clampDisabled=E.scrollHeight<=E.clientHeight}else this.clampDisabled=!0;this.dispatchEvent(new CustomEvent("toujou-clamped-content-clamp-enabled-changed",{detail:{clampDisabled:this.clampDisabled},bubbles:!0,composed:!0}))}}static get styles(){return Vb}render(){return pi`
      <div class="clamped-content" part="clamped-content">
        <slot name="clamped-content" @slotchange="${this.updateClampEnabledState}"></slot>
      </div>
      <slot name="show-button" class="button-slot" @click="${this.toggleIsOpen}"></slot>
      <slot name="hide-button" class="button-slot" @click="${this.toggleIsOpen}"></slot>
    `}firstUpdated(){this.updateClampEnabledState()}updated(b){super.updated(b),b.has("isOpen")&&this.setAttribute("aria-expanded",String(this.isOpen))}};Bt([vt({type:Boolean,attribute:"is-open",reflect:!0})],qh.prototype,"isOpen",void 0),Bt([vt({type:Boolean,attribute:"clamp-disabled",reflect:!0})],qh.prototype,"clampDisabled",void 0),qh=Bt([Ln("toujou-clamped-content")],qh);let vf=class extends mi{constructor(){super(...arguments),this._state=!1,this.stateChangeEventName="toujou-burger-button-state-change",this.topbarMqlChangeEventName="toujou-topbar-breakpoint-change",this._boundHandleMqlChange=this._handleMqlChange.bind(this),this._handleClickEvent=()=>{this._toggleState()},this._handleKeyUp=f=>{f.key!=="Enter"&&f.key!==" "||this._toggleState()},this._toggleState=()=>{this.state=!this._state,this.dispatchEvent(new CustomEvent(this.stateChangeEventName,{bubbles:!0,composed:!0,detail:{state:this.state}}))}}get state(){return this._state}set state(f){this._state=f,this.setAttribute("aria-pressed",String(f)),this.setAttribute("aria-expanded",String(f))}render(){return pi`
      <slot name="content"></slot>`}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-pressed",String(this._state)),this.setAttribute("aria-expanded",String(this._state)),this.addEventListener("click",this._handleClickEvent),this.addEventListener("keyup",this._handleKeyUp),window.addEventListener(this.topbarMqlChangeEventName,this._boundHandleMqlChange)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this._handleClickEvent),this.removeEventListener("keyup",this._handleKeyUp),window.removeEventListener(this.topbarMqlChangeEventName,this._boundHandleMqlChange)}_handleMqlChange(f){f.detail.state||(this.state=!1)}};Bt([vt({type:Boolean})],vf.prototype,"_state",void 0),vf=Bt([Ln("toujou-burger-button")],vf);let Gh=class extends mi{constructor(){super(...arguments),this.burgerButtonStateChangeEvent="toujou-burger-button-state-change",this.mqlChangeEventName="toujou-topbar-breakpoint-change",this.openNavBodyAttribute="nav-is-open",this._isOpen=!1,this._isMobile=!1,this._breakpoint="840px",this._handleBurgerButtonClickBound=this._handleBurgerButtonClick.bind(this),this._handleMqlChangeBound=this._handleMqlChange.bind(this),this._setMediaQuery=()=>{const b=getComputedStyle(this).getPropertyValue("--toujou-topbar-breakpoint");b&&(this._breakpoint=b),this._mql=window.matchMedia(`(width < ${this._breakpoint})`)}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this._setMediaQuery(),this._isMobile=this._mql.matches,window.addEventListener(this.burgerButtonStateChangeEvent,this._handleBurgerButtonClickBound),this._mql.addEventListener("change",this._handleMqlChangeBound)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener(this.burgerButtonStateChangeEvent,this._handleBurgerButtonClickBound),this._mql.removeEventListener("change",this._handleMqlChangeBound)}_handleBurgerButtonClick(b){this._isOpen=b.detail.state,this._isOpen?document.body.setAttribute(this.openNavBodyAttribute,""):document.body.removeAttribute(this.openNavBodyAttribute)}_handleMqlChange(b){this._isMobile=b.matches,this.dispatchEvent(new CustomEvent(this.mqlChangeEventName,{bubbles:!0,composed:!0,detail:{state:this._isMobile}})),this._isMobile||(this._isOpen=!1)}};Bt([vt({type:Boolean,reflect:!0,attribute:"open-nav"})],Gh.prototype,"_isOpen",void 0),Bt([vt({type:Boolean})],Gh.prototype,"_isMobile",void 0),Gh=Bt([Ln("toujou-topbar")],Gh);const Ub=b=>class extends b{constructor(){super(...arguments),this._previouslyFocusedElement=null}captureFocus(){this._previouslyFocusedElement=document.activeElement}restoreFocus(){this._previouslyFocusedElement&&typeof this._previouslyFocusedElement.focus=="function"&&this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null}},Z_=b=>`toujou-overlay-${b}`,Zh=(b,f)=>{document.cookie=Z_(b)+"="+f+";path=/;"};var Q0,bf,xf,qb=bn(Q0||(bf=[`:host {
    display: none;
}

:host([opened]) {
    display: block !important;
}
`],xf||(xf=bf.slice(0)),Q0=Object.freeze(Object.defineProperties(bf,{raw:{value:Object.freeze(xf)}}))));class wf extends Ub(mi){constructor(){super(...arguments),this.opened=!1,this.delay=0}static get is(){return"toujou-overlay"}static get properties(){return{opened:{type:Boolean,reflect:!0},delay:{type:Number,reflect:!0}}}firstUpdated(f){if(super.firstUpdated(f),location.hash==="#aaa")return void Zh(this.id,"accepted");const s=(E=>{const R=document.cookie.match(new RegExp("(^| )"+Z_(E)+"=([^;]+)"));return!!R&&R[2]})(this.id)!=="accepted";this.delay>0?setTimeout(()=>{this.opened=s},this.delay):this.opened=s}updated(f){f.has("opened")&&f.get("opened")!==void 0&&(this.opened?this.showOverlay():this.hideOverlay(),this.setAttribute("aria-hidden",this.opened?"false":"true")),super.updated(f)}render(){return pi`<slot id="templatedContent"></slot>`}showOverlay(){this.captureFocus(),this.shadowRoot.querySelector("#templatedContent").assignedNodes({flatten:!0}).filter(s=>s.tagName==="TEMPLATE").forEach(s=>{const E=(R=>{const G=R.innerHTML.trim();return(S=G).startsWith("<!--")&&S.endsWith("-->")?G.substring(4,G.length-3):G;var S})(s);this.innerHTML+=E}),this.overlayButtons.forEach(s=>{s.addEventListener("click",E=>this.handleOverlayButtonClick(E))}),this.overlayCloseButtons.forEach(s=>{s.addEventListener("click",()=>this.handleCloseButtonClick())}),document.body.classList.add("toujou-overlay-open");const f=this.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');f.length>0&&f[0].focus(),document.dispatchEvent(new CustomEvent("toujou-overlay-show",{detail:{overlay:this.id},bubbles:!0}))}hideOverlay(){document.body.classList.remove("toujou-overlay-open"),document.dispatchEvent(new CustomEvent("toujou-overlay-hide",{detail:{overlay:this.id},bubbles:!0})),Array.from(this.children).forEach(f=>{f.tagName!=="TEMPLATE"&&f.remove()}),this.restoreFocus()}showWarning(){this.overlayWarning&&(this.overlayWarning.style.display="block"),this.overlayButtonsContainer&&(this.overlayButtonsContainer.style.display="none")}handleOverlayButtonClick(f){const s=f.target.getAttribute("data-overlay-value");document.dispatchEvent(new CustomEvent("toujou-overlay-button-click",{detail:{overlay:this.id,choice:s},bubbles:!0})),s==="no"?(Zh(this.id,"rejected"),this.showWarning()):s==="yes"&&(Zh(this.id,"accepted"),this.opened=!1)}handleCloseButtonClick(){document.dispatchEvent(new CustomEvent("toujou-overlay-button-close-click",{detail:{overlay:this.id},bubbles:!0})),Zh(this.id,"accepted"),this.opened=!1}get overlayButtonsContainer(){return this.querySelector(".overlay__buttons")}get overlayButtons(){return this.querySelectorAll(".overlay__button")}get overlayCloseButtons(){return this.querySelectorAll(".overlay-button-close-trigger")}get overlayWarning(){return this.querySelector(".overlay__warning")}}wf.styles=[qb],customElements.define(wf.is,wf);class Gb extends mi{constructor(){super()}render(){return pi`
            <slot name="image"></slot>
            <slot name="quote"></slot>
            <slot name="author"></slot>
        `}}customElements.define("toujou-blockquote",Gb);function Zb(b,f){for(var s=0;s<f.length;s++){var E=f[s];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(b,E.key,E)}}function Hb(b,f,s){return f&&Zb(b.prototype,f),Object.defineProperty(b,"prototype",{writable:!1}),b}/*!
 * Splide.js
 * Version  : 4.1.4
 * License  : MIT
 * Copyright: 2022 Naotoshi Fujita
 */var e_="(prefers-reduced-motion: reduce)",vl=1,Wb=2,El=3,Il=4,bu=5,Yh=6,rd=7,Yb={CREATED:vl,MOUNTED:Wb,IDLE:El,MOVING:Il,SCROLLING:bu,DRAGGING:Yh,DESTROYED:rd};function Io(b){b.length=0}function _a(b,f,s){return Array.prototype.slice.call(b,f,s)}function Vi(b){return b.bind.apply(b,[null].concat(_a(arguments,1)))}var H_=setTimeout,Lf=function(){};function t_(b){return requestAnimationFrame(b)}function hd(b,f){return typeof f===b}function lu(b){return!Yf(b)&&hd("object",b)}var Wf=Array.isArray,W_=Vi(hd,"function"),fa=Vi(hd,"string"),xu=Vi(hd,"undefined");function Yf(b){return b===null}function Y_(b){try{return b instanceof(b.ownerDocument.defaultView||window).HTMLElement}catch{return!1}}function wu(b){return Wf(b)?b:[b]}function Mr(b,f){wu(b).forEach(f)}function Xf(b,f){return b.indexOf(f)>-1}function Xh(b,f){return b.push.apply(b,wu(f)),b}function Eo(b,f,s){b&&Mr(f,function(E){E&&b.classList[s?"add":"remove"](E)})}function oo(b,f){Eo(b,fa(f)?f.split(" "):f,!0)}function Su(b,f){Mr(f,b.appendChild.bind(b))}function Kf(b,f){Mr(b,function(s){var E=(f||s).parentNode;E&&E.insertBefore(s,f)})}function cu(b,f){return Y_(b)&&(b.msMatchesSelector||b.matches).call(b,f)}function X_(b,f){var s=b?_a(b.children):[];return f?s.filter(function(E){return cu(E,f)}):s}function Cu(b,f){return f?X_(b,f)[0]:b.firstElementChild}var uu=Object.keys;function _s(b,f,s){return b&&(s?uu(b).reverse():uu(b)).forEach(function(E){E!=="__proto__"&&f(b[E],E)}),b}function hu(b){return _a(arguments,1).forEach(function(f){_s(f,function(s,E){b[E]=f[E]})}),b}function pa(b){return _a(arguments,1).forEach(function(f){_s(f,function(s,E){Wf(s)?b[E]=s.slice():lu(s)?b[E]=pa({},lu(b[E])?b[E]:{},s):b[E]=s})}),b}function i_(b,f){Mr(f||uu(b),function(s){delete b[s]})}function ao(b,f){Mr(b,function(s){Mr(f,function(E){s&&s.removeAttribute(E)})})}function ci(b,f,s){lu(f)?_s(f,function(E,R){ci(b,R,E)}):Mr(b,function(E){Yf(s)||s===""?ao(E,f):E.setAttribute(f,String(s))})}function Sl(b,f,s){var E=document.createElement(b);return f&&(fa(f)?oo(E,f):ci(E,f)),s&&Su(s,E),E}function $r(b,f,s){if(xu(s))return getComputedStyle(b)[f];Yf(s)||(b.style[f]=""+s)}function du(b,f){$r(b,"display",f)}function K_(b){b.setActive&&b.setActive()||b.focus({preventScroll:!0})}function Vr(b,f){return b.getAttribute(f)}function n_(b,f){return b&&b.classList.contains(f)}function Tr(b){return b.getBoundingClientRect()}function vs(b){Mr(b,function(f){f&&f.parentNode&&f.parentNode.removeChild(f)})}function J_(b){return Cu(new DOMParser().parseFromString(b,"text/html").body)}function To(b,f){b.preventDefault(),f&&(b.stopPropagation(),b.stopImmediatePropagation())}function Q_(b,f){return b&&b.querySelector(f)}function Jf(b,f){return f?_a(b.querySelectorAll(f)):[]}function Mo(b,f){Eo(b,f,!1)}function Rf(b){return b.timeStamp}function hs(b){return fa(b)?b:b?b+"px":""}var Tu="splide",Qf="data-"+Tu;function Qc(b,f){if(!b)throw new Error("["+Tu+"] "+(f||""))}var ma=Math.min,od=Math.max,ad=Math.floor,pu=Math.ceil,or=Math.abs;function e1(b,f,s){return or(b-f)<s}function Kh(b,f,s,E){var R=ma(f,s),G=od(f,s);return E?R<b&&b<G:R<=b&&b<=G}function _l(b,f,s){var E=ma(f,s),R=od(f,s);return ma(od(E,b),R)}function Of(b){return+(b>0)-+(b<0)}function Ff(b,f){return Mr(f,function(s){b=b.replace("%s",""+s)}),b}function em(b){return b<10?"0"+b:""+b}var r_={};function Xb(b){return""+b+em(r_[b]=(r_[b]||0)+1)}function t1(){var b=[];function f(S,l,ae,_e){R(S,l,function(ee,Pe,Ce){var N="addEventListener"in ee,ge=N?ee.removeEventListener.bind(ee,Pe,ae,_e):ee.removeListener.bind(ee,ae);N?ee.addEventListener(Pe,ae,_e):ee.addListener(ae),b.push([ee,Pe,Ce,ae,ge])})}function s(S,l,ae){R(S,l,function(_e,ee,Pe){b=b.filter(function(Ce){return Ce[0]===_e&&Ce[1]===ee&&Ce[2]===Pe&&(!ae||Ce[3]===ae)?(Ce[4](),!1):!0})})}function E(S,l,ae){var _e,ee=!0;return typeof CustomEvent=="function"?_e=new CustomEvent(l,{bubbles:ee,detail:ae}):(_e=document.createEvent("CustomEvent"),_e.initCustomEvent(l,ee,!1,ae)),S.dispatchEvent(_e),_e}function R(S,l,ae){Mr(S,function(_e){_e&&Mr(l,function(ee){ee.split(" ").forEach(function(Pe){var Ce=Pe.split(".");ae(_e,Ce[0],Ce[1])})})})}function G(){b.forEach(function(S){S[4]()}),Io(b)}return{bind:f,unbind:s,dispatch:E,destroy:G}}var xs="mounted",o_="ready",ga="move",Eu="moved",i1="click",Kb="active",Jb="inactive",Qb="visible",ex="hidden",kn="refresh",ar="updated",fu="resize",tm="resized",tx="drag",ix="dragging",nx="dragged",im="scroll",Al="scrolled",rx="overflow",n1="destroy",ox="arrows:mounted",ax="arrows:updated",sx="pagination:mounted",lx="pagination:updated",r1="navigation:mounted",o1="autoplay:play",cx="autoplay:playing",a1="autoplay:pause",s1="lazyload:loaded",l1="sk",c1="sh",sd="ei";function en(b){var f=b?b.event.bus:document.createDocumentFragment(),s=t1();function E(G,S){s.bind(f,wu(G).join(" "),function(l){S.apply(S,Wf(l.detail)?l.detail:[])})}function R(G){s.dispatch(f,G,_a(arguments,1))}return b&&b.event.on(n1,s.destroy),hu(s,{bus:f,on:E,off:Vi(s.unbind,f),emit:R})}function dd(b,f,s,E){var R=Date.now,G,S=0,l,ae=!0,_e=0;function ee(){if(!ae){if(S=b?ma((R()-G)/b,1):1,s&&s(S),S>=1&&(f(),G=R(),E&&++_e>=E))return Ce();l=t_(ee)}}function Pe(tt){tt||ge(),G=R()-(tt?S*b:0),ae=!1,l=t_(ee)}function Ce(){ae=!0}function N(){G=R(),S=0,s&&s(S)}function ge(){l&&cancelAnimationFrame(l),S=0,l=0,ae=!0}function Ee(tt){b=tt}function He(){return ae}return{start:Pe,rewind:N,pause:Ce,cancel:ge,set:Ee,isPaused:He}}function ux(b){var f=b;function s(R){f=R}function E(R){return Xf(wu(R),f)}return{set:s,is:E}}function hx(b,f){var s=dd(0,b,null,1);return function(){s.isPaused()&&s.start()}}function dx(b,f,s){var E=b.state,R=s.breakpoints||{},G=s.reducedMotion||{},S=t1(),l=[];function ae(){var ge=s.mediaQuery==="min";uu(R).sort(function(Ee,He){return ge?+Ee-+He:+He-+Ee}).forEach(function(Ee){ee(R[Ee],"("+(ge?"min":"max")+"-width:"+Ee+"px)")}),ee(G,e_),Pe()}function _e(ge){ge&&S.destroy()}function ee(ge,Ee){var He=matchMedia(Ee);S.bind(He,"change",Pe),l.push([ge,He])}function Pe(){var ge=E.is(rd),Ee=s.direction,He=l.reduce(function(tt,Ge){return pa(tt,Ge[1].matches?Ge[0]:{})},{});i_(s),N(He),s.destroy?b.destroy(s.destroy==="completely"):ge?(_e(!0),b.mount()):Ee!==s.direction&&b.refresh()}function Ce(ge){matchMedia(e_).matches&&(ge?pa(s,G):i_(s,uu(G)))}function N(ge,Ee,He){pa(s,ge),Ee&&pa(Object.getPrototypeOf(s),ge),(He||!E.is(vl))&&b.emit(ar,s)}return{setup:ae,destroy:_e,reduce:Ce,set:N}}var pd="Arrow",fd=pd+"Left",md=pd+"Right",u1=pd+"Up",h1=pd+"Down",a_="rtl",gd="ttb",Sf={width:["height"],left:["top","right"],right:["bottom","left"],x:["y"],X:["Y"],Y:["X"],ArrowLeft:[u1,md],ArrowRight:[h1,fd]};function px(b,f,s){function E(G,S,l){l=l||s.direction;var ae=l===a_&&!S?1:l===gd?0:-1;return Sf[G]&&Sf[G][ae]||G.replace(/width|left|right/i,function(_e,ee){var Pe=Sf[_e.toLowerCase()][ae]||_e;return ee>0?Pe.charAt(0).toUpperCase()+Pe.slice(1):Pe})}function R(G){return G*(s.direction===a_?1:-1)}return{resolve:E,orient:R}}var ko="role",Cl="tabindex",fx="disabled",Ur="aria-",Mu=Ur+"controls",d1=Ur+"current",s_=Ur+"selected",Er=Ur+"label",nm=Ur+"labelledby",p1=Ur+"hidden",rm=Ur+"orientation",mu=Ur+"roledescription",l_=Ur+"live",c_=Ur+"busy",u_=Ur+"atomic",om=[ko,Cl,fx,Mu,d1,Er,nm,p1,rm,mu],so=Tu+"__",ya="is-",Cf=Tu,h_=so+"track",mx=so+"list",_d=so+"slide",f1=_d+"--clone",gx=_d+"__container",am=so+"arrows",yd=so+"arrow",m1=yd+"--prev",g1=yd+"--next",vd=so+"pagination",_1=vd+"__page",_x=so+"progress",yx=_x+"__bar",vx=so+"toggle",bx=so+"spinner",xx=so+"sr",wx=ya+"initialized",bs=ya+"active",y1=ya+"prev",v1=ya+"next",Bf=ya+"visible",jf=ya+"loading",b1=ya+"focus-in",x1=ya+"overflow",Sx=[bs,Bf,y1,v1,jf,b1,x1],Cx={slide:_d,clone:f1,arrows:am,arrow:yd,prev:m1,next:g1,pagination:vd,page:_1,spinner:bx};function Tx(b,f){if(W_(b.closest))return b.closest(f);for(var s=b;s&&s.nodeType===1&&!cu(s,f);)s=s.parentElement;return s}var Ex=5,d_=200,w1="touchstart mousedown",Tf="touchmove mousemove",Ef="touchend touchcancel mouseup click";function Mx(b,f,s){var E=en(b),R=E.on,G=E.bind,S=b.root,l=s.i18n,ae={},_e=[],ee=[],Pe=[],Ce,N,ge;function Ee(){Ye(),mt(),Ge()}function He(){R(kn,tt),R(kn,Ee),R(ar,Ge),G(document,w1+" keydown",function($e){ge=$e.type==="keydown"},{capture:!0}),G(S,"focusin",function(){Eo(S,b1,!!ge)})}function tt($e){var bt=om.concat("style");Io(_e),Mo(S,ee),Mo(Ce,Pe),ao([Ce,N],bt),ao(S,$e?bt:["style",mu])}function Ge(){Mo(S,ee),Mo(Ce,Pe),ee=pt(Cf),Pe=pt(h_),oo(S,ee),oo(Ce,Pe),ci(S,Er,s.label),ci(S,nm,s.labelledby)}function Ye(){Ce=dt("."+h_),N=Cu(Ce,"."+mx),Qc(Ce&&N,"A track/list element is missing."),Xh(_e,X_(N,"."+_d+":not(."+f1+")")),_s({arrows:am,pagination:vd,prev:m1,next:g1,bar:yx,toggle:vx},function($e,bt){ae[bt]=dt("."+$e)}),hu(ae,{root:S,track:Ce,list:N,slides:_e})}function mt(){var $e=S.id||Xb(Tu),bt=s.role;S.id=$e,Ce.id=Ce.id||$e+"-track",N.id=N.id||$e+"-list",!Vr(S,ko)&&S.tagName!=="SECTION"&&bt&&ci(S,ko,bt),ci(S,mu,l.carousel),ci(N,ko,"presentation")}function dt($e){var bt=Q_(S,$e);return bt&&Tx(bt,"."+Cf)===S?bt:void 0}function pt($e){return[$e+"--"+s.type,$e+"--"+s.direction,s.drag&&$e+"--draggable",s.isNavigation&&$e+"--nav",$e===Cf&&bs]}return hu(ae,{setup:Ee,mount:He,destroy:tt})}var Ml="slide",zl="loop",ku="fade";function kx(b,f,s,E){var R=en(b),G=R.on,S=R.emit,l=R.bind,ae=b.Components,_e=b.root,ee=b.options,Pe=ee.isNavigation,Ce=ee.updateOnMove,N=ee.i18n,ge=ee.pagination,Ee=ee.slideFocus,He=ae.Direction.resolve,tt=Vr(E,"style"),Ge=Vr(E,Er),Ye=s>-1,mt=Cu(E,"."+gx),dt;function pt(){Ye||(E.id=_e.id+"-slide"+em(f+1),ci(E,ko,ge?"tabpanel":"group"),ci(E,mu,N.slide),ci(E,Er,Ge||Ff(N.slideLabel,[f+1,b.length]))),$e()}function $e(){l(E,"click",Vi(S,i1,Rt)),l(E,"keydown",Vi(S,l1,Rt)),G([Eu,c1,Al],Ke),G(r1,Pt),Ce&&G(ga,Qe)}function bt(){dt=!0,R.destroy(),Mo(E,Sx),ao(E,om),ci(E,"style",tt),ci(E,Er,Ge||"")}function Pt(){var Tt=b.splides.map(function(at){var ft=at.splide.Components.Slides.getAt(f);return ft?ft.slide.id:""}).join(" ");ci(E,Er,Ff(N.slideX,(Ye?s:f)+1)),ci(E,Mu,Tt),ci(E,ko,Ee?"button":""),Ee&&ao(E,mu)}function Qe(){dt||Ke()}function Ke(){if(!dt){var Tt=b.index;et(),rt(),Eo(E,y1,f===Tt-1),Eo(E,v1,f===Tt+1)}}function et(){var Tt=It();Tt!==n_(E,bs)&&(Eo(E,bs,Tt),ci(E,d1,Pe&&Tt||""),S(Tt?Kb:Jb,Rt))}function rt(){var Tt=ei(),at=!Tt&&(!It()||Ye);if(b.state.is([Il,bu])||ci(E,p1,at||""),ci(Jf(E,ee.focusableNodes||""),Cl,at?-1:""),Ee&&ci(E,Cl,at?-1:0),Tt!==n_(E,Bf)&&(Eo(E,Bf,Tt),S(Tt?Qb:ex,Rt)),!Tt&&document.activeElement===E){var ft=ae.Slides.getAt(b.index);ft&&K_(ft.slide)}}function Dt(Tt,at,ft){$r(ft&&mt||E,Tt,at)}function It(){var Tt=b.index;return Tt===f||ee.cloneStatus&&Tt===s}function ei(){if(b.is(ku))return It();var Tt=Tr(ae.Elements.track),at=Tr(E),ft=He("left",!0),xt=He("right",!0);return ad(Tt[ft])<=pu(at[ft])&&ad(at[xt])<=pu(Tt[xt])}function Zt(Tt,at){var ft=or(Tt-f);return!Ye&&(ee.rewind||b.is(zl))&&(ft=ma(ft,b.length-ft)),ft<=at}var Rt={index:f,slideIndex:s,slide:E,container:mt,isClone:Ye,mount:pt,destroy:bt,update:Ke,style:Dt,isWithin:Zt};return Rt}function Px(b,f,s){var E=en(b),R=E.on,G=E.emit,S=E.bind,l=f.Elements,ae=l.slides,_e=l.list,ee=[];function Pe(){Ce(),R(kn,N),R(kn,Ce)}function Ce(){ae.forEach(function(Ke,et){Ee(Ke,et,-1)})}function N(){dt(function(Ke){Ke.destroy()}),Io(ee)}function ge(){dt(function(Ke){Ke.update()})}function Ee(Ke,et,rt){var Dt=kx(b,et,rt,Ke);Dt.mount(),ee.push(Dt),ee.sort(function(It,ei){return It.index-ei.index})}function He(Ke){return Ke?pt(function(et){return!et.isClone}):ee}function tt(Ke){var et=f.Controller,rt=et.toIndex(Ke),Dt=et.hasFocus()?1:s.perPage;return pt(function(It){return Kh(It.index,rt,rt+Dt-1)})}function Ge(Ke){return pt(Ke)[0]}function Ye(Ke,et){Mr(Ke,function(rt){if(fa(rt)&&(rt=J_(rt)),Y_(rt)){var Dt=ae[et];Dt?Kf(rt,Dt):Su(_e,rt),oo(rt,s.classes.slide),bt(rt,Vi(G,fu))}}),G(kn)}function mt(Ke){vs(pt(Ke).map(function(et){return et.slide})),G(kn)}function dt(Ke,et){He(et).forEach(Ke)}function pt(Ke){return ee.filter(W_(Ke)?Ke:function(et){return fa(Ke)?cu(et.slide,Ke):Xf(wu(Ke),et.index)})}function $e(Ke,et,rt){dt(function(Dt){Dt.style(Ke,et,rt)})}function bt(Ke,et){var rt=Jf(Ke,"img"),Dt=rt.length;Dt?rt.forEach(function(It){S(It,"load error",function(){--Dt||et()})}):et()}function Pt(Ke){return Ke?ae.length:ee.length}function Qe(){return ee.length>s.perPage}return{mount:Pe,destroy:N,update:ge,register:Ee,get:He,getIn:tt,getAt:Ge,add:Ye,remove:mt,forEach:dt,filter:pt,style:$e,getLength:Pt,isEnough:Qe}}function Ix(b,f,s){var E=en(b),R=E.on,G=E.bind,S=E.emit,l=f.Slides,ae=f.Direction.resolve,_e=f.Elements,ee=_e.root,Pe=_e.track,Ce=_e.list,N=l.getAt,ge=l.style,Ee,He,tt;function Ge(){Ye(),G(window,"resize load",hx(Vi(S,fu))),R([ar,kn],Ye),R(fu,mt)}function Ye(){Ee=s.direction===gd,$r(ee,"maxWidth",hs(s.width)),$r(Pe,ae("paddingLeft"),dt(!1)),$r(Pe,ae("paddingRight"),dt(!0)),mt(!0)}function mt(Rt){var Tt=Tr(ee);(Rt||He.width!==Tt.width||He.height!==Tt.height)&&($r(Pe,"height",pt()),ge(ae("marginRight"),hs(s.gap)),ge("width",bt()),ge("height",Pt(),!0),He=Tt,S(tm),tt!==(tt=Zt())&&(Eo(ee,x1,tt),S(rx,tt)))}function dt(Rt){var Tt=s.padding,at=ae(Rt?"right":"left");return Tt&&hs(Tt[at]||(lu(Tt)?0:Tt))||"0px"}function pt(){var Rt="";return Ee&&(Rt=$e(),Qc(Rt,"height or heightRatio is missing."),Rt="calc("+Rt+" - "+dt(!1)+" - "+dt(!0)+")"),Rt}function $e(){return hs(s.height||Tr(Ce).width*s.heightRatio)}function bt(){return s.autoWidth?null:hs(s.fixedWidth)||(Ee?"":Qe())}function Pt(){return hs(s.fixedHeight)||(Ee?s.autoHeight?null:Qe():$e())}function Qe(){var Rt=hs(s.gap);return"calc((100%"+(Rt&&" + "+Rt)+")/"+(s.perPage||1)+(Rt&&" - "+Rt)+")"}function Ke(){return Tr(Ce)[ae("width")]}function et(Rt,Tt){var at=N(Rt||0);return at?Tr(at.slide)[ae("width")]+(Tt?0:It()):0}function rt(Rt,Tt){var at=N(Rt);if(at){var ft=Tr(at.slide)[ae("right")],xt=Tr(Ce)[ae("left")];return or(ft-xt)+(Tt?0:It())}return 0}function Dt(Rt){return rt(b.length-1)-rt(0)+et(0,Rt)}function It(){var Rt=N(0);return Rt&&parseFloat($r(Rt.slide,ae("marginRight")))||0}function ei(Rt){return parseFloat($r(Pe,ae("padding"+(Rt?"Right":"Left"))))||0}function Zt(){return b.is(ku)||Dt(!0)>Ke()}return{mount:Ge,resize:mt,listSize:Ke,slideSize:et,sliderSize:Dt,totalSize:rt,getPadding:ei,isOverflow:Zt}}var Ax=2;function zx(b,f,s){var E=en(b),R=E.on,G=f.Elements,S=f.Slides,l=f.Direction.resolve,ae=[],_e;function ee(){R(kn,Pe),R([ar,fu],N),(_e=He())&&(ge(_e),f.Layout.resize(!0))}function Pe(){Ce(),ee()}function Ce(){vs(ae),Io(ae),E.destroy()}function N(){var tt=He();_e!==tt&&(_e<tt||!tt)&&E.emit(kn)}function ge(tt){var Ge=S.get().slice(),Ye=Ge.length;if(Ye){for(;Ge.length<tt;)Xh(Ge,Ge);Xh(Ge.slice(-tt),Ge.slice(0,tt)).forEach(function(mt,dt){var pt=dt<tt,$e=Ee(mt.slide,dt);pt?Kf($e,Ge[0].slide):Su(G.list,$e),Xh(ae,$e),S.register($e,dt-tt+(pt?0:Ye),mt.index)})}}function Ee(tt,Ge){var Ye=tt.cloneNode(!0);return oo(Ye,s.classes.clone),Ye.id=b.root.id+"-clone"+em(Ge+1),Ye}function He(){var tt=s.clones;if(!b.is(zl))tt=0;else if(xu(tt)){var Ge=s[l("fixedWidth")]&&f.Layout.slideSize(0),Ye=Ge&&pu(Tr(G.track)[l("width")]/Ge);tt=Ye||s[l("autoWidth")]&&b.length||s.perPage*Ax}return tt}return{mount:ee,destroy:Ce}}function Dx(b,f,s){var E=en(b),R=E.on,G=E.emit,S=b.state.set,l=f.Layout,ae=l.slideSize,_e=l.getPadding,ee=l.totalSize,Pe=l.listSize,Ce=l.sliderSize,N=f.Direction,ge=N.resolve,Ee=N.orient,He=f.Elements,tt=He.list,Ge=He.track,Ye;function mt(){Ye=f.Transition,R([xs,tm,ar,kn],dt)}function dt(){f.Controller.isBusy()||(f.Scroll.cancel(),$e(b.index),f.Slides.update())}function pt(at,ft,xt,ii){at!==ft&&Rt(at>xt)&&(Ke(),bt(Qe(Dt(),at>xt),!0)),S(Il),G(ga,ft,xt,at),Ye.start(ft,function(){S(El),G(Eu,ft,xt,at),ii&&ii()})}function $e(at){bt(rt(at,!0))}function bt(at,ft){if(!b.is(ku)){var xt=ft?at:Pt(at);$r(tt,"transform","translate"+ge("X")+"("+xt+"px)"),at!==xt&&G(c1)}}function Pt(at){if(b.is(zl)){var ft=et(at),xt=ft>f.Controller.getEnd(),ii=ft<0;(ii||xt)&&(at=Qe(at,xt))}return at}function Qe(at,ft){var xt=at-Zt(ft),ii=Ce();return at-=Ee(ii*(pu(or(xt)/ii)||1))*(ft?1:-1),at}function Ke(){bt(Dt(),!0),Ye.cancel()}function et(at){for(var ft=f.Slides.get(),xt=0,ii=1/0,Qt=0;Qt<ft.length;Qt++){var gi=ft[Qt].index,st=or(rt(gi,!0)-at);if(st<=ii)ii=st,xt=gi;else break}return xt}function rt(at,ft){var xt=Ee(ee(at-1)-ei(at));return ft?It(xt):xt}function Dt(){var at=ge("left");return Tr(tt)[at]-Tr(Ge)[at]+Ee(_e(!1))}function It(at){return s.trimSpace&&b.is(Ml)&&(at=_l(at,0,Ee(Ce(!0)-Pe()))),at}function ei(at){var ft=s.focus;return ft==="center"?(Pe()-ae(at,!0))/2:+ft*ae(at)||0}function Zt(at){return rt(at?f.Controller.getEnd():0,!!s.trimSpace)}function Rt(at){var ft=Ee(Qe(Dt(),at));return at?ft>=0:ft<=tt[ge("scrollWidth")]-Tr(Ge)[ge("width")]}function Tt(at,ft){ft=xu(ft)?Dt():ft;var xt=at!==!0&&Ee(ft)<Ee(Zt(!1)),ii=at!==!1&&Ee(ft)>Ee(Zt(!0));return xt||ii}return{mount:mt,move:pt,jump:$e,translate:bt,shift:Qe,cancel:Ke,toIndex:et,toPosition:rt,getPosition:Dt,getLimit:Zt,exceededLimit:Tt,reposition:dt}}function Lx(b,f,s){var E=en(b),R=E.on,G=E.emit,S=f.Move,l=S.getPosition,ae=S.getLimit,_e=S.toPosition,ee=f.Slides,Pe=ee.isEnough,Ce=ee.getLength,N=s.omitEnd,ge=b.is(zl),Ee=b.is(Ml),He=Vi(Dt,!1),tt=Vi(Dt,!0),Ge=s.start||0,Ye,mt=Ge,dt,pt,$e;function bt(){Pt(),R([ar,kn,sd],Pt),R(tm,Qe)}function Pt(){dt=Ce(!0),pt=s.perMove,$e=s.perPage,Ye=Rt();var st=_l(Ge,0,N?Ye:dt-1);st!==Ge&&(Ge=st,S.reposition())}function Qe(){Ye!==Rt()&&G(sd)}function Ke(st,Yt,_i){if(!gi()){var qt=rt(st),fi=Zt(qt);fi>-1&&(Yt||fi!==Ge)&&(xt(fi),S.move(qt,fi,mt,_i))}}function et(st,Yt,_i,qt){f.Scroll.scroll(st,Yt,_i,function(){var fi=Zt(S.toIndex(l()));xt(N?ma(fi,Ye):fi),qt&&qt()})}function rt(st){var Yt=Ge;if(fa(st)){var _i=st.match(/([+\-<>])(\d+)?/)||[],qt=_i[1],fi=_i[2];qt==="+"||qt==="-"?Yt=It(Ge+ +(""+qt+(+fi||1)),Ge):qt===">"?Yt=fi?Tt(+fi):He(!0):qt==="<"&&(Yt=tt(!0))}else Yt=ge?st:_l(st,0,Ye);return Yt}function Dt(st,Yt){var _i=pt||(Qt()?1:$e),qt=It(Ge+_i*(st?-1:1),Ge,!(pt||Qt()));return qt===-1&&Ee&&!e1(l(),ae(!st),1)?st?0:Ye:Yt?qt:Zt(qt)}function It(st,Yt,_i){if(Pe()||Qt()){var qt=ei(st);qt!==st&&(Yt=st,st=qt,_i=!1),st<0||st>Ye?!pt&&(Kh(0,st,Yt,!0)||Kh(Ye,Yt,st,!0))?st=Tt(at(st)):ge?st=_i?st<0?-(dt%$e||$e):dt:st:s.rewind?st=st<0?Ye:0:st=-1:_i&&st!==Yt&&(st=Tt(at(Yt)+(st<Yt?-1:1)))}else st=-1;return st}function ei(st){if(Ee&&s.trimSpace==="move"&&st!==Ge)for(var Yt=l();Yt===_e(st,!0)&&Kh(st,0,b.length-1,!s.rewind);)st<Ge?--st:++st;return st}function Zt(st){return ge?(st+dt)%dt||0:st}function Rt(){for(var st=dt-(Qt()||ge&&pt?1:$e);N&&st-- >0;)if(_e(dt-1,!0)!==_e(st,!0)){st++;break}return _l(st,0,dt-1)}function Tt(st){return _l(Qt()?st:$e*st,0,Ye)}function at(st){return Qt()?ma(st,Ye):ad((st>=Ye?dt-1:st)/$e)}function ft(st){var Yt=S.toIndex(st);return Ee?_l(Yt,0,Ye):Yt}function xt(st){st!==Ge&&(mt=Ge,Ge=st)}function ii(st){return st?mt:Ge}function Qt(){return!xu(s.focus)||s.isNavigation}function gi(){return b.state.is([Il,bu])&&!!s.waitForTransition}return{mount:bt,go:Ke,scroll:et,getNext:He,getPrev:tt,getAdjacent:Dt,getEnd:Rt,setIndex:xt,getIndex:ii,toIndex:Tt,toPage:at,toDest:ft,hasFocus:Qt,isBusy:gi}}var Rx="http://www.w3.org/2000/svg",Ox="m15.5 0.932-4.3 4.38 14.5 14.6-14.5 14.5 4.3 4.4 14.6-14.6 4.4-4.3-4.4-4.4-14.6-14.6z",Hh=40;function Fx(b,f,s){var E=en(b),R=E.on,G=E.bind,S=E.emit,l=s.classes,ae=s.i18n,_e=f.Elements,ee=f.Controller,Pe=_e.arrows,Ce=_e.track,N=Pe,ge=_e.prev,Ee=_e.next,He,tt,Ge={};function Ye(){dt(),R(ar,mt)}function mt(){pt(),Ye()}function dt(){var et=s.arrows;et&&!(ge&&Ee)&&Pt(),ge&&Ee&&(hu(Ge,{prev:ge,next:Ee}),du(N,et?"":"none"),oo(N,tt=am+"--"+s.direction),et&&($e(),Ke(),ci([ge,Ee],Mu,Ce.id),S(ox,ge,Ee)))}function pt(){E.destroy(),Mo(N,tt),He?(vs(Pe?[ge,Ee]:N),ge=Ee=null):ao([ge,Ee],om)}function $e(){R([xs,Eu,kn,Al,sd],Ke),G(Ee,"click",Vi(bt,">")),G(ge,"click",Vi(bt,"<"))}function bt(et){ee.go(et,!0)}function Pt(){N=Pe||Sl("div",l.arrows),ge=Qe(!0),Ee=Qe(!1),He=!0,Su(N,[ge,Ee]),!Pe&&Kf(N,Ce)}function Qe(et){var rt='<button class="'+l.arrow+" "+(et?l.prev:l.next)+'" type="button"><svg xmlns="'+Rx+'" viewBox="0 0 '+Hh+" "+Hh+'" width="'+Hh+'" height="'+Hh+'" focusable="false"><path d="'+(s.arrowPath||Ox)+'" />';return J_(rt)}function Ke(){if(ge&&Ee){var et=b.index,rt=ee.getPrev(),Dt=ee.getNext(),It=rt>-1&&et<rt?ae.last:ae.prev,ei=Dt>-1&&et>Dt?ae.first:ae.next;ge.disabled=rt<0,Ee.disabled=Dt<0,ci(ge,Er,It),ci(Ee,Er,ei),S(ax,ge,Ee,rt,Dt)}}return{arrows:Ge,mount:Ye,destroy:pt,update:Ke}}var Bx=Qf+"-interval";function jx(b,f,s){var E=en(b),R=E.on,G=E.bind,S=E.emit,l=dd(s.interval,b.go.bind(b,">"),$e),ae=l.isPaused,_e=f.Elements,ee=f.Elements,Pe=ee.root,Ce=ee.toggle,N=s.autoplay,ge,Ee,He=N==="pause";function tt(){N&&(Ge(),Ce&&ci(Ce,Mu,_e.track.id),He||Ye(),pt())}function Ge(){s.pauseOnHover&&G(Pe,"mouseenter mouseleave",function(Pt){ge=Pt.type==="mouseenter",dt()}),s.pauseOnFocus&&G(Pe,"focusin focusout",function(Pt){Ee=Pt.type==="focusin",dt()}),Ce&&G(Ce,"click",function(){He?Ye():mt(!0)}),R([ga,im,kn],l.rewind),R(ga,bt)}function Ye(){ae()&&f.Slides.isEnough()&&(l.start(!s.resetProgress),Ee=ge=He=!1,pt(),S(o1))}function mt(Pt){Pt===void 0&&(Pt=!0),He=!!Pt,pt(),ae()||(l.pause(),S(a1))}function dt(){He||(ge||Ee?mt(!1):Ye())}function pt(){Ce&&(Eo(Ce,bs,!He),ci(Ce,Er,s.i18n[He?"play":"pause"]))}function $e(Pt){var Qe=_e.bar;Qe&&$r(Qe,"width",Pt*100+"%"),S(cx,Pt)}function bt(Pt){var Qe=f.Slides.getAt(Pt);l.set(Qe&&+Vr(Qe.slide,Bx)||s.interval)}return{mount:tt,destroy:l.cancel,play:Ye,pause:mt,isPaused:ae}}function Nx(b,f,s){var E=en(b),R=E.on;function G(){s.cover&&(R(s1,Vi(l,!0)),R([xs,ar,kn],Vi(S,!0)))}function S(ae){f.Slides.forEach(function(_e){var ee=Cu(_e.container||_e.slide,"img");ee&&ee.src&&l(ae,ee,_e)})}function l(ae,_e,ee){ee.style("background",ae?'center/cover no-repeat url("'+_e.src+'")':"",!0),du(_e,ae?"none":"")}return{mount:G,destroy:Vi(S,!1)}}var $x=10,Vx=600,Ux=.6,qx=1.5,Gx=800;function Zx(b,f,s){var E=en(b),R=E.on,G=E.emit,S=b.state.set,l=f.Move,ae=l.getPosition,_e=l.getLimit,ee=l.exceededLimit,Pe=l.translate,Ce=b.is(Ml),N,ge,Ee=1;function He(){R(ga,mt),R([ar,kn],dt)}function tt($e,bt,Pt,Qe,Ke){var et=ae();if(mt(),Pt&&(!Ce||!ee())){var rt=f.Layout.sliderSize(),Dt=Of($e)*rt*ad(or($e)/rt)||0;$e=l.toPosition(f.Controller.toDest($e%rt))+Dt}var It=e1(et,$e,1);Ee=1,bt=It?0:bt||od(or($e-et)/qx,Gx),ge=Qe,N=dd(bt,Ge,Vi(Ye,et,$e,Ke),1),S(bu),G(im),N.start()}function Ge(){S(El),ge&&ge(),G(Al)}function Ye($e,bt,Pt,Qe){var Ke=ae(),et=$e+(bt-$e)*pt(Qe),rt=(et-Ke)*Ee;Pe(Ke+rt),Ce&&!Pt&&ee()&&(Ee*=Ux,or(rt)<$x&&tt(_e(ee(!0)),Vx,!1,ge,!0))}function mt(){N&&N.cancel()}function dt(){N&&!N.isPaused()&&(mt(),Ge())}function pt($e){var bt=s.easingFunc;return bt?bt($e):1-Math.pow(1-$e,4)}return{mount:He,destroy:mt,scroll:tt,cancel:dt}}var yl={passive:!1,capture:!0};function Hx(b,f,s){var E=en(b),R=E.on,G=E.emit,S=E.bind,l=E.unbind,ae=b.state,_e=f.Move,ee=f.Scroll,Pe=f.Controller,Ce=f.Elements.track,N=f.Media.reduce,ge=f.Direction,Ee=ge.resolve,He=ge.orient,tt=_e.getPosition,Ge=_e.exceededLimit,Ye,mt,dt,pt,$e,bt=!1,Pt,Qe,Ke;function et(){S(Ce,Tf,Lf,yl),S(Ce,Ef,Lf,yl),S(Ce,w1,Dt,yl),S(Ce,"click",Zt,{capture:!0}),S(Ce,"dragstart",To),R([xs,ar],rt)}function rt(){var ut=s.drag;Wi(!ut),pt=ut==="free"}function Dt(ut){if(Pt=!1,!Qe){var Xt=fi(ut);qt(ut.target)&&(Xt||!ut.button)&&(Pe.isBusy()?To(ut,!0):(Ke=Xt?Ce:window,$e=ae.is([Il,bu]),dt=null,S(Ke,Tf,It,yl),S(Ke,Ef,ei,yl),_e.cancel(),ee.cancel(),Rt(ut)))}}function It(ut){if(ae.is(Yh)||(ae.set(Yh),G(tx)),ut.cancelable)if($e){_e.translate(Ye+_i(Qt(ut)));var Xt=gi(ut)>d_,we=bt!==(bt=Ge());(Xt||we)&&Rt(ut),Pt=!0,G(ix),To(ut)}else ft(ut)&&($e=at(ut),To(ut))}function ei(ut){ae.is(Yh)&&(ae.set(El),G(nx)),$e&&(Tt(ut),To(ut)),l(Ke,Tf,It),l(Ke,Ef,ei),$e=!1}function Zt(ut){!Qe&&Pt&&To(ut,!0)}function Rt(ut){dt=mt,mt=ut,Ye=tt()}function Tt(ut){var Xt=xt(ut),we=ii(Xt),ht=s.rewind&&s.rewindByDrag;N(!1),pt?Pe.scroll(we,0,s.snap):b.is(ku)?Pe.go(He(Of(Xt))<0?ht?"<":"-":ht?">":"+"):b.is(Ml)&&bt&&ht?Pe.go(Ge(!0)?">":"<"):Pe.go(Pe.toDest(we),!0),N(!0)}function at(ut){var Xt=s.dragMinThreshold,we=lu(Xt),ht=we&&Xt.mouse||0,Ot=(we?Xt.touch:+Xt)||10;return or(Qt(ut))>(fi(ut)?Ot:ht)}function ft(ut){return or(Qt(ut))>or(Qt(ut,!0))}function xt(ut){if(b.is(zl)||!bt){var Xt=gi(ut);if(Xt&&Xt<d_)return Qt(ut)/Xt}return 0}function ii(ut){return tt()+Of(ut)*ma(or(ut)*(s.flickPower||600),pt?1/0:f.Layout.listSize()*(s.flickMaxPages||1))}function Qt(ut,Xt){return Yt(ut,Xt)-Yt(st(ut),Xt)}function gi(ut){return Rf(ut)-Rf(st(ut))}function st(ut){return mt===ut&&dt||mt}function Yt(ut,Xt){return(fi(ut)?ut.changedTouches[0]:ut)["page"+Ee(Xt?"Y":"X")]}function _i(ut){return ut/(bt&&b.is(Ml)?Ex:1)}function qt(ut){var Xt=s.noDrag;return!cu(ut,"."+_1+", ."+yd)&&(!Xt||!cu(ut,Xt))}function fi(ut){return typeof TouchEvent<"u"&&ut instanceof TouchEvent}function Ci(){return $e}function Wi(ut){Qe=ut}return{mount:et,disable:Wi,isDragging:Ci}}var Wx={Spacebar:" ",Right:md,Left:fd,Up:u1,Down:h1};function sm(b){return b=fa(b)?b:b.key,Wx[b]||b}var p_="keydown";function Yx(b,f,s){var E=en(b),R=E.on,G=E.bind,S=E.unbind,l=b.root,ae=f.Direction.resolve,_e,ee;function Pe(){Ce(),R(ar,N),R(ar,Ce),R(ga,Ee)}function Ce(){var tt=s.keyboard;tt&&(_e=tt==="global"?window:l,G(_e,p_,He))}function N(){S(_e,p_)}function ge(tt){ee=tt}function Ee(){var tt=ee;ee=!0,H_(function(){ee=tt})}function He(tt){if(!ee){var Ge=sm(tt);Ge===ae(fd)?b.go("<"):Ge===ae(md)&&b.go(">")}}return{mount:Pe,destroy:N,disable:ge}}var eu=Qf+"-lazy",Jh=eu+"-srcset",Xx="["+eu+"], ["+Jh+"]";function Kx(b,f,s){var E=en(b),R=E.on,G=E.off,S=E.bind,l=E.emit,ae=s.lazyLoad==="sequential",_e=[Eu,Al],ee=[];function Pe(){s.lazyLoad&&(Ce(),R(kn,Ce))}function Ce(){Io(ee),N(),ae?tt():(G(_e),R(_e,ge),ge())}function N(){f.Slides.forEach(function(Ge){Jf(Ge.slide,Xx).forEach(function(Ye){var mt=Vr(Ye,eu),dt=Vr(Ye,Jh);if(mt!==Ye.src||dt!==Ye.srcset){var pt=s.classes.spinner,$e=Ye.parentElement,bt=Cu($e,"."+pt)||Sl("span",pt,$e);ee.push([Ye,Ge,bt]),Ye.src||du(Ye,"none")}})})}function ge(){ee=ee.filter(function(Ge){var Ye=s.perPage*((s.preloadPages||1)+1)-1;return Ge[1].isWithin(b.index,Ye)?Ee(Ge):!0}),ee.length||G(_e)}function Ee(Ge){var Ye=Ge[0];oo(Ge[1].slide,jf),S(Ye,"load error",Vi(He,Ge)),ci(Ye,"src",Vr(Ye,eu)),ci(Ye,"srcset",Vr(Ye,Jh)),ao(Ye,eu),ao(Ye,Jh)}function He(Ge,Ye){var mt=Ge[0],dt=Ge[1];Mo(dt.slide,jf),Ye.type!=="error"&&(vs(Ge[2]),du(mt,""),l(s1,mt,dt),l(fu)),ae&&tt()}function tt(){ee.length&&Ee(ee.shift())}return{mount:Pe,destroy:Vi(Io,ee),check:ge}}function Jx(b,f,s){var E=en(b),R=E.on,G=E.emit,S=E.bind,l=f.Slides,ae=f.Elements,_e=f.Controller,ee=_e.hasFocus,Pe=_e.getIndex,Ce=_e.go,N=f.Direction.resolve,ge=ae.pagination,Ee=[],He,tt;function Ge(){Ye(),R([ar,kn,sd],Ge);var Qe=s.pagination;ge&&du(ge,Qe?"":"none"),Qe&&(R([ga,im,Al],Pt),mt(),Pt(),G(sx,{list:He,items:Ee},bt(b.index)))}function Ye(){He&&(vs(ge?_a(He.children):He),Mo(He,tt),Io(Ee),He=null),E.destroy()}function mt(){var Qe=b.length,Ke=s.classes,et=s.i18n,rt=s.perPage,Dt=ee()?_e.getEnd()+1:pu(Qe/rt);He=ge||Sl("ul",Ke.pagination,ae.track.parentElement),oo(He,tt=vd+"--"+$e()),ci(He,ko,"tablist"),ci(He,Er,et.select),ci(He,rm,$e()===gd?"vertical":"");for(var It=0;It<Dt;It++){var ei=Sl("li",null,He),Zt=Sl("button",{class:Ke.page,type:"button"},ei),Rt=l.getIn(It).map(function(at){return at.slide.id}),Tt=!ee()&&rt>1?et.pageX:et.slideX;S(Zt,"click",Vi(dt,It)),s.paginationKeyboard&&S(Zt,"keydown",Vi(pt,It)),ci(ei,ko,"presentation"),ci(Zt,ko,"tab"),ci(Zt,Mu,Rt.join(" ")),ci(Zt,Er,Ff(Tt,It+1)),ci(Zt,Cl,-1),Ee.push({li:ei,button:Zt,page:It})}}function dt(Qe){Ce(">"+Qe,!0)}function pt(Qe,Ke){var et=Ee.length,rt=sm(Ke),Dt=$e(),It=-1;rt===N(md,!1,Dt)?It=++Qe%et:rt===N(fd,!1,Dt)?It=(--Qe+et)%et:rt==="Home"?It=0:rt==="End"&&(It=et-1);var ei=Ee[It];ei&&(K_(ei.button),Ce(">"+It),To(Ke,!0))}function $e(){return s.paginationDirection||s.direction}function bt(Qe){return Ee[_e.toPage(Qe)]}function Pt(){var Qe=bt(Pe(!0)),Ke=bt(Pe());if(Qe){var et=Qe.button;Mo(et,bs),ao(et,s_),ci(et,Cl,-1)}if(Ke){var rt=Ke.button;oo(rt,bs),ci(rt,s_,!0),ci(rt,Cl,"")}G(lx,{list:He,items:Ee},Qe,Ke)}return{items:Ee,mount:Ge,destroy:Ye,getAt:bt,update:Pt}}var Qx=[" ","Enter"];function e2(b,f,s){var E=s.isNavigation,R=s.slideFocus,G=[];function S(){b.splides.forEach(function(ge){ge.isParent||(_e(b,ge.splide),_e(ge.splide,b))}),E&&ee()}function l(){G.forEach(function(ge){ge.destroy()}),Io(G)}function ae(){l(),S()}function _e(ge,Ee){var He=en(ge);He.on(ga,function(tt,Ge,Ye){Ee.go(Ee.is(zl)?Ye:tt)}),G.push(He)}function ee(){var ge=en(b),Ee=ge.on;Ee(i1,Ce),Ee(l1,N),Ee([xs,ar],Pe),G.push(ge),ge.emit(r1,b.splides)}function Pe(){ci(f.Elements.list,rm,s.direction===gd?"vertical":"")}function Ce(ge){b.go(ge.index)}function N(ge,Ee){Xf(Qx,sm(Ee))&&(Ce(ge),To(Ee))}return{setup:Vi(f.Media.set,{slideFocus:xu(R)?E:R},!0),mount:S,destroy:l,remount:ae}}function t2(b,f,s){var E=en(b),R=E.bind,G=0;function S(){s.wheel&&R(f.Elements.track,"wheel",l,yl)}function l(_e){if(_e.cancelable){var ee=_e.deltaY,Pe=ee<0,Ce=Rf(_e),N=s.wheelMinThreshold||0,ge=s.wheelSleep||0;or(ee)>N&&Ce-G>ge&&(b.go(Pe?"<":">"),G=Ce),ae(Pe)&&To(_e)}}function ae(_e){return!s.releaseWheel||b.state.is(Il)||f.Controller.getAdjacent(_e)!==-1}return{mount:S}}var i2=90;function n2(b,f,s){var E=en(b),R=E.on,G=f.Elements.track,S=s.live&&!s.isNavigation,l=Sl("span",xx),ae=dd(i2,Vi(ee,!1));function _e(){S&&(Ce(!f.Autoplay.isPaused()),ci(G,u_,!0),l.textContent="",R(o1,Vi(Ce,!0)),R(a1,Vi(Ce,!1)),R([Eu,Al],Vi(ee,!0)))}function ee(N){ci(G,c_,N),N?(Su(G,l),ae.start()):(vs(l),ae.cancel())}function Pe(){ao(G,[l_,u_,c_]),vs(l)}function Ce(N){S&&ci(G,l_,N?"off":"polite")}return{mount:_e,disable:Ce,destroy:Pe}}var r2=Object.freeze({__proto__:null,Media:dx,Direction:px,Elements:Mx,Slides:Px,Layout:Ix,Clones:zx,Move:Dx,Controller:Lx,Arrows:Fx,Autoplay:jx,Cover:Nx,Scroll:Zx,Drag:Hx,Keyboard:Yx,LazyLoad:Kx,Pagination:Jx,Sync:e2,Wheel:t2,Live:n2}),o2={prev:"Previous slide",next:"Next slide",first:"Go to first slide",last:"Go to last slide",slideX:"Go to slide %s",pageX:"Go to page %s",play:"Start autoplay",pause:"Pause autoplay",carousel:"carousel",slide:"slide",select:"Select a slide to show",slideLabel:"%s of %s"},a2={type:"slide",role:"region",speed:400,perPage:1,cloneStatus:!0,arrows:!0,pagination:!0,paginationKeyboard:!0,interval:5e3,pauseOnHover:!0,pauseOnFocus:!0,resetProgress:!0,easing:"cubic-bezier(0.25, 1, 0.5, 1)",drag:!0,direction:"ltr",trimSpace:!0,focusableNodes:"a, button, textarea, input, select, iframe",live:!0,classes:Cx,i18n:o2,reducedMotion:{speed:0,rewindSpeed:0,autoplay:"pause"}};function s2(b,f,s){var E=f.Slides;function R(){en(b).on([xs,kn],G)}function G(){E.forEach(function(l){l.style("transform","translateX(-"+100*l.index+"%)")})}function S(l,ae){E.style("transition","opacity "+s.speed+"ms "+s.easing),H_(ae)}return{mount:R,start:S,cancel:Lf}}function l2(b,f,s){var E=f.Move,R=f.Controller,G=f.Scroll,S=f.Elements.list,l=Vi($r,S,"transition"),ae;function _e(){en(b).bind(S,"transitionend",function(N){N.target===S&&ae&&(Pe(),ae())})}function ee(N,ge){var Ee=E.toPosition(N,!0),He=E.getPosition(),tt=Ce(N);or(Ee-He)>=1&&tt>=1?s.useScroll?G.scroll(Ee,tt,!1,ge):(l("transform "+tt+"ms "+s.easing),E.translate(Ee,!0),ae=ge):(E.jump(N),ge())}function Pe(){l(""),G.cancel()}function Ce(N){var ge=s.rewindSpeed;if(b.is(Ml)&&ge){var Ee=R.getIndex(!0),He=R.getEnd();if(Ee===0&&N>=He||Ee>=He&&N===0)return ge}return s.speed}return{mount:_e,start:ee,cancel:Pe}}var c2=function(){function b(s,E){this.event=en(),this.Components={},this.state=ux(vl),this.splides=[],this._o={},this._E={};var R=fa(s)?Q_(document,s):s;Qc(R,R+" is invalid."),this.root=R,E=pa({label:Vr(R,Er)||"",labelledby:Vr(R,nm)||""},a2,b.defaults,E||{});try{pa(E,JSON.parse(Vr(R,Qf)))}catch{Qc(!1,"Invalid JSON")}this._o=Object.create(pa({},E))}var f=b.prototype;return f.mount=function(E,R){var G=this,S=this.state,l=this.Components;Qc(S.is([vl,rd]),"Already mounted!"),S.set(vl),this._C=l,this._T=R||this._T||(this.is(ku)?s2:l2),this._E=E||this._E;var ae=hu({},r2,this._E,{Transition:this._T});return _s(ae,function(_e,ee){var Pe=_e(G,l,G._o);l[ee]=Pe,Pe.setup&&Pe.setup()}),_s(l,function(_e){_e.mount&&_e.mount()}),this.emit(xs),oo(this.root,wx),S.set(El),this.emit(o_),this},f.sync=function(E){return this.splides.push({splide:E}),E.splides.push({splide:this,isParent:!0}),this.state.is(El)&&(this._C.Sync.remount(),E.Components.Sync.remount()),this},f.go=function(E){return this._C.Controller.go(E),this},f.on=function(E,R){return this.event.on(E,R),this},f.off=function(E){return this.event.off(E),this},f.emit=function(E){var R;return(R=this.event).emit.apply(R,[E].concat(_a(arguments,1))),this},f.add=function(E,R){return this._C.Slides.add(E,R),this},f.remove=function(E){return this._C.Slides.remove(E),this},f.is=function(E){return this._o.type===E},f.refresh=function(){return this.emit(kn),this},f.destroy=function(E){E===void 0&&(E=!0);var R=this.event,G=this.state;return G.is(vl)?en(this).on(o_,this.destroy.bind(this,E)):(_s(this._C,function(S){S.destroy&&S.destroy(E)},!0),R.emit(n1),R.destroy(),E&&Io(this.splides),G.set(rd)),this},Hb(b,[{key:"options",get:function(){return this._o},set:function(E){this._C.Media.set(E,!0,!0)}},{key:"length",get:function(){return this._C.Slides.getLength(!0)}},{key:"index",get:function(){return this._C.Controller.getIndex()}}]),b}(),bd=c2;bd.defaults={};bd.STATES=Yb;var u2=Object.defineProperty,h2=Object.getOwnPropertyDescriptor,Ji=(b,f,s,E)=>{for(var R=E>1?void 0:E?h2(f,s):f,G=b.length-1,S;G>=0;G--)(S=b[G])&&(R=(E?S(f,s,R):S(R))||R);return E&&R&&u2(f,s,R),R};let Hi=class extends mi{constructor(){super(),this.splideContainer=null,this.showCount=!1,this.autoplay=!1,this._currentIndexCountElement=null,this._totalSlidesCountElement=null,this._numberOfSlides=0,this._activeSlideIndex=1,this.slidesToShow=1,this.slidesPerMove=1,this.sliderType="loop",this.sliderGap="0",this.autoplayInterval="6000",this.sliderBreakpoints=null,this.sliderPadding="0",this.sliderFocusCenter=!1,this.sliderAspectRatio="0.5625",this.sliderClonesAmount=null,this.arrowPrevAriaLabel="",this.arrowNextAriaLabel="",this.arrowFirstAriaLabel="",this.arrowLastAriaLabel="",this.sliderMediaQuery="max",this._handlePaginationUpdate=this._handlePaginationUpdate.bind(this),this._handleSliderMount=this._handleSliderMount.bind(this)}createRenderRoot(){return this}firstUpdated(){if(this.splideContainer=this.querySelector(".splide")||null,this.splideContainer)this._initSlider();else{console.error("TOUJOU: Could not get necessary elements to initialize the slider");return}}_initSlider(){let b={classes:{pagination:"splide__pagination slider-bullets",page:"splide__pagination__page slider-bullets__bullet"},type:this.sliderType,autoplay:this.autoplay,interval:this.autoplayInterval,pauseOnHover:this.autoplay,pauseOnFocus:this.autoplay,perPage:parseInt(String(this.slidesToShow)),perMove:this.slidesPerMove,gap:this.sliderGap,heightRatio:this.sliderAspectRatio,mediaQuery:this.sliderMediaQuery,reducedMotion:{speed:0,rewindSpeed:0,autoplay:"pause"},padding:this.sliderPadding,i18n:{prev:this.arrowPrevAriaLabel,next:this.arrowNextAriaLabel,first:this.arrowFirstAriaLabel,last:this.arrowLastAriaLabel},focusableNodes:"*",breakpoints:void 0};if(this.sliderFocusCenter==="true"&&(b.focus="center",b.trimSpace=!1),this.sliderBreakpoints)try{b.breakpoints=JSON.parse(this.sliderBreakpoints)}catch(f){console.error("Error parsing slider breakpoints JSON:",f,`
`,"Received breakpoints JSON:",`
`,this.sliderBreakpoints)}this.sliderClonesAmount&&(b.clones=this.sliderClonesAmount),this.splideSlider=new bd(this.splideContainer,b),this.splideSlider.on("mounted",this._handleSliderMount),this.splideSlider.on("moved",this._handlePaginationUpdate),this.splideSlider.mount()}_handleSliderMount(){this._getCountInfo(),this._initCount(),this._removeSlidesTabpanelRole(),this._addAriaLabelToSliderContainer(),this.dispatchEvent(new CustomEvent("toujou-slider-mounted",{bubbles:!0,composed:!0,detail:{el:this.splideSlider}}))}_removeSlidesTabpanelRole(){const b=this.splideSlider.root.querySelectorAll('*[role="tabpanel"]');b&&b.forEach(f=>{f.removeAttribute("role"),f.removeAttribute("aria-label")})}_addAriaLabelToSliderContainer(){var f,s;const b=(f=this.splideContainer)==null?void 0:f.id;(s=this.splideContainer)==null||s.setAttribute("aria-label",`Slider - ${b}`)}_getCountInfo(){this._currentIndexCountElement=this.querySelector(".slider-count__current"),this._totalSlidesCountElement=this.querySelector(".slider-count__total")}_initCount(){this._numberOfSlides=this.splideSlider.Components.Elements.slides.length,this._updateSliderCount()}_handlePaginationUpdate(b){this._activeSlideIndex=b+1,this._updateSliderCount(),this.dispatchEvent(new CustomEvent("toujou-slider-moved",{bubbles:!0,composed:!0,detail:{el:this.splideSlider,activeIndex:this._activeSlideIndex}}))}_updateSliderCount(){this._currentIndexCountElement&&(this._currentIndexCountElement.textContent=String(this._activeSlideIndex)),this._totalSlidesCountElement&&(this._totalSlidesCountElement.textContent=String(this._numberOfSlides))}};Ji([vt({type:Object})],Hi.prototype,"splideContainer",2);Ji([vt({type:Boolean,attribute:"show-count"})],Hi.prototype,"showCount",2);Ji([vt({type:Boolean,attribute:"auto-play"})],Hi.prototype,"autoplay",2);Ji([vt()],Hi.prototype,"_currentIndexCountElement",2);Ji([vt()],Hi.prototype,"_totalSlidesCountElement",2);Ji([Yc()],Hi.prototype,"_numberOfSlides",2);Ji([Yc()],Hi.prototype,"_activeSlideIndex",2);Ji([vt()],Hi.prototype,"splideSlider",2);Ji([vt({reflect:!0,attribute:"slides-to-show"})],Hi.prototype,"slidesToShow",2);Ji([vt({reflect:!0,attribute:"slides-per-move"})],Hi.prototype,"slidesPerMove",2);Ji([vt({reflect:!0,attribute:"slider-type"})],Hi.prototype,"sliderType",2);Ji([vt({reflect:!0,attribute:"slider-gap"})],Hi.prototype,"sliderGap",2);Ji([vt({reflect:!0,attribute:"auto-play-interval"})],Hi.prototype,"autoplayInterval",2);Ji([vt({reflect:!0,attribute:"slider-breakpoints"})],Hi.prototype,"sliderBreakpoints",2);Ji([vt({reflect:!0,attribute:"slider-padding"})],Hi.prototype,"sliderPadding",2);Ji([vt({reflect:!0,attribute:"slider-focus-center"})],Hi.prototype,"sliderFocusCenter",2);Ji([vt({reflect:!0,attribute:"slider-aspect-ratio"})],Hi.prototype,"sliderAspectRatio",2);Ji([vt({reflect:!0,attribute:"slider-clones-amount"})],Hi.prototype,"sliderClonesAmount",2);Ji([vt({attribute:"arrow-prev-aria-label"})],Hi.prototype,"arrowPrevAriaLabel",2);Ji([vt({attribute:"arrow-next-aria-label"})],Hi.prototype,"arrowNextAriaLabel",2);Ji([vt({attribute:"arrow-first-aria-label"})],Hi.prototype,"arrowFirstAriaLabel",2);Ji([vt({attribute:"arrow-last-aria-label"})],Hi.prototype,"arrowLastAriaLabel",2);Ji([vt({reflect:!0,attribute:"slider-media-query"})],Hi.prototype,"sliderMediaQuery",2);Hi=Ji([Ln("toujou-slider")],Hi);const d2=bn`
  * {
    box-sizing: border-box;
  }

  :host {
    position: relative;
  }
`;var p2=Object.defineProperty,f2=Object.getOwnPropertyDescriptor,S1=b=>{throw TypeError(b)},lm=(b,f,s,E)=>{for(var R=E>1?void 0:E?f2(f,s):f,G=b.length-1,S;G>=0;G--)(S=b[G])&&(R=(E?S(f,s,R):S(R))||R);return E&&R&&p2(f,s,R),R},m2=(b,f,s)=>f.has(b)||S1("Cannot "+s),Nf=(b,f,s)=>(m2(b,f,"read from private field"),s?s.call(b):f.get(b)),g2=(b,f,s)=>f.has(b)?S1("Cannot add the same private member more than once"):f instanceof WeakSet?f.add(b):f.set(b,s),tu,cm,C1;let gu=class extends mi{constructor(){super(...arguments),g2(this,tu),this._currentImageIndex=1,this._imageCount=0}render(){return pi`
            <slot id="slider" name="slider"></slot>
            <slot id="button" name="button" @click="${this._handleButtonClick}"></slot>
        `}_handleButtonClick(){var f;const b=(f=Nf(this,tu,cm))==null?void 0:f.querySelector(".slider-slide.is-active.is-visible .slider__item");b?b.click():Nf(this,tu,C1).click()}};tu=new WeakSet;cm=function(){var s;const b=(s=this.shadowRoot)==null?void 0:s.querySelector("#slider");return b&&b.assignedElements({flatten:!0})[0]||null};C1=function(){var f;return((f=Nf(this,tu,cm))==null?void 0:f.querySelector("a.slider__item"))||null};gu.styles=[d2];lm([vt({type:Number})],gu.prototype,"_currentImageIndex",2);lm([vt({type:Number})],gu.prototype,"_imageCount",2);gu=lm([Ln("toujou-portfolio-gallery")],gu);var _2=Object.defineProperty,y2=Object.getOwnPropertyDescriptor,qr=(b,f,s,E)=>{for(var R=E>1?void 0:E?y2(f,s):f,G=b.length-1,S;G>=0;G--)(S=b[G])&&(R=(E?S(f,s,R):S(R))||R);return E&&R&&_2(f,s,R),R};let kr=class extends mi{constructor(){super(),this.splideContainer=null,this._maxCardWidth=null,this._cardGap=null,this._cardWidthWithGap=null,this._sliderWidth=null,this._slidesThatFitIntoScreen=null,this._numberOfSlidesInSlider=0,this._isSlide=!1,this._resizeObserver=null,this._initSlider=()=>{this._slidesThatFitIntoScreen=this._calculateSlidesThatFitIntoScreen();const b={classes:{pagination:"splide__pagination slider-bullets",page:"splide__pagination__page slider-bullets__bullet"},type:this._isSlide?"loop":"slide",autoplay:!1,perPage:Math.floor(this._slidesThatFitIntoScreen),perMove:1,gap:this._cardGap,padding:{right:this._calculatePadding()},width:this._cardWidthWithGap,reducedMotion:{speed:0,rewindSpeed:0,autoplay:"pause"}};this.splideSlider=new bd(this.splideContainer,b),this.splideSlider.on("mounted",this._handleSliderMount),this.splideSlider.mount()},this._handleSliderMount=()=>{this._removeSlidesTabpanelRole(),this.dispatchEvent(new CustomEvent("toujou-cover-slider-mounted",{bubbles:!0,composed:!0,detail:{el:this.splideSlider}}))},this._updateSliderOptions=()=>{this.splideSlider&&(this.splideSlider.destroy(),this._initSlider())},this._resizeObserver=new ResizeObserver(b=>{b.forEach(()=>this._updateUI())})}connectedCallback(){super.connectedCallback(),this._resizeObserver.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this._resizeObserver.unobserve(this)}createRenderRoot(){return this}firstUpdated(){if(this._updateCustomProperties(),this._numberOfSlidesInSlider=this.querySelectorAll(".cover-slider__item").length,this.splideContainer=this.querySelector(".splide")||null,this.splideContainer)this._initSlider(),this._updateUI();else{console.error("TOUJOU: Could not get necessary elements to initialize the slider");return}}_updateUI(){this._updateCustomProperties(),this._isSlide=this._slidesThatFitIntoScreen<=this._numberOfSlidesInSlider,this._updateSliderOptions()}_updateCustomProperties(){const b=getComputedStyle(this);this._maxCardWidth=+b.getPropertyValue("--cover-slider-card-max-width"),this._cardGap=+b.getPropertyValue("--cover-slider-card-gap"),this._cardWidthWithGap=this._maxCardWidth+this._cardGap}_calculateSlidesThatFitIntoScreen(){return this._sliderWidth=this.getBoundingClientRect().width,Math.ceil(this._sliderWidth/this._cardWidthWithGap)+.5}_calculatePadding(){return`${100/(this._slidesThatFitIntoScreen*2)}%`}_removeSlidesTabpanelRole(){const b=this.splideSlider.root.querySelectorAll('*[role="tabpanel"]');b&&b.forEach(f=>{f.removeAttribute("role"),f.removeAttribute("aria-label")})}};qr([vt({type:Object})],kr.prototype,"splideContainer",2);qr([vt()],kr.prototype,"splideSlider",2);qr([vt({type:Number})],kr.prototype,"_maxCardWidth",2);qr([vt({type:Number})],kr.prototype,"_cardGap",2);qr([vt({type:Number})],kr.prototype,"_cardWidthWithGap",2);qr([vt({type:Number})],kr.prototype,"_sliderWidth",2);qr([vt({type:Number})],kr.prototype,"_slidesThatFitIntoScreen",2);qr([vt({type:Number})],kr.prototype,"_numberOfSlidesInSlider",2);qr([vt({type:Boolean,reflect:!0,attribute:"is-slider"})],kr.prototype,"_isSlide",2);qr([vt({type:ResizeObserver})],kr.prototype,"_resizeObserver",2);kr=qr([Ln("toujou-cover-slider")],kr);const ld=class ld extends HTMLElement{constructor(){super(),this._select=null,this._onSelectChange=this._onSelectChange.bind(this)}connectedCallback(){var f;this._select=this.querySelector(ld.SELECT_SELECTOR),(f=this._select)==null||f.addEventListener("change",this._onSelectChange)}disconnectedCallback(){var f;(f=this._select)==null||f.removeEventListener("change",this._onSelectChange)}_onSelectChange(){const f=this._select.value;f&&(window.location.href=f)}};ld.SELECT_SELECTOR="select.language-picker-dropdown__select";let $f=ld;customElements.define("toujou-language-picker-dropdown",$f);class v2{constructor(f){this.dialogEl=f,this.closeButton=this.dialogEl.querySelector(".contact-dialog__close"),this._onDialogClick=this._onDialogClick.bind(this),this._onOpenContactDialog=this._onOpenContactDialog.bind(this),this._closeDialog=this._closeDialog.bind(this),this._addEventListeners()}_addEventListeners(){var f;window.addEventListener("open-contact-dialog",this._onOpenContactDialog),(f=this.closeButton)==null||f.addEventListener("click",this._closeDialog),this.dialogEl.addEventListener("click",this._onDialogClick)}_onOpenContactDialog(){this.dialogEl.showModal()}_closeDialog(){this.dialogEl.close()}_onDialogClick(f){const s=this.dialogEl.getBoundingClientRect();f.clientX>=s.left&&f.clientX<=s.right&&f.clientY>=s.top&&f.clientY<=s.bottom||this._closeDialog()}}window.addEventListener("DOMContentLoaded",()=>{const b=document.querySelector('input[name="contact-state"]');if(!b)return;const f=document.querySelector("#contact-dialog");f&&(new v2(f),b.addEventListener("change",()=>{b.dispatchEvent(new CustomEvent("open-contact-dialog",{bubbles:!0,composed:!0}))}))});function b2(b){if(Array.isArray(b)){for(var f=0,s=Array(b.length);f<b.length;f++)s[f]=b[f];return s}else return Array.from(b)}var xd=!1;if(typeof window<"u"){var f_={get passive(){xd=!0}};window.addEventListener("testPassive",null,f_),window.removeEventListener("testPassive",null,f_)}var kl=typeof window<"u"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1),Po=[],Pl=!1,um=-1,iu=void 0,ps=void 0,nu=void 0,T1=function(f){return Po.some(function(s){return!!(s.options.allowTouchMove&&s.options.allowTouchMove(f))})},_u=function(f){var s=f||window.event;return T1(s.target)||s.touches.length>1?!0:(s.preventDefault&&s.preventDefault(),!1)},x2=function(f){if(nu===void 0){var s=!!f&&f.reserveScrollBarGap===!0,E=window.innerWidth-document.documentElement.clientWidth;if(s&&E>0){var R=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right"),10);nu=document.body.style.paddingRight,document.body.style.paddingRight=R+E+"px"}}iu===void 0&&(iu=document.body.style.overflow,document.body.style.overflow="hidden")},E1=function(){nu!==void 0&&(document.body.style.paddingRight=nu,nu=void 0),iu!==void 0&&(document.body.style.overflow=iu,iu=void 0)},w2=function(){return window.requestAnimationFrame(function(){if(ps===void 0){ps={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left};var f=window,s=f.scrollY,E=f.scrollX,R=f.innerHeight;document.body.style.position="fixed",document.body.style.top=-s,document.body.style.left=-E,setTimeout(function(){return window.requestAnimationFrame(function(){var G=R-window.innerHeight;G&&s>=R&&(document.body.style.top=-(s+G))})},300)}})},M1=function(){if(ps!==void 0){var f=-parseInt(document.body.style.top,10),s=-parseInt(document.body.style.left,10);document.body.style.position=ps.position,document.body.style.top=ps.top,document.body.style.left=ps.left,window.scrollTo(s,f),ps=void 0}},S2=function(f){return f?f.scrollHeight-f.scrollTop<=f.clientHeight:!1},C2=function(f,s){var E=f.targetTouches[0].clientY-um;return T1(f.target)?!1:s&&s.scrollTop===0&&E>0||S2(s)&&E<0?_u(f):(f.stopPropagation(),!0)},T2=function(f,s){if(!f){console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");return}if(!Po.some(function(R){return R.targetElement===f})){var E={targetElement:f,options:s||{}};Po=[].concat(b2(Po),[E]),kl?w2():x2(s),kl&&(f.ontouchstart=function(R){R.targetTouches.length===1&&(um=R.targetTouches[0].clientY)},f.ontouchmove=function(R){R.targetTouches.length===1&&C2(R,f)},Pl||(document.addEventListener("touchmove",_u,xd?{passive:!1}:void 0),Pl=!0))}},E2=function(){kl&&(Po.forEach(function(f){f.targetElement.ontouchstart=null,f.targetElement.ontouchmove=null}),Pl&&(document.removeEventListener("touchmove",_u,xd?{passive:!1}:void 0),Pl=!1),um=-1),kl?M1():E1(),Po=[]},M2=function(f){if(!f){console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");return}Po=Po.filter(function(s){return s.targetElement!==f}),kl&&(f.ontouchstart=null,f.ontouchmove=null,Pl&&Po.length===0&&(document.removeEventListener("touchmove",_u,xd?{passive:!1}:void 0),Pl=!1)),kl?M1():E1()};function k2(b){const f=document.createElement("a");return f.href=b,{protocol:f.protocol,href:f.href,path:f.pathname,search:f.search,hash:f.hash}}function P2(b){const f=k2(b),s=f.href.substr(0,f.href.length-f.hash.length),E=window.location.href.replace(/#.*$/,"");return f.hash&&s===E}function k1(b,f){const s=JSON.stringify(f);let E=0;if(s.length===0)return E;for(let R=0;R<s.length;R++){const G=s.charCodeAt(R);E=(E<<5)-E+G,E&=E}return`${b}-${E}`}function I2(b,f,s){const E=document.createElement("form"),R=document.createElement("input");return E.action=b,E.method="POST",E.target=s,f.forEach(([G,S])=>{R.name=G,R.value=S.toString(),E.appendChild(R.cloneNode())}),E.style.visibility="hidden",E}function A2(b){const f=b.composedPath();for(let s=0;s<f.indexOf(document.body);s++){const E=f[s];if(E.hasAttribute&&E.hasAttribute("target")&&E!==document.body)return E}}function z2(b,f){if(b.hasAttribute("data-modal-post")){const s=b.getAttribute("data-modal-post");f.method="POST",f.body=s;const E=[];return new URL(`http://localhost/?${s}`).searchParams.forEach((R,G)=>{E.push([G,R])}),[E,f]}return[null,f]}function D2(b,f,s,E,R){const G=document.createElement("toujou-modal"),S=document.createElement("iframe"),l=k1("iframe",f);if(G.id=b,S.name=l,document.body.appendChild(G),P2(s)){const ae=document.querySelector(s),_e=ae instanceof HTMLTemplateElement?document.importNode(ae.content,!0).children:ae.childNodes;ae.title&&(G.title=ae.title);for(let ee=0;ee<_e.length;ee++)G.appendChild(_e[ee])}else if(R&&E==="POST"){const ae=I2(s,R,l);G.appendChild(ae),G.appendChild(S),ae.submit(),ae.remove()}else E==="GET"&&(S.src=s,G.appendChild(S));return G}function L2(b,f,s,E){const R=k1("toujou-modal",b),G=document.getElementById(R)||D2(R,b,f,s,E);setTimeout(()=>{G.open()})}const R2=b=>{if(b.metaKey||b.ctrlKey)return;const f=A2(b);if(!(!(f instanceof HTMLElement||f instanceof SVGElement)||f instanceof HTMLFormElement)&&f.getAttribute("target")==="toujou-modal"){const s=f.getAttribute("href"),E=s.indexOf("?")!==-1?s.split("?")[0]+"?toujou-ajax-modal=1&"+s.split("?")[1]:s.indexOf("#")!==-1?s.split("#")[0]+"?toujou-ajax-modal=1#"+s.split("#")[1]:s+"?toujou-ajax-modal=1",[R,G]=z2(f,{src:E});L2(G,E,R?"POST":"GET",R),b.preventDefault(),b.stopPropagation()}},O2=bn`
  * {
    box-sizing: border-box;
  }

  :host {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 100%;
    z-index: var(--toujou-modal-z-index, 15);
    background: var(--toujou-modal-backdrop-color, rgba(0,0,0,.6));
    visibility: hidden;
  }

  :host([allow-outside-scroll]) {
    position: absolute;
    height: 100%;
    min-height: 100vh;
  }

  :host([no-backdrop]) {
    background: transparent;
  }

  :host([visible]) {
    visibility: visible;
  }

  #scroller {
    overflow-y: auto;
    height: 100vh;
  }

  :host([allow-outside-scroll]) #scroller {
    height: 100%;
  }

  #content {
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: var(--toujou-modal-container-justify-content, center);
    min-height: var(--toujou-modal-container-min-height, 100%);
    height: var(--toujou-modal-container-height, 100vh);
    width: var(--toujou-modal-container-width, 100vw);
  }

  #modal-content {
    margin: var(--toujou-modal-content-margin, 2rem auto);
    width: var(--toujou-modal-content-width, 100%);
    max-width: var(--toujou-modal-content-max-width, calc(100vw - 1rem));
    background: var(--toujou-modal-content-background, #fff);
    box-shadow: var(--toujou-modal-content-shadow, 0 16px 24px 2px rgba(0,0,0,0.14), 0 6px 30px 5px rgba(0,0,0,0.12), 0 8px 10px -5px rgba(0,0,0,0.4));
    border: var(--toujou-modal-content-border, none);
    border-radius: var(--toujou-modal-content-border-radius, 0px 0px 0px 0px);
    max-height: var(--toujou-modal-content-max-height, 100vh);
    overflow: var(--toujou-modal-content-overflow, auto);
    scroll-behavior: var(--toujou-modal-scroll-behavior, smooth);
  }

  @media only screen and (min-width: 51rem) {
    #modal-content {
      min-width: var(--toujou-modal-content-min-width, 42.5rem);
      max-width: var(--toujou-modal-content-max-width, 50rem);
    }
  }

  #modal-header {
    position: var(--toujou-modal-header-position, relative);
    padding: var(--toujou-modal-header-padding, .5rem);
    background: var(--toujou-modal-header-background, var(--neutral-color--050));
    border-bottom: var(--toujou-modal-header-border-bottom, 1px solid var(--neutral-color--200));
    user-select: none;
    display: var(--toujou-modal-header-display, flex);
    justify-content: var(--toujou-modal-header-justify, space-between);
    width: var(--toujou-modal-header-width, 100%);
    top: var(--toujou-modal-header-top, unset);
    box-shadow: var(--toujou-modal-header-box-shadow, none);
  }

  :host([no-header]) #modal-header {
    padding: 0;
    border-bottom: none;
  }

  #modal-header h3 {
    color: var(--toujou-modal-title-color, var(--secondary-color));
    display: var(--toujou-modal-title-display, flex);
    align-items: center;
    justify-content: var(--toujou-modal-title-align, flex-start);
    font-family: var(--toujou-modal-title-font-family, var(--headline__family));
    font-weight: var(--toujou-modal-title-font-weight, 500);
    font-size: var(--toujou-modal-title-font-size, 1.21875rem);
    line-height: 1.1;
    margin: 0;
    padding: var(--toujou-modal-title-padding, 0 .5rem);
    text-align: left;
    width: 100%;
  }

  #modal-header-close {
    display: var(--toujou-modal-close-display, block);
    position: var(--toujou-modal-close-position, relative);
    font-weight: bold;
    line-height: 1;
    font-family: var(--toujou-modal-close-font-family, var(--headline__family));
    font-size: var(--toujou-modal-close-font-size, 2em);
    padding: var(--toujou-modal-close-padding, .25rem .675rem);
    background: var(--toujou-modal-close-background, var(--primary-color));
    background-size: var(--toujou-modal-close-background-size, contain);
    background-position: var(--toujou-modal-close-background-position, center);
    background-repeat: var(--toujou-modal-close-background-repeat, no-repeat);
    border: var(--toujou-modal-close-border, 1px solid var(--primary-color));
    border-radius: var(--toujou-modal-close-border-radius, 2px);
    color: var(--toujou-modal-close-color, #fff);
    cursor: pointer;
    margin: var(--toujou-modal-close-margin, 0 0 0 1.5rem);
    outline: none;
    text-align: center;
    transition: all .1s ease-in-out;
    user-select: none;
    vertical-align: middle;
    width: auto;
    top: var(--toujou-modal-close-top, 0);
    bottom: var(--toujou-modal-close-bottom, 0);
    left: var(--toujou-modal-close-left, 0);
    right: var(--toujou-modal-close-right, 0);
  }

  #modal-header-close:hover, #modal-header-close:focus {
    background: var(--toujou-modal-close-hover-background, var(--primary-color--dark));
    background-size: var(--toujou-modal-close-hover-background-size, contain);
    background-position: var(--toujou-modal-close-hover-background-position, center);
    background-repeat: var(--toujou-modal-close-hover-background-repeat, no-repeat);
    border: var(--toujou-modal-close-hover-border, 1px solid var(--primary-color--dark));
    color: var(--toujou-modal-close-hover-color, #fff);
  }

  #dog-ear-close {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 2;
    width: 0;
    height: 0;
    border: none;
    border-top: 3rem solid var(--primary-color);
    border-left: 3rem solid transparent;
    padding: 0;
    cursor: pointer;
    outline: none;
    user-select: none;
  }

  #dog-ear-close:before,
  #dog-ear-close:after {
    content: '';
    background: white;
    position: absolute;
    display: block;
    height: 2px;
    width: .75rem;
    right: .375rem;
    top: -2.25rem;
  }

  #dog-ear-close:before {
    transform: rotate(45deg);
  }

  #dog-ear-close:after {
    transform: rotate(-45deg);
  }

  #progress-bar {
    display: none;
    position: absolute;
    bottom: -2px;
    left: 0;
    height: var(--toujou-modal-progressbar-height, 4px);
    width: 100%;
    opacity: 0;
    transition: opacity .3s ease-in-out;
  }

  :host([loading]) #progress-bar {
    display: block;
    opacity: 1;
  }

  #progress-bar:before {
    content: '';
    display: block;
    height: 4px;
    width: 50%;
    background: var(--toujou-modal-progressbar-color, var(--primary-color));
    animation: var(--toujou-modal-progressbar-animation, progress 6s linear infinite);
  }

  @keyframes progress {
    0%   { width: 0; }
    18% { width: 3%; }
    20% { width: 20%; }
    38% { width: 23%; }
    40% { width: 40%; }
    58% { width: 43%; }
    60% { width: 60%; }
    78% { width: 63%; }
    80% { width: 80%; }
    98% { width: 83%; }
    100% { width: 100%; }
  }

  @media only screen and (min-width: 42.5rem) {
    #modal-header h3 {
      font-size: var(--toujou-modal-title-font-size, 1.625rem);
    }
  }

  #modal-content ::slotted(iframe) {
    border: none;
    width: 100%;
  }

`,F2={reserveScrollBarGap:!0},bl=[];function B2(b){bl.forEach(f=>f.close()),bl.push(b)}function j2(b){if(b===bl[bl.length-1]){bl.pop();const f=bl.pop();f&&f.open()}}class Vf extends mi{static get is(){return"toujou-modal"}render(){return pi`
            <div id="scroller" @click="${this.onClick}" part="scroller">
                <div id="content" part="content">
                    <div id="modal-content" part="modal-content">
                        <div id="modal-header" part="modal-header">
                            ${this.noHeader?pi`
                                    <button id="dog-ear-close" dialog-dismiss part="dog-ear-close"></button>`:pi`
                                    <h3 part="headline">${this.title}</h3>
                                    <button id="modal-header-close" dialog-dismiss part="modal-header-close"></button>
                                `}
                            <div id="progress-bar" part="progress-bar"></div>
                        </div>
                        <slot id="slot" @slotchange="${this.onSlotchange}"></slot>
                    </div>
                </div>
            </div>
        `}static get properties(){return{opened:{type:Boolean,reflect:!0},title:{type:String},noHeader:{type:Boolean,attribute:"no-header",reflect:!0},allowOutsideScroll:{type:Boolean,attribute:"allow-outside-scroll",reflect:!0},noBackdrop:{type:Boolean,attribute:"no-backdrop",reflect:!0},loading:{type:Boolean,reflect:!0}}}open(){this.opened=!0}close(){this.opened=!1}constructor(f){super(f),this.opened=!1,this.loading=!1,this.intersectionObserver=new IntersectionObserver(s=>{s[0]&&this.onPosition(s[0])}),this.iframeResizerMap=new Map}disconnectedCallback(){E2()}toggle(){this.opened=!this.opened}firstUpdated(){this.$={scroller:this.shadowRoot.querySelector("#scroller"),content:this.shadowRoot.querySelector("#content"),modalContent:this.shadowRoot.querySelector("#modal-content"),slot:this.shadowRoot.querySelector("#slot")}}updated(f){f.has("opened")&&(this.opened?this.onOpen():this.onClose(),this.hidden=!this.opened)}onOpen(){this.intersectionObserver.observe(this),this.allowOutsideScroll?document.body.styleposition="relative":T2(this.$.scroller,F2),B2(this),setTimeout(()=>{this.setAttribute("visible",""),this.dispatchModalEvent("toujou-modal-opened")})}onClose(){this.removeAttribute("visible"),j2(this),this.allowOutsideScroll?document.body.style.position="":M2(this.$.scroller),this.intersectionObserver.unobserve(this),this.dispatchModalEvent("toujou-modal-closed")}onLoad(f){this.loading=f}onClick(f){if(!f.composed)return;const s=f.composedPath();(!s.includes(this.$.modalContent)||s.some(E=>E instanceof HTMLElement&&E.hasAttribute("dialog-dismiss")))&&this.close()}onPosition(f){const s=Math.max(f.intersectionRect.y,Math.abs(f.boundingClientRect.y));this.$.content.style["min-height"]=`${f.intersectionRect.height}px`,this.$.content.style.top=s?`${s}px`:""}onSlotchange(){const f=this.$.slot.assignedNodes().filter(s=>s instanceof HTMLIFrameElement);this.iframeResizerMap.forEach((s,E)=>{f.includes(E)||this.iframeResizerMap.delete(E)}),f.forEach(s=>{this.loading=!0,s.addEventListener("load",()=>{this.iframeResizerMap.has(s)||this.listenToIframeReadyState(s)})})}listenToIframeReadyState(f){this.loading=!0,this.iframeResizerMap.set(f,this.createIframeResizer(f)),f.contentWindow.addEventListener("beforeunload",()=>{this.loading=!0});try{this.title=f.contentWindow.document.title||this.title}catch{this.title=""}this.loading=!1,this.dispatchModalEvent("toujou-modal-loaded")}createIframeResizer(f){let s={};try{s=JSON.parse(f.getAttribute("toujou-iframe"))||{}}catch(E){(console.error||console.log).call(console,E.stack||E)}return s.initCallback=()=>{this.loading=!1},s.closedCallback=()=>{this.close()},$_.iframeResizer(s,f)}dispatchModalEvent(f){this.dispatchEvent(new CustomEvent(f,{bubbles:!0,composed:!0}))}}Kg(Vf,"styles",[O2]);customElements.define(Vf.is,Vf);document.addEventListener("click",R2);class m_ extends mi{static get is(){return"toujou-fav-item"}static get properties(){return{code:{type:String},favList:{type:Array},faved:{type:Boolean},addLabel:{type:String,attribute:"add-label"},removeLabel:{type:String,attribute:"remove-label"}}}static get styles(){return bn`
      :host {
        display: inline-block;
        height: 2rem;
        min-width: 2rem;
        display: flex;
        flex-direction: row;
        align-items: center;
      }

      .toujou-fav-item__pager {
        position: relative;
        height: 1.5rem;
        width: 1.5rem;
        margin: var(--toujou-fav-item-icon-margin, 0.25rem);
        cursor: pointer;
      }
      .toujou-fav-item__icon {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
      }
      .toujou-fav-item__icon--not-faved {
        fill: var(--toujou-fav-item-icon-fill, var(--primary-color));
      }
      .toujou-fav-item__icon--faved {
        fill: var(--toujou-fav-item-icon-fill, var(--primary-color));
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      }
      .toujou-fav-item__pager[faved] .toujou-fav-item__icon--faved {
        opacity: 1;
      }
      svg {
        width: 100%;
        height: 100%;
      }
    `}constructor(){super(),this.faved=!1,this.addLabel="",this.removeLabel="",this.addEventListener("click",this.toggle),console.warn("%c[toujou-fav-item] Mock component loaded!","color: orange; font-weight: bold; background: black; padding: 4px 8px; font-size: 14px; margin-bottom: 8px;",`
  This is a mock version for Storybook only. If you see this in production, something went wrong!`)}connectedCallback(){super.connectedCallback(),this.initialized=!0,this.setAttribute("role","switch")}update(f){if(super.update(f),f.has("faved")){this.setAttribute("aria-checked",this.faved?"true":"false");const s=this.faved?this.removeLabel:this.addLabel;s&&this.setAttribute("aria-label",s)}}render(){return pi` <span class="toujou-fav-item__pager" ?faved="${this.faved}" part="pager">
        <svg
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          x="0px"
          y="0px"
          viewBox="0 0 24 24"
          xml:space="preserve"
          height="24"
          width="24"
          part="svg"
        >
          <path
            class="toujou-fav-item__icon toujou-fav-item__icon--not-faved"
            d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"
          ></path>
          <path
            class="toujou-fav-item__icon toujou-fav-item__icon--faved"
            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
          ></path>
        </svg>
      </span>
      <slot name="headline"></slot>
      <span id="text" class="text">
        <slot></slot>
      </span>`}}customElements.define(m_.is,m_);const Mf="#383838",N2=Tv({base:"dark",brandTitle:"Kojo Theme",brandUrl:"https://meet-kojo.toujou.net/",brandTarget:"_blank",appBg:Mf,barBg:Mf,inputBg:Mf,colorSecondary:"#00d7fd"}),$2={Mobile1:{name:"mobile - small",styles:{width:"375px",height:"667px"}},Mobile2:{name:"mobile - large",styles:{width:"414px",height:"736px"}},Tablet1:{name:"tablet - small",styles:{width:"768px",height:"1024px"}},Tablet2:{name:"tablet - large",styles:{width:"1024px",height:"1366px"}},Web1:{name:"web - wide",styles:{width:"1440px",height:"1280px"}}};__STORYBOOK_MODULE_PREVIEW_API__;var V2=Object.defineProperty,U2=(b,f)=>{for(var s in f)V2(b,s,{get:f[s],enumerable:!0})},q2={};U2(q2,{initialGlobals:()=>W2});var G2="viewport",Z2={[G2]:{value:void 0,isRotated:!1}},H2={viewport:"reset",viewportRotated:!1},g_,W2=(g_=globalThis.FEATURES)!=null&&g_.viewportStoryGlobals?Z2:H2,Y2={iphone5:{name:"iPhone 5",styles:{height:"568px",width:"320px"},type:"mobile"},iphone6:{name:"iPhone 6",styles:{height:"667px",width:"375px"},type:"mobile"},iphone6p:{name:"iPhone 6 Plus",styles:{height:"736px",width:"414px"},type:"mobile"},iphone8p:{name:"iPhone 8 Plus",styles:{height:"736px",width:"414px"},type:"mobile"},iphonex:{name:"iPhone X",styles:{height:"812px",width:"375px"},type:"mobile"},iphonexr:{name:"iPhone XR",styles:{height:"896px",width:"414px"},type:"mobile"},iphonexsmax:{name:"iPhone XS Max",styles:{height:"896px",width:"414px"},type:"mobile"},iphonese2:{name:"iPhone SE (2nd generation)",styles:{height:"667px",width:"375px"},type:"mobile"},iphone12mini:{name:"iPhone 12 mini",styles:{height:"812px",width:"375px"},type:"mobile"},iphone12:{name:"iPhone 12",styles:{height:"844px",width:"390px"},type:"mobile"},iphone12promax:{name:"iPhone 12 Pro Max",styles:{height:"926px",width:"428px"},type:"mobile"},iphoneSE3:{name:"iPhone SE 3rd generation",styles:{height:"667px",width:"375px"},type:"mobile"},iphone13:{name:"iPhone 13",styles:{height:"844px",width:"390px"},type:"mobile"},iphone13pro:{name:"iPhone 13 Pro",styles:{height:"844px",width:"390px"},type:"mobile"},iphone13promax:{name:"iPhone 13 Pro Max",styles:{height:"926px",width:"428px"},type:"mobile"},iphone14:{name:"iPhone 14",styles:{height:"844px",width:"390px"},type:"mobile"},iphone14pro:{name:"iPhone 14 Pro",styles:{height:"852px",width:"393px"},type:"mobile"},iphone14promax:{name:"iPhone 14 Pro Max",styles:{height:"932px",width:"430px"},type:"mobile"},ipad:{name:"iPad",styles:{height:"1024px",width:"768px"},type:"tablet"},ipad10p:{name:"iPad Pro 10.5-in",styles:{height:"1112px",width:"834px"},type:"tablet"},ipad11p:{name:"iPad Pro 11-in",styles:{height:"1194px",width:"834px"},type:"tablet"},ipad12p:{name:"iPad Pro 12.9-in",styles:{height:"1366px",width:"1024px"},type:"tablet"},galaxys5:{name:"Galaxy S5",styles:{height:"640px",width:"360px"},type:"mobile"},galaxys9:{name:"Galaxy S9",styles:{height:"740px",width:"360px"},type:"mobile"},nexus5x:{name:"Nexus 5X",styles:{height:"660px",width:"412px"},type:"mobile"},nexus6p:{name:"Nexus 6P",styles:{height:"732px",width:"412px"},type:"mobile"},pixel:{name:"Pixel",styles:{height:"960px",width:"540px"},type:"mobile"},pixelxl:{name:"Pixel XL",styles:{height:"1280px",width:"720px"},type:"mobile"}},X2=Y2;const K2=500;setTimeout(()=>{const b=document.querySelector(".main-nav");!b||b.mainNav||y_()},K2);const Fw={globalTypes:{toujouTheme:{description:"Theme",toolbar:{icon:"box",title:"Theme",items:[{value:"toujou",title:"Toujou"},{value:"kojo",title:"Kojo"}]}}},initialGlobals:{toujouTheme:"kojo"},parameters:{docs:{theme:N2},controls:{matchers:{color:/(background|color)$/i,date:/Date$/},expanded:!0},badgesConfig:Ev,viewport:{viewports:{...$2,...X2}},options:{storySort:{method:"alphabetic",includeNames:!0,order:["COMPONENTS",[["Tourism",["*",["*","Docs"]]],"*",["*","Docs"]],"TOKENS","PAGES"]},selectedPanel:"storybook/controls/panel"},fetchMock:{debug:!1}},tags:["autodocs","autodocs"],decorators:[]};console.clear();export{Fw as default};

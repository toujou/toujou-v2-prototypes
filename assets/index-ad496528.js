var Bb=Object.defineProperty;var Ub=(i,l,c)=>l in i?Bb(i,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[l]=c;var aa=(i,l,c)=>(Ub(i,typeof l!="symbol"?l+"":l,c),c);import{c as yt,g as $b,a as cf}from"./_commonjsHelpers-042e6b4d.js";var Jd={},Vb={get exports(){return Jd},set exports(i){Jd=i}};(function(i,l){(function(c,f){i.exports=f()})(yt,function(){var c,f,_;function v(o,I){if(!c)c=I;else if(!f)f=I;else{var A="var sharedChunk = {}; ("+c+")(sharedChunk); ("+f+")(sharedChunk);",L={};c(L),_=I(L),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}v(["exports"],function(o){function I(r,e,n,a){return new(n||(n=Promise))(function(h,m){function y(D){try{T(a.next(D))}catch(k){m(k)}}function x(D){try{T(a.throw(D))}catch(k){m(k)}}function T(D){var k;D.done?h(D.value):(k=D.value,k instanceof n?k:new n(function(F){F(k)})).then(y,x)}T((a=a.apply(r,e||[])).next())})}function A(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var L=R;function R(r,e){this.x=r,this.y=e}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),n=Math.sin(r),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(r,e){var n=Math.cos(r),a=Math.sin(r),h=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},R.convert=function(r){return r instanceof R?r:Array.isArray(r)?new R(r[0],r[1]):r};var P=A(L),q=ie;function ie(r,e,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=a}ie.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var h=this.sampleCurveX(n)-r;if(Math.abs(h)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=h/m}var y=0,x=1;for(n=r,a=0;a<20&&(h=this.sampleCurveX(n),!(Math.abs(h-r)<e));a++)r>h?y=n:x=n,n=.5*(x-y)+y;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var le=A(q);let V,me;function Oe(){return V==null&&(V=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),V}function Pe(){if(me==null&&(me=!1,Oe())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<5*5;a++){const h=4*a;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&n[a]!==a){me=!0;break}}}return me||!1}function ne(r,e,n,a){const h=new le(r,e,n,a);return function(m){return h.solve(m)}}const de=ne(.25,.1,.25,1);function ce(r,e,n){return Math.min(n,Math.max(e,r))}function Ae(r,e,n){const a=n-e,h=((r-e)%a+a)%a+e;return h===e?n:h}function Me(r,...e){for(const n of e)for(const a in n)r[a]=n[a];return r}let Y=1;function xe(r,e,n){const a={};for(const h in r)a[h]=e.call(n||this,r[h],h,r);return a}function Ge(r,e,n){const a={};for(const h in r)e.call(n||this,r[h],h,r)&&(a[h]=r[h]);return a}function Ye(r){return Array.isArray(r)?r.map(Ye):typeof r=="object"&&r?xe(r,Ye):r}const ct={};function wt(r){ct[r]||(typeof console<"u"&&console.warn(r),ct[r]=!0)}function Et(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function Dt(r){let e=0;for(let n,a,h=0,m=r.length,y=m-1;h<m;y=h++)n=r[h],a=r[y],e+=(a.x-n.x)*(n.y+a.y);return e}function ht(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let et=null;function ft(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function mt(r,e,n,a,h){return I(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const y=m==null?void 0:m.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const x=y.startsWith("BGR"),T=new Uint8ClampedArray(a*h*4);if(yield m.copyTo(T,function(D,k,F,U,G){const W=4*Math.max(-k,0),ee=(Math.max(0,F)-F)*U*4+W,ue=4*U,ge=Math.max(0,k),Ce=Math.max(0,F);return{rect:{x:ge,y:Ce,width:Math.min(D.width,k+U)-ge,height:Math.min(D.height,F+G)-Ce},layout:[{offset:ee,stride:ue}]}}(r,e,n,a,h)),x)for(let D=0;D<T.length;D+=4){const k=T[D];T[D]=T[D+2],T[D+2]=k}return T}finally{m.close()}})}let Q,we,Ee,je;const St={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){return this.getImageCanvasContext(r).getImageData(-e,-e,r.width+2*e,r.height+2*e)},getImageCanvasContext(r){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=r.width,e.height=r.height,n.drawImage(r,0,0,r.width,r.height),n},resolveURL:r=>(Ee||(Ee=document.createElement("a")),Ee.href=r,Ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(je==null&&(je=matchMedia("(prefers-reduced-motion: reduce)")),je.matches)}},Mt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class ot extends Error{constructor(e,n,a,h){super(`AJAXError: ${n} (${e}): ${a}`),this.status=e,this.statusText=n,this.url=a,this.body=h}}const It=ht()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,jt=r=>Mt.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))];function Qt(r,e){const n=new AbortController,a=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,cache:r.cache,referrer:It(),signal:n.signal});let h=!1,m=!1;return r.type==="json"&&a.headers.set("Accept","application/json"),m||fetch(a).then(y=>y.ok?(x=>{(r.type==="arrayBuffer"||r.type==="image"?x.arrayBuffer():r.type==="json"?x.json():x.text()).then(T=>{m||(h=!0,e(null,T,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(T=>{m||e(new Error(T.message))})})(y):y.blob().then(x=>e(new ot(y.status,y.statusText,r.url,x)))).catch(y=>{y.code!==20&&e(new Error(y.message))}),{cancel:()=>{m=!0,h||n.abort()}}}const Yt=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!ht())return(jt(r.url)||Qt)(r,e)}if(!(/^file:/.test(n=r.url)||/^file:/.test(It())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Qt(r,e);if(ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var n;return function(a,h){const m=new XMLHttpRequest;m.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(m.responseType="arraybuffer");for(const y in a.headers)m.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=a.credentials==="include",m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(a.type==="json")try{y=JSON.parse(m.response)}catch(x){return h(x)}h(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const y=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});h(new ot(m.status,m.statusText,a.url,y))}},m.send(a.body),{cancel:()=>m.abort()}}(r,e)},hn=function(r,e){return Yt(Me(r,{type:"arrayBuffer"}),e)};function gr(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function sn(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function Sr(r,e,n){if(n&&n[r]){const a=n[r].indexOf(e);a!==-1&&n[r].splice(a,1)}}class An{constructor(e,n={}){Me(this,n),this.type=e}}class Dn extends An{constructor(e,n={}){super("error",Me({error:e},n))}}class Xe{on(e,n){return this._listeners=this._listeners||{},sn(e,n,this._listeners),this}off(e,n){return Sr(e,n,this._listeners),Sr(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},sn(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new An(e,n||{}));const a=e.type;if(this.listens(a)){e.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const x of h)x.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const x of m)Sr(a,x,this._oneTimeListeners),x.call(this,e);const y=this._eventedParent;y&&(Me(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Dn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Jt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function wr(r,e){const n={};for(const a in r)a!=="ref"&&(n[a]=r[a]);return Jt.forEach(a=>{a in e&&(n[a]=e[a])}),n}function ur(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!ur(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!ur(r[n],e[n]))return!1;return!0}return r===e}const sr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Nn(r,e,n){n.push({command:sr.addSource,args:[r,e[r]]})}function Ii(r,e,n){e.push({command:sr.removeSource,args:[r]}),n[r]=!0}function Ln(r,e,n,a){Ii(r,n,a),Nn(r,e,n)}function ds(r,e,n){let a;for(a in r[n])if(Object.prototype.hasOwnProperty.call(r[n],a)&&a!=="data"&&!ur(r[n][a],e[n][a]))return!1;for(a in e[n])if(Object.prototype.hasOwnProperty.call(e[n],a)&&a!=="data"&&!ur(r[n][a],e[n][a]))return!1;return!0}function Ri(r,e,n,a,h,m){let y;for(y in e=e||{},r=r||{})Object.prototype.hasOwnProperty.call(r,y)&&(ur(r[y],e[y])||n.push({command:m,args:[a,y,e[y],h]}));for(y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(r,y)&&(ur(r[y],e[y])||n.push({command:m,args:[a,y,e[y],h]}))}function oi(r){return r.id}function ai(r,e){return r[e.id]=e,r}class it{constructor(e,n,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function jn(r,...e){for(const n of e)for(const a in n)r[a]=n[a];return r}class Pr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Ai{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[a,h]of n)this.bindings[a]=h}concat(e){return new Ai(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const qn={kind:"null"},nt={kind:"number"},Xt={kind:"string"},Ht={kind:"boolean"},on={kind:"color"},Z={kind:"object"},H={kind:"value"},_e={kind:"collator"},$={kind:"formatted"},O={kind:"padding"},B={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function se(r,e){return{kind:"array",itemType:r,N:e}}function ae(r){if(r.kind==="array"){const e=ae(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Ie=[qn,nt,Xt,Ht,on,$,Z,se(H),O,B,X];function ve(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ve(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of Ie)if(!ve(n,e))return null}}return`Expected ${ae(r)} but found ${ae(e)} instead.`}function he(r,e){return e.some(n=>n.kind===r.kind)}function Te(r,e){return e.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function Ue(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Ve=.96422,qe=.82521,Ct=4/29,kt=6/29,At=3*kt*kt,Ot=kt*kt*kt,Zt=Math.PI/180,yr=180/Math.PI;function Tr(r){return(r%=360)<0&&(r+=360),r}function hr([r,e,n,a]){let h,m;const y=pn((.2225045*(r=or(r))+.7168786*(e=or(e))+.0606169*(n=or(n)))/1);r===e&&e===n?h=m=y:(h=pn((.4360747*r+.3850649*e+.1430804*n)/Ve),m=pn((.0139322*r+.0971045*e+.7141733*n)/qe));const x=116*y-16;return[x<0?0:x,500*(h-y),200*(y-m),a]}function or(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function pn(r){return r>Ot?Math.pow(r,1/3):r/At+Ct}function Ir([r,e,n,a]){let h=(r+16)/116,m=isNaN(e)?h:h+e/500,y=isNaN(n)?h:h-n/200;return h=1*dn(h),m=Ve*dn(m),y=qe*dn(y),[Yr(3.1338561*m-1.6168667*h-.4906146*y),Yr(-.9787684*m+1.9161415*h+.033454*y),Yr(.0719453*m-.2289914*h+1.4052427*y),a]}function Yr(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function dn(r){return r>kt?r*r*r:At*(r-Ct)}function Gn(r){return parseInt(r.padEnd(2,r),16)/255}function ga(r,e){return Rs(e?r/100:r,0,1)}function Rs(r,e,n){return Math.min(Math.max(e,r),n)}function fs(r){return!r.some(Number.isNaN)}const tl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class xr{constructor(e,n,a,h=1,m=!0){this.r=e,this.g=n,this.b=a,this.a=h,m||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,n,a,h]))}static parse(e){if(e instanceof xr)return e;if(typeof e!="string")return;const n=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=tl[a];if(h){const[y,x,T]=h;return[y/255,x/255,T/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let x=1;return[Gn(a.slice(x,x+=y)),Gn(a.slice(x,x+=y)),Gn(a.slice(x,x+=y)),Gn(a.slice(x,x+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[x,T,D,k,F,U,G,W,ee,ue,ge,Ce]=y,be=[k||" ",G||" ",ue].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const ke=[D,U,ee].join(""),Le=ke==="%%%"?100:ke===""?255:0;if(Le){const We=[Rs(+T/Le,0,1),Rs(+F/Le,0,1),Rs(+W/Le,0,1),ge?ga(+ge,Ce):1];if(fs(We))return We}}return}}const m=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,x,T,D,k,F,U,G,W]=m,ee=[T||" ",k||" ",U].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ue=[+x,Rs(+D,0,100),Rs(+F,0,100),G?ga(+G,W):1];if(fs(ue))return function([ge,Ce,be,ke]){function Le(We){const xt=(We+ge/30)%12,Nt=Ce*Math.min(be,1-be);return be-Nt*Math.max(-1,Math.min(xt-3,9-xt,1))}return ge=Tr(ge),Ce/=100,be/=100,[Le(0),Le(8),Le(4),ke]}(ue)}}}(e);return n?new xr(...n,!1):void 0}get rgb(){const{r:e,g:n,b:a,a:h}=this,m=h||1/0;return this.overwriteGetter("rgb",[e/m,n/m,a/m,h])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,a,h,m]=hr(e),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?Tr(Math.atan2(h,a)*yr):NaN,y,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",hr(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,a,h]=this.rgb;return`rgba(${[e,n,a].map(m=>Math.round(255*m)).join(",")},${h})`}}xr.black=new xr(0,0,0,1),xr.white=new xr(1,1,1,1),xr.transparent=new xr(0,0,0,0),xr.red=new xr(1,0,0,1);class ya{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ko{constructor(e,n,a,h,m){this.text=e,this.image=n,this.scale=a,this.fontStack=h,this.textColor=m}}class Tn{constructor(e){this.sections=e}static fromString(e){return new Tn([new ko(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Tn?e:Tn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Zn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Zn)return e;if(typeof e=="number")return new Zn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Zn(e)}}toString(){return JSON.stringify(this.values)}}const _a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class li{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof li)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const a=e[n],h=e[n+1];if(typeof a!="string"||!_a.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new li(e)}}toString(){return JSON.stringify(this.values)}}class fn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new fn({name:e,available:!1}):null}}function Mo(r,e,n,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,n,a]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xi(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof xr||r instanceof ya||r instanceof Tn||r instanceof Zn||r instanceof li||r instanceof fn)return!0;if(Array.isArray(r)){for(const e of r)if(!Xi(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Xi(r[e]))return!1;return!0}return!1}function Nr(r){if(r===null)return qn;if(typeof r=="string")return Xt;if(typeof r=="boolean")return Ht;if(typeof r=="number")return nt;if(r instanceof xr)return on;if(r instanceof ya)return _e;if(r instanceof Tn)return $;if(r instanceof Zn)return O;if(r instanceof li)return X;if(r instanceof fn)return B;if(Array.isArray(r)){const e=r.length;let n;for(const a of r){const h=Nr(a);if(n){if(n===h)continue;n=H;break}n=h}return se(n||H,e)}return Z}function _r(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof xr||r instanceof Tn||r instanceof Zn||r instanceof li||r instanceof fn?r.toString():JSON.stringify(r)}class mr{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Xi(e[1]))return n.error("invalid value");const a=e[1];let h=Nr(a);const m=n.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new mr(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Vr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ys={string:Xt,number:nt,boolean:Ht,object:Z};class ci{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,h=1;const m=e[0];if(m==="array"){let x,T;if(e.length>2){const D=e[1];if(typeof D!="string"||!(D in Ys)||D==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ys[D],h++}else x=H;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}a=se(x,T)}else{if(!Ys[m])throw new Error(`Types doesn't contain name = ${m}`);a=Ys[m]}const y=[];for(;h<e.length;h++){const x=n.parse(e[h],h,H);if(!x)return null;y.push(x)}return new ci(a,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(e);if(!ve(this.type,Nr(a)))return a;if(n===this.args.length-1)throw new Vr(`Expected value to be of type ${ae(this.type)}, but found ${ae(Nr(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const va={"to-boolean":Ht,"to-color":on,"to-number":nt,"to-string":Xt};class Ni{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[0];if(!va[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");const h=va[a],m=[];for(let y=1;y<e.length;y++){const x=n.parse(e[y],y,H);if(!x)return null;m.push(x)}return new Ni(h,m)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let n,a;for(const h of this.args){if(n=h.evaluate(e),a=null,n instanceof xr)return n;if(typeof n=="string"){const m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Mo(n[0],n[1],n[2],n[3]),!a))return new xr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Vr(a||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const a of this.args){n=a.evaluate(e);const h=Zn.parse(n);if(h)return h}throw new Vr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const a of this.args){n=a.evaluate(e);const h=li.parse(n);if(h)return h}throw new Vr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const a of this.args){if(n=a.evaluate(e),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new Vr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Tn.fromString(_r(this.args[0].evaluate(e)));case"resolvedImage":return fn.fromString(_r(this.args[0].evaluate(e)));default:return _r(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const rl=["Unknown","Point","LineString","Polygon"];class xa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=xr.parse(e)),n}}class Oo{constructor(e,n,a=[],h,m=new Ai,y=[]){this.registry=e,this.path=a,this.key=a.map(x=>`[${x}]`).join(""),this.scope=m,this.errors=y,this.expectedType=h,this._isConstant=n}parse(e,n,a,h,m={}){return n?this.concat(n,a,h)._parse(e,m):this._parse(e,m)}_parse(e,n){function a(h,m,y){return y==="assert"?new ci(m,[h]):y==="coerce"?new Ni(m,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,T=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||T.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(x.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(x.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(x,T))return null}else y=a(y,x,n.typeAnnotation||"coerce");else y=a(y,x,n.typeAnnotation||"coerce");else y=a(y,x,n.typeAnnotation||"coerce");else y=a(y,x,n.typeAnnotation||"assert")}if(!(y instanceof mr)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const x=new xa;try{y=new mr(y.type,y.evaluate(x))}catch(T){return this.error(T.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){const h=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new Oo(this.registry,this._isConstant,h,n||null,m,this.errors)}error(e,...n){const a=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Pr(a,e))}checkSubtype(e,n){const a=ve(e,n);return a&&this.error(a),a}}class Js{constructor(e,n,a){this.type=_e,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const h=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Ht);if(!h)return null;const m=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Ht);if(!m)return null;let y=null;return a.locale&&(y=n.parse(a.locale,1,Xt),!y)?null:new Js(h,m,y)}evaluate(e){return new ya(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Yi=8192;function ba(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Ks(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function nl(r,e){const n=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*Yi),Math.round(a*h*Yi)]}function il(r,e,n){const a=r[0]-e[0],h=r[1]-e[1],m=r[0]-n[0],y=r[1]-n[1];return a*y-m*h==0&&a*m<=0&&h*y<=0}function wa(r,e){let n=!1;for(let y=0,x=e.length;y<x;y++){const T=e[y];for(let D=0,k=T.length;D<k-1;D++){if(il(r,T[D],T[D+1]))return!1;(h=T[D])[1]>(a=r)[1]!=(m=T[D+1])[1]>a[1]&&a[0]<(m[0]-h[0])*(a[1]-h[1])/(m[1]-h[1])+h[0]&&(n=!n)}}var a,h,m;return n}function Ea(r,e){for(let n=0;n<e.length;n++)if(wa(r,e[n]))return!0;return!1}function sl(r,e,n,a){const h=a[0]-n[0],m=a[1]-n[1],y=(r[0]-n[0])*m-h*(r[1]-n[1]),x=(e[0]-n[0])*m-h*(e[1]-n[1]);return y>0&&x<0||y<0&&x>0}function Yl(r,e,n){for(const D of n)for(let k=0;k<D.length-1;++k)if((x=[(y=D[k+1])[0]-(m=D[k])[0],y[1]-m[1]])[0]*(T=[(h=e)[0]-(a=r)[0],h[1]-a[1]])[1]-x[1]*T[0]!=0&&sl(a,h,m,y)&&sl(m,y,a,h))return!0;var a,h,m,y,x,T;return!1}function Ta(r,e){for(let n=0;n<r.length;++n)if(!wa(r[n],e))return!1;for(let n=0;n<r.length-1;++n)if(Yl(r[n],r[n+1],e))return!1;return!0}function Ro(r,e){for(let n=0;n<e.length;n++)if(Ta(r,e[n]))return!0;return!1}function Ji(r,e,n){const a=[];for(let h=0;h<r.length;h++){const m=[];for(let y=0;y<r[h].length;y++){const x=nl(r[h][y],n);ba(e,x),m.push(x)}a.push(m)}return a}function ol(r,e,n){const a=[];for(let h=0;h<r.length;h++){const m=Ji(r[h],e,n);a.push(m)}return a}function al(r,e,n,a){if(r[0]<n[0]||r[0]>n[2]){const h=.5*a;let m=r[0]-n[0]>h?-a:n[0]-r[0]>h?a:0;m===0&&(m=r[0]-n[2]>h?-a:n[2]-r[0]>h?a:0),r[0]+=m}ba(e,r)}function Sa(r,e,n,a){const h=Math.pow(2,a.z)*Yi,m=[a.x*Yi,a.y*Yi],y=[];for(const x of r)for(const T of x){const D=[T.x+m[0],T.y+m[1]];al(D,e,n,h),y.push(D)}return y}function No(r,e,n,a){const h=Math.pow(2,a.z)*Yi,m=[a.x*Yi,a.y*Yi],y=[];for(const T of r){const D=[];for(const k of T){const F=[k.x+m[0],k.y+m[1]];ba(e,F),D.push(F)}y.push(D)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of y)for(const D of T)al(D,e,n,h)}var x;return y}class ms{constructor(e,n){this.type=Ht,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Xi(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){const m=a.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ms(a,a.features[h].geometry)}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ms(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ms(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(a.type==="Polygon"){const x=Ji(a.coordinates,m,y),T=Sa(n.geometry(),h,m,y);if(!Ks(h,m))return!1;for(const D of T)if(!wa(D,x))return!1}if(a.type==="MultiPolygon"){const x=ol(a.coordinates,m,y),T=Sa(n.geometry(),h,m,y);if(!Ks(h,m))return!1;for(const D of T)if(!Ea(D,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(a.type==="Polygon"){const x=Ji(a.coordinates,m,y),T=No(n.geometry(),h,m,y);if(!Ks(h,m))return!1;for(const D of T)if(!Ta(D,x))return!1}if(a.type==="MultiPolygon"){const x=ol(a.coordinates,m,y),T=No(n.geometry(),h,m,y);if(!Ks(h,m))return!1;for(const D of T)if(!Ro(D,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ki{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=e[1];return n.scope.has(a)?new Ki(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Hn{constructor(e,n,a,h){this.name=e,this.type=n,this._evaluate=a,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const a=e[0],h=Hn.definitions[a];if(!h)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=y.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let T=null;for(const[D,k]of x){T=new Oo(n.registry,Lo,n.path,null,n.scope);const F=[];let U=!1;for(let G=1;G<e.length;G++){const W=e[G],ee=Array.isArray(D)?D[G-1]:D.type,ue=T.parse(W,1+F.length,ee);if(!ue){U=!0;break}F.push(ue)}if(!U)if(Array.isArray(D)&&D.length!==F.length)T.error(`Expected ${D.length} arguments, but found ${F.length} instead.`);else{for(let G=0;G<F.length;G++){const W=Array.isArray(D)?D[G]:D.type,ee=F[G];T.concat(G+1).checkSubtype(W,ee.type)}if(T.errors.length===0)return new Hn(a,m,k,F)}}if(x.length===1)n.errors.push(...T.errors);else{const D=(x.length?x:y).map(([F])=>{return U=F,Array.isArray(U)?`(${U.map(ae).join(", ")})`:`(${ae(U.type)}...)`;var U}).join(" | "),k=[];for(let F=1;F<e.length;F++){const U=n.parse(e[F],1+k.length);if(!U)return null;k.push(ae(U.type))}n.error(`Expected arguments of type ${D}, but found (${k.join(", ")}) instead.`)}return null}static register(e,n){Hn.definitions=n;for(const a in n)e[a]=Hn}}function Lo(r){if(r instanceof Ki)return Lo(r.boundExpression);if(r instanceof Hn&&r.name==="error"||r instanceof Js||r instanceof ms)return!1;const e=r instanceof Ni||r instanceof ci;let n=!0;return r.eachChild(a=>{n=e?n&&Lo(a):n&&a instanceof mr}),!!n&&Fo(r)&&eo(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Fo(r){if(r instanceof Hn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ms)return!1;let e=!0;return r.eachChild(n=>{e&&!Fo(n)&&(e=!1)}),e}function Qs(r){if(r instanceof Hn&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(n=>{e&&!Qs(n)&&(e=!1)}),e}function eo(r,e){if(r instanceof Hn&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(a=>{n&&!eo(a,e)&&(n=!1)}),n}function gs(r,e){const n=r.length-1;let a,h,m=0,y=n,x=0;for(;m<=y;)if(x=Math.floor((m+y)/2),a=r[x],h=r[x+1],a<=e){if(x===n||e<h)return x;m=x+1}else{if(!(a>e))throw new Vr("Input is not a number.");y=x-1}return 0}class Li{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,m]of a)this.labels.push(h),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(e[1],1,nt);if(!a)return null;const h=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let y=1;y<e.length;y+=2){const x=y===1?-1/0:e[y],T=e[y+1],D=y,k=y+1;if(typeof x!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=x)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const F=n.parse(T,k,m);if(!F)return null;m=m||F.type,h.push([x,F])}return new Li(m,a,h)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return a[0].evaluate(e);const m=n.length;return h>=n[m-1]?a[m-1].evaluate(e):a[gs(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function rr(r,e,n){return r+n*(e-r)}function zo(r,e,n){return r.map((a,h)=>rr(a,e[h],n))}const Fn={number:rr,color:function(r,e,n,a="rgb"){switch(a){case"rgb":{const[h,m,y,x]=zo(r.rgb,e.rgb,n);return new xr(h,m,y,x,!1)}case"hcl":{const[h,m,y,x]=r.hcl,[T,D,k,F]=e.hcl;let U,G;if(isNaN(h)||isNaN(T))isNaN(h)?isNaN(T)?U=NaN:(U=T,y!==1&&y!==0||(G=D)):(U=h,k!==1&&k!==0||(G=m));else{let Ce=T-h;T>h&&Ce>180?Ce-=360:T<h&&h-T>180&&(Ce+=360),U=h+n*Ce}const[W,ee,ue,ge]=function([Ce,be,ke,Le]){return Ce=isNaN(Ce)?0:Ce*Zt,Ir([ke,Math.cos(Ce)*be,Math.sin(Ce)*be,Le])}([U,G??rr(m,D,n),rr(y,k,n),rr(x,F,n)]);return new xr(W,ee,ue,ge,!1)}case"lab":{const[h,m,y,x]=Ir(zo(r.lab,e.lab,n));return new xr(h,m,y,x,!1)}}},array:zo,padding:function(r,e,n){return new Zn(zo(r.values,e.values,n))},variableAnchorOffsetCollection:function(r,e,n){const a=r.values,h=e.values;if(a.length!==h.length)throw new Vr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const m=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new Vr(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);m.push(a[y]);const[x,T]=a[y+1],[D,k]=h[y+1];m.push([rr(x,D,n),rr(T,k,n)])}return new li(m)}};class Wn{constructor(e,n,a,h,m){this.type=e,this.operator=n,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,x]of m)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(e,n,a,h){let m=0;if(e.name==="exponential")m=Ia(n,e.base,a,h);else if(e.name==="linear")m=Ia(n,1,a,h);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new le(y[0],y[1],y[2],y[3]).solve(Ia(n,1,a,h))}return m}static parse(e,n){let[a,h,m,...y]=e;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const D=h[1];if(typeof D!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:D}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const D=h.slice(1);if(D.length!==4||D.some(k=>typeof k!="number"||k<0||k>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,nt),!m)return null;const x=[];let T=null;a==="interpolate-hcl"||a==="interpolate-lab"?T=on:n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType);for(let D=0;D<y.length;D+=2){const k=y[D],F=y[D+1],U=D+3,G=D+4;if(typeof k!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(x.length&&x[x.length-1][0]>=k)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const W=n.parse(F,G,T);if(!W)return null;T=T||W.type,x.push([k,W])}return Ue(T,nt)||Ue(T,on)||Ue(T,O)||Ue(T,X)||Ue(T,se(nt))?new Wn(T,a,h,m,x):n.error(`Type ${ae(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return a[0].evaluate(e);const m=n.length;if(h>=n[m-1])return a[m-1].evaluate(e);const y=gs(n,h),x=Wn.interpolationFactor(this.interpolation,h,n[y],n[y+1]),T=a[y].evaluate(e),D=a[y+1].evaluate(e);switch(this.operator){case"interpolate":return Fn[this.type.kind](T,D,x);case"interpolate-hcl":return Fn.color(T,D,x,"hcl");case"interpolate-lab":return Fn.color(T,D,x,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ia(r,e,n,a){const h=a-n,m=r-n;return h===0?0:e===1?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}class Bo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null;const h=n.expectedType;h&&h.kind!=="value"&&(a=h);const m=[];for(const x of e.slice(1)){const T=n.parse(x,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!T)return null;a=a||T.type,m.push(T)}if(!a)throw new Error("No output type");const y=h&&m.some(x=>ve(h,x.type));return new Bo(y?H:a,m)}evaluate(e){let n,a=null,h=0;for(const m of this.args)if(h++,a=m.evaluate(e),a&&a instanceof fn&&!a.available&&(n||(n=a.name),a=null,h===this.args.length&&(a=n)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Uo{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=n.parse(e[m+1],m+1);if(!x)return null;a.push([y,x])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return h?new Uo(a,h):null}outputDefined(){return this.result.outputDefined()}}class to{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,nt),h=n.parse(e[2],2,se(n.expectedType||H));return a&&h?new to(h.type.itemType,a,h):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new Vr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new Vr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new Vr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Aa{constructor(e,n){this.type=Ht,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,H),h=n.parse(e[2],2,H);return a&&h?he(a.type,[Ht,Xt,nt,qn,H])?new Aa(a,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ae(a.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Te(n,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${ae(Nr(n))} instead.`);if(!Te(a,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${ae(Nr(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class $o{constructor(e,n,a){this.type=nt,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,H),h=n.parse(e[2],2,H);if(!a||!h)return null;if(!he(a.type,[Ht,Xt,nt,qn,H]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ae(a.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,nt);return m?new $o(a,h,m):null}return new $o(a,h)}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Te(n,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${ae(Nr(n))} instead.`);if(!Te(a,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${ae(Nr(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return a.indexOf(n,h)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Da{constructor(e,n,a,h,m,y){this.inputType=e,this.type=n,this.input=a,this.cases=h,this.outputs=m,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const m={},y=[];for(let D=2;D<e.length-1;D+=2){let k=e[D];const F=e[D+1];Array.isArray(k)||(k=[k]);const U=n.concat(D);if(k.length===0)return U.error("Expected at least one branch label.");for(const W of k){if(typeof W!="number"&&typeof W!="string")return U.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return U.error("Numeric branch labels must be integer values.");if(a){if(U.checkSubtype(a,Nr(W)))return null}else a=Nr(W);if(m[String(W)]!==void 0)return U.error("Branch labels must be unique.");m[String(W)]=y.length}const G=n.parse(F,D,h);if(!G)return null;h=h||G.type,y.push(G)}const x=n.parse(e[1],1,H);if(!x)return null;const T=n.parse(e[e.length-1],e.length-1,h);return T?x.type.kind!=="value"&&n.concat(1).checkSubtype(a,x.type)?null:new Da(a,h,x,m,y,T):null}evaluate(e){const n=this.input.evaluate(e);return(Nr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Ca{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const h=[];for(let y=1;y<e.length-1;y+=2){const x=n.parse(e[y],y,Ht);if(!x)return null;const T=n.parse(e[y+1],y+1,a);if(!T)return null;h.push([x,T]),a=a||T.type}const m=n.parse(e[e.length-1],e.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new Ca(a,h,m)}evaluate(e){for(const[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Ns{constructor(e,n,a,h){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,H),h=n.parse(e[2],2,nt);if(!a||!h)return null;if(!he(a.type,[se(H),Xt,H]))return n.error(`Expected first argument to be of type array or string, but found ${ae(a.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,nt);return m?new Ns(a.type,a,h,m):null}return new Ns(a.type,a,h)}evaluate(e){const n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Te(n,["string","array"]))throw new Vr(`Expected first argument to be of type array or string, but found ${ae(Nr(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return n.slice(a,h)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ll(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Pa(r,e,n,a){return a.compare(e,n)===0}function ys(r,e,n){const a=r!=="=="&&r!=="!=";return class q_{constructor(m,y,x){this.type=Ht,this.lhs=m,this.rhs=y,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const x=m[0];let T=y.parse(m[1],1,H);if(!T)return null;if(!ll(x,T.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${ae(T.type)}'.`);let D=y.parse(m[2],2,H);if(!D)return null;if(!ll(x,D.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${ae(D.type)}'.`);if(T.type.kind!==D.type.kind&&T.type.kind!=="value"&&D.type.kind!=="value")return y.error(`Cannot compare types '${ae(T.type)}' and '${ae(D.type)}'.`);a&&(T.type.kind==="value"&&D.type.kind!=="value"?T=new ci(D.type,[T]):T.type.kind!=="value"&&D.type.kind==="value"&&(D=new ci(T.type,[D])));let k=null;if(m.length===4){if(T.type.kind!=="string"&&D.type.kind!=="string"&&T.type.kind!=="value"&&D.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(m[3],3,_e),!k)return null}return new q_(T,D,k)}evaluate(m){const y=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const T=Nr(y),D=Nr(x);if(T.kind!==D.kind||T.kind!=="string"&&T.kind!=="number")throw new Vr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${T.kind}, ${D.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const T=Nr(y),D=Nr(x);if(T.kind!=="string"||D.kind!=="string")return e(m,y,x)}return this.collator?n(m,y,x,this.collator.evaluate(m)):e(m,y,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const Jl=ys("==",function(r,e,n){return e===n},Pa),ka=ys("!=",function(r,e,n){return e!==n},function(r,e,n,a){return!Pa(0,e,n,a)}),cl=ys("<",function(r,e,n){return e<n},function(r,e,n,a){return a.compare(e,n)<0}),Kl=ys(">",function(r,e,n){return e>n},function(r,e,n,a){return a.compare(e,n)>0}),Ql=ys("<=",function(r,e,n){return e<=n},function(r,e,n,a){return a.compare(e,n)<=0}),ec=ys(">=",function(r,e,n){return e>=n},function(r,e,n,a){return a.compare(e,n)>=0});class Ma{constructor(e,n,a,h,m){this.type=Xt,this.number=e,this.locale=n,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const a=n.parse(e[1],1,nt);if(!a)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=n.parse(h.locale,1,Xt),!m))return null;let y=null;if(h.currency&&(y=n.parse(h.currency,1,Xt),!y))return null;let x=null;if(h["min-fraction-digits"]&&(x=n.parse(h["min-fraction-digits"],1,nt),!x))return null;let T=null;return h["max-fraction-digits"]&&(T=n.parse(h["max-fraction-digits"],1,nt),!T)?null:new Ma(a,m,y,x,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class _s{constructor(e){this.type=$,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const h=[];let m=!1;for(let y=1;y<=e.length-1;++y){const x=e[y];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let T=null;if(x["font-scale"]&&(T=n.parse(x["font-scale"],1,nt),!T))return null;let D=null;if(x["text-font"]&&(D=n.parse(x["text-font"],1,se(Xt)),!D))return null;let k=null;if(x["text-color"]&&(k=n.parse(x["text-color"],1,on),!k))return null;const F=h[h.length-1];F.scale=T,F.font=D,F.textColor=k}else{const T=n.parse(e[y],1,H);if(!T)return null;const D=T.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new _s(h)}evaluate(e){return new Tn(this.sections.map(n=>{const a=n.content.evaluate(e);return Nr(a)===B?new ko("",a,null,null,null):new ko(_r(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class ro{constructor(e){this.type=B,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const a=n.parse(e[1],1,Xt);return a?new ro(a):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),a=fn.fromString(n);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(n)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class Vo{constructor(e){this.type=nt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ae(a.type)} instead.`):new Vo(a):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Vr(`Expected value to be of type string or array, but found ${ae(Nr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const vs={"==":Jl,"!=":ka,">":Kl,"<":cl,">=":ec,"<=":Ql,array:ci,at:to,boolean:ci,case:Ca,coalesce:Bo,collator:Js,format:_s,image:ro,in:Aa,"index-of":$o,interpolate:Wn,"interpolate-hcl":Wn,"interpolate-lab":Wn,length:Vo,let:Uo,literal:mr,match:Da,number:ci,"number-format":Ma,object:ci,slice:Ns,step:Li,string:ci,"to-boolean":Ni,"to-color":Ni,"to-number":Ni,"to-string":Ni,var:Ki,within:ms};function ul(r,[e,n,a,h]){e=e.evaluate(r),n=n.evaluate(r),a=a.evaluate(r);const m=h?h.evaluate(r):1,y=Mo(e,n,a,m);if(y)throw new Vr(y);return new xr(e/255,n/255,a/255,m,!1)}function jo(r,e){return r in e}function Ls(r,e){const n=e[r];return n===void 0?null:n}function xs(r){return{type:r}}function hl(r){return{result:"success",value:r}}function Fi(r){return{result:"error",value:r}}function bs(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function pl(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Oa(r){return!!r.expression&&r.expression.interpolated}function pr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Lr(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function tc(r){return r}function nr(r,e){const n=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",h=a||!(a||r.property!==void 0),m=r.type||(Oa(e)?"exponential":"interval");if(n||e.type==="padding"){const k=n?xr.parse:Zn.parse;(r=jn({},r)).stops&&(r.stops=r.stops.map(F=>[F[0],k(F[1])])),r.default=k(r.default?r.default:e.default)}if(r.colorSpace&&(y=r.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var y;let x,T,D;if(m==="exponential")x=no;else if(m==="interval")x=Mr;else if(m==="categorical"){x=Fr,T=Object.create(null);for(const k of r.stops)T[k[0]]=k[1];D=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);x=dl}if(a){const k={},F=[];for(let W=0;W<r.stops.length;W++){const ee=r.stops[W],ue=ee[0].zoom;k[ue]===void 0&&(k[ue]={zoom:ue,type:r.type,property:r.property,default:r.default,stops:[]},F.push(ue)),k[ue].stops.push([ee[0].value,ee[1]])}const U=[];for(const W of F)U.push([k[W].zoom,nr(k[W],e)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:Wn.interpolationFactor.bind(void 0,G),zoomStops:U.map(W=>W[0]),evaluate:({zoom:W},ee)=>no({stops:U,base:r.base},e,W).evaluate(W,ee)}}if(h){const k=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:Wn.interpolationFactor.bind(void 0,k),zoomStops:r.stops.map(F=>F[0]),evaluate:({zoom:F})=>x(r,e,F,T,D)}}return{kind:"source",evaluate(k,F){const U=F&&F.properties?F.properties[r.property]:void 0;return U===void 0?ws(r.default,e.default):x(r,e,U,T,D)}}}function ws(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function Fr(r,e,n,a,h){return ws(typeof n===h?a[n]:void 0,r.default,e.default)}function Mr(r,e,n){if(pr(n)!=="number")return ws(r.default,e.default);const a=r.stops.length;if(a===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[a-1][0])return r.stops[a-1][1];const h=gs(r.stops.map(m=>m[0]),n);return r.stops[h][1]}function no(r,e,n){const a=r.base!==void 0?r.base:1;if(pr(n)!=="number")return ws(r.default,e.default);const h=r.stops.length;if(h===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[h-1][0])return r.stops[h-1][1];const m=gs(r.stops.map(k=>k[0]),n),y=function(k,F,U,G){const W=G-U,ee=k-U;return W===0?0:F===1?ee/W:(Math.pow(F,ee)-1)/(Math.pow(F,W)-1)}(n,a,r.stops[m][0],r.stops[m+1][0]),x=r.stops[m][1],T=r.stops[m+1][1],D=Fn[e.type]||tc;return typeof x.evaluate=="function"?{evaluate(...k){const F=x.evaluate.apply(void 0,k),U=T.evaluate.apply(void 0,k);if(F!==void 0&&U!==void 0)return D(F,U,y,r.colorSpace)}}:D(x,T,y,r.colorSpace)}function dl(r,e,n){switch(e.type){case"color":n=xr.parse(n);break;case"formatted":n=Tn.fromString(n.toString());break;case"resolvedImage":n=fn.fromString(n.toString());break;case"padding":n=Zn.parse(n);break;default:pr(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return ws(n,r.default,e.default)}Hn.register(vs,{error:[{kind:"error"},[Xt],(r,[e])=>{throw new Vr(e.evaluate(r))}],typeof:[Xt,[H],(r,[e])=>ae(Nr(e.evaluate(r)))],"to-rgba":[se(nt,4),[on],(r,[e])=>{const[n,a,h,m]=e.evaluate(r).rgb;return[255*n,255*a,255*h,m]}],rgb:[on,[nt,nt,nt],ul],rgba:[on,[nt,nt,nt,nt],ul],has:{type:Ht,overloads:[[[Xt],(r,[e])=>jo(e.evaluate(r),r.properties())],[[Xt,Z],(r,[e,n])=>jo(e.evaluate(r),n.evaluate(r))]]},get:{type:H,overloads:[[[Xt],(r,[e])=>Ls(e.evaluate(r),r.properties())],[[Xt,Z],(r,[e,n])=>Ls(e.evaluate(r),n.evaluate(r))]]},"feature-state":[H,[Xt],(r,[e])=>Ls(e.evaluate(r),r.featureState||{})],properties:[Z,[],r=>r.properties()],"geometry-type":[Xt,[],r=>r.geometryType()],id:[H,[],r=>r.id()],zoom:[nt,[],r=>r.globals.zoom],"heatmap-density":[nt,[],r=>r.globals.heatmapDensity||0],"line-progress":[nt,[],r=>r.globals.lineProgress||0],accumulated:[H,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[nt,xs(nt),(r,e)=>{let n=0;for(const a of e)n+=a.evaluate(r);return n}],"*":[nt,xs(nt),(r,e)=>{let n=1;for(const a of e)n*=a.evaluate(r);return n}],"-":{type:nt,overloads:[[[nt,nt],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[nt],(r,[e])=>-e.evaluate(r)]]},"/":[nt,[nt,nt],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[nt,[nt,nt],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[nt,[nt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[nt,[nt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[nt,[nt],(r,[e])=>Math.log(e.evaluate(r))],log2:[nt,[nt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[nt,[nt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[nt,[nt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[nt,[nt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[nt,[nt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[nt,[nt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[nt,[nt],(r,[e])=>Math.atan(e.evaluate(r))],min:[nt,xs(nt),(r,e)=>Math.min(...e.map(n=>n.evaluate(r)))],max:[nt,xs(nt),(r,e)=>Math.max(...e.map(n=>n.evaluate(r)))],abs:[nt,[nt],(r,[e])=>Math.abs(e.evaluate(r))],round:[nt,[nt],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[nt,[nt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[nt,[nt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Ht,[Xt,H],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[Ht,[H],(r,[e])=>r.id()===e.value],"filter-type-==":[Ht,[Xt],(r,[e])=>r.geometryType()===e.value],"filter-<":[Ht,[Xt,H],(r,[e,n])=>{const a=r.properties()[e.value],h=n.value;return typeof a==typeof h&&a<h}],"filter-id-<":[Ht,[H],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Ht,[Xt,H],(r,[e,n])=>{const a=r.properties()[e.value],h=n.value;return typeof a==typeof h&&a>h}],"filter-id->":[Ht,[H],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Ht,[Xt,H],(r,[e,n])=>{const a=r.properties()[e.value],h=n.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[Ht,[H],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Ht,[Xt,H],(r,[e,n])=>{const a=r.properties()[e.value],h=n.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[Ht,[H],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Ht,[H],(r,[e])=>e.value in r.properties()],"filter-has-id":[Ht,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Ht,[se(Xt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Ht,[se(H)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Ht,[Xt,se(H)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Ht,[Xt,se(H)],(r,[e,n])=>function(a,h,m,y){for(;m<=y;){const x=m+y>>1;if(h[x]===a)return!0;h[x]>a?y=x-1:m=x+1}return!1}(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Ht,overloads:[[[Ht,Ht],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[xs(Ht),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:Ht,overloads:[[[Ht,Ht],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[xs(Ht),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[Ht,[Ht],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Ht,[Xt],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[Xt,[Xt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Xt,[Xt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Xt,xs(H),(r,e)=>e.map(n=>_r(n.evaluate(r))).join("")],"resolved-locale":[Xt,[_e],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Ra{constructor(e,n){var a;this.expression=e,this._warningHistory={},this._evaluator=new xa,this._defaultValue=n?(a=n).type==="color"&&Lr(a.default)?new xr(0,0,0,0):a.type==="color"?xr.parse(a.default)||null:a.type==="padding"?Zn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?li.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,h,m,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,h,m,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Vr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function io(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in vs}function qo(r,e){const n=new Oo(vs,Lo,[],e?function(h){const m={color:on,string:Xt,number:nt,enum:Xt,boolean:Ht,formatted:$,padding:O,resolvedImage:B,variableAnchorOffsetCollection:X};return h.type==="array"?se(m[h.value]||H,h.length):m[h.type]}(e):void 0),a=n.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?hl(new Ra(a,e)):Fi(n.errors)}class so{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Qs(n.expression)}evaluateWithoutErrorHandling(e,n,a,h,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,h,m,y)}evaluate(e,n,a,h,m,y){return this._styleExpression.evaluate(e,n,a,h,m,y)}}class oo{constructor(e,n,a,h){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Qs(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,a,h,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,h,m,y)}evaluate(e,n,a,h,m,y){return this._styleExpression.evaluate(e,n,a,h,m,y)}interpolationFactor(e,n,a){return this.interpolationType?Wn.interpolationFactor(this.interpolationType,e,n,a):0}}function Go(r,e){const n=qo(r,e);if(n.result==="error")return n;const a=n.value.expression,h=Fo(a);if(!h&&!bs(e))return Fi([new Pr("","data expressions not supported")]);const m=eo(a,["zoom"]);if(!m&&!pl(e))return Fi([new Pr("","zoom expressions not supported")]);const y=lo(a);return y||m?y instanceof Pr?Fi([y]):y instanceof Wn&&!Oa(e)?Fi([new Pr("",'"interpolate" expressions cannot be used with this property')]):hl(y?new oo(h?"camera":"composite",n.value,y.labels,y instanceof Wn?y.interpolation:void 0):new so(h?"constant":"source",n.value)):Fi([new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ao{constructor(e,n){this._parameters=e,this._specification=n,jn(this,nr(this._parameters,this._specification))}static deserialize(e){return new ao(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function lo(r){let e=null;if(r instanceof Uo)e=lo(r.result);else if(r instanceof Bo){for(const n of r.args)if(e=lo(n),e)break}else(r instanceof Li||r instanceof Wn)&&r.input instanceof Hn&&r.input.name==="zoom"&&(e=r);return e instanceof Pr||r.eachChild(n=>{const a=lo(n);a instanceof Pr?e=a:!e&&a?e=new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function co(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!co(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const fl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Na(r){if(r==null)return{filter:()=>!0,needGeometry:!1};co(r)||(r=Zo(r));const e=qo(r,fl);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,a,h)=>e.value.evaluate(n,a,{},h),needGeometry:ml(r)}}function rc(r,e){return r<e?-1:r>e?1:0}function ml(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(ml(r[e]))return!0;return!1}function Zo(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Ho(r[1],r[2],"=="):e==="!="?uo(Ho(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ho(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(Zo))):e==="all"?["all"].concat(r.slice(1).map(Zo)):e==="none"?["all"].concat(r.slice(1).map(Zo).map(uo)):e==="in"?gl(r[1],r.slice(2)):e==="!in"?uo(gl(r[1],r.slice(2))):e==="has"?yl(r[1]):e==="!has"?uo(yl(r[1])):e!=="within"||r;var n}function Ho(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function gl(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",r,["literal",e.sort(rc)]]:["filter-in-small",r,["literal",e]]}}function yl(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function uo(r){return["!",r]}function Wo(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let h="[";for(const m of r)h+=`${Wo(m)},`;return`${h}]`}const n=Object.keys(r).sort();let a="{";for(let h=0;h<n.length;h++)a+=`${JSON.stringify(n[h])}:${Wo(r[n[h]])},`;return`${a}}`}function Xo(r){let e="";for(const n of Jt)e+=`/${Wo(r[n])}`;return e}function _l(r){const e=r.value;return e?[new it(r.key,e,"constants have been deprecated as of v8")]:[]}function Or(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Es(r){if(Array.isArray(r))return r.map(Es);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=Es(r[n]);return e}return Or(r)}function zn(r){const e=r.key,n=r.value,a=r.valueSpec||{},h=r.objectElementValidators||{},m=r.style,y=r.styleSpec,x=r.validateSpec;let T=[];const D=pr(n);if(D!=="object")return[new it(e,n,`object expected, ${D} found`)];for(const k in n){const F=k.split(".")[0],U=a[F]||a["*"];let G;if(h[F])G=h[F];else if(a[F])G=x;else if(h["*"])G=h["*"];else{if(!a["*"]){T.push(new it(e,n[k],`unknown property "${k}"`));continue}G=x}T=T.concat(G({key:(e&&`${e}.`)+k,value:n[k],valueSpec:U,style:m,styleSpec:y,object:n,objectKey:k,validateSpec:x},n))}for(const k in a)h[k]||a[k].required&&a[k].default===void 0&&n[k]===void 0&&T.push(new it(e,n,`missing required property "${k}"`));return T}function Fs(r){const e=r.value,n=r.valueSpec,a=r.style,h=r.styleSpec,m=r.key,y=r.arrayElementValidator||r.validateSpec;if(pr(e)!=="array")return[new it(m,e,`array expected, ${pr(e)} found`)];if(n.length&&e.length!==n.length)return[new it(m,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new it(m,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let x={type:n.value,values:n.values};h.$version<7&&(x.function=n.function),pr(n.value)==="object"&&(x=n.value);let T=[];for(let D=0;D<e.length;D++)T=T.concat(y({array:e,arrayIndex:D,value:e[D],valueSpec:x,validateSpec:r.validateSpec,style:a,styleSpec:h,key:`${m}[${D}]`}));return T}function ho(r){const e=r.key,n=r.value,a=r.valueSpec;let h=pr(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new it(e,n,`number expected, ${h} found`)]:"minimum"in a&&n<a.minimum?[new it(e,n,`${n} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&n>a.maximum?[new it(e,n,`${n} is greater than the maximum value ${a.maximum}`)]:[]}function Yo(r){const e=r.valueSpec,n=Or(r.value.type);let a,h,m,y={};const x=n!=="categorical"&&r.value.property===void 0,T=!x,D=pr(r.value.stops)==="array"&&pr(r.value.stops[0])==="array"&&pr(r.value.stops[0][0])==="object",k=zn({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(G){if(n==="identity")return[new it(G.key,G.value,'identity function may not have a "stops" property')];let W=[];const ee=G.value;return W=W.concat(Fs({key:G.key,value:ee,valueSpec:G.valueSpec,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:F})),pr(ee)==="array"&&ee.length===0&&W.push(new it(G.key,ee,"array must have at least one stop")),W},default:function(G){return G.validateSpec({key:G.key,value:G.value,valueSpec:e,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec})}}});return n==="identity"&&x&&k.push(new it(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||k.push(new it(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Oa(r.valueSpec)&&k.push(new it(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(T&&!bs(r.valueSpec)?k.push(new it(r.key,r.value,"property functions not supported")):x&&!pl(r.valueSpec)&&k.push(new it(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!D||r.value.property!==void 0||k.push(new it(r.key,r.value,'"property" property is required')),k;function F(G){let W=[];const ee=G.value,ue=G.key;if(pr(ee)!=="array")return[new it(ue,ee,`array expected, ${pr(ee)} found`)];if(ee.length!==2)return[new it(ue,ee,`array length 2 expected, length ${ee.length} found`)];if(D){if(pr(ee[0])!=="object")return[new it(ue,ee,`object expected, ${pr(ee[0])} found`)];if(ee[0].zoom===void 0)return[new it(ue,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new it(ue,ee,"object stop key must have value")];if(m&&m>Or(ee[0].zoom))return[new it(ue,ee[0].zoom,"stop zoom values must appear in ascending order")];Or(ee[0].zoom)!==m&&(m=Or(ee[0].zoom),h=void 0,y={}),W=W.concat(zn({key:`${ue}[0]`,value:ee[0],valueSpec:{zoom:{}},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:ho,value:U}}))}else W=W.concat(U({key:`${ue}[0]`,value:ee[0],valueSpec:{},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec},ee));return io(Es(ee[1]))?W.concat([new it(`${ue}[1]`,ee[1],"expressions are not allowed in function stops.")]):W.concat(G.validateSpec({key:`${ue}[1]`,value:ee[1],valueSpec:e,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec}))}function U(G,W){const ee=pr(G.value),ue=Or(G.value),ge=G.value!==null?G.value:W;if(a){if(ee!==a)return[new it(G.key,ge,`${ee} stop domain type must match previous stop domain type ${a}`)]}else a=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean")return[new it(G.key,ge,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&n!=="categorical"){let Ce=`number expected, ${ee} found`;return bs(e)&&n===void 0&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(G.key,ge,Ce)]}return n!=="categorical"||ee!=="number"||isFinite(ue)&&Math.floor(ue)===ue?n!=="categorical"&&ee==="number"&&h!==void 0&&ue<h?[new it(G.key,ge,"stop domain values must appear in ascending order")]:(h=ue,n==="categorical"&&ue in y?[new it(G.key,ge,"stop domain values must be unique")]:(y[ue]=!0,[])):[new it(G.key,ge,`integer expected, found ${ue}`)]}}function Qi(r){const e=(r.expressionContext==="property"?Go:qo)(Es(r.value),r.valueSpec);if(e.result==="error")return e.value.map(a=>new it(`${r.key}${a.key}`,r.value,a.message));const n=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new it(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Qs(n))return[new it(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Qs(n))return[new it(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!eo(n,["zoom","feature-state"]))return[new it(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Fo(n))return[new it(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function po(r){const e=r.key,n=r.value,a=r.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Or(n))===-1&&h.push(new it(e,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(Or(n))===-1&&h.push(new it(e,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function Ts(r){return co(Es(r.value))?Qi(jn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):La(r)}function La(r){const e=r.value,n=r.key;if(pr(e)!=="array")return[new it(n,e,`array expected, ${pr(e)} found`)];const a=r.styleSpec;let h,m=[];if(e.length<1)return[new it(n,e,"filter array must have at least 1 element")];switch(m=m.concat(po({key:`${n}[0]`,value:e[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),Or(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Or(e[1])==="$type"&&m.push(new it(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new it(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=pr(e[1]),h!=="string"&&m.push(new it(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let y=2;y<e.length;y++)h=pr(e[y]),Or(e[1])==="$type"?m=m.concat(po({key:`${n}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&m.push(new it(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)m=m.concat(La({key:`${n}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=pr(e[1]),e.length!==2?m.push(new it(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&m.push(new it(`${n}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=pr(e[1]),e.length!==2?m.push(new it(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="object"&&m.push(new it(`${n}[1]`,e[1],`object expected, ${h} found`))}return m}function vl(r,e){const n=r.key,a=r.validateSpec,h=r.style,m=r.styleSpec,y=r.value,x=r.objectKey,T=m[`${e}_${r.layerType}`];if(!T)return[];const D=x.match(/^(.*)-transition$/);if(e==="paint"&&D&&T[D[1]]&&T[D[1]].transition)return a({key:n,value:y,valueSpec:m.transition,style:h,styleSpec:m});const k=r.valueSpec||T[x];if(!k)return[new it(n,y,`unknown property "${x}"`)];let F;if(pr(y)==="string"&&bs(k)&&!k.tokens&&(F=/^{([^}]+)}$/.exec(y)))return[new it(n,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const U=[];return r.layerType==="symbol"&&(x==="text-field"&&h&&!h.glyphs&&U.push(new it(n,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Lr(Es(y))&&Or(y.type)==="identity"&&U.push(new it(n,y,'"text-font" does not support identity functions'))),U.concat(a({key:r.key,value:y,valueSpec:k,style:h,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:x}))}function xl(r){return vl(r,"paint")}function zi(r){return vl(r,"layout")}function bl(r){let e=[];const n=r.value,a=r.key,h=r.style,m=r.styleSpec;n.type||n.ref||e.push(new it(a,n,'either "type" or "ref" is required'));let y=Or(n.type);const x=Or(n.ref);if(n.id){const T=Or(n.id);for(let D=0;D<r.arrayIndex;D++){const k=h.layers[D];Or(k.id)===T&&e.push(new it(a,n.id,`duplicate layer id "${n.id}", previously used at line ${k.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(D=>{D in n&&e.push(new it(a,n[D],`"${D}" is prohibited for ref layers`))}),h.layers.forEach(D=>{Or(D.id)===x&&(T=D)}),T?T.ref?e.push(new it(a,n.ref,"ref cannot reference another ref layer")):y=Or(T.type):e.push(new it(a,n.ref,`ref layer "${x}" not found`))}else if(y!=="background")if(n.source){const T=h.sources&&h.sources[n.source],D=T&&Or(T.type);T?D==="vector"&&y==="raster"?e.push(new it(a,n.source,`layer "${n.id}" requires a raster source`)):D!=="raster-dem"&&y==="hillshade"?e.push(new it(a,n.source,`layer "${n.id}" requires a raster-dem source`)):D==="raster"&&y!=="raster"?e.push(new it(a,n.source,`layer "${n.id}" requires a vector source`)):D!=="vector"||n["source-layer"]?D==="raster-dem"&&y!=="hillshade"?e.push(new it(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]||D==="geojson"&&T.lineMetrics||e.push(new it(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new it(a,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new it(a,n.source,`source "${n.source}" not found`))}else e.push(new it(a,n,'missing required property "source"'));return e=e.concat(zn({key:a,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${a}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Ts,layout:T=>zn({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":D=>zi(jn({layerType:y},D))}}),paint:T=>zn({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":D=>xl(jn({layerType:y},D))}})}})),e}function Xn(r){const e=r.value,n=r.key,a=pr(e);return a!=="string"?[new it(n,e,`string expected, ${a} found`)]:[]}const zs={promoteId:function({key:r,value:e}){if(pr(e)==="string")return Xn({key:r,value:e});{const n=[];for(const a in e)n.push(...Xn({key:`${r}.${a}`,value:e[a]}));return n}}};function Yn(r){const e=r.value,n=r.key,a=r.styleSpec,h=r.style,m=r.validateSpec;if(!e.type)return[new it(n,e,'"type" is required')];const y=Or(e.type);let x;switch(y){case"vector":case"raster":return x=zn({key:n,value:e,valueSpec:a[`source_${y.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:zs,validateSpec:m}),x;case"raster-dem":return x=function(T){var D;const k=(D=T.sourceName)!==null&&D!==void 0?D:"",F=T.value,U=T.styleSpec,G=U.source_raster_dem,W=T.style;let ee=[];const ue=pr(F);if(F===void 0)return ee;if(ue!=="object")return ee.push(new it("source_raster_dem",F,`object expected, ${ue} found`)),ee;const ge=Or(F.encoding)==="custom",Ce=["redFactor","greenFactor","blueFactor","baseShift"],be=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ke in F)!ge&&Ce.includes(ke)?ee.push(new it(ke,F[ke],`In "${k}": "${ke}" is only valid when "encoding" is set to "custom". ${be} encoding found`)):G[ke]?ee=ee.concat(T.validateSpec({key:ke,value:F[ke],valueSpec:G[ke],validateSpec:T.validateSpec,style:W,styleSpec:U})):ee.push(new it(ke,F[ke],`unknown property "${ke}"`));return ee}({sourceName:n,value:e,style:r.style,styleSpec:a,validateSpec:m}),x;case"geojson":if(x=zn({key:n,value:e,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:m,objectElementValidators:zs}),e.cluster)for(const T in e.clusterProperties){const[D,k]=e.clusterProperties[T],F=typeof D=="string"?[D,["accumulated"],["get",T]]:D;x.push(...Qi({key:`${n}.${T}.map`,value:k,validateSpec:m,expressionContext:"cluster-map"})),x.push(...Qi({key:`${n}.${T}.reduce`,value:F,validateSpec:m,expressionContext:"cluster-reduce"}))}return x;case"video":return zn({key:n,value:e,valueSpec:a.source_video,style:h,validateSpec:m,styleSpec:a});case"image":return zn({key:n,value:e,valueSpec:a.source_image,style:h,validateSpec:m,styleSpec:a});case"canvas":return[new it(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return po({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:m,styleSpec:a})}}function fo(r){const e=r.value,n=r.styleSpec,a=n.light,h=r.style;let m=[];const y=pr(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new it("light",e,`object expected, ${y} found`)]),m;for(const x in e){const T=x.match(/^(.*)-transition$/);m=m.concat(T&&a[T[1]]&&a[T[1]].transition?r.validateSpec({key:x,value:e[x],valueSpec:n.transition,validateSpec:r.validateSpec,style:h,styleSpec:n}):a[x]?r.validateSpec({key:x,value:e[x],valueSpec:a[x],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new it(x,e[x],`unknown property "${x}"`)])}return m}function wl(r){const e=r.value,n=r.styleSpec,a=n.terrain,h=r.style;let m=[];const y=pr(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new it("terrain",e,`object expected, ${y} found`)]),m;for(const x in e)m=m.concat(a[x]?r.validateSpec({key:x,value:e[x],valueSpec:a[x],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new it(x,e[x],`unknown property "${x}"`)]);return m}function z(r){let e=[];const n=r.value,a=r.key;if(Array.isArray(n)){const h=[],m=[];for(const y in n)n[y].id&&h.includes(n[y].id)&&e.push(new it(a,n,`all the sprites' ids must be unique, but ${n[y].id} is duplicated`)),h.push(n[y].id),n[y].url&&m.includes(n[y].url)&&e.push(new it(a,n,`all the sprites' URLs must be unique, but ${n[y].url} is duplicated`)),m.push(n[y].url),e=e.concat(zn({key:`${a}[${y}]`,value:n[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return Xn({key:a,value:n})}const J={"*":()=>[],array:Fs,boolean:function(r){const e=r.value,n=r.key,a=pr(e);return a!=="boolean"?[new it(n,e,`boolean expected, ${a} found`)]:[]},number:ho,color:function(r){const e=r.key,n=r.value,a=pr(n);return a!=="string"?[new it(e,n,`color expected, ${a} found`)]:xr.parse(String(n))?[]:[new it(e,n,`color expected, "${n}" found`)]},constants:_l,enum:po,filter:Ts,function:Yo,layer:bl,object:zn,source:Yn,light:fo,terrain:wl,string:Xn,formatted:function(r){return Xn(r).length===0?[]:Qi(r)},resolvedImage:function(r){return Xn(r).length===0?[]:Qi(r)},padding:function(r){const e=r.key,n=r.value;if(pr(n)==="array"){if(n.length<1||n.length>4)return[new it(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const a={type:"number"};let h=[];for(let m=0;m<n.length;m++)h=h.concat(r.validateSpec({key:`${e}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:a}));return h}return ho({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,n=r.value,a=pr(n),h=r.styleSpec;if(a!=="array"||n.length<1||n.length%2!=0)return[new it(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let y=0;y<n.length;y+=2)m=m.concat(po({key:`${e}[${y}]`,value:n[y],valueSpec:h.layout_symbol["text-anchor"]})),m=m.concat(Fs({key:`${e}[${y+1}]`,value:n[y+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:h}));return m},sprite:z};function ye(r){const e=r.value,n=r.valueSpec,a=r.styleSpec;return r.validateSpec=ye,n.expression&&Lr(Or(e))?Yo(r):n.expression&&io(Es(e))?Qi(r):n.type&&J[n.type]?J[n.type](r):zn(jn({},r,{valueSpec:n.type?a[n.type]:n}))}function Re(r){const e=r.value,n=r.key,a=Xn(r);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new it(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new it(n,e,'"glyphs" url must include a "{range}" token'))),a}function ze(r,e=$e){let n=[];return n=n.concat(ye({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:ye,objectElementValidators:{glyphs:Re,"*":()=>[]}})),r.constants&&(n=n.concat(_l({key:"constants",value:r.constants,style:r,styleSpec:e,validateSpec:ye}))),Tt(n)}function at(r){return function(e){return r({...e,validateSpec:ye})}}function Tt(r){return[].concat(r).sort((e,n)=>e.line-n.line)}function gt(r){return function(...e){return Tt(r.apply(this,e))}}ze.source=gt(at(Yn)),ze.sprite=gt(at(z)),ze.glyphs=gt(at(Re)),ze.light=gt(at(fo)),ze.terrain=gt(at(wl)),ze.layer=gt(at(bl)),ze.filter=gt(at(Ts)),ze.paintProperty=gt(at(xl)),ze.layoutProperty=gt(at(zi));const Ft=ze,Ar=Ft.light,Jr=Ft.paintProperty,Jn=Ft.layoutProperty;function ui(r,e){let n=!1;if(e&&e.length)for(const a of e)r.fire(new Dn(new Error(a.message))),n=!0;return n}class Kn{constructor(e,n,a){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(n=y[1])+2*(a=y[2]);for(let T=0;T<this.d*this.d;T++){const D=y[3+T],k=y[3+T+1];h.push(D===k?null:y.subarray(D,k))}const x=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],x),this.bboxes=y.subarray(x),this.insert=this._insertReadonly}else{this.d=n+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=a,this.scale=n/e,this.uid=0;const m=a/n*e;this.min=-m,this.max=e+m}insert(e,n,a,h,m){this._forEachCell(n,a,h,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,a,h,m,y){this.cells[m].push(y)}query(e,n,a,h,m){const y=this.min,x=this.max;if(e<=y&&n<=y&&x<=a&&x<=h&&!m)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,a,h,this._queryCell,T,{},m),T}}_queryCell(e,n,a,h,m,y,x,T){const D=this.cells[m];if(D!==null){const k=this.keys,F=this.bboxes;for(let U=0;U<D.length;U++){const G=D[U];if(x[G]===void 0){const W=4*G;(T?T(F[W+0],F[W+1],F[W+2],F[W+3]):e<=F[W+2]&&n<=F[W+3]&&a>=F[W+0]&&h>=F[W+1])?(x[G]=!0,y.push(k[G])):x[G]=!1}}}}_forEachCell(e,n,a,h,m,y,x,T){const D=this._convertToCellCoord(e),k=this._convertToCellCoord(n),F=this._convertToCellCoord(a),U=this._convertToCellCoord(h);for(let G=D;G<=F;G++)for(let W=k;W<=U;W++){const ee=this.d*W+G;if((!T||T(this._convertFromCellCoord(G),this._convertFromCellCoord(W),this._convertFromCellCoord(G+1),this._convertFromCellCoord(W+1)))&&m.call(this,e,n,a,h,ee,y,x,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const h=new Int32Array(n+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let m=n;for(let y=0;y<e.length;y++){const x=e[y];h[3+y]=m,h.set(x,m),m+=x.length}return h[3+e.length]=m,h.set(this.keys,m),m+=this.keys.length,h[3+e.length+1]=m,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer}static serialize(e,n){const a=e.toArrayBuffer();return n&&n.push(a),{buffer:a}}static deserialize(e){return new Kn(e.buffer)}}const Gr={};function bt(r,e,n={}){if(Gr[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Gr[r]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}bt("Object",Object),bt("TransferableGridIndex",Kn),bt("Color",xr),bt("Error",Error),bt("AJAXError",ot),bt("ResolvedImage",fn),bt("StylePropertyFunction",ao),bt("StyleExpression",Ra,{omit:["_evaluator"]}),bt("ZoomDependentExpression",oo),bt("ZoomConstantExpression",so),bt("CompoundExpression",Hn,{omit:["_evaluate"]});for(const r in vs)vs[r]._classRegistryKey||bt(`Expression_${r}`,vs[r]);function Di(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Bs(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Di(r)||ft(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const n=r;return e&&e.push(n.buffer),n}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const n=[];for(const a of r)n.push(Bs(a,e));return n}if(typeof r=="object"){const n=r.constructor,a=n._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!Gr[a])throw new Error(`${a} is not registered.`);const h=n.serialize?n.serialize(r,e):{};if(n.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Gr[a].omit.indexOf(m)>=0)continue;const y=r[m];h[m]=Gr[a].shallow.indexOf(m)>=0?y:Bs(y,e)}r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof r)}function Jo(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Di(r)||ft(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Jo);if(typeof r=="object"){const e=r.$name||"Object";if(!Gr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Gr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(r);const a=Object.create(n.prototype);for(const h of Object.keys(r)){if(h==="$name")continue;const m=r[h];a[h]=Gr[e].shallow.indexOf(h)>=0?m:Jo(m)}return a}throw new Error("can't deserialize object of type "+typeof r)}class Ru{constructor(){this.first=!0}update(e,n){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const vt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function nc(r){for(const e of r)if(sc(e.charCodeAt(0)))return!0;return!1}function ic(r){for(const e of r)if(!ap(e.charCodeAt(0)))return!1;return!0}function ap(r){return!(vt.Arabic(r)||vt["Arabic Supplement"](r)||vt["Arabic Extended-A"](r)||vt["Arabic Presentation Forms-A"](r)||vt["Arabic Presentation Forms-B"](r))}function sc(r){return!(r!==746&&r!==747&&(r<4352||!(vt["Bopomofo Extended"](r)||vt.Bopomofo(r)||vt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||vt["CJK Compatibility Ideographs"](r)||vt["CJK Compatibility"](r)||vt["CJK Radicals Supplement"](r)||vt["CJK Strokes"](r)||!(!vt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||vt["CJK Unified Ideographs Extension A"](r)||vt["CJK Unified Ideographs"](r)||vt["Enclosed CJK Letters and Months"](r)||vt["Hangul Compatibility Jamo"](r)||vt["Hangul Jamo Extended-A"](r)||vt["Hangul Jamo Extended-B"](r)||vt["Hangul Jamo"](r)||vt["Hangul Syllables"](r)||vt.Hiragana(r)||vt["Ideographic Description Characters"](r)||vt.Kanbun(r)||vt["Kangxi Radicals"](r)||vt["Katakana Phonetic Extensions"](r)||vt.Katakana(r)&&r!==12540||!(!vt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!vt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||vt["Unified Canadian Aboriginal Syllabics"](r)||vt["Unified Canadian Aboriginal Syllabics Extended"](r)||vt["Vertical Forms"](r)||vt["Yijing Hexagram Symbols"](r)||vt["Yi Syllables"](r)||vt["Yi Radicals"](r))))}function Nu(r){return!(sc(r)||function(e){return!!(vt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||vt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||vt["Letterlike Symbols"](e)||vt["Number Forms"](e)||vt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||vt["Control Pictures"](e)&&e!==9251||vt["Optical Character Recognition"](e)||vt["Enclosed Alphanumerics"](e)||vt["Geometric Shapes"](e)||vt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||vt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vt["CJK Symbols and Punctuation"](e)||vt.Katakana(e)||vt["Private Use Area"](e)||vt["CJK Compatibility Forms"](e)||vt["Small Form Variants"](e)||vt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Lu(r){return r>=1424&&r<=2303||vt["Arabic Presentation Forms-A"](r)||vt["Arabic Presentation Forms-B"](r)}function Fu(r,e){return!(!e&&Lu(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||vt.Khmer(r))}function lp(r){for(const e of r)if(Lu(e.charCodeAt(0)))return!0;return!1}const oc="deferred",ac="loading",lc="loaded";let cc=null,hi="unavailable",Us=null;const Fa=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(hi="error"),cc&&cc(r)};function uc(){za.fire(new An("pluginStateChange",{pluginStatus:hi,pluginURL:Us}))}const za=new Xe,hc=function(){return hi},zu=function(){if(hi!==oc||!Us)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");hi=ac,uc(),Us&&hn({url:Us},r=>{r?Fa(r):(hi=lc,uc())})},vi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>hi===lc||vi.applyArabicShaping!=null,isLoading:()=>hi===ac,setState(r){if(!ht())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");hi=r.pluginStatus,Us=r.pluginURL},isParsed(){if(!ht())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return vi.applyArabicShaping!=null&&vi.processBidirectionalText!=null&&vi.processStyledBidirectionalText!=null},getPluginURL(){if(!ht())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Us}};class zr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ru,this.transition={})}isSupportedScript(e){return function(n,a){for(const h of n)if(!Fu(h.charCodeAt(0),a))return!1;return!0}(e,vi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}}}class El{constructor(e,n){this.property=e,this.value=n,this.expression=function(a,h){if(Lr(a))return new ao(a,h);if(io(a)){const m=Go(a,h);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=a;return h.type==="color"&&typeof a=="string"?m=xr.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(m=li.parse(a)):m=Zn.parse(a),{kind:"constant",evaluate:()=>m}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class pc{constructor(e){this.property=e,this.value=new El(e,void 0)}transitioned(e,n){return new Uu(this.property,this.value,n,Me({},e.transition,this.transition),e.now)}untransitioned(){return new Uu(this.property,this.value,null,{},0)}}class Bu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ye(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new pc(this._values[e].property)),this._values[e].value=new El(this._values[e].property,n===null?void 0:Ye(n))}getTransition(e){return Ye(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new pc(this._values[e].property)),this._values[e].transition=Ye(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a);const h=this.getTransition(n);h!==void 0&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){const a=new $u(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(e,n._values[h]);return a}untransitioned(){const e=new $u(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Uu{constructor(e,n,a,h,m){this.property=e,this.value=n,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){const h=e.now||0,m=this.value.possiblyEvaluate(e,n,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return y.possiblyEvaluate(e,n,a);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,a),m,function(T){if(T<=0)return 0;if(T>=1)return 1;const D=T*T,k=D*T;return 4*(T<.5?k:3*(T-D)+k-.75)}(x))}}return m}}class $u{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){const h=new Tl(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,n,a);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class cp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ye(this._values[e].value)}setValue(e,n){this._values[e]=new El(this._values[e].property,n===null?void 0:Ye(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){const h=new Tl(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,n,a);return h}}class Qn{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,h){return this.property.evaluate(this.value,this.parameters,e,n,a,h)}}class Tl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Bt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,a){const h=Fn[this.specification.type];return h?h(e,n,a):e}}class qt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,h){return new Qn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,h)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Qn(this,{kind:"constant",value:void 0},e.parameters);const h=Fn[this.specification.type];if(h){const m=h(e.value.value,n.value.value,a);return new Qn(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,n,a,h,m,y){return e.kind==="constant"?e.value:e.evaluate(n,a,h,m,y)}}class Ba extends qt{possiblyEvaluate(e,n,a,h){if(e.value===void 0)return new Qn(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},a,h),y=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,x=this._calculate(y,y,y,n);return new Qn(this,{kind:"constant",value:x},n)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Qn(this,{kind:"constant",value:m},n)}return new Qn(this,e.expression,n)}evaluate(e,n,a,h,m,y){if(e.kind==="source"){const x=e.evaluate(n,a,h,m,y);return this._calculate(x,x,x,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},a,h),e.evaluate({zoom:Math.floor(n.zoom)},a,h),e.evaluate({zoom:Math.floor(n.zoom)+1},a,h),n):e.value}_calculate(e,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:a,to:n}}interpolate(e){return e}}class dc{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},a,h);return this._calculate(m,m,m,n)}return this._calculate(e.expression.evaluate(new zr(Math.floor(n.zoom-1),n)),e.expression.evaluate(new zr(Math.floor(n.zoom),n)),e.expression.evaluate(new zr(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:a,to:n}}interpolate(e){return e}}class fc{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,h){return!!e.expression.evaluate(n,null,{},a,h)}interpolate(){return!1}}class tn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const a=e[n];a.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new El(a,void 0),m=this.defaultTransitionablePropertyValues[n]=new pc(a);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}bt("DataDrivenProperty",qt),bt("DataConstantProperty",Bt),bt("CrossFadedDataDrivenProperty",Ba),bt("CrossFadedProperty",dc),bt("ColorRampProperty",fc);const mc="-transition";class Ci extends Xe{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new cp(n.layout)),n.paint)){this._transitionablePaint=new Bu(n.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Tl(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,a={}){n!=null&&this._validate(Jn,`layers.${this.id}.layout.${e}`,e,n,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(mc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,a={}){if(n!=null&&this._validate(Jr,`layers.${this.id}.paint.${e}`,e,n,a))return!1;if(e.endsWith(mc))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[e],m=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(e,x,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ge(e,(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}_validate(e,n,a,h,m={}){return(!m||m.validate!==!1)&&ui(this,e.call(Ft,{key:n,layerType:this.type,objectKey:a,value:h,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Qn&&bs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Vu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class mo{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qr(r,e=1){let n=0,a=0;return{members:r.map(h=>{const m=Vu[h.type].BYTES_PER_ELEMENT,y=n=Ko(n,Math.max(e,m)),x=h.components||1;return a=Math.max(a,m),n+=m*x,{name:h.name,type:h.type,components:x,offset:y}}),size:Ko(n,Math.max(a,e)),alignment:e}}function Ko(r,e){return Math.ceil(r/e)*e}class Ua extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=a,e}}Ua.prototype.bytesPerElement=4,bt("StructArrayLayout2i4",Ua);class $a extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const m=3*e;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=h,e}}$a.prototype.bytesPerElement=6,bt("StructArrayLayout3i6",$a);class go extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,h)}emplace(e,n,a,h,m){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=m,e}}go.prototype.bytesPerElement=8,bt("StructArrayLayout4i8",go);class gc extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,h,m,y)}emplace(e,n,a,h,m,y,x){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.int16[T+2]=h,this.int16[T+3]=m,this.int16[T+4]=y,this.int16[T+5]=x,e}}gc.prototype.bytesPerElement=12,bt("StructArrayLayout2i4i12",gc);class yc extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,h,m,y)}emplace(e,n,a,h,m,y,x){const T=4*e,D=8*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.uint8[D+4]=h,this.uint8[D+5]=m,this.uint8[D+6]=y,this.uint8[D+7]=x,e}}yc.prototype.bytesPerElement=8,bt("StructArrayLayout2i4ub8",yc);class Qo extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=a,e}}Qo.prototype.bytesPerElement=8,bt("StructArrayLayout2f8",Qo);class _c extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m,y,x,T,D,k){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,a,h,m,y,x,T,D,k)}emplace(e,n,a,h,m,y,x,T,D,k,F){const U=10*e;return this.uint16[U+0]=n,this.uint16[U+1]=a,this.uint16[U+2]=h,this.uint16[U+3]=m,this.uint16[U+4]=y,this.uint16[U+5]=x,this.uint16[U+6]=T,this.uint16[U+7]=D,this.uint16[U+8]=k,this.uint16[U+9]=F,e}}_c.prototype.bytesPerElement=20,bt("StructArrayLayout10ui20",_c);class vc extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m,y,x,T,D,k,F,U){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,a,h,m,y,x,T,D,k,F,U)}emplace(e,n,a,h,m,y,x,T,D,k,F,U,G){const W=12*e;return this.int16[W+0]=n,this.int16[W+1]=a,this.int16[W+2]=h,this.int16[W+3]=m,this.uint16[W+4]=y,this.uint16[W+5]=x,this.uint16[W+6]=T,this.uint16[W+7]=D,this.int16[W+8]=k,this.int16[W+9]=F,this.int16[W+10]=U,this.int16[W+11]=G,e}}vc.prototype.bytesPerElement=24,bt("StructArrayLayout4i4ui4i24",vc);class br extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const m=3*e;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=h,e}}br.prototype.bytesPerElement=12,bt("StructArrayLayout3f12",br);class d extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}d.prototype.bytesPerElement=4,bt("StructArrayLayout1ul4",d);class t extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m,y,x,T,D){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,a,h,m,y,x,T,D)}emplace(e,n,a,h,m,y,x,T,D,k){const F=10*e,U=5*e;return this.int16[F+0]=n,this.int16[F+1]=a,this.int16[F+2]=h,this.int16[F+3]=m,this.int16[F+4]=y,this.int16[F+5]=x,this.uint32[U+3]=T,this.uint16[F+8]=D,this.uint16[F+9]=k,e}}t.prototype.bytesPerElement=20,bt("StructArrayLayout6i1ul2ui20",t);class s extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,h,m,y)}emplace(e,n,a,h,m,y,x){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.int16[T+2]=h,this.int16[T+3]=m,this.int16[T+4]=y,this.int16[T+5]=x,e}}s.prototype.bytesPerElement=12,bt("StructArrayLayout2i2i2i12",s);class u extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,h,m)}emplace(e,n,a,h,m,y){const x=4*e,T=8*e;return this.float32[x+0]=n,this.float32[x+1]=a,this.float32[x+2]=h,this.int16[T+6]=m,this.int16[T+7]=y,e}}u.prototype.bytesPerElement=16,bt("StructArrayLayout2f1f2i16",u);class p extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,h)}emplace(e,n,a,h,m){const y=12*e,x=3*e;return this.uint8[y+0]=n,this.uint8[y+1]=a,this.float32[x+1]=h,this.float32[x+2]=m,e}}p.prototype.bytesPerElement=12,bt("StructArrayLayout2ub2f12",p);class g extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=h,e}}g.prototype.bytesPerElement=6,bt("StructArrayLayout3ui6",g);class b extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m,y,x,T,D,k,F,U,G,W,ee,ue,ge){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,e,n,a,h,m,y,x,T,D,k,F,U,G,W,ee,ue,ge)}emplace(e,n,a,h,m,y,x,T,D,k,F,U,G,W,ee,ue,ge,Ce){const be=24*e,ke=12*e,Le=48*e;return this.int16[be+0]=n,this.int16[be+1]=a,this.uint16[be+2]=h,this.uint16[be+3]=m,this.uint32[ke+2]=y,this.uint32[ke+3]=x,this.uint32[ke+4]=T,this.uint16[be+10]=D,this.uint16[be+11]=k,this.uint16[be+12]=F,this.float32[ke+7]=U,this.float32[ke+8]=G,this.uint8[Le+36]=W,this.uint8[Le+37]=ee,this.uint8[Le+38]=ue,this.uint32[ke+10]=ge,this.int16[be+22]=Ce,e}}b.prototype.bytesPerElement=48,bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",b);class E extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,h,m,y,x,T,D,k,F,U,G,W,ee,ue,ge,Ce,be,ke,Le,We,xt,Nt,_t,dt,lt,Pt){const ut=this.length;return this.resize(ut+1),this.emplace(ut,e,n,a,h,m,y,x,T,D,k,F,U,G,W,ee,ue,ge,Ce,be,ke,Le,We,xt,Nt,_t,dt,lt,Pt)}emplace(e,n,a,h,m,y,x,T,D,k,F,U,G,W,ee,ue,ge,Ce,be,ke,Le,We,xt,Nt,_t,dt,lt,Pt,ut){const rt=32*e,$t=16*e;return this.int16[rt+0]=n,this.int16[rt+1]=a,this.int16[rt+2]=h,this.int16[rt+3]=m,this.int16[rt+4]=y,this.int16[rt+5]=x,this.int16[rt+6]=T,this.int16[rt+7]=D,this.uint16[rt+8]=k,this.uint16[rt+9]=F,this.uint16[rt+10]=U,this.uint16[rt+11]=G,this.uint16[rt+12]=W,this.uint16[rt+13]=ee,this.uint16[rt+14]=ue,this.uint16[rt+15]=ge,this.uint16[rt+16]=Ce,this.uint16[rt+17]=be,this.uint16[rt+18]=ke,this.uint16[rt+19]=Le,this.uint16[rt+20]=We,this.uint16[rt+21]=xt,this.uint16[rt+22]=Nt,this.uint32[$t+12]=_t,this.float32[$t+13]=dt,this.float32[$t+14]=lt,this.uint16[rt+30]=Pt,this.uint16[rt+31]=ut,e}}E.prototype.bytesPerElement=64,bt("StructArrayLayout8i15ui1ul2f2ui64",E);class S extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}S.prototype.bytesPerElement=4,bt("StructArrayLayout1f4",S);class C extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const m=3*e;return this.uint16[6*e+0]=n,this.float32[m+1]=a,this.float32[m+2]=h,e}}C.prototype.bytesPerElement=12,bt("StructArrayLayout1ui2f12",C);class M extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,a)}emplace(e,n,a,h){const m=4*e;return this.uint32[2*e+0]=n,this.uint16[m+2]=a,this.uint16[m+3]=h,e}}M.prototype.bytesPerElement=8,bt("StructArrayLayout1ul2ui8",M);class N extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=a,e}}N.prototype.bytesPerElement=4,bt("StructArrayLayout2ui4",N);class j extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}j.prototype.bytesPerElement=2,bt("StructArrayLayout1ui2",j);class re extends Zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,h)}emplace(e,n,a,h,m){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=m,e}}re.prototype.bytesPerElement=16,bt("StructArrayLayout4f16",re);class te extends mo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}te.prototype.size=20;class oe extends t{get(e){return new te(this,e)}}bt("CollisionBoxArray",oe);class K extends mo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}K.prototype.size=48;class Se extends b{get(e){return new K(this,e)}}bt("PlacedSymbolArray",Se);class Ne extends mo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ne.prototype.size=64;class pe extends E{get(e){return new Ne(this,e)}}bt("SymbolInstanceArray",pe);class De extends S{getoffsetX(e){return this.float32[1*e+0]}}bt("GlyphOffsetArray",De);class Fe extends $a{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}bt("SymbolLineVertexArray",Fe);class Be extends mo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Be.prototype.size=12;class He extends C{get(e){return new Be(this,e)}}bt("TextAnchorOffsetArray",He);class tt extends mo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}tt.prototype.size=8;class Qe extends M{get(e){return new tt(this,e)}}bt("FeatureIndexArray",Qe);class st extends Ua{}class Rt extends Ua{}class ar extends Ua{}class pt extends gc{}class Gt extends yc{}class Lt extends Qo{}class Dr extends _c{}class ir extends vc{}class Kt extends br{}class lr extends d{}class Kr extends s{}class Rr extends p{}class Cn extends g{}class mn extends N{}const rn=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:xi}=rn;class Br{constructor(e=[]){this.segments=e}prepareSegment(e,n,a,h){let m=this.segments[this.segments.length-1];return e>Br.MAX_VERTEX_ARRAY_LENGTH&&wt(`Max vertices per segment is ${Br.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Br.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,h){return new Br([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function es(r,e){return 256*(r=ce(Math.floor(r),0,255))+ce(Math.floor(e),0,255)}Br.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bt("SegmentVector",Br);const ts=qr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var $s={exports:{}},yo={exports:{}};yo.exports=function(r,e){var n,a,h,m,y,x,T,D;for(a=r.length-(n=3&r.length),h=e,y=3432918353,x=461845907,D=0;D<a;)T=255&r.charCodeAt(D)|(255&r.charCodeAt(++D))<<8|(255&r.charCodeAt(++D))<<16|(255&r.charCodeAt(++D))<<24,++D,h=27492+(65535&(m=5*(65535&(h=(h^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&r.charCodeAt(D+2))<<16;case 2:T^=(255&r.charCodeAt(D+1))<<8;case 1:h^=T=(65535&(T=(T=(65535&(T^=255&r.charCodeAt(D)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295}return h^=r.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var ea=yo.exports,Bn={exports:{}};Bn.exports=function(r,e){for(var n,a=r.length,h=e^a,m=0;a>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:h^=(255&r.charCodeAt(m+2))<<16;case 2:h^=(255&r.charCodeAt(m+1))<<8;case 1:h=1540483477*(65535&(h^=255&r.charCodeAt(m)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var Pn=ea,ei=Bn.exports;$s.exports=Pn,$s.exports.murmur3=Pn,$s.exports.murmur2=ei;var _o=A($s.exports);class Qr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,a,h){this.ids.push(gn(e)),this.positions.push(n,a,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=gn(e);let a=0,h=this.ids.length-1;for(;a<h;){const y=a+h>>1;this.ids[y]>=n?h=y:a=y+1}const m=[];for(;this.ids[a]===n;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(e,n){const a=new Float64Array(e.ids),h=new Uint32Array(e.positions);return pi(a,h,0,a.length-1),n&&n.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(e){const n=new Qr;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function gn(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:_o(String(r))}function pi(r,e,n,a){for(;n<a;){const h=r[n+a>>1];let m=n-1,y=a+1;for(;;){do m++;while(r[m]<h);do y--;while(r[y]>h);if(m>=y)break;en(r,m,y),en(e,3*m,3*y),en(e,3*m+1,3*y+1),en(e,3*m+2,3*y+2)}y-n<a-y?(pi(r,e,n,y),n=y+1):(pi(r,e,y+1,a),a=y)}}function en(r,e,n){const a=r[e];r[e]=r[n],r[n]=a}bt("FeaturePositionMap",Qr);class vo{constructor(e,n){this.gl=e.gl,this.location=n}}class Sl extends vo{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ju extends vo{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class qu extends vo{constructor(e,n){super(e,n),this.current=xr.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const up=new Float32Array(16);function xc(r){return[es(255*r.r,255*r.g),es(255*r.b,255*r.a)]}class rs{constructor(e,n,a){this.value=e,this.uniformNames=n.map(h=>`u_${h}`),this.type=a}setUniform(e,n,a){e.set(a.constantOr(this.value))}getBinding(e,n,a){return this.type==="color"?new qu(e,n):new Sl(e,n)}}class xo{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,a,h){const m=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,n,a){return a.substr(0,9)==="u_pattern"?new ju(e,n):new Sl(e,n)}}class ns{constructor(e,n,a,h){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,a,h,m){const y=this.paintVertexArray.length,x=this.expression.evaluate(new zr(0),n,{},h,[],m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)}updatePaintArray(e,n,a,h){const m=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(e,n,m)}_setPaintValue(e,n,a){if(this.type==="color"){const h=xc(a);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pi{constructor(e,n,a,h,m,y){this.expression=e,this.uniformNames=n.map(x=>`u_${x}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(x=>({name:`a_${x}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,n,a,h,m){const y=this.expression.evaluate(new zr(this.zoom),n,{},h,[],m),x=this.expression.evaluate(new zr(this.zoom+1),n,{},h,[],m),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,x)}updatePaintArray(e,n,a,h){const m=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(e,n,m,y)}_setPaintValue(e,n,a,h){if(this.type==="color"){const m=xc(a),y=xc(h);for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,m[0],m[1],y[0],y[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=ce(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,n,a){return new Sl(e,n)}}class is{constructor(e,n,a,h,m,y){this.expression=e,this.type=n,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,n,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,h,m){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,n,a,h){if(!h||!a)return;const{min:m,mid:y,max:x}=a,T=h[m],D=h[y],k=h[x];if(T&&D&&k)for(let F=e;F<n;F++)this.zoomInPaintVertexArray.emplace(F,D.tl[0],D.tl[1],D.br[0],D.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],D.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,D.tl[0],D.tl[1],D.br[0],D.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],D.pixelRatio,k.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,ts.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,ts.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class bc{constructor(e,n,a){this.binders={},this._buffers=[];const h=[];for(const m in e.paint._values){if(!a(m))continue;const y=e.paint.get(m);if(!(y instanceof Qn&&bs(y.property.specification)))continue;const x=G0(m,e.type),T=y.value,D=y.property.specification.type,k=y.property.useIntegerZoom,F=y.property.specification["property-type"],U=F==="cross-faded"||F==="cross-faded-data-driven";if(T.kind==="constant")this.binders[m]=U?new xo(T.value,x):new rs(T.value,x,D),h.push(`/u_${m}`);else if(T.kind==="source"||U){const G=sm(m,D,"source");this.binders[m]=U?new is(T,D,k,n,G,e.id):new ns(T,x,D,G),h.push(`/a_${m}`)}else{const G=sm(m,D,"composite");this.binders[m]=new Pi(T,x,D,k,n,G),h.push(`/z_${m}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ns||n instanceof Pi?n.maxValue:0}populatePaintArrays(e,n,a,h,m){for(const y in this.binders){const x=this.binders[y];(x instanceof ns||x instanceof Pi||x instanceof is)&&x.populatePaintArray(e,n,a,h,m)}}setConstantPatternPositions(e,n){for(const a in this.binders){const h=this.binders[a];h instanceof xo&&h.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,a,h,m){let y=!1;for(const x in e){const T=n.getPositions(x);for(const D of T){const k=a.feature(D.index);for(const F in this.binders){const U=this.binders[F];if((U instanceof ns||U instanceof Pi||U instanceof is)&&U.expression.isStateDependent===!0){const G=h.paint.get(F);U.expression=G.value,U.updatePaintArray(D.start,D.end,k,e[x],m),y=!0}}}}return y}defines(){const e=[];for(const n in this.binders){const a=this.binders[n];(a instanceof rs||a instanceof xo)&&e.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof ns||a instanceof Pi)for(let h=0;h<a.paintVertexAttributes.length;h++)e.push(a.paintVertexAttributes[h].name);else if(a instanceof is)for(let h=0;h<ts.members.length;h++)e.push(ts.members[h].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof rs||a instanceof xo||a instanceof Pi)for(const h of a.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const a=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof rs||m instanceof xo||m instanceof Pi){for(const y of m.uniformNames)if(n[y]){const x=m.getBinding(e,n[y],y);a.push({name:y,property:h,binding:x})}}}return a}setUniforms(e,n,a,h){for(const{name:m,property:y,binding:x}of n)this.binders[y].setUniform(x,h,a.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const a=this.binders[n];if(e&&a instanceof is){const h=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof ns||a instanceof Pi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const n in this.binders){const a=this.binders[n];(a instanceof ns||a instanceof Pi||a instanceof is)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ns||n instanceof Pi||n instanceof is)&&n.destroy()}}}class Ss{constructor(e,n,a=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new bc(h,n,a);this.needsUpload=!1,this._featureMap=new Qr,this._bufferOffset=0}populatePaintArrays(e,n,a,h,m,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,h,m,y);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,h){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function G0(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function sm(r,e,n){const a={color:{source:Qo,composite:re},number:{source:S,composite:Qo}},h=function(m){return{"line-pattern":{source:Dr,composite:Dr},"fill-pattern":{source:Dr,composite:Dr},"fill-extrusion-pattern":{source:Dr,composite:Dr}}[m]}(r);return h&&h[n]||a[e][n]}bt("ConstantBinder",rs),bt("CrossFadedConstantBinder",xo),bt("SourceExpressionBinder",ns),bt("CrossFadedCompositeBinder",is),bt("CompositeExpressionBinder",Pi),bt("ProgramConfiguration",bc,{omit:["_buffers"]}),bt("ProgramConfigurationSet",Ss);const an=8192,hp=Math.pow(2,14)-1,om=-hp-1;function Va(r){const e=an/r.extent,n=r.loadGeometry();for(let a=0;a<n.length;a++){const h=n[a];for(let m=0;m<h.length;m++){const y=h[m],x=Math.round(y.x*e),T=Math.round(y.y*e);y.x=ce(x,om,hp),y.y=ce(T,om,hp),(x<y.x||x>y.x+1||T<y.y||T>y.y+1)&&wt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ja(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Va(r):[]}}function Gu(r,e,n,a,h){r.emplaceBack(2*e+(a+1)/2,2*n+(h+1)/2)}class pp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Rt,this.indexArray=new Cn,this.segments=new Br,this.programConfigurations=new Ss(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a){const h=this.layers[0],m=[];let y=null,x=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),x=!y.isConstant());for(const{feature:T,id:D,index:k,sourceLayerIndex:F}of e){const U=this.layers[0]._featureFilter.needGeometry,G=ja(T,U);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),G,a))continue;const W=x?y.evaluate(G,{},a):void 0,ee={id:D,properties:T.properties,type:T.type,sourceLayerIndex:F,index:k,geometry:U?G.geometry:Va(T),patterns:{},sortKey:W};m.push(ee)}x&&m.sort((T,D)=>T.sortKey-D.sortKey);for(const T of m){const{geometry:D,index:k,sourceLayerIndex:F}=T,U=e[k].feature;this.addFeature(T,D,k,a),n.featureIndex.insert(U,D,k,F,this.index)}}update(e,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xi),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,h){for(const m of n)for(const y of m){const x=y.x,T=y.y;if(x<0||x>=an||T<0||T>=an)continue;const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=D.vertexLength;Gu(this.layoutVertexArray,x,T,-1,-1),Gu(this.layoutVertexArray,x,T,1,-1),Gu(this.layoutVertexArray,x,T,1,1),Gu(this.layoutVertexArray,x,T,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},h)}}function am(r,e){for(let n=0;n<r.length;n++)if(Il(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Il(r,e[n]))return!0;return!!dp(r,e)}function Z0(r,e,n){return!!Il(r,e)||!!fp(e,r,n)}function lm(r,e){if(r.length===1)return um(e,r[0]);for(let n=0;n<e.length;n++){const a=e[n];for(let h=0;h<a.length;h++)if(Il(r,a[h]))return!0}for(let n=0;n<r.length;n++)if(um(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(dp(r,e[n]))return!0;return!1}function H0(r,e,n){if(r.length>1){if(dp(r,e))return!0;for(let a=0;a<e.length;a++)if(fp(e[a],r,n))return!0}for(let a=0;a<r.length;a++)if(fp(r[a],e,n))return!0;return!1}function dp(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const a=r[n],h=r[n+1];for(let m=0;m<e.length-1;m++)if(W0(a,h,e[m],e[m+1]))return!0}return!1}function W0(r,e,n,a){return Et(r,n,a)!==Et(e,n,a)&&Et(r,e,n)!==Et(r,e,a)}function fp(r,e,n){const a=n*n;if(e.length===1)return r.distSqr(e[0])<a;for(let h=1;h<e.length;h++)if(cm(r,e[h-1],e[h])<a)return!0;return!1}function cm(r,e,n){const a=e.distSqr(n);if(a===0)return r.distSqr(e);const h=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/a;return r.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function um(r,e){let n,a,h,m=!1;for(let y=0;y<r.length;y++){n=r[y];for(let x=0,T=n.length-1;x<n.length;T=x++)a=n[x],h=n[T],a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(m=!m)}return m}function Il(r,e){let n=!1;for(let a=0,h=r.length-1;a<r.length;h=a++){const m=r[a],y=r[h];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(n=!n)}return n}function X0(r,e,n){const a=n[0],h=n[2];if(r.x<a.x&&e.x<a.x||r.x>h.x&&e.x>h.x||r.y<a.y&&e.y<a.y||r.y>h.y&&e.y>h.y)return!1;const m=Et(r,e,n[0]);return m!==Et(r,e,n[1])||m!==Et(r,e,n[2])||m!==Et(r,e,n[3])}function wc(r,e,n){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(r)}function Zu(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Hu(r,e,n,a,h){if(!e[0]&&!e[1])return r;const m=P.convert(e)._mult(h);n==="viewport"&&m._rotate(-a);const y=[];for(let x=0;x<r.length;x++)y.push(r[x].sub(m));return y}let hm,pm;bt("CircleBucket",pp,{omit:["layers"]});var Y0={get paint(){return pm=pm||new tn({"circle-radius":new qt($e.paint_circle["circle-radius"]),"circle-color":new qt($e.paint_circle["circle-color"]),"circle-blur":new qt($e.paint_circle["circle-blur"]),"circle-opacity":new qt($e.paint_circle["circle-opacity"]),"circle-translate":new Bt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Bt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qt($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qt($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qt($e.paint_circle["circle-stroke-opacity"])})},get layout(){return hm=hm||new tn({"circle-sort-key":new qt($e.layout_circle["circle-sort-key"])})}},di=1e-6,Al=typeof Float32Array<"u"?Float32Array:Array;function mp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function dm(r,e,n){var a=e[0],h=e[1],m=e[2],y=e[3],x=e[4],T=e[5],D=e[6],k=e[7],F=e[8],U=e[9],G=e[10],W=e[11],ee=e[12],ue=e[13],ge=e[14],Ce=e[15],be=n[0],ke=n[1],Le=n[2],We=n[3];return r[0]=be*a+ke*x+Le*F+We*ee,r[1]=be*h+ke*T+Le*U+We*ue,r[2]=be*m+ke*D+Le*G+We*ge,r[3]=be*y+ke*k+Le*W+We*Ce,r[4]=(be=n[4])*a+(ke=n[5])*x+(Le=n[6])*F+(We=n[7])*ee,r[5]=be*h+ke*T+Le*U+We*ue,r[6]=be*m+ke*D+Le*G+We*ge,r[7]=be*y+ke*k+Le*W+We*Ce,r[8]=(be=n[8])*a+(ke=n[9])*x+(Le=n[10])*F+(We=n[11])*ee,r[9]=be*h+ke*T+Le*U+We*ue,r[10]=be*m+ke*D+Le*G+We*ge,r[11]=be*y+ke*k+Le*W+We*Ce,r[12]=(be=n[12])*a+(ke=n[13])*x+(Le=n[14])*F+(We=n[15])*ee,r[13]=be*h+ke*T+Le*U+We*ue,r[14]=be*m+ke*D+Le*G+We*ge,r[15]=be*y+ke*k+Le*W+We*Ce,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Ec,J0=dm;function Wu(r,e,n){var a=e[0],h=e[1],m=e[2],y=e[3];return r[0]=n[0]*a+n[4]*h+n[8]*m+n[12]*y,r[1]=n[1]*a+n[5]*h+n[9]*m+n[13]*y,r[2]=n[2]*a+n[6]*h+n[10]*m+n[14]*y,r[3]=n[3]*a+n[7]*h+n[11]*m+n[15]*y,r}Ec=new Al(4),Al!=Float32Array&&(Ec[0]=0,Ec[1]=0,Ec[2]=0,Ec[3]=0);class K0 extends Ci{constructor(e){super(e,Y0)}createBucket(e){return new pp(e)}queryRadius(e){const n=e;return wc("circle-radius",this,n)+wc("circle-stroke-width",this,n)+Zu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,a,h,m,y,x,T){const D=Hu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,x),k=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a),F=this.paint.get("circle-pitch-alignment")==="map",U=F?D:function(W,ee){return W.map(ue=>fm(ue,ee))}(D,T),G=F?k*x:k;for(const W of h)for(const ee of W){const ue=F?ee:fm(ee,T);let ge=G;const Ce=Wu([],[ee.x,ee.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ge*=Ce[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ge*=y.cameraToCenterDistance/Ce[3]),Z0(U,ue,ge))return!0}return!1}}function fm(r,e){const n=Wu([],[r.x,r.y,0,1],e);return new P(n[0]/n[3],n[1]/n[3])}class mm extends pp{}let gm;bt("HeatmapBucket",mm,{omit:["layers"]});var Q0={get paint(){return gm=gm||new tn({"heatmap-radius":new qt($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qt($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fc($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bt($e.paint_heatmap["heatmap-opacity"])})}};function gp(r,{width:e,height:n},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*n*a}`)}else h=new Uint8Array(e*n*a);return r.width=e,r.height=n,r.data=h,r}function ym(r,{width:e,height:n},a){if(e===r.width&&n===r.height)return;const h=gp({},{width:e,height:n},a);yp(r,h,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,n)},a),r.width=e,r.height=n,r.data=h.data}function yp(r,e,n,a,h,m){if(h.width===0||h.height===0)return e;if(h.width>r.width||h.height>r.height||n.x>r.width-h.width||n.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||a.x>e.width-h.width||a.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,x=e.data;if(y===x)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<h.height;T++){const D=((n.y+T)*r.width+n.x)*m,k=((a.y+T)*e.width+a.x)*m;for(let F=0;F<h.width*m;F++)x[k+F]=y[D+F]}return e}class Tc{constructor(e,n){gp(this,e,1,n)}resize(e){ym(this,e,1)}clone(){return new Tc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,h,m){yp(e,n,a,h,m,1)}}class Bi{constructor(e,n){gp(this,e,4,n)}resize(e){ym(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Bi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,h,m){yp(e,n,a,h,m,4)}}function _m(r){const e={},n=r.resolution||256,a=r.clips?r.clips.length:1,h=r.image||new Bi({width:n,height:a});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(y,x,T)=>{e[r.evaluationKey]=T;const D=r.expression.evaluate(e);h.data[y+x+0]=Math.floor(255*D.r/D.a),h.data[y+x+1]=Math.floor(255*D.g/D.a),h.data[y+x+2]=Math.floor(255*D.b/D.a),h.data[y+x+3]=Math.floor(255*D.a)};if(r.clips)for(let y=0,x=0;y<a;++y,x+=4*n)for(let T=0,D=0;T<n;T++,D+=4){const k=T/(n-1),{start:F,end:U}=r.clips[y];m(x,D,F*(1-k)+U*k)}else for(let y=0,x=0;y<n;y++,x+=4)m(0,x,y/(n-1));return h}bt("AlphaImage",Tc),bt("RGBAImage",Bi);class ex extends Ci{createBucket(e){return new mm(e)}constructor(e){super(e,Q0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_m({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let vm;var tx={get paint(){return vm=vm||new tn({"hillshade-illumination-direction":new Bt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Bt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bt($e.paint_hillshade["hillshade-accent-color"])})}};class rx extends Ci{constructor(e){super(e,tx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const nx=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ix}=nx;var _p={exports:{}};function Xu(r,e,n){n=n||2;var a,h,m,y,x,T,D,k=e&&e.length,F=k?e[0]*n:r.length,U=xm(r,0,F,n,!0),G=[];if(!U||U.next===U.prev)return G;if(k&&(U=function(ee,ue,ge,Ce){var be,ke,Le,We=[];for(be=0,ke=ue.length;be<ke;be++)(Le=xm(ee,ue[be]*Ce,be<ke-1?ue[be+1]*Ce:ee.length,Ce,!1))===Le.next&&(Le.steiner=!0),We.push(px(Le));for(We.sort(cx),be=0;be<We.length;be++)ge=ux(We[be],ge);return ge}(r,e,U,n)),r.length>80*n){a=m=r[0],h=y=r[1];for(var W=n;W<F;W+=n)(x=r[W])<a&&(a=x),(T=r[W+1])<h&&(h=T),x>m&&(m=x),T>y&&(y=T);D=(D=Math.max(m-a,y-h))!==0?32767/D:0}return Sc(U,G,n,a,h,D,0),G}function xm(r,e,n,a,h){var m,y;if(h===bp(r,e,n,a)>0)for(m=e;m<n;m+=a)y=Em(m,r[m],r[m+1],y);else for(m=n-a;m>=e;m-=a)y=Em(m,r[m],r[m+1],y);return y&&Yu(y,y.next)&&(Ac(y),y=y.next),y}function qa(r,e){if(!r)return r;e||(e=r);var n,a=r;do if(n=!1,a.steiner||!Yu(a,a.next)&&nn(a.prev,a,a.next)!==0)a=a.next;else{if(Ac(a),(a=e=a.prev)===a.next)break;n=!0}while(n||a!==e);return e}function Sc(r,e,n,a,h,m,y){if(r){!y&&m&&function(k,F,U,G){var W=k;do W.z===0&&(W.z=vp(W.x,W.y,F,U,G)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==k);W.prevZ.nextZ=null,W.prevZ=null,function(ee){var ue,ge,Ce,be,ke,Le,We,xt,Nt=1;do{for(ge=ee,ee=null,ke=null,Le=0;ge;){for(Le++,Ce=ge,We=0,ue=0;ue<Nt&&(We++,Ce=Ce.nextZ);ue++);for(xt=Nt;We>0||xt>0&&Ce;)We!==0&&(xt===0||!Ce||ge.z<=Ce.z)?(be=ge,ge=ge.nextZ,We--):(be=Ce,Ce=Ce.nextZ,xt--),ke?ke.nextZ=be:ee=be,be.prevZ=ke,ke=be;ge=Ce}ke.nextZ=null,Nt*=2}while(Le>1)}(W)}(r,a,h,m);for(var x,T,D=r;r.prev!==r.next;)if(x=r.prev,T=r.next,m?ox(r,a,h,m):sx(r))e.push(x.i/n|0),e.push(r.i/n|0),e.push(T.i/n|0),Ac(r),r=T.next,D=T.next;else if((r=T)===D){y?y===1?Sc(r=ax(qa(r),e,n),e,n,a,h,m,2):y===2&&lx(r,e,n,a,h,m):Sc(qa(r),e,n,a,h,m,1);break}}}function sx(r){var e=r.prev,n=r,a=r.next;if(nn(e,n,a)>=0)return!1;for(var h=e.x,m=n.x,y=a.x,x=e.y,T=n.y,D=a.y,k=h<m?h<y?h:y:m<y?m:y,F=x<T?x<D?x:D:T<D?T:D,U=h>m?h>y?h:y:m>y?m:y,G=x>T?x>D?x:D:T>D?T:D,W=a.next;W!==e;){if(W.x>=k&&W.x<=U&&W.y>=F&&W.y<=G&&Dl(h,x,m,T,y,D,W.x,W.y)&&nn(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function ox(r,e,n,a){var h=r.prev,m=r,y=r.next;if(nn(h,m,y)>=0)return!1;for(var x=h.x,T=m.x,D=y.x,k=h.y,F=m.y,U=y.y,G=x<T?x<D?x:D:T<D?T:D,W=k<F?k<U?k:U:F<U?F:U,ee=x>T?x>D?x:D:T>D?T:D,ue=k>F?k>U?k:U:F>U?F:U,ge=vp(G,W,e,n,a),Ce=vp(ee,ue,e,n,a),be=r.prevZ,ke=r.nextZ;be&&be.z>=ge&&ke&&ke.z<=Ce;){if(be.x>=G&&be.x<=ee&&be.y>=W&&be.y<=ue&&be!==h&&be!==y&&Dl(x,k,T,F,D,U,be.x,be.y)&&nn(be.prev,be,be.next)>=0||(be=be.prevZ,ke.x>=G&&ke.x<=ee&&ke.y>=W&&ke.y<=ue&&ke!==h&&ke!==y&&Dl(x,k,T,F,D,U,ke.x,ke.y)&&nn(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;be&&be.z>=ge;){if(be.x>=G&&be.x<=ee&&be.y>=W&&be.y<=ue&&be!==h&&be!==y&&Dl(x,k,T,F,D,U,be.x,be.y)&&nn(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;ke&&ke.z<=Ce;){if(ke.x>=G&&ke.x<=ee&&ke.y>=W&&ke.y<=ue&&ke!==h&&ke!==y&&Dl(x,k,T,F,D,U,ke.x,ke.y)&&nn(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function ax(r,e,n){var a=r;do{var h=a.prev,m=a.next.next;!Yu(h,m)&&bm(h,a,a.next,m)&&Ic(h,m)&&Ic(m,h)&&(e.push(h.i/n|0),e.push(a.i/n|0),e.push(m.i/n|0),Ac(a),Ac(a.next),a=r=m),a=a.next}while(a!==r);return qa(a)}function lx(r,e,n,a,h,m){var y=r;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&dx(y,x)){var T=wm(y,x);return y=qa(y,y.next),T=qa(T,T.next),Sc(y,e,n,a,h,m,0),void Sc(T,e,n,a,h,m,0)}x=x.next}y=y.next}while(y!==r)}function cx(r,e){return r.x-e.x}function ux(r,e){var n=function(h,m){var y,x=m,T=h.x,D=h.y,k=-1/0;do{if(D<=x.y&&D>=x.next.y&&x.next.y!==x.y){var F=x.x+(D-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(F<=T&&F>k&&(k=F,y=x.x<x.next.x?x:x.next,F===T))return y}x=x.next}while(x!==m);if(!y)return null;var U,G=y,W=y.x,ee=y.y,ue=1/0;x=y;do T>=x.x&&x.x>=W&&T!==x.x&&Dl(D<ee?T:k,D,W,ee,D<ee?k:T,D,x.x,x.y)&&(U=Math.abs(D-x.y)/(T-x.x),Ic(x,h)&&(U<ue||U===ue&&(x.x>y.x||x.x===y.x&&hx(y,x)))&&(y=x,ue=U)),x=x.next;while(x!==G);return y}(r,e);if(!n)return e;var a=wm(n,r);return qa(a,a.next),qa(n,n.next)}function hx(r,e){return nn(r.prev,r,e.prev)<0&&nn(e.next,r,r.next)<0}function vp(r,e,n,a,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function px(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function Dl(r,e,n,a,h,m,y,x){return(h-y)*(e-x)>=(r-y)*(m-x)&&(r-y)*(a-x)>=(n-y)*(e-x)&&(n-y)*(m-x)>=(h-y)*(a-x)}function dx(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,a){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==a.i&&h.next.i!==a.i&&bm(h,h.next,n,a))return!0;h=h.next}while(h!==n);return!1}(r,e)&&(Ic(r,e)&&Ic(e,r)&&function(n,a){var h=n,m=!1,y=(n.x+a.x)/2,x=(n.y+a.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&y<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==n);return m}(r,e)&&(nn(r.prev,r,e.prev)||nn(r,e.prev,e))||Yu(r,e)&&nn(r.prev,r,r.next)>0&&nn(e.prev,e,e.next)>0)}function nn(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function Yu(r,e){return r.x===e.x&&r.y===e.y}function bm(r,e,n,a){var h=Ku(nn(r,e,n)),m=Ku(nn(r,e,a)),y=Ku(nn(n,a,r)),x=Ku(nn(n,a,e));return h!==m&&y!==x||!(h!==0||!Ju(r,n,e))||!(m!==0||!Ju(r,a,e))||!(y!==0||!Ju(n,r,a))||!(x!==0||!Ju(n,e,a))}function Ju(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function Ku(r){return r>0?1:r<0?-1:0}function Ic(r,e){return nn(r.prev,r,r.next)<0?nn(r,e,r.next)>=0&&nn(r,r.prev,e)>=0:nn(r,e,r.prev)<0||nn(r,r.next,e)<0}function wm(r,e){var n=new xp(r.i,r.x,r.y),a=new xp(e.i,e.x,e.y),h=r.next,m=e.prev;return r.next=e,e.prev=r,n.next=h,h.prev=n,a.next=n,n.prev=a,m.next=a,a.prev=m,a}function Em(r,e,n,a){var h=new xp(r,e,n);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Ac(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function xp(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bp(r,e,n,a){for(var h=0,m=e,y=n-a;m<n;m+=a)h+=(r[y]-r[m])*(r[m+1]+r[y+1]),y=m;return h}_p.exports=Xu,_p.exports.default=Xu,Xu.deviation=function(r,e,n,a){var h=e&&e.length,m=Math.abs(bp(r,0,h?e[0]*n:r.length,n));if(h)for(var y=0,x=e.length;y<x;y++)m-=Math.abs(bp(r,e[y]*n,y<x-1?e[y+1]*n:r.length,n));var T=0;for(y=0;y<a.length;y+=3){var D=a[y]*n,k=a[y+1]*n,F=a[y+2]*n;T+=Math.abs((r[D]-r[F])*(r[k+1]-r[D+1])-(r[D]-r[k])*(r[F+1]-r[D+1]))}return m===0&&T===0?0:Math.abs((T-m)/m)},Xu.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},a=0,h=0;h<r.length;h++){for(var m=0;m<r[h].length;m++)for(var y=0;y<e;y++)n.vertices.push(r[h][m][y]);h>0&&n.holes.push(a+=r[h-1].length)}return n};var Tm=A(_p.exports);function fx(r,e,n,a,h){Sm(r,e,n||0,a||r.length-1,h||mx)}function Sm(r,e,n,a,h){for(;a>n;){if(a-n>600){var m=a-n+1,y=e-n+1,x=Math.log(m),T=.5*Math.exp(2*x/3),D=.5*Math.sqrt(x*T*(m-T)/m)*(y-m/2<0?-1:1);Sm(r,e,Math.max(n,Math.floor(e-y*T/m+D)),Math.min(a,Math.floor(e+(m-y)*T/m+D)),h)}var k=r[e],F=n,U=a;for(Dc(r,n,e),h(r[a],k)>0&&Dc(r,n,a);F<U;){for(Dc(r,F,U),F++,U--;h(r[F],k)<0;)F++;for(;h(r[U],k)>0;)U--}h(r[n],k)===0?Dc(r,n,U):Dc(r,++U,a),U<=e&&(n=U+1),e<=U&&(a=U-1)}}function Dc(r,e,n){var a=r[e];r[e]=r[n],r[n]=a}function mx(r,e){return r<e?-1:r>e?1:0}function wp(r,e){const n=r.length;if(n<=1)return[r];const a=[];let h,m;for(let y=0;y<n;y++){const x=Dt(r[y]);x!==0&&(r[y].area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(h&&a.push(h),h=[r[y]]):h.push(r[y]))}if(h&&a.push(h),e>1)for(let y=0;y<a.length;y++)a[y].length<=e||(fx(a[y],e,1,a[y].length-1,gx),a[y]=a[y].slice(0,e));return a}function gx(r,e){return e.area-r.area}function Ep(r,e,n){const a=n.patternDependencies;let h=!1;for(const m of e){const y=m.paint.get(`${r}-pattern`);y.isConstant()||(h=!0);const x=y.constantOr(null);x&&(h=!0,a[x.to]=!0,a[x.from]=!0)}return h}function Tp(r,e,n,a,h){const m=h.patternDependencies;for(const y of e){const x=y.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:a-1},n,{},h.availableImages),D=x.evaluate({zoom:a},n,{},h.availableImages),k=x.evaluate({zoom:a+1},n,{},h.availableImages);T=T&&T.name?T.name:T,D=D&&D.name?D.name:D,k=k&&k.name?k.name:k,m[T]=!0,m[D]=!0,m[k]=!0,n.patterns[y.id]={min:T,mid:D,max:k}}}return n}class Sp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ar,this.indexArray=new Cn,this.indexArray2=new mn,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new Br,this.segments2=new Br,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a){this.hasPattern=Ep("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),m=!h.isConstant(),y=[];for(const{feature:x,id:T,index:D,sourceLayerIndex:k}of e){const F=this.layers[0]._featureFilter.needGeometry,U=ja(x,F);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),U,a))continue;const G=m?h.evaluate(U,{},a,n.availableImages):void 0,W={id:T,properties:x.properties,type:x.type,sourceLayerIndex:k,index:D,geometry:F?U.geometry:Va(x),patterns:{},sortKey:G};y.push(W)}m&&y.sort((x,T)=>x.sortKey-T.sortKey);for(const x of y){const{geometry:T,index:D,sourceLayerIndex:k}=x;if(this.hasPattern){const F=Tp("fill",this.layers,x,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(x,T,D,a,{});n.featureIndex.insert(e[D].feature,T,D,k,this.index)}}update(e,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a)}addFeatures(e,n,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ix),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,h,m){for(const y of wp(n,500)){let x=0;for(const G of y)x+=G.length;const T=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),D=T.vertexLength,k=[],F=[];for(const G of y){if(G.length===0)continue;G!==y[0]&&F.push(k.length/2);const W=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),ee=W.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(ee+G.length-1,ee),k.push(G[0].x),k.push(G[0].y);for(let ue=1;ue<G.length;ue++)this.layoutVertexArray.emplaceBack(G[ue].x,G[ue].y),this.indexArray2.emplaceBack(ee+ue-1,ee+ue),k.push(G[ue].x),k.push(G[ue].y);W.vertexLength+=G.length,W.primitiveLength+=G.length}const U=Tm(k,F);for(let G=0;G<U.length;G+=3)this.indexArray.emplaceBack(D+U[G],D+U[G+1],D+U[G+2]);T.vertexLength+=x,T.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,h)}}let Im,Am;bt("FillBucket",Sp,{omit:["layers","patternFeatures"]});var yx={get paint(){return Am=Am||new tn({"fill-antialias":new Bt($e.paint_fill["fill-antialias"]),"fill-opacity":new qt($e.paint_fill["fill-opacity"]),"fill-color":new qt($e.paint_fill["fill-color"]),"fill-outline-color":new qt($e.paint_fill["fill-outline-color"]),"fill-translate":new Bt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Bt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ba($e.paint_fill["fill-pattern"])})},get layout(){return Im=Im||new tn({"fill-sort-key":new qt($e.layout_fill["fill-sort-key"])})}};class _x extends Ci{constructor(e){super(e,yx)}recalculate(e,n){super.recalculate(e,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Sp(e)}queryRadius(){return Zu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,a,h,m,y,x){return lm(Hu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,x),h)}isTileClipped(){return!0}}const vx=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xx=qr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:bx}=vx;var ta={},wx=L,Dm=Cl;function Cl(r,e,n,a,h){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=h,r.readFields(Ex,this,e)}function Ex(r,e,n){r==1?e.id=n.readVarint():r==2?function(a,h){for(var m=a.readVarint()+a.pos;a.pos<m;){var y=h._keys[a.readVarint()],x=h._values[a.readVarint()];h.properties[y]=x}}(n,e):r==3?e.type=n.readVarint():r==4&&(e._geometry=n.pos)}function Tx(r){for(var e,n,a=0,h=0,m=r.length,y=m-1;h<m;y=h++)a+=((n=r[y]).x-(e=r[h]).x)*(e.y+n.y);return a}Cl.types=["Unknown","Point","LineString","Polygon"],Cl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,n=r.readVarint()+r.pos,a=1,h=0,m=0,y=0,x=[];r.pos<n;){if(h<=0){var T=r.readVarint();a=7&T,h=T>>3}if(h--,a===1||a===2)m+=r.readSVarint(),y+=r.readSVarint(),a===1&&(e&&x.push(e),e=[]),e.push(new wx(m,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&x.push(e),x},Cl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,n=1,a=0,h=0,m=0,y=1/0,x=-1/0,T=1/0,D=-1/0;r.pos<e;){if(a<=0){var k=r.readVarint();n=7&k,a=k>>3}if(a--,n===1||n===2)(h+=r.readSVarint())<y&&(y=h),h>x&&(x=h),(m+=r.readSVarint())<T&&(T=m),m>D&&(D=m);else if(n!==7)throw new Error("unknown command "+n)}return[y,T,x,D]},Cl.prototype.toGeoJSON=function(r,e,n){var a,h,m=this.extent*Math.pow(2,n),y=this.extent*r,x=this.extent*e,T=this.loadGeometry(),D=Cl.types[this.type];function k(G){for(var W=0;W<G.length;W++){var ee=G[W];G[W]=[360*(ee.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(a=0;a<T.length;a++)F[a]=T[a][0];k(T=F);break;case 2:for(a=0;a<T.length;a++)k(T[a]);break;case 3:for(T=function(G){var W=G.length;if(W<=1)return[G];for(var ee,ue,ge=[],Ce=0;Ce<W;Ce++){var be=Tx(G[Ce]);be!==0&&(ue===void 0&&(ue=be<0),ue===be<0?(ee&&ge.push(ee),ee=[G[Ce]]):ee.push(G[Ce]))}return ee&&ge.push(ee),ge}(T),a=0;a<T.length;a++)for(h=0;h<T[a].length;h++)k(T[a][h])}T.length===1?T=T[0]:D="Multi"+D;var U={type:"Feature",geometry:{type:D,coordinates:T},properties:this.properties};return"id"in this&&(U.id=this.id),U};var Sx=Dm,Cm=Pm;function Pm(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Ix,this,e),this.length=this._features.length}function Ix(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push(function(a){for(var h=null,m=a.readVarint()+a.pos;a.pos<m;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(n))}Pm.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Sx(this._pbf,e,this.extent,this._keys,this._values)};var Ax=Cm;function Dx(r,e,n){if(r===3){var a=new Ax(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}ta.VectorTile=function(r,e){this.layers=r.readFields(Dx,{},e)},ta.VectorTileFeature=Dm,ta.VectorTileLayer=Cm;const Cx=ta.VectorTileFeature.types,Ip=Math.pow(2,13);function Cc(r,e,n,a,h,m,y,x){r.emplaceBack(e,n,2*Math.floor(a*Ip)+y,h*Ip*2,m*Ip*2,Math.round(x))}class Ap{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new pt,this.centroidVertexArray=new st,this.indexArray=new Cn,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new Br,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a){this.features=[],this.hasPattern=Ep("fill-extrusion",this.layers,n);for(const{feature:h,id:m,index:y,sourceLayerIndex:x}of e){const T=this.layers[0]._featureFilter.needGeometry,D=ja(h,T);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),D,a))continue;const k={id:m,sourceLayerIndex:x,index:y,geometry:T?D.geometry:Va(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Tp("fill-extrusion",this.layers,k,this.zoom,n)):this.addFeature(k,k.geometry,y,a,{}),n.featureIndex.insert(h,k.geometry,y,x,this.index,!0)}}addFeatures(e,n,a){for(const h of this.features){const{geometry:m}=h;this.addFeature(h,m,h.index,n,a)}}update(e,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bx),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,xx.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,a,h,m){const y={x:0,y:0,vertexCount:0};for(const x of wp(n,500)){let T=0;for(const W of x)T+=W.length;let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const W of x){if(W.length===0||kx(W))continue;let ee=0;for(let ue=0;ue<W.length;ue++){const ge=W[ue];if(ue>=1){const Ce=W[ue-1];if(!Px(ge,Ce)){D.vertexLength+4>Br.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const be=ge.sub(Ce)._perp()._unit(),ke=Ce.dist(ge);ee+ke>32768&&(ee=0),Cc(this.layoutVertexArray,ge.x,ge.y,be.x,be.y,0,0,ee),Cc(this.layoutVertexArray,ge.x,ge.y,be.x,be.y,0,1,ee),y.x+=2*ge.x,y.y+=2*ge.y,y.vertexCount+=2,ee+=ke,Cc(this.layoutVertexArray,Ce.x,Ce.y,be.x,be.y,0,0,ee),Cc(this.layoutVertexArray,Ce.x,Ce.y,be.x,be.y,0,1,ee),y.x+=2*Ce.x,y.y+=2*Ce.y,y.vertexCount+=2;const Le=D.vertexLength;this.indexArray.emplaceBack(Le,Le+2,Le+1),this.indexArray.emplaceBack(Le+1,Le+2,Le+3),D.vertexLength+=4,D.primitiveLength+=2}}}}if(D.vertexLength+T>Br.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),Cx[e.type]!=="Polygon")continue;const k=[],F=[],U=D.vertexLength;for(const W of x)if(W.length!==0){W!==x[0]&&F.push(k.length/2);for(let ee=0;ee<W.length;ee++){const ue=W[ee];Cc(this.layoutVertexArray,ue.x,ue.y,0,0,1,1,0),y.x+=ue.x,y.y+=ue.y,y.vertexCount+=1,k.push(ue.x),k.push(ue.y)}}const G=Tm(k,F);for(let W=0;W<G.length;W+=3)this.indexArray.emplaceBack(U+G[W],U+G[W+2],U+G[W+1]);D.primitiveLength+=G.length/3,D.vertexLength+=T}for(let x=0;x<y.vertexCount;x++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,h)}}function Px(r,e){return r.x===e.x&&(r.x<0||r.x>an)||r.y===e.y&&(r.y<0||r.y>an)}function kx(r){return r.every(e=>e.x<0)||r.every(e=>e.x>an)||r.every(e=>e.y<0)||r.every(e=>e.y>an)}let km;bt("FillExtrusionBucket",Ap,{omit:["layers","features"]});var Mx={get paint(){return km=km||new tn({"fill-extrusion-opacity":new Bt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qt($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ba($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qt($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qt($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ox extends Ci{constructor(e){super(e,Mx)}createBucket(e){return new Ap(e)}queryRadius(){return Zu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,a,h,m,y,x,T){const D=Hu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,x),k=this.paint.get("fill-extrusion-height").evaluate(n,a),F=this.paint.get("fill-extrusion-base").evaluate(n,a),U=function(W,ee,ue,ge){const Ce=[];for(const be of W){const ke=[be.x,be.y,0,1];Wu(ke,ke,ee),Ce.push(new P(ke[0]/ke[3],ke[1]/ke[3]))}return Ce}(D,T),G=function(W,ee,ue,ge){const Ce=[],be=[],ke=ge[8]*ee,Le=ge[9]*ee,We=ge[10]*ee,xt=ge[11]*ee,Nt=ge[8]*ue,_t=ge[9]*ue,dt=ge[10]*ue,lt=ge[11]*ue;for(const Pt of W){const ut=[],rt=[];for(const $t of Pt){const zt=$t.x,er=$t.y,Ur=ge[0]*zt+ge[4]*er+ge[12],jr=ge[1]*zt+ge[5]*er+ge[13],_n=ge[2]*zt+ge[6]*er+ge[14],ki=ge[3]*zt+ge[7]*er+ge[15],fi=_n+We,ln=ki+xt,kn=Ur+Nt,$n=jr+_t,mi=_n+dt,gi=ki+lt,vn=new P((Ur+ke)/ln,(jr+Le)/ln);vn.z=fi/ln,ut.push(vn);const xn=new P(kn/gi,$n/gi);xn.z=mi/gi,rt.push(xn)}Ce.push(ut),be.push(rt)}return[Ce,be]}(h,F,k,T);return function(W,ee,ue){let ge=1/0;lm(ue,ee)&&(ge=Mm(ue,ee[0]));for(let Ce=0;Ce<ee.length;Ce++){const be=ee[Ce],ke=W[Ce];for(let Le=0;Le<be.length-1;Le++){const We=be[Le],xt=[We,be[Le+1],ke[Le+1],ke[Le],We];am(ue,xt)&&(ge=Math.min(ge,Mm(ue,xt)))}}return ge!==1/0&&ge}(G[0],G[1],U)}}function Pc(r,e){return r.x*e.x+r.y*e.y}function Mm(r,e){if(r.length===1){let n=0;const a=e[n++];let h;for(;!h||a.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const m=e[n],y=r[0],x=h.sub(a),T=m.sub(a),D=y.sub(a),k=Pc(x,x),F=Pc(x,T),U=Pc(T,T),G=Pc(D,x),W=Pc(D,T),ee=k*U-F*F,ue=(U*G-F*W)/ee,ge=(k*W-F*G)/ee,Ce=a.z*(1-ue-ge)+h.z*ue+m.z*ge;if(isFinite(Ce))return Ce}return 1/0}{let n=1/0;for(const a of e)n=Math.min(n,a.z);return n}}const Rx=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Nx}=Rx,Lx=qr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Fx}=Lx,zx=ta.VectorTileFeature.types,Bx=Math.cos(Math.PI/180*37.5),Om=Math.pow(2,14)/.5;class Dp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Gt,this.layoutVertexArray2=new Lt,this.indexArray=new Cn,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new Br,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a){this.hasPattern=Ep("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),m=!h.isConstant(),y=[];for(const{feature:x,id:T,index:D,sourceLayerIndex:k}of e){const F=this.layers[0]._featureFilter.needGeometry,U=ja(x,F);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),U,a))continue;const G=m?h.evaluate(U,{},a):void 0,W={id:T,properties:x.properties,type:x.type,sourceLayerIndex:k,index:D,geometry:F?U.geometry:Va(x),patterns:{},sortKey:G};y.push(W)}m&&y.sort((x,T)=>x.sortKey-T.sortKey);for(const x of y){const{geometry:T,index:D,sourceLayerIndex:k}=x;if(this.hasPattern){const F=Tp("line",this.layers,x,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(x,T,D,a,{});n.featureIndex.insert(e[D].feature,T,D,k,this.index)}}update(e,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,a)}addFeatures(e,n,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Fx)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,h,m){const y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),T=y.get("line-cap"),D=y.get("line-miter-limit"),k=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of n)this.addLine(F,e,x,T,D,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,h)}addLine(e,n,a,h,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ge=0;ge<e.length-1;ge++)this.totalDistance+=e[ge].dist(e[ge+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=zx[n.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let D=0;for(;D<T-1&&e[D].equals(e[D+1]);)D++;if(T<(x?3:2))return;a==="bevel"&&(m=1.05);const k=this.overscaling<=16?15*an/(512*this.overscaling):0,F=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let U,G,W,ee,ue;this.e1=this.e2=-1,x&&(U=e[T-2],ue=e[D].sub(U)._unit()._perp());for(let ge=D;ge<T;ge++){if(W=ge===T-1?x?e[D+1]:void 0:e[ge+1],W&&e[ge].equals(W))continue;ue&&(ee=ue),U&&(G=U),U=e[ge],ue=W?W.sub(U)._unit()._perp():ee,ee=ee||ue;let Ce=ee.add(ue);Ce.x===0&&Ce.y===0||Ce._unit();const be=ee.x*ue.x+ee.y*ue.y,ke=Ce.x*ue.x+Ce.y*ue.y,Le=ke!==0?1/ke:1/0,We=2*Math.sqrt(2-2*ke),xt=ke<Bx&&G&&W,Nt=ee.x*ue.y-ee.y*ue.x>0;if(xt&&ge>D){const lt=U.dist(G);if(lt>2*k){const Pt=U.sub(U.sub(G)._mult(k/lt)._round());this.updateDistance(G,Pt),this.addCurrentVertex(Pt,ee,0,0,F),G=Pt}}const _t=G&&W;let dt=_t?a:x?"butt":h;if(_t&&dt==="round"&&(Le<y?dt="miter":Le<=2&&(dt="fakeround")),dt==="miter"&&Le>m&&(dt="bevel"),dt==="bevel"&&(Le>2&&(dt="flipbevel"),Le<m&&(dt="miter")),G&&this.updateDistance(G,U),dt==="miter")Ce._mult(Le),this.addCurrentVertex(U,Ce,0,0,F);else if(dt==="flipbevel"){if(Le>100)Ce=ue.mult(-1);else{const lt=Le*ee.add(ue).mag()/ee.sub(ue).mag();Ce._perp()._mult(lt*(Nt?-1:1))}this.addCurrentVertex(U,Ce,0,0,F),this.addCurrentVertex(U,Ce.mult(-1),0,0,F)}else if(dt==="bevel"||dt==="fakeround"){const lt=-Math.sqrt(Le*Le-1),Pt=Nt?lt:0,ut=Nt?0:lt;if(G&&this.addCurrentVertex(U,ee,Pt,ut,F),dt==="fakeround"){const rt=Math.round(180*We/Math.PI/20);for(let $t=1;$t<rt;$t++){let zt=$t/rt;if(zt!==.5){const Ur=zt-.5;zt+=zt*Ur*(zt-1)*((1.0904+be*(be*(3.55645-1.43519*be)-3.2452))*Ur*Ur+(.848013+be*(.215638*be-1.06021)))}const er=ue.sub(ee)._mult(zt)._add(ee)._unit()._mult(Nt?-1:1);this.addHalfVertex(U,er.x,er.y,!1,Nt,0,F)}}W&&this.addCurrentVertex(U,ue,-Pt,-ut,F)}else if(dt==="butt")this.addCurrentVertex(U,Ce,0,0,F);else if(dt==="square"){const lt=G?1:-1;this.addCurrentVertex(U,Ce,lt,lt,F)}else dt==="round"&&(G&&(this.addCurrentVertex(U,ee,0,0,F),this.addCurrentVertex(U,ee,1,1,F,!0)),W&&(this.addCurrentVertex(U,ue,-1,-1,F,!0),this.addCurrentVertex(U,ue,0,0,F)));if(xt&&ge<T-1){const lt=U.dist(W);if(lt>2*k){const Pt=U.add(W.sub(U)._mult(k/lt)._round());this.updateDistance(U,Pt),this.addCurrentVertex(Pt,ue,0,0,F),U=Pt}}}}addCurrentVertex(e,n,a,h,m,y=!1){const x=n.y*h-n.x,T=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*a,n.y-n.x*a,y,!1,a,m),this.addHalfVertex(e,x,T,y,!0,-h,m),this.distance>Om/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,a,h,m,y))}addHalfVertex({x:e,y:n},a,h,m,y,x,T){const D=.5*(this.lineClips?this.scaledDistance*(Om-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),T.primitiveLength++),y?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let Rm,Nm;bt("LineBucket",Dp,{omit:["layers","patternFeatures"]});var Lm={get paint(){return Nm=Nm||new tn({"line-opacity":new qt($e.paint_line["line-opacity"]),"line-color":new qt($e.paint_line["line-color"]),"line-translate":new Bt($e.paint_line["line-translate"]),"line-translate-anchor":new Bt($e.paint_line["line-translate-anchor"]),"line-width":new qt($e.paint_line["line-width"]),"line-gap-width":new qt($e.paint_line["line-gap-width"]),"line-offset":new qt($e.paint_line["line-offset"]),"line-blur":new qt($e.paint_line["line-blur"]),"line-dasharray":new dc($e.paint_line["line-dasharray"]),"line-pattern":new Ba($e.paint_line["line-pattern"]),"line-gradient":new fc($e.paint_line["line-gradient"])})},get layout(){return Rm=Rm||new tn({"line-cap":new Bt($e.layout_line["line-cap"]),"line-join":new qt($e.layout_line["line-join"]),"line-miter-limit":new Bt($e.layout_line["line-miter-limit"]),"line-round-limit":new Bt($e.layout_line["line-round-limit"]),"line-sort-key":new qt($e.layout_line["line-sort-key"])})}};class Ux extends qt{possiblyEvaluate(e,n){return n=new zr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,a,h){return n=Me({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,a,h)}}let Qu;class $x extends Ci{constructor(e){super(e,Lm),this.gradientVersion=0,Qu||(Qu=new Ux(Lm.paint.properties["line-width"].specification),Qu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Li,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Qu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Dp(e)}queryRadius(e){const n=e,a=Fm(wc("line-width",this,n),wc("line-gap-width",this,n)),h=wc("line-offset",this,n);return a/2+Math.abs(h)+Zu(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,a,h,m,y,x){const T=Hu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,x),D=x/2*Fm(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),k=this.paint.get("line-offset").evaluate(n,a);return k&&(h=function(F,U){const G=[];for(let W=0;W<F.length;W++){const ee=F[W],ue=[];for(let ge=0;ge<ee.length;ge++){const Ce=ee[ge-1],be=ee[ge],ke=ee[ge+1],Le=ge===0?new P(0,0):be.sub(Ce)._unit()._perp(),We=ge===ee.length-1?new P(0,0):ke.sub(be)._unit()._perp(),xt=Le._add(We)._unit(),Nt=xt.x*We.x+xt.y*We.y;Nt!==0&&xt._mult(1/Nt),ue.push(xt._mult(U)._add(be))}G.push(ue)}return G}(h,k*x)),function(F,U,G){for(let W=0;W<U.length;W++){const ee=U[W];if(F.length>=3){for(let ue=0;ue<ee.length;ue++)if(Il(F,ee[ue]))return!0}if(H0(F,ee,G))return!0}return!1}(T,h,D)}isTileClipped(){return!0}}function Fm(r,e){return e>0?e+2*r:r}const Vx=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jx=qr([{name:"a_projected_pos",components:3,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qx=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zm=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gx=qr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Zx(r,e,n){return r.sections.forEach(a=>{a.text=function(h,m,y){const x=m.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),vi.applyArabicShaping&&(h=vi.applyArabicShaping(h)),h}(a.text,e,n)}),r}qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const kc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var yn=24,Bm=Cr,Um=function(r,e,n,a,h){var m,y,x=8*h-a-1,T=(1<<x)-1,D=T>>1,k=-7,F=n?h-1:0,U=n?-1:1,G=r[e+F];for(F+=U,m=G&(1<<-k)-1,G>>=-k,k+=x;k>0;m=256*m+r[e+F],F+=U,k-=8);for(y=m&(1<<-k)-1,m>>=-k,k+=a;k>0;y=256*y+r[e+F],F+=U,k-=8);if(m===0)m=1-D;else{if(m===T)return y?NaN:1/0*(G?-1:1);y+=Math.pow(2,a),m-=D}return(G?-1:1)*y*Math.pow(2,m-a)},$m=function(r,e,n,a,h,m){var y,x,T,D=8*m-h-1,k=(1<<D)-1,F=k>>1,U=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=a?0:m-1,W=a?1:-1,ee=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,y=k):(y=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-y))<1&&(y--,T*=2),(e+=y+F>=1?U/T:U*Math.pow(2,1-F))*T>=2&&(y++,T/=2),y+F>=k?(x=0,y=k):y+F>=1?(x=(e*T-1)*Math.pow(2,h),y+=F):(x=e*Math.pow(2,F-1)*Math.pow(2,h),y=0));h>=8;r[n+G]=255&x,G+=W,x/=256,h-=8);for(y=y<<h|x,D+=h;D>0;r[n+G]=255&y,G+=W,y/=256,D-=8);r[n+G-W]|=128*ee};function Cr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Cr.Varint=0,Cr.Fixed64=1,Cr.Bytes=2,Cr.Fixed32=5;var Cp=4294967296,Vm=1/Cp,jm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function bo(r){return r.type===Cr.Bytes?r.readVarint()+r.pos:r.pos+1}function Pl(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function qm(r,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var h=n.pos-1;h>=r;h--)n.buf[h+a]=n.buf[h]}function Hx(r,e){for(var n=0;n<r.length;n++)e.writeVarint(r[n])}function Wx(r,e){for(var n=0;n<r.length;n++)e.writeSVarint(r[n])}function Xx(r,e){for(var n=0;n<r.length;n++)e.writeFloat(r[n])}function Yx(r,e){for(var n=0;n<r.length;n++)e.writeDouble(r[n])}function Jx(r,e){for(var n=0;n<r.length;n++)e.writeBoolean(r[n])}function Kx(r,e){for(var n=0;n<r.length;n++)e.writeFixed32(r[n])}function Qx(r,e){for(var n=0;n<r.length;n++)e.writeSFixed32(r[n])}function eb(r,e){for(var n=0;n<r.length;n++)e.writeFixed64(r[n])}function tb(r,e){for(var n=0;n<r.length;n++)e.writeSFixed64(r[n])}function eh(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function kl(r,e,n){r[n]=e,r[n+1]=e>>>8,r[n+2]=e>>>16,r[n+3]=e>>>24}function Gm(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Cr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),h=a>>3,m=this.pos;this.type=7&a,r(h,e,this),this.pos===m&&this.skip(a)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=eh(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Gm(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=eh(this.buf,this.pos)+eh(this.buf,this.pos+4)*Cp;return this.pos+=8,r},readSFixed64:function(){var r=eh(this.buf,this.pos)+Gm(this.buf,this.pos+4)*Cp;return this.pos+=8,r},readFloat:function(){var r=Um(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Um(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(h,m,y){var x,T,D=y.buf;if(x=(112&(T=D[y.pos++]))>>4,T<128||(x|=(127&(T=D[y.pos++]))<<3,T<128)||(x|=(127&(T=D[y.pos++]))<<10,T<128)||(x|=(127&(T=D[y.pos++]))<<17,T<128)||(x|=(127&(T=D[y.pos++]))<<24,T<128)||(x|=(1&(T=D[y.pos++]))<<31,T<128))return Pl(h,x,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&jm?function(n,a,h){return jm.decode(n.subarray(a,h))}(this.buf,e,r):function(n,a,h){for(var m="",y=a;y<h;){var x,T,D,k=n[y],F=null,U=k>239?4:k>223?3:k>191?2:1;if(y+U>h)break;U===1?k<128&&(F=k):U===2?(192&(x=n[y+1]))==128&&(F=(31&k)<<6|63&x)<=127&&(F=null):U===3?(T=n[y+2],(192&(x=n[y+1]))==128&&(192&T)==128&&((F=(15&k)<<12|(63&x)<<6|63&T)<=2047||F>=55296&&F<=57343)&&(F=null)):U===4&&(T=n[y+2],D=n[y+3],(192&(x=n[y+1]))==128&&(192&T)==128&&(192&D)==128&&((F=(15&k)<<18|(63&x)<<12|(63&T)<<6|63&D)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,U=1):F>65535&&(F-=65536,m+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),m+=String.fromCharCode(F),y+=U}return m}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Cr.Bytes)return r.push(this.readVarint(e));var n=bo(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Cr.Bytes)return r.push(this.readSVarint());var e=bo(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Cr.Bytes)return r.push(this.readBoolean());var e=bo(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Cr.Bytes)return r.push(this.readFloat());var e=bo(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Cr.Bytes)return r.push(this.readDouble());var e=bo(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Cr.Bytes)return r.push(this.readFixed32());var e=bo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Cr.Bytes)return r.push(this.readSFixed32());var e=bo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Cr.Bytes)return r.push(this.readFixed64());var e=bo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Cr.Bytes)return r.push(this.readSFixed64());var e=bo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Cr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Cr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Cr.Fixed32)this.pos+=4;else{if(e!==Cr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),kl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),kl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),kl(this.buf,-1&r,this.pos),kl(this.buf,Math.floor(r*Vm),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),kl(this.buf,-1&r,this.pos),kl(this.buf,Math.floor(r*Vm),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,n){var a,h;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,y,x){x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7)}(a,0,n),function(m,y){var x=(7&m)<<4;y.buf[y.pos++]|=x|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(h,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(a,h,m){for(var y,x,T=0;T<h.length;T++){if((y=h.charCodeAt(T))>55295&&y<57344){if(!x){y>56319||T+1===h.length?(a[m++]=239,a[m++]=191,a[m++]=189):x=y;continue}if(y<56320){a[m++]=239,a[m++]=191,a[m++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(a[m++]=239,a[m++]=191,a[m++]=189,x=null);y<128?a[m++]=y:(y<2048?a[m++]=y>>6|192:(y<65536?a[m++]=y>>12|224:(a[m++]=y>>18|240,a[m++]=y>>12&63|128),a[m++]=y>>6&63|128),a[m++]=63&y|128)}return m}(this.buf,r,this.pos);var n=this.pos-e;n>=128&&qm(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),$m(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),$m(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,e){this.pos++;var n=this.pos;r(e,this);var a=this.pos-n;a>=128&&qm(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,e,n){this.writeTag(r,Cr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Hx,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Wx,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,Jx,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,Xx,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,Yx,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,Kx,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,Qx,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,eb,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,tb,e)},writeBytesField:function(r,e){this.writeTag(r,Cr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Cr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Cr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Cr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Cr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Cr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Cr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Cr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Cr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Cr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};var Pp=A(Bm);const kp=3;function rb(r,e,n){r===1&&n.readMessage(nb,e)}function nb(r,e,n){if(r===3){const{id:a,bitmap:h,width:m,height:y,left:x,top:T,advance:D}=n.readMessage(ib,{});e.push({id:a,bitmap:new Tc({width:m+2*kp,height:y+2*kp},h),metrics:{width:m,height:y,left:x,top:T,advance:D}})}}function ib(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}const Zm=kp;function Hm(r){let e=0,n=0;for(const y of r)e+=y.w*y.h,n=Math.max(n,y.w);r.sort((y,x)=>x.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,m=0;for(const y of r)for(let x=a.length-1;x>=0;x--){const T=a[x];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,m=Math.max(m,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===T.w&&y.h===T.h){const D=a.pop();x<a.length&&(a[x]=D)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(a.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}const bi=1;class Mp{constructor(e,{pixelRatio:n,version:a,stretchX:h,stretchY:m,content:y}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=m,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+bi,this.paddedRect.y+bi]}get br(){return[this.paddedRect.x+this.paddedRect.w-bi,this.paddedRect.y+this.paddedRect.h-bi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*bi)/this.pixelRatio,(this.paddedRect.h-2*bi)/this.pixelRatio]}}class Wm{constructor(e,n){const a={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,a,m),this.addImages(n,h,m);const{w:y,h:x}=Hm(m),T=new Bi({width:y||1,height:x||1});for(const D in e){const k=e[D],F=a[D].paddedRect;Bi.copy(k.data,T,{x:0,y:0},{x:F.x+bi,y:F.y+bi},k.data)}for(const D in n){const k=n[D],F=h[D].paddedRect,U=F.x+bi,G=F.y+bi,W=k.data.width,ee=k.data.height;Bi.copy(k.data,T,{x:0,y:0},{x:U,y:G},k.data),Bi.copy(k.data,T,{x:0,y:ee-1},{x:U,y:G-1},{width:W,height:1}),Bi.copy(k.data,T,{x:0,y:0},{x:U,y:G+ee},{width:W,height:1}),Bi.copy(k.data,T,{x:W-1,y:0},{x:U-1,y:G},{width:1,height:ee}),Bi.copy(k.data,T,{x:0,y:0},{x:U+W,y:G},{width:1,height:ee})}this.image=T,this.iconPositions=a,this.patternPositions=h}addImages(e,n,a){for(const h in e){const m=e[h],y={x:0,y:0,w:m.data.width+2*bi,h:m.data.height+2*bi};a.push(y),n[h]=new Mp(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,m]=e.tl;a.update(n.data,void 0,{x:h,y:m})}}var ra;bt("ImagePosition",Mp),bt("ImageAtlas",Wm),o.ai=void 0,(ra=o.ai||(o.ai={}))[ra.none=0]="none",ra[ra.horizontal=1]="horizontal",ra[ra.vertical=2]="vertical",ra[ra.horizontalOnly=3]="horizontalOnly";const Mc=-17;class Oc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const a=new Oc;return a.scale=e||1,a.fontStack=n,a}static forImage(e){const n=new Oc;return n.imageName=e,n}}class Ml{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const a=new Ml;for(let h=0;h<e.sections.length;h++){const m=e.sections[h];m.image?a.addImageSection(m):a.addTextSection(m,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let a=0;a<e.length;a++){const h=e.charCodeAt(a+1)||null,m=e.charCodeAt(a-1)||null;n+=h&&Nu(h)&&!kc[e[a+1]]||m&&Nu(m)&&!kc[e[a-1]]||!kc[e[a]]?e[a]:kc[e[a]]}return n}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&rh[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&rh[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const a=new Ml;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Oc.forText(e.scale,e.fontStack||n));const a=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(a)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void wt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Oc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):wt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function th(r,e,n,a,h,m,y,x,T,D,k,F,U,G,W,ee){const ue=Ml.fromFeature(r,h);let ge;F===o.ai.vertical&&ue.verticalizePunctuation();const{processBidirectionalText:Ce,processStyledBidirectionalText:be}=vi;if(Ce&&ue.sections.length===1){ge=[];const We=Ce(ue.toString(),Op(ue,D,m,e,a,G,W));for(const xt of We){const Nt=new Ml;Nt.text=xt,Nt.sections=ue.sections;for(let _t=0;_t<xt.length;_t++)Nt.sectionIndex.push(0);ge.push(Nt)}}else if(be){ge=[];const We=be(ue.text,ue.sectionIndex,Op(ue,D,m,e,a,G,W));for(const xt of We){const Nt=new Ml;Nt.text=xt[0],Nt.sectionIndex=xt[1],Nt.sections=ue.sections,ge.push(Nt)}}else ge=function(We,xt){const Nt=[],_t=We.text;let dt=0;for(const lt of xt)Nt.push(We.substring(dt,lt)),dt=lt;return dt<_t.length&&Nt.push(We.substring(dt,_t.length)),Nt}(ue,Op(ue,D,m,e,a,G,W));const ke=[],Le={positionedLines:ke,text:ue.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(We,xt,Nt,_t,dt,lt,Pt,ut,rt,$t,zt,er){let Ur=0,jr=Mc,_n=0,ki=0;const fi=ut==="right"?1:ut==="left"?0:.5;let ln=0;for(const vn of dt){vn.trim();const xn=vn.getMaxScale(),ti=(xn-1)*yn,yi={positionedGlyphs:[],lineOffset:0};We.positionedLines[ln]=yi;const ri=yi.positionedGlyphs;let wi=0;if(!vn.length()){jr+=lt,++ln;continue}for(let bn=0;bn<vn.length();bn++){const cr=vn.getSection(bn),ni=vn.getSectionIndex(bn),Vn=vn.getCharCode(bn);let wn=0,ss=null,Is=null,As=null,wo=yn;const os=!(rt===o.ai.horizontal||!zt&&!sc(Vn)||zt&&(rh[Vn]||(kn=Vn,vt.Arabic(kn)||vt["Arabic Supplement"](kn)||vt["Arabic Extended-A"](kn)||vt["Arabic Presentation Forms-A"](kn)||vt["Arabic Presentation Forms-B"](kn))));if(cr.imageName){const $i=_t[cr.imageName];if(!$i)continue;As=cr.imageName,We.iconsInText=We.iconsInText||!0,Is=$i.paddedRect;const Ti=$i.displaySize;cr.scale=cr.scale*yn/er,ss={width:Ti[0],height:Ti[1],left:bi,top:-Zm,advance:os?Ti[1]:Ti[0]},wn=ti+(yn-Ti[1]*cr.scale),wo=ss.advance;const Eo=os?Ti[0]*cr.scale-yn*xn:Ti[1]*cr.scale-yn*xn;Eo>0&&Eo>wi&&(wi=Eo)}else{const $i=Nt[cr.fontStack],Ti=$i&&$i[Vn];if(Ti&&Ti.rect)Is=Ti.rect,ss=Ti.metrics;else{const Eo=xt[cr.fontStack],zc=Eo&&Eo[Vn];if(!zc)continue;ss=zc.metrics}wn=(xn-cr.scale)*yn}os?(We.verticalizable=!0,ri.push({glyph:Vn,imageName:As,x:Ur,y:jr+wn,vertical:os,scale:cr.scale,fontStack:cr.fontStack,sectionIndex:ni,metrics:ss,rect:Is}),Ur+=wo*cr.scale+$t):(ri.push({glyph:Vn,imageName:As,x:Ur,y:jr+wn,vertical:os,scale:cr.scale,fontStack:cr.fontStack,sectionIndex:ni,metrics:ss,rect:Is}),Ur+=ss.advance*cr.scale+$t)}ri.length!==0&&(_n=Math.max(Ur-$t,_n),ab(ri,0,ri.length-1,fi,wi)),Ur=0;const Ei=lt*xn+wi;yi.lineOffset=Math.max(wi,ti),jr+=Ei,ki=Math.max(Ei,ki),++ln}var kn;const $n=jr-Mc,{horizontalAlign:mi,verticalAlign:gi}=Rp(Pt);(function(vn,xn,ti,yi,ri,wi,Ei,bn,cr){const ni=(xn-ti)*ri;let Vn=0;Vn=wi!==Ei?-bn*yi-Mc:(-yi*cr+.5)*Ei;for(const wn of vn)for(const ss of wn.positionedGlyphs)ss.x+=ni,ss.y+=Vn})(We.positionedLines,fi,mi,gi,_n,ki,lt,$n,dt.length),We.top+=-gi*$n,We.bottom=We.top+$n,We.left+=-mi*_n,We.right=We.left+_n}(Le,e,n,a,ge,y,x,T,F,D,U,ee),!function(We){for(const xt of We)if(xt.positionedGlyphs.length!==0)return!1;return!0}(ke)&&Le}const rh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xm(r,e,n,a,h,m){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*yn/m+h:0}{const y=n[e.fontStack],x=y&&y[r];return x?x.metrics.advance*e.scale+h:0}}function Ym(r,e,n,a){const h=Math.pow(r-e,2);return a?r<e?h/2:2*h:h+Math.abs(n)*n}function ob(r,e,n){let a=0;return r===10&&(a-=1e4),n&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Jm(r,e,n,a,h,m){let y=null,x=Ym(e,n,h,m);for(const T of a){const D=Ym(e-T.x,n,h,m)+T.badness;D<=x&&(y=T,x=D)}return{index:r,x:e,priorBreak:y,badness:x}}function Km(r){return r?Km(r.priorBreak).concat(r.index):[]}function Op(r,e,n,a,h,m,y){if(m!=="point")return[];if(!r)return[];const x=[],T=function(U,G,W,ee,ue,ge){let Ce=0;for(let be=0;be<U.length();be++){const ke=U.getSection(be);Ce+=Xm(U.getCharCode(be),ke,ee,ue,G,ge)}return Ce/Math.max(1,Math.ceil(Ce/W))}(r,e,n,a,h,y),D=r.text.indexOf("​")>=0;let k=0;for(let U=0;U<r.length();U++){const G=r.getSection(U),W=r.getCharCode(U);if(rh[W]||(k+=Xm(W,G,a,h,e,y)),U<r.length()-1){const ee=!((F=W)<11904||!(vt["Bopomofo Extended"](F)||vt.Bopomofo(F)||vt["CJK Compatibility Forms"](F)||vt["CJK Compatibility Ideographs"](F)||vt["CJK Compatibility"](F)||vt["CJK Radicals Supplement"](F)||vt["CJK Strokes"](F)||vt["CJK Symbols and Punctuation"](F)||vt["CJK Unified Ideographs Extension A"](F)||vt["CJK Unified Ideographs"](F)||vt["Enclosed CJK Letters and Months"](F)||vt["Halfwidth and Fullwidth Forms"](F)||vt.Hiragana(F)||vt["Ideographic Description Characters"](F)||vt["Kangxi Radicals"](F)||vt["Katakana Phonetic Extensions"](F)||vt.Katakana(F)||vt["Vertical Forms"](F)||vt["Yi Radicals"](F)||vt["Yi Syllables"](F)));(sb[W]||ee||G.imageName)&&x.push(Jm(U+1,k,T,x,ob(W,r.getCharCode(U+1),ee&&D),!1))}}var F;return Km(Jm(r.length(),k,T,x,0,!0))}function Rp(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function ab(r,e,n,a,h){if(!a&&!h)return;const m=r[n],y=(r[n].x+m.metrics.advance*m.scale)*a;for(let x=e;x<=n;x++)r[x].x-=y,r[x].y+=h}function lb(r,e,n){const{horizontalAlign:a,verticalAlign:h}=Rp(n),m=e[0]-r.displaySize[0]*a,y=e[1]-r.displaySize[1]*h;return{image:r,top:y,bottom:y+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function Qm(r,e,n,a,h,m){const y=r.image;let x;if(y.content){const ue=y.content,ge=y.pixelRatio||1;x=[ue[0]/ge,ue[1]/ge,y.displaySize[0]-ue[2]/ge,y.displaySize[1]-ue[3]/ge]}const T=e.left*m,D=e.right*m;let k,F,U,G;n==="width"||n==="both"?(G=h[0]+T-a[3],F=h[0]+D+a[1]):(G=h[0]+(T+D-y.displaySize[0])/2,F=G+y.displaySize[0]);const W=e.top*m,ee=e.bottom*m;return n==="height"||n==="both"?(k=h[1]+W-a[0],U=h[1]+ee+a[2]):(k=h[1]+(W+ee-y.displaySize[1])/2,U=k+y.displaySize[1]),{image:y,top:k,right:F,bottom:U,left:G,collisionPadding:x}}const Rc=255,Vs=128,na=Rc*Vs;function eg(r,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new zr(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=n;let m=0;for(;m<a.length&&a[m]<=r;)m++;m=Math.max(0,m-1);let y=m;for(;y<a.length&&a[y]<r+1;)y++;y=Math.min(a.length-1,y);const x=a[m],T=a[y];return n.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:T,minSize:n.evaluate(new zr(x)),maxSize:n.evaluate(new zr(T)),interpolationType:h}}}function Np(r,e,n){let a="never";const h=r.get(e);return h?a=h:r.get(n)&&(a="always"),a}const cb=ta.VectorTileFeature.types,ub=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nh(r,e,n,a,h,m,y,x,T,D,k,F,U){const G=x?Math.min(na,Math.round(x[0])):0,W=x?Math.min(na,Math.round(x[1])):0;r.emplaceBack(e,n,Math.round(32*a),Math.round(32*h),m,y,(G<<1)+(T?1:0),W,16*D,16*k,256*F,256*U)}function Lp(r,e,n){r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n)}function hb(r){for(const e of r.sections)if(lp(e.text))return!0;return!1}class Fp{constructor(e){this.layoutVertexArray=new ir,this.indexArray=new Cn,this.programConfigurations=e,this.segments=new Br,this.dynamicLayoutVertexArray=new Kt,this.opacityVertexArray=new lr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Se}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,jx.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ub,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}bt("SymbolBuffers",Fp);class zp{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new Br,this.collisionVertexArray=new Rr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,qx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}bt("CollisionBuffers",zp);class Ol{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=mp([]),this.placementViewportMatrix=mp([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=eg(this.zoom,n["text-size"]),this.iconSizeData=eg(this.zoom,n["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=Np(a,"text-overlap","text-allow-overlap")!=="never"||Np(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>o.ai[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Fp(new Ss(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Fp(new Ss(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new De,this.lineVertexArray=new Fe,this.symbolInstances=new pe,this.textAnchorOffsets=new He}calculateGlyphDependencies(e,n,a,h,m){for(let y=0;y<e.length;y++)if(n[e.charCodeAt(y)]=!0,(a||h)&&m){const x=kc[e.charAt(y)];x&&(n[x.charCodeAt(0)]=!0)}}populate(e,n,a){const h=this.layers[0],m=h.layout,y=m.get("text-font"),x=m.get("text-field"),T=m.get("icon-image"),D=(x.value.kind!=="constant"||x.value.value instanceof Tn&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),k=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,F=m.get("symbol-sort-key");if(this.features=[],!D&&!k)return;const U=n.iconDependencies,G=n.glyphDependencies,W=n.availableImages,ee=new zr(this.zoom);for(const{feature:ue,id:ge,index:Ce,sourceLayerIndex:be}of e){const ke=h._featureFilter.needGeometry,Le=ja(ue,ke);if(!h._featureFilter.filter(ee,Le,a))continue;let We,xt;if(ke||(Le.geometry=Va(ue)),D){const _t=h.getValueAndResolveTokens("text-field",Le,a,W),dt=Tn.factory(_t);hb(dt)&&(this.hasRTLText=!0),(!this.hasRTLText||hc()==="unavailable"||this.hasRTLText&&vi.isParsed())&&(We=Zx(dt,h,Le))}if(k){const _t=h.getValueAndResolveTokens("icon-image",Le,a,W);xt=_t instanceof fn?_t:fn.fromString(_t)}if(!We&&!xt)continue;const Nt=this.sortFeaturesByKey?F.evaluate(Le,{},a):void 0;if(this.features.push({id:ge,text:We,icon:xt,index:Ce,sourceLayerIndex:be,geometry:Le.geometry,properties:ue.properties,type:cb[ue.type],sortKey:Nt}),xt&&(U[xt.name]=!0),We){const _t=y.evaluate(Le,{},a).join(","),dt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ai.vertical)>=0;for(const lt of We.sections)if(lt.image)U[lt.image.name]=!0;else{const Pt=nc(We.toString()),ut=lt.fontStack||_t,rt=G[ut]=G[ut]||{};this.calculateGlyphDependencies(lt.text,rt,dt,this.allowVerticalPlacement,Pt)}}}m.get("symbol-placement")==="line"&&(this.features=function(ue){const ge={},Ce={},be=[];let ke=0;function Le(_t){be.push(ue[_t]),ke++}function We(_t,dt,lt){const Pt=Ce[_t];return delete Ce[_t],Ce[dt]=Pt,be[Pt].geometry[0].pop(),be[Pt].geometry[0]=be[Pt].geometry[0].concat(lt[0]),Pt}function xt(_t,dt,lt){const Pt=ge[dt];return delete ge[dt],ge[_t]=Pt,be[Pt].geometry[0].shift(),be[Pt].geometry[0]=lt[0].concat(be[Pt].geometry[0]),Pt}function Nt(_t,dt,lt){const Pt=lt?dt[0][dt[0].length-1]:dt[0][0];return`${_t}:${Pt.x}:${Pt.y}`}for(let _t=0;_t<ue.length;_t++){const dt=ue[_t],lt=dt.geometry,Pt=dt.text?dt.text.toString():null;if(!Pt){Le(_t);continue}const ut=Nt(Pt,lt),rt=Nt(Pt,lt,!0);if(ut in Ce&&rt in ge&&Ce[ut]!==ge[rt]){const $t=xt(ut,rt,lt),zt=We(ut,rt,be[$t].geometry);delete ge[ut],delete Ce[rt],Ce[Nt(Pt,be[zt].geometry,!0)]=zt,be[$t].geometry=null}else ut in Ce?We(ut,rt,lt):rt in ge?xt(ut,rt,lt):(Le(_t),ge[ut]=ke-1,Ce[rt]=ke-1)}return be.filter(_t=>_t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ue,ge)=>ue.sortKey-ge.sortKey)}update(e,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const a=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(n[e.segment+1]),m=e.dist(n[e.segment]);const y={};for(let x=e.segment+1;x<n.length;x++)y[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:h},x<n.length-1&&(h+=n[x+1].dist(n[x]));for(let x=e.segment||0;x>=0;x--)y[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:m},x>0&&(m+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const T=y[x];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,h,m,y,x,T,D,k,F,U){const G=e.indexArray,W=e.layoutVertexArray,ee=e.segments.prepareSegment(4*n.length,W,G,this.canOverlap?y.sortKey:void 0),ue=this.glyphOffsetArray.length,ge=ee.vertexLength,Ce=this.allowVerticalPlacement&&x===o.ai.vertical?Math.PI/2:0,be=y.text&&y.text.sections;for(let ke=0;ke<n.length;ke++){const{tl:Le,tr:We,bl:xt,br:Nt,tex:_t,pixelOffsetTL:dt,pixelOffsetBR:lt,minFontScaleX:Pt,minFontScaleY:ut,glyphOffset:rt,isSDF:$t,sectionIndex:zt}=n[ke],er=ee.vertexLength,Ur=rt[1];nh(W,T.x,T.y,Le.x,Ur+Le.y,_t.x,_t.y,a,$t,dt.x,dt.y,Pt,ut),nh(W,T.x,T.y,We.x,Ur+We.y,_t.x+_t.w,_t.y,a,$t,lt.x,dt.y,Pt,ut),nh(W,T.x,T.y,xt.x,Ur+xt.y,_t.x,_t.y+_t.h,a,$t,dt.x,lt.y,Pt,ut),nh(W,T.x,T.y,Nt.x,Ur+Nt.y,_t.x+_t.w,_t.y+_t.h,a,$t,lt.x,lt.y,Pt,ut),Lp(e.dynamicLayoutVertexArray,T,Ce),G.emplaceBack(er,er+1,er+2),G.emplaceBack(er+1,er+2,er+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rt[0]),ke!==n.length-1&&zt===n[ke+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,y,y.index,{},U,be&&be[zt])}e.placedSymbolArray.emplaceBack(T.x,T.y,ue,this.glyphOffsetArray.length-ue,ge,D,k,T.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],x,0,!1,0,F)}_addCollisionDebugVertex(e,n,a,h,m,y){return n.emplaceBack(0,0),e.emplaceBack(a.x,a.y,h,m,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,n,a,h,m,y,x){const T=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),D=T.vertexLength,k=m.layoutVertexArray,F=m.collisionVertexArray,U=x.anchorX,G=x.anchorY;this._addCollisionDebugVertex(k,F,y,U,G,new P(e,n)),this._addCollisionDebugVertex(k,F,y,U,G,new P(a,n)),this._addCollisionDebugVertex(k,F,y,U,G,new P(a,h)),this._addCollisionDebugVertex(k,F,y,U,G,new P(e,h)),T.vertexLength+=4;const W=m.indexArray;W.emplaceBack(D,D+1),W.emplaceBack(D+1,D+2),W.emplaceBack(D+2,D+3),W.emplaceBack(D+3,D),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,a,h){for(let m=e;m<n;m++){const y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zp(Kr,zm.members,mn),this.iconCollisionBox=new zp(Kr,zm.members,mn);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,a,h,m,y,x,T,D){const k={};for(let F=n;F<a;F++){const U=e.get(F);k.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.textFeatureIndex=U.featureIndex;break}for(let F=h;F<m;F++){const U=e.get(F);k.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.verticalTextFeatureIndex=U.featureIndex;break}for(let F=y;F<x;F++){const U=e.get(F);k.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.iconFeatureIndex=U.featureIndex;break}for(let F=T;F<D;F++){const U=e.get(F);k.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.verticalIconFeatureIndex=U.featureIndex;break}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const a=e.placedSymbolArray.get(n),h=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),a=Math.cos(e),h=[],m=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const T=this.symbolInstances.get(x);h.push(0|Math.round(n*T.anchorX+a*T.anchorY)),m.push(T.featureIndex)}return y.sort((x,T)=>h[x]-h[T]||m[T]-m[x]),y}addToSortKeyRanges(e,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,m,y)=>{h>=0&&y.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let tg,rg;bt("SymbolBucket",Ol,{omit:["layers","collisionBoxArray","features","compareText"]}),Ol.MAX_GLYPHS=65535,Ol.addDynamicAttributes=Lp;var Bp={get paint(){return rg=rg||new tn({"icon-opacity":new qt($e.paint_symbol["icon-opacity"]),"icon-color":new qt($e.paint_symbol["icon-color"]),"icon-halo-color":new qt($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new qt($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qt($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Bt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bt($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new qt($e.paint_symbol["text-opacity"]),"text-color":new qt($e.paint_symbol["text-color"],{runtimeType:on,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new qt($e.paint_symbol["text-halo-color"]),"text-halo-width":new qt($e.paint_symbol["text-halo-width"]),"text-halo-blur":new qt($e.paint_symbol["text-halo-blur"]),"text-translate":new Bt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Bt($e.paint_symbol["text-translate-anchor"])})},get layout(){return tg=tg||new tn({"symbol-placement":new Bt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Bt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qt($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bt($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bt($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Bt($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Bt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new qt($e.layout_symbol["icon-size"]),"icon-text-fit":new Bt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new qt($e.layout_symbol["icon-image"]),"icon-rotate":new qt($e.layout_symbol["icon-rotate"]),"icon-padding":new qt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Bt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new qt($e.layout_symbol["icon-offset"]),"icon-anchor":new qt($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bt($e.layout_symbol["text-rotation-alignment"]),"text-field":new qt($e.layout_symbol["text-field"]),"text-font":new qt($e.layout_symbol["text-font"]),"text-size":new qt($e.layout_symbol["text-size"]),"text-max-width":new qt($e.layout_symbol["text-max-width"]),"text-line-height":new Bt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new qt($e.layout_symbol["text-letter-spacing"]),"text-justify":new qt($e.layout_symbol["text-justify"]),"text-radial-offset":new qt($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bt($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qt($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qt($e.layout_symbol["text-anchor"]),"text-max-angle":new Bt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Bt($e.layout_symbol["text-writing-mode"]),"text-rotate":new qt($e.layout_symbol["text-rotate"]),"text-padding":new Bt($e.layout_symbol["text-padding"]),"text-keep-upright":new Bt($e.layout_symbol["text-keep-upright"]),"text-transform":new qt($e.layout_symbol["text-transform"]),"text-offset":new qt($e.layout_symbol["text-offset"]),"text-allow-overlap":new Bt($e.layout_symbol["text-allow-overlap"]),"text-overlap":new Bt($e.layout_symbol["text-overlap"]),"text-ignore-placement":new Bt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Bt($e.layout_symbol["text-optional"])})}};class ng{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:qn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bt("FormatSectionOverride",ng,{omit:["defaultValue"]});class ih extends Ci{constructor(e){super(e,Bp)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const m of a)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,a,h){const m=this.layout.get(e).evaluate(n,{},a,h),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||io(y.value)||!m?m:function(x,T){return T.replace(/{([^{}]+)}/g,(D,k)=>x&&k in x?String(x[k]):"")}(n.properties,m)}createBucket(e){return new Ol(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Bp.paint.overridableProperties){if(!ih.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),a=new ng(n),h=new Ra(a,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new so("source",h):new oo("composite",h,n.value.zoomStops),this.paint._values[e]=new Qn(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&ih.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const a=e.get("text-field"),h=Bp.paint.properties[n];let m=!1;const y=x=>{for(const T of x)if(h.overrides&&h.overrides.hasOverride(T))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Tn)y(a.value.value.sections);else if(a.value.kind==="source"){const x=D=>{m||(D instanceof mr&&Nr(D.value)===$?y(D.value.sections):D instanceof _s?y(D.sections):D.eachChild(x))},T=a.value;T._styleExpression&&x(T._styleExpression.expression)}return m}}let ig;var pb={get paint(){return ig=ig||new tn({"background-color":new Bt($e.paint_background["background-color"]),"background-pattern":new dc($e.paint_background["background-pattern"]),"background-opacity":new Bt($e.paint_background["background-opacity"])})}};class db extends Ci{constructor(e){super(e,pb)}}let sg;var fb={get paint(){return sg=sg||new tn({"raster-opacity":new Bt($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Bt($e.paint_raster["raster-saturation"]),"raster-contrast":new Bt($e.paint_raster["raster-contrast"]),"raster-resampling":new Bt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Bt($e.paint_raster["raster-fade-duration"])})}};class mb extends Ci{constructor(e){super(e,fb)}}class gb extends Ci{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yb{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Up=63710088e-1;class ia{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ia(Ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,a=this.lat*n,h=e.lat*n,m=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return Up*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof ia)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ia(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ia(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const og=2*Math.PI*Up;function ag(r){return og*Math.cos(r*Math.PI/180)}function lg(r){return(180+r)/360}function cg(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ug(r,e){return r/ag(e)}function hg(r){return 360*r-180}function $p(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class sh{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){const a=ia.convert(e);return new sh(lg(a.lng),cg(a.lat),ug(n,a.lat))}toLngLat(){return new ia(hg(this.x),$p(this.y))}toAltitude(){return this.z*ag($p(this.y))}meterInMercatorCoordinateUnits(){return 1/og*(e=$p(this.y),1/Math.cos(e*Math.PI/180));var e}}function pg(r,e,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Vp{constructor(e,n,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=a,this.key=Nc(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,a){const h=(y=this.y,x=this.z,T=pg(256*(m=this.x),256*(y=Math.pow(2,x)-y-1),x),D=pg(256*(m+1),256*(y+1),x),T[0]+","+T[1]+","+D[0]+","+D[1]);var m,y,x,T,D;const k=function(F,U,G){let W,ee="";for(let ue=F;ue>0;ue--)W=1<<ue-1,ee+=(U&W?1:0)+(G&W?2:0);return ee}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new P((e.x*n-this.x)*an,(e.y*n-this.y)*an)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dg{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Nc(e,n.z,n.z,n.x,n.y)}}class Ui{constructor(e,n,a,h,m){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Vp(a,+h,+m),this.key=Nc(n,e,a,h,m)}clone(){return new Ui(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new Ui(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ui(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Nc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Nc(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Ui(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Ui(n,this.wrap,n,a,h),new Ui(n,this.wrap,n,a+1,h),new Ui(n,this.wrap,n,a,h+1),new Ui(n,this.wrap,n,a+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ui(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ui(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new sh(e.x-this.wrap,e.y))}}function Nc(r,e,n,a,h){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*h+a).toString(36)+n.toString(36)+e.toString(36)}bt("CanonicalTileID",Vp),bt("OverscaledTileID",Ui,{omit:["posMatrix"]});class fg{constructor(e,n,a,h=1,m=1,y=1,x=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void wt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=m,this.blueFactor=y,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<T;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(T,D)]=this.data[this._idx(T-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,T)]=this.data[this._idx(D,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<T;D++)for(let k=0;k<T;k++){const F=this.get(D,k);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(e,n){const a=new Uint8Array(this.data.buffer),h=4*this._idx(e,n);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,a){return e*this.redFactor+n*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Bi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,m=n*this.dim+this.dim,y=a*this.dim,x=a*this.dim+this.dim;switch(n){case-1:h=m-1;break;case 1:m=h+1}switch(a){case-1:y=x-1;break;case 1:x=y+1}const T=-n*this.dim,D=-a*this.dim;for(let k=y;k<x;k++)for(let F=h;F<m;F++)this.data[this._idx(F,k)]=e.data[this._idx(F+T,k+D)]}}bt("DEMData",fg);class mg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class gg{constructor(e,n,a,h,m){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=a,e._y=h,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class yg{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Kn(an,16,0),this.grid3D=new Kn(an,16,0),this.featureIndexArray=new Qe,this.promoteId=n}insert(e,n,a,h,m,y){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,m);const T=y?this.grid3D:this.grid;for(let D=0;D<n.length;D++){const k=n[D],F=[1/0,1/0,-1/0,-1/0];for(let U=0;U<k.length;U++){const G=k[U];F[0]=Math.min(F[0],G.x),F[1]=Math.min(F[1],G.y),F[2]=Math.max(F[2],G.x),F[3]=Math.max(F[3],G.y)}F[0]<an&&F[1]<an&&F[2]>=0&&F[3]>=0&&T.insert(x,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ta.VectorTile(new Pp(this.rawTileData)).layers,this.sourceLayerCoder=new mg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,a,h){this.loadVTLayers();const m=e.params||{},y=an/e.tileSize/e.scale,x=Na(m.filter),T=e.queryGeometry,D=e.queryPadding*y,k=vg(T),F=this.grid.query(k.minX-D,k.minY-D,k.maxX+D,k.maxY+D),U=vg(e.cameraQueryGeometry),G=this.grid3D.query(U.minX-D,U.minY-D,U.maxX+D,U.maxY+D,(ue,ge,Ce,be)=>function(ke,Le,We,xt,Nt){for(const dt of ke)if(Le<=dt.x&&We<=dt.y&&xt>=dt.x&&Nt>=dt.y)return!0;const _t=[new P(Le,We),new P(Le,Nt),new P(xt,Nt),new P(xt,We)];if(ke.length>2){for(const dt of _t)if(Il(ke,dt))return!0}for(let dt=0;dt<ke.length-1;dt++)if(X0(ke[dt],ke[dt+1],_t))return!0;return!1}(e.cameraQueryGeometry,ue-D,ge-D,Ce+D,be+D));for(const ue of G)F.push(ue);F.sort(_b);const W={};let ee;for(let ue=0;ue<F.length;ue++){const ge=F[ue];if(ge===ee)continue;ee=ge;const Ce=this.featureIndexArray.get(ge);let be=null;this.loadMatchingFeature(W,Ce.bucketIndex,Ce.sourceLayerIndex,Ce.featureIndex,x,m.layers,m.availableImages,n,a,h,(ke,Le,We)=>(be||(be=Va(ke)),Le.queryIntersectsFeature(T,ke,We,be,this.z,e.transform,y,e.pixelPosMatrix)))}return W}loadMatchingFeature(e,n,a,h,m,y,x,T,D,k,F){const U=this.bucketLayerIDs[n];if(y&&!function(ue,ge){for(let Ce=0;Ce<ue.length;Ce++)if(ge.indexOf(ue[Ce])>=0)return!0;return!1}(y,U))return;const G=this.sourceLayerCoder.decode(a),W=this.vtLayers[G].feature(h);if(m.needGeometry){const ue=ja(W,!0);if(!m.filter(new zr(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!m.filter(new zr(this.tileID.overscaledZ),W))return;const ee=this.getId(W,G);for(let ue=0;ue<U.length;ue++){const ge=U[ue];if(y&&y.indexOf(ge)<0)continue;const Ce=T[ge];if(!Ce)continue;let be={};ee&&k&&(be=k.getState(Ce.sourceLayer||"_geojsonTileLayer",ee));const ke=Me({},D[ge]);ke.paint=_g(ke.paint,Ce.paint,W,be,x),ke.layout=_g(ke.layout,Ce.layout,W,be,x);const Le=!F||F(W,Ce,be);if(!Le)continue;const We=new gg(W,this.z,this.x,this.y,ee);We.layer=ke;let xt=e[ge];xt===void 0&&(xt=e[ge]=[]),xt.push({featureIndex:h,feature:We,intersectionZ:Le})}}lookupSymbolFeatures(e,n,a,h,m,y,x,T){const D={};this.loadVTLayers();const k=Na(m);for(const F of e)this.loadMatchingFeature(D,a,h,F,k,y,x,T,n);return D}hasLayer(e){for(const n of this.bucketLayerIDs)for(const a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof a=="boolean"&&(a=Number(a))),a}}function _g(r,e,n,a,h){return xe(r,(m,y)=>{const x=e instanceof Tl?e.get(y):null;return x&&x.evaluate?x.evaluate(n,a,h):x})}function vg(r){let e=1/0,n=1/0,a=-1/0,h=-1/0;for(const m of r)e=Math.min(e,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),h=Math.max(h,m.y);return{minX:e,minY:n,maxX:a,maxY:h}}function _b(r,e){return e-r}function xg(r,e,n,a,h){const m=[];for(let y=0;y<r.length;y++){const x=r[y];let T;for(let D=0;D<x.length-1;D++){let k=x[D],F=x[D+1];k.x<e&&F.x<e||(k.x<e?k=new P(e,k.y+(e-k.x)/(F.x-k.x)*(F.y-k.y))._round():F.x<e&&(F=new P(e,k.y+(e-k.x)/(F.x-k.x)*(F.y-k.y))._round()),k.y<n&&F.y<n||(k.y<n?k=new P(k.x+(n-k.y)/(F.y-k.y)*(F.x-k.x),n)._round():F.y<n&&(F=new P(k.x+(n-k.y)/(F.y-k.y)*(F.x-k.x),n)._round()),k.x>=a&&F.x>=a||(k.x>=a?k=new P(a,k.y+(a-k.x)/(F.x-k.x)*(F.y-k.y))._round():F.x>=a&&(F=new P(a,k.y+(a-k.x)/(F.x-k.x)*(F.y-k.y))._round()),k.y>=h&&F.y>=h||(k.y>=h?k=new P(k.x+(h-k.y)/(F.y-k.y)*(F.x-k.x),h)._round():F.y>=h&&(F=new P(k.x+(h-k.y)/(F.y-k.y)*(F.x-k.x),h)._round()),T&&k.equals(T[T.length-1])||(T=[k],m.push(T)),T.push(F)))))}}return m}bt("FeatureIndex",yg,{omit:["rawTileData","sourceLayerCoder"]});class sa extends P{constructor(e,n,a,h){super(e,n),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new sa(this.x,this.y,this.angle,this.segment)}}function bg(r,e,n,a,h){if(e.segment===void 0||n===0)return!0;let m=e,y=e.segment+1,x=0;for(;x>-n/2;){if(y--,y<0)return!1;x-=r[y].dist(m),m=r[y]}x+=r[y].dist(r[y+1]),y++;const T=[];let D=0;for(;x<n/2;){const k=r[y],F=r[y+1];if(!F)return!1;let U=r[y-1].angleTo(k)-k.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:U}),D+=U;x-T[0].distance>a;)D-=T.shift().angleDelta;if(D>h)return!1;y++,x+=k.dist(F)}return!0}function wg(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function Eg(r,e,n){return r?.6*e*n:0}function Tg(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function vb(r,e,n,a,h,m){const y=Eg(n,h,m),x=Tg(n,a)*m;let T=0;const D=wg(r)/2;for(let k=0;k<r.length-1;k++){const F=r[k],U=r[k+1],G=F.dist(U);if(T+G>D){const W=(D-T)/G,ee=Fn.number(F.x,U.x,W),ue=Fn.number(F.y,U.y,W),ge=new sa(ee,ue,U.angleTo(F),k);return ge._round(),!y||bg(r,ge,x,y,e)?ge:void 0}T+=G}}function xb(r,e,n,a,h,m,y,x,T){const D=Eg(a,m,y),k=Tg(a,h),F=k*y,U=r[0].x===0||r[0].x===T||r[0].y===0||r[0].y===T;return e-F<e/4&&(e=F+e/4),Sg(r,U?e/2*x%e:(k/2+2*m)*y*x%e,e,D,n,F,U,!1,T)}function Sg(r,e,n,a,h,m,y,x,T){const D=m/2,k=wg(r);let F=0,U=e-n,G=[];for(let W=0;W<r.length-1;W++){const ee=r[W],ue=r[W+1],ge=ee.dist(ue),Ce=ue.angleTo(ee);for(;U+n<F+ge;){U+=n;const be=(U-F)/ge,ke=Fn.number(ee.x,ue.x,be),Le=Fn.number(ee.y,ue.y,be);if(ke>=0&&ke<T&&Le>=0&&Le<T&&U-D>=0&&U+D<=k){const We=new sa(ke,Le,Ce,W);We._round(),a&&!bg(r,We,m,a,h)||G.push(We)}}F+=ge}return x||G.length||y||(G=Sg(r,F/2,n,a,h,m,y,!0,T)),G}bt("Anchor",sa);const Rl=bi;function Ig(r,e,n,a){const h=[],m=r.image,y=m.pixelRatio,x=m.paddedRect.w-2*Rl,T=m.paddedRect.h-2*Rl,D=r.right-r.left,k=r.bottom-r.top,F=m.stretchX||[[0,x]],U=m.stretchY||[[0,T]],G=(lt,Pt)=>lt+Pt[1]-Pt[0],W=F.reduce(G,0),ee=U.reduce(G,0),ue=x-W,ge=T-ee;let Ce=0,be=W,ke=0,Le=ee,We=0,xt=ue,Nt=0,_t=ge;if(m.content&&a){const lt=m.content;Ce=oh(F,0,lt[0]),ke=oh(U,0,lt[1]),be=oh(F,lt[0],lt[2]),Le=oh(U,lt[1],lt[3]),We=lt[0]-Ce,Nt=lt[1]-ke,xt=lt[2]-lt[0]-be,_t=lt[3]-lt[1]-Le}const dt=(lt,Pt,ut,rt)=>{const $t=ah(lt.stretch-Ce,be,D,r.left),zt=lh(lt.fixed-We,xt,lt.stretch,W),er=ah(Pt.stretch-ke,Le,k,r.top),Ur=lh(Pt.fixed-Nt,_t,Pt.stretch,ee),jr=ah(ut.stretch-Ce,be,D,r.left),_n=lh(ut.fixed-We,xt,ut.stretch,W),ki=ah(rt.stretch-ke,Le,k,r.top),fi=lh(rt.fixed-Nt,_t,rt.stretch,ee),ln=new P($t,er),kn=new P(jr,er),$n=new P(jr,ki),mi=new P($t,ki),gi=new P(zt/y,Ur/y),vn=new P(_n/y,fi/y),xn=e*Math.PI/180;if(xn){const ri=Math.sin(xn),wi=Math.cos(xn),Ei=[wi,-ri,ri,wi];ln._matMult(Ei),kn._matMult(Ei),mi._matMult(Ei),$n._matMult(Ei)}const ti=lt.stretch+lt.fixed,yi=Pt.stretch+Pt.fixed;return{tl:ln,tr:kn,bl:mi,br:$n,tex:{x:m.paddedRect.x+Rl+ti,y:m.paddedRect.y+Rl+yi,w:ut.stretch+ut.fixed-ti,h:rt.stretch+rt.fixed-yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gi,pixelOffsetBR:vn,minFontScaleX:xt/y/D,minFontScaleY:_t/y/k,isSDF:n}};if(a&&(m.stretchX||m.stretchY)){const lt=Ag(F,ue,W),Pt=Ag(U,ge,ee);for(let ut=0;ut<lt.length-1;ut++){const rt=lt[ut],$t=lt[ut+1];for(let zt=0;zt<Pt.length-1;zt++)h.push(dt(rt,Pt[zt],$t,Pt[zt+1]))}}else h.push(dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return h}function oh(r,e,n){let a=0;for(const h of r)a+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return a}function Ag(r,e,n){const a=[{fixed:-Rl,stretch:0}];for(const[h,m]of r){const y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(m-h)})}return a.push({fixed:e+Rl,stretch:n}),a}function ah(r,e,n,a){return r/e*n+a}function lh(r,e,n,a){return r-e*n/a}class ch{constructor(e,n,a,h,m,y,x,T,D,k){if(this.boxStartIndex=e.length,D){let F=y.top,U=y.bottom;const G=y.collisionPadding;G&&(F-=G[1],U+=G[3]);let W=U-F;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{let F=y.top*x-T[0],U=y.bottom*x+T[2],G=y.left*x-T[3],W=y.right*x+T[1];const ee=y.collisionPadding;if(ee&&(G-=ee[0]*x,F-=ee[1]*x,W+=ee[2]*x,U+=ee[3]*x),k){const ue=new P(G,F),ge=new P(W,F),Ce=new P(G,U),be=new P(W,U),ke=k*Math.PI/180;ue._rotate(ke),ge._rotate(ke),Ce._rotate(ke),be._rotate(ke),G=Math.min(ue.x,ge.x,Ce.x,be.x),W=Math.max(ue.x,ge.x,Ce.x,be.x),F=Math.min(ue.y,ge.y,Ce.y,be.y),U=Math.max(ue.y,ge.y,Ce.y,be.y)}e.emplaceBack(n.x,n.y,G,F,W,U,a,h,m)}this.boxEndIndex=e.length}}class bb{constructor(e=[],n=wb){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:a}=this,h=n[e];for(;e>0;){const m=e-1>>1,y=n[m];if(a(h,y)>=0)break;n[e]=y,e=m}n[e]=h}_down(e){const{data:n,compare:a}=this,h=this.length>>1,m=n[e];for(;e<h;){let y=1+(e<<1),x=n[y];const T=y+1;if(T<this.length&&a(n[T],x)<0&&(y=T,x=n[T]),a(x,m)>=0)break;n[e]=x,e=y}n[e]=m}}function wb(r,e){return r<e?-1:r>e?1:0}function Eb(r,e=1,n=!1){let a=1/0,h=1/0,m=-1/0,y=-1/0;const x=r[0];for(let G=0;G<x.length;G++){const W=x[G];(!G||W.x<a)&&(a=W.x),(!G||W.y<h)&&(h=W.y),(!G||W.x>m)&&(m=W.x),(!G||W.y>y)&&(y=W.y)}const T=Math.min(m-a,y-h);let D=T/2;const k=new bb([],Tb);if(T===0)return new P(a,h);for(let G=a;G<m;G+=T)for(let W=h;W<y;W+=T)k.push(new Nl(G+D,W+D,D,r));let F=function(G){let W=0,ee=0,ue=0;const ge=G[0];for(let Ce=0,be=ge.length,ke=be-1;Ce<be;ke=Ce++){const Le=ge[Ce],We=ge[ke],xt=Le.x*We.y-We.x*Le.y;ee+=(Le.x+We.x)*xt,ue+=(Le.y+We.y)*xt,W+=3*xt}return new Nl(ee/W,ue/W,0,G)}(r),U=k.length;for(;k.length;){const G=k.pop();(G.d>F.d||!F.d)&&(F=G,n&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,U)),G.max-F.d<=e||(D=G.h/2,k.push(new Nl(G.p.x-D,G.p.y-D,D,r)),k.push(new Nl(G.p.x+D,G.p.y-D,D,r)),k.push(new Nl(G.p.x-D,G.p.y+D,D,r)),k.push(new Nl(G.p.x+D,G.p.y+D,D,r)),U+=4)}return n&&(console.log(`num probes: ${U}`),console.log(`best distance: ${F.d}`)),F.p}function Tb(r,e){return e.max-r.max}function Nl(r,e,n,a){this.p=new P(r,e),this.h=n,this.d=function(h,m){let y=!1,x=1/0;for(let T=0;T<m.length;T++){const D=m[T];for(let k=0,F=D.length,U=F-1;k<F;U=k++){const G=D[k],W=D[U];G.y>h.y!=W.y>h.y&&h.x<(W.x-G.x)*(h.y-G.y)/(W.y-G.y)+G.x&&(y=!y),x=Math.min(x,cm(h,G,W))}}return(y?1:-1)*Math.sqrt(x)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Un;o.aq=void 0,(Un=o.aq||(o.aq={}))[Un.center=1]="center",Un[Un.left=2]="left",Un[Un.right=3]="right",Un[Un.top=4]="top",Un[Un.bottom=5]="bottom",Un[Un["top-left"]=6]="top-left",Un[Un["top-right"]=7]="top-right",Un[Un["bottom-left"]=8]="bottom-left",Un[Un["bottom-right"]=9]="bottom-right";const oa=7,jp=Number.POSITIVE_INFINITY;function Dg(r,e){return e[1]!==jp?function(n,a,h){let m=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),n){case"top-right":case"top-left":case"top":y=h-oa;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+oa}switch(n){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,y]}(r,e[0],e[1]):function(n,a){let h=0,m=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(n){case"top-right":case"top-left":m=y-oa;break;case"bottom-right":case"bottom-left":m=-y+oa;break;case"bottom":m=-a+oa;break;case"top":m=a-oa}switch(n){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,m]}(r,e[0])}function Cg(r,e,n){var a;const h=r.layout,m=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},n);if(m){const x=m.values,T=[];for(let D=0;D<x.length;D+=2){const k=T[D]=x[D],F=x[D+1].map(U=>U*yn);k.startsWith("top")?F[1]-=oa:k.startsWith("bottom")&&(F[1]+=oa),T[D+1]=F}return new li(T)}const y=h.get("text-variable-anchor");if(y){let x;x=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},n)*yn,jp]:h.get("text-offset").evaluate(e,{},n).map(D=>D*yn);const T=[];for(const D of y)T.push(D,Dg(D,x));return new li(T)}return null}function qp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sb(r,e,n,a,h,m,y,x,T,D,k){let F=m.textMaxSize.evaluate(e,{});F===void 0&&(F=y);const U=r.layers[0].layout,G=U.get("icon-offset").evaluate(e,{},k),W=kg(n.horizontal),ee=y/24,ue=r.tilePixelRatio*ee,ge=r.tilePixelRatio*F/24,Ce=r.tilePixelRatio*x,be=r.tilePixelRatio*U.get("symbol-spacing"),ke=U.get("text-padding")*r.tilePixelRatio,Le=function(rt,$t,zt,er=1){const Ur=rt.get("icon-padding").evaluate($t,{},zt),jr=Ur&&Ur.values;return[jr[0]*er,jr[1]*er,jr[2]*er,jr[3]*er]}(U,e,k,r.tilePixelRatio),We=U.get("text-max-angle")/180*Math.PI,xt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Nt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",_t=U.get("symbol-placement"),dt=be/2,lt=U.get("icon-text-fit");let Pt;a&&lt!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(Pt=Qm(a,n.vertical,lt,U.get("icon-text-fit-padding"),G,ee)),W&&(a=Qm(a,W,lt,U.get("icon-text-fit-padding"),G,ee)));const ut=(rt,$t)=>{$t.x<0||$t.x>=an||$t.y<0||$t.y>=an||function(zt,er,Ur,jr,_n,ki,fi,ln,kn,$n,mi,gi,vn,xn,ti,yi,ri,wi,Ei,bn,cr,ni,Vn,wn,ss){const Is=zt.addToLineVertexArray(er,Ur);let As,wo,os,$i,Ti=0,Eo=0,zc=0,Ng=0,Kp=-1,Qp=-1;const To={};let Lg=_o("");if(zt.allowVerticalPlacement&&jr.vertical){const ii=ln.layout.get("text-rotate").evaluate(cr,{},wn)+90;os=new ch(kn,er,$n,mi,gi,jr.vertical,vn,xn,ti,ii),fi&&($i=new ch(kn,er,$n,mi,gi,fi,ri,wi,ti,ii))}if(_n){const ii=ln.layout.get("icon-rotate").evaluate(cr,{}),Vi=ln.layout.get("icon-text-fit")!=="none",Ga=Ig(_n,ii,Vn,Vi),Cs=fi?Ig(fi,ii,Vn,Vi):void 0;wo=new ch(kn,er,$n,mi,gi,_n,ri,wi,!1,ii),Ti=4*Ga.length;const Za=zt.iconSizeData;let js=null;Za.kind==="source"?(js=[Vs*ln.layout.get("icon-size").evaluate(cr,{})],js[0]>na&&wt(`${zt.layerIds[0]}: Value for "icon-size" is >= ${Rc}. Reduce your "icon-size".`)):Za.kind==="composite"&&(js=[Vs*ni.compositeIconSizes[0].evaluate(cr,{},wn),Vs*ni.compositeIconSizes[1].evaluate(cr,{},wn)],(js[0]>na||js[1]>na)&&wt(`${zt.layerIds[0]}: Value for "icon-size" is >= ${Rc}. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,Ga,js,bn,Ei,cr,o.ai.none,er,Is.lineStartIndex,Is.lineLength,-1,wn),Kp=zt.icon.placedSymbolArray.length-1,Cs&&(Eo=4*Cs.length,zt.addSymbols(zt.icon,Cs,js,bn,Ei,cr,o.ai.vertical,er,Is.lineStartIndex,Is.lineLength,-1,wn),Qp=zt.icon.placedSymbolArray.length-1)}const Fg=Object.keys(jr.horizontal);for(const ii of Fg){const Vi=jr.horizontal[ii];if(!As){Lg=_o(Vi.text);const Cs=ln.layout.get("text-rotate").evaluate(cr,{},wn);As=new ch(kn,er,$n,mi,gi,Vi,vn,xn,ti,Cs)}const Ga=Vi.positionedLines.length===1;if(zc+=Pg(zt,er,Vi,ki,ln,ti,cr,yi,Is,jr.vertical?o.ai.horizontal:o.ai.horizontalOnly,Ga?Fg:[ii],To,Kp,ni,wn),Ga)break}jr.vertical&&(Ng+=Pg(zt,er,jr.vertical,ki,ln,ti,cr,yi,Is,o.ai.vertical,["vertical"],To,Qp,ni,wn));const Db=As?As.boxStartIndex:zt.collisionBoxArray.length,Cb=As?As.boxEndIndex:zt.collisionBoxArray.length,Pb=os?os.boxStartIndex:zt.collisionBoxArray.length,kb=os?os.boxEndIndex:zt.collisionBoxArray.length,Mb=wo?wo.boxStartIndex:zt.collisionBoxArray.length,Ob=wo?wo.boxEndIndex:zt.collisionBoxArray.length,Rb=$i?$i.boxStartIndex:zt.collisionBoxArray.length,Nb=$i?$i.boxEndIndex:zt.collisionBoxArray.length;let Ds=-1;const hh=(ii,Vi)=>ii&&ii.circleDiameter?Math.max(ii.circleDiameter,Vi):Vi;Ds=hh(As,Ds),Ds=hh(os,Ds),Ds=hh(wo,Ds),Ds=hh($i,Ds);const zg=Ds>-1?1:0;zg&&(Ds*=ss/yn),zt.glyphOffsetArray.length>=Ol.MAX_GLYPHS&&wt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cr.sortKey!==void 0&&zt.addToSortKeyRanges(zt.symbolInstances.length,cr.sortKey);const Lb=Cg(ln,cr,wn),[Fb,zb]=function(ii,Vi){const Ga=ii.length,Cs=Vi==null?void 0:Vi.values;if((Cs==null?void 0:Cs.length)>0)for(let Za=0;Za<Cs.length;Za+=2){const js=Cs[Za+1];ii.emplaceBack(o.aq[Cs[Za]],js[0],js[1])}return[Ga,ii.length]}(zt.textAnchorOffsets,Lb);zt.symbolInstances.emplaceBack(er.x,er.y,To.right>=0?To.right:-1,To.center>=0?To.center:-1,To.left>=0?To.left:-1,To.vertical||-1,Kp,Qp,Lg,Db,Cb,Pb,kb,Mb,Ob,Rb,Nb,$n,zc,Ng,Ti,Eo,zg,0,vn,Ds,Fb,zb)}(r,$t,rt,n,a,h,Pt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,ue,[ke,ke,ke,ke],xt,T,Ce,Le,Nt,G,e,m,D,k,y)};if(_t==="line")for(const rt of xg(e.geometry,0,0,an,an)){const $t=xb(rt,be,We,n.vertical||W,a,24,ge,r.overscaling,an);for(const zt of $t)W&&Ib(r,W.text,dt,zt)||ut(rt,zt)}else if(_t==="line-center"){for(const rt of e.geometry)if(rt.length>1){const $t=vb(rt,We,n.vertical||W,a,24,ge);$t&&ut(rt,$t)}}else if(e.type==="Polygon")for(const rt of wp(e.geometry,0)){const $t=Eb(rt,16);ut(rt[0],new sa($t.x,$t.y,0))}else if(e.type==="LineString")for(const rt of e.geometry)ut(rt,new sa(rt[0].x,rt[0].y,0));else if(e.type==="Point")for(const rt of e.geometry)for(const $t of rt)ut([$t],new sa($t.x,$t.y,0))}function Pg(r,e,n,a,h,m,y,x,T,D,k,F,U,G,W){const ee=function(Ce,be,ke,Le,We,xt,Nt,_t){const dt=Le.layout.get("text-rotate").evaluate(xt,{})*Math.PI/180,lt=[];for(const Pt of be.positionedLines)for(const ut of Pt.positionedGlyphs){if(!ut.rect)continue;const rt=ut.rect||{};let $t=Zm+1,zt=!0,er=1,Ur=0;const jr=(We||_t)&&ut.vertical,_n=ut.metrics.advance*ut.scale/2;if(_t&&be.verticalizable&&(Ur=Pt.lineOffset/2-(ut.imageName?-(yn-ut.metrics.width*ut.scale)/2:(ut.scale-1)*yn)),ut.imageName){const bn=Nt[ut.imageName];zt=bn.sdf,er=bn.pixelRatio,$t=bi/er}const ki=We?[ut.x+_n,ut.y]:[0,0];let fi=We?[0,0]:[ut.x+_n+ke[0],ut.y+ke[1]-Ur],ln=[0,0];jr&&(ln=fi,fi=[0,0]);const kn=ut.metrics.isDoubleResolution?2:1,$n=(ut.metrics.left-$t)*ut.scale-_n+fi[0],mi=(-ut.metrics.top-$t)*ut.scale+fi[1],gi=$n+rt.w/kn*ut.scale/er,vn=mi+rt.h/kn*ut.scale/er,xn=new P($n,mi),ti=new P(gi,mi),yi=new P($n,vn),ri=new P(gi,vn);if(jr){const bn=new P(-_n,_n-Mc),cr=-Math.PI/2,ni=yn/2-_n,Vn=new P(5-Mc-ni,-(ut.imageName?ni:0)),wn=new P(...ln);xn._rotateAround(cr,bn)._add(Vn)._add(wn),ti._rotateAround(cr,bn)._add(Vn)._add(wn),yi._rotateAround(cr,bn)._add(Vn)._add(wn),ri._rotateAround(cr,bn)._add(Vn)._add(wn)}if(dt){const bn=Math.sin(dt),cr=Math.cos(dt),ni=[cr,-bn,bn,cr];xn._matMult(ni),ti._matMult(ni),yi._matMult(ni),ri._matMult(ni)}const wi=new P(0,0),Ei=new P(0,0);lt.push({tl:xn,tr:ti,bl:yi,br:ri,tex:rt,writingMode:be.writingMode,glyphOffset:ki,sectionIndex:ut.sectionIndex,isSDF:zt,pixelOffsetTL:wi,pixelOffsetBR:Ei,minFontScaleX:0,minFontScaleY:0})}return lt}(0,n,x,h,m,y,a,r.allowVerticalPlacement),ue=r.textSizeData;let ge=null;ue.kind==="source"?(ge=[Vs*h.layout.get("text-size").evaluate(y,{})],ge[0]>na&&wt(`${r.layerIds[0]}: Value for "text-size" is >= ${Rc}. Reduce your "text-size".`)):ue.kind==="composite"&&(ge=[Vs*G.compositeTextSizes[0].evaluate(y,{},W),Vs*G.compositeTextSizes[1].evaluate(y,{},W)],(ge[0]>na||ge[1]>na)&&wt(`${r.layerIds[0]}: Value for "text-size" is >= ${Rc}. Reduce your "text-size".`)),r.addSymbols(r.text,ee,ge,x,m,y,D,e,T.lineStartIndex,T.lineLength,U,W);for(const Ce of k)F[Ce]=r.text.placedSymbolArray.length-1;return 4*ee.length}function kg(r){for(const e in r)return r[e];return null}function Ib(r,e,n,a){const h=r.compareText;if(e in h){const m=h[e];for(let y=m.length-1;y>=0;y--)if(a.dist(m[y])<n)return!0}else h[e]=[];return h[e].push(a),!1}const Mg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=Mg[15&a];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Gp(x,y,m,e)}constructor(e,n=64,a=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=Mg.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Zp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:x}=this,T=[0,m.length-1,0],D=[];for(;T.length;){const k=T.pop()||0,F=T.pop()||0,U=T.pop()||0;if(F-U<=x){for(let ue=U;ue<=F;ue++){const ge=y[2*ue],Ce=y[2*ue+1];ge>=e&&ge<=a&&Ce>=n&&Ce<=h&&D.push(m[ue])}continue}const G=U+F>>1,W=y[2*G],ee=y[2*G+1];W>=e&&W<=a&&ee>=n&&ee<=h&&D.push(m[G]),(k===0?e<=W:n<=ee)&&(T.push(U),T.push(G-1),T.push(1-k)),(k===0?a>=W:h>=ee)&&(T.push(G+1),T.push(F),T.push(1-k))}return D}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:y}=this,x=[0,h.length-1,0],T=[],D=a*a;for(;x.length;){const k=x.pop()||0,F=x.pop()||0,U=x.pop()||0;if(F-U<=y){for(let ue=U;ue<=F;ue++)Rg(m[2*ue],m[2*ue+1],e,n)<=D&&T.push(h[ue]);continue}const G=U+F>>1,W=m[2*G],ee=m[2*G+1];Rg(W,ee,e,n)<=D&&T.push(h[G]),(k===0?e-a<=W:n-a<=ee)&&(x.push(U),x.push(G-1),x.push(1-k)),(k===0?e+a>=W:n+a>=ee)&&(x.push(G+1),x.push(F),x.push(1-k))}return T}}function Zp(r,e,n,a,h,m){if(h-a<=n)return;const y=a+h>>1;Og(r,e,y,a,h,m),Zp(r,e,n,a,y-1,1-m),Zp(r,e,n,y+1,h,1-m)}function Og(r,e,n,a,h,m){for(;h>a;){if(h-a>600){const D=h-a+1,k=n-a+1,F=Math.log(D),U=.5*Math.exp(2*F/3),G=.5*Math.sqrt(F*U*(D-U)/D)*(k-D/2<0?-1:1);Og(r,e,n,Math.max(a,Math.floor(n-k*U/D+G)),Math.min(h,Math.floor(n+(D-k)*U/D+G)),m)}const y=e[2*n+m];let x=a,T=h;for(Lc(r,e,a,n),e[2*h+m]>y&&Lc(r,e,a,h);x<T;){for(Lc(r,e,x,T),x++,T--;e[2*x+m]<y;)x++;for(;e[2*T+m]>y;)T--}e[2*a+m]===y?Lc(r,e,a,T):(T++,Lc(r,e,T,h)),T<=n&&(a=T+1),n<=T&&(h=T-1)}}function Lc(r,e,n,a){Hp(r,n,a),Hp(e,2*n,2*a),Hp(e,2*n+1,2*a+1)}function Hp(r,e,n){const a=r[e];r[e]=r[n],r[n]=a}function Rg(r,e,n,a){const h=r-n,m=e-a;return h*h+m*m}var Wp;o.bh=void 0,(Wp=o.bh||(o.bh={})).create="create",Wp.load="load",Wp.fullLoad="fullLoad";let uh=null,Fc=[];const Xp=1e3/60,Yp="loadTime",Jp="fullLoadTime",Ab={mark(r){performance.mark(r)},frame(r){const e=r;uh!=null&&Fc.push(e-uh),uh=e},clearMetrics(){uh=null,Fc=[],performance.clearMeasures(Yp),performance.clearMeasures(Jp);for(const r in o.bh)performance.clearMarks(o.bh[r])},getPerformanceMetrics(){performance.measure(Yp,o.bh.create,o.bh.load),performance.measure(Jp,o.bh.create,o.bh.fullLoad);const r=performance.getEntriesByName(Yp)[0].duration,e=performance.getEntriesByName(Jp)[0].duration,n=Fc.length,a=1/(Fc.reduce((m,y)=>m+y,0)/n/1e3),h=Fc.filter(m=>m>Xp).reduce((m,y)=>m+(y-Xp)/Xp,0);return{loadTime:r,fullLoadTime:e,fps:a,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};o.$=function(r,e,n){var a,h,m,y,x,T,D,k,F,U,G,W,ee=n[0],ue=n[1],ge=n[2];return e===r?(r[12]=e[0]*ee+e[4]*ue+e[8]*ge+e[12],r[13]=e[1]*ee+e[5]*ue+e[9]*ge+e[13],r[14]=e[2]*ee+e[6]*ue+e[10]*ge+e[14],r[15]=e[3]*ee+e[7]*ue+e[11]*ge+e[15]):(h=e[1],m=e[2],y=e[3],x=e[4],T=e[5],D=e[6],k=e[7],F=e[8],U=e[9],G=e[10],W=e[11],r[0]=a=e[0],r[1]=h,r[2]=m,r[3]=y,r[4]=x,r[5]=T,r[6]=D,r[7]=k,r[8]=F,r[9]=U,r[10]=G,r[11]=W,r[12]=a*ee+x*ue+F*ge+e[12],r[13]=h*ee+T*ue+U*ge+e[13],r[14]=m*ee+D*ue+G*ge+e[14],r[15]=y*ee+k*ue+W*ge+e[15]),r},o.A=Al,o.B=Fn,o.C=class{constructor(r,e,n){this.receive=a=>{const h=a.data,m=h.id;if(m&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){delete this.tasks[m];const y=this.cancelCallbacks[m];delete this.cancelCallbacks[m],y&&y()}else ht()||h.mustQueue?(this.tasks[m]=h,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,h)},this.process=()=>{if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),h=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),h&&this.processTask(a,h)},this.target=r,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new yb(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ht()?r:window}send(r,e,n,a,h=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[m]=n);const y=[],x={id:m,type:r,hasCallback:!!n,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:Bs(e,y)};return this.target.postMessage(x,{transfer:y}),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}processTask(r,e){if(e.type==="<response>"){const n=this.callbacks[r];delete this.callbacks[r],n&&(e.error?n(Jo(e.error)):n(null,Jo(e.data)))}else{let n=!1;const a=[],h=e.hasCallback?(x,T)=>{n=!0,delete this.cancelCallbacks[r];const D={id:r,type:"<response>",sourceMapId:this.mapId,error:x?Bs(x):null,data:Bs(T,a)};this.target.postMessage(D,{transfer:a})}:x=>{n=!0};let m=null;const y=Jo(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,y,h);else if("getWorkerSource"in this.parent){const x=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,x[0],y.source)[x[1]](y,h)}else h(new Error(`Could not find function ${e.type}`));!n&&m&&m.cancel&&(this.cancelCallbacks[r]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.D=Bt,o.E=Xe,o.F=function(r,e){const n={};for(let a=0;a<e.length;a++){const h=e[a];h in r&&(n[h]=r[h])}return n},o.G=lg,o.H=cg,o.I=Mp,o.J=Oe,o.K=Pe,o.L=ia,o.M=mt,o.N=an,o.O=Ui,o.P=P,o.Q=qr,o.R=Bi,o.S=Br,o.T=Bu,o.U=sh,o.V=class extends go{},o.W=Vp,o.X=function(r,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<r.length;a++){const h=window.document.createElement("source");gr(r[a])||(n.crossOrigin="Anonymous"),h.src=r[a],n.appendChild(h)}return{cancel:()=>{}}},o.Y=it,o.Z=function(){var r=new Al(16);return Al!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},o._=I,o.a=ft,o.a$=class extends j{},o.a0=function(r,e,n){var a=n[0],h=n[1],m=n[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*h,r[5]=e[5]*h,r[6]=e[6]*h,r[7]=e[7]*h,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},o.a1=dm,o.a2=function(){return Y++},o.a3=oe,o.a4=Ol,o.a5=function(){vi.isLoading()||vi.isLoaded()||hc()!=="deferred"||zu()},o.a6=Na,o.a7=ja,o.a8=zr,o.a9=gg,o.aA=Fa,o.aB=function(r){r=r.slice();const e=Object.create(null);for(let n=0;n<r.length;n++)e[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=wr(r[n],e[r[n].ref]));return r},o.aC=function(r){if(r.type==="custom")return new gb(r);switch(r.type){case"background":return new db(r);case"circle":return new K0(r);case"fill":return new _x(r);case"fill-extrusion":return new Ox(r);case"heatmap":return new ex(r);case"hillshade":return new rx(r);case"line":return new $x(r);case"raster":return new mb(r);case"symbol":return new ih(r)}},o.aD=Ye,o.aE=function(r,e){if(!r)return[{command:sr.setStyle,args:[e]}];let n=[];try{if(!ur(r.version,e.version))return[{command:sr.setStyle,args:[e]}];ur(r.center,e.center)||n.push({command:sr.setCenter,args:[e.center]}),ur(r.zoom,e.zoom)||n.push({command:sr.setZoom,args:[e.zoom]}),ur(r.bearing,e.bearing)||n.push({command:sr.setBearing,args:[e.bearing]}),ur(r.pitch,e.pitch)||n.push({command:sr.setPitch,args:[e.pitch]}),ur(r.sprite,e.sprite)||n.push({command:sr.setSprite,args:[e.sprite]}),ur(r.glyphs,e.glyphs)||n.push({command:sr.setGlyphs,args:[e.glyphs]}),ur(r.transition,e.transition)||n.push({command:sr.setTransition,args:[e.transition]}),ur(r.light,e.light)||n.push({command:sr.setLight,args:[e.light]});const a={},h=[];(function(y,x,T,D){let k;for(k in x=x||{},y=y||{})Object.prototype.hasOwnProperty.call(y,k)&&(Object.prototype.hasOwnProperty.call(x,k)||Ii(k,T,D));for(k in x)Object.prototype.hasOwnProperty.call(x,k)&&(Object.prototype.hasOwnProperty.call(y,k)?ur(y[k],x[k])||(y[k].type==="geojson"&&x[k].type==="geojson"&&ds(y,x,k)?T.push({command:sr.setGeoJSONSourceData,args:[k,x[k].data]}):Ln(k,x,T,D)):Nn(k,x,T))})(r.sources,e.sources,h,a);const m=[];r.layers&&r.layers.forEach(y=>{a[y.source]?n.push({command:sr.removeLayer,args:[y.id]}):m.push(y)}),n=n.concat(h),function(y,x,T){x=x||[];const D=(y=y||[]).map(oi),k=x.map(oi),F=y.reduce(ai,{}),U=x.reduce(ai,{}),G=D.slice(),W=Object.create(null);let ee,ue,ge,Ce,be,ke,Le;for(ee=0,ue=0;ee<D.length;ee++)ge=D[ee],Object.prototype.hasOwnProperty.call(U,ge)?ue++:(T.push({command:sr.removeLayer,args:[ge]}),G.splice(G.indexOf(ge,ue),1));for(ee=0,ue=0;ee<k.length;ee++)ge=k[k.length-1-ee],G[G.length-1-ee]!==ge&&(Object.prototype.hasOwnProperty.call(F,ge)?(T.push({command:sr.removeLayer,args:[ge]}),G.splice(G.lastIndexOf(ge,G.length-ue),1)):ue++,ke=G[G.length-ee],T.push({command:sr.addLayer,args:[U[ge],ke]}),G.splice(G.length-ee,0,ge),W[ge]=!0);for(ee=0;ee<k.length;ee++)if(ge=k[ee],Ce=F[ge],be=U[ge],!W[ge]&&!ur(Ce,be))if(ur(Ce.source,be.source)&&ur(Ce["source-layer"],be["source-layer"])&&ur(Ce.type,be.type)){for(Le in Ri(Ce.layout,be.layout,T,ge,null,sr.setLayoutProperty),Ri(Ce.paint,be.paint,T,ge,null,sr.setPaintProperty),ur(Ce.filter,be.filter)||T.push({command:sr.setFilter,args:[ge,be.filter]}),ur(Ce.minzoom,be.minzoom)&&ur(Ce.maxzoom,be.maxzoom)||T.push({command:sr.setLayerZoomRange,args:[ge,be.minzoom,be.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?Ri(Ce[Le],be[Le],T,ge,Le.slice(6),sr.setPaintProperty):ur(Ce[Le],be[Le])||T.push({command:sr.setLayerProperty,args:[ge,Le,be[Le]]}));for(Le in be)Object.prototype.hasOwnProperty.call(be,Le)&&!Object.prototype.hasOwnProperty.call(Ce,Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?Ri(Ce[Le],be[Le],T,ge,Le.slice(6),sr.setPaintProperty):ur(Ce[Le],be[Le])||T.push({command:sr.setLayerProperty,args:[ge,Le,be[Le]]}))}else T.push({command:sr.removeLayer,args:[ge]}),ke=G[G.lastIndexOf(ge)+1],T.push({command:sr.addLayer,args:[be,ke]})}(m,e.layers,n)}catch(a){console.warn("Unable to compute style diff:",a),n=[{command:sr.setStyle,args:[e]}]}return n},o.aF=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.aG=function r(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let a=0;a<e.length;a++)if(!r(e[a],n[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const a in e)if(!r(e[a],n[a]))return!1;return!0}return e===n},o.aH=xe,o.aI=Ge,o.aJ=za,o.aK=function(r){return r({pluginStatus:hi,pluginURL:Us}),za.on("pluginStateChange",r),r},o.aL=class extends vo{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},o.aM=Sl,o.aN=class extends vo{constructor(r,e){super(r,e),this.current=up}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},o.aO=ju,o.aP=class extends vo{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},o.aQ=class extends vo{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},o.aR=qu,o.aS=function(r,e,n,a,h,m,y){var x=1/(e-n),T=1/(a-h),D=1/(m-y);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*T,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*D,r[11]=0,r[12]=(e+n)*x,r[13]=(h+a)*T,r[14]=(y+m)*D,r[15]=1,r},o.aT=xr,o.aU=J0,o.aV=class extends u{},o.aW=Gx,o.aX=class extends g{},o.aY=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},o.aZ=_m,o.a_=st,o.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,h,m)=>{const y=h||m;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},o.ab=function(r,e){const n=[];for(const a in r)a in e||n.push(a);return n},o.ac=function(r){if(et==null){const e=r.navigator?r.navigator.userAgent:null;et=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return et},o.ad=ce,o.ae=function(r,e,n){var a=Math.sin(n),h=Math.cos(n),m=e[0],y=e[1],x=e[2],T=e[3],D=e[4],k=e[5],F=e[6],U=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*h+D*a,r[1]=y*h+k*a,r[2]=x*h+F*a,r[3]=T*h+U*a,r[4]=D*h-m*a,r[5]=k*h-y*a,r[6]=F*h-x*a,r[7]=U*h-T*a,r},o.af=function(r){var e=new Al(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},o.ag=Wu,o.ah=function(r,e){let n=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:h,minZoom:m,maxZoom:y}=r,x=h?ce(Wn.interpolationFactor(h,e,m,y),0,1):0;r.kind==="camera"?a=Fn.number(r.minSize,r.maxSize,x):n=x}return{uSizeT:n,uSize:a}},o.aj=function(r,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:h}){return r.kind==="source"?a/Vs:r.kind==="composite"?Fn.number(a/Vs,h/Vs,n):e},o.ak=Lp,o.al=function(r,e,n,a){const h=e.y-r.y,m=e.x-r.x,y=a.y-n.y,x=a.x-n.x,T=y*m-x*h;if(T===0)return null;const D=(x*(r.y-n.y)-y*(r.x-n.x))/T;return new P(r.x+D*m,r.y+D*h)},o.am=xg,o.an=am,o.ao=mp,o.ap=yn,o.ar=Np,o.as=function(r,e){var n=e[0],a=e[1],h=e[2],m=e[3],y=e[4],x=e[5],T=e[6],D=e[7],k=e[8],F=e[9],U=e[10],G=e[11],W=e[12],ee=e[13],ue=e[14],ge=e[15],Ce=n*x-a*y,be=n*T-h*y,ke=n*D-m*y,Le=a*T-h*x,We=a*D-m*x,xt=h*D-m*T,Nt=k*ee-F*W,_t=k*ue-U*W,dt=k*ge-G*W,lt=F*ue-U*ee,Pt=F*ge-G*ee,ut=U*ge-G*ue,rt=Ce*ut-be*Pt+ke*lt+Le*dt-We*_t+xt*Nt;return rt?(r[0]=(x*ut-T*Pt+D*lt)*(rt=1/rt),r[1]=(h*Pt-a*ut-m*lt)*rt,r[2]=(ee*xt-ue*We+ge*Le)*rt,r[3]=(U*We-F*xt-G*Le)*rt,r[4]=(T*dt-y*ut-D*_t)*rt,r[5]=(n*ut-h*dt+m*_t)*rt,r[6]=(ue*ke-W*xt-ge*be)*rt,r[7]=(k*xt-U*ke+G*be)*rt,r[8]=(y*Pt-x*dt+D*Nt)*rt,r[9]=(a*dt-n*Pt-m*Nt)*rt,r[10]=(W*We-ee*ke+ge*Ce)*rt,r[11]=(F*ke-k*We-G*Ce)*rt,r[12]=(x*_t-y*lt-T*Nt)*rt,r[13]=(n*lt-a*_t+h*Nt)*rt,r[14]=(ee*be-W*Le-ue*Ce)*rt,r[15]=(k*Le-F*be+U*Ce)*rt,r):null},o.at=qp,o.au=Rp,o.av=Gp,o.aw=function(){const r={},e=$e.$version;for(const n in $e.$root){const a=$e.$root[n];if(a.required){let h=null;h=n==="version"?e:a.type==="array"?[]:{},h!=null&&(r[n]=h)}}return r},o.ax=sr,o.ay=Ru,o.az=It,o.b=function(r,e){const n=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(n).then(a=>{e(null,a)}).catch(a=>{e(new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.b0=Cn,o.b1=function(r,e){var n=r[0],a=r[1],h=r[2],m=r[3],y=r[4],x=r[5],T=r[6],D=r[7],k=r[8],F=r[9],U=r[10],G=r[11],W=r[12],ee=r[13],ue=r[14],ge=r[15],Ce=e[0],be=e[1],ke=e[2],Le=e[3],We=e[4],xt=e[5],Nt=e[6],_t=e[7],dt=e[8],lt=e[9],Pt=e[10],ut=e[11],rt=e[12],$t=e[13],zt=e[14],er=e[15];return Math.abs(n-Ce)<=di*Math.max(1,Math.abs(n),Math.abs(Ce))&&Math.abs(a-be)<=di*Math.max(1,Math.abs(a),Math.abs(be))&&Math.abs(h-ke)<=di*Math.max(1,Math.abs(h),Math.abs(ke))&&Math.abs(m-Le)<=di*Math.max(1,Math.abs(m),Math.abs(Le))&&Math.abs(y-We)<=di*Math.max(1,Math.abs(y),Math.abs(We))&&Math.abs(x-xt)<=di*Math.max(1,Math.abs(x),Math.abs(xt))&&Math.abs(T-Nt)<=di*Math.max(1,Math.abs(T),Math.abs(Nt))&&Math.abs(D-_t)<=di*Math.max(1,Math.abs(D),Math.abs(_t))&&Math.abs(k-dt)<=di*Math.max(1,Math.abs(k),Math.abs(dt))&&Math.abs(F-lt)<=di*Math.max(1,Math.abs(F),Math.abs(lt))&&Math.abs(U-Pt)<=di*Math.max(1,Math.abs(U),Math.abs(Pt))&&Math.abs(G-ut)<=di*Math.max(1,Math.abs(G),Math.abs(ut))&&Math.abs(W-rt)<=di*Math.max(1,Math.abs(W),Math.abs(rt))&&Math.abs(ee-$t)<=di*Math.max(1,Math.abs(ee),Math.abs($t))&&Math.abs(ue-zt)<=di*Math.max(1,Math.abs(ue),Math.abs(zt))&&Math.abs(ge-er)<=di*Math.max(1,Math.abs(ge),Math.abs(er))},o.b2=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},o.b3=function(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r[3]=e[3]*n[3],r},o.b4=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},o.b5=Ae,o.b6=dg,o.b7=ug,o.b8=function(r,e,n,a,h){var m,y=1/Math.tan(e/2);return r[0]=y/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+a)*(m=1/(a-h)),r[14]=2*h*a*m):(r[10]=-1,r[14]=-2*a),r},o.b9=function(r,e,n){var a=Math.sin(n),h=Math.cos(n),m=e[4],y=e[5],x=e[6],T=e[7],D=e[8],k=e[9],F=e[10],U=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*h+D*a,r[5]=y*h+k*a,r[6]=x*h+F*a,r[7]=T*h+U*a,r[8]=D*h-m*a,r[9]=k*h-y*a,r[10]=F*h-x*a,r[11]=U*h-T*a,r},o.bA=L,o.bB=Bm,o.bC=qo,o.bD=vi,o.ba=ne,o.bb=de,o.bc=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},o.bd=class extends $a{},o.be=Up,o.bf=hg,o.bg=Ab,o.bi=ot,o.bj=function(r,e,n=!1){if(hi===oc||hi===ac||hi===lc)throw new Error("setRTLTextPlugin cannot be called multiple times.");Us=St.resolveURL(r),hi=oc,cc=e,uc(),n||zu()},o.bk=hc,o.bl=function(r,e){const n={};for(let h=0;h<r.length;h++){const m=e&&e[r[h].id]||Xo(r[h]);e&&(e[r[h].id]=m);let y=n[m];y||(y=n[m]=[]),y.push(r[h])}const a=[];for(const h in n)a.push(n[h]);return a},o.bm=bt,o.bn=mg,o.bo=yg,o.bp=Wm,o.bq=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=an/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],n=e.layout,a=e._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new zr(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new zr(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new zr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:k}=r.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new zr(D),r.canonical),a["text-size"].possiblyEvaluate(new zr(k),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:k}=r.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new zr(D),r.canonical),a["icon-size"].possiblyEvaluate(new zr(k),r.canonical)]}const m=n.get("text-line-height")*yn,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",x=n.get("text-keep-upright"),T=n.get("text-size");for(const D of r.bucket.features){const k=n.get("text-font").evaluate(D,{},r.canonical).join(","),F=T.evaluate(D,{},r.canonical),U=h.layoutTextSize.evaluate(D,{},r.canonical),G=h.layoutIconSize.evaluate(D,{},r.canonical),W={horizontal:{},vertical:void 0},ee=D.text;let ue,ge=[0,0];if(ee){const ke=ee.toString(),Le=n.get("text-letter-spacing").evaluate(D,{},r.canonical)*yn,We=ic(ke)?Le:0,xt=n.get("text-anchor").evaluate(D,{},r.canonical),Nt=Cg(e,D,r.canonical);if(!Nt){const ut=n.get("text-radial-offset").evaluate(D,{},r.canonical);ge=ut?Dg(xt,[ut*yn,jp]):n.get("text-offset").evaluate(D,{},r.canonical).map(rt=>rt*yn)}let _t=y?"center":n.get("text-justify").evaluate(D,{},r.canonical);const dt=n.get("symbol-placement"),lt=dt==="point"?n.get("text-max-width").evaluate(D,{},r.canonical)*yn:0,Pt=()=>{r.bucket.allowVerticalPlacement&&nc(ke)&&(W.vertical=th(ee,r.glyphMap,r.glyphPositions,r.imagePositions,k,lt,m,xt,"left",We,ge,o.ai.vertical,!0,dt,U,F))};if(!y&&Nt){const ut=new Set;if(_t==="auto")for(let $t=0;$t<Nt.values.length;$t+=2)ut.add(qp(Nt.values[$t]));else ut.add(_t);let rt=!1;for(const $t of ut)if(!W.horizontal[$t])if(rt)W.horizontal[$t]=W.horizontal[0];else{const zt=th(ee,r.glyphMap,r.glyphPositions,r.imagePositions,k,lt,m,"center",$t,We,ge,o.ai.horizontal,!1,dt,U,F);zt&&(W.horizontal[$t]=zt,rt=zt.positionedLines.length===1)}Pt()}else{_t==="auto"&&(_t=qp(xt));const ut=th(ee,r.glyphMap,r.glyphPositions,r.imagePositions,k,lt,m,xt,_t,We,ge,o.ai.horizontal,!1,dt,U,F);ut&&(W.horizontal[_t]=ut),Pt(),nc(ke)&&y&&x&&(W.vertical=th(ee,r.glyphMap,r.glyphPositions,r.imagePositions,k,lt,m,xt,_t,We,ge,o.ai.vertical,!1,dt,U,F))}}let Ce=!1;if(D.icon&&D.icon.name){const ke=r.imageMap[D.icon.name];ke&&(ue=lb(r.imagePositions[D.icon.name],n.get("icon-offset").evaluate(D,{},r.canonical),n.get("icon-anchor").evaluate(D,{},r.canonical)),Ce=!!ke.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=Ce:r.bucket.sdfIcons!==Ce&&wt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const be=kg(W.horizontal)||W.vertical;r.bucket.iconsInText=!!be&&be.iconsInText,(be||ue)&&Sb(r.bucket,D,W,ue,r.imageMap,h,U,G,ge,Ce,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},o.br=Dp,o.bs=Sp,o.bt=Ap,o.bu=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},o.bv=Pp,o.bw=ta,o.bx=function(r,e,n,a,h){return I(this,void 0,void 0,function*(){if(Pe())try{return yield mt(r,e,n,a,h)}catch{}return function(m,y,x,T,D){const k=m.width,F=m.height;Q&&we||(Q=new OffscreenCanvas(k,F),we=Q.getContext("2d",{willReadFrequently:!0})),Q.width=k,Q.height=F,we.drawImage(m,0,0,k,F);const U=we.getImageData(y,x,T,D);return we.clearRect(0,0,k,F),U.data}(r,e,n,a,h)})},o.by=fg,o.bz=A,o.c=Mt,o.d=function(r,e){const n=new Image;n.onload=()=>{e(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=Ut})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new Blob([new Uint8Array(r)],{type:"image/png"});n.src=r.byteLength?URL.createObjectURL(a):Ut},o.e=Me,o.f=function(r,e){return Yt(Me(r,{type:"json"}),e)},o.g=jt,o.h=St,o.i=ht,o.j=Dn,o.k=An,o.l=hn,o.m=Yt,o.n=function(r){return new Pp(r).readFields(rb,[])},o.o=function(r,e,n){if(!r.length)return n(null,[]);let a=r.length;const h=new Array(r.length);let m=null;r.forEach((y,x)=>{e(y,(T,D)=>{T&&(m=T),h[x]=D,--a==0&&n(m,h)})})},o.p=Hm,o.q=Tc,o.r=tn,o.s=gr,o.t=Ar,o.u=vt,o.v=$e,o.w=wt,o.x=ui,o.y=Ft,o.z=function([r,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(n),y:r*Math.sin(e)*Math.sin(n),z:r*Math.cos(n)}}}),v(["./shared"],function(o){class I{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,B){for(const se of O){this._layerConfigs[se.id]=se;const ae=this._layers[se.id]=o.aC(se);ae._featureFilter=o.a6(ae.filter),this.keyCache[se.id]&&delete this.keyCache[se.id]}for(const se of B)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const X=o.bl(Object.values(this._layerConfigs),this.keyCache);for(const se of X){const ae=se.map(Ve=>this._layers[Ve.id]),Ie=ae[0];if(Ie.visibility==="none")continue;const ve=Ie.source||"";let he=this.familiesBySource[ve];he||(he=this.familiesBySource[ve]={});const Te=Ie.sourceLayer||"_geojsonTileLayer";let Ue=he[Te];Ue||(Ue=he[Te]=[]),Ue.push(ae)}}}class A{constructor(O){const B={},X=[];for(const ve in O){const he=O[ve],Te=B[ve]={};for(const Ue in he){const Ve=he[+Ue];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const qe={x:0,y:0,w:Ve.bitmap.width+2,h:Ve.bitmap.height+2};X.push(qe),Te[Ue]={rect:qe,metrics:Ve.metrics}}}const{w:se,h:ae}=o.p(X),Ie=new o.q({width:se||1,height:ae||1});for(const ve in O){const he=O[ve];for(const Te in he){const Ue=he[+Te];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ve=B[ve][Te].rect;o.q.copy(Ue.bitmap,Ie,{x:0,y:0},{x:Ve.x+1,y:Ve.y+1},Ue.bitmap)}}this.image=Ie,this.positions=B}}o.bm("GlyphAtlas",A);class L{constructor(O){this.tileID=new o.O(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(O,B,X,se,ae){this.status="parsing",this.data=O,this.collisionBoxArray=new o.a3;const Ie=new o.bn(Object.keys(O.layers).sort()),ve=new o.bo(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const he={},Te={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:X},Ue=B.familiesBySource[this.source];for(const hr in Ue){const or=O.layers[hr];if(!or)continue;or.version===1&&o.w(`Vector tile source "${this.source}" layer "${hr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pn=Ie.encode(hr),Ir=[];for(let Yr=0;Yr<or.length;Yr++){const dn=or.feature(Yr),Gn=ve.getId(dn,hr);Ir.push({feature:dn,id:Gn,index:Yr,sourceLayerIndex:pn})}for(const Yr of Ue[hr]){const dn=Yr[0];dn.source!==this.source&&o.w(`layer.source = ${dn.source} does not equal this.source = ${this.source}`),dn.minzoom&&this.zoom<Math.floor(dn.minzoom)||dn.maxzoom&&this.zoom>=dn.maxzoom||dn.visibility!=="none"&&(R(Yr,this.zoom,X),(he[dn.id]=dn.createBucket({index:ve.bucketLayerIDs.length,layers:Yr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pn,sourceID:this.source})).populate(Ir,Te,this.tileID.canonical),ve.bucketLayerIDs.push(Yr.map(Gn=>Gn.id)))}}let Ve,qe,Ct,kt;const At=o.aH(Te.glyphDependencies,hr=>Object.keys(hr).map(Number));this.inFlightDependencies.forEach(hr=>hr==null?void 0:hr.cancel()),this.inFlightDependencies=[];const Ot=++this.dependencySentinel;Object.keys(At).length?this.inFlightDependencies.push(se.send("getGlyphs",{uid:this.uid,stacks:At,source:this.source,tileID:this.tileID,type:"glyphs"},(hr,or)=>{Ot===this.dependencySentinel&&(Ve||(Ve=hr,qe=or,Tr.call(this)))})):qe={};const Zt=Object.keys(Te.iconDependencies);Zt.length?this.inFlightDependencies.push(se.send("getImages",{icons:Zt,source:this.source,tileID:this.tileID,type:"icons"},(hr,or)=>{Ot===this.dependencySentinel&&(Ve||(Ve=hr,Ct=or,Tr.call(this)))})):Ct={};const yr=Object.keys(Te.patternDependencies);function Tr(){if(Ve)return ae(Ve);if(qe&&Ct&&kt){const hr=new A(qe),or=new o.bp(Ct,kt);for(const pn in he){const Ir=he[pn];Ir instanceof o.a4?(R(Ir.layers,this.zoom,X),o.bq({bucket:Ir,glyphMap:qe,glyphPositions:hr.positions,imageMap:Ct,imagePositions:or.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ir.hasPattern&&(Ir instanceof o.br||Ir instanceof o.bs||Ir instanceof o.bt)&&(R(Ir.layers,this.zoom,X),Ir.addFeatures(Te,this.tileID.canonical,or.patternPositions))}this.status="done",ae(null,{buckets:Object.values(he).filter(pn=>!pn.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hr.image,imageAtlas:or,glyphMap:this.returnDependencies?qe:null,iconMap:this.returnDependencies?Ct:null,glyphPositions:this.returnDependencies?hr.positions:null})}}yr.length?this.inFlightDependencies.push(se.send("getImages",{icons:yr,source:this.source,tileID:this.tileID,type:"patterns"},(hr,or)=>{Ot===this.dependencySentinel&&(Ve||(Ve=hr,kt=or,Tr.call(this)))})):kt={},Tr.call(this)}}function R($,O,B){const X=new o.a8(O);for(const se of $)se.recalculate(X,B)}function P($,O){const B=o.l($.request,(X,se,ae,Ie)=>{if(X)O(X);else if(se)try{const ve=new o.bw.VectorTile(new o.bv(se));O(null,{vectorTile:ve,rawData:se,cacheControl:ae,expires:Ie})}catch(ve){const he=new Uint8Array(se);let Te=`Unable to parse the tile at ${$.request.url}, `;Te+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ve.messge}`,O(new Error(Te))}});return()=>{B.cancel(),O()}}class q{constructor(O,B,X,se){this.actor=O,this.layerIndex=B,this.availableImages=X,this.loadVectorData=se||P,this.fetching={},this.loading={},this.loaded={}}loadTile(O,B){const X=O.uid;this.loading||(this.loading={});const se=!!(O&&O.request&&O.request.collectResourceTiming)&&new o.bu(O.request),ae=this.loading[X]=new L(O);ae.abort=this.loadVectorData(O,(Ie,ve)=>{if(delete this.loading[X],Ie||!ve)return ae.status="done",this.loaded[X]=ae,B(Ie);const he=ve.rawData,Te={};ve.expires&&(Te.expires=ve.expires),ve.cacheControl&&(Te.cacheControl=ve.cacheControl);const Ue={};if(se){const Ve=se.finish();Ve&&(Ue.resourceTiming=JSON.parse(JSON.stringify(Ve)))}ae.vectorTile=ve.vectorTile,ae.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ve,qe)=>{if(delete this.fetching[X],Ve||!qe)return B(Ve);B(null,o.e({rawTileData:he.slice(0)},qe,Te,Ue))}),this.loaded=this.loaded||{},this.loaded[X]=ae,this.fetching[X]={rawTileData:he,cacheControl:Te,resourceTiming:Ue}})}reloadTile(O,B){const X=this.loaded,se=O.uid;if(X&&X[se]){const ae=X[se];ae.showCollisionBoxes=O.showCollisionBoxes,ae.status==="parsing"?ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ie,ve)=>{if(Ie||!ve)return B(Ie,ve);let he;if(this.fetching[se]){const{rawTileData:Te,cacheControl:Ue,resourceTiming:Ve}=this.fetching[se];delete this.fetching[se],he=o.e({rawTileData:Te.slice(0)},ve,Ue,Ve)}else he=ve;B(null,he)}):ae.status==="done"&&(ae.vectorTile?ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,B):B())}}abortTile(O,B){const X=this.loading,se=O.uid;X&&X[se]&&X[se].abort&&(X[se].abort(),delete X[se]),B()}removeTile(O,B){const X=this.loaded,se=O.uid;X&&X[se]&&delete X[se],B()}}class ie{constructor(){this.loaded={}}loadTile(O,B){return o._(this,void 0,void 0,function*(){const{uid:X,encoding:se,rawImageData:ae,redFactor:Ie,greenFactor:ve,blueFactor:he,baseShift:Te}=O,Ue=ae.width+2,Ve=ae.height+2,qe=o.a(ae)?new o.R({width:Ue,height:Ve},yield o.bx(ae,-1,-1,Ue,Ve)):ae,Ct=new o.by(X,qe,se,Ie,ve,he,Te);this.loaded=this.loaded||{},this.loaded[X]=Ct,B(null,Ct)})}removeTile(O){const B=this.loaded,X=O.uid;B&&B[X]&&delete B[X]}}function le($,O){if($.length!==0){V($[0],O);for(var B=1;B<$.length;B++)V($[B],!O)}}function V($,O){for(var B=0,X=0,se=0,ae=$.length,Ie=ae-1;se<ae;Ie=se++){var ve=($[se][0]-$[Ie][0])*($[Ie][1]+$[se][1]),he=B+ve;X+=Math.abs(B)>=Math.abs(ve)?B-he+ve:ve-he+B,B=he}B+X>=0!=!!O&&$.reverse()}var me=o.bz(function $(O,B){var X,se=O&&O.type;if(se==="FeatureCollection")for(X=0;X<O.features.length;X++)$(O.features[X],B);else if(se==="GeometryCollection")for(X=0;X<O.geometries.length;X++)$(O.geometries[X],B);else if(se==="Feature")$(O.geometry,B);else if(se==="Polygon")le(O.coordinates,B);else if(se==="MultiPolygon")for(X=0;X<O.coordinates.length;X++)le(O.coordinates[X],B);return O});const Oe=o.bw.VectorTileFeature.prototype.toGeoJSON;var Pe={exports:{}},ne=o.bA,de=o.bw.VectorTileFeature,ce=Ae;function Ae($,O){this.options=O||{},this.features=$,this.length=$.length}function Me($,O){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=O||4096}Ae.prototype.feature=function($){return new Me(this.features[$],this.options.extent)},Me.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var O=0;O<$.length;O++){for(var B=$[O],X=[],se=0;se<B.length;se++)X.push(new ne(B[se][0],B[se][1]));this.geometry.push(X)}return this.geometry},Me.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,O=1/0,B=-1/0,X=1/0,se=-1/0,ae=0;ae<$.length;ae++)for(var Ie=$[ae],ve=0;ve<Ie.length;ve++){var he=Ie[ve];O=Math.min(O,he.x),B=Math.max(B,he.x),X=Math.min(X,he.y),se=Math.max(se,he.y)}return[O,X,B,se]},Me.prototype.toGeoJSON=de.prototype.toGeoJSON;var Y=o.bB,xe=ce;function Ge($){var O=new Y;return function(B,X){for(var se in B.layers)X.writeMessage(3,Ye,B.layers[se])}($,O),O.finish()}function Ye($,O){var B;O.writeVarintField(15,$.version||1),O.writeStringField(1,$.name||""),O.writeVarintField(5,$.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<$.length;B++)X.feature=$.feature(B),O.writeMessage(2,ct,X);var se=X.keys;for(B=0;B<se.length;B++)O.writeStringField(3,se[B]);var ae=X.values;for(B=0;B<ae.length;B++)O.writeMessage(4,et,ae[B])}function ct($,O){var B=$.feature;B.id!==void 0&&O.writeVarintField(1,B.id),O.writeMessage(2,wt,$),O.writeVarintField(3,B.type),O.writeMessage(4,ht,B)}function wt($,O){var B=$.feature,X=$.keys,se=$.values,ae=$.keycache,Ie=$.valuecache;for(var ve in B.properties){var he=B.properties[ve],Te=ae[ve];if(he!==null){Te===void 0&&(X.push(ve),ae[ve]=Te=X.length-1),O.writeVarint(Te);var Ue=typeof he;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(he=JSON.stringify(he));var Ve=Ue+":"+he,qe=Ie[Ve];qe===void 0&&(se.push(he),Ie[Ve]=qe=se.length-1),O.writeVarint(qe)}}}function Et($,O){return(O<<3)+(7&$)}function Dt($){return $<<1^$>>31}function ht($,O){for(var B=$.loadGeometry(),X=$.type,se=0,ae=0,Ie=B.length,ve=0;ve<Ie;ve++){var he=B[ve],Te=1;X===1&&(Te=he.length),O.writeVarint(Et(1,Te));for(var Ue=X===3?he.length-1:he.length,Ve=0;Ve<Ue;Ve++){Ve===1&&X!==1&&O.writeVarint(Et(2,Ue-1));var qe=he[Ve].x-se,Ct=he[Ve].y-ae;O.writeVarint(Dt(qe)),O.writeVarint(Dt(Ct)),se+=qe,ae+=Ct}X===3&&O.writeVarint(Et(7,1))}}function et($,O){var B=typeof $;B==="string"?O.writeStringField(1,$):B==="boolean"?O.writeBooleanField(7,$):B==="number"&&($%1!=0?O.writeDoubleField(3,$):$<0?O.writeSVarintField(6,$):O.writeVarintField(5,$))}Pe.exports=Ge,Pe.exports.fromVectorTileJs=Ge,Pe.exports.fromGeojsonVt=function($,O){O=O||{};var B={};for(var X in $)B[X]=new xe($[X].features,O),B[X].name=X,B[X].version=O.version,B[X].extent=O.extent;return Ge({layers:B})},Pe.exports.GeoJSONWrapper=xe;var ft=o.bz(Pe.exports);const Ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},mt=Math.fround||(Q=new Float32Array(1),$=>(Q[0]=+$,Q[0]));var Q;const we=3,Ee=5,je=6;class St{constructor(O){this.options=Object.assign(Object.create(Ut),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:B,minZoom:X,maxZoom:se}=this.options;B&&console.time("total time");const ae=`prepare ${O.length} points`;B&&console.time(ae),this.points=O;const Ie=[];for(let he=0;he<O.length;he++){const Te=O[he];if(!Te.geometry)continue;const[Ue,Ve]=Te.geometry.coordinates,qe=mt(It(Ue)),Ct=mt(jt(Ve));Ie.push(qe,Ct,1/0,he,-1,1),this.options.reduce&&Ie.push(0)}let ve=this.trees[se+1]=this._createTree(Ie);B&&console.timeEnd(ae);for(let he=se;he>=X;he--){const Te=+Date.now();ve=this.trees[he]=this._createTree(this._cluster(ve,he)),B&&console.log("z%d: %d clusters in %dms",he,ve.numItems,+Date.now()-Te)}return B&&console.timeEnd("total time"),this}getClusters(O,B){let X=((O[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,O[1]));let ae=O[2]===180?180:((O[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)X=-180,ae=180;else if(X>ae){const Ve=this.getClusters([X,se,180,Ie],B),qe=this.getClusters([-180,se,ae,Ie],B);return Ve.concat(qe)}const ve=this.trees[this._limitZoom(B)],he=ve.range(It(X),jt(Ie),It(ae),jt(se)),Te=ve.data,Ue=[];for(const Ve of he){const qe=this.stride*Ve;Ue.push(Te[qe+Ee]>1?Mt(Te,qe,this.clusterProps):this.points[Te[qe+we]])}return Ue}getChildren(O){const B=this._getOriginId(O),X=this._getOriginZoom(O),se="No cluster with the specified id.",ae=this.trees[X];if(!ae)throw new Error(se);const Ie=ae.data;if(B*this.stride>=Ie.length)throw new Error(se);const ve=this.options.radius/(this.options.extent*Math.pow(2,X-1)),he=ae.within(Ie[B*this.stride],Ie[B*this.stride+1],ve),Te=[];for(const Ue of he){const Ve=Ue*this.stride;Ie[Ve+4]===O&&Te.push(Ie[Ve+Ee]>1?Mt(Ie,Ve,this.clusterProps):this.points[Ie[Ve+we]])}if(Te.length===0)throw new Error(se);return Te}getLeaves(O,B,X){const se=[];return this._appendLeaves(se,O,B=B||10,X=X||0,0),se}getTile(O,B,X){const se=this.trees[this._limitZoom(O)],ae=Math.pow(2,O),{extent:Ie,radius:ve}=this.options,he=ve/Ie,Te=(X-he)/ae,Ue=(X+1+he)/ae,Ve={features:[]};return this._addTileFeatures(se.range((B-he)/ae,Te,(B+1+he)/ae,Ue),se.data,B,X,ae,Ve),B===0&&this._addTileFeatures(se.range(1-he/ae,Te,1,Ue),se.data,ae,X,ae,Ve),B===ae-1&&this._addTileFeatures(se.range(0,Te,he/ae,Ue),se.data,-1,X,ae,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(O){let B=this._getOriginZoom(O)-1;for(;B<=this.options.maxZoom;){const X=this.getChildren(O);if(B++,X.length!==1)break;O=X[0].properties.cluster_id}return B}_appendLeaves(O,B,X,se,ae){const Ie=this.getChildren(B);for(const ve of Ie){const he=ve.properties;if(he&&he.cluster?ae+he.point_count<=se?ae+=he.point_count:ae=this._appendLeaves(O,he.cluster_id,X,se,ae):ae<se?ae++:O.push(ve),O.length===X)break}return ae}_createTree(O){const B=new o.av(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<O.length;X+=this.stride)B.add(O[X],O[X+1]);return B.finish(),B.data=O,B}_addTileFeatures(O,B,X,se,ae,Ie){for(const ve of O){const he=ve*this.stride,Te=B[he+Ee]>1;let Ue,Ve,qe;if(Te)Ue=ot(B,he,this.clusterProps),Ve=B[he],qe=B[he+1];else{const At=this.points[B[he+we]];Ue=At.properties;const[Ot,Zt]=At.geometry.coordinates;Ve=It(Ot),qe=jt(Zt)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(Ve*ae-X)),Math.round(this.options.extent*(qe*ae-se))]],tags:Ue};let kt;kt=Te||this.options.generateId?B[he+we]:this.points[B[he+we]].id,kt!==void 0&&(Ct.id=kt),Ie.features.push(Ct)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,B){const{radius:X,extent:se,reduce:ae,minPoints:Ie}=this.options,ve=X/(se*Math.pow(2,B)),he=O.data,Te=[],Ue=this.stride;for(let Ve=0;Ve<he.length;Ve+=Ue){if(he[Ve+2]<=B)continue;he[Ve+2]=B;const qe=he[Ve],Ct=he[Ve+1],kt=O.within(he[Ve],he[Ve+1],ve),At=he[Ve+Ee];let Ot=At;for(const Zt of kt){const yr=Zt*Ue;he[yr+2]>B&&(Ot+=he[yr+Ee])}if(Ot>At&&Ot>=Ie){let Zt,yr=qe*At,Tr=Ct*At,hr=-1;const or=((Ve/Ue|0)<<5)+(B+1)+this.points.length;for(const pn of kt){const Ir=pn*Ue;if(he[Ir+2]<=B)continue;he[Ir+2]=B;const Yr=he[Ir+Ee];yr+=he[Ir]*Yr,Tr+=he[Ir+1]*Yr,he[Ir+4]=or,ae&&(Zt||(Zt=this._map(he,Ve,!0),hr=this.clusterProps.length,this.clusterProps.push(Zt)),ae(Zt,this._map(he,Ir)))}he[Ve+4]=or,Te.push(yr/Ot,Tr/Ot,1/0,or,-1,Ot),ae&&Te.push(hr)}else{for(let Zt=0;Zt<Ue;Zt++)Te.push(he[Ve+Zt]);if(Ot>1)for(const Zt of kt){const yr=Zt*Ue;if(!(he[yr+2]<=B)){he[yr+2]=B;for(let Tr=0;Tr<Ue;Tr++)Te.push(he[yr+Tr])}}}}return Te}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,B,X){if(O[B+Ee]>1){const Ie=this.clusterProps[O[B+je]];return X?Object.assign({},Ie):Ie}const se=this.points[O[B+we]].properties,ae=this.options.map(se);return X&&ae===se?Object.assign({},ae):ae}}function Mt($,O,B){return{type:"Feature",id:$[O+we],properties:ot($,O,B),geometry:{type:"Point",coordinates:[(X=$[O],360*(X-.5)),Qt($[O+1])]}};var X}function ot($,O,B){const X=$[O+Ee],se=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,ae=$[O+je],Ie=ae===-1?{}:Object.assign({},B[ae]);return Object.assign(Ie,{cluster:!0,cluster_id:$[O+we],point_count:X,point_count_abbreviated:se})}function It($){return $/360+.5}function jt($){const O=Math.sin($*Math.PI/180),B=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return B<0?0:B>1?1:B}function Qt($){const O=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function Yt($,O,B,X){for(var se,ae=X,Ie=B-O>>1,ve=B-O,he=$[O],Te=$[O+1],Ue=$[B],Ve=$[B+1],qe=O+3;qe<B;qe+=3){var Ct=hn($[qe],$[qe+1],he,Te,Ue,Ve);if(Ct>ae)se=qe,ae=Ct;else if(Ct===ae){var kt=Math.abs(qe-Ie);kt<ve&&(se=qe,ve=kt)}}ae>X&&(se-O>3&&Yt($,O,se,X),$[se+2]=ae,B-se>3&&Yt($,se,B,X))}function hn($,O,B,X,se,ae){var Ie=se-B,ve=ae-X;if(Ie!==0||ve!==0){var he=(($-B)*Ie+(O-X)*ve)/(Ie*Ie+ve*ve);he>1?(B=se,X=ae):he>0&&(B+=Ie*he,X+=ve*he)}return(Ie=$-B)*Ie+(ve=O-X)*ve}function gr($,O,B,X){var se={id:$===void 0?null:$,type:O,geometry:B,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ae){var Ie=ae.geometry,ve=ae.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")sn(ae,Ie);else if(ve==="Polygon"||ve==="MultiLineString")for(var he=0;he<Ie.length;he++)sn(ae,Ie[he]);else if(ve==="MultiPolygon")for(he=0;he<Ie.length;he++)for(var Te=0;Te<Ie[he].length;Te++)sn(ae,Ie[he][Te])}(se),se}function sn($,O){for(var B=0;B<O.length;B+=3)$.minX=Math.min($.minX,O[B]),$.minY=Math.min($.minY,O[B+1]),$.maxX=Math.max($.maxX,O[B]),$.maxY=Math.max($.maxY,O[B+1])}function Sr($,O,B,X){if(O.geometry){var se=O.geometry.coordinates,ae=O.geometry.type,Ie=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),ve=[],he=O.id;if(B.promoteId?he=O.properties[B.promoteId]:B.generateId&&(he=X||0),ae==="Point")An(se,ve);else if(ae==="MultiPoint")for(var Te=0;Te<se.length;Te++)An(se[Te],ve);else if(ae==="LineString")Dn(se,ve,Ie,!1);else if(ae==="MultiLineString"){if(B.lineMetrics){for(Te=0;Te<se.length;Te++)Dn(se[Te],ve=[],Ie,!1),$.push(gr(he,"LineString",ve,O.properties));return}Xe(se,ve,Ie,!1)}else if(ae==="Polygon")Xe(se,ve,Ie,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(Te=0;Te<O.geometry.geometries.length;Te++)Sr($,{id:he,geometry:O.geometry.geometries[Te],properties:O.properties},B,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Te=0;Te<se.length;Te++){var Ue=[];Xe(se[Te],Ue,Ie,!0),ve.push(Ue)}}$.push(gr(he,ae,ve,O.properties))}}function An($,O){O.push($e($[0])),O.push(Jt($[1])),O.push(0)}function Dn($,O,B,X){for(var se,ae,Ie=0,ve=0;ve<$.length;ve++){var he=$e($[ve][0]),Te=Jt($[ve][1]);O.push(he),O.push(Te),O.push(0),ve>0&&(Ie+=X?(se*Te-he*ae)/2:Math.sqrt(Math.pow(he-se,2)+Math.pow(Te-ae,2))),se=he,ae=Te}var Ue=O.length-3;O[2]=1,Yt(O,0,Ue,B),O[Ue+2]=1,O.size=Math.abs(Ie),O.start=0,O.end=O.size}function Xe($,O,B,X){for(var se=0;se<$.length;se++){var ae=[];Dn($[se],ae,B,X),O.push(ae)}}function $e($){return $/360+.5}function Jt($){var O=Math.sin($*Math.PI/180),B=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return B<0?0:B>1?1:B}function wr($,O,B,X,se,ae,Ie,ve){if(X/=O,ae>=(B/=O)&&Ie<X)return $;if(Ie<B||ae>=X)return null;for(var he=[],Te=0;Te<$.length;Te++){var Ue=$[Te],Ve=Ue.geometry,qe=Ue.type,Ct=se===0?Ue.minX:Ue.minY,kt=se===0?Ue.maxX:Ue.maxY;if(Ct>=B&&kt<X)he.push(Ue);else if(!(kt<B||Ct>=X)){var At=[];if(qe==="Point"||qe==="MultiPoint")ur(Ve,At,B,X,se);else if(qe==="LineString")sr(Ve,At,B,X,se,!1,ve.lineMetrics);else if(qe==="MultiLineString")Ii(Ve,At,B,X,se,!1);else if(qe==="Polygon")Ii(Ve,At,B,X,se,!0);else if(qe==="MultiPolygon")for(var Ot=0;Ot<Ve.length;Ot++){var Zt=[];Ii(Ve[Ot],Zt,B,X,se,!0),Zt.length&&At.push(Zt)}if(At.length){if(ve.lineMetrics&&qe==="LineString"){for(Ot=0;Ot<At.length;Ot++)he.push(gr(Ue.id,qe,At[Ot],Ue.tags));continue}qe!=="LineString"&&qe!=="MultiLineString"||(At.length===1?(qe="LineString",At=At[0]):qe="MultiLineString"),qe!=="Point"&&qe!=="MultiPoint"||(qe=At.length===3?"Point":"MultiPoint"),he.push(gr(Ue.id,qe,At,Ue.tags))}}}return he.length?he:null}function ur($,O,B,X,se){for(var ae=0;ae<$.length;ae+=3){var Ie=$[ae+se];Ie>=B&&Ie<=X&&(O.push($[ae]),O.push($[ae+1]),O.push($[ae+2]))}}function sr($,O,B,X,se,ae,Ie){for(var ve,he,Te=Nn($),Ue=se===0?ds:Ri,Ve=$.start,qe=0;qe<$.length-3;qe+=3){var Ct=$[qe],kt=$[qe+1],At=$[qe+2],Ot=$[qe+3],Zt=$[qe+4],yr=se===0?Ct:kt,Tr=se===0?Ot:Zt,hr=!1;Ie&&(ve=Math.sqrt(Math.pow(Ct-Ot,2)+Math.pow(kt-Zt,2))),yr<B?Tr>B&&(he=Ue(Te,Ct,kt,Ot,Zt,B),Ie&&(Te.start=Ve+ve*he)):yr>X?Tr<X&&(he=Ue(Te,Ct,kt,Ot,Zt,X),Ie&&(Te.start=Ve+ve*he)):Ln(Te,Ct,kt,At),Tr<B&&yr>=B&&(he=Ue(Te,Ct,kt,Ot,Zt,B),hr=!0),Tr>X&&yr<=X&&(he=Ue(Te,Ct,kt,Ot,Zt,X),hr=!0),!ae&&hr&&(Ie&&(Te.end=Ve+ve*he),O.push(Te),Te=Nn($)),Ie&&(Ve+=ve)}var or=$.length-3;Ct=$[or],kt=$[or+1],At=$[or+2],(yr=se===0?Ct:kt)>=B&&yr<=X&&Ln(Te,Ct,kt,At),or=Te.length-3,ae&&or>=3&&(Te[or]!==Te[0]||Te[or+1]!==Te[1])&&Ln(Te,Te[0],Te[1],Te[2]),Te.length&&O.push(Te)}function Nn($){var O=[];return O.size=$.size,O.start=$.start,O.end=$.end,O}function Ii($,O,B,X,se,ae){for(var Ie=0;Ie<$.length;Ie++)sr($[Ie],O,B,X,se,ae,!1)}function Ln($,O,B,X){$.push(O),$.push(B),$.push(X)}function ds($,O,B,X,se,ae){var Ie=(ae-O)/(X-O);return $.push(ae),$.push(B+(se-B)*Ie),$.push(1),Ie}function Ri($,O,B,X,se,ae){var Ie=(ae-B)/(se-B);return $.push(O+(X-O)*Ie),$.push(ae),$.push(1),Ie}function oi($,O){for(var B=[],X=0;X<$.length;X++){var se,ae=$[X],Ie=ae.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")se=ai(ae.geometry,O);else if(Ie==="MultiLineString"||Ie==="Polygon"){se=[];for(var ve=0;ve<ae.geometry.length;ve++)se.push(ai(ae.geometry[ve],O))}else if(Ie==="MultiPolygon")for(se=[],ve=0;ve<ae.geometry.length;ve++){for(var he=[],Te=0;Te<ae.geometry[ve].length;Te++)he.push(ai(ae.geometry[ve][Te],O));se.push(he)}B.push(gr(ae.id,Ie,se,ae.tags))}return B}function ai($,O){var B=[];B.size=$.size,$.start!==void 0&&(B.start=$.start,B.end=$.end);for(var X=0;X<$.length;X+=3)B.push($[X]+O,$[X+1],$[X+2]);return B}function it($,O){if($.transformed)return $;var B,X,se,ae=1<<$.z,Ie=$.x,ve=$.y;for(B=0;B<$.features.length;B++){var he=$.features[B],Te=he.geometry,Ue=he.type;if(he.geometry=[],Ue===1)for(X=0;X<Te.length;X+=2)he.geometry.push(jn(Te[X],Te[X+1],O,ae,Ie,ve));else for(X=0;X<Te.length;X++){var Ve=[];for(se=0;se<Te[X].length;se+=2)Ve.push(jn(Te[X][se],Te[X][se+1],O,ae,Ie,ve));he.geometry.push(Ve)}}return $.transformed=!0,$}function jn($,O,B,X,se,ae){return[Math.round(B*($*X-se)),Math.round(B*(O*X-ae))]}function Pr($,O,B,X,se){for(var ae=O===se.maxZoom?0:se.tolerance/((1<<O)*se.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:X,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ve=0;ve<$.length;ve++){Ie.numFeatures++,Ai(Ie,$[ve],ae,se);var he=$[ve].minX,Te=$[ve].minY,Ue=$[ve].maxX,Ve=$[ve].maxY;he<Ie.minX&&(Ie.minX=he),Te<Ie.minY&&(Ie.minY=Te),Ue>Ie.maxX&&(Ie.maxX=Ue),Ve>Ie.maxY&&(Ie.maxY=Ve)}return Ie}function Ai($,O,B,X){var se=O.geometry,ae=O.type,Ie=[];if(ae==="Point"||ae==="MultiPoint")for(var ve=0;ve<se.length;ve+=3)Ie.push(se[ve]),Ie.push(se[ve+1]),$.numPoints++,$.numSimplified++;else if(ae==="LineString")qn(Ie,se,$,B,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(ve=0;ve<se.length;ve++)qn(Ie,se[ve],$,B,ae==="Polygon",ve===0);else if(ae==="MultiPolygon")for(var he=0;he<se.length;he++){var Te=se[he];for(ve=0;ve<Te.length;ve++)qn(Ie,Te[ve],$,B,!0,ve===0)}if(Ie.length){var Ue=O.tags||null;if(ae==="LineString"&&X.lineMetrics){for(var Ve in Ue={},O.tags)Ue[Ve]=O.tags[Ve];Ue.mapbox_clip_start=se.start/se.size,Ue.mapbox_clip_end=se.end/se.size}var qe={geometry:Ie,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:Ue};O.id!==null&&(qe.id=O.id),$.features.push(qe)}}function qn($,O,B,X,se,ae){var Ie=X*X;if(X>0&&O.size<(se?Ie:X))B.numPoints+=O.length/3;else{for(var ve=[],he=0;he<O.length;he+=3)(X===0||O[he+2]>Ie)&&(B.numSimplified++,ve.push(O[he]),ve.push(O[he+1])),B.numPoints++;se&&function(Te,Ue){for(var Ve=0,qe=0,Ct=Te.length,kt=Ct-2;qe<Ct;kt=qe,qe+=2)Ve+=(Te[qe]-Te[kt])*(Te[qe+1]+Te[kt+1]);if(Ve>0===Ue)for(qe=0,Ct=Te.length;qe<Ct/2;qe+=2){var At=Te[qe],Ot=Te[qe+1];Te[qe]=Te[Ct-2-qe],Te[qe+1]=Te[Ct-1-qe],Te[Ct-2-qe]=At,Te[Ct-1-qe]=Ot}}(ve,ae),$.push(ve)}}function nt($,O){var B=(O=this.options=function(se,ae){for(var Ie in ae)se[Ie]=ae[Ie];return se}(Object.create(this.options),O)).debug;if(B&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var X=function(se,ae){var Ie=[];if(se.type==="FeatureCollection")for(var ve=0;ve<se.features.length;ve++)Sr(Ie,se.features[ve],ae,ve);else Sr(Ie,se.type==="Feature"?se:{geometry:se},ae);return Ie}($,O);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=function(se,ae){var Ie=ae.buffer/ae.extent,ve=se,he=wr(se,1,-1-Ie,Ie,0,-1,2,ae),Te=wr(se,1,1-Ie,2+Ie,0,-1,2,ae);return(he||Te)&&(ve=wr(se,1,-Ie,1+Ie,0,-1,2,ae)||[],he&&(ve=oi(he,1).concat(ve)),Te&&(ve=ve.concat(oi(Te,-1)))),ve}(X,O),X.length&&this.splitTile(X,0,0,0),B&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Xt($,O,B){return 32*((1<<$)*B+O)+$}function Ht($,O){return O?$.properties[O]:$.id}function on($,O){if($==null)return!0;if($.type==="Feature")return Ht($,O)!=null;if($.type==="FeatureCollection"){const B=new Set;for(const X of $.features){const se=Ht(X,O);if(se==null||B.has(se))return!1;B.add(se)}return!0}return!1}function Z($,O){const B=new Map;if($!=null)if($.type==="Feature")B.set(Ht($,O),$);else for(const X of $.features)B.set(Ht(X,O),X);return B}nt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},nt.prototype.splitTile=function($,O,B,X,se,ae,Ie){for(var ve=[$,O,B,X],he=this.options,Te=he.debug;ve.length;){X=ve.pop(),B=ve.pop(),O=ve.pop(),$=ve.pop();var Ue=1<<O,Ve=Xt(O,B,X),qe=this.tiles[Ve];if(!qe&&(Te>1&&console.time("creation"),qe=this.tiles[Ve]=Pr($,O,B,X,he),this.tileCoords.push({z:O,x:B,y:X}),Te)){Te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,B,X,qe.numFeatures,qe.numPoints,qe.numSimplified),console.timeEnd("creation"));var Ct="z"+O;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(qe.source=$,se){if(O===he.maxZoom||O===se)continue;var kt=1<<se-O;if(B!==Math.floor(ae/kt)||X!==Math.floor(Ie/kt))continue}else if(O===he.indexMaxZoom||qe.numPoints<=he.indexMaxPoints)continue;if(qe.source=null,$.length!==0){Te>1&&console.time("clipping");var At,Ot,Zt,yr,Tr,hr,or=.5*he.buffer/he.extent,pn=.5-or,Ir=.5+or,Yr=1+or;At=Ot=Zt=yr=null,Tr=wr($,Ue,B-or,B+Ir,0,qe.minX,qe.maxX,he),hr=wr($,Ue,B+pn,B+Yr,0,qe.minX,qe.maxX,he),$=null,Tr&&(At=wr(Tr,Ue,X-or,X+Ir,1,qe.minY,qe.maxY,he),Ot=wr(Tr,Ue,X+pn,X+Yr,1,qe.minY,qe.maxY,he),Tr=null),hr&&(Zt=wr(hr,Ue,X-or,X+Ir,1,qe.minY,qe.maxY,he),yr=wr(hr,Ue,X+pn,X+Yr,1,qe.minY,qe.maxY,he),hr=null),Te>1&&console.timeEnd("clipping"),ve.push(At||[],O+1,2*B,2*X),ve.push(Ot||[],O+1,2*B,2*X+1),ve.push(Zt||[],O+1,2*B+1,2*X),ve.push(yr||[],O+1,2*B+1,2*X+1)}}},nt.prototype.getTile=function($,O,B){var X=this.options,se=X.extent,ae=X.debug;if($<0||$>24)return null;var Ie=1<<$,ve=Xt($,O=(O%Ie+Ie)%Ie,B);if(this.tiles[ve])return it(this.tiles[ve],se);ae>1&&console.log("drilling down to z%d-%d-%d",$,O,B);for(var he,Te=$,Ue=O,Ve=B;!he&&Te>0;)Te--,Ue=Math.floor(Ue/2),Ve=Math.floor(Ve/2),he=this.tiles[Xt(Te,Ue,Ve)];return he&&he.source?(ae>1&&console.log("found parent tile z%d-%d-%d",Te,Ue,Ve),ae>1&&console.time("drilling down"),this.splitTile(he.source,Te,Ue,Ve,$,O,B),ae>1&&console.timeEnd("drilling down"),this.tiles[ve]?it(this.tiles[ve],se):null):null};class H extends q{constructor(O,B,X,se){super(O,B,X),this._dataUpdateable=new Map,this.loadGeoJSON=(ae,Ie)=>{const{promoteId:ve}=ae;if(ae.request)return o.f(ae.request,(he,Te,Ue,Ve)=>{this._dataUpdateable=on(Te,ve)?Z(Te,ve):void 0,Ie(he,Te,Ue,Ve)});if(typeof ae.data=="string")try{const he=JSON.parse(ae.data);this._dataUpdateable=on(he,ve)?Z(he,ve):void 0,Ie(null,he)}catch{Ie(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`))}else ae.dataDiff?this._dataUpdateable?(function(he,Te,Ue){var Ve,qe,Ct,kt;if(Te.removeAll&&he.clear(),Te.remove)for(const At of Te.remove)he.delete(At);if(Te.add)for(const At of Te.add){const Ot=Ht(At,Ue);Ot!=null&&he.set(Ot,At)}if(Te.update)for(const At of Te.update){let Ot=he.get(At.id);if(Ot==null)continue;const Zt=!At.removeAllProperties&&(((Ve=At.removeProperties)===null||Ve===void 0?void 0:Ve.length)>0||((qe=At.addOrUpdateProperties)===null||qe===void 0?void 0:qe.length)>0);if((At.newGeometry||At.removeAllProperties||Zt)&&(Ot=Object.assign({},Ot),he.set(At.id,Ot),Zt&&(Ot.properties=Object.assign({},Ot.properties))),At.newGeometry&&(Ot.geometry=At.newGeometry),At.removeAllProperties)Ot.properties={};else if(((Ct=At.removeProperties)===null||Ct===void 0?void 0:Ct.length)>0)for(const yr of At.removeProperties)Object.prototype.hasOwnProperty.call(Ot.properties,yr)&&delete Ot.properties[yr];if(((kt=At.addOrUpdateProperties)===null||kt===void 0?void 0:kt.length)>0)for(const{key:yr,value:Tr}of At.addOrUpdateProperties)Ot.properties[yr]=Tr}}(this._dataUpdateable,ae.dataDiff,ve),Ie(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Ie(new Error(`Cannot update existing geojson data in ${ae.source}`)):Ie(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,se&&(this.loadGeoJSON=se)}loadGeoJSONTile(O,B){const X=O.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const se=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!se)return B(null,null);const ae=new class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.N,this.length=ve.length,this._features=ve}feature(ve){return new class{constructor(he){this._feature=he,this.extent=o.N,this.type=he.type,this.properties=he.tags,"id"in he&&!isNaN(he.id)&&(this.id=parseInt(he.id,10))}loadGeometry(){if(this._feature.type===1){const he=[];for(const Te of this._feature.geometry)he.push([new o.P(Te[0],Te[1])]);return he}{const he=[];for(const Te of this._feature.geometry){const Ue=[];for(const Ve of Te)Ue.push(new o.P(Ve[0],Ve[1]));he.push(Ue)}return he}}toGeoJSON(he,Te,Ue){return Oe.call(this,he,Te,Ue)}}(this._features[ve])}}(se.features);let Ie=ft(ae);Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),B(null,{vectorTile:ae,rawData:Ie.buffer})}loadData(O,B){var X;(X=this._pendingRequest)===null||X===void 0||X.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const se=!!(O&&O.request&&O.request.collectResourceTiming)&&new o.bu(O.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(O,(ae,Ie)=>{if(delete this._pendingCallback,delete this._pendingRequest,ae||!Ie)return B(ae);if(typeof Ie!="object")return B(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{me(Ie,!0);try{if(O.filter){const he=o.bC(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(he.result==="error")throw new Error(he.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));Ie={type:"FeatureCollection",features:Ie.features.filter(Ue=>he.value.evaluate({zoom:0},Ue))}}this._geoJSONIndex=O.cluster?new St(function({superclusterOptions:he,clusterProperties:Te}){if(!Te||!he)return he;const Ue={},Ve={},qe={accumulated:null,zoom:0},Ct={properties:null},kt=Object.keys(Te);for(const At of kt){const[Ot,Zt]=Te[At],yr=o.bC(Zt),Tr=o.bC(typeof Ot=="string"?[Ot,["accumulated"],["get",At]]:Ot);Ue[At]=yr.value,Ve[At]=Tr.value}return he.map=At=>{Ct.properties=At;const Ot={};for(const Zt of kt)Ot[Zt]=Ue[Zt].evaluate(qe,Ct);return Ot},he.reduce=(At,Ot)=>{Ct.properties=Ot;for(const Zt of kt)qe.accumulated=At[Zt],At[Zt]=Ve[Zt].evaluate(qe,Ct)},he}(O)).load(Ie.features):function(he,Te){return new nt(he,Te)}(Ie,O.geojsonVtOptions)}catch(he){return B(he)}this.loaded={};const ve={};if(se){const he=se.finish();he&&(ve.resourceTiming={},ve.resourceTiming[O.source]=JSON.parse(JSON.stringify(he)))}B(null,ve)}})}reloadTile(O,B){const X=this.loaded;return X&&X[O.uid]?super.reloadTile(O,B):this.loadTile(O,B)}removeSource(O,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(O,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(X){B(X)}}getClusterChildren(O,B){try{B(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(X){B(X)}}getClusterLeaves(O,B){try{B(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(X){B(X)}}}class _e{constructor(O){this.self=O,this.actor=new o.C(O,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:q,geojson:H},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,X)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=X},this.self.registerRTLTextPlugin=B=>{if(o.bD.isParsed())throw new Error("RTL text plugin already registered.");o.bD.applyArabicShaping=B.applyArabicShaping,o.bD.processBidirectionalText=B.processBidirectionalText,o.bD.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(O,B){this.referrer=B}setImages(O,B,X){this.availableImages[O]=B;for(const se in this.workerSources[O]){const ae=this.workerSources[O][se];for(const Ie in ae)ae[Ie].availableImages=B}X()}setLayers(O,B,X){this.getLayerIndex(O).replace(B),X()}updateLayers(O,B,X){this.getLayerIndex(O).update(B.layers,B.removedIds),X()}loadTile(O,B,X){this.getWorkerSource(O,B.type,B.source).loadTile(B,X)}loadDEMTile(O,B,X){this.getDEMWorkerSource(O,B.source).loadTile(B,X)}reloadTile(O,B,X){this.getWorkerSource(O,B.type,B.source).reloadTile(B,X)}abortTile(O,B,X){this.getWorkerSource(O,B.type,B.source).abortTile(B,X)}removeTile(O,B,X){this.getWorkerSource(O,B.type,B.source).removeTile(B,X)}removeDEMTile(O,B){this.getDEMWorkerSource(O,B.source).removeTile(B)}removeSource(O,B,X){if(!this.workerSources[O]||!this.workerSources[O][B.type]||!this.workerSources[O][B.type][B.source])return;const se=this.workerSources[O][B.type][B.source];delete this.workerSources[O][B.type][B.source],se.removeSource!==void 0?se.removeSource(B,X):X()}loadWorkerSource(O,B,X){try{this.self.importScripts(B.url),X()}catch(se){X(se.toString())}}syncRTLPluginState(O,B,X){try{o.bD.setState(B);const se=o.bD.getPluginURL();if(o.bD.isLoaded()&&!o.bD.isParsed()&&se!=null){this.self.importScripts(se);const ae=o.bD.isParsed();X(ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),ae)}}catch(se){X(se.toString())}}getAvailableImages(O){let B=this.availableImages[O];return B||(B=[]),B}getLayerIndex(O){let B=this.layerIndexes[O];return B||(B=this.layerIndexes[O]=new I),B}getWorkerSource(O,B,X){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][B]||(this.workerSources[O][B]={}),this.workerSources[O][B][X]||(this.workerSources[O][B][X]=new this.workerSourceTypes[B]({send:(se,ae,Ie)=>{this.actor.send(se,ae,Ie,O)}},this.getLayerIndex(O),this.getAvailableImages(O))),this.workerSources[O][B][X]}getDEMWorkerSource(O,B){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][B]||(this.demWorkerSources[O][B]=new ie),this.demWorkerSources[O][B]}}return o.i()&&(self.worker=new _e(self)),_e}),v(["./shared"],function(o){var I="3.6.2";class A{static testProp(t){if(!A.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in A.docStyle)return t[s];return t[0]}static create(t,s,u){const p=window.document.createElement(t);return s!==void 0&&(p.className=s),u&&u.appendChild(p),p}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){A.docStyle&&A.selectProp&&(A.userSelect=A.docStyle[A.selectProp],A.docStyle[A.selectProp]="none")}static enableDrag(){A.docStyle&&A.selectProp&&(A.docStyle[A.selectProp]=A.userSelect)}static setTransform(t,s){t.style[A.transformProp]=s}static addEventListener(t,s,u,p={}){t.addEventListener(s,u,"passive"in p?p:p.capture)}static removeEventListener(t,s,u,p={}){t.removeEventListener(s,u,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",A.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",A.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",A.suppressClickInternal,!0)},0)}static mousePos(t,s){const u=t.getBoundingClientRect();return new o.P(s.clientX-u.left-t.clientLeft,s.clientY-u.top-t.clientTop)}static touchPos(t,s){const u=t.getBoundingClientRect(),p=[];for(let g=0;g<s.length;g++)p.push(new o.P(s[g].clientX-u.left-t.clientLeft,s[g].clientY-u.top-t.clientTop));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}A.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,A.selectProp=A.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),A.transformProp=A.testProp(["transform","WebkitTransform"]);const L={supported:!1,testSupport:function(d){!q&&P&&(ie?le(d):R=d)}};let R,P,q=!1,ie=!1;function le(d){const t=d.createTexture();d.bindTexture(d.TEXTURE_2D,t);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,P),d.isContextLost())return;L.supported=!0}catch{}d.deleteTexture(t),q=!0}var V,me;typeof document<"u"&&(P=document.createElement("img"),P.onload=function(){R&&le(R),R=null,ie=!0},P.onerror=function(){q=!0,R=null},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let t,s,u,p;d.resetRequestQueue=()=>{t=[],s=0,u=0,p={}},d.addThrottleControl=C=>{const M=u++;return p[M]=C,M},d.removeThrottleControl=C=>{delete p[C],E()},d.getImage=(C,M,N=!0)=>{L.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*");const j={requestParameters:C,supportImageRefresh:N,callback:M,cancelled:!1,completed:!1,cancel:()=>{j.completed||j.cancelled||(j.cancelled=!0,j.innerRequest&&(j.innerRequest.cancel(),s--),E())}};return t.push(j),E(),j};const g=C=>{const{requestParameters:M,supportImageRefresh:N,callback:j}=C;return o.e(M,{type:"image"}),(N!==!1||o.i()||o.g(M.url)||M.headers&&!Object.keys(M.headers).reduce((re,te)=>re&&te==="accept",!0)?o.m:S)(M,(re,te,oe,K)=>{b(C,j,re,te,oe,K)})},b=(C,M,N,j,re,te)=>{N?M(N):j instanceof HTMLImageElement||o.a(j)?M(null,j):j&&((oe,K)=>{typeof createImageBitmap=="function"?o.b(oe,K):o.d(oe,K)})(j,(oe,K)=>{oe!=null?M(oe):K!=null&&M(null,K,{cacheControl:re,expires:te})}),C.cancelled||(C.completed=!0,s--,E())},E=()=>{const C=(()=>{const M=Object.keys(p);let N=!1;if(M.length>0){for(const j of M)if(N=p[j](),N)break}return N})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=s;M<C&&t.length>0;M++){const N=t.shift();if(N.cancelled){M--;continue}const j=g(N);s++,N.innerRequest=j}},S=(C,M)=>{const N=new Image,j=C.url;let re=!1;const te=C.credentials;return te&&te==="include"?N.crossOrigin="use-credentials":(te&&te==="same-origin"||!o.s(j))&&(N.crossOrigin="anonymous"),N.fetchPriority="high",N.onload=()=>{M(null,N),N.onerror=N.onload=null},N.onerror=()=>{re||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),N.onerror=N.onload=null},N.src=j,{cancel:()=>{re=!0,N.src=""}}}}(V||(V={})),V.resetRequestQueue(),function(d){d.Glyphs="Glyphs",d.Image="Image",d.Source="Source",d.SpriteImage="SpriteImage",d.SpriteJSON="SpriteJSON",d.Style="Style",d.Tile="Tile",d.Unknown="Unknown"}(me||(me={}));class Oe{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,u){const p=function(g){const b=g.match(Pe);if(!b)throw new Error(`Unable to parse URL "${g}"`);return{protocol:b[1],authority:b[2],path:b[3]||"/",params:b[4]?b[4].split("&"):[]}}(t);return p.path+=`${s}${u}`,function(g){const b=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${b}`}(p)}setTransformRequest(t){this._transformRequestFn=t}}const Pe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ne(d){var t=new o.A(3);return t[0]=d[0],t[1]=d[1],t[2]=d[2],t}var de,ce=function(d,t,s){return d[0]=t[0]-s[0],d[1]=t[1]-s[1],d[2]=t[2]-s[2],d};de=new o.A(3),o.A!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0);var Ae=function(d){var t=d[0],s=d[1];return t*t+s*s};function Me(d){const t=[];if(typeof d=="string")t.push({id:"default",url:d});else if(d&&d.length>0){const s=[];for(const{id:u,url:p}of d){const g=`${u}${p}`;s.indexOf(g)===-1&&(s.push(g),t.push({id:u,url:p}))}}return t}function Y(d,t,s,u,p){if(u)return void d(u);if(p!==Object.values(t).length||p!==Object.values(s).length)return;const g={};for(const b in t){g[b]={};const E=o.h.getImageCanvasContext(s[b]),S=t[b];for(const C in S){const{width:M,height:N,x:j,y:re,sdf:te,pixelRatio:oe,stretchX:K,stretchY:Se,content:Ne}=S[C];g[b][C]={data:null,pixelRatio:oe,sdf:te,stretchX:K,stretchY:Se,content:Ne,spriteData:{width:M,height:N,x:j,y:re,context:E}}}}d(null,g)}(function(){var d=new o.A(2);o.A!=Float32Array&&(d[0]=0,d[1]=0)})();class xe{constructor(t,s,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(s,p)}update(t,s,u){const{width:p,height:g}=t,b=!(this.size&&this.size[0]===p&&this.size[1]===g||u),{context:E}=this,{gl:S}=E;if(this.useMipmap=Boolean(s&&s.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!s||s.premultiply!==!1)),b)this.size=[p,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.a(t)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,t):S.texImage2D(S.TEXTURE_2D,0,this.format,p,g,0,this.format,S.UNSIGNED_BYTE,t.data);else{const{x:C,y:M}=u||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.a(t)?S.texSubImage2D(S.TEXTURE_2D,0,C,M,S.RGBA,S.UNSIGNED_BYTE,t):S.texSubImage2D(S.TEXTURE_2D,0,C,M,p,g,S.RGBA,S.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(t,s,u){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),u!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,u||t),this.filter=t),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Ge(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ye extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:u}of this.requestors)this._notify(s,u);this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const u=s.spriteData;s.data=new o.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let u=!0;const p=s.data||s.spriteData;return this._validateStretch(s.stretchX,p&&p.width)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,p&&p.height)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new o.j(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,s){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||s<p[1])return!1;u=p[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const u=s.spriteData,p=u&&u.width||s.data.width,g=u&&u.height||s.data.height;return!(t[0]<0||p<t[0]||t[1]<0||g<t[1]||t[2]<0||p<t[2]||t[3]<0||g<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,u=!0){const p=this.getImage(t);if(u&&(p.data.width!==s.data.width||p.data.height!==s.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=p.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let u=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(u=!1);this.isLoaded()||u?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const u={};for(const p of t){let g=this.getImage(p);g||(this.fire(new o.k("styleimagemissing",{id:p})),g=this.getImage(p)),g?u[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:o.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,u)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],u=this.getImage(t);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},g=new o.I(p,u);this.patterns[t]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new xe(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:s,h:u}=o.p(t),p=this.atlasImage;p.resize({width:s||1,height:u||1});for(const g in this.patterns){const{bin:b}=this.patterns[g],E=b.x+1,S=b.y+1,C=this.getImage(g).data,M=C.width,N=C.height;o.R.copy(C,p,{x:0,y:0},{x:E,y:S},{width:M,height:N}),o.R.copy(C,p,{x:0,y:N-1},{x:E,y:S-1},{width:M,height:1}),o.R.copy(C,p,{x:0,y:0},{x:E,y:S+N},{width:M,height:1}),o.R.copy(C,p,{x:M-1,y:0},{x:E-1,y:S},{width:1,height:N}),o.R.copy(C,p,{x:0,y:0},{x:E+M,y:S},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.getImage(s);u||o.w(`Image with ID: "${s}" was not found`),Ge(u)&&this.updateImage(s,u)}}}const ct=1e20;function wt(d,t,s,u,p,g,b,E,S){for(let C=t;C<t+u;C++)Et(d,s*g+C,g,p,b,E,S);for(let C=s;C<s+p;C++)Et(d,C*g+t,1,u,b,E,S)}function Et(d,t,s,u,p,g,b){g[0]=0,b[0]=-ct,b[1]=ct,p[0]=d[t];for(let E=1,S=0,C=0;E<u;E++){p[E]=d[t+E*s];const M=E*E;do{const N=g[S];C=(p[E]-p[N]+M-N*N)/(E-N)/2}while(C<=b[S]&&--S>-1);S++,g[S]=E,b[S]=C,b[S+1]=ct}for(let E=0,S=0;E<u;E++){for(;b[S+1]<E;)S++;const C=g[S],M=E-C;d[t+E*s]=p[C]+M*M}}class Dt{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const u=[];for(const p in t)for(const g of t[p])u.push({stack:p,id:g});o.o(u,({stack:p,id:g},b)=>{let E=this.entries[p];E||(E=this.entries[p]={glyphs:{},requests:{},ranges:{}});let S=E.glyphs[g];if(S!==void 0)return void b(null,{stack:p,id:g,glyph:S});if(S=this._tinySDF(E,p,g),S)return E.glyphs[g]=S,void b(null,{stack:p,id:g,glyph:S});const C=Math.floor(g/256);if(256*C>65535)return void b(new Error("glyphs > 65535 not supported"));if(E.ranges[C])return void b(null,{stack:p,id:g,glyph:S});if(!this.url)return void b(new Error("glyphsUrl is not set"));let M=E.requests[C];M||(M=E.requests[C]=[],Dt.loadGlyphRange(p,C,this.url,this.requestManager,(N,j)=>{if(j){for(const re in j)this._doesCharSupportLocalGlyph(+re)||(E.glyphs[+re]=j[+re]);E.ranges[C]=!0}for(const re of M)re(N,j);delete E.requests[C]})),M.push((N,j)=>{N?b(N):j&&b(null,{stack:p,id:g,glyph:j[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const b={};for(const{stack:E,id:S,glyph:C}of g)(b[E]||(b[E]={}))[S]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};s(null,b)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](t)||o.u["Hangul Syllables"](t)||o.u.Hiragana(t)||o.u.Katakana(t))}_tinySDF(t,s,u){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let g=t.tinySDF;if(!g){let E="400";/bold/i.test(s)?E="900":/medium/i.test(s)?E="500":/light/i.test(s)&&(E="200"),g=t.tinySDF=new Dt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:E})}const b=g.draw(String.fromCharCode(u));return{id:u,bitmap:new o.q({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}Dt.loadGlyphRange=function(d,t,s,u,p){const g=256*t,b=g+255,E=u.transformRequest(s.replace("{fontstack}",d).replace("{range}",`${g}-${b}`),me.Glyphs);o.l(E,(S,C)=>{if(S)p(S);else if(C){const M={};for(const N of o.n(C))M[N.id]=N;p(null,M)}})},Dt.TinySDF=class{constructor({fontSize:d=24,buffer:t=3,radius:s=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:b="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=s;const E=this.size=d+4*t,S=this._createCanvas(E),C=this.ctx=S.getContext("2d",{willReadFrequently:!0});C.font=`${b} ${g} ${d}px ${p}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(d){const t=document.createElement("canvas");return t.width=t.height=d,t}draw(d){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(d),b=Math.ceil(s),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),S=Math.min(this.size-this.buffer,b+Math.ceil(u)),C=E+2*this.buffer,M=S+2*this.buffer,N=Math.max(C*M,0),j=new Uint8ClampedArray(N),re={data:j,width:C,height:M,glyphWidth:E,glyphHeight:S,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(E===0||S===0)return re;const{ctx:te,buffer:oe,gridInner:K,gridOuter:Se}=this;te.clearRect(oe,oe,E,S),te.fillText(d,oe,oe+b);const Ne=te.getImageData(oe,oe,E,S);Se.fill(ct,0,N),K.fill(0,0,N);for(let pe=0;pe<S;pe++)for(let De=0;De<E;De++){const Fe=Ne.data[4*(pe*E+De)+3]/255;if(Fe===0)continue;const Be=(pe+oe)*C+De+oe;if(Fe===1)Se[Be]=0,K[Be]=ct;else{const He=.5-Fe;Se[Be]=He>0?He*He:0,K[Be]=He<0?He*He:0}}wt(Se,0,0,C,M,C,this.f,this.v,this.z),wt(K,oe,oe,E,S,C,this.f,this.v,this.z);for(let pe=0;pe<N;pe++){const De=Math.sqrt(Se[pe])-Math.sqrt(K[pe]);j[pe]=Math.round(255-255*(De/this.radius+this.cutoff))}return re}};class ht{constructor(){this.specification=o.v.light.position}possiblyEvaluate(t,s){return o.z(t.expression.evaluate(s))}interpolate(t,s,u){return{x:o.B.number(t.x,s.x,u),y:o.B.number(t.y,s.y,u),z:o.B.number(t.z,s.z,u)}}}let et;class ft extends o.E{constructor(t){super(),et=et||new o.r({anchor:new o.D(o.v.light.anchor),position:new ht,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(et),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(o.t,t,s))for(const u in t){const p=t[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),p):this._transitionable.setValue(u,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,u){return(!u||u.validate!==!1)&&o.x(this,t.call(o.y,o.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}}class Ut{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const u=t.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,s)),this.dashEntry[u]}getDashRanges(t,s,u){const p=[];let g=t.length%2==1?-t[t.length-1]*u:0,b=t[0]*u,E=!0;p.push({left:g,right:b,isDash:E,zeroLength:t[0]===0});let S=t[0];for(let C=1;C<t.length;C++){E=!E;const M=t[C];g=S*u,S+=M,b=S*u,p.push({left:g,right:b,isDash:E,zeroLength:M===0})}return p}addRoundDash(t,s,u){const p=s/2;for(let g=-u;g<=u;g++){const b=this.width*(this.nextRow+u+g);let E=0,S=t[E];for(let C=0;C<this.width;C++){C/S.right>1&&(S=t[++E]);const M=Math.abs(C-S.left),N=Math.abs(C-S.right),j=Math.min(M,N);let re;const te=g/u*(p+1);if(S.isDash){const oe=p-Math.abs(te);re=Math.sqrt(j*j+oe*oe)}else re=p-Math.sqrt(j*j+te*te);this.data[b+C]=Math.max(0,Math.min(255,re+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const S=t[E],C=t[E+1];S.zeroLength?t.splice(E,1):C&&C.isDash===S.isDash&&(C.left=S.left,t.splice(E,1))}const s=t[0],u=t[t.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const p=this.width*this.nextRow;let g=0,b=t[g];for(let E=0;E<this.width;E++){E/b.right>1&&(b=t[++g]);const S=Math.abs(E-b.left),C=Math.abs(E-b.right),M=Math.min(S,C);this.data[p+E]=Math.max(0,Math.min(255,(b.isDash?M:-M)+128))}}addDash(t,s){const u=s?7:0,p=2*u+1;if(this.nextRow+p>this.height)return o.w("LineAtlas out of space"),null;let g=0;for(let E=0;E<t.length;E++)g+=t[E];if(g!==0){const E=this.width/g,S=this.getDashRanges(t,this.width,E);s?this.addRoundDash(S,E,u):this.addRegularDash(S)}const b={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:g};return this.nextRow+=p,this.dirty=!0,b}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class mt{constructor(t,s,u){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u;const p=this.workerPool.acquire(u);for(let g=0;g<p.length;g++){const b=new o.C(p[g],s,u);b.name=`Worker ${g}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,u){o.o(this.actors,(p,g)=>{p.send(t,s,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Q(d,t,s){const u=function(p,g){if(p)return s(p);if(g){const b=o.F(o.e(g,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(b.vectorLayers=g.vector_layers,b.vectorLayerIds=b.vectorLayers.map(E=>E.id)),s(null,b)}};return d.url?o.f(t.transformRequest(d.url,me.Source),u):o.h.frame(()=>u(null,d))}class we{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.L?new o.L(t.lng,t.lat):o.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.L?new o.L(t.lng,t.lat):o.L.convert(t),this}extend(t){const s=this._sw,u=this._ne;let p,g;if(t instanceof o.L)p=t,g=t;else{if(!(t instanceof we))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(we.convert(t)):this.extend(o.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.L.convert(t)):this;if(p=t._sw,g=t._ne,!p||!g)return this}return s||u?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new o.L(p.lng,p.lat),this._ne=new o.L(g.lng,g.lat)),this}getCenter(){return new o.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.L(this.getWest(),this.getNorth())}getSouthEast(){return new o.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:u}=o.L.convert(t);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(t){return t instanceof we?t:t&&new we(t)}static fromLngLat(t,s=0){const u=360*s/40075017,p=u/Math.cos(Math.PI/180*t.lat);return new we(new o.L(t.lng-p,t.lat-u),new o.L(t.lng+p,t.lat+u))}}class Ee{constructor(t,s,u){this.bounds=we.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),u=Math.floor(o.G(this.bounds.getWest())*s),p=Math.floor(o.H(this.bounds.getNorth())*s),g=Math.ceil(o.G(this.bounds.getEast())*s),b=Math.ceil(o.H(this.bounds.getSouth())*s);return t.x>=u&&t.x<g&&t.y>=p&&t.y<b}}class je extends o.E{constructor(t,s,u,p){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Q(this._options,this.map._requestManager,(g,b)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new o.j(g)):b&&(o.e(this,b),b.bounds&&(this.tileBounds=new Ee(b.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.e({},this._options),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.F(s,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,s){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(u,me.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(b,E){return delete t.request,t.aborted?s(null):b&&b.status!==404?s(b):(E&&E.resourceTiming&&(t.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&t.setExpiryData(E),t.loadVectorData(E,this.map.painter),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",p,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",p,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class St extends o.E{constructor(t,s,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},s),o.e(this,o.F(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Q(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.j(t)):s&&(o.e(this,s),s.bounds&&(this.tileBounds=new Ee(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return o.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=V.getImage(this.map._requestManager.transformRequest(u,me.Tile),(p,g,b)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(p)t.state="errored",s(p);else if(g){this.map._refreshExpiredTiles&&b&&t.setExpiryData(b);const E=this.map.painter.context,S=E.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new xe(E,g,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),t.state="loaded",s(null)}},this.map._refreshExpiredTiles)}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}class Mt extends St{constructor(t,s,u,p){super(t,s,u,p),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t,s){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(u,me.Tile);function g(b,E){b&&(t.state="errored",s(b)),E&&(t.dem=E,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=V.getImage(p,(b,E,S)=>o._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(b)t.state="errored",s(b);else if(E){this.map._refreshExpiredTiles&&t.setExpiryData(S);const C=o.a(E)&&o.J()?E:yield function(N){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.K()){const j=N.width+2,re=N.height+2;try{return new o.R({width:j,height:re},yield o.M(N,-1,-1,j,re))}catch{}}return o.h.getImageData(N,1)})}(E),M={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",M,g))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const s=t.canonical,u=Math.pow(2,s.z),p=(s.x-1+u)%u,g=s.x===0?t.wrap-1:t.wrap,b=(s.x+1+u)%u,E=s.x+1===u?t.wrap+1:t.wrap,S={};return S[new o.O(t.overscaledZ,g,s.z,p,s.y).key]={backfilled:!1},S[new o.O(t.overscaledZ,E,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(S[new o.O(t.overscaledZ,g,s.z,p,s.y-1).key]={backfilled:!1},S[new o.O(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new o.O(t.overscaledZ,E,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<u&&(S[new o.O(t.overscaledZ,g,s.z,p,s.y+1).key]={backfilled:!1},S[new o.O(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new o.O(t.overscaledZ,E,s.z,b,s.y+1).key]={backfilled:!1}),S}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class ot extends o.E{constructor(t,s,u,p){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(p),this._data=s.data,this._options=o.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const g=o.N/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*g,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*g,extent:o.N,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:o.N,radius:(s.clusterRadius||50)*g,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,u,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:u},p),this}_updateWorkerData(t){const s=o.e({},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(o.h.resolveURL(this._data),me.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(u,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let g=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g=p.resourceTiming[this.id].slice(0)),u)return void this.fire(new o.j(u));const b={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&o.e(b,{resourceTiming:g}),this.fire(new o.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const u=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(u,p,(g,b)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):g?s(g):(t.loadVectorData(b,this.map.painter,u==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var It=o.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class jt extends o.E{constructor(t,s,u,p){super(),this.load=(g,b)=>{this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=V.getImage(this.map._requestManager.transformRequest(this.url,me.Image),(E,S)=>{this._request=null,this._loaded=!0,E?this.fire(new o.j(E)):S&&(this.image=S,g&&(this.coordinates=g),b&&b(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,b=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new xe(g,this.image,b.RGBA),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE));let E=!1;for(const S in this.tiles){const C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,E=!0)}E&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(o.U.fromLngLat);this.tileID=function(p){let g=1/0,b=1/0,E=-1/0,S=-1/0;for(const j of p)g=Math.min(g,j.x),b=Math.min(b,j.y),E=Math.max(E,j.x),S=Math.max(S,j.y);const C=Math.max(E-g,S-b),M=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),N=Math.pow(2,M);return new o.W(M,Math.floor((g+E)/2*N),Math.floor((b+S)/2*N))}(s),this.minzoom=this.maxzoom=this.tileID.z;const u=s.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new o.V,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,o.N,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,o.N),this._boundsArray.emplaceBack(u[2].x,u[2].y,o.N,o.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}hasTransition(){return!1}}class Qt extends jt{constructor(t,s,u,p){super(t,s,u,p),this.load=()=>{this._loaded=!1;const g=this.options;this.urls=[];for(const b of g.urls)this.urls.push(this.map._requestManager.transformRequest(b,me.Source).url);o.X(this.urls,(b,E)=>{this._loaded=!0,b?this.fire(new o.j(b)):E&&(this.video=E,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,b=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.texSubImage2D(b.TEXTURE_2D,0,0,0,b.RGBA,b.UNSIGNED_BYTE,this.video)):(this.texture=new xe(g,this.video,b.RGBA),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE));let E=!1;for(const S in this.tiles){const C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,E=!0)}E&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=s}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new o.j(new o.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Yt extends jt{constructor(t,s,u,p){super(t,s,u,p),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const b=this.map.painter.context,E=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=o.S.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new xe(b,this.canvas,E.RGBA,{premultiply:!0});let S=!1;for(const C in this.tiles){const M=this.tiles[C];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,S=!0)}S&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(b=>typeof b!="number"))||this.fire(new o.j(new o.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.Y(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new o.j(new o.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const hn={},gr=d=>{switch(d){case"geojson":return ot;case"image":return jt;case"raster":return St;case"raster-dem":return Mt;case"vector":return je;case"video":return Qt;case"canvas":return Yt}return hn[d]};function sn(d,t){const s=o.Z();return o.$(s,s,[1,1,0]),o.a0(s,s,[.5*d.width,.5*d.height,1]),o.a1(s,s,d.calculatePosMatrix(t.toUnwrapped()))}function Sr(d,t,s,u,p,g){const b=function(N,j,re){if(N)for(const te of N){const oe=j[te];if(oe&&oe.source===re&&oe.type==="fill-extrusion")return!0}else for(const te in j){const oe=j[te];if(oe.source===re&&oe.type==="fill-extrusion")return!0}return!1}(p&&p.layers,t,d.id),E=g.maxPitchScaleFactor(),S=d.tilesIn(u,E,b);S.sort(An);const C=[];for(const N of S)C.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,s,d._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,p,g,E,sn(d.transform,N.tileID))});const M=function(N){const j={},re={};for(const te of N){const oe=te.queryResults,K=te.wrappedTileID,Se=re[K]=re[K]||{};for(const Ne in oe){const pe=oe[Ne],De=Se[Ne]=Se[Ne]||{},Fe=j[Ne]=j[Ne]||[];for(const Be of pe)De[Be.featureIndex]||(De[Be.featureIndex]=!0,Fe.push(Be))}}return j}(C);for(const N in M)M[N].forEach(j=>{const re=j.feature,te=d.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=te});return M}function An(d,t){const s=d.tileID,u=t.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}class Dn{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.a2(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,g){const b={};if(!g)return b;for(const E of p){const S=E.layerIds.map(C=>g.getLayer(C)).filter(Boolean);if(S.length!==0){E.layers=S,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(C=>S.filter(M=>M.id===C)[0]));for(const C of S)b[C.id]=E}}return b}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof o.a4){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof o.a4&&g.hasRTLText){this.hasRTLText=!0,o.a5();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xe(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xe(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,u,p,g,b,E,S,C,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:b,tileSize:this.tileSize,pixelPosMatrix:M,transform:S,params:E,queryPadding:this.queryPadding*C},t,s,u):{}}querySourceFeatures(t,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),g=s&&s.sourceLayer?s.sourceLayer:"",b=p._geojsonTileLayer||p[g];if(!b)return;const E=o.a6(s&&s.filter),{z:S,x:C,y:M}=this.tileID.canonical,N={z:S,x:C,y:M};for(let j=0;j<b.length;j++){const re=b.feature(j);if(E.needGeometry){const K=o.a7(re,!0);if(!E.filter(new o.a8(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!E.filter(new o.a8(this.tileID.overscaledZ),re))continue;const te=u.getId(re,g),oe=new o.a9(re,S,C,M,te);oe.tile=N,t.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const u=o.aa(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=u+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const g=this.buckets[p],b=g.layers[0].sourceLayer||"_geojsonTileLayer",E=u[b],S=t[b];if(!E||!S||Object.keys(S).length===0)continue;g.update(S,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=s&&s.style&&s.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.h.now()+t}setDependencies(t,s){const u={};for(const p of s)u[p]=!0;this.dependencies[t]=u}hasDependency(t,s){for(const u of t){const p=this.dependencies[u];if(p){for(const g of s)if(p[g])return!0}}return!1}}class Xe{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},u)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const u=t.wrapped().key,p=s===void 0?0:this.data[u].indexOf(s),g=this.data[u][p];return this.data[u].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||s.push(p);for(const u of s)this.remove(u.value.tileID,u)}}class $e{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,u){const p=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},o.e(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])u[g]||(this.deletedStates[t][p][g]=null)}else for(const g in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,s,u){if(this.deletedStates[t]===null)return;const p=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&s!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,s){const u=String(s),p=o.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][s];if(g===null)return{};for(const b in g)delete p[b]}return p}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),o.e(this.state[p][b],this.stateChanges[p][b]),g[b]=this.state[p][b];u[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const b in this.state[p])g[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(this.deletedStates[p][b]===null)this.state[p][b]={};else for(const E of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][E];g[b]=this.state[p][b]}u[p]=u[p]||{},o.e(u[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].setFeatureState(u,s)}}class Jt extends o.E{constructor(t,s,u){super(),this.id=t,this.dispatcher=u,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,g,b,E)=>{const S=new(gr(g.type))(p,g,b,E);if(S.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${S.id}`);return S})(t,s,u,this),this._tiles={},this._cache=new Xe(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $e,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(wr).map(t=>t.key)}getRenderableIds(t){const s=[];for(const u in this._tiles)this._isIdRenderable(u,t)&&s.push(this._tiles[u]);return t?s.sort((u,p)=>{const g=u.tileID,b=p.tileID,E=new o.P(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),S=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-b.overscaledZ||S.y-E.y||S.x-E.x}).map(u=>u.tileID.key):s.map(u=>u.tileID).sort(wr).map(u=>u.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=s),this._loadTile(u,this._tileLoaded.bind(this,u,t,s)))}_tileLoaded(t,s,u,p){if(p)return t.state="errored",void(p.status!==404?this._source.fire(new o.j(p,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=o.h.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const b=this.getTileByID(g);u(t,b),u(b,t)}}function u(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let b=g.tileID.canonical.x-p.tileID.canonical.x;const E=g.tileID.canonical.y-p.tileID.canonical.y,S=Math.pow(2,p.tileID.canonical.z),C=g.tileID.key;b===0&&E===0||Math.abs(E)>1||(Math.abs(b)>1&&(Math.abs(b+S)===1?b+=S:Math.abs(b-S)===1&&(b-=S)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,b,E),p.neighboringTiles&&p.neighboringTiles[C]&&(p.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,u,p){for(const g in this._tiles){let b=this._tiles[g];if(p[g]||!b.hasData()||b.tileID.overscaledZ<=s||b.tileID.overscaledZ>u)continue;let E=b.tileID;for(;b&&b.tileID.overscaledZ>s+1;){const C=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[C.key],b&&b.hasData()&&(E=C)}let S=E;for(;S.overscaledZ>s;)if(S=S.scaledTo(S.overscaledZ-1),t[S.key]){p[E.key]=E;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=t.overscaledZ-1;u>=s;u--){const p=t.scaledTo(u),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(s*u*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const u={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),u[g.tileID.key]=g}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new o.O(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(u=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(u=u.filter(M=>this._source.hasTile(M)))):u=[];const p=t.coveringZoomLevel(this._source),g=Math.max(p-Jt.maxOverzooming,this._source.minzoom),b=Math.max(p+Jt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const N of u)if(N.canonical.z>this._source.minzoom){const j=N.scaledTo(N.canonical.z-1);M[j.key]=j;const re=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));M[re.key]=re}u=u.concat(Object.values(M))}const E=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(u,p);if(ur(this._source.type)){const M={},N={},j=Object.keys(S),re=o.h.now();for(const te of j){const oe=S[te],K=this._tiles[te];if(!K||K.fadeEndTime!==0&&K.fadeEndTime<=re)continue;const Se=this.findLoadedParent(oe,g);Se&&(this._addTile(Se.tileID),M[Se.tileID.key]=Se.tileID),N[te]=oe}this._retainLoadedChildren(N,p,b,S);for(const te in M)S[te]||(this._coveredTiles[te]=!0,S[te]=M[te]);if(s){const te={},oe={};for(const K of u)this._tiles[K.key].hasData()?te[K.key]=K:oe[K.key]=K;for(const K in oe){const Se=oe[K].children(this._source.maxzoom);this._tiles[Se[0].key]&&this._tiles[Se[1].key]&&this._tiles[Se[2].key]&&this._tiles[Se[3].key]&&(te[Se[0].key]=S[Se[0].key]=Se[0],te[Se[1].key]=S[Se[1].key]=Se[1],te[Se[2].key]=S[Se[2].key]=Se[2],te[Se[3].key]=S[Se[3].key]=Se[3],delete oe[K])}for(const K in oe){const Se=this.findLoadedParent(oe[K],this._source.minzoom);if(Se){te[Se.tileID.key]=S[Se.tileID.key]=Se.tileID;for(const Ne in te)te[Ne].isChildOf(Se.tileID)&&delete te[Ne]}}for(const K in this._tiles)te[K]||(this._coveredTiles[K]=!0)}}for(const M in S)this._tiles[M].clearFadeHold();const C=o.ab(this._tiles,S);for(const M of C){const N=this._tiles[M];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const u={},p={},g=Math.max(s-Jt.maxOverzooming,this._source.minzoom),b=Math.max(s+Jt.maxUnderzooming,this._source.minzoom),E={};for(const S of t){const C=this._addTile(S);u[S.key]=S,C.hasData()||s<this._source.maxzoom&&(E[S.key]=S)}this._retainLoadedChildren(E,s,b,u);for(const S of t){let C=this._tiles[S.key];if(C.hasData())continue;if(s+1>this._source.maxzoom){const N=S.children(this._source.maxzoom)[0],j=this.getTile(N);if(j&&j.hasData()){u[N.key]=N;continue}}else{const N=S.children(this._source.maxzoom);if(u[N[0].key]&&u[N[1].key]&&u[N[2].key]&&u[N[3].key])continue}let M=C.wasRequested();for(let N=S.overscaledZ-1;N>=g;--N){const j=S.scaledTo(N);if(p[j.key])break;if(p[j.key]=!0,C=this.getTile(j),!C&&M&&(C=this._addTile(j)),C){const re=C.hasData();if((M||re)&&(u[j.key]=j),M=C.wasRequested(),re)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;p=g}for(const g of s)this._loadedParentTiles[g]=u}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const u=s;return s||(s=new Dn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,u||this._source.fire(new o.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=s.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,u){const p=[],g=this.transform;if(!g)return p;const b=u?g.getCameraQueryGeometry(t):t,E=t.map(te=>g.pointCoordinate(te,this.terrain)),S=b.map(te=>g.pointCoordinate(te,this.terrain)),C=this.getIds();let M=1/0,N=1/0,j=-1/0,re=-1/0;for(const te of S)M=Math.min(M,te.x),N=Math.min(N,te.y),j=Math.max(j,te.x),re=Math.max(re,te.y);for(let te=0;te<C.length;te++){const oe=this._tiles[C[te]];if(oe.holdingForFade())continue;const K=oe.tileID,Se=Math.pow(2,g.zoom-oe.tileID.overscaledZ),Ne=s*oe.queryPadding*o.N/oe.tileSize/Se,pe=[K.getTilePoint(new o.U(M,N)),K.getTilePoint(new o.U(j,re))];if(pe[0].x-Ne<o.N&&pe[0].y-Ne<o.N&&pe[1].x+Ne>=0&&pe[1].y+Ne>=0){const De=E.map(Be=>K.getTilePoint(Be)),Fe=S.map(Be=>K.getTilePoint(Be));p.push({tile:oe,tileID:K,queryGeometry:De,cameraQueryGeometry:Fe,scale:Se})}}return p}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of s)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(ur(this._source.type)){const t=o.h.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,u){this._state.updateState(t=t||"_geojsonTileLayer",s,u)}removeFeatureState(t,s,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,u)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,u){const p=this._tiles[t];p&&p.setDependencies(s,u)}reloadTilesForDependencies(t,s){for(const u in this._tiles)this._tiles[u].hasDependency(t,s)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(t,s))}}function wr(d,t){const s=Math.abs(2*d.wrap)-+(d.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||u-s||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function ur(d){return d==="raster"||d==="image"||d==="video"}Jt.maxOverzooming=10,Jt.maxUnderzooming=3;const sr="mapboxgl_preloaded_worker_pool";class Nn{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Nn.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[sr]}numActive(){return Object.keys(this.active).length}}const Ii=Math.floor(o.h.hardwareConcurrency/2);let Ln;function ds(){return Ln||(Ln=new Nn),Ln}Nn.workerCount=o.ac(globalThis)?Math.max(Math.min(Ii,3),1):1;class Ri{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ad(t,0,1);let s=1,u=this._distances[s];const p=t*this.paddedLength+this.padding;for(;u<p&&s<this._distances.length;)u=this._distances[++s];const g=s-1,b=this._distances[g],E=u-b,S=E>0?(p-b)/E:0;return this.points[g].mult(1-S).add(this.points[s].mult(S))}}function oi(d,t){let s=!0;return d==="always"||d!=="never"&&t!=="never"||(s=!1),s}class ai{constructor(t,s,u){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(s/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,u,p,g){this._forEachCell(s,u,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,s,u,p){this._forEachCell(s-p,u-p,s+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,s,u,p,g,b){this.boxCells[g].push(b)}_insertCircleCell(t,s,u,p,g,b){this.circleCells[g].push(b)}_query(t,s,u,p,g,b,E){if(u<0||t>this.width||p<0||s>this.height)return[];const S=[];if(t<=0&&s<=0&&this.width<=u&&this.height<=p){if(g)return[{key:null,x1:t,y1:s,x2:u,y2:p}];for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const M=this.circles[3*C],N=this.circles[3*C+1],j=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:M-j,y1:N-j,x2:M+j,y2:N+j})}}else this._forEachCell(t,s,u,p,this._queryCell,S,{hitTest:g,overlapMode:b,seenUids:{box:{},circle:{}}},E);return S}query(t,s,u,p){return this._query(t,s,u,p,!1,null)}hitTest(t,s,u,p,g,b){return this._query(t,s,u,p,!0,g,b).length>0}hitTestCircle(t,s,u,p,g){const b=t-u,E=t+u,S=s-u,C=s+u;if(E<0||b>this.width||C<0||S>this.height)return!1;const M=[];return this._forEachCell(b,S,E,C,this._queryCellCircle,M,{hitTest:!0,overlapMode:p,circle:{x:t,y:s,radius:u},seenUids:{box:{},circle:{}}},g),M.length>0}_queryCell(t,s,u,p,g,b,E,S){const{seenUids:C,hitTest:M,overlapMode:N}=E,j=this.boxCells[g];if(j!==null){const te=this.bboxes;for(const oe of j)if(!C.box[oe]){C.box[oe]=!0;const K=4*oe,Se=this.boxKeys[oe];if(t<=te[K+2]&&s<=te[K+3]&&u>=te[K+0]&&p>=te[K+1]&&(!S||S(Se))&&(!M||!oi(N,Se.overlapMode))&&(b.push({key:Se,x1:te[K],y1:te[K+1],x2:te[K+2],y2:te[K+3]}),M))return!0}}const re=this.circleCells[g];if(re!==null){const te=this.circles;for(const oe of re)if(!C.circle[oe]){C.circle[oe]=!0;const K=3*oe,Se=this.circleKeys[oe];if(this._circleAndRectCollide(te[K],te[K+1],te[K+2],t,s,u,p)&&(!S||S(Se))&&(!M||!oi(N,Se.overlapMode))){const Ne=te[K],pe=te[K+1],De=te[K+2];if(b.push({key:Se,x1:Ne-De,y1:pe-De,x2:Ne+De,y2:pe+De}),M)return!0}}}return!1}_queryCellCircle(t,s,u,p,g,b,E,S){const{circle:C,seenUids:M,overlapMode:N}=E,j=this.boxCells[g];if(j!==null){const te=this.bboxes;for(const oe of j)if(!M.box[oe]){M.box[oe]=!0;const K=4*oe,Se=this.boxKeys[oe];if(this._circleAndRectCollide(C.x,C.y,C.radius,te[K+0],te[K+1],te[K+2],te[K+3])&&(!S||S(Se))&&!oi(N,Se.overlapMode))return b.push(!0),!0}}const re=this.circleCells[g];if(re!==null){const te=this.circles;for(const oe of re)if(!M.circle[oe]){M.circle[oe]=!0;const K=3*oe,Se=this.circleKeys[oe];if(this._circlesCollide(te[K],te[K+1],te[K+2],C.x,C.y,C.radius)&&(!S||S(Se))&&!oi(N,Se.overlapMode))return b.push(!0),!0}}}_forEachCell(t,s,u,p,g,b,E,S){const C=this._convertToXCellCoord(t),M=this._convertToYCellCoord(s),N=this._convertToXCellCoord(u),j=this._convertToYCellCoord(p);for(let re=C;re<=N;re++)for(let te=M;te<=j;te++)if(g.call(this,t,s,u,p,this.xCellCount*te+re,b,E,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,u,p,g,b){const E=p-t,S=g-s,C=u+b;return C*C>E*E+S*S}_circleAndRectCollide(t,s,u,p,g,b,E){const S=(b-p)/2,C=Math.abs(t-(p+S));if(C>S+u)return!1;const M=(E-g)/2,N=Math.abs(s-(g+M));if(N>M+u)return!1;if(C<=S||N<=M)return!0;const j=C-S,re=N-M;return j*j+re*re<=u*u}}function it(d,t,s,u,p){const g=o.Z();return t?(o.a0(g,g,[1/p,1/p,1]),s||o.ae(g,g,u.angle)):o.a1(g,u.labelPlaneMatrix,d),g}function jn(d,t,s,u,p){if(t){const g=o.af(d);return o.a0(g,g,[p,p,1]),s||o.ae(g,g,-u.angle),g}return u.glCoordMatrix}function Pr(d,t,s){let u;s?(u=[d.x,d.y,s(d.x,d.y),1],o.ag(u,u,t)):(u=[d.x,d.y,0,1],se(u,u,t));const p=u[3];return{point:new o.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p}}function Ai(d,t){return .5+d/t*.5}function qn(d,t){const s=d[0]/d[3],u=d[1]/d[3];return s>=-t[0]&&s<=t[0]&&u>=-t[1]&&u<=t[1]}function nt(d,t,s,u,p,g,b,E,S,C){const M=u?d.textSizeData:d.iconSizeData,N=o.ah(M,s.transform.zoom),j=[256/s.width*2+1,256/s.height*2+1],re=u?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;re.clear();const te=d.lineVertexArray,oe=u?d.text.placedSymbolArray:d.icon.placedSymbolArray,K=s.transform.width/s.transform.height;let Se=!1;for(let Ne=0;Ne<oe.length;Ne++){const pe=oe.get(Ne);if(pe.hidden||pe.writingMode===o.ai.vertical&&!Se){X(pe.numGlyphs,re);continue}let De;if(Se=!1,C?(De=[pe.anchorX,pe.anchorY,C(pe.anchorX,pe.anchorY),1],o.ag(De,De,t)):(De=[pe.anchorX,pe.anchorY,0,1],se(De,De,t)),!qn(De,j)){X(pe.numGlyphs,re);continue}const Fe=Ai(s.transform.cameraToCenterDistance,De[3]),Be=o.aj(M,N,pe),He=b?Be/Fe:Be*Fe,tt=new o.P(pe.anchorX,pe.anchorY),Qe=Pr(tt,p,C).point,st={projections:{},offsets:{}},Rt=on(pe,He,!1,E,t,p,g,d.glyphOffsetArray,te,re,Qe,tt,st,K,S,C);Se=Rt.useVertical,(Rt.notEnoughRoom||Se||Rt.needsFlipping&&on(pe,He,!0,E,t,p,g,d.glyphOffsetArray,te,re,Qe,tt,st,K,S,C).notEnoughRoom)&&X(pe.numGlyphs,re)}u?d.text.dynamicLayoutVertexBuffer.updateData(re):d.icon.dynamicLayoutVertexBuffer.updateData(re)}function Xt(d,t,s,u,p,g,b,E,S,C,M,N,j){const re=E.glyphStartIndex+E.numGlyphs,te=E.lineStartIndex,oe=E.lineStartIndex+E.lineLength,K=t.getoffsetX(E.glyphStartIndex),Se=t.getoffsetX(re-1),Ne=O(d*K,s,u,p,g,b,E.segment,te,oe,S,C,M,N,j);if(!Ne)return null;const pe=O(d*Se,s,u,p,g,b,E.segment,te,oe,S,C,M,N,j);return pe?{first:Ne,last:pe}:null}function Ht(d,t,s,u){return d===o.ai.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*u?{useVertical:!0}:(d===o.ai.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function on(d,t,s,u,p,g,b,E,S,C,M,N,j,re,te,oe){const K=t/24,Se=d.lineOffsetX*K,Ne=d.lineOffsetY*K;let pe;if(d.numGlyphs>1){const De=d.glyphStartIndex+d.numGlyphs,Fe=d.lineStartIndex,Be=d.lineStartIndex+d.lineLength,He=Xt(K,E,Se,Ne,s,M,N,d,S,g,j,te,oe);if(!He)return{notEnoughRoom:!0};const tt=Pr(He.first.point,b,oe).point,Qe=Pr(He.last.point,b,oe).point;if(u&&!s){const st=Ht(d.writingMode,tt,Qe,re);if(st)return st}pe=[He.first];for(let st=d.glyphStartIndex+1;st<De-1;st++)pe.push(O(K*E.getoffsetX(st),Se,Ne,s,M,N,d.segment,Fe,Be,S,g,j,te,oe));pe.push(He.last)}else{if(u&&!s){const Fe=Pr(N,p,oe).point,Be=d.lineStartIndex+d.segment+1,He=new o.P(S.getx(Be),S.gety(Be)),tt=Pr(He,p,oe),Qe=tt.signedDistanceFromCamera>0?tt.point:Z(N,He,Fe,1,p,oe),st=Ht(d.writingMode,Fe,Qe,re);if(st)return st}const De=O(K*E.getoffsetX(d.glyphStartIndex),Se,Ne,s,M,N,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,S,g,j,te,oe);if(!De)return{notEnoughRoom:!0};pe=[De]}for(const De of pe)o.ak(C,De.point,De.angle);return{}}function Z(d,t,s,u,p,g){const b=Pr(d.add(d.sub(t)._unit()),p,g).point,E=s.sub(b);return s.add(E._mult(u/E.mag()))}function H(d,t){const{projectionCache:s,lineVertexArray:u,labelPlaneMatrix:p,tileAnchorPoint:g,distanceFromAnchor:b,getElevation:E,previousVertex:S,direction:C,absOffsetX:M}=t;if(s.projections[d])return s.projections[d];const N=new o.P(u.getx(d),u.gety(d)),j=Pr(N,p,E);if(j.signedDistanceFromCamera>0)return s.projections[d]=j.point,j.point;const re=d-C;return Z(b===0?g:new o.P(u.getx(re),u.gety(re)),N,S,M-b+1,p,E)}function _e(d,t,s){return d._unit()._perp()._mult(t*s)}function $(d,t,s,u,p,g,b,E){const{projectionCache:S,direction:C}=E;if(S.offsets[d])return S.offsets[d];const M=s.add(t);if(d+C<u||d+C>=p)return S.offsets[d]=M,M;const N=H(d+C,E),j=_e(N.sub(s),b,C),re=s.add(j),te=N.add(j);return S.offsets[d]=o.al(g,M,re,te)||M,S.offsets[d]}function O(d,t,s,u,p,g,b,E,S,C,M,N,j,re){const te=u?d-t:d+t;let oe=te>0?1:-1,K=0;u&&(oe*=-1,K=Math.PI),oe<0&&(K+=Math.PI);let Se,Ne,pe=oe>0?E+b:E+b+1,De=p,Fe=p,Be=0,He=0;const tt=Math.abs(te),Qe=[];let st;for(;Be+He<=tt;){if(pe+=oe,pe<E||pe>=S)return null;Be+=He,Fe=De,Ne=Se;const pt={projectionCache:N,lineVertexArray:C,labelPlaneMatrix:M,tileAnchorPoint:g,distanceFromAnchor:Be,getElevation:re,previousVertex:Fe,direction:oe,absOffsetX:tt};if(De=H(pe,pt),s===0)Qe.push(Fe),st=De.sub(Fe);else{let Gt;const Lt=De.sub(Fe);Gt=Lt.mag()===0?_e(H(pe+oe,pt).sub(De),s,oe):_e(Lt,s,oe),Ne||(Ne=Fe.add(Gt)),Se=$(pe,Gt,De,E,S,Ne,s,pt),Qe.push(Ne),st=Se.sub(Ne)}He=st.mag()}const Rt=st._mult((tt-Be)/He)._add(Ne||Fe),ar=K+Math.atan2(De.y-Fe.y,De.x-Fe.x);return Qe.push(Rt),{point:Rt,angle:j?ar:0,path:Qe}}const B=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function X(d,t){for(let s=0;s<d;s++){const u=t.length;t.resize(u+4),t.float32.set(B,3*u)}}function se(d,t,s){const u=t[0],p=t[1];return d[0]=s[0]*u+s[4]*p+s[12],d[1]=s[1]*u+s[5]*p+s[13],d[3]=s[3]*u+s[7]*p+s[15],d}const ae=100;class Ie{constructor(t,s=new ai(t.width+200,t.height+200,25),u=new ai(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=u,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ae,this.screenBottomBoundary=t.height+ae,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,u,p,g,b){const E=this.projectAndGetPerspectiveRatio(p,t.anchorPointX,t.anchorPointY,b),S=u*E.perspectiveRatio,C=t.x1*S+E.point.x,M=t.y1*S+E.point.y,N=t.x2*S+E.point.x,j=t.y2*S+E.point.y;return!this.isInsideGrid(C,M,N,j)||s!=="always"&&this.grid.hitTest(C,M,N,j,s,g)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,M,N,j],offscreen:this.isOffscreen(C,M,N,j)}}placeCollisionCircles(t,s,u,p,g,b,E,S,C,M,N,j,re,te){const oe=[],K=new o.P(s.anchorX,s.anchorY),Se=Pr(K,b,te),Ne=Ai(this.transform.cameraToCenterDistance,Se.signedDistanceFromCamera),pe=(M?g/Ne:g*Ne)/o.ap,De=Pr(K,E,te).point,Fe=Xt(pe,p,s.lineOffsetX*pe,s.lineOffsetY*pe,!1,De,K,s,u,E,{projections:{},offsets:{}},!1,te);let Be=!1,He=!1,tt=!0;if(Fe){const Qe=.5*j*Ne+re,st=new o.P(-100,-100),Rt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ar=new Ri,pt=Fe.first,Gt=Fe.last;let Lt=[];for(let Kt=pt.path.length-1;Kt>=1;Kt--)Lt.push(pt.path[Kt]);for(let Kt=1;Kt<Gt.path.length;Kt++)Lt.push(Gt.path[Kt]);const Dr=2.5*Qe;if(S){const Kt=Lt.map(lr=>Pr(lr,S,te));Lt=Kt.some(lr=>lr.signedDistanceFromCamera<=0)?[]:Kt.map(lr=>lr.point)}let ir=[];if(Lt.length>0){const Kt=Lt[0].clone(),lr=Lt[0].clone();for(let Kr=1;Kr<Lt.length;Kr++)Kt.x=Math.min(Kt.x,Lt[Kr].x),Kt.y=Math.min(Kt.y,Lt[Kr].y),lr.x=Math.max(lr.x,Lt[Kr].x),lr.y=Math.max(lr.y,Lt[Kr].y);ir=Kt.x>=st.x&&lr.x<=Rt.x&&Kt.y>=st.y&&lr.y<=Rt.y?[Lt]:lr.x<st.x||Kt.x>Rt.x||lr.y<st.y||Kt.y>Rt.y?[]:o.am([Lt],st.x,st.y,Rt.x,Rt.y)}for(const Kt of ir){ar.reset(Kt,.25*Qe);let lr=0;lr=ar.length<=.5*Qe?1:Math.ceil(ar.paddedLength/Dr)+1;for(let Kr=0;Kr<lr;Kr++){const Rr=Kr/Math.max(lr-1,1),Cn=ar.lerp(Rr),mn=Cn.x+ae,rn=Cn.y+ae;oe.push(mn,rn,Qe,0);const xi=mn-Qe,Br=rn-Qe,es=mn+Qe,ts=rn+Qe;if(tt=tt&&this.isOffscreen(xi,Br,es,ts),He=He||this.isInsideGrid(xi,Br,es,ts),t!=="always"&&this.grid.hitTestCircle(mn,rn,Qe,t,N)&&(Be=!0,!C))return{circles:[],offscreen:!1,collisionDetected:Be}}}}return{circles:!C&&Be||!He||Ne<this.perspectiveRatioCutoff?[]:oe,offscreen:tt,collisionDetected:Be}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,p=1/0,g=-1/0,b=-1/0;for(const M of t){const N=new o.P(M.x+ae,M.y+ae);u=Math.min(u,N.x),p=Math.min(p,N.y),g=Math.max(g,N.x),b=Math.max(b,N.y),s.push(N)}const E=this.grid.query(u,p,g,b).concat(this.ignoredGrid.query(u,p,g,b)),S={},C={};for(const M of E){const N=M.key;if(S[N.bucketInstanceId]===void 0&&(S[N.bucketInstanceId]={}),S[N.bucketInstanceId][N.featureIndex])continue;const j=[new o.P(M.x1,M.y1),new o.P(M.x2,M.y1),new o.P(M.x2,M.y2),new o.P(M.x1,M.y2)];o.an(s,j)&&(S[N.bucketInstanceId][N.featureIndex]=!0,C[N.bucketInstanceId]===void 0&&(C[N.bucketInstanceId]=[]),C[N.bucketInstanceId].push(N.featureIndex))}return C}insertCollisionBox(t,s,u,p,g,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:b,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,u,p,g,b){const E=u?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:g,collisionGroupID:b,overlapMode:s};for(let C=0;C<t.length;C+=4)E.insertCircle(S,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,s,u,p){let g;return p?(g=[s,u,p(s,u),1],o.ag(g,g,t)):(g=[s,u,0,1],se(g,g,t)),{point:new o.P((g[0]/g[3]+1)/2*this.transform.width+ae,(-g[1]/g[3]+1)/2*this.transform.height+ae),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,s,u,p){return u<ae||t>=this.screenRightBoundary||p<ae||s>this.screenBottomBoundary}isInsideGrid(t,s,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=o.ao([]);return o.$(t,t,[-100,-100,0]),t}}function ve(d,t,s){return t*(o.N/(d.tileSize*Math.pow(2,s-d.tileID.overscaledZ)))}class he{constructor(t,s,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Te{constructor(t,s,u,p,g){this.text=new he(t?t.text:null,s,u,g),this.icon=new he(t?t.icon:null,s,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ue{constructor(t,s,u){this.text=t,this.icon=s,this.skipFade=u}}class Ve{constructor(){this.invProjMatrix=o.Z(),this.viewportMatrix=o.Z(),this.circles=[]}}class qe{constructor(t,s,u,p,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=g}}class Ct{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[t]}}function kt(d,t,s,u,p){const{horizontalAlign:g,verticalAlign:b}=o.au(d);return new o.P(-(g-.5)*t+u[0]*p,-(b-.5)*s+u[1]*p)}function At(d,t,s,u,p,g){const{x1:b,x2:E,y1:S,y2:C,anchorPointX:M,anchorPointY:N}=d,j=new o.P(t,s);return u&&j._rotate(p?g:-g),{x1:b+j.x,y1:S+j.y,x2:E+j.x,y2:C+j.y,anchorPointX:M,anchorPointY:N}}class Ot{constructor(t,s,u,p,g){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Ie(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ct(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,u,p){const g=u.getBucket(s),b=u.latestFeatureIndex;if(!g||!b||s.id!==g.layerIds[0])return;const E=u.collisionBoxArray,S=g.layers[0].layout,C=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),M=u.tileSize/o.N,N=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),j=S.get("text-pitch-alignment")==="map",re=S.get("text-rotation-alignment")==="map",te=ve(u,1,this.transform.zoom),oe=it(N,j,re,this.transform,te);let K=null;if(j){const Ne=jn(N,j,re,this.transform,te);K=o.a1([],this.transform.labelPlaneMatrix,Ne)}this.retainedQueryData[g.bucketInstanceId]=new qe(g.bucketInstanceId,b,g.sourceLayerIndex,g.index,u.tileID);const Se={bucket:g,layout:S,posMatrix:N,textLabelPlaneMatrix:oe,labelToScreenMatrix:K,scale:C,textPixelRatio:M,holdingForFade:u.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:o.ah(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(const Ne of g.sortKeyRanges){const{sortKey:pe,symbolInstanceStart:De,symbolInstanceEnd:Fe}=Ne;t.push({sortKey:pe,symbolInstanceStart:De,symbolInstanceEnd:Fe,parameters:Se})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(t,s,u,p,g,b,E,S,C,M,N,j,re,te,oe,K){const Se=o.aq[t.textAnchor],Ne=[t.textOffset0,t.textOffset1],pe=kt(Se,u,p,Ne,g),De=this.collisionIndex.placeCollisionBox(At(s,pe.x,pe.y,b,E,this.transform.angle),N,S,C,M.predicate,K);if((!oe||this.collisionIndex.placeCollisionBox(At(oe,pe.x,pe.y,b,E,this.transform.angle),N,S,C,M.predicate,K).box.length!==0)&&De.box.length>0){let Fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:Ne,width:u,height:p,anchor:Se,textBoxScale:g,prevAnchor:Fe},this.markUsedJustification(re,Se,j,te),re.allowVerticalPlacement&&(this.markUsedOrientation(re,te,j),this.placedOrientations[j.crossTileID]=te),{shift:pe,placedGlyphBoxes:De}}}placeLayerBucketPart(t,s,u){const{bucket:p,layout:g,posMatrix:b,textLabelPlaneMatrix:E,labelToScreenMatrix:S,textPixelRatio:C,holdingForFade:M,collisionBoxArray:N,partiallyEvaluatedTextSize:j,collisionGroup:re}=t.parameters,te=g.get("text-optional"),oe=g.get("icon-optional"),K=o.ar(g,"text-overlap","text-allow-overlap"),Se=K==="always",Ne=o.ar(g,"icon-overlap","icon-allow-overlap"),pe=Ne==="always",De=g.get("text-rotation-alignment")==="map",Fe=g.get("text-pitch-alignment")==="map",Be=g.get("icon-text-fit")!=="none",He=g.get("symbol-z-order")==="viewport-y",tt=Se&&(pe||!p.hasIconData()||oe),Qe=pe&&(Se||!p.hasTextData()||te);!p.collisionArrays&&N&&p.deserializeCollisionBoxes(N);const st=this.retainedQueryData[p.bucketInstanceId].tileID,Rt=this.terrain?(pt,Gt)=>this.terrain.getElevation(st,pt,Gt):null,ar=(pt,Gt)=>{var Lt,Dr;if(s[pt.crossTileID])return;if(M)return void(this.placements[pt.crossTileID]=new Ue(!1,!1,!1));let ir=!1,Kt=!1,lr=!0,Kr=null,Rr={box:null,offscreen:null},Cn={box:null,offscreen:null},mn=null,rn=null,xi=null,Br=0,es=0,ts=0;Gt.textFeatureIndex?Br=Gt.textFeatureIndex:pt.useRuntimeCollisionCircles&&(Br=pt.featureIndex),Gt.verticalTextFeatureIndex&&(es=Gt.verticalTextFeatureIndex);const $s=Gt.textBox;if($s){const Bn=Qr=>{let gn=o.ai.horizontal;if(p.allowVerticalPlacement&&!Qr&&this.prevPlacement){const pi=this.prevPlacement.placedOrientations[pt.crossTileID];pi&&(this.placedOrientations[pt.crossTileID]=pi,gn=pi,this.markUsedOrientation(p,gn,pt))}return gn},Pn=(Qr,gn)=>{if(p.allowVerticalPlacement&&pt.numVerticalGlyphVertices>0&&Gt.verticalTextBox){for(const pi of p.writingModes)if(pi===o.ai.vertical?(Rr=gn(),Cn=Rr):Rr=Qr(),Rr&&Rr.box&&Rr.box.length)break}else Rr=Qr()},ei=pt.textAnchorOffsetStartIndex,_o=pt.textAnchorOffsetEndIndex;if(_o===ei){const Qr=(gn,pi)=>{const en=this.collisionIndex.placeCollisionBox(gn,K,C,b,re.predicate,Rt);return en&&en.box&&en.box.length&&(this.markUsedOrientation(p,pi,pt),this.placedOrientations[pt.crossTileID]=pi),en};Pn(()=>Qr($s,o.ai.horizontal),()=>{const gn=Gt.verticalTextBox;return p.allowVerticalPlacement&&pt.numVerticalGlyphVertices>0&&gn?Qr(gn,o.ai.vertical):{box:null,offscreen:null}}),Bn(Rr&&Rr.box&&Rr.box.length)}else{let Qr=o.aq[(Dr=(Lt=this.prevPlacement)===null||Lt===void 0?void 0:Lt.variableOffsets[pt.crossTileID])===null||Dr===void 0?void 0:Dr.anchor];const gn=(en,vo,Sl)=>{const ju=en.x2-en.x1,qu=en.y2-en.y1,up=pt.textBoxScale,xc=Be&&Ne==="never"?vo:null;let rs={box:[],offscreen:!1},xo=K==="never"?1:2,ns="never";Qr&&xo++;for(let Pi=0;Pi<xo;Pi++){for(let is=ei;is<_o;is++){const bc=p.textAnchorOffsets.get(is);if(Qr&&bc.textAnchor!==Qr)continue;const Ss=this.attemptAnchorPlacement(bc,en,ju,qu,up,De,Fe,C,b,re,ns,pt,p,Sl,xc,Rt);if(Ss&&(rs=Ss.placedGlyphBoxes,rs&&rs.box&&rs.box.length))return ir=!0,Kr=Ss.shift,rs}Qr?Qr=null:ns=K}return rs};Pn(()=>gn($s,Gt.iconBox,o.ai.horizontal),()=>{const en=Gt.verticalTextBox;return p.allowVerticalPlacement&&!(Rr&&Rr.box&&Rr.box.length)&&pt.numVerticalGlyphVertices>0&&en?gn(en,Gt.verticalIconBox,o.ai.vertical):{box:null,offscreen:null}}),Rr&&(ir=Rr.box,lr=Rr.offscreen);const pi=Bn(Rr&&Rr.box);if(!ir&&this.prevPlacement){const en=this.prevPlacement.variableOffsets[pt.crossTileID];en&&(this.variableOffsets[pt.crossTileID]=en,this.markUsedJustification(p,en.anchor,pt,pi))}}}if(mn=Rr,ir=mn&&mn.box&&mn.box.length>0,lr=mn&&mn.offscreen,pt.useRuntimeCollisionCircles){const Bn=p.text.placedSymbolArray.get(pt.centerJustifiedTextSymbolIndex),Pn=o.aj(p.textSizeData,j,Bn),ei=g.get("text-padding");rn=this.collisionIndex.placeCollisionCircles(K,Bn,p.lineVertexArray,p.glyphOffsetArray,Pn,b,E,S,u,Fe,re.predicate,pt.collisionCircleDiameter,ei,Rt),rn.circles.length&&rn.collisionDetected&&!u&&o.w("Collisions detected, but collision boxes are not shown"),ir=Se||rn.circles.length>0&&!rn.collisionDetected,lr=lr&&rn.offscreen}if(Gt.iconFeatureIndex&&(ts=Gt.iconFeatureIndex),Gt.iconBox){const Bn=Pn=>{const ei=Be&&Kr?At(Pn,Kr.x,Kr.y,De,Fe,this.transform.angle):Pn;return this.collisionIndex.placeCollisionBox(ei,Ne,C,b,re.predicate,Rt)};Cn&&Cn.box&&Cn.box.length&&Gt.verticalIconBox?(xi=Bn(Gt.verticalIconBox),Kt=xi.box.length>0):(xi=Bn(Gt.iconBox),Kt=xi.box.length>0),lr=lr&&xi.offscreen}const yo=te||pt.numHorizontalGlyphVertices===0&&pt.numVerticalGlyphVertices===0,ea=oe||pt.numIconVertices===0;if(yo||ea?ea?yo||(Kt=Kt&&ir):ir=Kt&&ir:Kt=ir=Kt&&ir,ir&&mn&&mn.box&&this.collisionIndex.insertCollisionBox(mn.box,K,g.get("text-ignore-placement"),p.bucketInstanceId,Cn&&Cn.box&&es?es:Br,re.ID),Kt&&xi&&this.collisionIndex.insertCollisionBox(xi.box,Ne,g.get("icon-ignore-placement"),p.bucketInstanceId,ts,re.ID),rn&&(ir&&this.collisionIndex.insertCollisionCircles(rn.circles,K,g.get("text-ignore-placement"),p.bucketInstanceId,Br,re.ID),u)){const Bn=p.bucketInstanceId;let Pn=this.collisionCircleArrays[Bn];Pn===void 0&&(Pn=this.collisionCircleArrays[Bn]=new Ve);for(let ei=0;ei<rn.circles.length;ei+=4)Pn.circles.push(rn.circles[ei+0]),Pn.circles.push(rn.circles[ei+1]),Pn.circles.push(rn.circles[ei+2]),Pn.circles.push(rn.collisionDetected?1:0)}if(pt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[pt.crossTileID]=new Ue(ir||tt,Kt||Qe,lr||p.justReloaded),s[pt.crossTileID]=!0};if(He){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const pt=p.getSortedSymbolIndexes(this.transform.angle);for(let Gt=pt.length-1;Gt>=0;--Gt){const Lt=pt[Gt];ar(p.symbolInstances.get(Lt),p.collisionArrays[Lt])}}else for(let pt=t.symbolInstanceStart;pt<t.symbolInstanceEnd;pt++)ar(p.symbolInstances.get(pt),p.collisionArrays[pt]);if(u&&p.bucketInstanceId in this.collisionCircleArrays){const pt=this.collisionCircleArrays[p.bucketInstanceId];o.as(pt.invProjMatrix,b),pt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(t,s,u,p){let g;g=p===o.ai.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[o.at(s)];const b=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const E of b)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=g>=0&&E!==g?0:u.crossTileID)}markUsedOrientation(t,s,u){const p=s===o.ai.horizontal||s===o.ai.horizontalOnly?s:0,g=s===o.ai.vertical?s:0,b=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const E of b)t.text.placedSymbolArray.get(E).placedOrientation=p;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},b=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const S in this.placements){const C=this.placements[S],M=g[S];M?(this.opacities[S]=new Te(M,p,C.text,C.icon),u=u||C.text!==M.text.placed||C.icon!==M.icon.placed):(this.opacities[S]=new Te(null,p,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const S in g){const C=g[S];if(!this.opacities[S]){const M=new Te(C,p,!1,!1);M.isHidden()||(this.opacities[S]=M,u=u||C.text.placed||C.icon.placed)}}for(const S in b)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=b[S]);for(const S in E)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=E[S]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const u={};for(const p of s){const g=p.getBucket(t);g&&p.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,u,p.collisionBoxArray)}}updateBucketOpacities(t,s,u){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0],g=p.layout,b=new Te(null,0,!1,!1,!0),E=g.get("text-allow-overlap"),S=g.get("icon-allow-overlap"),C=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=g.get("text-rotation-alignment")==="map",N=g.get("text-pitch-alignment")==="map",j=g.get("icon-text-fit")!=="none",re=new Te(null,0,E&&(S||!t.hasIconData()||g.get("icon-optional")),S&&(E||!t.hasTextData()||g.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const te=(oe,K,Se)=>{for(let Ne=0;Ne<K/4;Ne++)oe.opacityVertexArray.emplaceBack(Se);oe.hasVisibleVertices=oe.hasVisibleVertices||Se!==Gn};for(let oe=0;oe<t.symbolInstances.length;oe++){const K=t.symbolInstances.get(oe),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:Ne,crossTileID:pe}=K;let De=this.opacities[pe];s[pe]?De=b:De||(De=re,this.opacities[pe]=De),s[pe]=!0;const Fe=K.numIconVertices>0,Be=this.placedOrientations[K.crossTileID],He=Be===o.ai.vertical,tt=Be===o.ai.horizontal||Be===o.ai.horizontalOnly;if(Se>0||Ne>0){const Qe=dn(De.text);te(t.text,Se,He?Gn:Qe),te(t.text,Ne,tt?Gn:Qe);const st=De.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(pt=>{pt>=0&&(t.text.placedSymbolArray.get(pt).hidden=st||He?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=st||tt?1:0);const Rt=this.variableOffsets[K.crossTileID];Rt&&this.markUsedJustification(t,Rt.anchor,K,Be);const ar=this.placedOrientations[K.crossTileID];ar&&(this.markUsedJustification(t,"left",K,ar),this.markUsedOrientation(t,ar,K))}if(Fe){const Qe=dn(De.icon),st=!(j&&K.verticalPlacedIconSymbolIndex&&He);K.placedIconSymbolIndex>=0&&(te(t.icon,K.numIconVertices,st?Qe:Gn),t.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=De.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(te(t.icon,K.numVerticalIconVertices,st?Gn:Qe),t.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=De.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Qe=t.collisionArrays[oe];if(Qe){let st=new o.P(0,0);if(Qe.textBox||Qe.verticalTextBox){let ar=!0;if(C){const pt=this.variableOffsets[pe];pt?(st=kt(pt.anchor,pt.width,pt.height,pt.textOffset,pt.textBoxScale),M&&st._rotate(N?this.transform.angle:-this.transform.angle)):ar=!1}Qe.textBox&&Zt(t.textCollisionBox.collisionVertexArray,De.text.placed,!ar||He,st.x,st.y),Qe.verticalTextBox&&Zt(t.textCollisionBox.collisionVertexArray,De.text.placed,!ar||tt,st.x,st.y)}const Rt=Boolean(!tt&&Qe.verticalIconBox);Qe.iconBox&&Zt(t.iconCollisionBox.collisionVertexArray,De.icon.placed,Rt,j?st.x:0,j?st.y:0),Qe.verticalIconBox&&Zt(t.iconCollisionBox.collisionVertexArray,De.icon.placed,!Rt,j?st.x:0,j?st.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=oe.invProjMatrix,t.placementViewportMatrix=oe.viewportMatrix,t.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Zt(d,t,s,u,p){d.emplaceBack(t?1:0,s?1:0,u||0,p||0),d.emplaceBack(t?1:0,s?1:0,u||0,p||0),d.emplaceBack(t?1:0,s?1:0,u||0,p||0),d.emplaceBack(t?1:0,s?1:0,u||0,p||0)}const yr=Math.pow(2,25),Tr=Math.pow(2,24),hr=Math.pow(2,17),or=Math.pow(2,16),pn=Math.pow(2,9),Ir=Math.pow(2,8),Yr=Math.pow(2,1);function dn(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,s=Math.floor(127*d.opacity);return s*yr+t*Tr+s*hr+t*or+s*pn+t*Ir+s*Yr+t}const Gn=0;class ga{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,u,p,g){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((E,S)=>E.sortKey-S.sortKey));this._currentPartIndex<b.length;)if(s.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,g())return!0;return!1}}class Rs{constructor(t,s,u,p,g,b,E,S){this.placement=new Ot(t,s,b,E,S),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,s,u){const p=o.h.now(),g=()=>!this._forceFullPlacement&&o.h.now()-p>2;for(;this._currentPlacementIndex>=0;){const b=s[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new ga(b)),this._inProgressLayer.continuePlacement(u[b.source],this.placement,this._showCollisionBoxes,b,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const fs=512/o.N/2;class tl{constructor(t,s,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const p=new Map;for(let g=0;g<s.length;g++){const b=s.get(g),E=b.key,S=p.get(E);S?S.push(b):p.set(E,[b])}for(const[g,b]of p){const E={positions:b.map(S=>({x:Math.floor(S.anchorX*fs),y:Math.floor(S.anchorY*fs)})),crossTileIDs:b.map(S=>S.crossTileID)};if(E.positions.length>128){const S=new o.av(E.positions.length,16,Uint16Array);for(const{x:C,y:M}of E.positions)S.add(C,M);S.finish(),delete E.positions,E.index=S}this._symbolsByKey[g]=E}}getScaledCoordinates(t,s){const{x:u,y:p,z:g}=this.tileID.canonical,{x:b,y:E,z:S}=s.canonical,C=fs/Math.pow(2,S-g),M=(E*o.N+t.anchorY)*C,N=p*o.N*fs;return{x:Math.floor((b*o.N+t.anchorX)*C-u*o.N*fs),y:Math.floor(M-N)}}findMatches(t,s,u){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let g=0;g<t.length;g++){const b=t.get(g);if(b.crossTileID)continue;const E=this._symbolsByKey[b.key];if(!E)continue;const S=this.getScaledCoordinates(b,s);if(E.index){const C=E.index.range(S.x-p,S.y-p,S.x+p,S.y+p).sort();for(const M of C){const N=E.crossTileIDs[M];if(!u[N]){u[N]=!0,b.crossTileID=N;break}}}else if(E.positions)for(let C=0;C<E.positions.length;C++){const M=E.positions[C],N=E.crossTileIDs[C];if(Math.abs(M.x-S.x)<=p&&Math.abs(M.y-S.y)<=p&&!u[N]){u[N]=!0,b.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class xr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ya{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const u in this.indexes){const p=this.indexes[u],g={};for(const b in p){const E=p[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),g[E.tileID.key]=E}this.indexes[u]=g}this.lng=t}addBucket(t,s,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const b=this.indexes[g];if(Number(g)>t.overscaledZ)for(const E in b){const S=b[E];S.tileID.isChildOf(t)&&S.findMatches(s.symbolInstances,t,p)}else{const E=b[t.scaledTo(Number(g)).key];E&&E.findMatches(s.symbolInstances,t,p)}}for(let g=0;g<s.symbolInstances.length;g++){const b=s.symbolInstances.get(g);b.crossTileID||(b.crossTileID=u.generate(),p[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new tl(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const u of s.getCrossTileIDsLists())for(const p of u)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let s=!1;for(const u in this.indexes){const p=this.indexes[u];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[g]),delete p[g],s=!0)}return s}}class ko{constructor(){this.layerIndexes={},this.crossTileIDs=new xr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,u){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new ya);let g=!1;const b={};p.handleWrapJump(u);for(const E of s){const S=E.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(E.tileID,S,this.crossTileIDs)&&(g=!0),b[S.bucketInstanceId]=!0)}return p.removeStaleBuckets(b)&&(g=!0),g}pruneUnusedLayers(t){const s={};t.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}const Tn=(d,t)=>o.x(d,t&&t.filter(s=>s.identifier!=="source.canvas")),Zn=o.F(o.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),_a=o.F(o.ax,["setCenter","setZoom","setBearing","setPitch"]),li=o.aw();class fn extends o.E{constructor(t,s={}){super(),this.map=t,this.dispatcher=new mt(ds(),this,t._getMapId()),this.imageManager=new Ye,this.imageManager.setEventedParent(this),this.glyphManager=new Dt(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Ut(256,512),this.crossTileSymbolIndex=new ko,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.az());const u=this;this._rtlTextPluginCallback=fn.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,b)=>{if(o.aA(g),b&&b.every(E=>E))for(const E in u.sourceCaches){const S=u.sourceCaches[E].getSource().type;S!=="vector"&&S!=="geojson"||u.sourceCaches[E].reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const b=g.getSource();if(b&&b.vectorLayerIds)for(const E in this._layers){const S=this._layers[E];S.source===b.id&&this._validateLayer(S)}})}loadURL(t,s={},u){this.fire(new o.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const p=this.map._requestManager.transformRequest(t,me.Style);this._request=o.f(p,(g,b)=>{this._request=null,g?this.fire(new o.j(g)):b&&this._load(b,s,u)})}loadJSON(t,s={},u){this.fire(new o.k("dataloading",{dataType:"style"})),this._request=o.h.frame(()=>{this._request=null,s.validate=s.validate!==!1,this._load(t,s,u)})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(li,{validate:!1})}_load(t,s,u){var p;const g=s.transformStyle?s.transformStyle(u,t):t;if(!s.validate||!Tn(this,o.y(g))){this._loaded=!0,this.stylesheet=g;for(const b in g.sources)this.addSource(b,g.sources[b],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs),this._createLayers(),this.light=new ft(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const t=o.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const u=o.aC(s);u.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=u}}_loadSprite(t,s=!1,u=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(p,g,b,E){const S=Me(p),C=S.length,M=b>1?"@2x":"",N={},j={},re={};for(const{id:te,url:oe}of S){const K=g.transformRequest(g.normalizeSpriteURL(oe,M,".json"),me.SpriteJSON),Se=`${te}_${K.url}`;N[Se]=o.f(K,(De,Fe)=>{delete N[Se],j[te]=Fe,Y(E,j,re,De,C)});const Ne=g.transformRequest(g.normalizeSpriteURL(oe,M,".png"),me.SpriteImage),pe=`${te}_${Ne.url}`;N[pe]=V.getImage(Ne,(De,Fe)=>{delete N[pe],re[te]=Fe,Y(E,j,re,De,C)})}return{cancel(){for(const te of Object.values(N))te.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(p,g)=>{if(this._spriteRequest=null,p)this.fire(new o.j(p));else if(g)for(const b in g){this._spritesImagesIds[b]=[];const E=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(S=>!(S in g)):[];for(const S of E)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in g[b]){const C=b==="default"?S:`${b}:${S}`;this._spritesImagesIds[b].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,g[b][S],!1):this.imageManager.addImage(C,g[b][S]),s&&(this._changedImages[C]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),u&&u(p)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const u=t.sourceLayer;if(!u)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.j(new Error(`Source layer "${u}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const s=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s);const u=[];for(const p of t)s[p]&&u.push(s[p]);return u}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const u of s){const p=this._layers[u];p.type!=="custom"&&(t[u]=p.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(const b in this._updatedSources){const E=this._updatedSources[b];if(E==="reload")this._reloadSource(b);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const u={};for(const p in this.sourceCaches){const g=this.sourceCaches[p];u[p]=g.used,g.used=!1}for(const p of this._order){const g=this._layers[p];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const p in u){const g=this.sourceCaches[p];u[p]!==g.used&&g.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){this._checkLoaded();const u=this.serialize();if(t=s.transformStyle?s.transformStyle(u,t):t,Tn(this,o.y(t)))return!1;(t=o.aD(t)).layers=o.aB(t.layers);const p=o.aE(u,t).filter(b=>!(b.command in _a));if(p.length===0)return!1;const g=p.filter(b=>!(b.command in Zn));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);for(const b of p)b.command!=="setTransition"&&this[b.command].apply(this,b.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,s){if(this.getImage(t))return this.fire(new o.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,u={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.y.source,`sources.${t}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.sourceCaches[t]=new Jt(t,s,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t})),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new o.j(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.sourceCaches[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,u={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new o.j(new Error(`Layer "${p}" already exists on this map.`)));let g;if(t.type==="custom"){if(Tn(this,o.aF(t)))return;g=o.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=o.aD(t),t=o.e(t,{source:p})),this._validate(o.y.layer,`layers.${p}`,t,{arrayIndex:-1},u))return;g=o.aC(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)this.fire(new o.j(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(b,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){const E=this._removedLayers[p];delete this._removedLayers[p],E.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const u=this._order.indexOf(t);this._order.splice(u,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new o.j(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,u){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===s&&p.maxzoom===u||(s!=null&&(p.minzoom=s),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,u={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!o.aG(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(o.y.filter,`layers.${p.id}.filter`,s,null,u)||(p.filter=o.aD(s),this._updateLayer(p)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.aD(this.getLayer(t).filter)}setLayoutProperty(t,s,u,p={}){this._checkLoaded();const g=this.getLayer(t);g?o.aG(g.getLayoutProperty(s),u)||(g.setLayoutProperty(s,u,p),this._updateLayer(g)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const u=this.getLayer(t);if(u)return u.getLayoutProperty(s);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,u,p={}){this._checkLoaded();const g=this.getLayer(t);g?o.aG(g.getPaintProperty(s),u)||(g.setPaintProperty(s,u,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const u=t.source,p=t.sourceLayer,g=this.sourceCaches[u];if(g===void 0)return void this.fire(new o.j(new Error(`The source '${u}' does not exist in the map's style.`)));const b=g.getSource().type;b==="geojson"&&p?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||p?(t.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,t.id,s)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const u=t.source,p=this.sourceCaches[u];if(p===void 0)return void this.fire(new o.j(new Error(`The source '${u}' does not exist in the map's style.`)));const g=p.getSource().type,b=g==="vector"?t.sourceLayer:void 0;g!=="vector"||b?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(b,t.id,s):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,u=t.sourceLayer,p=this.sourceCaches[s];if(p!==void 0)return p.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(u,t.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.aH(this.sourceCaches,g=>g.serialize()),s=this._serializeByIds(this._order),u=this.map.getTerrain()||void 0,p=this.stylesheet;return o.aI({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:t,layers:s,terrain:u},g=>g!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=b=>this._layers[b].type==="fill-extrusion",u={},p=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(s(E)){u[E]=b;for(const S of t){const C=S[E];if(C)for(const M of C)p.push(M)}}}p.sort((b,E)=>E.intersectionZ-b.intersectionZ);const g=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(s(E))for(let S=p.length-1;S>=0;S--){const C=p[S].feature;if(u[C.layer.id]<b)break;g.push(C),p.pop()}else for(const S of t){const C=S[E];if(C)for(const M of C)g.push(M.feature)}}return g}queryRenderedFeatures(t,s,u){s&&s.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const E of s.layers){const S=this._layers[E];if(!S)return this.fire(new o.j(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];p[S.source]=!0}}const g=[];s.availableImages=this._availableImages;const b=this._serializedAllLayers();for(const E in this.sourceCaches)s.layers&&!p[E]||g.push(Sr(this.sourceCaches[E],this._layers,b,t,s,u));return this.placement&&g.push(function(E,S,C,M,N,j,re){const te={},oe=j.queryRenderedSymbols(M),K=[];for(const Se of Object.keys(oe).map(Number))K.push(re[Se]);K.sort(An);for(const Se of K){const Ne=Se.featureIndex.lookupSymbolFeatures(oe[Se.bucketInstanceId],S,Se.bucketIndex,Se.sourceLayerIndex,N.filter,N.layers,N.availableImages,E);for(const pe in Ne){const De=te[pe]=te[pe]||[],Fe=Ne[pe];Fe.sort((Be,He)=>{const tt=Se.featureSortOrder;if(tt){const Qe=tt.indexOf(Be.featureIndex);return tt.indexOf(He.featureIndex)-Qe}return He.featureIndex-Be.featureIndex});for(const Be of Fe)De.push(Be)}}for(const Se in te)te[Se].forEach(Ne=>{const pe=Ne.feature,De=C[E[Se].source].getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=De});return te}(this._layers,b,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,s){s&&s.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.sourceCaches[t];return u?function(p,g){const b=p.getRenderableIds().map(C=>p.getTileByID(C)),E=[],S={};for(let C=0;C<b.length;C++){const M=b[C],N=M.tileID.canonical.key;S[N]||(S[N]=!0,M.querySourceFeatures(E,g))}return E}(u,s):[]}addSourceType(t,s,u){return gr(t)?u(new Error(`A source type called "${t}" already exists.`)):(((p,g)=>{hn[p]=g})(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const b in t)if(!o.aG(t[b],u[b])){p=!0;break}if(!p)return;const g={now:o.h.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(g)}_validate(t,s,u,p,g={}){return(!g||g.validate!==!1)&&Tn(this,t.call(o.y,o.e({key:s,style:this.serialize(),value:u,styleSpec:o.v},p)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const u=this.sourceCaches[s];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,u,p,g=!1){let b=!1,E=!1;const S={};for(const C of this._order){const M=this._layers[C];if(M.type!=="symbol")continue;if(!S[M.source]){const j=this.sourceCaches[M.source];S[M.source]=j.getRenderableIds(!0).map(re=>j.getTileByID(re)).sort((re,te)=>te.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(te.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(M,S[M.source],t.center.lng);b=b||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.h.now(),t.zoom))&&(this.pauseablePlacement=new Rs(t,this.map.terrain,this._order,g,s,u,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.h.now()),E=!0),b&&this.pauseablePlacement.placement.setStale()),E||b)for(const C of this._order){const M=this._layers[C];M.type==="symbol"&&this.placement.updateLayerOpacities(M,S[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,u){this.imageManager.getImages(s.icons,u),this._updateTilesForChangedImages();const p=this.sourceCaches[s.source];p&&p.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,u){this.glyphManager.getGlyphs(s.stacks,u);const p=this.sourceCaches[s.source];p&&p.setDependencies(s.tileID.key,s.type,[""])}getResource(t,s,u){return o.m(s,u)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(o.y.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,u={},p){this._checkLoaded();const g=[{id:t,url:s}],b=[...Me(this.stylesheet.sprite),...g];this._validate(o.y.sprite,"sprite",b,null,u)||(this.stylesheet.sprite=b,this._loadSprite(g,!0,p))}removeSprite(t){this._checkLoaded();const s=Me(this.stylesheet.sprite);if(s.find(u=>u.id===t)){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;s.splice(s.findIndex(u=>u.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Me(this.stylesheet.sprite)}setSprite(t,s={},u){this._checkLoaded(),t&&this._validate(o.y.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}}fn.registerForPluginStateChange=o.aK;var Mo=o.Q([{name:"a_pos",type:"Int16",components:2}]),Xi="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Nr={prelude:_r(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:_r(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:_r(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:_r(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:_r("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_r(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:_r(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:_r("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:_r("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:_r("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:_r(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:_r(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:_r(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:_r(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:_r(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:_r(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:_r(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_r(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:_r(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:_r(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:_r(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:_r(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:_r(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:_r(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:_r(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:_r(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:_r("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Xi),terrainDepth:_r("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Xi),terrainCoords:_r("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Xi)};function _r(d,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/attribute ([\w]+) ([\w]+)/g),p=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=g?g.concat(p):p,E={};return{fragmentSource:d=d.replace(s,(S,C,M,N,j)=>(E[j]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${M} ${N} ${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${M} ${N} ${j} = u_${j};
#endif
`)),vertexSource:t=t.replace(s,(S,C,M,N,j)=>{const re=N==="float"?"vec2":"vec4",te=j.match(/color/)?"color":re;return E[j]?C==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${M} ${re} a_${j};
varying ${M} ${N} ${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${te}(a_${j}, u_${j}_t);
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${M} ${re} a_${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${M} ${N} ${j} = a_${j};
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${M} ${N} ${j} = unpack_mix_${te}(a_${j}, u_${j}_t);
#else
    ${M} ${N} ${j} = u_${j};
#endif
`}),staticAttributes:u,staticUniforms:b}}class mr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,u,p,g,b,E,S,C){this.context=t;let M=this.boundPaintVertexBuffers.length!==p.length;for(let N=0;!M&&N<p.length;N++)this.boundPaintVertexBuffers[N]!==p[N]&&(M=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||M||this.boundIndexBuffer!==g||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==C?this.freshBind(s,u,p,g,b,E,S,C):(t.bindVertexArray.set(this.vao),E&&E.bind(),g&&g.dynamicDraw&&g.bind(),S&&S.bind(),C&&C.bind())}freshBind(t,s,u,p,g,b,E,S){const C=t.numAttributes,M=this.context,N=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=S,s.enableAttributes(N,t);for(const j of u)j.enableAttributes(N,t);b&&b.enableAttributes(N,t),E&&E.enableAttributes(N,t),S&&S.enableAttributes(N,t),s.bind(),s.setVertexAttribPointers(N,t,g);for(const j of u)j.bind(),j.setVertexAttribPointers(N,t,g);b&&(b.bind(),b.setVertexAttribPointers(N,t,g)),p&&p.bind(),E&&(E.bind(),E.setVertexAttribPointers(N,t,g)),S&&(S.bind(),S.setVertexAttribPointers(N,t,g)),M.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Vr(d){const t=[];for(let s=0;s<d.length;s++){if(d[s]===null)continue;const u=d[s].split(" ");t.push(u.pop())}return t}class Ys{constructor(t,s,u,p,g,b){const E=t.gl;this.program=E.createProgram();const S=Vr(s.staticAttributes),C=u?u.getBinderAttributes():[],M=S.concat(C),N=Nr.prelude.staticUniforms?Vr(Nr.prelude.staticUniforms):[],j=s.staticUniforms?Vr(s.staticUniforms):[],re=u?u.getBinderUniforms():[],te=N.concat(j).concat(re),oe=[];for(const Be of te)oe.indexOf(Be)<0&&oe.push(Be);const K=u?u.defines():[];g&&K.push("#define OVERDRAW_INSPECTOR;"),b&&K.push("#define TERRAIN3D;");const Se=K.concat(Nr.prelude.fragmentSource,s.fragmentSource).join(`
`),Ne=K.concat(Nr.prelude.vertexSource,s.vertexSource).join(`
`),pe=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(pe,Se),E.compileShader(pe),!E.getShaderParameter(pe,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(pe)}`);E.attachShader(this.program,pe);const De=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(De,Ne),E.compileShader(De),!E.getShaderParameter(De,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(De)}`);E.attachShader(this.program,De),this.attributes={};const Fe={};this.numAttributes=M.length;for(let Be=0;Be<this.numAttributes;Be++)M[Be]&&(E.bindAttribLocation(this.program,Be,M[Be]),this.attributes[M[Be]]=Be);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(De),E.deleteShader(pe);for(let Be=0;Be<oe.length;Be++){const He=oe[Be];if(He&&!Fe[He]){const tt=E.getUniformLocation(this.program,He);tt&&(Fe[He]=tt)}}this.fixedUniforms=p(t,Fe),this.terrainUniforms=((Be,He)=>({u_depth:new o.aL(Be,He.u_depth),u_terrain:new o.aL(Be,He.u_terrain),u_terrain_dim:new o.aM(Be,He.u_terrain_dim),u_terrain_matrix:new o.aN(Be,He.u_terrain_matrix),u_terrain_unpack:new o.aO(Be,He.u_terrain_unpack),u_terrain_exaggeration:new o.aM(Be,He.u_terrain_exaggeration)}))(t,Fe),this.binderUniforms=u?u.getUniforms(t,Fe):[]}draw(t,s,u,p,g,b,E,S,C,M,N,j,re,te,oe,K,Se,Ne){const pe=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(p),t.setColorMode(g),t.setCullFace(b),S){t.activeTexture.set(pe.TEXTURE2),pe.bindTexture(pe.TEXTURE_2D,S.depthTexture),t.activeTexture.set(pe.TEXTURE3),pe.bindTexture(pe.TEXTURE_2D,S.texture);for(const Fe in this.terrainUniforms)this.terrainUniforms[Fe].set(S[Fe])}for(const Fe in this.fixedUniforms)this.fixedUniforms[Fe].set(E[Fe]);oe&&oe.setUniforms(t,this.binderUniforms,re,{zoom:te});let De=0;switch(s){case pe.LINES:De=2;break;case pe.TRIANGLES:De=3;break;case pe.LINE_STRIP:De=1}for(const Fe of j.get()){const Be=Fe.vaos||(Fe.vaos={});(Be[C]||(Be[C]=new mr)).bind(t,this,M,oe?oe.getPaintVertexBuffers():[],N,Fe.vertexOffset,K,Se,Ne),pe.drawElements(s,Fe.primitiveLength*De,pe.UNSIGNED_SHORT,Fe.primitiveOffset*De*2)}}}function ci(d,t,s){const u=1/ve(s,1,t.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,t.transform.tileZoom)/p,b=g*(s.tileID.canonical.x+s.tileID.wrap*p),E=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const va=(d,t,s,u)=>{const p=t.style.light,g=p.properties.get("position"),b=[g.x,g.y,g.z],E=function(){var C=new o.A(9);return o.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();p.properties.get("anchor")==="viewport"&&function(C,M){var N=Math.sin(M),j=Math.cos(M);C[0]=j,C[1]=N,C[2]=0,C[3]=-N,C[4]=j,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(E,-t.transform.angle),function(C,M,N){var j=M[0],re=M[1],te=M[2];C[0]=j*N[0]+re*N[3]+te*N[6],C[1]=j*N[1]+re*N[4]+te*N[7],C[2]=j*N[2]+re*N[5]+te*N[8]}(b,b,E);const S=p.properties.get("color");return{u_matrix:d,u_lightpos:b,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+s,u_opacity:u}},Ni=(d,t,s,u,p,g,b)=>o.e(va(d,t,s,u),ci(g,t,b),{u_height_factor:-Math.pow(2,p.overscaledZ)/b.tileSize/8}),rl=d=>({u_matrix:d}),xa=(d,t,s,u)=>o.e(rl(d),ci(s,t,u)),Oo=(d,t)=>({u_matrix:d,u_world:t}),Js=(d,t,s,u,p)=>o.e(xa(d,t,s,u),{u_world:p}),Yi=(d,t,s,u)=>{const p=d.transform;let g,b;if(u.paint.get("circle-pitch-alignment")==="map"){const E=ve(s,1,p.zoom);g=!0,b=[E,E]}else g=!1,b=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(t.posMatrix,s,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:b}},ba=(d,t,s)=>{const u=ve(s,1,t.zoom),p=Math.pow(2,t.zoom-s.tileID.overscaledZ),g=s.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[t.pixelsToGLUnits[0]/(u*p),t.pixelsToGLUnits[1]/(u*p)],u_overscale_factor:g}},Ks=(d,t,s=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:s}),nl=d=>({u_matrix:d}),il=(d,t,s,u)=>({u_matrix:d,u_extrude_scale:ve(t,1,s),u_intensity:u});function wa(d,t){const s=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new o.U(0,u/s).toLngLat().lat,new o.U(0,(u+1)/s).toLngLat().lat]}const Ea=(d,t,s,u)=>{const p=d.transform;return{u_matrix:Ji(d,t,s,u),u_ratio:1/ve(t,1,p.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},sl=(d,t,s,u,p)=>o.e(Ea(d,t,s,p),{u_image:0,u_image_height:u}),Yl=(d,t,s,u,p)=>{const g=d.transform,b=Ro(t,g);return{u_matrix:Ji(d,t,s,p),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ve(t,1,g.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[b,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ta=(d,t,s,u,p,g)=>{const b=d.lineAtlas,E=Ro(t,d.transform),S=s.layout.get("line-cap")==="round",C=b.getDash(u.from,S),M=b.getDash(u.to,S),N=C.width*p.fromScale,j=M.width*p.toScale;return o.e(Ea(d,t,s,g),{u_patternscale_a:[E/N,-C.height/2],u_patternscale_b:[E/j,-M.height/2],u_sdfgamma:b.width/(256*Math.min(N,j)*d.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:M.y,u_mix:p.t})};function Ro(d,t){return 1/ve(d,1,t.tileZoom)}function Ji(d,t,s,u){return d.translatePosMatrix(u?u.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const ol=(d,t,s,u,p)=>{return{u_matrix:d,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(b=p.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(g=p.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:al(p.paint.get("raster-hue-rotate"))};var g,b};function al(d){d*=Math.PI/180;const t=Math.sin(d),s=Math.cos(d);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Sa=(d,t,s,u,p,g,b,E,S,C)=>{const M=p.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:M.cameraToCenterDistance,u_pitch:M.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:M.width/M.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+S,u_pitch_with_map:+u,u_texsize:C,u_texture:0}},No=(d,t,s,u,p,g,b,E,S,C,M)=>{const N=p.transform;return o.e(Sa(d,t,s,u,p,g,b,E,S,C),{u_gamma_scale:u?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+M})},ms=(d,t,s,u,p,g,b,E,S,C)=>o.e(No(d,t,s,u,p,g,b,E,!0,S,!0),{u_texsize_icon:C,u_texture_icon:1}),Ki=(d,t,s)=>({u_matrix:d,u_opacity:t,u_color:s}),Hn=(d,t,s,u,p,g)=>o.e(function(b,E,S,C){const M=S.imageManager.getPattern(b.from.toString()),N=S.imageManager.getPattern(b.to.toString()),{width:j,height:re}=S.imageManager.getPixelSize(),te=Math.pow(2,C.tileID.overscaledZ),oe=C.tileSize*Math.pow(2,S.transform.tileZoom)/te,K=oe*(C.tileID.canonical.x+C.tileID.wrap*te),Se=oe*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[j,re],u_mix:E.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/ve(C,1,S.transform.tileZoom),u_pixel_coord_upper:[K>>16,Se>>16],u_pixel_coord_lower:[65535&K,65535&Se]}}(u,g,s,p),{u_matrix:d,u_opacity:t}),Lo={fillExtrusion:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_lightpos:new o.aP(d,t.u_lightpos),u_lightintensity:new o.aM(d,t.u_lightintensity),u_lightcolor:new o.aP(d,t.u_lightcolor),u_vertical_gradient:new o.aM(d,t.u_vertical_gradient),u_opacity:new o.aM(d,t.u_opacity)}),fillExtrusionPattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_lightpos:new o.aP(d,t.u_lightpos),u_lightintensity:new o.aM(d,t.u_lightintensity),u_lightcolor:new o.aP(d,t.u_lightcolor),u_vertical_gradient:new o.aM(d,t.u_vertical_gradient),u_height_factor:new o.aM(d,t.u_height_factor),u_image:new o.aL(d,t.u_image),u_texsize:new o.aQ(d,t.u_texsize),u_pixel_coord_upper:new o.aQ(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(d,t.u_pixel_coord_lower),u_scale:new o.aP(d,t.u_scale),u_fade:new o.aM(d,t.u_fade),u_opacity:new o.aM(d,t.u_opacity)}),fill:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix)}),fillPattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_image:new o.aL(d,t.u_image),u_texsize:new o.aQ(d,t.u_texsize),u_pixel_coord_upper:new o.aQ(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(d,t.u_pixel_coord_lower),u_scale:new o.aP(d,t.u_scale),u_fade:new o.aM(d,t.u_fade)}),fillOutline:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_world:new o.aQ(d,t.u_world)}),fillOutlinePattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_world:new o.aQ(d,t.u_world),u_image:new o.aL(d,t.u_image),u_texsize:new o.aQ(d,t.u_texsize),u_pixel_coord_upper:new o.aQ(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(d,t.u_pixel_coord_lower),u_scale:new o.aP(d,t.u_scale),u_fade:new o.aM(d,t.u_fade)}),circle:(d,t)=>({u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_scale_with_map:new o.aL(d,t.u_scale_with_map),u_pitch_with_map:new o.aL(d,t.u_pitch_with_map),u_extrude_scale:new o.aQ(d,t.u_extrude_scale),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_matrix:new o.aN(d,t.u_matrix)}),collisionBox:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aM(d,t.u_pixels_to_tile_units),u_extrude_scale:new o.aQ(d,t.u_extrude_scale),u_overscale_factor:new o.aM(d,t.u_overscale_factor)}),collisionCircle:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_inv_matrix:new o.aN(d,t.u_inv_matrix),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_viewport_size:new o.aQ(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new o.aR(d,t.u_color),u_matrix:new o.aN(d,t.u_matrix),u_overlay:new o.aL(d,t.u_overlay),u_overlay_scale:new o.aM(d,t.u_overlay_scale)}),clippingMask:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix)}),heatmap:(d,t)=>({u_extrude_scale:new o.aM(d,t.u_extrude_scale),u_intensity:new o.aM(d,t.u_intensity),u_matrix:new o.aN(d,t.u_matrix)}),heatmapTexture:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_world:new o.aQ(d,t.u_world),u_image:new o.aL(d,t.u_image),u_color_ramp:new o.aL(d,t.u_color_ramp),u_opacity:new o.aM(d,t.u_opacity)}),hillshade:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_image:new o.aL(d,t.u_image),u_latrange:new o.aQ(d,t.u_latrange),u_light:new o.aQ(d,t.u_light),u_shadow:new o.aR(d,t.u_shadow),u_highlight:new o.aR(d,t.u_highlight),u_accent:new o.aR(d,t.u_accent)}),hillshadePrepare:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_image:new o.aL(d,t.u_image),u_dimension:new o.aQ(d,t.u_dimension),u_zoom:new o.aM(d,t.u_zoom),u_unpack:new o.aO(d,t.u_unpack)}),line:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_ratio:new o.aM(d,t.u_ratio),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(d,t.u_units_to_pixels)}),lineGradient:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_ratio:new o.aM(d,t.u_ratio),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(d,t.u_units_to_pixels),u_image:new o.aL(d,t.u_image),u_image_height:new o.aM(d,t.u_image_height)}),linePattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_texsize:new o.aQ(d,t.u_texsize),u_ratio:new o.aM(d,t.u_ratio),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_image:new o.aL(d,t.u_image),u_units_to_pixels:new o.aQ(d,t.u_units_to_pixels),u_scale:new o.aP(d,t.u_scale),u_fade:new o.aM(d,t.u_fade)}),lineSDF:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_ratio:new o.aM(d,t.u_ratio),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.aQ(d,t.u_units_to_pixels),u_patternscale_a:new o.aQ(d,t.u_patternscale_a),u_patternscale_b:new o.aQ(d,t.u_patternscale_b),u_sdfgamma:new o.aM(d,t.u_sdfgamma),u_image:new o.aL(d,t.u_image),u_tex_y_a:new o.aM(d,t.u_tex_y_a),u_tex_y_b:new o.aM(d,t.u_tex_y_b),u_mix:new o.aM(d,t.u_mix)}),raster:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_tl_parent:new o.aQ(d,t.u_tl_parent),u_scale_parent:new o.aM(d,t.u_scale_parent),u_buffer_scale:new o.aM(d,t.u_buffer_scale),u_fade_t:new o.aM(d,t.u_fade_t),u_opacity:new o.aM(d,t.u_opacity),u_image0:new o.aL(d,t.u_image0),u_image1:new o.aL(d,t.u_image1),u_brightness_low:new o.aM(d,t.u_brightness_low),u_brightness_high:new o.aM(d,t.u_brightness_high),u_saturation_factor:new o.aM(d,t.u_saturation_factor),u_contrast_factor:new o.aM(d,t.u_contrast_factor),u_spin_weights:new o.aP(d,t.u_spin_weights)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new o.aL(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(d,t.u_is_size_feature_constant),u_size_t:new o.aM(d,t.u_size_t),u_size:new o.aM(d,t.u_size),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_pitch:new o.aM(d,t.u_pitch),u_rotate_symbol:new o.aL(d,t.u_rotate_symbol),u_aspect_ratio:new o.aM(d,t.u_aspect_ratio),u_fade_change:new o.aM(d,t.u_fade_change),u_matrix:new o.aN(d,t.u_matrix),u_label_plane_matrix:new o.aN(d,t.u_label_plane_matrix),u_coord_matrix:new o.aN(d,t.u_coord_matrix),u_is_text:new o.aL(d,t.u_is_text),u_pitch_with_map:new o.aL(d,t.u_pitch_with_map),u_texsize:new o.aQ(d,t.u_texsize),u_texture:new o.aL(d,t.u_texture)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new o.aL(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(d,t.u_is_size_feature_constant),u_size_t:new o.aM(d,t.u_size_t),u_size:new o.aM(d,t.u_size),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_pitch:new o.aM(d,t.u_pitch),u_rotate_symbol:new o.aL(d,t.u_rotate_symbol),u_aspect_ratio:new o.aM(d,t.u_aspect_ratio),u_fade_change:new o.aM(d,t.u_fade_change),u_matrix:new o.aN(d,t.u_matrix),u_label_plane_matrix:new o.aN(d,t.u_label_plane_matrix),u_coord_matrix:new o.aN(d,t.u_coord_matrix),u_is_text:new o.aL(d,t.u_is_text),u_pitch_with_map:new o.aL(d,t.u_pitch_with_map),u_texsize:new o.aQ(d,t.u_texsize),u_texture:new o.aL(d,t.u_texture),u_gamma_scale:new o.aM(d,t.u_gamma_scale),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_is_halo:new o.aL(d,t.u_is_halo)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new o.aL(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aL(d,t.u_is_size_feature_constant),u_size_t:new o.aM(d,t.u_size_t),u_size:new o.aM(d,t.u_size),u_camera_to_center_distance:new o.aM(d,t.u_camera_to_center_distance),u_pitch:new o.aM(d,t.u_pitch),u_rotate_symbol:new o.aL(d,t.u_rotate_symbol),u_aspect_ratio:new o.aM(d,t.u_aspect_ratio),u_fade_change:new o.aM(d,t.u_fade_change),u_matrix:new o.aN(d,t.u_matrix),u_label_plane_matrix:new o.aN(d,t.u_label_plane_matrix),u_coord_matrix:new o.aN(d,t.u_coord_matrix),u_is_text:new o.aL(d,t.u_is_text),u_pitch_with_map:new o.aL(d,t.u_pitch_with_map),u_texsize:new o.aQ(d,t.u_texsize),u_texsize_icon:new o.aQ(d,t.u_texsize_icon),u_texture:new o.aL(d,t.u_texture),u_texture_icon:new o.aL(d,t.u_texture_icon),u_gamma_scale:new o.aM(d,t.u_gamma_scale),u_device_pixel_ratio:new o.aM(d,t.u_device_pixel_ratio),u_is_halo:new o.aL(d,t.u_is_halo)}),background:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_opacity:new o.aM(d,t.u_opacity),u_color:new o.aR(d,t.u_color)}),backgroundPattern:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_opacity:new o.aM(d,t.u_opacity),u_image:new o.aL(d,t.u_image),u_pattern_tl_a:new o.aQ(d,t.u_pattern_tl_a),u_pattern_br_a:new o.aQ(d,t.u_pattern_br_a),u_pattern_tl_b:new o.aQ(d,t.u_pattern_tl_b),u_pattern_br_b:new o.aQ(d,t.u_pattern_br_b),u_texsize:new o.aQ(d,t.u_texsize),u_mix:new o.aM(d,t.u_mix),u_pattern_size_a:new o.aQ(d,t.u_pattern_size_a),u_pattern_size_b:new o.aQ(d,t.u_pattern_size_b),u_scale_a:new o.aM(d,t.u_scale_a),u_scale_b:new o.aM(d,t.u_scale_b),u_pixel_coord_upper:new o.aQ(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.aQ(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aM(d,t.u_tile_units_to_pixels)}),terrain:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_texture:new o.aL(d,t.u_texture),u_ele_delta:new o.aM(d,t.u_ele_delta)}),terrainDepth:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_ele_delta:new o.aM(d,t.u_ele_delta)}),terrainCoords:(d,t)=>({u_matrix:new o.aN(d,t.u_matrix),u_texture:new o.aL(d,t.u_texture),u_terrain_coords_id:new o.aM(d,t.u_terrain_coords_id),u_ele_delta:new o.aM(d,t.u_ele_delta)})};class Fo{constructor(t,s,u){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class eo{constructor(t,s,u,p){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let u=0;u<this.attributes.length;u++){const p=s.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,s,u){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],b=s.attributes[g.name];b!==void 0&&t.vertexAttribPointer(b,g.components,t[Qs[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gs=new WeakMap;function Li(d){var t;if(gs.has(d))return gs.get(d);{const s=(t=d.getParameter(d.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return gs.set(d,s),s}}class rr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zo extends rr{getDefault(){return o.aT.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Fn extends rr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Wn extends rr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ia extends rr{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Bo extends rr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Uo extends rr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class to extends rr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Aa extends rr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class $o extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Da extends rr{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ca extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ns extends rr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ll extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Pa extends rr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ys extends rr{getDefault(){return o.aT.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Jl extends rr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ka extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class cl extends rr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Kl extends rr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ql extends rr{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ec extends rr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ma extends rr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _s extends rr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ro extends rr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Vo extends rr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class vs extends rr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ul extends rr{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class jo extends rr{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const u=this.gl;Li(u)?u.bindVertexArray(t):(s=u.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ls extends rr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class xs extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class hl extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Fi extends rr{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class bs extends Fi{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class pl extends Fi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Oa extends Fi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class pr{constructor(t,s,u,p,g){this.context=t,this.width=s,this.height=u;const b=t.gl,E=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new bs(t,E),p)this.depthAttachment=g?new Oa(t,E):new pl(t,E);else if(g)throw new Error("Stencil cannot be setted without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class Lr{constructor(t,s,u){this.blendFunction=t,this.blendColor=s,this.mask=u}}Lr.Replace=[1,0],Lr.disabled=new Lr(Lr.Replace,o.aT.transparent,[!1,!1,!1,!1]),Lr.unblended=new Lr(Lr.Replace,o.aT.transparent,[!0,!0,!0,!0]),Lr.alphaBlended=new Lr([1,771],o.aT.transparent,[!0,!0,!0,!0]);class tc{constructor(t){var s,u;if(this.gl=t,this.clearColor=new zo(this),this.clearDepth=new Fn(this),this.clearStencil=new Wn(this),this.colorMask=new Ia(this),this.depthMask=new Bo(this),this.stencilMask=new Uo(this),this.stencilFunc=new to(this),this.stencilOp=new Aa(this),this.stencilTest=new $o(this),this.depthRange=new Da(this),this.depthTest=new Ca(this),this.depthFunc=new Ns(this),this.blend=new ll(this),this.blendFunc=new Pa(this),this.blendColor=new ys(this),this.blendEquation=new Jl(this),this.cullFace=new ka(this),this.cullFaceSide=new cl(this),this.frontFace=new Kl(this),this.program=new Ql(this),this.activeTexture=new ec(this),this.viewport=new Ma(this),this.bindFramebuffer=new _s(this),this.bindRenderbuffer=new ro(this),this.bindTexture=new Vo(this),this.bindVertexBuffer=new vs(this),this.bindElementBuffer=new ul(this),this.bindVertexArray=new jo(this),this.pixelStoreUnpack=new Ls(this),this.pixelStoreUnpackPremultiplyAlpha=new xs(this),this.pixelStoreUnpackFlipY=new hl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Li(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:p==null?void 0:p.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Fo(this,t,s)}createVertexBuffer(t,s,u){return new eo(this,t,s,u)}createRenderbuffer(t,s,u){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,s,u),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,u,p){return new pr(this,t,s,u,p)}clear({color:t,depth:s,stencil:u}){const p=this.gl;let g=0;t&&(g|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(g|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(g|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.aG(t.blendFunction,Lr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Li(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return Li(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class nr{constructor(t,s,u){this.func=t,this.mask=s,this.range=u}}nr.ReadOnly=!1,nr.ReadWrite=!0,nr.disabled=new nr(519,nr.ReadOnly,[0,1]);const ws=7680;class Fr{constructor(t,s,u,p,g,b){this.test=t,this.ref=s,this.mask=u,this.fail=p,this.depthFail=g,this.pass=b}}Fr.disabled=new Fr({func:519,mask:0},0,0,ws,ws,ws);class Mr{constructor(t,s,u){this.enable=t,this.mode=s,this.frontFace=u}}let no;function dl(d,t,s,u,p,g,b){const E=d.context,S=E.gl,C=d.useProgram("collisionBox"),M=[];let N=0,j=0;for(let pe=0;pe<u.length;pe++){const De=u[pe],Fe=t.getTile(De),Be=Fe.getBucket(s);if(!Be)continue;let He=De.posMatrix;p[0]===0&&p[1]===0||(He=d.translatePosMatrix(De.posMatrix,Fe,p,g));const tt=b?Be.textCollisionBox:Be.iconCollisionBox,Qe=Be.collisionCircleArray;if(Qe.length>0){const st=o.Z(),Rt=He;o.aU(st,Be.placementInvProjMatrix,d.transform.glCoordMatrix),o.aU(st,st,Be.placementViewportMatrix),M.push({circleArray:Qe,circleOffset:j,transform:Rt,invTransform:st,coord:De}),N+=Qe.length/4,j=N}tt&&C.draw(E,S.LINES,nr.disabled,Fr.disabled,d.colorModeForRenderPass(),Mr.disabled,ba(He,d.transform,Fe),d.style.map.terrain&&d.style.map.terrain.getTerrainData(De),s.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,null,d.transform.zoom,null,null,tt.collisionVertexBuffer)}if(!b||!M.length)return;const re=d.useProgram("collisionCircle"),te=new o.aV;te.resize(4*N),te._trim();let oe=0;for(const pe of M)for(let De=0;De<pe.circleArray.length/4;De++){const Fe=4*De,Be=pe.circleArray[Fe+0],He=pe.circleArray[Fe+1],tt=pe.circleArray[Fe+2],Qe=pe.circleArray[Fe+3];te.emplace(oe++,Be,He,tt,Qe,0),te.emplace(oe++,Be,He,tt,Qe,1),te.emplace(oe++,Be,He,tt,Qe,2),te.emplace(oe++,Be,He,tt,Qe,3)}(!no||no.length<2*N)&&(no=function(pe){const De=2*pe,Fe=new o.aX;Fe.resize(De),Fe._trim();for(let Be=0;Be<De;Be++){const He=6*Be;Fe.uint16[He+0]=4*Be+0,Fe.uint16[He+1]=4*Be+1,Fe.uint16[He+2]=4*Be+2,Fe.uint16[He+3]=4*Be+2,Fe.uint16[He+4]=4*Be+3,Fe.uint16[He+5]=4*Be+0}return Fe}(N));const K=E.createIndexBuffer(no,!0),Se=E.createVertexBuffer(te,o.aW.members,!0);for(const pe of M){const De={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(Ne=d.transform).cameraToCenterDistance,u_viewport_size:[Ne.width,Ne.height]};re.draw(E,S.TRIANGLES,nr.disabled,Fr.disabled,d.colorModeForRenderPass(),Mr.disabled,De,d.style.map.terrain&&d.style.map.terrain.getTerrainData(pe.coord),s.id,Se,K,o.S.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,d.transform.zoom,null,null,null)}var Ne;Se.destroy(),K.destroy()}Mr.disabled=new Mr(!1,1029,2305),Mr.backCCW=new Mr(!0,1029,2305);const Ra=o.ao(new Float32Array(16));function io(d,t,s,u,p,g){const{horizontalAlign:b,verticalAlign:E}=o.au(d);return new o.P((-(b-.5)*t/p+u[0])*g,(-(E-.5)*s/p+u[1])*g)}function qo(d,t,s,u,p,g,b,E,S,C,M){const N=d.text.placedSymbolArray,j=d.text.dynamicLayoutVertexArray,re=d.icon.dynamicLayoutVertexArray,te={};j.clear();for(let oe=0;oe<N.length;oe++){const K=N.get(oe),Se=K.hidden||!K.crossTileID||d.allowVerticalPlacement&&!K.placedOrientation?null:u[K.crossTileID];if(Se){const Ne=new o.P(K.anchorX,K.anchorY),pe=Pr(Ne,s?b:g,M),De=Ai(p.cameraToCenterDistance,pe.signedDistanceFromCamera);let Fe=o.aj(d.textSizeData,S,K)*De/o.ap;s&&(Fe*=d.tilePixelRatio/E);const{width:Be,height:He,anchor:tt,textOffset:Qe,textBoxScale:st}=Se,Rt=io(tt,Be,He,Qe,st,Fe),ar=s?Pr(Ne.add(Rt),g,M).point:pe.point.add(t?Rt.rotate(-p.angle):Rt),pt=d.allowVerticalPlacement&&K.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let Gt=0;Gt<K.numGlyphs;Gt++)o.ak(j,ar,pt);C&&K.associatedIconIndex>=0&&(te[K.associatedIconIndex]={shiftedAnchor:ar,angle:pt})}else X(K.numGlyphs,j)}if(C){re.clear();const oe=d.icon.placedSymbolArray;for(let K=0;K<oe.length;K++){const Se=oe.get(K);if(Se.hidden)X(Se.numGlyphs,re);else{const Ne=te[K];if(Ne)for(let pe=0;pe<Se.numGlyphs;pe++)o.ak(re,Ne.shiftedAnchor,Ne.angle);else X(Se.numGlyphs,re)}}d.icon.dynamicLayoutVertexBuffer.updateData(re)}d.text.dynamicLayoutVertexBuffer.updateData(j)}function so(d,t,s){return s.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function oo(d,t,s,u,p,g,b,E,S,C,M,N){const j=d.context,re=j.gl,te=d.transform,oe=E==="map",K=S==="map",Se=E!=="viewport"&&s.layout.get("symbol-placement")!=="point",Ne=oe&&!K&&!Se,pe=!s.layout.get("symbol-sort-key").isConstant();let De=!1;const Fe=d.depthModeForSublayer(0,nr.ReadOnly),Be=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),He=[];for(const tt of u){const Qe=t.getTile(tt),st=Qe.getBucket(s);if(!st)continue;const Rt=p?st.text:st.icon;if(!Rt||!Rt.segments.get().length||!Rt.hasVisibleVertices)continue;const ar=Rt.programConfigurations.get(s.id),pt=p||st.sdfIcons,Gt=p?st.textSizeData:st.iconSizeData,Lt=K||te.pitch!==0,Dr=d.useProgram(so(pt,p,st),ar),ir=o.ah(Gt,te.zoom),Kt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(tt);let lr,Kr,Rr,Cn,mn=[0,0],rn=null;if(p)Kr=Qe.glyphAtlasTexture,Rr=re.LINEAR,lr=Qe.glyphAtlasTexture.size,st.iconsInText&&(mn=Qe.imageAtlasTexture.size,rn=Qe.imageAtlasTexture,Cn=Lt||d.options.rotating||d.options.zooming||Gt.kind==="composite"||Gt.kind==="camera"?re.LINEAR:re.NEAREST);else{const Qr=s.layout.get("icon-size").constantOr(0)!==1||st.iconsNeedLinear;Kr=Qe.imageAtlasTexture,Rr=pt||d.options.rotating||d.options.zooming||Qr||Lt?re.LINEAR:re.NEAREST,lr=Qe.imageAtlasTexture.size}const xi=ve(Qe,1,d.transform.zoom),Br=it(tt.posMatrix,K,oe,d.transform,xi),es=jn(tt.posMatrix,K,oe,d.transform,xi),ts=Be&&st.hasTextData(),$s=s.layout.get("icon-text-fit")!=="none"&&ts&&st.hasIconData();if(Se){const Qr=d.style.map.terrain?(pi,en)=>d.style.map.terrain.getElevation(tt,pi,en):null,gn=s.layout.get("text-rotation-alignment")==="map";nt(st,tt.posMatrix,d,p,Br,es,K,C,gn,Qr)}const yo=d.translatePosMatrix(tt.posMatrix,Qe,g,b),ea=Se||p&&Be||$s?Ra:Br,Bn=d.translatePosMatrix(es,Qe,g,b,!0),Pn=pt&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ei;ei=pt?st.iconsInText?ms(Gt.kind,ir,Ne,K,d,yo,ea,Bn,lr,mn):No(Gt.kind,ir,Ne,K,d,yo,ea,Bn,p,lr,!0):Sa(Gt.kind,ir,Ne,K,d,yo,ea,Bn,p,lr);const _o={program:Dr,buffers:Rt,uniformValues:ei,atlasTexture:Kr,atlasTextureIcon:rn,atlasInterpolation:Rr,atlasInterpolationIcon:Cn,isSDF:pt,hasHalo:Pn};if(pe&&st.canOverlap){De=!0;const Qr=Rt.segments.get();for(const gn of Qr)He.push({segments:new o.S([gn]),sortKey:gn.sortKey,state:_o,terrainData:Kt})}else He.push({segments:Rt.segments,sortKey:0,state:_o,terrainData:Kt})}De&&He.sort((tt,Qe)=>tt.sortKey-Qe.sortKey);for(const tt of He){const Qe=tt.state;if(j.activeTexture.set(re.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,re.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(j.activeTexture.set(re.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),Qe.isSDF){const st=Qe.uniformValues;Qe.hasHalo&&(st.u_is_halo=1,Go(Qe.buffers,tt.segments,s,d,Qe.program,Fe,M,N,st,tt.terrainData)),st.u_is_halo=0}Go(Qe.buffers,tt.segments,s,d,Qe.program,Fe,M,N,Qe.uniformValues,tt.terrainData)}}function Go(d,t,s,u,p,g,b,E,S,C){const M=u.context;p.draw(M,M.gl.TRIANGLES,g,b,E,Mr.disabled,S,C,s.id,d.layoutVertexBuffer,d.indexBuffer,t,s.paint,u.transform.zoom,d.programConfigurations.get(s.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function ao(d,t,s,u,p){if(!s||!u||!u.imageAtlas)return;const g=u.imageAtlas.patternPositions;let b=g[s.to.toString()],E=g[s.from.toString()];if(!b&&E&&(b=E),!E&&b&&(E=b),!b||!E){const S=p.getPaintProperty(t);b=g[S],E=g[S]}b&&E&&d.setConstantPatternPositions(b,E)}function lo(d,t,s,u,p,g,b){const E=d.context.gl,S="fill-pattern",C=s.paint.get(S),M=C&&C.constantOr(1),N=s.getCrossfadeParameters();let j,re,te,oe,K;b?(re=M&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=E.LINES):(re=M?"fillPattern":"fill",j=E.TRIANGLES);const Se=C.constantOr(null);for(const Ne of u){const pe=t.getTile(Ne);if(M&&!pe.patternsLoaded())continue;const De=pe.getBucket(s);if(!De)continue;const Fe=De.programConfigurations.get(s.id),Be=d.useProgram(re,Fe),He=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Ne);M&&(d.context.activeTexture.set(E.TEXTURE0),pe.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Fe.updatePaintBuffers(N)),ao(Fe,S,Se,pe,s);const tt=He?Ne:null,Qe=d.translatePosMatrix(tt?tt.posMatrix:Ne.posMatrix,pe,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(b){oe=De.indexBuffer2,K=De.segments2;const st=[E.drawingBufferWidth,E.drawingBufferHeight];te=re==="fillOutlinePattern"&&M?Js(Qe,d,N,pe,st):Oo(Qe,st)}else oe=De.indexBuffer,K=De.segments,te=M?xa(Qe,d,N,pe):rl(Qe);Be.draw(d.context,j,p,d.stencilModeForClipping(Ne),g,Mr.disabled,te,He,s.id,De.layoutVertexBuffer,oe,K,s.paint,d.transform.zoom,Fe)}}function co(d,t,s,u,p,g,b){const E=d.context,S=E.gl,C="fill-extrusion-pattern",M=s.paint.get(C),N=M.constantOr(1),j=s.getCrossfadeParameters(),re=s.paint.get("fill-extrusion-opacity"),te=M.constantOr(null);for(const oe of u){const K=t.getTile(oe),Se=K.getBucket(s);if(!Se)continue;const Ne=d.style.map.terrain&&d.style.map.terrain.getTerrainData(oe),pe=Se.programConfigurations.get(s.id),De=d.useProgram(N?"fillExtrusionPattern":"fillExtrusion",pe);N&&(d.context.activeTexture.set(S.TEXTURE0),K.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),pe.updatePaintBuffers(j)),ao(pe,C,te,K,s);const Fe=d.translatePosMatrix(oe.posMatrix,K,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Be=s.paint.get("fill-extrusion-vertical-gradient"),He=N?Ni(Fe,d,Be,re,oe,j,K):va(Fe,d,Be,re);De.draw(E,E.gl.TRIANGLES,p,g,b,Mr.backCCW,He,Ne,s.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,s.paint,d.transform.zoom,pe,d.style.map.terrain&&Se.centroidVertexBuffer)}}function fl(d,t,s,u,p,g,b){const E=d.context,S=E.gl,C=s.fbo;if(!C)return;const M=d.useProgram("hillshade"),N=d.style.map.terrain&&d.style.map.terrain.getTerrainData(t);E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),M.draw(E,S.TRIANGLES,p,g,b,Mr.disabled,((j,re,te,oe)=>{const K=te.paint.get("hillshade-shadow-color"),Se=te.paint.get("hillshade-highlight-color"),Ne=te.paint.get("hillshade-accent-color");let pe=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(pe-=j.transform.angle);const De=!j.options.moving;return{u_matrix:oe?oe.posMatrix:j.transform.calculatePosMatrix(re.tileID.toUnwrapped(),De),u_image:0,u_latrange:wa(0,re.tileID),u_light:[te.paint.get("hillshade-exaggeration"),pe],u_shadow:K,u_highlight:Se,u_accent:Ne}})(d,s,u,N?t:null),N,u.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Na(d,t,s,u,p,g){const b=d.context,E=b.gl,S=t.dem;if(S&&S.data){const C=S.dim,M=S.stride,N=S.getPixels();if(b.activeTexture.set(E.TEXTURE1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(M),t.demTexture){const re=t.demTexture;re.update(N,{premultiply:!1}),re.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else t.demTexture=new xe(b,N,E.RGBA,{premultiply:!1}),t.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);b.activeTexture.set(E.TEXTURE0);let j=t.fbo;if(!j){const re=new xe(b,{width:C,height:C,data:null},E.RGBA);re.bind(E.LINEAR,E.CLAMP_TO_EDGE),j=t.fbo=b.createFramebuffer(C,C,!0,!1),j.colorAttachment.set(re.texture)}b.bindFramebuffer.set(j.framebuffer),b.viewport.set([0,0,C,C]),d.useProgram("hillshadePrepare").draw(b,E.TRIANGLES,u,p,g,Mr.disabled,((re,te)=>{const oe=te.stride,K=o.Z();return o.aS(K,0,o.N,-o.N,0,0,1),o.$(K,K,[0,-o.N,0]),{u_matrix:K,u_image:1,u_dimension:[oe,oe],u_zoom:re.overscaledZ,u_unpack:te.getUnpackVector()}})(t.tileID,S),null,s.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function rc(d,t,s,u,p,g){const b=u.paint.get("raster-fade-duration");if(!g&&b>0){const E=o.h.now(),S=(E-d.timeAdded)/b,C=t?(E-t.timeAdded)/b:-1,M=s.getSource(),N=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),j=!t||Math.abs(t.tileID.overscaledZ-N)>Math.abs(d.tileID.overscaledZ-N),re=j&&d.refreshedUponExpiration?1:o.ad(j?S:1-C,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}const ml=new o.aT(1,0,0,1),Zo=new o.aT(0,1,0,1),Ho=new o.aT(0,0,1,1),gl=new o.aT(1,0,1,1),yl=new o.aT(0,1,1,1);function uo(d,t,s,u){Xo(d,0,t+s/2,d.transform.width,s,u)}function Wo(d,t,s,u){Xo(d,t-s/2,0,s,d.transform.height,u)}function Xo(d,t,s,u,p,g){const b=d.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*d.pixelRatio,s*d.pixelRatio,u*d.pixelRatio,p*d.pixelRatio),b.clear({color:g}),E.disable(E.SCISSOR_TEST)}function _l(d,t,s){const u=d.context,p=u.gl,g=s.posMatrix,b=d.useProgram("debug"),E=nr.disabled,S=Fr.disabled,C=d.colorModeForRenderPass(),M="$debug",N=d.style.map.terrain&&d.style.map.terrain.getTerrainData(s);u.activeTexture.set(p.TEXTURE0);const j=t.getTileByID(s.key).latestRawTileData,re=Math.floor((j&&j.byteLength||0)/1024),te=t.getTile(s).tileSize,oe=512/Math.min(te,512)*(s.overscaledZ/d.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),function(Se,Ne){Se.initDebugOverlayCanvas();const pe=Se.debugOverlayCanvas,De=Se.context.gl,Fe=Se.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,pe.width,pe.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(Ne,5,5),Fe.strokeText(Ne,5,5),Se.debugOverlayTexture.update(pe),Se.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(d,`${K} ${re}kB`),b.draw(u,p.TRIANGLES,E,S,Lr.alphaBlended,Mr.disabled,Ks(g,o.aT.transparent,oe),null,M,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),b.draw(u,p.LINE_STRIP,E,S,C,Mr.disabled,Ks(g,o.aT.red),N,M,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function Or(d,t,s){const u=d.context,p=u.gl,g=d.colorModeForRenderPass(),b=new nr(p.LEQUAL,nr.ReadWrite,d.depthRangeFor3D),E=d.useProgram("terrain"),S=t.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,d.width,d.height]);for(const C of s){const M=d.renderToTexture.getTexture(C),N=t.getTerrainData(C.tileID);u.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,M.texture);const j={u_matrix:d.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(d.transform.zoom)};E.draw(u,p.TRIANGLES,b,Fr.disabled,g,Mr.backCCW,j,N,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class Es{constructor(t,s){this.context=new tc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.Z(),renderTime:0},this.setup(),this.numSublayers=Jt.maxUnderzooming+Jt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ko}resize(t,s,u){if(this.width=Math.floor(t*u),this.height=Math.floor(s*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,s=new o.a_;s.emplaceBack(0,0),s.emplaceBack(o.N,0),s.emplaceBack(0,o.N),s.emplaceBack(o.N,o.N),this.tileExtentBuffer=t.createVertexBuffer(s,Mo.members),this.tileExtentSegments=o.S.simpleSegment(0,0,4,2);const u=new o.a_;u.emplaceBack(0,0),u.emplaceBack(o.N,0),u.emplaceBack(0,o.N),u.emplaceBack(o.N,o.N),this.debugBuffer=t.createVertexBuffer(u,Mo.members),this.debugSegments=o.S.simpleSegment(0,0,4,5);const p=new o.V;p.emplaceBack(0,0,0,0),p.emplaceBack(o.N,0,o.N,0),p.emplaceBack(0,o.N,0,o.N),p.emplaceBack(o.N,o.N,o.N,o.N),this.rasterBoundsBuffer=t.createVertexBuffer(p,It.members),this.rasterBoundsSegments=o.S.simpleSegment(0,0,4,2);const g=new o.a_;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,Mo.members),this.viewportSegments=o.S.simpleSegment(0,0,4,2);const b=new o.a$;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(b);const E=new o.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const S=this.context.gl;this.stencilClearMode=new Fr({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=o.Z();o.aS(u,0,this.width,this.height,0,0,1),o.a0(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,nr.disabled,this.stencilClearMode,Lr.disabled,Mr.disabled,nl(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const u=this.context,p=u.gl;this.nextStencilID+s.length>256&&this.clearStencil(),u.setColorMode(Lr.disabled),u.setDepthMode(nr.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of s){const E=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(b);g.draw(u,p.TRIANGLES,nr.disabled,new Fr({func:p.ALWAYS,mask:0},E,255,p.KEEP,p.KEEP,p.REPLACE),Lr.disabled,Mr.disabled,nl(b.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Fr({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Fr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,u=t.sort((b,E)=>E.overscaledZ-b.overscaledZ),p=u[u.length-1].overscaledZ,g=u[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const b={};for(let E=0;E<g;E++)b[E+p]=new Fr({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[b,u]}return[{[p]:Fr.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Lr([t.CONSTANT_COLOR,t.ONE],new o.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Lr.unblended:Lr.alphaBlended}depthModeForSublayer(t,s,u){if(!this.opaquePassEnabledForLayer())return nr.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new nr(u||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.h.now()),this.imageManager.beginFrame();const u=this.style._order,p=this.style.sourceCaches,g={},b={},E={};for(const S in p){const C=p[S];C.used&&C.prepare(this.context),g[S]=C.getVisibleCoordinates(),b[S]=g[S].slice().reverse(),E[S]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<u.length;S++)if(this.style._layers[u[S]].is3D()){this.opaquePassCutoff=S;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const S=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||S.length)&&(o.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(C,M){const N=C.context,j=N.gl,re=Lr.unblended,te=new nr(j.LEQUAL,nr.ReadWrite,[0,1]),oe=M.getTerrainMesh(),K=M.sourceCache.getRenderableTiles(),Se=C.useProgram("terrainDepth");N.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),N.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),N.clear({color:o.aT.transparent,depth:1});for(const Ne of K){const pe=M.getTerrainData(Ne.tileID),De={u_matrix:C.transform.calculatePosMatrix(Ne.tileID.toUnwrapped()),u_ele_delta:M.getMeshFrameDelta(C.transform.zoom)};Se.draw(N,j.TRIANGLES,te,Fr.disabled,re,Mr.backCCW,De,pe,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments)}N.bindFramebuffer.set(null),N.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain),function(C,M){const N=C.context,j=N.gl,re=Lr.unblended,te=new nr(j.LEQUAL,nr.ReadWrite,[0,1]),oe=M.getTerrainMesh(),K=M.getCoordsTexture(),Se=M.sourceCache.getRenderableTiles(),Ne=C.useProgram("terrainCoords");N.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),N.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),N.clear({color:o.aT.transparent,depth:1}),M.coordsIndex=[];for(const pe of Se){const De=M.getTerrainData(pe.tileID);N.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,K.texture);const Fe={u_matrix:C.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(C.transform.zoom)};Ne.draw(N,j.TRIANGLES,te,Fr.disabled,re,Mr.backCCW,Fe,De,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments),M.coordsIndex.push(pe.tileID.key)}N.bindFramebuffer.set(null),N.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const S of u){const C=this.style._layers[S];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const M=b[C.source];(C.type==="custom"||M.length)&&this.renderLayer(this,p[C.source],C,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?o.aT.black:o.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[u[this.currentLayer]],C=p[S.source],M=g[S.source];this._renderTileClippingMasks(S,M),this.renderLayer(this,C,S,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const S=this.style._layers[u[this.currentLayer]],C=p[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const M=(S.type==="symbol"?E:b)[S.source];this._renderTileClippingMasks(S,g[S.source]),this.renderLayer(this,C,S,M)}if(this.options.showTileBoundaries){const S=function(C,M){let N=null;const j=Object.values(C._layers).flatMap(K=>K.source&&!K.isHidden(M)?[C.sourceCaches[K.source]]:[]),re=j.filter(K=>K.getSource().type==="vector"),te=j.filter(K=>K.getSource().type!=="vector"),oe=K=>{(!N||N.getSource().maxzoom<K.getSource().maxzoom)&&(N=K)};return re.forEach(K=>oe(K)),N||te.forEach(K=>oe(K)),N}(this.style,this.transform.zoom);S&&function(C,M,N){for(let j=0;j<N.length;j++)_l(C,M,N[j])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const C=S.transform.padding;uo(S,S.transform.height-(C.top||0),3,ml),uo(S,C.bottom||0,3,Zo),Wo(S,C.left||0,3,Ho),Wo(S,S.transform.width-(C.right||0),3,gl);const M=S.transform.centerPoint;(function(N,j,re,te){Xo(N,j-1,re-10,2,20,te),Xo(N,j-10,re-1,20,2,te)})(S,M.x,S.transform.height-M.y,yl)}(this),this.context.setDefault()}renderLayer(t,s,u,p){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(p||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(g,b,E,S,C){if(g.renderPass!=="translucent")return;const M=Fr.disabled,N=g.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(j,re,te,oe,K,Se,Ne){const pe=re.transform,De=K==="map",Fe=Se==="map";for(const Be of j){const He=oe.getTile(Be),tt=He.getBucket(te);if(!tt||!tt.text||!tt.text.segments.get().length)continue;const Qe=o.ah(tt.textSizeData,pe.zoom),st=ve(He,1,re.transform.zoom),Rt=it(Be.posMatrix,Fe,De,re.transform,st),ar=te.layout.get("icon-text-fit")!=="none"&&tt.hasIconData();if(Qe){const pt=Math.pow(2,pe.zoom-He.tileID.overscaledZ);qo(tt,De,Fe,Ne,pe,Rt,Be.posMatrix,pt,Qe,ar,re.style.map.terrain?(Gt,Lt)=>re.style.map.terrain.getElevation(Be,Gt,Lt):null)}}}(S,g,E,b,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),C),E.paint.get("icon-opacity").constantOr(1)!==0&&oo(g,b,E,S,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),M,N),E.paint.get("text-opacity").constantOr(1)!==0&&oo(g,b,E,S,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),M,N),b.map.showCollisionBoxes&&(dl(g,b,E,S,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),dl(g,b,E,S,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))})(t,s,u,p,this.style.placement.variableOffsets);break;case"circle":(function(g,b,E,S){if(g.renderPass!=="translucent")return;const C=E.paint.get("circle-opacity"),M=E.paint.get("circle-stroke-width"),N=E.paint.get("circle-stroke-opacity"),j=!E.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(M.constantOr(1)===0||N.constantOr(1)===0))return;const re=g.context,te=re.gl,oe=g.depthModeForSublayer(0,nr.ReadOnly),K=Fr.disabled,Se=g.colorModeForRenderPass(),Ne=[];for(let pe=0;pe<S.length;pe++){const De=S[pe],Fe=b.getTile(De),Be=Fe.getBucket(E);if(!Be)continue;const He=Be.programConfigurations.get(E.id),tt=g.useProgram("circle",He),Qe=Be.layoutVertexBuffer,st=Be.indexBuffer,Rt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(De),ar={programConfiguration:He,program:tt,layoutVertexBuffer:Qe,indexBuffer:st,uniformValues:Yi(g,De,Fe,E),terrainData:Rt};if(j){const pt=Be.segments.get();for(const Gt of pt)Ne.push({segments:new o.S([Gt]),sortKey:Gt.sortKey,state:ar})}else Ne.push({segments:Be.segments,sortKey:0,state:ar})}j&&Ne.sort((pe,De)=>pe.sortKey-De.sortKey);for(const pe of Ne){const{programConfiguration:De,program:Fe,layoutVertexBuffer:Be,indexBuffer:He,uniformValues:tt,terrainData:Qe}=pe.state;Fe.draw(re,te.TRIANGLES,oe,K,Se,Mr.disabled,tt,Qe,E.id,Be,He,pe.segments,E.paint,g.transform.zoom,De)}})(t,s,u,p);break;case"heatmap":(function(g,b,E,S){if(E.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const C=g.context,M=C.gl,N=Fr.disabled,j=new Lr([M.ONE,M.ONE],o.aT.transparent,[!0,!0,!0,!0]);(function(re,te,oe){const K=re.gl;re.activeTexture.set(K.TEXTURE1),re.viewport.set([0,0,te.width/4,te.height/4]);let Se=oe.heatmapFbo;if(Se)K.bindTexture(K.TEXTURE_2D,Se.colorAttachment.get()),re.bindFramebuffer.set(Se.framebuffer);else{const Ne=K.createTexture();K.bindTexture(K.TEXTURE_2D,Ne),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),Se=oe.heatmapFbo=re.createFramebuffer(te.width/4,te.height/4,!1,!1),function(pe,De,Fe,Be){var He,tt;const Qe=pe.gl,st=(He=pe.HALF_FLOAT)!==null&&He!==void 0?He:Qe.UNSIGNED_BYTE,Rt=(tt=pe.RGBA16F)!==null&&tt!==void 0?tt:Qe.RGBA;Qe.texImage2D(Qe.TEXTURE_2D,0,Rt,De.width/4,De.height/4,0,Qe.RGBA,st,null),Be.colorAttachment.set(Fe)}(re,te,Ne,Se)}})(C,g,E),C.clear({color:o.aT.transparent});for(let re=0;re<S.length;re++){const te=S[re];if(b.hasRenderableParent(te))continue;const oe=b.getTile(te),K=oe.getBucket(E);if(!K)continue;const Se=K.programConfigurations.get(E.id),Ne=g.useProgram("heatmap",Se),{zoom:pe}=g.transform;Ne.draw(C,M.TRIANGLES,nr.disabled,N,j,Mr.disabled,il(te.posMatrix,oe,pe,E.paint.get("heatmap-intensity")),null,E.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,E.paint,g.transform.zoom,Se)}C.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(C,M){const N=C.context,j=N.gl,re=M.heatmapFbo;if(!re)return;N.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,re.colorAttachment.get()),N.activeTexture.set(j.TEXTURE1);let te=M.colorRampTexture;te||(te=M.colorRampTexture=new xe(N,M.colorRamp,j.RGBA)),te.bind(j.LINEAR,j.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(N,j.TRIANGLES,nr.disabled,Fr.disabled,C.colorModeForRenderPass(),Mr.disabled,((oe,K,Se,Ne)=>{const pe=o.Z();o.aS(pe,0,oe.width,oe.height,0,0,1);const De=oe.context.gl;return{u_matrix:pe,u_world:[De.drawingBufferWidth,De.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}})(C,M),null,M.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,M.paint,C.transform.zoom)}(g,E))})(t,s,u,p);break;case"line":(function(g,b,E,S){if(g.renderPass!=="translucent")return;const C=E.paint.get("line-opacity"),M=E.paint.get("line-width");if(C.constantOr(1)===0||M.constantOr(1)===0)return;const N=g.depthModeForSublayer(0,nr.ReadOnly),j=g.colorModeForRenderPass(),re=E.paint.get("line-dasharray"),te=E.paint.get("line-pattern"),oe=te.constantOr(1),K=E.paint.get("line-gradient"),Se=E.getCrossfadeParameters(),Ne=oe?"linePattern":re?"lineSDF":K?"lineGradient":"line",pe=g.context,De=pe.gl;let Fe=!0;for(const Be of S){const He=b.getTile(Be);if(oe&&!He.patternsLoaded())continue;const tt=He.getBucket(E);if(!tt)continue;const Qe=tt.programConfigurations.get(E.id),st=g.context.program.get(),Rt=g.useProgram(Ne,Qe),ar=Fe||Rt.program!==st,pt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Be),Gt=te.constantOr(null);if(Gt&&He.imageAtlas){const ir=He.imageAtlas,Kt=ir.patternPositions[Gt.to.toString()],lr=ir.patternPositions[Gt.from.toString()];Kt&&lr&&Qe.setConstantPatternPositions(Kt,lr)}const Lt=pt?Be:null,Dr=oe?Yl(g,He,E,Se,Lt):re?Ta(g,He,E,re,Se,Lt):K?sl(g,He,E,tt.lineClipsArray.length,Lt):Ea(g,He,E,Lt);if(oe)pe.activeTexture.set(De.TEXTURE0),He.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),Qe.updatePaintBuffers(Se);else if(re&&(ar||g.lineAtlas.dirty))pe.activeTexture.set(De.TEXTURE0),g.lineAtlas.bind(pe);else if(K){const ir=tt.gradients[E.id];let Kt=ir.texture;if(E.gradientVersion!==ir.version){let lr=256;if(E.stepInterpolant){const Kr=b.getSource().maxzoom,Rr=Be.canonical.z===Kr?Math.ceil(1<<g.transform.maxZoom-Be.canonical.z):1;lr=o.ad(o.aY(tt.maxLineLength/o.N*1024*Rr),256,pe.maxTextureSize)}ir.gradient=o.aZ({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:lr,image:ir.gradient||void 0,clips:tt.lineClipsArray}),ir.texture?ir.texture.update(ir.gradient):ir.texture=new xe(pe,ir.gradient,De.RGBA),ir.version=E.gradientVersion,Kt=ir.texture}pe.activeTexture.set(De.TEXTURE0),Kt.bind(E.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}Rt.draw(pe,De.TRIANGLES,N,g.stencilModeForClipping(Be),j,Mr.disabled,Dr,pt,E.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,E.paint,g.transform.zoom,Qe,tt.layoutVertexBuffer2),Fe=!1}})(t,s,u,p);break;case"fill":(function(g,b,E,S){const C=E.paint.get("fill-color"),M=E.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const N=g.colorModeForRenderPass(),j=E.paint.get("fill-pattern"),re=g.opaquePassEnabledForLayer()&&!j.constantOr(1)&&C.constantOr(o.aT.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===re){const te=g.depthModeForSublayer(1,g.renderPass==="opaque"?nr.ReadWrite:nr.ReadOnly);lo(g,b,E,S,te,N,!1)}if(g.renderPass==="translucent"&&E.paint.get("fill-antialias")){const te=g.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,nr.ReadOnly);lo(g,b,E,S,te,N,!0)}})(t,s,u,p);break;case"fill-extrusion":(function(g,b,E,S){const C=E.paint.get("fill-extrusion-opacity");if(C!==0&&g.renderPass==="translucent"){const M=new nr(g.context.gl.LEQUAL,nr.ReadWrite,g.depthRangeFor3D);if(C!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))co(g,b,E,S,M,Fr.disabled,Lr.disabled),co(g,b,E,S,M,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const N=g.colorModeForRenderPass();co(g,b,E,S,M,Fr.disabled,N)}}})(t,s,u,p);break;case"hillshade":(function(g,b,E,S){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const C=g.context,M=g.depthModeForSublayer(0,nr.ReadOnly),N=g.colorModeForRenderPass(),[j,re]=g.renderPass==="translucent"?g.stencilConfigForOverlap(S):[{},S];for(const te of re){const oe=b.getTile(te);oe.needsHillshadePrepare!==void 0&&oe.needsHillshadePrepare&&g.renderPass==="offscreen"?Na(g,oe,E,M,Fr.disabled,N):g.renderPass==="translucent"&&fl(g,te,oe,E,M,j[te.overscaledZ],N)}C.viewport.set([0,0,g.width,g.height])})(t,s,u,p);break;case"raster":(function(g,b,E,S){if(g.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!S.length)return;const C=g.context,M=C.gl,N=b.getSource(),j=g.useProgram("raster"),re=g.colorModeForRenderPass(),[te,oe]=N instanceof jt?[{},S]:g.stencilConfigForOverlap(S),K=oe[oe.length-1].overscaledZ,Se=!g.options.moving;for(const Ne of oe){const pe=g.depthModeForSublayer(Ne.overscaledZ-K,E.paint.get("raster-opacity")===1?nr.ReadWrite:nr.ReadOnly,M.LESS),De=b.getTile(Ne);De.registerFadeDuration(E.paint.get("raster-fade-duration"));const Fe=b.findLoadedParent(Ne,0),Be=rc(De,Fe,b,E,g.transform,g.style.map.terrain);let He,tt;const Qe=E.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;C.activeTexture.set(M.TEXTURE0),De.texture.bind(Qe,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(M.TEXTURE1),Fe?(Fe.texture.bind(Qe,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),He=Math.pow(2,Fe.tileID.overscaledZ-De.tileID.overscaledZ),tt=[De.tileID.canonical.x*He%1,De.tileID.canonical.y*He%1]):De.texture.bind(Qe,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);const st=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ne),Rt=st?Ne:null,ar=Rt?Rt.posMatrix:g.transform.calculatePosMatrix(Ne.toUnwrapped(),Se),pt=ol(ar,tt||[0,0],He||1,Be,E);N instanceof jt?j.draw(C,M.TRIANGLES,pe,Fr.disabled,re,Mr.disabled,pt,st,E.id,N.boundsBuffer,g.quadTriangleIndexBuffer,N.boundsSegments):j.draw(C,M.TRIANGLES,pe,te[Ne.overscaledZ],re,Mr.disabled,pt,st,E.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}})(t,s,u,p);break;case"background":(function(g,b,E,S){const C=E.paint.get("background-color"),M=E.paint.get("background-opacity");if(M===0)return;const N=g.context,j=N.gl,re=g.transform,te=re.tileSize,oe=E.paint.get("background-pattern");if(g.isPatternMissing(oe))return;const K=!oe&&C.a===1&&M===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==K)return;const Se=Fr.disabled,Ne=g.depthModeForSublayer(0,K==="opaque"?nr.ReadWrite:nr.ReadOnly),pe=g.colorModeForRenderPass(),De=g.useProgram(oe?"backgroundPattern":"background"),Fe=S||re.coveringTiles({tileSize:te,terrain:g.style.map.terrain});oe&&(N.activeTexture.set(j.TEXTURE0),g.imageManager.bind(g.context));const Be=E.getCrossfadeParameters();for(const He of Fe){const tt=S?He.posMatrix:g.transform.calculatePosMatrix(He.toUnwrapped()),Qe=oe?Hn(tt,M,g,oe,{tileID:He,tileSize:te},Be):Ki(tt,M,C),st=g.style.map.terrain&&g.style.map.terrain.getTerrainData(He);De.draw(N,j.TRIANGLES,Ne,Se,pe,Mr.disabled,Qe,st,E.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}})(t,0,u,p);break;case"custom":(function(g,b,E){const S=g.context,C=E.implementation;if(g.renderPass==="offscreen"){const M=C.prerender;M&&(g.setCustomLayerDefaults(),S.setColorMode(g.colorModeForRenderPass()),M.call(C,S.gl,g.transform.customLayerMatrix()),S.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),S.setColorMode(g.colorModeForRenderPass()),S.setStencilMode(Fr.disabled);const M=C.renderingMode==="3d"?new nr(g.context.gl.LEQUAL,nr.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,nr.ReadOnly);S.setDepthMode(M),C.render(S.gl,g.transform.customLayerMatrix()),S.setDirty(),g.setBaseState(),S.bindFramebuffer.set(null)}})(t,0,u)}}translatePosMatrix(t,s,u,p,g){if(!u[0]&&!u[1])return t;const b=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(b){const C=Math.sin(b),M=Math.cos(b);u=[u[0]*M-u[1]*C,u[0]*C+u[1]*M]}const E=[g?u[0]:ve(s,u[0],this.transform.zoom),g?u[1]:ve(s,u[1],this.transform.zoom),0],S=new Float32Array(16);return o.$(S,t,E),S}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!s||!u}useProgram(t,s){this.cache=this.cache||{};const u=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new Ys(this.context,Nr[t],s,Lo[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new xe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class zn{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,u){const p=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const S=1/(E=o.ag([],E,t))[3]/s*p;return o.b3(E,E,[S,S,1/E[3],S])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const S=function(j,re){var te=re[0],oe=re[1],K=re[2],Se=te*te+oe*oe+K*K;return Se>0&&(Se=1/Math.sqrt(Se)),j[0]=re[0]*Se,j[1]=re[1]*Se,j[2]=re[2]*Se,j}([],function(j,re,te){var oe=re[0],K=re[1],Se=re[2],Ne=te[0],pe=te[1],De=te[2];return j[0]=K*De-Se*pe,j[1]=Se*Ne-oe*De,j[2]=oe*pe-K*Ne,j}([],ce([],g[E[0]],g[E[1]]),ce([],g[E[2]],g[E[1]]))),C=-((M=S)[0]*(N=g[E[1]])[0]+M[1]*N[1]+M[2]*N[2]);var M,N;return S.concat(C)});return new zn(g,b)}}class Fs{constructor(t,s){this.min=t,this.max=s,this.center=function(u,p,g){return u[0]=.5*p[0],u[1]=.5*p[1],u[2]=.5*p[2],u}([],function(u,p,g){return u[0]=p[0]+g[0],u[1]=p[1]+g[1],u[2]=p[2]+g[2],u}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],u=ne(this.min),p=ne(this.max);for(let g=0;g<s.length;g++)u[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new Fs(u,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let p=0;p<t.planes.length;p++){const g=t.planes[p];let b=0;for(let E=0;E<s.length;E++)o.b4(g,s[E])>=0&&b++;if(b===0)return 0;b!==s.length&&(u=!1)}if(u)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let E=0;E<t.points.length;E++){const S=t.points[E][p]-this.min[p];g=Math.min(g,S),b=Math.max(b,S)}if(b<0||g>this.max[p]-this.min[p])return 0}return 1}}class ho{constructor(t=0,s=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=u,this.right=p}interpolate(t,s,u){return s.top!=null&&t.top!=null&&(this.top=o.B.number(t.top,s.top,u)),s.bottom!=null&&t.bottom!=null&&(this.bottom=o.B.number(t.bottom,s.bottom,u)),s.left!=null&&t.left!=null&&(this.left=o.B.number(t.left,s.left,u)),s.right!=null&&t.right!=null&&(this.right=o.B.number(t.right,s.right,u)),this}getCenter(t,s){const u=o.ad((this.left+t-this.right)/2,0,t),p=o.ad((this.top+s-this.bottom)/2,0,s);return new o.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ho(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Yo{constructor(t,s,u,p,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ho,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new Yo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-o.b5(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var u=new o.A(4);return o.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,p,g){var b=p[0],E=p[1],S=p[2],C=p[3],M=Math.sin(g),N=Math.cos(g);u[0]=b*N+S*M,u[1]=E*N+C*M,u[2]=b*-M+S*N,u[3]=E*-M+C*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=o.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,u){this._unmodified=!1,this._edgeInsets.interpolate(t,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new o.b6(0,t)];if(this._renderWorldCopies){const u=this.pointCoordinate(new o.P(0,0)),p=this.pointCoordinate(new o.P(this.width,0)),g=this.pointCoordinate(new o.P(this.width,this.height)),b=this.pointCoordinate(new o.P(0,this.height)),E=Math.floor(Math.min(u.x,p.x,g.x,b.x)),S=Math.floor(Math.max(u.x,p.x,g.x,b.x)),C=1;for(let M=E-C;M<=S+C;M++)M!==0&&s.push(new o.b6(M,t))}return s}coveringTiles(t){var s,u;let p=this.coveringZoomLevel(t);const g=p;if(t.minzoom!==void 0&&p<t.minzoom)return[];t.maxzoom!==void 0&&p>t.maxzoom&&(p=t.maxzoom);const b=this.pointCoordinate(this.getCameraPoint()),E=o.U.fromLngLat(this.center),S=Math.pow(2,p),C=[S*b.x,S*b.y,0],M=[S*E.x,S*E.y,0],N=zn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let j=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=p);const re=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,te=pe=>({aabb:new Fs([pe*S,0,0],[(pe+1)*S,S,0]),zoom:0,x:0,y:0,wrap:pe,fullyVisible:!1}),oe=[],K=[],Se=p,Ne=t.reparseOverscaled?g:p;if(this._renderWorldCopies)for(let pe=1;pe<=3;pe++)oe.push(te(-pe)),oe.push(te(pe));for(oe.push(te(0));oe.length>0;){const pe=oe.pop(),De=pe.x,Fe=pe.y;let Be=pe.fullyVisible;if(!Be){const Rt=pe.aabb.intersects(N);if(Rt===0)continue;Be=Rt===2}const He=t.terrain?C:M,tt=pe.aabb.distanceX(He),Qe=pe.aabb.distanceY(He),st=Math.max(Math.abs(tt),Math.abs(Qe));if(pe.zoom===Se||st>re+(1<<Se-pe.zoom)-2&&pe.zoom>=j){const Rt=Se-pe.zoom,ar=C[0]-.5-(De<<Rt),pt=C[1]-.5-(Fe<<Rt);K.push({tileID:new o.O(pe.zoom===Se?Ne:pe.zoom,pe.wrap,pe.zoom,De,Fe),distanceSq:Ae([M[0]-.5-De,M[1]-.5-Fe]),tileDistanceToCamera:Math.sqrt(ar*ar+pt*pt)})}else for(let Rt=0;Rt<4;Rt++){const ar=(De<<1)+Rt%2,pt=(Fe<<1)+(Rt>>1),Gt=pe.zoom+1;let Lt=pe.aabb.quadrant(Rt);if(t.terrain){const Dr=new o.O(Gt,pe.wrap,Gt,ar,pt),ir=t.terrain.getMinMaxElevation(Dr),Kt=(s=ir.minElevation)!==null&&s!==void 0?s:this.elevation,lr=(u=ir.maxElevation)!==null&&u!==void 0?u:this.elevation;Lt=new Fs([Lt.min[0],Lt.min[1],Kt],[Lt.max[0],Lt.max[1],lr])}oe.push({aabb:Lt,zoom:Gt,x:ar,y:pt,wrap:pe.wrap,fullyVisible:Be})}}return K.sort((pe,De)=>pe.distanceSq-De.distanceSq).map(pe=>pe.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=o.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.P(o.G(t.lng)*this.worldSize,o.H(s)*this.worldSize)}unproject(t){return new o.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),u=t.getElevationForLngLatZoom(s,this.tileZoom);if(!(this.elevation-u))return;const p=this.getCameraPosition(),g=o.U.fromLngLat(p.lngLat,p.altitude),b=o.U.fromLngLat(s,u),E=g.x-b.x,S=g.y-b.y,C=g.z-b.z,M=Math.sqrt(E*E+S*S+C*C),N=this.scaleZoom(this.cameraToCenterDistance/M/this.tileSize);this._elevation=u,this._center=s,this.zoom=N}setLocationAtPoint(t,s){const u=this.pointCoordinate(s),p=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),b=new o.U(g.x-(u.x-p.x),g.y-(u.y-p.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),s.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return o.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const j=s.pointCoordinate(t);if(j!=null)return j}const u=[t.x,t.y,0,1],p=[t.x,t.y,1,1];o.ag(u,u,this.pixelMatrixInverse),o.ag(p,p,this.pixelMatrixInverse);const g=u[3],b=p[3],E=u[1]/g,S=p[1]/b,C=u[2]/g,M=p[2]/b,N=C===M?0:(0-C)/(M-C);return new o.U(o.B.number(u[0]/g,p[0]/b,N)/this.worldSize,o.B.number(E,S,N)/this.worldSize)}coordinatePoint(t,s=0,u=this.pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,s,1];return o.ag(p,p,u),new o.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new we().extend(this.pointLocation(new o.P(0,t))).extend(this.pointLocation(new o.P(this.width,t))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new we([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const u=t.key,p=s?this._alignedPosMatrixCache:this._posMatrixCache;if(p[u])return p[u];const g=t.canonical,b=this.worldSize/this.zoomScale(g.z),E=g.x+Math.pow(2,g.z)*t.wrap,S=o.ao(new Float64Array(16));return o.$(S,S,[E*b,g.y*b,0]),o.a0(S,S,[b/o.N,b/o.N,1]),o.a1(S,s?this.alignedProjMatrix:this.projMatrix,S),p[u]=new Float32Array(S),p[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,u,p,g=-90,b=90,E=-180,S=180;const C=this.size,M=this._unmodified;if(this.latRange){const re=this.latRange;g=o.H(re[1])*this.worldSize,b=o.H(re[0])*this.worldSize,t=b-g<C.y?C.y/(b-g):0}if(this.lngRange){const re=this.lngRange;E=o.b5(o.G(re[0])*this.worldSize,0,this.worldSize),S=o.b5(o.G(re[1])*this.worldSize,0,this.worldSize),S<E&&(S+=this.worldSize),s=S-E<C.x?C.x/(S-E):0}const N=this.point,j=Math.max(s||0,t||0);if(j)return this.center=this.unproject(new o.P(s?(S+E)/2:N.x,t?(b+g)/2:N.y)),this.zoom+=this.scaleZoom(j),this._unmodified=M,void(this._constraining=!1);if(this.latRange){const re=N.y,te=C.y/2;re-te<g&&(p=g+te),re+te>b&&(p=b-te)}if(this.lngRange){const re=(E+S)/2,te=o.b5(N.x,re-this.worldSize/2,re+this.worldSize/2),oe=C.x/2;te-oe<E&&(u=E+oe),te+oe>S&&(u=S-oe)}u===void 0&&p===void 0||(this.center=this.unproject(new o.P(u!==void 0?u:N.x,p!==void 0?p:N.y)).wrap()),this._unmodified=M,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b7(1,this.center.lat)*this.worldSize;let p=o.ao(new Float64Array(16));o.a0(p,p,[this.width/2,-this.height/2,1]),o.$(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=o.ao(new Float64Array(16)),o.a0(p,p,[1,-1,1]),o.$(p,p,[-1,-1,0]),o.a0(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const g=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),b=Math.min(this.elevation,this._minEleveationForCurrentTile),E=g-b*this._pixelPerMeter/Math.cos(this._pitch),S=b<0?E:g,C=Math.PI/2+this._pitch,M=this._fov*(.5+t.y/this.height),N=Math.sin(M)*S/Math.sin(o.ad(Math.PI-C-M,.01,Math.PI-.01)),j=this.getHorizon(),re=2*Math.atan(j/this.cameraToCenterDistance)*(.5+t.y/(2*j)),te=Math.sin(re)*S/Math.sin(o.ad(Math.PI-C-re,.01,Math.PI-.01)),oe=Math.min(N,te),K=1.01*(Math.cos(Math.PI/2-this._pitch)*oe+S),Se=this.height/50;p=new Float64Array(16),o.b8(p,this._fov,this.width/this.height,Se,K),p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height,o.a0(p,p,[1,-1,1]),o.$(p,p,[0,0,-this.cameraToCenterDistance]),o.b9(p,p,this._pitch),o.ae(p,p,this.angle),o.$(p,p,[-s,-u,0]),this.mercatorMatrix=o.a0([],p,[this.worldSize,this.worldSize,this.worldSize]),o.a0(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.a1(new Float64Array(16),this.labelPlaneMatrix,p),o.$(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=o.as([],p),this.pixelMatrix3D=o.a1(new Float64Array(16),this.labelPlaneMatrix,p);const Ne=this.width%2/2,pe=this.height%2/2,De=Math.cos(this.angle),Fe=Math.sin(this.angle),Be=s-Math.round(s)+De*Ne+Fe*pe,He=u-Math.round(u)+De*pe+Fe*Ne,tt=new Float64Array(p);if(o.$(tt,tt,[Be>.5?Be-1:Be,He>.5?He-1:He,0]),this.alignedProjMatrix=tt,p=o.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.ag(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let u=s.x,p=s.y,g=s.x,b=s.y;for(const E of t)u=Math.min(u,E.x),p=Math.min(p,E.y),g=Math.max(g,E.x),b=Math.max(b,E.y);return[new o.P(u,p),new o.P(g,p),new o.P(g,b),new o.P(u,b),new o.P(u,p)]}}}function Qi(d,t){let s,u=!1,p=null,g=null;const b=()=>{p=null,u&&(d.apply(g,s),p=setTimeout(b,t),u=!1)};return(...E)=>(u=!0,g=this,s=E,p||b(),p)}class po{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(u=p)}),(u&&u[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=Qi(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),b=Math.round(s.lng*g)/g,E=Math.round(s.lat*g)/g,S=this._map.getBearing(),C=this._map.getPitch();let M="";if(M+=t?`/${b}/${E}/${u}`:`${u}/${E}/${b}`,(S||C)&&(M+="/"+Math.round(10*S)/10),C&&(M+=`/${Math.round(C)}`),this._hashName){const N=this._hashName;let j=!1;const re=window.location.hash.slice(1).split("&").map(te=>{const oe=te.split("=")[0];return oe===N?(j=!0,`${oe}=${M}`):te}).filter(te=>te);return j||re.push(`${N}=${M}`),`#${re.join("&")}`}return`#${M}`}}const Ts={linearity:.3,easing:o.ba(0,0,.3,1)},La=o.e({deceleration:2500,maxSpeed:1400},Ts),vl=o.e({deceleration:20,maxSpeed:1400},Ts),xl=o.e({deceleration:1e3,maxSpeed:360},Ts),zi=o.e({deceleration:1e3,maxSpeed:90},Ts);class bl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=o.h.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const g=zs(s.pan.mag(),u,o.e({},La,t||{}));p.offset=s.pan.mult(g.amount/s.pan.mag()),p.center=this._map.transform.center,Xn(p,g)}if(s.zoom){const g=zs(s.zoom,u,vl);p.zoom=this._map.transform.zoom+g.amount,Xn(p,g)}if(s.bearing){const g=zs(s.bearing,u,xl);p.bearing=this._map.transform.bearing+o.ad(g.amount,-179,179),Xn(p,g)}if(s.pitch){const g=zs(s.pitch,u,zi);p.pitch=this._map.transform.pitch+g.amount,Xn(p,g)}if(p.zoom||p.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),o.e(p,{noMoveStart:!0})}}function Xn(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function zs(d,t,s){const{maxSpeed:u,linearity:p,deceleration:g}=s,b=o.ad(d*p/(t/1e3),-u,u),E=Math.abs(b)/(g*p);return{easing:s.easing,duration:1e3*E,amount:b*(E/2)}}class Yn extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u,p={}){const g=A.mousePos(s.getCanvasContainer(),u),b=s.unproject(g);super(t,o.e({point:g,lngLat:b,originalEvent:u},p)),this._defaultPrevented=!1,this.target=s}}class fo extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u){const p=t==="touchend"?u.changedTouches:u.touches,g=A.touchPos(s.getCanvasContainer(),p),b=g.map(S=>s.unproject(S)),E=g.reduce((S,C,M,N)=>S.add(C.div(N.length)),new o.P(0,0));super(t,{points:g,point:E,lngLats:b,lngLat:s.unproject(E),originalEvent:u}),this._defaultPrevented=!1}}class wl extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class z{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new wl(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Yn(t.type,this._map,t))}mouseup(t){this._map.fire(new Yn(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Yn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Yn(t.type,this._map,t))}mouseover(t){this._map.fire(new Yn(t.type,this._map,t))}mouseout(t){this._map.fire(new Yn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new fo(t.type,this._map,t))}touchmove(t){this._map.fire(new fo(t.type,this._map,t))}touchend(t){this._map.fire(new fo(t.type,this._map,t))}touchcancel(t){this._map.fire(new fo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class J{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Yn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Yn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ye{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(o.P.convert(t),this._map.terrain)}}class Re{constructor(t,s){this._map=t,this._tr=new ye(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(A.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=u,this._box||(this._box=A.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(p.x,u.x),b=Math.max(p.x,u.x),E=Math.min(p.y,u.y),S=Math.max(p.y,u.y);A.setTransform(this._box,`translate(${g}px,${E}px)`),this._box.style.width=b-g+"px",this._box.style.height=S-E+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const u=this._startPos,p=s;if(this.reset(),A.suppressClick(),u.x!==p.x||u.y!==p.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(u,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(A.remove(this._box),this._box=null),A.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new o.k(t,{originalEvent:s}))}}function ze(d,t){if(d.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${t.length}`);const s={};for(let u=0;u<d.length;u++)s[d[u].identifier]=t[u];return s}class at{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const g=new o.P(0,0);for(const b of p)g._add(b);return g.div(p.length)}(s),this.touches=ze(u,s)))}touchmove(t,s,u){if(this.aborted||!this.centroid)return;const p=ze(u,s);for(const g in this.touches){const b=p[g];(!b||b.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,s,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Tt{constructor(t){this.singleTap=new at(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,u){this.singleTap.touchstart(t,s,u)}touchmove(t,s,u){this.singleTap.touchmove(t,s,u)}touchend(t,s,u){const p=this.singleTap.touchend(t,s,u);if(p){const g=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(p)<30;if(g&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class gt{constructor(t){this._tr=new ye(t),this._zoomIn=new Tt({numTouches:1,numTaps:2}),this._zoomOut=new Tt({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,u){this._zoomIn.touchstart(t,s,u),this._zoomOut.touchstart(t,s,u)}touchmove(t,s,u){this._zoomIn.touchmove(t,s,u),this._zoomOut.touchmove(t,s,u)}touchend(t,s,u){const p=this._zoomIn.touchend(t,s,u),g=this._zoomOut.touchend(t,s,u),b=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ft{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=s.length?s[0]:s;return!this._moved&&p.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(u,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&A.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ar={0:1,2:2};class Jr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=A.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,u){const p=Ar[u];return s.buttons===void 0||(s.buttons&p)!==p}(t,this._eventButton)}isValidEndEvent(t){return A.mouseButton(t)===this._eventButton}}class Jn{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ui=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=function(t){t.preventDefault()}},Kn=({enable:d,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const u=new Jr({checkCorrectEvent:p=>A.mouseButton(p)===0&&p.ctrlKey||A.mouseButton(p)===2});return new Ft({clickTolerance:t,move:(p,g)=>({bearingDelta:(g.x-p.x)*s}),moveStateManager:u,enable:d,assignEvents:ui})},Gr=({enable:d,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const u=new Jr({checkCorrectEvent:p=>A.mouseButton(p)===0&&p.ctrlKey||A.mouseButton(p)===2});return new Ft({clickTolerance:t,move:(p,g)=>({pitchDelta:(g.y-p.y)*s}),moveStateManager:u,enable:d,assignEvents:ui})};class bt{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,u){return this._calculateTransform(t,s,u)}touchmove(t,s,u){if(this._map._cooperativeGestures&&(this._minTouches===2&&u.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,u.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(u.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,u)}touchend(t,s,u){this._calculateTransform(t,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,u){u.length>0&&(this._active=!0);const p=ze(u,s),g=new o.P(0,0),b=new o.P(0,0);let E=0;for(const C in p){const M=p[C],N=this._touches[C];N&&(g._add(M),b._add(M.sub(N)),E++,p[C]=M)}if(this._touches=p,E<this._minTouches||!b.mag())return;const S=b.div(E);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(E),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Di{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,u){if(!this._firstTwoTouches)return;t.preventDefault();const[p,g]=this._firstTwoTouches,b=Bs(u,s,p),E=Bs(u,s,g);if(!b||!E)return;const S=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],S,t)}touchend(t,s,u){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,b=Bs(u,s,p),E=Bs(u,s,g);b&&E||(this._active&&A.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bs(d,t,s){for(let u=0;u<d.length;u++)if(d[u].identifier===s)return t[u]}function Jo(d,t){return Math.log(d/t)/Math.LN2}class Ru extends Di{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jo(this._distance,u),pinchAround:s}}}function vt(d,t){return 180*d.angleWith(t)/Math.PI}class nc extends Di{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const u=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vt(this._vector,u),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,u=vt(t,this._startVector);return Math.abs(u)<s}}function ic(d){return Math.abs(d.y)>Math.abs(d.x)}class ap extends Di{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,u){super.touchstart(t,s,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,ic(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,u){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=s.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const b=t.y>0==s.y>0;return ic(t)&&ic(s)&&b}}const sc={panStep:100,bearingStep:15,pitchStep:10};class Nu{constructor(t){this._tr=new ye(t);const s=sc;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,u=0,p=0,g=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:E=>{const S=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:Lu,zoom:s?Math.round(S.zoom)+s*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+u*this._bearingStep,pitch:S.pitch+p*this._pitchStep,offset:[-g*this._panStep,-b*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Lu(d){return d*(2-d)}const Fu=4.000244140625;class lp{constructor(t,s){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new ye(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=o.h.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Fu==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=A.mousePos(this._el,t),u=this._tr;this._around=o.L.convert(this._aroundCenter?u.center:u.unproject(s)),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Fu?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&S!==0&&(S=1/S);const C=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(C*S))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,u=this._startZoom,p=this._easing;let g,b=!1;if(this._type==="wheel"&&u&&p){const E=Math.min((o.h.now()-this._lastWheelEventTime)/200,1),S=p(E);g=o.B.number(u,s,S),E<1?this._frameId||(this._frameId=!0):b=!0}else g=s,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=o.bb;if(this._prevEase){const u=this._prevEase,p=(o.h.now()-u.start)/u.duration,g=u.easing(p+.01)-u.easing(p),b=.27/Math.sqrt(g*g+1e-4)*.01,E=Math.sqrt(.0729-b*b);s=o.ba(b,E,.25,1)}return this._prevEase={start:o.h.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class oc{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ac{constructor(t){this._tr=new ye(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lc{constructor(){this._tap=new Tt({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,u){if(!this._swipePoint)if(this._tapTime){const p=s[0],g=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(p)<30;g&&b?u.length>0&&(this._swipePoint=p,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,s,u)}touchmove(t,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=s[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,u)}touchend(t,s,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const p=this._tap.touchend(t,s,u);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cc{constructor(t,s,u){this._el=t,this._mousePan=s,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hi{constructor(t,s,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Us{constructor(t,s,u,p){this._el=t,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fa=d=>d.zoom||d.drag||d.pitch||d.rotate;class uc extends o.k{}function za(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class hc{constructor(t,s){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,g)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=p.type==="renderFrame"?void 0:p,E={needsRenderFrame:!1},S={},C={},M=p.touches,N=M?this._getMapTouches(M):void 0,j=N?A.touchPos(this._el,N):A.mousePos(this._el,p);for(const{handlerName:oe,handler:K,allowed:Se}of this._handlers){if(!K.isEnabled())continue;let Ne;this._blockedByActive(C,Se,oe)?K.reset():K[g||p.type]&&(Ne=K[g||p.type](p,j,N),this.mergeHandlerResult(E,S,Ne,oe,b),Ne&&Ne.needsRenderFrame&&this._triggerRenderFrame()),(Ne||K.isActive())&&(C[oe]=K)}const re={};for(const oe in this._previousActiveHandlers)C[oe]||(re[oe]=b);this._previousActiveHandlers=C,(Object.keys(re).length||za(E))&&(this._changes.push([E,S,re]),this._triggerRenderFrame()),(Object.keys(C).length||za(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:te}=E;te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],te(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bl(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,b]of this._listeners)A.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,s,u]of this._listeners)A.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new z(s,t));const p=s.boxZoom=new Re(s,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const g=new gt(s),b=new ac(s);s.doubleClickZoom=new oc(b,g),this._add("tapZoom",g),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const E=new lc;this._add("tapDragZoom",E);const S=s.touchPitch=new ap(s);this._add("touchPitch",S),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const C=Kn(t),M=Gr(t);s.dragRotate=new hi(t,C,M),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const N=(({enable:Se,clickTolerance:Ne})=>{const pe=new Jr({checkCorrectEvent:De=>A.mouseButton(De)===0&&!De.ctrlKey});return new Ft({clickTolerance:Ne,move:(De,Fe)=>({around:Fe,panDelta:Fe.sub(De)}),activateOnStart:!0,moveStateManager:pe,enable:Se,assignEvents:ui})})(t),j=new bt(t,s);s.dragPan=new cc(u,N,j),this._add("mousePan",N),this._add("touchPan",j,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const re=new nc,te=new Ru;s.touchZoomRotate=new Us(u,te,re,E),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const oe=s.scrollZoom=new lp(s,()=>this._triggerRenderFrame());this._add("scrollZoom",oe,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const K=s.keyboard=new Nu(s);this._add("keyboard",K),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new J(s))}_add(t,s,u){this._handlers.push({handlerName:t,handler:s,allowed:u}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Fa(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,u){for(const p in t)if(p!==u&&(!s||s.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const u of t)this._el.contains(u.target)&&s.push(u);return s}mergeHandlerResult(t,s,u,p,g){if(!u)return;o.e(t,u);const b={handlerName:p,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(s.zoom=b),u.panDelta!==void 0&&(s.drag=b),u.pitchDelta!==void 0&&(s.pitch=b),u.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const t={},s={},u={};for(const[p,g,b]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),o.e(s,g),o.e(u,b);this._updateMapTransform(t,s,u),this._changes=[]}_updateMapTransform(t,s,u){const p=this._map,g=p._getTransformForUpdate(),b=p.terrain;if(!(za(t)||b&&this._terrainMovement))return this._fireEvents(s,u,!0);let{panDelta:E,zoomDelta:S,bearingDelta:C,pitchDelta:M,around:N,pinchAround:j}=t;j!==void 0&&(N=j),p._stop(!0),N=N||p.transform.centerPoint;const re=g.pointLocation(E?N.sub(E):N);C&&(g.bearing+=C),M&&(g.pitch+=M),S&&(g.zoom+=S),b?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?g.center=g.pointLocation(g.centerPoint.sub(E)):g.setLocationAtPoint(re,N):(this._terrainMovement=!0,this._map._elevationFreeze=!0,g.setLocationAtPoint(re,N),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,g.recalculateZoom(p.terrain)})):g.setLocationAtPoint(re,N),p._applyUpdatedTransform(g),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,u,!0)}_fireEvents(t,s,u){const p=Fa(this._eventsInProgress),g=Fa(t),b={};for(const M in t){const{originalEvent:N}=t[M];this._eventsInProgress[M]||(b[`${M}start`]=N),this._eventsInProgress[M]=t[M]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const M in b)this._fireEvent(M,b[M]);g&&this._fireEvent("move",g.originalEvent);for(const M in t){const{originalEvent:N}=t[M];this._fireEvent(M,N)}const E={};let S;for(const M in this._eventsInProgress){const{handlerName:N,originalEvent:j}=this._eventsInProgress[M];this._handlersById[N].isActive()||(delete this._eventsInProgress[M],S=s[N]||j,E[`${M}end`]=S)}for(const M in E)this._fireEvent(M,E[M]);const C=Fa(this._eventsInProgress);if(u&&(p||g)&&!C){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!M||!M.essential&&o.h.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:S})),N(this._map.getBearing())&&this._map.resetNorth()):(N(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new o.k(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new uc("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class zu extends o.E{constructor(t,s){super(),this._renderFrameCallback=()=>{const u=Math.min((o.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,u){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.e({offset:t},s),u)}panTo(t,s,u){return this.easeTo(o.e({center:t},s),u)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,u){return this.easeTo(o.e({zoom:t},s),u)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,u){return this.easeTo(o.e({bearing:t},s),u)}resetNorth(t,s){return this.rotateTo(0,o.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=we.convert(t);const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,s)}_cameraForBoxAndBearing(t,s,u,p){const g={top:0,bottom:0,right:0,left:0};if(typeof(p=o.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const Fe=p.padding;p.padding={top:Fe,bottom:Fe,right:Fe,left:Fe}}p.padding=o.e(g,p.padding);const b=this.transform,E=b.padding,S=b.project(o.L.convert(t)),C=b.project(o.L.convert(s)),M=S.rotate(-u*Math.PI/180),N=C.rotate(-u*Math.PI/180),j=new o.P(Math.max(M.x,N.x),Math.max(M.y,N.y)),re=new o.P(Math.min(M.x,N.x),Math.min(M.y,N.y)),te=j.sub(re),oe=(b.width-(E.left+E.right+p.padding.left+p.padding.right))/te.x,K=(b.height-(E.top+E.bottom+p.padding.top+p.padding.bottom))/te.y;if(K<0||oe<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Se=Math.min(b.scaleZoom(b.scale*Math.min(oe,K)),p.maxZoom),Ne=o.P.convert(p.offset),pe=new o.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(u*Math.PI/180),De=Ne.add(pe).mult(b.scale/b.zoomScale(Se));return{center:b.unproject(S.add(C).div(2).sub(De)),zoom:Se,bearing:u}}fitBounds(t,s,u){return this._fitInternal(this.cameraForBounds(t,s),s,u)}fitScreenCoordinates(t,s,u,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(t)),this.transform.pointLocation(o.P.convert(s)),u,p),p,g)}_fitInternal(t,s,u){return t?(delete(s=o.e(t,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(t,s){this.stop();const u=this._getTransformForUpdate();let p=!1,g=!1,b=!1;return"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=o.L.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(g=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(b=!0,u.pitch=+t.pitch),t.padding==null||u.isPaddingEqual(t.padding)||(u.padding=t.padding),this._applyUpdatedTransform(u),this.fire(new o.k("movestart",s)).fire(new o.k("move",s)),p&&this.fire(new o.k("zoomstart",s)).fire(new o.k("zoom",s)).fire(new o.k("zoomend",s)),g&&this.fire(new o.k("rotatestart",s)).fire(new o.k("rotate",s)).fire(new o.k("rotateend",s)),b&&this.fire(new o.k("pitchstart",s)).fire(new o.k("pitch",s)).fire(new o.k("pitchend",s)),this.fire(new o.k("moveend",s))}calculateCameraOptionsFromTo(t,s,u,p=0){const g=o.U.fromLngLat(t,s),b=o.U.fromLngLat(u,p),E=b.x-g.x,S=b.y-g.y,C=b.z-g.z,M=Math.hypot(E,S,C);if(M===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(E,S),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),re=180*Math.atan2(E,-S)/Math.PI;let te=180*Math.acos(N/M)/Math.PI;return te=C<0?90-te:90+te,{center:b.toLngLat(),zoom:j,pitch:te,bearing:re}}easeTo(t,s){this._stop(!1,t.easeId),((t=o.e({offset:[0,0],duration:500,easing:o.bb},t)).animate===!1||!t.essential&&o.h.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),p=this.getZoom(),g=this.getBearing(),b=this.getPitch(),E=this.getPadding(),S="zoom"in t?+t.zoom:p,C="bearing"in t?this._normalizeBearing(t.bearing,g):g,M="pitch"in t?+t.pitch:b,N="padding"in t?t.padding:u.padding,j=o.P.convert(t.offset);let re=u.centerPoint.add(j);const te=u.pointLocation(re),oe=o.L.convert(t.center||te);this._normalizeCenter(oe);const K=u.project(te),Se=u.project(oe).sub(K),Ne=u.zoomScale(S-p);let pe,De;t.around&&(pe=o.L.convert(t.around),De=u.locationPoint(pe));const Fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||S!==p,this._rotating=this._rotating||g!==C,this._pitching=this._pitching||M!==b,this._padding=!u.isPaddingEqual(N),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Fe),this.terrain&&this._prepareElevation(oe),this._ease(Be=>{if(this._zooming&&(u.zoom=o.B.number(p,S,Be)),this._rotating&&(u.bearing=o.B.number(g,C,Be)),this._pitching&&(u.pitch=o.B.number(b,M,Be)),this._padding&&(u.interpolatePadding(E,N,Be),re=u.centerPoint.add(j)),this.terrain&&!t.freezeElevation&&this._updateElevation(Be),pe)u.setLocationAtPoint(pe,De);else{const He=u.zoomScale(u.zoom-p),tt=S>p?Math.min(2,Ne):Math.max(.5,Ne),Qe=Math.pow(tt,1-Be),st=u.unproject(K.add(Se.mult(Be*Qe)).mult(He));u.setLocationAtPoint(u.renderWorldCopies?st.wrap():st,re)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},Be=>{this.terrain&&this._finalizeElevation(),this._afterEase(s,Be)},t),this}_prepareEase(t,s,u={}){this._moving=!0,s||u.moving||this.fire(new o.k("movestart",t)),this._zooming&&!u.zooming&&this.fire(new o.k("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new o.k("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new o.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(s-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=o.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const s=t.clone(),{center:u,zoom:p,pitch:g,bearing:b,elevation:E}=this.transformCameraUpdate(s);u&&(s.center=u),p!==void 0&&(s.zoom=p),g!==void 0&&(s.pitch=g),b!==void 0&&(s.bearing=b),E!==void 0&&(s.elevation=E),this.transform.apply(s)}_fireMoveEvents(t){this.fire(new o.k("move",t)),this._zooming&&this.fire(new o.k("zoom",t)),this._rotating&&this.fire(new o.k("rotate",t)),this._pitching&&this.fire(new o.k("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const u=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new o.k("zoomend",t)),p&&this.fire(new o.k("rotateend",t)),g&&this.fire(new o.k("pitchend",t)),this.fire(new o.k("moveend",t))}flyTo(t,s){if(!t.essential&&o.h.prefersReducedMotion){const Lt=o.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Lt,s)}this.stop(),t=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.bb},t);const u=this._getTransformForUpdate(),p=this.getZoom(),g=this.getBearing(),b=this.getPitch(),E=this.getPadding(),S="zoom"in t?o.ad(+t.zoom,u.minZoom,u.maxZoom):p,C="bearing"in t?this._normalizeBearing(t.bearing,g):g,M="pitch"in t?+t.pitch:b,N="padding"in t?t.padding:u.padding,j=u.zoomScale(S-p),re=o.P.convert(t.offset);let te=u.centerPoint.add(re);const oe=u.pointLocation(te),K=o.L.convert(t.center||oe);this._normalizeCenter(K);const Se=u.project(oe),Ne=u.project(K).sub(Se);let pe=t.curve;const De=Math.max(u.width,u.height),Fe=De/j,Be=Ne.mag();if("minZoom"in t){const Lt=o.ad(Math.min(t.minZoom,p,S),u.minZoom,u.maxZoom),Dr=De/u.zoomScale(Lt-p);pe=Math.sqrt(Dr/Be*2)}const He=pe*pe;function tt(Lt){const Dr=(Fe*Fe-De*De+(Lt?-1:1)*He*He*Be*Be)/(2*(Lt?Fe:De)*He*Be);return Math.log(Math.sqrt(Dr*Dr+1)-Dr)}function Qe(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function st(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const Rt=tt(!1);let ar=function(Lt){return st(Rt)/st(Rt+pe*Lt)},pt=function(Lt){return De*((st(Rt)*(Qe(Dr=Rt+pe*Lt)/st(Dr))-Qe(Rt))/He)/Be;var Dr},Gt=(tt(!0)-Rt)/pe;if(Math.abs(Be)<1e-6||!isFinite(Gt)){if(Math.abs(De-Fe)<1e-6)return this.easeTo(t,s);const Lt=Fe<De?-1:1;Gt=Math.abs(Math.log(Fe/De))/pe,pt=function(){return 0},ar=function(Dr){return Math.exp(Lt*pe*Dr)}}return t.duration="duration"in t?+t.duration:1e3*Gt/("screenSpeed"in t?+t.screenSpeed/pe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==C,this._pitching=M!==b,this._padding=!u.isPaddingEqual(N),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(K),this._ease(Lt=>{const Dr=Lt*Gt,ir=1/ar(Dr);u.zoom=Lt===1?S:p+u.scaleZoom(ir),this._rotating&&(u.bearing=o.B.number(g,C,Lt)),this._pitching&&(u.pitch=o.B.number(b,M,Lt)),this._padding&&(u.interpolatePadding(E,N,Lt),te=u.centerPoint.add(re)),this.terrain&&!t.freezeElevation&&this._updateElevation(Lt);const Kt=Lt===1?K:u.unproject(Se.add(Ne.mult(pt(Dr))).mult(ir));u.setLocationAtPoint(u.renderWorldCopies?Kt.wrap():Kt,te),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,s,u){u.animate===!1||u.duration===0?(t(1),s()):(this._easeStart=o.h.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=o.b5(t,-180,180);const u=Math.abs(t-s);return Math.abs(t-360-s)<u&&(t-=360),Math.abs(t+360-s)<u&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const u=t.lng-s.center.lng;t.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(o.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class vi{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=A.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=A.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){A.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const u=this._map._getUIString(`AttributionControl.${s}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.sourceCaches;for(const p in s){const g=s[p];if(g.used||g.usedForTerrain){const b=g.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter(p=>String(p).trim()),t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let b=g+1;b<t.length;b++)if(t[b].indexOf(p)>=0)return!1;return!0});const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class zr{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=A.create("div","maplibregl-ctrl");const s=A.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){A.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class El{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const pc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Bu=o.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Uu extends o.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const u={};for(const p of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))u[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),o.aS(p.posMatrix,0,o.N,0,o.N,0,1),this._tiles[p.key]=new Dn(p,this.tileSize));for(const p in this._tiles)u[p]||delete this._tiles[p]}freeRtt(t){for(const s in this._tiles){const u=this._tiles[s];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const u of this._renderableTilesKeys){const p=this._tiles[u].tileID;if(p.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),o.aS(g.posMatrix,0,o.N,0,o.N,0,1),s[u]=g}else if(p.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const b=p.canonical.z-t.canonical.z,E=p.canonical.x-(p.canonical.x>>b<<b),S=p.canonical.y-(p.canonical.y>>b<<b),C=o.N>>b;o.aS(g.posMatrix,0,C,0,C,0,1),o.$(g.posMatrix,g.posMatrix,[-E*C,-S*C,0]),s[u]=g}else if(t.canonical.isChildOf(p.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const b=t.canonical.z-p.canonical.z,E=t.canonical.x-(t.canonical.x>>b<<b),S=t.canonical.y-(t.canonical.y>>b<<b),C=o.N>>b;o.aS(g.posMatrix,0,o.N,0,o.N,0,1),o.$(g.posMatrix,g.posMatrix,[E*C,S*C,0]),o.a0(g.posMatrix,g.posMatrix,[1/2**b,1/2**b,0]),s[u]=g}}return s}getSourceTile(t,s){const u=this.sourceCache._source;let p=t.overscaledZ-this.deltaZoom;if(p>u.maxzoom&&(p=u.maxzoom),p<u.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&s)for(;p>=u.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(p--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class $u{constructor(t,s,u){this.painter=t,this.sourceCache=new Uu(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,u,p=o.N){var g;if(!(s>=0&&s<p&&u>=0&&u<p))return 0;const b=this.getTerrainData(t),E=(g=b.tile)===null||g===void 0?void 0:g.dem;if(!E)return 0;const S=function(te,oe,K){var Se=oe[0],Ne=oe[1];return te[0]=K[0]*Se+K[4]*Ne+K[12],te[1]=K[1]*Se+K[5]*Ne+K[13],te}([],[s/p*o.N,u/p*o.N],b.u_terrain_matrix),C=[S[0]*E.dim,S[1]*E.dim],M=Math.floor(C[0]),N=Math.floor(C[1]),j=C[0]-M,re=C[1]-N;return E.get(M,N)*(1-j)*(1-re)+E.get(M+1,N)*j*(1-re)+E.get(M,N+1)*(1-j)*re+E.get(M+1,N+1)*j*re}getElevationForLngLatZoom(t,s){const{tileID:u,mercatorX:p,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(u,p%o.N,g%o.N,o.N)}getElevation(t,s,u,p=o.N){return this.getDEMElevation(t,s,u,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,g=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new xe(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new xe(p,new o.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ao([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new xe(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s+s.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const p=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?g=t.canonical.z-p:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>g<<g),E=t.canonical.y-(t.canonical.y>>g<<g),S=o.bc(new Float64Array(16),[1/(o.N<<g),1/(o.N<<g),0]);o.$(S,S,[b*o.N,E*o.N,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,u=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new xe(s.context,{width:u,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new xe(s.context,{width:u,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,p,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,b=0;g<this._coordsTextureSize;g++)for(let E=0;E<this._coordsTextureSize;E++,b+=4)s[b+0]=255&E,s[b+1]=255&g,s[b+2]=E>>8<<4|g>>8,s[b+3]=0;const u=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new xe(t,u,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){const s=new Uint8Array(4),u=this.painter.context,p=u.gl;u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null);const g=s[0]+(s[2]>>4<<8),b=s[1]+((15&s[2])<<8),E=this.coordsIndex[255-s[3]],S=E&&this.sourceCache.getTileByID(E);if(!S)return null;const C=this._coordsTextureSize,M=(1<<S.tileID.canonical.z)*C;return new o.U(this._allowMercatorOverflow(t,(S.tileID.canonical.x*C+g)/M),(S.tileID.canonical.y*C+b)/M,this.getElevation(S.tileID,g,b,C))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new o.bd,u=new o.b0,p=this.meshSize,g=o.N/p,b=p*p;for(let N=0;N<=p;N++)for(let j=0;j<=p;j++)s.emplaceBack(j*g,N*g,0);for(let N=0;N<b;N+=p+1)for(let j=0;j<p;j++)u.emplaceBack(j+N,p+j+N+1,p+j+N+2),u.emplaceBack(j+N,p+j+N+2,j+N+1);const E=s.length,S=E+2*(p+1);for(const N of[0,1])for(let j=0;j<=p;j++)for(const re of[0,1])s.emplaceBack(j*g,N*o.N,re);for(let N=0;N<2*p;N+=2)u.emplaceBack(S+N,S+N+1,S+N+3),u.emplaceBack(S+N,S+N+3,S+N+2),u.emplaceBack(E+N,E+N+3,E+N+1),u.emplaceBack(E+N,E+N+2,E+N+3);const C=s.length,M=C+2*(p+1);for(const N of[0,1])for(let j=0;j<=p;j++)for(const re of[0,1])s.emplaceBack(N*o.N,j*g,re);for(let N=0;N<2*p;N+=2)u.emplaceBack(C+N,C+N+1,C+N+3),u.emplaceBack(C+N,C+N+3,C+N+2),u.emplaceBack(M+N,M+N+3,M+N+1),u.emplaceBack(M+N,M+N+2,M+N+3);return this._mesh={indexBuffer:t.createIndexBuffer(u),vertexBuffer:t.createVertexBuffer(s,Bu.members),segments:o.S.simpleSegment(0,0,s.length,u.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*o.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,s){var u;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(u=this.getMinMaxElevation(p).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=s.dem.min*this.exaggeration,u.maxElevation=s.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,s){const u=o.U.fromLngLat(t.wrap()),p=(1<<s)*o.N,g=u.x*p,b=u.y*p,E=Math.floor(g/o.N),S=Math.floor(b/o.N);return{tileID:new o.O(s,0,s,E,S),mercatorX:g,mercatorY:b}}_allowMercatorOverflow(t,s){const u=t.x<this.painter.width/2;let p=o.bf(s);const g=this.painter.transform.center.lng;return u&&Math.sign(p)>0&&Math.sign(g)<0||!u&&Math.sign(p)<0&&Math.sign(g)>0?(p=360*Math.sign(g)+p,o.G(p)):s}}class cp{constructor(t,s,u){this._context=t,this._size=s,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new xe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(u.texture),{id:t,fbo:s,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Qn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Tl{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new cp(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(u=>!t._layers[u].isHidden(s)),this._coordsDescendingInv={};for(const u in t.sourceCaches){this._coordsDescendingInv[u]={};const p=t.sourceCaches[u].getVisibleCoordinates();for(const g of p){const b=this.terrain.sourceCache.getTerrainCoords(g);for(const E in b)this._coordsDescendingInv[u][E]||(this._coordsDescendingInv[u][E]=[]),this._coordsDescendingInv[u][E].push(b[E])}}this._coordsDescendingInvStr={};for(const u of t._order){const p=t._layers[u],g=p.source;if(Qn[p.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const b in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][b]=this._coordsDescendingInv[g][b].map(E=>E.key).sort().join()}}for(const u of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[p][u.tileID.key];g&&g!==u.rttCoords[p]&&(u.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,u=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Qn[s]&&(this._prevType&&Qn[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!p))return!0;if(Qn[this._prevType]||Qn[s]&&p){this._prevType=s;const g=this._stacks.length-1,b=this._stacks[g]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(Or(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[g]){const C=this.pool.getObjectForId(E.rtt[g].id);if(C.stamp===E.rtt[g].stamp){this.pool.useObject(C);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),E.rtt[g]={id:S.id,stamp:S.stamp},u.context.bindFramebuffer.set(S.fbo.framebuffer),u.context.clear({color:o.aT.transparent,stencil:0}),u.currentStencilSource=void 0;for(let C=0;C<b.length;C++){const M=u.style._layers[b[C]],N=M.source?this._coordsDescendingInv[M.source][E.tileID.key]:[E.tileID];u.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),u._renderTileClippingMasks(M,N),u.renderLayer(u,u.style.sourceCaches[M.source],M,N),M.source&&(E.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][E.tileID.key])}}return Or(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Qn[s]}return!1}}const Bt=I,qt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ba=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},dc={showCompass:!0,showZoom:!0,visualizePitch:!1};class fc{constructor(t,s,u=!1){this.mousedown=b=>{this.startMouse(o.e({},b,{ctrlKey:!0,preventDefault:()=>b.preventDefault()}),A.mousePos(this.element,b)),A.addEventListener(window,"mousemove",this.mousemove),A.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.moveMouse(b,A.mousePos(this.element,b))},this.mouseup=b=>{this.mouseRotate.dragEnd(b),this.mousePitch&&this.mousePitch.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=A.touchPos(this.element,b.targetTouches)[0],this.startTouch(b,this._startPos),A.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=A.touchPos(this.element,b.targetTouches)[0],this.moveTouch(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=t.dragRotate._mouseRotate.getClickTolerance(),g=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Kn({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:b,clickTolerance:E,bearingDegreesPerPixelMoved:S=.8})=>{const C=new Jn;return new Ft({clickTolerance:E,move:(M,N)=>({bearingDelta:(N.x-M.x)*S}),moveStateManager:C,enable:b,assignEvents:Ba})})({clickTolerance:p,enable:!0}),this.map=t,u&&(this.mousePitch=Gr({clickTolerance:g,enable:!0}),this.touchPitch=(({enable:b,clickTolerance:E,pitchDegreesPerPixelMoved:S=-.5})=>{const C=new Jn;return new Ft({clickTolerance:E,move:(M,N)=>({pitchDelta:(N.y-M.y)*S}),moveStateManager:C,enable:b,assignEvents:Ba})})({clickTolerance:g,enable:!0})),A.addEventListener(s,"mousedown",this.mousedown),A.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),A.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),A.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),A.disableDrag()}moveMouse(t,s){const u=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(t,s)||{};if(p&&u.setBearing(u.getBearing()+p),this.mousePitch){const{pitchDelta:g}=this.mousePitch.dragMove(t,s)||{};g&&u.setPitch(u.getPitch()+g)}}moveTouch(t,s){const u=this.map,{bearingDelta:p}=this.touchRotate.dragMove(t,s)||{};if(p&&u.setBearing(u.getBearing()+p),this.touchPitch){const{pitchDelta:g}=this.touchPitch.dragMove(t,s)||{};g&&u.setPitch(u.getPitch()+g)}}off(){const t=this.element;A.removeEventListener(t,"mousedown",this.mousedown),A.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend),A.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){A.enableDrag(),A.removeEventListener(window,"mousemove",this.mousemove),A.removeEventListener(window,"mouseup",this.mouseup),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend)}}let tn;function mc(d,t,s){if(d=new o.L(d.lng,d.lat),t){const u=new o.L(d.lng-360,d.lat),p=new o.L(d.lng+360,d.lat),g=s.locationPoint(d).distSqr(t);s.locationPoint(u).distSqr(t)<g?d=u:s.locationPoint(p).distSqr(t)<g&&(d=p)}for(;Math.abs(d.lng-s.center.lng)>180;){const u=s.locationPoint(d);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;d.lng>s.center.lng?d.lng-=360:d.lng+=360}return d}const Ci={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vu(d,t,s){const u=d.classList;for(const p in Ci)u.remove(`maplibregl-${s}-anchor-${p}`);u.add(`maplibregl-${s}-anchor-${t}`)}class mo extends o.E{constructor(t){if(super(),this._onKeyPress=s=>{const u=s.code,p=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=s=>{const u=s.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=mc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),A.setTransform(this._element,`${Ci[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${p}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const b=this._map.unproject(this._pos),E=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=b.distanceTo(this._lngLat)>20*E?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=s=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=A.create("div"),this._element.setAttribute("aria-label","Map marker");const s=A.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${u}px`),s.setAttributeNS(null,"width",`${p}px`),s.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const g=A.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const b=A.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const E=A.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Se of S){const Ne=A.createNS("http://www.w3.org/2000/svg","ellipse");Ne.setAttributeNS(null,"opacity","0.04"),Ne.setAttributeNS(null,"cx","10.5"),Ne.setAttributeNS(null,"cy","5.80029008"),Ne.setAttributeNS(null,"rx",Se.rx),Ne.setAttributeNS(null,"ry",Se.ry),E.appendChild(Ne)}const C=A.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const M=A.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(M);const N=A.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const j=A.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(j);const re=A.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(6.0, 7.0)"),re.setAttributeNS(null,"fill","#FFFFFF");const te=A.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const oe=A.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#000000"),oe.setAttributeNS(null,"opacity","0.25"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962");const K=A.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),te.appendChild(oe),te.appendChild(K),b.appendChild(E),b.appendChild(C),b.appendChild(N),b.appendChild(re),b.appendChild(te),s.appendChild(b),s.setAttributeNS(null,"height",u*this._scale+"px"),s.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(s),this._offset=o.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Vu(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),A.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Zr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qr=0,Ko=!1;const Ua={maxWidth:100,unit:"metric"};function $a(d,t,s){const u=s&&s.maxWidth||100,p=d._container.clientHeight/2,g=d.unproject([0,p]),b=d.unproject([u,p]),E=g.distanceTo(b);if(s&&s.unit==="imperial"){const S=3.2808*E;S>5280?go(t,u,S/5280,d._getUIString("ScaleControl.Miles")):go(t,u,S,d._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?go(t,u,E/1852,d._getUIString("ScaleControl.NauticalMiles")):E>=1e3?go(t,u,E/1e3,d._getUIString("ScaleControl.Kilometers")):go(t,u,E,d._getUIString("ScaleControl.Meters"))}function go(d,t,s,u){const p=function(g){const b=Math.pow(10,`${Math.floor(g)}`.length-1);let E=g/b;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(S){const C=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*C)/C}(E),b*E}(s);d.style.width=t*(p/s)+"px",d.innerHTML=`${p}&nbsp;${u}`}const gc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},yc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qo(d){if(d){if(typeof d=="number"){const t=Math.round(Math.abs(d)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,d),"top-left":new o.P(t,t),"top-right":new o.P(-t,t),bottom:new o.P(0,-d),"bottom-left":new o.P(t,-t),"bottom-right":new o.P(-t,-t),left:new o.P(d,0),right:new o.P(-d,0)}}if(d instanceof o.P||Array.isArray(d)){const t=o.P.convert(d);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.P.convert(d.center||[0,0]),top:o.P.convert(d.top||[0,0]),"top-left":o.P.convert(d["top-left"]||[0,0]),"top-right":o.P.convert(d["top-right"]||[0,0]),bottom:o.P.convert(d.bottom||[0,0]),"bottom-left":o.P.convert(d["bottom-left"]||[0,0]),"bottom-right":o.P.convert(d["bottom-right"]||[0,0]),left:o.P.convert(d.left||[0,0]),right:o.P.convert(d.right||[0,0])}}return Qo(new o.P(0,0))}const _c={extend:(d,...t)=>o.e(d,...t),run(d){d()},logToElement(d,t=!1,s="log"){const u=window.document.getElementById(s);u&&(t&&(u.innerHTML=""),u.innerHTML+=`<br>${d}`)}},vc=I;class br{static get version(){return vc}static get workerCount(){return Nn.workerCount}static set workerCount(t){Nn.workerCount=t}static get maxParallelImageRequests(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){o.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return o.c.WORKER_URL}static set workerUrl(t){o.c.WORKER_URL=t}static addProtocol(t,s){o.c.REGISTERED_PROTOCOLS[t]=s}static removeProtocol(t){delete o.c.REGISTERED_PROTOCOLS[t]}}return br.Map=class extends zu{constructor(d){if(o.bg.mark(o.bh.create),(d=o.e({},qt,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Yo(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._cooperativeGestures=d.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new El,this._controls=[],this._mapId=o.a2(),this._locale=o.e({},pc,d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new Oe(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const s=Qi(u=>{this._trackResize&&!this._removed&&this.resize(u)._update()},50);this._resizeObserver=new ResizeObserver(u=>{t?s(u):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new hc(this,d),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=d.hash&&new po(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,o.e({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new vi({customAttribution:d.customAttribution})),d.maplibreLogo&&this.addControl(new zr,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new o.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new o.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new o.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=d.onAdd(this);this._controls.push(d);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,t,s,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,t,s,u)}resize(d){var t;const s=this._containerDimensions(),u=s[0],p=s[1],g=this._getClampedPixelRatio(u,p);if(this._resizeCanvas(u,p,g),this.painter.resize(u,p,g),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const S=this._getClampedPixelRatio(u,p);this._resizeCanvas(u,p,S),this.painter.resize(u,p,S)}this.transform.resize(u,p),(t=this._requestedCameraState)===null||t===void 0||t.resize(u,p);const b=!this._moving;return b&&(this.stop(),this.fire(new o.k("movestart",d)).fire(new o.k("move",d))),this.fire(new o.k("resize",d)),b&&this.fire(new o.k("moveend",d)),this}_getClampedPixelRatio(d,t){const{0:s,1:u}=this._maxCanvasSize,p=this.getPixelRatio(),g=d*p,b=t*p;return Math.min(g>s?s/g:1,b>u?u/b:1)*p}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(we.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(d){return this.transform.locationPoint(o.L.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(o.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,t,s){if(d==="mouseenter"||d==="mouseover"){let u=!1;return{layer:t,listener:s,delegates:{mousemove:g=>{const b=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];b.length?u||(u=!0,s.call(this,new Yn(d,this,g.originalEvent,{features:b}))):u=!1},mouseout:()=>{u=!1}}}}if(d==="mouseleave"||d==="mouseout"){let u=!1;return{layer:t,listener:s,delegates:{mousemove:b=>{(this.getLayer(t)?this.queryRenderedFeatures(b.point,{layers:[t]}):[]).length?u=!0:u&&(u=!1,s.call(this,new Yn(d,this,b.originalEvent)))},mouseout:b=>{u&&(u=!1,s.call(this,new Yn(d,this,b.originalEvent)))}}}}{const u=p=>{const g=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];g.length&&(p.features=g,s.call(this,p),delete p.features)};return{layer:t,listener:s,delegates:{[d]:u}}}}on(d,t,s){if(s===void 0)return super.on(d,t);const u=this._createDelegatedListener(d,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(d,t,s){if(s===void 0)return super.once(d,t);const u=this._createDelegatedListener(d,t,s);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(d,t,s){return s===void 0?super.off(d,t):(this._delegatedListeners&&this._delegatedListeners[d]&&(u=>{const p=this._delegatedListeners[d];for(let g=0;g<p.length;g++){const b=p[g];if(b.layer===t&&b.listener===s){for(const E in b.delegates)this.off(E,b.delegates[E]);return p.splice(g,1),this}}})(),this)}queryRenderedFeatures(d,t){if(!this.style)return[];let s;const u=d instanceof o.P||Array.isArray(d),p=u?d:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:d)||{},p instanceof o.P||typeof p[0]=="number")s=[o.P.convert(p)];else{const g=o.P.convert(p[0]),b=o.P.convert(p[1]);s=[g,new o.P(b.x,g.y),b,new o.P(g.x,b.y),g]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}setStyle(d,t){return(t=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(d,t))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new fn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,t,s):this.style.loadJSON(d,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new fn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if(typeof d=="string"){const s=this._requestManager.transformRequest(d,me.Style);o.f(s,(u,p)=>{u?this.fire(new o.j(u)):p&&this._updateDiff(p,t)})}else typeof d=="object"&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d,t)&&this._update(!0)}catch(s){o.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style.sourceCaches[d];if(t!==void 0)return t.loaded();this.fire(new o.j(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const t=this.style.sourceCaches[d.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);for(const s in this.style._layers){const u=this.style._layers[s];u.type==="hillshade"&&u.source===d.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new $u(this.painter,t,d),this.painter.renderToTexture=new Tl(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==d.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:d})),this}getTerrain(){var d,t;return(t=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const t in d){const s=d[t]._tiles;for(const u in s){const p=s[u];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(d,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,s)}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,t,s={}){const{pixelRatio:u=1,sdf:p=!1,stretchX:g,stretchY:b,content:E}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:C,data:M}=t,N=t;return this.style.addImage(d,{data:new o.R({width:S,height:C},new Uint8Array(M)),pixelRatio:u,stretchX:g,stretchY:b,content:E,sdf:p,version:0,userImage:N}),N.onAdd&&N.onAdd(this,d),this}}{const{width:S,height:C,data:M}=o.h.getImageData(t);this.style.addImage(d,{data:new o.R({width:S,height:C},M),pixelRatio:u,stretchX:g,stretchY:b,content:E,sdf:p,version:0})}}updateImage(d,t){const s=this.style.getImage(d);if(!s)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||o.a(t)?o.h.getImageData(t):t,{width:p,height:g,data:b}=u;if(p===void 0||g===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||g!==s.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||o.a(t));return s.data.replace(b,E),this.style.updateImage(d,s),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){V.getImage(this._requestManager.transformRequest(d,me.Image),t)}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,t,s){return this.style.setLayerZoomRange(d,t,s),this._update(!0)}setFilter(d,t,s={}){return this.style.setFilter(d,t,s),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,s,u={}){return this.style.setPaintProperty(d,t,s,u),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,s,u={}){return this.style.setLayoutProperty(d,t,s,u),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setGlyphs(d,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,t,s,u=>{u||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,t,s=>{s||this._update(!0)}),this}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.clientWidth||400,t=this._container.clientHeight||300),[d,t]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const t=this._canvasContainer=A.create("div","maplibregl-canvas-container",d);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=A.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),u=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],u);const p=this._controlContainer=A.create("div","maplibregl-control-container",d),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{g[b]=A.create("div",`maplibregl-ctrl-${b} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=A.create("div","maplibregl-cooperative-gesture-screen",this._container);let d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${d}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){A.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(d,t,s){this._canvas.width=Math.floor(s*d),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{t={requestedAttributes:d},u&&(t.statusMessage=u.statusMessage,t.type=u.type)},{once:!0});const s=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!s){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new Es(s,this.transform),L.testSupport(s)}_onCooperativeGesture(d,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,g=o.h.now();this.style.zoomHistory.update(p,g);const b=new o.a8(p,{now:g,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),E=b.crossFadingFactor();E===1&&E===this._crossFadingFactor||(s=!0,this._crossFadingFactor=E),this.style.update(b)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bg.mark(o.bh.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,o.bg.mark(o.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),A.remove(this._canvasContainer),A.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.bg.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.h.frame(d=>{o.bg.frame(d),this._frame=null,this._render(d)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return Bt}getCameraTargetElevation(){return this.transform.elevation}},br.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const u=this._map._getUIString(`NavigationControl.${s}`);t.title=u,t.setAttribute("aria-label",u)},this.options=o.e({},dc,d),this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),A.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),A.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=A.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){A.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const s=A.create("button",d,this._container);return s.type="button",s.addEventListener("click",t),s}},br.GeolocateControl=class extends o.E{constructor(d){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new o.L(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,p=this._map.getBearing(),g=o.e({bearing:p},this.options.fitBoundsOptions),b=we.fromLngLat(s,u);this._map.fitBounds(b,g,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new o.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Ko)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=A.create("button","maplibregl-ctrl-geolocate",this._container),A.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new mo({element:this._dotElement}),this._circleElement=A.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new mo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},Zr,d)}onAdd(d){return this._map=d,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,s=!1){tn===void 0||s?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(u=>{tn=u.state!=="denied",t(tn)}).catch(()=>{tn=!!window.navigator.geolocation,t(tn)}):(tn=!!window.navigator.geolocation,t(tn)):t(tn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),A.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,qr=0,Ko=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),s=d.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),t=d.getSouthEast(),s=d.getNorthEast(),u=t.distanceTo(s),p=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qr--,Ko=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qr++,qr>1?(d={maximumAge:6e5,timeout:0},Ko=!0):(d=this.options.positionOptions,Ko=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},br.AttributionControl=vi,br.LogoControl=zr,br.ScaleControl=class{constructor(d){this._onMove=()=>{$a(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,$a(this._map,this._container,this.options)},this.options=o.e({},Ua,d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){A.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},br.FullscreenControl=class extends o.E{constructor(d={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){A.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=A.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);A.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},br.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=d}onAdd(d){return this._map=d,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=A.create("button","maplibregl-ctrl-terrain",this._container),A.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){A.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},br.Popup=class extends o.E{constructor(d){super(),this.remove=()=>(this._content&&A.remove(this._content),this._container&&(A.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=A.create("div","maplibregl-popup",this._map.getContainer()),this._tip=A.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const s=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let u=this.options.anchor;const p=Qo(this.options.offset);if(!u){const b=this._container.offsetWidth,E=this._container.offsetHeight;let S;S=s.y+p.bottom.y<E?["top"]:s.y>this._map.transform.height-E?["bottom"]:[],s.x<b/2?S.push("left"):s.x>this._map.transform.width-b/2&&S.push("right"),u=S.length===0?"bottom":S.join("-")}const g=s.add(p[u]).round();A.setTransform(this._container,`${Ci[u]} translate(${g.x}px,${g.y}px)`),Vu(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(gc),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=o.L.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=d;u=s.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=A.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=A.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(yc);d&&d.focus()}},br.Marker=mo,br.Style=fn,br.LngLat=o.L,br.LngLatBounds=we,br.Point=o.P,br.MercatorCoordinate=o.U,br.Evented=o.E,br.AJAXError=o.bi,br.config=o.c,br.CanvasSource=Yt,br.GeoJSONSource=ot,br.ImageSource=jt,br.RasterDEMTileSource=Mt,br.RasterTileSource=St,br.VectorTileSource=je,br.VideoSource=Qt,br.setRTLTextPlugin=o.bj,br.getRTLTextPluginStatus=o.bk,br.prewarm=function(){ds().acquire(sr)},br.clearPrewarmedResources=function(){const d=Ln;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(sr),Ln=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_c.extend(br,{isSafari:o.ac,getPerformanceMetrics:o.bg.getPerformanceMetrics}),br});var w=_;return w})})(Vb);const sS=$b(Jd);var pu={},jb={get exports(){return pu},set exports(i){pu=i}},Bg;function qb(){if(Bg)return pu;Bg=1;var i=typeof Reflect=="object"?Reflect:null,l=i&&typeof i.apply=="function"?i.apply:function(de,ce,Ae){return Function.prototype.apply.call(de,ce,Ae)},c;i&&typeof i.ownKeys=="function"?c=i.ownKeys:Object.getOwnPropertySymbols?c=function(de){return Object.getOwnPropertyNames(de).concat(Object.getOwnPropertySymbols(de))}:c=function(de){return Object.getOwnPropertyNames(de)};function f(ne){console&&console.warn&&console.warn(ne)}var _=Number.isNaN||function(de){return de!==de};function v(){v.init.call(this)}jb.exports=v,pu.once=me,v.EventEmitter=v,v.prototype._events=void 0,v.prototype._eventsCount=0,v.prototype._maxListeners=void 0;var w=10;function o(ne){if(typeof ne!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof ne)}Object.defineProperty(v,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(ne){if(typeof ne!="number"||ne<0||_(ne))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+ne+".");w=ne}}),v.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},v.prototype.setMaxListeners=function(de){if(typeof de!="number"||de<0||_(de))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+de+".");return this._maxListeners=de,this};function I(ne){return ne._maxListeners===void 0?v.defaultMaxListeners:ne._maxListeners}v.prototype.getMaxListeners=function(){return I(this)},v.prototype.emit=function(de){for(var ce=[],Ae=1;Ae<arguments.length;Ae++)ce.push(arguments[Ae]);var Me=de==="error",Y=this._events;if(Y!==void 0)Me=Me&&Y.error===void 0;else if(!Me)return!1;if(Me){var xe;if(ce.length>0&&(xe=ce[0]),xe instanceof Error)throw xe;var Ge=new Error("Unhandled error."+(xe?" ("+xe.message+")":""));throw Ge.context=xe,Ge}var Ye=Y[de];if(Ye===void 0)return!1;if(typeof Ye=="function")l(Ye,this,ce);else for(var ct=Ye.length,wt=ie(Ye,ct),Ae=0;Ae<ct;++Ae)l(wt[Ae],this,ce);return!0};function A(ne,de,ce,Ae){var Me,Y,xe;if(o(ce),Y=ne._events,Y===void 0?(Y=ne._events=Object.create(null),ne._eventsCount=0):(Y.newListener!==void 0&&(ne.emit("newListener",de,ce.listener?ce.listener:ce),Y=ne._events),xe=Y[de]),xe===void 0)xe=Y[de]=ce,++ne._eventsCount;else if(typeof xe=="function"?xe=Y[de]=Ae?[ce,xe]:[xe,ce]:Ae?xe.unshift(ce):xe.push(ce),Me=I(ne),Me>0&&xe.length>Me&&!xe.warned){xe.warned=!0;var Ge=new Error("Possible EventEmitter memory leak detected. "+xe.length+" "+String(de)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ge.name="MaxListenersExceededWarning",Ge.emitter=ne,Ge.type=de,Ge.count=xe.length,f(Ge)}return ne}v.prototype.addListener=function(de,ce){return A(this,de,ce,!1)},v.prototype.on=v.prototype.addListener,v.prototype.prependListener=function(de,ce){return A(this,de,ce,!0)};function L(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function R(ne,de,ce){var Ae={fired:!1,wrapFn:void 0,target:ne,type:de,listener:ce},Me=L.bind(Ae);return Me.listener=ce,Ae.wrapFn=Me,Me}v.prototype.once=function(de,ce){return o(ce),this.on(de,R(this,de,ce)),this},v.prototype.prependOnceListener=function(de,ce){return o(ce),this.prependListener(de,R(this,de,ce)),this},v.prototype.removeListener=function(de,ce){var Ae,Me,Y,xe,Ge;if(o(ce),Me=this._events,Me===void 0)return this;if(Ae=Me[de],Ae===void 0)return this;if(Ae===ce||Ae.listener===ce)--this._eventsCount===0?this._events=Object.create(null):(delete Me[de],Me.removeListener&&this.emit("removeListener",de,Ae.listener||ce));else if(typeof Ae!="function"){for(Y=-1,xe=Ae.length-1;xe>=0;xe--)if(Ae[xe]===ce||Ae[xe].listener===ce){Ge=Ae[xe].listener,Y=xe;break}if(Y<0)return this;Y===0?Ae.shift():le(Ae,Y),Ae.length===1&&(Me[de]=Ae[0]),Me.removeListener!==void 0&&this.emit("removeListener",de,Ge||ce)}return this},v.prototype.off=v.prototype.removeListener,v.prototype.removeAllListeners=function(de){var ce,Ae,Me;if(Ae=this._events,Ae===void 0)return this;if(Ae.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Ae[de]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Ae[de]),this;if(arguments.length===0){var Y=Object.keys(Ae),xe;for(Me=0;Me<Y.length;++Me)xe=Y[Me],xe!=="removeListener"&&this.removeAllListeners(xe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(ce=Ae[de],typeof ce=="function")this.removeListener(de,ce);else if(ce!==void 0)for(Me=ce.length-1;Me>=0;Me--)this.removeListener(de,ce[Me]);return this};function P(ne,de,ce){var Ae=ne._events;if(Ae===void 0)return[];var Me=Ae[de];return Me===void 0?[]:typeof Me=="function"?ce?[Me.listener||Me]:[Me]:ce?V(Me):ie(Me,Me.length)}v.prototype.listeners=function(de){return P(this,de,!0)},v.prototype.rawListeners=function(de){return P(this,de,!1)},v.listenerCount=function(ne,de){return typeof ne.listenerCount=="function"?ne.listenerCount(de):q.call(ne,de)},v.prototype.listenerCount=q;function q(ne){var de=this._events;if(de!==void 0){var ce=de[ne];if(typeof ce=="function")return 1;if(ce!==void 0)return ce.length}return 0}v.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]};function ie(ne,de){for(var ce=new Array(de),Ae=0;Ae<de;++Ae)ce[Ae]=ne[Ae];return ce}function le(ne,de){for(;de+1<ne.length;de++)ne[de]=ne[de+1];ne.pop()}function V(ne){for(var de=new Array(ne.length),ce=0;ce<de.length;++ce)de[ce]=ne[ce].listener||ne[ce];return de}function me(ne,de){return new Promise(function(ce,Ae){function Me(xe){ne.removeListener(de,Y),Ae(xe)}function Y(){typeof ne.removeListener=="function"&&ne.removeListener("error",Me),ce([].slice.call(arguments))}Pe(ne,de,Y,{once:!0}),de!=="error"&&Oe(ne,Me,{once:!0})})}function Oe(ne,de,ce){typeof ne.on=="function"&&Pe(ne,"error",de,ce)}function Pe(ne,de,ce,Ae){if(typeof ne.on=="function")Ae.once?ne.once(de,ce):ne.on(de,ce);else if(typeof ne.addEventListener=="function")ne.addEventListener(de,function Me(Y){Ae.once&&ne.removeEventListener(de,Me),ce(Y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof ne)}return pu}function yu(i){return yu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},yu(i)}function Gb(i,l){if(yu(i)!=="object"||i===null)return i;var c=i[Symbol.toPrimitive];if(c!==void 0){var f=c.call(i,l||"default");if(yu(f)!=="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(i)}function Zb(i){var l=Gb(i,"string");return yu(l)==="symbol"?l:String(l)}function Hb(i,l,c){return l=Zb(l),l in i?Object.defineProperty(i,l,{value:c,enumerable:!0,configurable:!0,writable:!0}):i[l]=c,i}function Ug(i,l){var c=Object.keys(i);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(i);l&&(f=f.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),c.push.apply(c,f)}return c}function $g(i){for(var l=1;l<arguments.length;l++){var c=arguments[l]!=null?arguments[l]:{};l%2?Ug(Object(c),!0).forEach(function(f){Hb(i,f,c[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(c)):Ug(Object(c)).forEach(function(f){Object.defineProperty(i,f,Object.getOwnPropertyDescriptor(c,f))})}return i}function _i(i){return"Minified Redux error #"+i+"; visit https://redux.js.org/Errors?code="+i+" for the full message or use the non-minified dev environment for full errors. "}var Vg=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),ed=function(){return Math.random().toString(36).substring(7).split("").join(".")},Dh={INIT:"@@redux/INIT"+ed(),REPLACE:"@@redux/REPLACE"+ed(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ed()}};function Wb(i){if(typeof i!="object"||i===null)return!1;for(var l=i;Object.getPrototypeOf(l)!==null;)l=Object.getPrototypeOf(l);return Object.getPrototypeOf(i)===l}function Xb(i,l,c){var f;if(typeof l=="function"&&typeof c=="function"||typeof c=="function"&&typeof arguments[3]=="function")throw new Error(_i(0));if(typeof l=="function"&&typeof c>"u"&&(c=l,l=void 0),typeof c<"u"){if(typeof c!="function")throw new Error(_i(1));return c(Xb)(i,l)}if(typeof i!="function")throw new Error(_i(2));var _=i,v=l,w=[],o=w,I=!1;function A(){o===w&&(o=w.slice())}function L(){if(I)throw new Error(_i(3));return v}function R(le){if(typeof le!="function")throw new Error(_i(4));if(I)throw new Error(_i(5));var V=!0;return A(),o.push(le),function(){if(V){if(I)throw new Error(_i(6));V=!1,A();var Oe=o.indexOf(le);o.splice(Oe,1),w=null}}}function P(le){if(!Wb(le))throw new Error(_i(7));if(typeof le.type>"u")throw new Error(_i(8));if(I)throw new Error(_i(9));try{I=!0,v=_(v,le)}finally{I=!1}for(var V=w=o,me=0;me<V.length;me++){var Oe=V[me];Oe()}return le}function q(le){if(typeof le!="function")throw new Error(_i(10));_=le,P({type:Dh.REPLACE})}function ie(){var le,V=R;return le={subscribe:function(Oe){if(typeof Oe!="object"||Oe===null)throw new Error(_i(11));function Pe(){Oe.next&&Oe.next(L())}Pe();var ne=V(Pe);return{unsubscribe:ne}}},le[Vg]=function(){return this},le}return P({type:Dh.INIT}),f={dispatch:P,subscribe:R,getState:L,replaceReducer:q},f[Vg]=ie,f}function Yb(i){Object.keys(i).forEach(function(l){var c=i[l],f=c(void 0,{type:Dh.INIT});if(typeof f>"u")throw new Error(_i(12));if(typeof c(void 0,{type:Dh.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(_i(13))})}function oS(i){for(var l=Object.keys(i),c={},f=0;f<l.length;f++){var _=l[f];typeof i[_]=="function"&&(c[_]=i[_])}var v=Object.keys(c),w;try{Yb(c)}catch(o){w=o}return function(I,A){if(I===void 0&&(I={}),w)throw w;for(var L=!1,R={},P=0;P<v.length;P++){var q=v[P],ie=c[q],le=I[q],V=ie(le,A);if(typeof V>"u")throw A&&A.type,new Error(_i(14));R[q]=V,L=L||V!==le}return L=L||v.length!==Object.keys(I).length,L?R:I}}function Jb(){for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return l.length===0?function(f){return f}:l.length===1?l[0]:l.reduce(function(f,_){return function(){return f(_.apply(void 0,arguments))}})}function aS(){for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return function(f){return function(){var _=f.apply(void 0,arguments),v=function(){throw new Error(_i(15))},w={getState:_.getState,dispatch:function(){return v.apply(void 0,arguments)}},o=l.map(function(I){return I(w)});return v=Jb.apply(void 0,o)(_.dispatch),$g($g({},_),{},{dispatch:v})}}}var Kb=/[^a-z0-9\-#$%&'*+.^_`|~]/i;function Bc(i){if(typeof i!="string"&&(i=String(i)),Kb.test(i)||i.trim()==="")throw new TypeError("Invalid character in header field name");return i.toLowerCase()}function Qb(i){return typeof i!="string"&&(i=String(i)),i}var as=Symbol("normalizedHeaders"),ph=Symbol("rawHeaderNames"),jg,qg,Tu=class{constructor(i){this[jg]={},this[qg]=new Map,["Headers","HeadersPolyfill"].includes(i==null?void 0:i.constructor.name)||i instanceof Tu?i.forEach((c,f)=>{this.append(f,c)},this):Array.isArray(i)?i.forEach(([l,c])=>{this.append(l,Array.isArray(c)?c.join(", "):c)}):i&&Object.getOwnPropertyNames(i).forEach(l=>{const c=i[l];this.append(l,Array.isArray(c)?c.join(", "):c)})}[(jg=as,qg=ph,Symbol.iterator)](){return this.entries()}*keys(){for(const i of Object.keys(this[as]))yield i}*values(){for(const i of Object.values(this[as]))yield i}*entries(){for(const i of Object.keys(this[as]))yield[i,this.get(i)]}get(i){return this[as][Bc(i)]||null}set(i,l){const c=Bc(i);this[as][c]=Qb(l),this[ph].set(c,i)}append(i,l){const c=Bc(i);let f=this.has(c)?`${this.get(c)}, ${l}`:l;this.set(i,f)}delete(i){if(!this.has(i))return;const l=Bc(i);delete this[as][l],this[ph].delete(l)}all(){return this[as]}raw(){const i={};for(const[l,c]of this.entries())i[this[ph].get(l)]=c;return i}has(i){return this[as].hasOwnProperty(Bc(i))}forEach(i,l){for(const c in this[as])this[as].hasOwnProperty(c)&&i.call(l,this[as][c],c,this)}};function G_(i){const l=[];return i.forEach((c,f)=>{const _=c.includes(",")?c.split(",").map(v=>v.trim()):c;l.push([f,_])}),l}function ew(i){return G_(i).map(([f,_])=>{const v=[].concat(_);return`${f}: ${v.join(", ")}`}).join(`\r
`)}var tw=["user-agent"];function rw(i){const l={};return i.forEach((c,f)=>{const _=!tw.includes(f.toLowerCase())&&c.includes(",");l[f]=_?c.split(",").map(v=>v.trim()):c}),l}function nw(i){return i.trim().split(/[\r\n]+/).reduce((c,f)=>{if(f.trim()==="")return c;const _=f.split(": "),v=_.shift(),w=_.join(": ");return c.append(v,w),c},new Tu)}function iw(i){const l=new Tu;return i.forEach(([c,f])=>{[].concat(f).forEach(v=>{l.append(c,v)})}),l}function uf(i,l,c){return Object.keys(i).reduce((f,_)=>l(f,_,i[_]),c)}function sw(i){return uf(i,(l,c,f)=>([].concat(f).filter(Boolean).forEach(v=>{l.append(c,v)}),l),new Tu)}function ow(i){return i.map(([l,c])=>[l,[].concat(c).join(", ")])}function aw(i){return uf(i,(l,c,f)=>(l[c]=[].concat(f).join(", "),l),{})}const lw=Object.freeze(Object.defineProperty({__proto__:null,Headers:Tu,flattenHeadersList:ow,flattenHeadersObject:aw,headersToList:G_,headersToObject:rw,headersToString:ew,listToHeaders:iw,objectToHeaders:sw,reduceHeadersObject:uf,stringToHeaders:nw},Symbol.toStringTag,{value:"Module"})),ls=cf(lw);var dh={};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var Gg;function td(){if(Gg)return dh;Gg=1,dh.parse=f,dh.serialize=_;var i=decodeURIComponent,l=encodeURIComponent,c=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function f(w,o){if(typeof w!="string")throw new TypeError("argument str must be a string");for(var I={},A=o||{},L=w.split(";"),R=A.decode||i,P=0;P<L.length;P++){var q=L[P],ie=q.indexOf("=");if(!(ie<0)){var le=q.substring(0,ie).trim();if(I[le]==null){var V=q.substring(ie+1,q.length).trim();V[0]==='"'&&(V=V.slice(1,-1)),I[le]=v(V,R)}}}return I}function _(w,o,I){var A=I||{},L=A.encode||l;if(typeof L!="function")throw new TypeError("option encode is invalid");if(!c.test(w))throw new TypeError("argument name is invalid");var R=L(o);if(R&&!c.test(R))throw new TypeError("argument val is invalid");var P=w+"="+R;if(A.maxAge!=null){var q=A.maxAge-0;if(isNaN(q)||!isFinite(q))throw new TypeError("option maxAge is invalid");P+="; Max-Age="+Math.floor(q)}if(A.domain){if(!c.test(A.domain))throw new TypeError("option domain is invalid");P+="; Domain="+A.domain}if(A.path){if(!c.test(A.path))throw new TypeError("option path is invalid");P+="; Path="+A.path}if(A.expires){if(typeof A.expires.toUTCString!="function")throw new TypeError("option expires is invalid");P+="; Expires="+A.expires.toUTCString()}if(A.httpOnly&&(P+="; HttpOnly"),A.secure&&(P+="; Secure"),A.sameSite){var ie=typeof A.sameSite=="string"?A.sameSite.toLowerCase():A.sameSite;switch(ie){case!0:P+="; SameSite=Strict";break;case"lax":P+="; SameSite=Lax";break;case"strict":P+="; SameSite=Strict";break;case"none":P+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return P}function v(w,o){try{return o(w)}catch{return w}}return dh}var zl={},cw={get exports(){return zl},set exports(i){zl=i}};(function(i,l){(function(c,f){f(l)})(yt,function(c){function f(){return typeof navigator<"u"&&navigator.product==="ReactNative"?!0:!!(typeof process<"u"&&process.versions&&process.versions.node)}c.isNodeProcess=f,Object.defineProperty(c,"__esModule",{value:!0})})})(cw,zl);var du={},uw={get exports(){return du},set exports(i){du=i}},Zg;function hw(){return Zg||(Zg=1,function(i,l){var c=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof yt<"u")return yt;throw new Error("unable to locate global object")},f=c();i.exports=l=f.fetch,f.fetch&&(l.default=f.fetch.bind(yt)),l.Headers=f.Headers,l.Request=f.Request,l.Response=f.Response}(uw,du)),du}var rd={},nd={},Uc={},Hg;function Z_(){if(Hg)return Uc;Hg=1,Object.defineProperty(Uc,"__esModule",{value:!0}),Uc.format=void 0;var i=/(%?)(%([sdjo]))/g;function l(f,_){switch(_){case"s":return f;case"d":case"i":return Number(f);case"j":return JSON.stringify(f);case"o":{if(typeof f=="string")return f;var v=JSON.stringify(f);return v==="{}"||v==="[]"||/^\[object .+?\]$/.test(v)?f:v}}}function c(f){for(var _=[],v=1;v<arguments.length;v++)_[v-1]=arguments[v];if(_.length===0)return f;var w=0,o=f.replace(i,function(I,A,L,R){var P=_[w],q=l(P,R);return A?I:(w++,q)});return w<_.length&&(o+=" "+_.slice(w).join(" ")),o=o.replace(/%{2,2}/g,"%"),o}return Uc.format=c,Uc}var Wg;function pw(){return Wg||(Wg=1,function(i){var l=yt&&yt.__extends||function(){var A=function(L,R){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,q){P.__proto__=q}||function(P,q){for(var ie in q)Object.prototype.hasOwnProperty.call(q,ie)&&(P[ie]=q[ie])},A(L,R)};return function(L,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");A(L,R);function P(){this.constructor=L}L.prototype=R===null?Object.create(R):(P.prototype=R.prototype,new P)}}(),c=yt&&yt.__spreadArray||function(A,L){for(var R=0,P=L.length,q=A.length;R<P;R++,q++)A[q]=L[R];return A};Object.defineProperty(i,"__esModule",{value:!0}),i.invariant=i.createInvariantWith=i.InvariantError=void 0;var f=Z_(),_=2;function v(A){if(A.stack){var L=A.stack.split(`
`);L.splice(1,_),A.stack=L.join(`
`)}}var w=function(A){l(L,A);function L(R){for(var P=[],q=1;q<arguments.length;q++)P[q-1]=arguments[q];var ie=A.call(this,R)||this;return ie.message=R,ie.name="Invariant Violation",ie.message=f.format.apply(void 0,c([R],P)),v(ie),ie}return L}(Error);i.InvariantError=w;function o(A){var L=function(R,P){for(var q=[],ie=2;ie<arguments.length;ie++)q[ie-2]=arguments[ie];if(!R){var le=f.format.apply(void 0,c([P],q)),V=!!A.prototype.name,me=V?new A(le):A(le);throw v(me),me}};return L}i.createInvariantWith=o;function I(A){for(var L=[],R=1;R<arguments.length;R++)L[R-1]=arguments[R];return o(A).apply(void 0,L)}i.invariant=o(w),i.invariant.as=I}(nd)),nd}var Xg;function la(){return Xg||(Xg=1,function(i){var l=yt&&yt.__createBinding||(Object.create?function(f,_,v,w){w===void 0&&(w=v),Object.defineProperty(f,w,{enumerable:!0,get:function(){return _[v]}})}:function(f,_,v,w){w===void 0&&(w=v),f[w]=_[v]}),c=yt&&yt.__exportStar||function(f,_){for(var v in f)v!=="default"&&!Object.prototype.hasOwnProperty.call(_,v)&&l(_,f,v)};Object.defineProperty(i,"__esModule",{value:!0}),c(pw(),i),c(Z_(),i)}(rd)),rd}var fh={},mh={},Yg;function dw(){return Yg||(Yg=1,Object.defineProperty(mh,"__esModule",{value:!0}),mh.until=async i=>{try{return[null,await i().catch(c=>{throw c})]}catch(l){return[l,null]}}),mh}var Jg;function lu(){if(Jg)return fh;Jg=1,Object.defineProperty(fh,"__esModule",{value:!0});var i=dw();return fh.until=i.until,fh}var id={},$c={},Kg;function hf(){return Kg||(Kg=1,Object.defineProperty($c,"__esModule",{value:!0}),$c.IS_PATCHED_MODULE=void 0,$c.IS_PATCHED_MODULE=Symbol("isPatchedModule")),$c}var sd={},fu={},fw={get exports(){return fu},set exports(i){fu=i}},od,Qg;function mw(){if(Qg)return od;Qg=1;var i=1e3,l=i*60,c=l*60,f=c*24,_=f*7,v=f*365.25;od=function(L,R){R=R||{};var P=typeof L;if(P==="string"&&L.length>0)return w(L);if(P==="number"&&isFinite(L))return R.long?I(L):o(L);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(L))};function w(L){if(L=String(L),!(L.length>100)){var R=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(L);if(R){var P=parseFloat(R[1]),q=(R[2]||"ms").toLowerCase();switch(q){case"years":case"year":case"yrs":case"yr":case"y":return P*v;case"weeks":case"week":case"w":return P*_;case"days":case"day":case"d":return P*f;case"hours":case"hour":case"hrs":case"hr":case"h":return P*c;case"minutes":case"minute":case"mins":case"min":case"m":return P*l;case"seconds":case"second":case"secs":case"sec":case"s":return P*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return P;default:return}}}}function o(L){var R=Math.abs(L);return R>=f?Math.round(L/f)+"d":R>=c?Math.round(L/c)+"h":R>=l?Math.round(L/l)+"m":R>=i?Math.round(L/i)+"s":L+"ms"}function I(L){var R=Math.abs(L);return R>=f?A(L,R,f,"day"):R>=c?A(L,R,c,"hour"):R>=l?A(L,R,l,"minute"):R>=i?A(L,R,i,"second"):L+" ms"}function A(L,R,P,q){var ie=R>=P*1.5;return Math.round(L/P)+" "+q+(ie?"s":"")}return od}var ad,ey;function gw(){if(ey)return ad;ey=1;function i(l){f.debug=f,f.default=f,f.coerce=A,f.disable=w,f.enable=v,f.enabled=o,f.humanize=mw(),f.destroy=L,Object.keys(l).forEach(R=>{f[R]=l[R]}),f.names=[],f.skips=[],f.formatters={};function c(R){let P=0;for(let q=0;q<R.length;q++)P=(P<<5)-P+R.charCodeAt(q),P|=0;return f.colors[Math.abs(P)%f.colors.length]}f.selectColor=c;function f(R){let P,q=null,ie,le;function V(...me){if(!V.enabled)return;const Oe=V,Pe=Number(new Date),ne=Pe-(P||Pe);Oe.diff=ne,Oe.prev=P,Oe.curr=Pe,P=Pe,me[0]=f.coerce(me[0]),typeof me[0]!="string"&&me.unshift("%O");let de=0;me[0]=me[0].replace(/%([a-zA-Z%])/g,(Ae,Me)=>{if(Ae==="%%")return"%";de++;const Y=f.formatters[Me];if(typeof Y=="function"){const xe=me[de];Ae=Y.call(Oe,xe),me.splice(de,1),de--}return Ae}),f.formatArgs.call(Oe,me),(Oe.log||f.log).apply(Oe,me)}return V.namespace=R,V.useColors=f.useColors(),V.color=f.selectColor(R),V.extend=_,V.destroy=f.destroy,Object.defineProperty(V,"enabled",{enumerable:!0,configurable:!1,get:()=>q!==null?q:(ie!==f.namespaces&&(ie=f.namespaces,le=f.enabled(R)),le),set:me=>{q=me}}),typeof f.init=="function"&&f.init(V),V}function _(R,P){const q=f(this.namespace+(typeof P>"u"?":":P)+R);return q.log=this.log,q}function v(R){f.save(R),f.namespaces=R,f.names=[],f.skips=[];let P;const q=(typeof R=="string"?R:"").split(/[\s,]+/),ie=q.length;for(P=0;P<ie;P++)q[P]&&(R=q[P].replace(/\*/g,".*?"),R[0]==="-"?f.skips.push(new RegExp("^"+R.slice(1)+"$")):f.names.push(new RegExp("^"+R+"$")))}function w(){const R=[...f.names.map(I),...f.skips.map(I).map(P=>"-"+P)].join(",");return f.enable(""),R}function o(R){if(R[R.length-1]==="*")return!0;let P,q;for(P=0,q=f.skips.length;P<q;P++)if(f.skips[P].test(R))return!1;for(P=0,q=f.names.length;P<q;P++)if(f.names[P].test(R))return!0;return!1}function I(R){return R.toString().substring(2,R.toString().length-2).replace(/\.\*\?$/,"*")}function A(R){return R instanceof Error?R.stack||R.message:R}function L(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return f.enable(f.load()),f}return ad=i,ad}var ty;function H_(){return ty||(ty=1,function(i,l){l.formatArgs=f,l.save=_,l.load=v,l.useColors=c,l.storage=w(),l.destroy=(()=>{let I=!1;return()=>{I||(I=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),l.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function c(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function f(I){if(I[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+I[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),!this.useColors)return;const A="color: "+this.color;I.splice(1,0,A,"color: inherit");let L=0,R=0;I[0].replace(/%[a-zA-Z%]/g,P=>{P!=="%%"&&(L++,P==="%c"&&(R=L))}),I.splice(R,0,A)}l.log=console.debug||console.log||(()=>{});function _(I){try{I?l.storage.setItem("debug",I):l.storage.removeItem("debug")}catch{}}function v(){let I;try{I=l.storage.getItem("debug")}catch{}return!I&&typeof process<"u"&&"env"in process&&(I={}.DEBUG),I}function w(){try{return localStorage}catch{}}i.exports=gw()(l);const{formatters:o}=i.exports;o.j=function(I){try{return JSON.stringify(I)}catch(A){return"[UnexpectedJSONParseError]: "+A.message}}}(fw,fu)),fu}var ld={},cd={},Vc={},ry;function yw(){if(ry)return Vc;ry=1;var i=yt&&yt.__extends||function(){var _=function(v,w){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,I){o.__proto__=I}||function(o,I){for(var A in I)Object.prototype.hasOwnProperty.call(I,A)&&(o[A]=I[A])},_(v,w)};return function(v,w){_(v,w);function o(){this.constructor=v}v.prototype=w===null?Object.create(w):(o.prototype=w.prototype,new o)}}(),l=yt&&yt.__spreadArrays||function(){for(var _=0,v=0,w=arguments.length;v<w;v++)_+=arguments[v].length;for(var o=Array(_),I=0,v=0;v<w;v++)for(var A=arguments[v],L=0,R=A.length;L<R;L++,I++)o[I]=A[L];return o};Vc.__esModule=!0,Vc.StrictEventEmitter=void 0;var c=qb(),f=function(_){i(v,_);function v(){return _.call(this)||this}return v.prototype.on=function(w,o){return _.prototype.on.call(this,w.toString(),o)},v.prototype.once=function(w,o){return _.prototype.once.call(this,w.toString(),o)},v.prototype.off=function(w,o){return _.prototype.off.call(this,w.toString(),o)},v.prototype.emit=function(w){for(var o=[],I=1;I<arguments.length;I++)o[I-1]=arguments[I];return _.prototype.emit.apply(this,l([w.toString()],o))},v.prototype.addListener=function(w,o){return _.prototype.addListener.call(this,w.toString(),o)},v.prototype.prependListener=function(w,o){return _.prototype.prependListener.call(this,w.toString(),o)},v.prototype.prependOnceListener=function(w,o){return _.prototype.prependOnceListener.call(this,w.toString(),o)},v.prototype.removeListener=function(w,o){return _.prototype.removeListener.call(this,w.toString(),o)},v.prototype.removeAllListeners=function(w){return w?_.prototype.removeAllListeners.call(this,w.toString()):_.prototype.removeAllListeners.call(this)},v.prototype.eventNames=function(){return _.prototype.eventNames.call(this)},v.prototype.listeners=function(w){return _.prototype.listeners.call(this,w.toString())},v.prototype.rawListeners=function(w){return _.prototype.rawListeners.call(this,w.toString())},v.prototype.listenerCount=function(w){return _.prototype.listenerCount.call(this,w.toString())},v}(c.EventEmitter);return Vc.StrictEventEmitter=f,Vc}var ny;function _w(){return ny||(ny=1,function(i){var l=yt&&yt.__createBinding||(Object.create?function(f,_,v,w){w===void 0&&(w=v),Object.defineProperty(f,w,{enumerable:!0,get:function(){return _[v]}})}:function(f,_,v,w){w===void 0&&(w=v),f[w]=_[v]}),c=yt&&yt.__exportStar||function(f,_){for(var v in f)v!=="default"&&!Object.prototype.hasOwnProperty.call(_,v)&&l(_,f,v)};i.__esModule=!0,c(yw(),i)}(cd)),cd}var Ha={},iy;function W_(){if(iy)return Ha;iy=1,Object.defineProperty(Ha,"__esModule",{value:!0}),Ha.nextTickAsync=Ha.nextTick=void 0;function i(c){setTimeout(c,0)}Ha.nextTick=i;function l(c){return new Promise(function(f){setTimeout(function(){f(c())},0)})}return Ha.nextTickAsync=l,Ha}var sy;function vw(){return sy||(sy=1,function(i){var l=yt&&yt.__extends||function(){var R=function(P,q){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ie,le){ie.__proto__=le}||function(ie,le){for(var V in le)Object.prototype.hasOwnProperty.call(le,V)&&(ie[V]=le[V])},R(P,q)};return function(P,q){if(typeof q!="function"&&q!==null)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");R(P,q);function ie(){this.constructor=P}P.prototype=q===null?Object.create(q):(ie.prototype=q.prototype,new ie)}}(),c=yt&&yt.__awaiter||function(R,P,q,ie){function le(V){return V instanceof q?V:new q(function(me){me(V)})}return new(q||(q=Promise))(function(V,me){function Oe(de){try{ne(ie.next(de))}catch(ce){me(ce)}}function Pe(de){try{ne(ie.throw(de))}catch(ce){me(ce)}}function ne(de){de.done?V(de.value):le(de.value).then(Oe,Pe)}ne((ie=ie.apply(R,P||[])).next())})},f=yt&&yt.__generator||function(R,P){var q={label:0,sent:function(){if(V[0]&1)throw V[1];return V[1]},trys:[],ops:[]},ie,le,V,me;return me={next:Oe(0),throw:Oe(1),return:Oe(2)},typeof Symbol=="function"&&(me[Symbol.iterator]=function(){return this}),me;function Oe(ne){return function(de){return Pe([ne,de])}}function Pe(ne){if(ie)throw new TypeError("Generator is already executing.");for(;q;)try{if(ie=1,le&&(V=ne[0]&2?le.return:ne[0]?le.throw||((V=le.return)&&V.call(le),0):le.next)&&!(V=V.call(le,ne[1])).done)return V;switch(le=0,V&&(ne=[ne[0]&2,V.value]),ne[0]){case 0:case 1:V=ne;break;case 4:return q.label++,{value:ne[1],done:!1};case 5:q.label++,le=ne[1],ne=[0];continue;case 7:ne=q.ops.pop(),q.trys.pop();continue;default:if(V=q.trys,!(V=V.length>0&&V[V.length-1])&&(ne[0]===6||ne[0]===2)){q=0;continue}if(ne[0]===3&&(!V||ne[1]>V[0]&&ne[1]<V[3])){q.label=ne[1];break}if(ne[0]===6&&q.label<V[1]){q.label=V[1],V=ne;break}if(V&&q.label<V[2]){q.label=V[2],q.ops.push(ne);break}V[2]&&q.ops.pop(),q.trys.pop();continue}ne=P.call(R,q)}catch(de){ne=[6,de],le=0}finally{ie=V=0}if(ne[0]&5)throw ne[1];return{value:ne[0]?ne[1]:void 0,done:!0}}},_=yt&&yt.__read||function(R,P){var q=typeof Symbol=="function"&&R[Symbol.iterator];if(!q)return R;var ie=q.call(R),le,V=[],me;try{for(;(P===void 0||P-- >0)&&!(le=ie.next()).done;)V.push(le.value)}catch(Oe){me={error:Oe}}finally{try{le&&!le.done&&(q=ie.return)&&q.call(ie)}finally{if(me)throw me.error}}return V},v=yt&&yt.__spreadArray||function(R,P){for(var q=0,ie=P.length,le=R.length;q<ie;q++,le++)R[le]=P[q];return R};Object.defineProperty(i,"__esModule",{value:!0}),i.AsyncEventEmitter=i.AsyncEventEmitterReadyState=void 0;var w=H_(),o=_w(),I=W_(),A;(function(R){R.ACTIVE="ACTIVE",R.DEACTIVATED="DEACTIVATED"})(A=i.AsyncEventEmitterReadyState||(i.AsyncEventEmitterReadyState={}));var L=function(R){l(P,R);function P(){var q=R.call(this)||this;return q.log=w.debug("async-event-emitter"),q.queue=new Map,q.readyState=A.ACTIVE,q}return P.prototype.on=function(q,ie){var le=this,V=this.log.extend("on");return V('adding "%s" listener...',q),this.readyState===A.DEACTIVATED?(V("the emitter is destroyed, skipping!"),this):R.prototype.on.call(this,q,function(){for(var me=[],Oe=0;Oe<arguments.length;Oe++)me[Oe]=arguments[Oe];return c(le,void 0,void 0,function(){var Pe,ne=this;return f(this,function(de){return Pe=this.openListenerQueue(q),V('awaiting the "%s" listener...',q),Pe.push({args:me,done:new Promise(function(ce,Ae){return c(ne,void 0,void 0,function(){var Me;return f(this,function(Y){switch(Y.label){case 0:return Y.trys.push([0,2,,3]),[4,ie.apply(void 0,v([],_(me)))];case 1:return Y.sent(),ce(),V('"%s" listener has resolved!',q),[3,3];case 2:return Me=Y.sent(),V('"%s" listener has rejected!',Me),Ae(Me),[3,3];case 3:return[2]}})})})}),[2]})})})},P.prototype.emit=function(q){for(var ie=this,le=[],V=1;V<arguments.length;V++)le[V-1]=arguments[V];var me=this.log.extend("emit");return me('emitting "%s" event...',q),this.readyState===A.DEACTIVATED?(me("the emitter is destroyed, skipping!"),!1):(this.openListenerQueue(q),me('appending a one-time cleanup "%s" listener...',q),this.once(q,function(){I.nextTick(function(){ie.queue.delete(q),me('cleaned up "%s" listeners queue!',q)})}),R.prototype.emit.apply(this,v([q],_(le))))},P.prototype.untilIdle=function(q,ie){return ie===void 0&&(ie=function(){return!0}),c(this,void 0,void 0,function(){var le,V=this;return f(this,function(me){switch(me.label){case 0:return le=this.queue.get(q)||[],[4,Promise.all(le.filter(ie).map(function(Oe){var Pe=Oe.done;return Pe})).finally(function(){V.queue.delete(q)})];case 1:return me.sent(),[2]}})})},P.prototype.openListenerQueue=function(q){var ie=this.log.extend("openListenerQueue");ie('opening "%s" listeners queue...',q);var le=this.queue.get(q);return le?(ie("returning an exising queue:",le),le):(ie("no queue found, creating one..."),this.queue.set(q,[]),[])},P.prototype.removeAllListeners=function(q){var ie=this.log.extend("removeAllListeners");return ie("event:",q),q?(this.queue.delete(q),ie('cleared the "%s" listeners queue!',q,this.queue.get(q))):(this.queue.clear(),ie("cleared the listeners queue!",this.queue)),R.prototype.removeAllListeners.call(this,q)},P.prototype.activate=function(){var q=this.log.extend("activate");this.readyState=A.ACTIVE,q("set state to:",this.readyState)},P.prototype.deactivate=function(){var q=this.log.extend("deactivate");q("removing all listeners..."),this.removeAllListeners(),this.readyState=A.DEACTIVATED,q("set state to:",this.readyState)},P}(o.StrictEventEmitter);i.AsyncEventEmitter=L}(ld)),ld}var oy;function Uh(){return oy||(oy=1,function(i){var l=yt&&yt.__values||function(L){var R=typeof Symbol=="function"&&Symbol.iterator,P=R&&L[R],q=0;if(P)return P.call(L);if(L&&typeof L.length=="number")return{next:function(){return L&&q>=L.length&&(L=void 0),{value:L&&L[q++],done:!L}}};throw new TypeError(R?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(i,"__esModule",{value:!0}),i.Interceptor=i.InterceptorReadyState=i.deleteGlobalSymbol=i.getGlobalSymbol=void 0;var c=H_(),f=vw(),_=W_();function v(L){return globalThis[L]||void 0}i.getGlobalSymbol=v;function w(L,R){globalThis[L]=R}function o(L){delete globalThis[L]}i.deleteGlobalSymbol=o;var I;(function(L){L.IDLE="IDLE",L.APPLYING="APPLYING",L.APPLIED="APPLIED",L.DISPOSING="DISPOSING",L.DISPOSED="DISPOSED"})(I=i.InterceptorReadyState||(i.InterceptorReadyState={}));var A=function(){function L(R){this.symbol=R,this.readyState=I.IDLE,this.emitter=new f.AsyncEventEmitter,this.subscriptions=[],this.log=c.debug(R.description),this.emitter.setMaxListeners(0),this.log("constructing the interceptor...")}return L.prototype.checkEnvironment=function(){return!0},L.prototype.apply=function(){var R=this,P=this.log.extend("apply");if(P("applying the interceptor..."),this.readyState===I.APPLIED){P("intercepted already applied!");return}var q=this.checkEnvironment();if(!q){P("the interceptor cannot be applied in this environment!");return}this.readyState=I.APPLYING,this.emitter.activate(),P("activated the emiter!",this.emitter.readyState);var ie=this.getInstance();if(ie){P("found a running instance, reusing..."),this.on=function(le,V){P('proxying the "%s" listener',le),ie.emitter.addListener(le,V),R.subscriptions.push(function(){ie.emitter.removeListener(le,V),P('removed proxied "%s" listener!',le)})},_.nextTick(function(){R.readyState=I.APPLIED});return}P("no running instance found, setting up a new instance..."),this.setup(),this.setInstance(),_.nextTick(function(){R.readyState=I.APPLIED})},L.prototype.setup=function(){},L.prototype.on=function(R,P){var q=this.log.extend("on");if(this.readyState===I.DISPOSING||this.readyState===I.DISPOSED){q("cannot listen to events, already disposed!");return}q('adding "%s" event listener:',R,P.name),this.emitter.on(R,P)},L.prototype.dispose=function(){var R,P,q=this,ie=this.log.extend("dispose");if(this.readyState===I.DISPOSED){ie("cannot dispose, already disposed!");return}if(ie("disposing the interceptor..."),this.readyState=I.DISPOSING,!this.getInstance()){ie("no interceptors running, skipping dispose...");return}if(this.clearInstance(),ie("global symbol deleted:",v(this.symbol)),this.subscriptions.length>0){ie("disposing of %d subscriptions...",this.subscriptions.length);try{for(var le=l(this.subscriptions),V=le.next();!V.done;V=le.next()){var me=V.value;me()}}catch(Oe){R={error:Oe}}finally{try{V&&!V.done&&(P=le.return)&&P.call(le)}finally{if(R)throw R.error}}this.subscriptions=[],ie("disposed of all subscriptions!",this.subscriptions.length)}this.emitter.deactivate(),ie("destroyed the listener!"),_.nextTick(function(){q.readyState=I.DISPOSED})},L.prototype.getInstance=function(){var R,P=v(this.symbol);return this.log("retrieved global instance:",(R=P==null?void 0:P.constructor)===null||R===void 0?void 0:R.name),P},L.prototype.setInstance=function(){w(this.symbol,this),this.log("set global instance!",this.symbol.description)},L.prototype.clearInstance=function(){o(this.symbol),this.log("cleared global instance!",this.symbol.description)},L}();i.Interceptor=A}(sd)),sd}var jc={},ay;function xw(){if(ay)return jc;ay=1;var i=yt&&yt.__extends||function(){var _=function(v,w){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,I){o.__proto__=I}||function(o,I){for(var A in I)Object.prototype.hasOwnProperty.call(I,A)&&(o[A]=I[A])},_(v,w)};return function(v,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");_(v,w);function o(){this.constructor=v}v.prototype=w===null?Object.create(w):(o.prototype=w.prototype,new o)}}(),l=yt&&yt.__values||function(_){var v=typeof Symbol=="function"&&Symbol.iterator,w=v&&_[v],o=0;if(w)return w.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&o>=_.length&&(_=void 0),{value:_&&_[o++],done:!_}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(jc,"__esModule",{value:!0}),jc.BatchInterceptor=void 0;var c=Uh(),f=function(_){i(v,_);function v(w){var o=this;return v.symbol=Symbol(w.name),o=_.call(this,v.symbol)||this,o.interceptors=w.interceptors,o}return v.prototype.setup=function(){var w,o,I=this.log.extend("setup");I("applying all %d interceptors...",this.interceptors.length);var A=function(ie){I('applying "%s" interceptor...',ie.constructor.name),ie.apply(),I("adding interceptor dispose subscription"),L.subscriptions.push(function(){return ie.dispose()})},L=this;try{for(var R=l(this.interceptors),P=R.next();!P.done;P=R.next()){var q=P.value;A(q)}}catch(ie){w={error:ie}}finally{try{P&&!P.done&&(o=R.return)&&o.call(R)}finally{if(w)throw w.error}}},v.prototype.on=function(w,o){this.interceptors.forEach(function(I){I.on(w,o)})},v}(c.Interceptor);return jc.BatchInterceptor=f,jc}var qc={},So={},gh={},ud={},hd={},pd,ly;function X_(){return ly||(ly=1,pd=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var l={},c=Symbol("test"),f=Object(c);if(typeof c=="string"||Object.prototype.toString.call(c)!=="[object Symbol]"||Object.prototype.toString.call(f)!=="[object Symbol]")return!1;var _=42;l[c]=_;for(c in l)return!1;if(typeof Object.keys=="function"&&Object.keys(l).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(l).length!==0)return!1;var v=Object.getOwnPropertySymbols(l);if(v.length!==1||v[0]!==c||!Object.prototype.propertyIsEnumerable.call(l,c))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var w=Object.getOwnPropertyDescriptor(l,c);if(w.value!==_||w.enumerable!==!0)return!1}return!0}),pd}var dd,cy;function $h(){if(cy)return dd;cy=1;var i=X_();return dd=function(){return i()&&!!Symbol.toStringTag},dd}var fd,uy;function bw(){return uy||(uy=1,fd=Error),fd}var md,hy;function ww(){return hy||(hy=1,md=EvalError),md}var gd,py;function Ew(){return py||(py=1,gd=RangeError),gd}var yd,dy;function Tw(){return dy||(dy=1,yd=ReferenceError),yd}var _d,fy;function Y_(){return fy||(fy=1,_d=SyntaxError),_d}var vd,my;function Vh(){return my||(my=1,vd=TypeError),vd}var xd,gy;function Sw(){return gy||(gy=1,xd=URIError),xd}var bd,yy;function Iw(){if(yy)return bd;yy=1;var i=typeof Symbol<"u"&&Symbol,l=X_();return bd=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:l()},bd}var wd,_y;function Aw(){if(_y)return wd;_y=1;var i={foo:{}},l=Object;return wd=function(){return{__proto__:i}.foo===i.foo&&!({__proto__:null}instanceof l)},wd}var Ed,vy;function Dw(){if(vy)return Ed;vy=1;var i="Function.prototype.bind called on incompatible ",l=Object.prototype.toString,c=Math.max,f="[object Function]",_=function(I,A){for(var L=[],R=0;R<I.length;R+=1)L[R]=I[R];for(var P=0;P<A.length;P+=1)L[P+I.length]=A[P];return L},v=function(I,A){for(var L=[],R=A||0,P=0;R<I.length;R+=1,P+=1)L[P]=I[R];return L},w=function(o,I){for(var A="",L=0;L<o.length;L+=1)A+=o[L],L+1<o.length&&(A+=I);return A};return Ed=function(I){var A=this;if(typeof A!="function"||l.apply(A)!==f)throw new TypeError(i+A);for(var L=v(arguments,1),R,P=function(){if(this instanceof R){var me=A.apply(this,_(L,arguments));return Object(me)===me?me:this}return A.apply(I,_(L,arguments))},q=c(0,A.length-L.length),ie=[],le=0;le<q;le++)ie[le]="$"+le;if(R=Function("binder","return function ("+w(ie,",")+"){ return binder.apply(this,arguments); }")(P),A.prototype){var V=function(){};V.prototype=A.prototype,R.prototype=new V,V.prototype=null}return R},Ed}var Td,xy;function pf(){if(xy)return Td;xy=1;var i=Dw();return Td=Function.prototype.bind||i,Td}var Sd,by;function Cw(){if(by)return Sd;by=1;var i=Function.prototype.call,l=Object.prototype.hasOwnProperty,c=pf();return Sd=c.call(i,l),Sd}var Id,wy;function Su(){if(wy)return Id;wy=1;var i,l=bw(),c=ww(),f=Ew(),_=Tw(),v=Y_(),w=Vh(),o=Sw(),I=Function,A=function(ht){try{return I('"use strict"; return ('+ht+").constructor;")()}catch{}},L=Object.getOwnPropertyDescriptor;if(L)try{L({},"")}catch{L=null}var R=function(){throw new w},P=L?function(){try{return arguments.callee,R}catch{try{return L(arguments,"callee").get}catch{return R}}}():R,q=Iw()(),ie=Aw()(),le=Object.getPrototypeOf||(ie?function(ht){return ht.__proto__}:null),V={},me=typeof Uint8Array>"u"||!le?i:le(Uint8Array),Oe={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":q&&le?le([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":V,"%AsyncGenerator%":V,"%AsyncGeneratorFunction%":V,"%AsyncIteratorPrototype%":V,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":l,"%eval%":eval,"%EvalError%":c,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":I,"%GeneratorFunction%":V,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":q&&le?le(le([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!q||!le?i:le(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":f,"%ReferenceError%":_,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!q||!le?i:le(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":q&&le?le(""[Symbol.iterator]()):i,"%Symbol%":q?Symbol:i,"%SyntaxError%":v,"%ThrowTypeError%":P,"%TypedArray%":me,"%TypeError%":w,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":o,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet};if(le)try{null.error}catch(ht){var Pe=le(le(ht));Oe["%Error.prototype%"]=Pe}var ne=function ht(et){var ft;if(et==="%AsyncFunction%")ft=A("async function () {}");else if(et==="%GeneratorFunction%")ft=A("function* () {}");else if(et==="%AsyncGeneratorFunction%")ft=A("async function* () {}");else if(et==="%AsyncGenerator%"){var Ut=ht("%AsyncGeneratorFunction%");Ut&&(ft=Ut.prototype)}else if(et==="%AsyncIteratorPrototype%"){var mt=ht("%AsyncGenerator%");mt&&le&&(ft=le(mt.prototype))}return Oe[et]=ft,ft},de={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ce=pf(),Ae=Cw(),Me=ce.call(Function.call,Array.prototype.concat),Y=ce.call(Function.apply,Array.prototype.splice),xe=ce.call(Function.call,String.prototype.replace),Ge=ce.call(Function.call,String.prototype.slice),Ye=ce.call(Function.call,RegExp.prototype.exec),ct=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,wt=/\\(\\)?/g,Et=function(et){var ft=Ge(et,0,1),Ut=Ge(et,-1);if(ft==="%"&&Ut!=="%")throw new v("invalid intrinsic syntax, expected closing `%`");if(Ut==="%"&&ft!=="%")throw new v("invalid intrinsic syntax, expected opening `%`");var mt=[];return xe(et,ct,function(Q,we,Ee,je){mt[mt.length]=Ee?xe(je,wt,"$1"):we||Q}),mt},Dt=function(et,ft){var Ut=et,mt;if(Ae(de,Ut)&&(mt=de[Ut],Ut="%"+mt[0]+"%"),Ae(Oe,Ut)){var Q=Oe[Ut];if(Q===V&&(Q=ne(Ut)),typeof Q>"u"&&!ft)throw new w("intrinsic "+et+" exists, but is not available. Please file an issue!");return{alias:mt,name:Ut,value:Q}}throw new v("intrinsic "+et+" does not exist!")};return Id=function(et,ft){if(typeof et!="string"||et.length===0)throw new w("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof ft!="boolean")throw new w('"allowMissing" argument must be a boolean');if(Ye(/^%?[^%]*%?$/,et)===null)throw new v("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Ut=Et(et),mt=Ut.length>0?Ut[0]:"",Q=Dt("%"+mt+"%",ft),we=Q.name,Ee=Q.value,je=!1,St=Q.alias;St&&(mt=St[0],Y(Ut,Me([0,1],St)));for(var Mt=1,ot=!0;Mt<Ut.length;Mt+=1){var It=Ut[Mt],jt=Ge(It,0,1),Qt=Ge(It,-1);if((jt==='"'||jt==="'"||jt==="`"||Qt==='"'||Qt==="'"||Qt==="`")&&jt!==Qt)throw new v("property names with quotes must have matching quotes");if((It==="constructor"||!ot)&&(je=!0),mt+="."+It,we="%"+mt+"%",Ae(Oe,we))Ee=Oe[we];else if(Ee!=null){if(!(It in Ee)){if(!ft)throw new w("base intrinsic for "+et+" exists, but the property is not available.");return}if(L&&Mt+1>=Ut.length){var Yt=L(Ee,It);ot=!!Yt,ot&&"get"in Yt&&!("originalValue"in Yt.get)?Ee=Yt.get:Ee=Ee[It]}else ot=Ae(Ee,It),Ee=Ee[It];ot&&!je&&(Oe[we]=Ee)}}return Ee},Id}var Ch={},Pw={get exports(){return Ch},set exports(i){Ch=i}},Ad,Ey;function df(){if(Ey)return Ad;Ey=1;var i=Su(),l=i("%Object.defineProperty%",!0)||!1;if(l)try{l({},"a",{value:1})}catch{l=!1}return Ad=l,Ad}var Dd,Ty;function jh(){if(Ty)return Dd;Ty=1;var i=Su(),l=i("%Object.getOwnPropertyDescriptor%",!0);if(l)try{l([],"length")}catch{l=null}return Dd=l,Dd}var Cd,Sy;function kw(){if(Sy)return Cd;Sy=1;var i=df(),l=Y_(),c=Vh(),f=jh();return Cd=function(v,w,o){if(!v||typeof v!="object"&&typeof v!="function")throw new c("`obj` must be an object or a function`");if(typeof w!="string"&&typeof w!="symbol")throw new c("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new c("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new c("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new c("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new c("`loose`, if provided, must be a boolean");var I=arguments.length>3?arguments[3]:null,A=arguments.length>4?arguments[4]:null,L=arguments.length>5?arguments[5]:null,R=arguments.length>6?arguments[6]:!1,P=!!f&&f(v,w);if(i)i(v,w,{configurable:L===null&&P?P.configurable:!L,enumerable:I===null&&P?P.enumerable:!I,value:o,writable:A===null&&P?P.writable:!A});else if(R||!I&&!A&&!L)v[w]=o;else throw new l("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Cd}var Pd,Iy;function Mw(){if(Iy)return Pd;Iy=1;var i=df(),l=function(){return!!i};return l.hasArrayLengthDefineBug=function(){if(!i)return null;try{return i([],"length",{value:1}).length!==1}catch{return!0}},Pd=l,Pd}var kd,Ay;function Ow(){if(Ay)return kd;Ay=1;var i=Su(),l=kw(),c=Mw()(),f=jh(),_=Vh(),v=i("%Math.floor%");return kd=function(o,I){if(typeof o!="function")throw new _("`fn` is not a function");if(typeof I!="number"||I<0||I>4294967295||v(I)!==I)throw new _("`length` must be a positive 32-bit integer");var A=arguments.length>2&&!!arguments[2],L=!0,R=!0;if("length"in o&&f){var P=f(o,"length");P&&!P.configurable&&(L=!1),P&&!P.writable&&(R=!1)}return(L||R||!A)&&(c?l(o,"length",I,!0,!0):l(o,"length",I)),o},kd}var Dy;function Rw(){return Dy||(Dy=1,function(i){var l=pf(),c=Su(),f=Ow(),_=Vh(),v=c("%Function.prototype.apply%"),w=c("%Function.prototype.call%"),o=c("%Reflect.apply%",!0)||l.call(w,v),I=df(),A=c("%Math.max%");i.exports=function(P){if(typeof P!="function")throw new _("a function is required");var q=o(l,w,arguments);return f(q,1+A(0,P.length-(arguments.length-1)),!0)};var L=function(){return o(l,v,arguments)};I?I(i.exports,"apply",{value:L}):i.exports.apply=L}(Pw)),Ch}var Md,Cy;function ff(){if(Cy)return Md;Cy=1;var i=Su(),l=Rw(),c=l(i("String.prototype.indexOf"));return Md=function(_,v){var w=i(_,!!v);return typeof w=="function"&&c(_,".prototype.")>-1?l(w):w},Md}var Od,Py;function Nw(){if(Py)return Od;Py=1;var i=$h()(),l=ff(),c=l("Object.prototype.toString"),f=function(o){return i&&o&&typeof o=="object"&&Symbol.toStringTag in o?!1:c(o)==="[object Arguments]"},_=function(o){return f(o)?!0:o!==null&&typeof o=="object"&&typeof o.length=="number"&&o.length>=0&&c(o)!=="[object Array]"&&c(o.callee)==="[object Function]"},v=function(){return f(arguments)}();return f.isLegacyArguments=_,Od=v?f:_,Od}var Rd,ky;function Lw(){if(ky)return Rd;ky=1;var i=Object.prototype.toString,l=Function.prototype.toString,c=/^\s*(?:function)?\*/,f=$h()(),_=Object.getPrototypeOf,v=function(){if(!f)return!1;try{return Function("return function*() {}")()}catch{}},w;return Rd=function(I){if(typeof I!="function")return!1;if(c.test(l.call(I)))return!0;if(!f){var A=i.call(I);return A==="[object GeneratorFunction]"}if(!_)return!1;if(typeof w>"u"){var L=v();w=L?_(L):!1}return _(I)===w},Rd}var Nd,My;function Fw(){if(My)return Nd;My=1;var i=Function.prototype.toString,l=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,c,f;if(typeof l=="function"&&typeof Object.defineProperty=="function")try{c=Object.defineProperty({},"length",{get:function(){throw f}}),f={},l(function(){throw 42},null,c)}catch(Oe){Oe!==f&&(l=null)}else l=null;var _=/^\s*class\b/,v=function(Pe){try{var ne=i.call(Pe);return _.test(ne)}catch{return!1}},w=function(Pe){try{return v(Pe)?!1:(i.call(Pe),!0)}catch{return!1}},o=Object.prototype.toString,I="[object Object]",A="[object Function]",L="[object GeneratorFunction]",R="[object HTMLAllCollection]",P="[object HTML document.all class]",q="[object HTMLCollection]",ie=typeof Symbol=="function"&&!!Symbol.toStringTag,le=!(0 in[,]),V=function(){return!1};if(typeof document=="object"){var me=document.all;o.call(me)===o.call(document.all)&&(V=function(Pe){if((le||!Pe)&&(typeof Pe>"u"||typeof Pe=="object"))try{var ne=o.call(Pe);return(ne===R||ne===P||ne===q||ne===I)&&Pe("")==null}catch{}return!1})}return Nd=l?function(Pe){if(V(Pe))return!0;if(!Pe||typeof Pe!="function"&&typeof Pe!="object")return!1;try{l(Pe,null,c)}catch(ne){if(ne!==f)return!1}return!v(Pe)&&w(Pe)}:function(Pe){if(V(Pe))return!0;if(!Pe||typeof Pe!="function"&&typeof Pe!="object")return!1;if(ie)return w(Pe);if(v(Pe))return!1;var ne=o.call(Pe);return ne!==A&&ne!==L&&!/^\[object HTML/.test(ne)?!1:w(Pe)},Nd}var Ld,Oy;function J_(){if(Oy)return Ld;Oy=1;var i=Fw(),l=Object.prototype.toString,c=Object.prototype.hasOwnProperty,f=function(I,A,L){for(var R=0,P=I.length;R<P;R++)c.call(I,R)&&(L==null?A(I[R],R,I):A.call(L,I[R],R,I))},_=function(I,A,L){for(var R=0,P=I.length;R<P;R++)L==null?A(I.charAt(R),R,I):A.call(L,I.charAt(R),R,I)},v=function(I,A,L){for(var R in I)c.call(I,R)&&(L==null?A(I[R],R,I):A.call(L,I[R],R,I))},w=function(I,A,L){if(!i(A))throw new TypeError("iterator must be a function");var R;arguments.length>=3&&(R=L),l.call(I)==="[object Array]"?f(I,A,R):typeof I=="string"?_(I,A,R):v(I,A,R)};return Ld=w,Ld}var Fd,Ry;function K_(){if(Ry)return Fd;Ry=1;var i=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],l=typeof globalThis>"u"?yt:globalThis;return Fd=function(){for(var f=[],_=0;_<i.length;_++)typeof l[i[_]]=="function"&&(f[f.length]=i[_]);return f},Fd}var zd,Ny;function Q_(){if(Ny)return zd;Ny=1;var i=J_(),l=K_(),c=ff(),f=c("Object.prototype.toString"),_=$h()(),v=jh(),w=typeof globalThis>"u"?yt:globalThis,o=l(),I=c("Array.prototype.indexOf",!0)||function(ie,le){for(var V=0;V<ie.length;V+=1)if(ie[V]===le)return V;return-1},A=c("String.prototype.slice"),L={},R=Object.getPrototypeOf;_&&v&&R&&i(o,function(q){var ie=new w[q];if(Symbol.toStringTag in ie){var le=R(ie),V=v(le,Symbol.toStringTag);if(!V){var me=R(le);V=v(me,Symbol.toStringTag)}L[q]=V.get}});var P=function(ie){var le=!1;return i(L,function(V,me){if(!le)try{le=V.call(ie)===me}catch{}}),le};return zd=function(ie){if(!ie||typeof ie!="object")return!1;if(!_||!(Symbol.toStringTag in ie)){var le=A(f(ie),8,-1);return I(o,le)>-1}return v?P(ie):!1},zd}var Bd,Ly;function zw(){if(Ly)return Bd;Ly=1;var i=J_(),l=K_(),c=ff(),f=jh(),_=c("Object.prototype.toString"),v=$h()(),w=typeof globalThis>"u"?yt:globalThis,o=l(),I=c("String.prototype.slice"),A={},L=Object.getPrototypeOf;v&&f&&L&&i(o,function(q){if(typeof w[q]=="function"){var ie=new w[q];if(Symbol.toStringTag in ie){var le=L(ie),V=f(le,Symbol.toStringTag);if(!V){var me=L(le);V=f(me,Symbol.toStringTag)}A[q]=V.get}}});var R=function(ie){var le=!1;return i(A,function(V,me){if(!le)try{var Oe=V.call(ie);Oe===me&&(le=Oe)}catch{}}),le},P=Q_();return Bd=function(ie){return P(ie)?!v||!(Symbol.toStringTag in ie)?I(_(ie),8,-1):R(ie):!1},Bd}var Fy;function Bw(){return Fy||(Fy=1,function(i){var l=Nw(),c=Lw(),f=zw(),_=Q_();function v(Xe){return Xe.call.bind(Xe)}var w=typeof BigInt<"u",o=typeof Symbol<"u",I=v(Object.prototype.toString),A=v(Number.prototype.valueOf),L=v(String.prototype.valueOf),R=v(Boolean.prototype.valueOf);if(w)var P=v(BigInt.prototype.valueOf);if(o)var q=v(Symbol.prototype.valueOf);function ie(Xe,$e){if(typeof Xe!="object")return!1;try{return $e(Xe),!0}catch{return!1}}i.isArgumentsObject=l,i.isGeneratorFunction=c,i.isTypedArray=_;function le(Xe){return typeof Promise<"u"&&Xe instanceof Promise||Xe!==null&&typeof Xe=="object"&&typeof Xe.then=="function"&&typeof Xe.catch=="function"}i.isPromise=le;function V(Xe){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(Xe):_(Xe)||we(Xe)}i.isArrayBufferView=V;function me(Xe){return f(Xe)==="Uint8Array"}i.isUint8Array=me;function Oe(Xe){return f(Xe)==="Uint8ClampedArray"}i.isUint8ClampedArray=Oe;function Pe(Xe){return f(Xe)==="Uint16Array"}i.isUint16Array=Pe;function ne(Xe){return f(Xe)==="Uint32Array"}i.isUint32Array=ne;function de(Xe){return f(Xe)==="Int8Array"}i.isInt8Array=de;function ce(Xe){return f(Xe)==="Int16Array"}i.isInt16Array=ce;function Ae(Xe){return f(Xe)==="Int32Array"}i.isInt32Array=Ae;function Me(Xe){return f(Xe)==="Float32Array"}i.isFloat32Array=Me;function Y(Xe){return f(Xe)==="Float64Array"}i.isFloat64Array=Y;function xe(Xe){return f(Xe)==="BigInt64Array"}i.isBigInt64Array=xe;function Ge(Xe){return f(Xe)==="BigUint64Array"}i.isBigUint64Array=Ge;function Ye(Xe){return I(Xe)==="[object Map]"}Ye.working=typeof Map<"u"&&Ye(new Map);function ct(Xe){return typeof Map>"u"?!1:Ye.working?Ye(Xe):Xe instanceof Map}i.isMap=ct;function wt(Xe){return I(Xe)==="[object Set]"}wt.working=typeof Set<"u"&&wt(new Set);function Et(Xe){return typeof Set>"u"?!1:wt.working?wt(Xe):Xe instanceof Set}i.isSet=Et;function Dt(Xe){return I(Xe)==="[object WeakMap]"}Dt.working=typeof WeakMap<"u"&&Dt(new WeakMap);function ht(Xe){return typeof WeakMap>"u"?!1:Dt.working?Dt(Xe):Xe instanceof WeakMap}i.isWeakMap=ht;function et(Xe){return I(Xe)==="[object WeakSet]"}et.working=typeof WeakSet<"u"&&et(new WeakSet);function ft(Xe){return et(Xe)}i.isWeakSet=ft;function Ut(Xe){return I(Xe)==="[object ArrayBuffer]"}Ut.working=typeof ArrayBuffer<"u"&&Ut(new ArrayBuffer);function mt(Xe){return typeof ArrayBuffer>"u"?!1:Ut.working?Ut(Xe):Xe instanceof ArrayBuffer}i.isArrayBuffer=mt;function Q(Xe){return I(Xe)==="[object DataView]"}Q.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Q(new DataView(new ArrayBuffer(1),0,1));function we(Xe){return typeof DataView>"u"?!1:Q.working?Q(Xe):Xe instanceof DataView}i.isDataView=we;var Ee=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function je(Xe){return I(Xe)==="[object SharedArrayBuffer]"}function St(Xe){return typeof Ee>"u"?!1:(typeof je.working>"u"&&(je.working=je(new Ee)),je.working?je(Xe):Xe instanceof Ee)}i.isSharedArrayBuffer=St;function Mt(Xe){return I(Xe)==="[object AsyncFunction]"}i.isAsyncFunction=Mt;function ot(Xe){return I(Xe)==="[object Map Iterator]"}i.isMapIterator=ot;function It(Xe){return I(Xe)==="[object Set Iterator]"}i.isSetIterator=It;function jt(Xe){return I(Xe)==="[object Generator]"}i.isGeneratorObject=jt;function Qt(Xe){return I(Xe)==="[object WebAssembly.Module]"}i.isWebAssemblyCompiledModule=Qt;function Yt(Xe){return ie(Xe,A)}i.isNumberObject=Yt;function hn(Xe){return ie(Xe,L)}i.isStringObject=hn;function gr(Xe){return ie(Xe,R)}i.isBooleanObject=gr;function sn(Xe){return w&&ie(Xe,P)}i.isBigIntObject=sn;function Sr(Xe){return o&&ie(Xe,q)}i.isSymbolObject=Sr;function An(Xe){return Yt(Xe)||hn(Xe)||gr(Xe)||sn(Xe)||Sr(Xe)}i.isBoxedPrimitive=An;function Dn(Xe){return typeof Uint8Array<"u"&&(mt(Xe)||St(Xe))}i.isAnyArrayBuffer=Dn,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(Xe){Object.defineProperty(i,Xe,{enumerable:!1,value:function(){throw new Error(Xe+" is not supported in userland")}})})}(hd)),hd}var Ud,zy;function Uw(){return zy||(zy=1,Ud=function(l){return l&&typeof l=="object"&&typeof l.copy=="function"&&typeof l.fill=="function"&&typeof l.readUInt8=="function"}),Ud}var Ph={},By={get exports(){return Ph},set exports(i){Ph=i}},Uy;function $w(){return Uy||(Uy=1,typeof Object.create=="function"?By.exports=function(l,c){c&&(l.super_=c,l.prototype=Object.create(c.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}))}:By.exports=function(l,c){if(c){l.super_=c;var f=function(){};f.prototype=c.prototype,l.prototype=new f,l.prototype.constructor=l}}),Ph}var $y;function Vy(){return $y||($y=1,function(i){var l=Object.getOwnPropertyDescriptors||function(we){for(var Ee=Object.keys(we),je={},St=0;St<Ee.length;St++)je[Ee[St]]=Object.getOwnPropertyDescriptor(we,Ee[St]);return je},c=/%[sdj%]/g;i.format=function(Q){if(!de(Q)){for(var we=[],Ee=0;Ee<arguments.length;Ee++)we.push(w(arguments[Ee]));return we.join(" ")}for(var Ee=1,je=arguments,St=je.length,Mt=String(Q).replace(c,function(It){if(It==="%%")return"%";if(Ee>=St)return It;switch(It){case"%s":return String(je[Ee++]);case"%d":return Number(je[Ee++]);case"%j":try{return JSON.stringify(je[Ee++])}catch{return"[Circular]"}default:return It}}),ot=je[Ee];Ee<St;ot=je[++Ee])Oe(ot)||!Y(ot)?Mt+=" "+ot:Mt+=" "+w(ot);return Mt},i.deprecate=function(Q,we){if(typeof process<"u"&&process.noDeprecation===!0)return Q;if(typeof process>"u")return function(){return i.deprecate(Q,we).apply(this,arguments)};var Ee=!1;function je(){if(!Ee){if(process.throwDeprecation)throw new Error(we);process.traceDeprecation?console.trace(we):console.error(we),Ee=!0}return Q.apply(this,arguments)}return je};var f={},_=/^$/;if({}.NODE_DEBUG){var v={}.NODE_DEBUG;v=v.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),_=new RegExp("^"+v+"$","i")}i.debuglog=function(Q){if(Q=Q.toUpperCase(),!f[Q])if(_.test(Q)){var we=process.pid;f[Q]=function(){var Ee=i.format.apply(i,arguments);console.error("%s %d: %s",Q,we,Ee)}}else f[Q]=function(){};return f[Q]};function w(Q,we){var Ee={seen:[],stylize:I};return arguments.length>=3&&(Ee.depth=arguments[2]),arguments.length>=4&&(Ee.colors=arguments[3]),me(we)?Ee.showHidden=we:we&&i._extend(Ee,we),Ae(Ee.showHidden)&&(Ee.showHidden=!1),Ae(Ee.depth)&&(Ee.depth=2),Ae(Ee.colors)&&(Ee.colors=!1),Ae(Ee.customInspect)&&(Ee.customInspect=!0),Ee.colors&&(Ee.stylize=o),L(Ee,Q,Ee.depth)}i.inspect=w,w.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},w.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function o(Q,we){var Ee=w.styles[we];return Ee?"\x1B["+w.colors[Ee][0]+"m"+Q+"\x1B["+w.colors[Ee][1]+"m":Q}function I(Q,we){return Q}function A(Q){var we={};return Q.forEach(function(Ee,je){we[Ee]=!0}),we}function L(Q,we,Ee){if(Q.customInspect&&we&&Ye(we.inspect)&&we.inspect!==i.inspect&&!(we.constructor&&we.constructor.prototype===we)){var je=we.inspect(Ee,Q);return de(je)||(je=L(Q,je,Ee)),je}var St=R(Q,we);if(St)return St;var Mt=Object.keys(we),ot=A(Mt);if(Q.showHidden&&(Mt=Object.getOwnPropertyNames(we)),Ge(we)&&(Mt.indexOf("message")>=0||Mt.indexOf("description")>=0))return P(we);if(Mt.length===0){if(Ye(we)){var It=we.name?": "+we.name:"";return Q.stylize("[Function"+It+"]","special")}if(Me(we))return Q.stylize(RegExp.prototype.toString.call(we),"regexp");if(xe(we))return Q.stylize(Date.prototype.toString.call(we),"date");if(Ge(we))return P(we)}var jt="",Qt=!1,Yt=["{","}"];if(V(we)&&(Qt=!0,Yt=["[","]"]),Ye(we)){var hn=we.name?": "+we.name:"";jt=" [Function"+hn+"]"}if(Me(we)&&(jt=" "+RegExp.prototype.toString.call(we)),xe(we)&&(jt=" "+Date.prototype.toUTCString.call(we)),Ge(we)&&(jt=" "+P(we)),Mt.length===0&&(!Qt||we.length==0))return Yt[0]+jt+Yt[1];if(Ee<0)return Me(we)?Q.stylize(RegExp.prototype.toString.call(we),"regexp"):Q.stylize("[Object]","special");Q.seen.push(we);var gr;return Qt?gr=q(Q,we,Ee,ot,Mt):gr=Mt.map(function(sn){return ie(Q,we,Ee,ot,sn,Qt)}),Q.seen.pop(),le(gr,jt,Yt)}function R(Q,we){if(Ae(we))return Q.stylize("undefined","undefined");if(de(we)){var Ee="'"+JSON.stringify(we).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Q.stylize(Ee,"string")}if(ne(we))return Q.stylize(""+we,"number");if(me(we))return Q.stylize(""+we,"boolean");if(Oe(we))return Q.stylize("null","null")}function P(Q){return"["+Error.prototype.toString.call(Q)+"]"}function q(Q,we,Ee,je,St){for(var Mt=[],ot=0,It=we.length;ot<It;++ot)et(we,String(ot))?Mt.push(ie(Q,we,Ee,je,String(ot),!0)):Mt.push("");return St.forEach(function(jt){jt.match(/^\d+$/)||Mt.push(ie(Q,we,Ee,je,jt,!0))}),Mt}function ie(Q,we,Ee,je,St,Mt){var ot,It,jt;if(jt=Object.getOwnPropertyDescriptor(we,St)||{value:we[St]},jt.get?jt.set?It=Q.stylize("[Getter/Setter]","special"):It=Q.stylize("[Getter]","special"):jt.set&&(It=Q.stylize("[Setter]","special")),et(je,St)||(ot="["+St+"]"),It||(Q.seen.indexOf(jt.value)<0?(Oe(Ee)?It=L(Q,jt.value,null):It=L(Q,jt.value,Ee-1),It.indexOf(`
`)>-1&&(Mt?It=It.split(`
`).map(function(Qt){return"  "+Qt}).join(`
`).slice(2):It=`
`+It.split(`
`).map(function(Qt){return"   "+Qt}).join(`
`))):It=Q.stylize("[Circular]","special")),Ae(ot)){if(Mt&&St.match(/^\d+$/))return It;ot=JSON.stringify(""+St),ot.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(ot=ot.slice(1,-1),ot=Q.stylize(ot,"name")):(ot=ot.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),ot=Q.stylize(ot,"string"))}return ot+": "+It}function le(Q,we,Ee){var je=Q.reduce(function(St,Mt){return Mt.indexOf(`
`)>=0,St+Mt.replace(/\u001b\[\d\d?m/g,"").length+1},0);return je>60?Ee[0]+(we===""?"":we+`
 `)+" "+Q.join(`,
  `)+" "+Ee[1]:Ee[0]+we+" "+Q.join(", ")+" "+Ee[1]}i.types=Bw();function V(Q){return Array.isArray(Q)}i.isArray=V;function me(Q){return typeof Q=="boolean"}i.isBoolean=me;function Oe(Q){return Q===null}i.isNull=Oe;function Pe(Q){return Q==null}i.isNullOrUndefined=Pe;function ne(Q){return typeof Q=="number"}i.isNumber=ne;function de(Q){return typeof Q=="string"}i.isString=de;function ce(Q){return typeof Q=="symbol"}i.isSymbol=ce;function Ae(Q){return Q===void 0}i.isUndefined=Ae;function Me(Q){return Y(Q)&&wt(Q)==="[object RegExp]"}i.isRegExp=Me,i.types.isRegExp=Me;function Y(Q){return typeof Q=="object"&&Q!==null}i.isObject=Y;function xe(Q){return Y(Q)&&wt(Q)==="[object Date]"}i.isDate=xe,i.types.isDate=xe;function Ge(Q){return Y(Q)&&(wt(Q)==="[object Error]"||Q instanceof Error)}i.isError=Ge,i.types.isNativeError=Ge;function Ye(Q){return typeof Q=="function"}i.isFunction=Ye;function ct(Q){return Q===null||typeof Q=="boolean"||typeof Q=="number"||typeof Q=="string"||typeof Q=="symbol"||typeof Q>"u"}i.isPrimitive=ct,i.isBuffer=Uw();function wt(Q){return Object.prototype.toString.call(Q)}function Et(Q){return Q<10?"0"+Q.toString(10):Q.toString(10)}var Dt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ht(){var Q=new Date,we=[Et(Q.getHours()),Et(Q.getMinutes()),Et(Q.getSeconds())].join(":");return[Q.getDate(),Dt[Q.getMonth()],we].join(" ")}i.log=function(){console.log("%s - %s",ht(),i.format.apply(i,arguments))},i.inherits=$w(),i._extend=function(Q,we){if(!we||!Y(we))return Q;for(var Ee=Object.keys(we),je=Ee.length;je--;)Q[Ee[je]]=we[Ee[je]];return Q};function et(Q,we){return Object.prototype.hasOwnProperty.call(Q,we)}var ft=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;i.promisify=function(we){if(typeof we!="function")throw new TypeError('The "original" argument must be of type Function');if(ft&&we[ft]){var Ee=we[ft];if(typeof Ee!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(Ee,ft,{value:Ee,enumerable:!1,writable:!1,configurable:!0}),Ee}function Ee(){for(var je,St,Mt=new Promise(function(jt,Qt){je=jt,St=Qt}),ot=[],It=0;It<arguments.length;It++)ot.push(arguments[It]);ot.push(function(jt,Qt){jt?St(jt):je(Qt)});try{we.apply(this,ot)}catch(jt){St(jt)}return Mt}return Object.setPrototypeOf(Ee,Object.getPrototypeOf(we)),ft&&Object.defineProperty(Ee,ft,{value:Ee,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(Ee,l(we))},i.promisify.custom=ft;function Ut(Q,we){if(!Q){var Ee=new Error("Promise was rejected with a falsy value");Ee.reason=Q,Q=Ee}return we(Q)}function mt(Q){if(typeof Q!="function")throw new TypeError('The "original" argument must be of type Function');function we(){for(var Ee=[],je=0;je<arguments.length;je++)Ee.push(arguments[je]);var St=Ee.pop();if(typeof St!="function")throw new TypeError("The last argument must be of type Function");var Mt=this,ot=function(){return St.apply(Mt,arguments)};Q.apply(this,Ee).then(function(It){process.nextTick(ot.bind(null,null,It))},function(It){process.nextTick(Ut.bind(null,It,ot))})}return Object.setPrototypeOf(we,Object.getPrototypeOf(Q)),Object.defineProperties(we,l(Q)),we}i.callbackify=mt}(ud)),ud}var jy;function Vw(){return jy||(jy=1,gh.TextEncoder=typeof TextEncoder<"u"?TextEncoder:Vy().TextEncoder,gh.TextDecoder=typeof TextDecoder<"u"?TextDecoder:Vy().TextDecoder),gh}var qy;function qh(){if(qy)return So;qy=1,Object.defineProperty(So,"__esModule",{value:!0}),So.getArrayBuffer=So.decodeBuffer=So.encodeBuffer=void 0;var i=Vw();function l(_){var v=new i.TextEncoder,w=v.encode(_);return f(w)}So.encodeBuffer=l;function c(_,v){var w=new i.TextDecoder(v);return w.decode(_)}So.decodeBuffer=c;function f(_){return _.buffer.slice(_.byteOffset,_.byteOffset+_.byteLength)}return So.getArrayBuffer=f,So}var Gc={},Gy;function jw(){if(Gy)return Gc;Gy=1,Object.defineProperty(Gc,"__esModule",{value:!0}),Gc.uuidv4=void 0;function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){var c=Math.random()*16|0,f=l=="x"?c:c&3|8;return f.toString(16)})}return Gc.uuidv4=i,Gc}var Zy;function Gh(){if(Zy)return qc;Zy=1;var i=yt&&yt.__awaiter||function(o,I,A,L){function R(P){return P instanceof A?P:new A(function(q){q(P)})}return new(A||(A=Promise))(function(P,q){function ie(me){try{V(L.next(me))}catch(Oe){q(Oe)}}function le(me){try{V(L.throw(me))}catch(Oe){q(Oe)}}function V(me){me.done?P(me.value):R(me.value).then(ie,le)}V((L=L.apply(o,I||[])).next())})},l=yt&&yt.__generator||function(o,I){var A={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},L,R,P,q;return q={next:ie(0),throw:ie(1),return:ie(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function ie(V){return function(me){return le([V,me])}}function le(V){if(L)throw new TypeError("Generator is already executing.");for(;A;)try{if(L=1,R&&(P=V[0]&2?R.return:V[0]?R.throw||((P=R.return)&&P.call(R),0):R.next)&&!(P=P.call(R,V[1])).done)return P;switch(R=0,P&&(V=[V[0]&2,P.value]),V[0]){case 0:case 1:P=V;break;case 4:return A.label++,{value:V[1],done:!1};case 5:A.label++,R=V[1],V=[0];continue;case 7:V=A.ops.pop(),A.trys.pop();continue;default:if(P=A.trys,!(P=P.length>0&&P[P.length-1])&&(V[0]===6||V[0]===2)){A=0;continue}if(V[0]===3&&(!P||V[1]>P[0]&&V[1]<P[3])){A.label=V[1];break}if(V[0]===6&&A.label<P[1]){A.label=P[1],P=V;break}if(P&&A.label<P[2]){A.label=P[2],A.ops.push(V);break}P[2]&&A.ops.pop(),A.trys.pop();continue}V=I.call(o,A)}catch(me){V=[6,me],R=0}finally{L=P=0}if(V[0]&5)throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}};Object.defineProperty(qc,"__esModule",{value:!0}),qc.IsomorphicRequest=void 0;var c=ls,f=la(),_=qh(),v=jw(),w=function(){function o(I,A){A===void 0&&(A={});var L=new ArrayBuffer(0);if(this._bodyUsed=!1,I instanceof o){this.id=I.id,this.url=I.url,this.method=I.method,this.headers=I.headers,this.credentials=I.credentials,this._body=I._body||L;return}this.id=v.uuidv4(),this.url=I,this.method=A.method||"GET",this.headers=new c.Headers(A.headers),this.credentials=A.credentials||"same-origin",this._body=A.body||L}return Object.defineProperty(o.prototype,"bodyUsed",{get:function(){return this._bodyUsed},enumerable:!1,configurable:!0}),o.prototype.text=function(){return i(this,void 0,void 0,function(){return l(this,function(I){return f.invariant(!this.bodyUsed,'Failed to execute "text" on "IsomorphicRequest": body buffer already read'),this._bodyUsed=!0,[2,_.decodeBuffer(this._body)]})})},o.prototype.json=function(){return i(this,void 0,void 0,function(){var I;return l(this,function(A){return f.invariant(!this.bodyUsed,'Failed to execute "json" on "IsomorphicRequest": body buffer already read'),this._bodyUsed=!0,I=_.decodeBuffer(this._body),[2,JSON.parse(I)]})})},o.prototype.arrayBuffer=function(){return i(this,void 0,void 0,function(){return l(this,function(I){return f.invariant(!this.bodyUsed,'Failed to execute "arrayBuffer" on "IsomorphicRequest": body buffer already read'),this._bodyUsed=!0,[2,this._body]})})},o.prototype.clone=function(){return new o(this)},o}();return qc.IsomorphicRequest=w,qc}var Zc={},Hc={},Hy;function qw(){if(Hy)return Hc;Hy=1;var i=yt&&yt.__awaiter||function(f,_,v,w){function o(I){return I instanceof v?I:new v(function(A){A(I)})}return new(v||(v=Promise))(function(I,A){function L(q){try{P(w.next(q))}catch(ie){A(ie)}}function R(q){try{P(w.throw(q))}catch(ie){A(ie)}}function P(q){q.done?I(q.value):o(q.value).then(L,R)}P((w=w.apply(f,_||[])).next())})},l=yt&&yt.__generator||function(f,_){var v={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},w,o,I,A;return A={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(A[Symbol.iterator]=function(){return this}),A;function L(P){return function(q){return R([P,q])}}function R(P){if(w)throw new TypeError("Generator is already executing.");for(;v;)try{if(w=1,o&&(I=P[0]&2?o.return:P[0]?o.throw||((I=o.return)&&I.call(o),0):o.next)&&!(I=I.call(o,P[1])).done)return I;switch(o=0,I&&(P=[P[0]&2,I.value]),P[0]){case 0:case 1:I=P;break;case 4:return v.label++,{value:P[1],done:!1};case 5:v.label++,o=P[1],P=[0];continue;case 7:P=v.ops.pop(),v.trys.pop();continue;default:if(I=v.trys,!(I=I.length>0&&I[I.length-1])&&(P[0]===6||P[0]===2)){v=0;continue}if(P[0]===3&&(!I||P[1]>I[0]&&P[1]<I[3])){v.label=P[1];break}if(P[0]===6&&v.label<I[1]){v.label=I[1],I=P;break}if(I&&v.label<I[2]){v.label=I[2],v.ops.push(P);break}I[2]&&v.ops.pop(),v.trys.pop();continue}P=_.call(f,v)}catch(q){P=[6,q],o=0}finally{w=I=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}};Object.defineProperty(Hc,"__esModule",{value:!0}),Hc.createLazyCallback=void 0;function c(f){var _=this;f===void 0&&(f={});var v=0,w,o,I=new Promise(function(L){o=L}).finally(function(){clearTimeout(w)}),A=function(){for(var L,R=[],P=0;P<arguments.length;P++)R[P]=arguments[P];f.maxCalls&&v>=f.maxCalls&&((L=f.maxCallsCallback)===null||L===void 0||L.call(f)),o(R),v++};return A.invoked=function(){return i(_,void 0,void 0,function(){return l(this,function(L){return w=setTimeout(function(){o([])},0),[2,I]})})},A}return Hc.createLazyCallback=c,Hc}var Wy;function mf(){if(Wy)return Zc;Wy=1;var i=yt&&yt.__extends||function(){var v=function(w,o){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,A){I.__proto__=A}||function(I,A){for(var L in A)Object.prototype.hasOwnProperty.call(A,L)&&(I[L]=A[L])},v(w,o)};return function(w,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");v(w,o);function I(){this.constructor=w}w.prototype=o===null?Object.create(o):(I.prototype=o.prototype,new I)}}();Object.defineProperty(Zc,"__esModule",{value:!0}),Zc.InteractiveIsomorphicRequest=void 0;var l=la(),c=Gh(),f=qw(),_=function(v){i(w,v);function w(o){var I=v.call(this,o)||this;return I.respondWith=f.createLazyCallback({maxCalls:1,maxCallsCallback:function(){l.invariant(!1,'Failed to respond to "%s %s" request: the "request" event has already been responded to.',I.method,I.url.href)}}),I}return w}(c.IsomorphicRequest);return Zc.InteractiveIsomorphicRequest=_,Zc}var Wc={},Xy;function ev(){if(Xy)return Wc;Xy=1,Object.defineProperty(Wc,"__esModule",{value:!0}),Wc.getCleanUrl=void 0;function i(l,c){return c===void 0&&(c=!0),[c&&l.origin,l.pathname].filter(Boolean).join("")}return Wc.getCleanUrl=i,Wc}var Yy;function yh(){return Yy||(Yy=1,function(i){var l=yt&&yt.__createBinding||(Object.create?function(v,w,o,I){I===void 0&&(I=o),Object.defineProperty(v,I,{enumerable:!0,get:function(){return w[o]}})}:function(v,w,o,I){I===void 0&&(I=o),v[I]=w[o]}),c=yt&&yt.__exportStar||function(v,w){for(var o in v)o!=="default"&&!Object.prototype.hasOwnProperty.call(w,o)&&l(w,v,o)};Object.defineProperty(i,"__esModule",{value:!0}),i.decodeBuffer=i.encodeBuffer=i.getCleanUrl=void 0,c(hf(),i),c(Uh(),i),c(xw(),i),c(Gh(),i),c(mf(),i);var f=ev();Object.defineProperty(i,"getCleanUrl",{enumerable:!0,get:function(){return f.getCleanUrl}});var _=qh();Object.defineProperty(i,"encodeBuffer",{enumerable:!0,get:function(){return _.encodeBuffer}}),Object.defineProperty(i,"decodeBuffer",{enumerable:!0,get:function(){return _.decodeBuffer}})}(id)),id}var $d={},Vd={},Ya={},Gw={get exports(){return Ya},set exports(i){Ya=i}},Jy;function Zw(){if(Jy)return Ya;Jy=1;var i={decodeValues:!0,map:!1,silent:!1};function l(w){return typeof w=="string"&&!!w.trim()}function c(w,o){var I=w.split(";").filter(l),A=I.shift(),L=f(A),R=L.name,P=L.value;o=o?Object.assign({},i,o):i;try{P=o.decodeValues?decodeURIComponent(P):P}catch(ie){console.error("set-cookie-parser encountered an error while decoding a cookie with value '"+P+"'. Set options.decodeValues to false to disable this feature.",ie)}var q={name:R,value:P};return I.forEach(function(ie){var le=ie.split("="),V=le.shift().trimLeft().toLowerCase(),me=le.join("=");V==="expires"?q.expires=new Date(me):V==="max-age"?q.maxAge=parseInt(me,10):V==="secure"?q.secure=!0:V==="httponly"?q.httpOnly=!0:V==="samesite"?q.sameSite=me:q[V]=me}),q}function f(w){var o="",I="",A=w.split("=");return A.length>1?(o=A.shift(),I=A.join("=")):I=w,{name:o,value:I}}function _(w,o){if(o=o?Object.assign({},i,o):i,!w)return o.map?{}:[];if(w.headers&&w.headers["set-cookie"])w=w.headers["set-cookie"];else if(w.headers){var I=w.headers[Object.keys(w.headers).find(function(L){return L.toLowerCase()==="set-cookie"})];!I&&w.headers.cookie&&!o.silent&&console.warn("Warning: set-cookie-parser appears to have been called on a request object. It is designed to parse Set-Cookie headers from responses, not Cookie headers from requests. Set the option {silent: true} to suppress this warning."),w=I}if(Array.isArray(w)||(w=[w]),o=o?Object.assign({},i,o):i,o.map){var A={};return w.filter(l).reduce(function(L,R){var P=c(R,o);return L[P.name]=P,L},A)}else return w.filter(l).map(function(L){return c(L,o)})}function v(w){if(Array.isArray(w))return w;if(typeof w!="string")return[];var o=[],I=0,A,L,R,P,q;function ie(){for(;I<w.length&&/\s/.test(w.charAt(I));)I+=1;return I<w.length}function le(){return L=w.charAt(I),L!=="="&&L!==";"&&L!==","}for(;I<w.length;){for(A=I,q=!1;ie();)if(L=w.charAt(I),L===","){for(R=I,I+=1,ie(),P=I;I<w.length&&le();)I+=1;I<w.length&&w.charAt(I)==="="?(q=!0,I=P,o.push(w.substring(A,R)),A=I):I=R+1}else I+=1;(!q||I>=w.length)&&o.push(w.substring(A,w.length))}return o}return Gw.exports=_,Ya.parse=_,Ya.parseString=c,Ya.splitCookiesString=v,Ya}var Ky;function Hw(){return Ky||(Ky=1,function(i){var l=yt&&yt.__rest||function(v,w){var o={};for(var I in v)Object.prototype.hasOwnProperty.call(v,I)&&w.indexOf(I)<0&&(o[I]=v[I]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function")for(var A=0,I=Object.getOwnPropertySymbols(v);A<I.length;A++)w.indexOf(I[A])<0&&Object.prototype.propertyIsEnumerable.call(v,I[A])&&(o[I[A]]=v[I[A]]);return o};Object.defineProperty(i,"__esModule",{value:!0}),i.store=i.PERSISTENCY_KEY=void 0;const c=Zw();i.PERSISTENCY_KEY="MSW_COOKIE_STORE";function f(){try{if(localStorage==null)return!1;const v=i.PERSISTENCY_KEY+"_test";return localStorage.setItem(v,"test"),localStorage.getItem(v),localStorage.removeItem(v),!0}catch{return!1}}class _{constructor(){this.store=new Map}add(w,o){if(w.credentials==="omit")return;const I=new URL(w.url),A=o.headers.get("set-cookie");if(!A)return;const L=Date.now(),R=c.parse(A).map(q=>{var{maxAge:ie}=q,le=l(q,["maxAge"]);return Object.assign(Object.assign({},le),{expires:ie===void 0?le.expires:new Date(L+ie*1e3),maxAge:ie})}),P=this.store.get(I.origin)||new Map;R.forEach(q=>{this.store.set(I.origin,P.set(q.name,q))})}get(w){this.deleteExpiredCookies();const o=new URL(w.url),I=this.store.get(o.origin)||new Map;switch(w.credentials){case"include":return typeof document>"u"||c.parse(document.cookie).forEach(L=>{I.set(L.name,L)}),I;case"same-origin":return I;default:return new Map}}getAll(){return this.deleteExpiredCookies(),this.store}deleteAll(w){const o=new URL(w.url);this.store.delete(o.origin)}clear(){this.store.clear()}hydrate(){if(!f())return;const w=localStorage.getItem(i.PERSISTENCY_KEY);if(w)try{JSON.parse(w).forEach(([I,A])=>{this.store.set(I,new Map(A.map(L=>{var[R,P]=L,{expires:q}=P,ie=l(P,["expires"]);return[R,q===void 0?ie:Object.assign(Object.assign({},ie),{expires:new Date(q)})]})))})}catch(o){console.warn(`
[virtual-cookie] Failed to parse a stored cookie from the localStorage (key "${i.PERSISTENCY_KEY}").

Stored value:
${localStorage.getItem(i.PERSISTENCY_KEY)}

Thrown exception:
${o}

Invalid value has been removed from localStorage to prevent subsequent failed parsing attempts.`),localStorage.removeItem(i.PERSISTENCY_KEY)}}persist(){if(!f())return;const w=Array.from(this.store.entries()).map(([o,I])=>[o,Array.from(I.entries())]);localStorage.setItem(i.PERSISTENCY_KEY,JSON.stringify(w))}deleteExpiredCookies(){const w=Date.now();this.store.forEach((o,I)=>{o.forEach(({expires:A,name:L})=>{A!==void 0&&A.getTime()<=w&&o.delete(L)}),o.size===0&&this.store.delete(I)})}}i.store=new _}(Vd)),Vd}var Qy;function e_(){return Qy||(Qy=1,function(i){var l=yt&&yt.__createBinding||(Object.create?function(f,_,v,w){w===void 0&&(w=v),Object.defineProperty(f,w,{enumerable:!0,get:function(){return _[v]}})}:function(f,_,v,w){w===void 0&&(w=v),f[w]=_[v]}),c=yt&&yt.__exportStar||function(f,_){for(var v in f)v!=="default"&&!Object.prototype.hasOwnProperty.call(_,v)&&l(_,f,v)};Object.defineProperty(i,"__esModule",{value:!0}),c(Hw(),i)}($d)),$d}var jd,t_;function Ww(){return t_||(t_=1,jd=function(){function i(l,c,f,_,v){return l<c||f<c?l>f?f+1:l+1:_===v?c:c+1}return function(l,c){if(l===c)return 0;if(l.length>c.length){var f=l;l=c,c=f}for(var _=l.length,v=c.length;_>0&&l.charCodeAt(_-1)===c.charCodeAt(v-1);)_--,v--;for(var w=0;w<_&&l.charCodeAt(w)===c.charCodeAt(w);)w++;if(_-=w,v-=w,_===0||v<3)return v;var o=0,I,A,L,R,P,q,ie,le,V,me,Oe,Pe,ne=[];for(I=0;I<_;I++)ne.push(I+1),ne.push(l.charCodeAt(w+I));for(var de=ne.length-1;o<v-3;)for(V=c.charCodeAt(w+(A=o)),me=c.charCodeAt(w+(L=o+1)),Oe=c.charCodeAt(w+(R=o+2)),Pe=c.charCodeAt(w+(P=o+3)),q=o+=4,I=0;I<de;I+=2)ie=ne[I],le=ne[I+1],A=i(ie,A,L,V,le),L=i(A,L,R,me,le),R=i(L,R,P,Oe,le),q=i(R,P,q,Pe,le),ne[I]=q,P=R,R=L,L=A,A=ie;for(;o<v;)for(V=c.charCodeAt(w+(A=o)),q=++o,I=0;I<de;I+=2)ie=ne[I],ne[I]=q=i(ie,A,q,V,ne[I+1]),A=ie;return q}}()),jd}const Xw="16.6.0",Yw=Object.freeze({major:16,minor:6,patch:0,preReleaseTag:null});function fr(i,l){if(!Boolean(i))throw new Error(l)}function Gi(i){return typeof(i==null?void 0:i.then)=="function"}function Zi(i){return typeof i=="object"&&i!==null}function En(i,l){if(!Boolean(i))throw new Error(l??"Unexpected invariant triggered.")}const Jw=/\r\n|[\n\r]/g;function kh(i,l){let c=0,f=1;for(const _ of i.body.matchAll(Jw)){if(typeof _.index=="number"||En(!1),_.index>=l)break;c=_.index+_[0].length,f+=1}return{line:f,column:l+1-c}}function tv(i){return gf(i.source,kh(i.source,i.start))}function gf(i,l){const c=i.locationOffset.column-1,f="".padStart(c)+i.body,_=l.line-1,v=i.locationOffset.line-1,w=l.line+v,o=l.line===1?c:0,I=l.column+o,A=`${i.name}:${w}:${I}
`,L=f.split(/\r\n|[\n\r]/g),R=L[_];if(R.length>120){const P=Math.floor(I/80),q=I%80,ie=[];for(let le=0;le<R.length;le+=80)ie.push(R.slice(le,le+80));return A+r_([[`${w} |`,ie[0]],...ie.slice(1,P+1).map(le=>["|",le]),["|","^".padStart(q)],["|",ie[P+1]]])}return A+r_([[`${w-1} |`,L[_-1]],[`${w} |`,R],["|","^".padStart(I)],[`${w+1} |`,L[_+1]]])}function r_(i){const l=i.filter(([f,_])=>_!==void 0),c=Math.max(...l.map(([f])=>f.length));return l.map(([f,_])=>f.padStart(c)+(_?" "+_:"")).join(`
`)}function Kw(i){const l=i[0];return l==null||"kind"in l||"length"in l?{nodes:l,source:i[1],positions:i[2],path:i[3],originalError:i[4],extensions:i[5]}:l}class Ze extends Error{constructor(l,...c){var f,_,v;const{nodes:w,source:o,positions:I,path:A,originalError:L,extensions:R}=Kw(c);super(l),this.name="GraphQLError",this.path=A??void 0,this.originalError=L??void 0,this.nodes=n_(Array.isArray(w)?w:w?[w]:void 0);const P=n_((f=this.nodes)===null||f===void 0?void 0:f.map(ie=>ie.loc).filter(ie=>ie!=null));this.source=o??(P==null||(_=P[0])===null||_===void 0?void 0:_.source),this.positions=I??(P==null?void 0:P.map(ie=>ie.start)),this.locations=I&&o?I.map(ie=>kh(o,ie)):P==null?void 0:P.map(ie=>kh(ie.source,ie.start));const q=Zi(L==null?void 0:L.extensions)?L==null?void 0:L.extensions:void 0;this.extensions=(v=R??q)!==null&&v!==void 0?v:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),L!=null&&L.stack?Object.defineProperty(this,"stack",{value:L.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,Ze):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let l=this.message;if(this.nodes)for(const c of this.nodes)c.loc&&(l+=`

`+tv(c.loc));else if(this.source&&this.locations)for(const c of this.locations)l+=`

`+gf(this.source,c);return l}toJSON(){const l={message:this.message};return this.locations!=null&&(l.locations=this.locations),this.path!=null&&(l.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(l.extensions=this.extensions),l}}function n_(i){return i===void 0||i.length===0?void 0:i}function Qw(i){return i.toString()}function e1(i){return i.toJSON()}function Mn(i,l,c){return new Ze(`Syntax Error: ${c}`,{source:i,positions:[l]})}class rv{constructor(l,c,f){this.start=l.start,this.end=c.end,this.startToken=l,this.endToken=c,this.source=f}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class yf{constructor(l,c,f,_,v,w){this.kind=l,this.start=c,this.end=f,this.line=_,this.column=v,this.value=w,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const nv={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},t1=new Set(Object.keys(nv));function Kd(i){const l=i==null?void 0:i.kind;return typeof l=="string"&&t1.has(l)}var On;(function(i){i.QUERY="query",i.MUTATION="mutation",i.SUBSCRIPTION="subscription"})(On||(On={}));var Wt;(function(i){i.QUERY="QUERY",i.MUTATION="MUTATION",i.SUBSCRIPTION="SUBSCRIPTION",i.FIELD="FIELD",i.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",i.FRAGMENT_SPREAD="FRAGMENT_SPREAD",i.INLINE_FRAGMENT="INLINE_FRAGMENT",i.VARIABLE_DEFINITION="VARIABLE_DEFINITION",i.SCHEMA="SCHEMA",i.SCALAR="SCALAR",i.OBJECT="OBJECT",i.FIELD_DEFINITION="FIELD_DEFINITION",i.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",i.INTERFACE="INTERFACE",i.UNION="UNION",i.ENUM="ENUM",i.ENUM_VALUE="ENUM_VALUE",i.INPUT_OBJECT="INPUT_OBJECT",i.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"})(Wt||(Wt={}));var fe;(function(i){i.NAME="Name",i.DOCUMENT="Document",i.OPERATION_DEFINITION="OperationDefinition",i.VARIABLE_DEFINITION="VariableDefinition",i.SELECTION_SET="SelectionSet",i.FIELD="Field",i.ARGUMENT="Argument",i.FRAGMENT_SPREAD="FragmentSpread",i.INLINE_FRAGMENT="InlineFragment",i.FRAGMENT_DEFINITION="FragmentDefinition",i.VARIABLE="Variable",i.INT="IntValue",i.FLOAT="FloatValue",i.STRING="StringValue",i.BOOLEAN="BooleanValue",i.NULL="NullValue",i.ENUM="EnumValue",i.LIST="ListValue",i.OBJECT="ObjectValue",i.OBJECT_FIELD="ObjectField",i.DIRECTIVE="Directive",i.NAMED_TYPE="NamedType",i.LIST_TYPE="ListType",i.NON_NULL_TYPE="NonNullType",i.SCHEMA_DEFINITION="SchemaDefinition",i.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",i.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",i.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",i.FIELD_DEFINITION="FieldDefinition",i.INPUT_VALUE_DEFINITION="InputValueDefinition",i.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",i.UNION_TYPE_DEFINITION="UnionTypeDefinition",i.ENUM_TYPE_DEFINITION="EnumTypeDefinition",i.ENUM_VALUE_DEFINITION="EnumValueDefinition",i.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",i.DIRECTIVE_DEFINITION="DirectiveDefinition",i.SCHEMA_EXTENSION="SchemaExtension",i.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",i.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",i.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",i.UNION_TYPE_EXTENSION="UnionTypeExtension",i.ENUM_TYPE_EXTENSION="EnumTypeExtension",i.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"})(fe||(fe={}));function Qd(i){return i===9||i===32}function _u(i){return i>=48&&i<=57}function iv(i){return i>=97&&i<=122||i>=65&&i<=90}function _f(i){return iv(i)||i===95}function sv(i){return iv(i)||_u(i)||i===95}function r1(i){var l;let c=Number.MAX_SAFE_INTEGER,f=null,_=-1;for(let w=0;w<i.length;++w){var v;const o=i[w],I=n1(o);I!==o.length&&(f=(v=f)!==null&&v!==void 0?v:w,_=w,w!==0&&I<c&&(c=I))}return i.map((w,o)=>o===0?w:w.slice(c)).slice((l=f)!==null&&l!==void 0?l:0,_+1)}function n1(i){let l=0;for(;l<i.length&&Qd(i.charCodeAt(l));)++l;return l}function i1(i){if(i==="")return!0;let l=!0,c=!1,f=!0,_=!1;for(let v=0;v<i.length;++v)switch(i.codePointAt(v)){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 11:case 12:case 14:case 15:return!1;case 13:return!1;case 10:if(l&&!_)return!1;_=!0,l=!0,c=!1;break;case 9:case 32:c||(c=l);break;default:f&&(f=c),l=!1}return!(l||f&&_)}function ov(i,l){const c=i.replace(/"""/g,'\\"""'),f=c.split(/\r\n|[\n\r]/g),_=f.length===1,v=f.length>1&&f.slice(1).every(q=>q.length===0||Qd(q.charCodeAt(0))),w=c.endsWith('\\"""'),o=i.endsWith('"')&&!w,I=i.endsWith("\\"),A=o||I,L=!(l!=null&&l.minimize)&&(!_||i.length>70||A||v||w);let R="";const P=_&&Qd(i.charCodeAt(0));return(L&&!P||v)&&(R+=`
`),R+=c,(L||A)&&(R+=`
`),'"""'+R+'"""'}var Je;(function(i){i.SOF="<SOF>",i.EOF="<EOF>",i.BANG="!",i.DOLLAR="$",i.AMP="&",i.PAREN_L="(",i.PAREN_R=")",i.SPREAD="...",i.COLON=":",i.EQUALS="=",i.AT="@",i.BRACKET_L="[",i.BRACKET_R="]",i.BRACE_L="{",i.PIPE="|",i.BRACE_R="}",i.NAME="Name",i.INT="Int",i.FLOAT="Float",i.STRING="String",i.BLOCK_STRING="BlockString",i.COMMENT="Comment"})(Je||(Je={}));class vf{constructor(l){const c=new yf(Je.SOF,0,0,0,0);this.source=l,this.lastToken=c,this.token=c,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let l=this.token;if(l.kind!==Je.EOF)do if(l.next)l=l.next;else{const c=s1(this,l.end);l.next=c,c.prev=l,l=c}while(l.kind===Je.COMMENT);return l}}function av(i){return i===Je.BANG||i===Je.DOLLAR||i===Je.AMP||i===Je.PAREN_L||i===Je.PAREN_R||i===Je.SPREAD||i===Je.COLON||i===Je.EQUALS||i===Je.AT||i===Je.BRACKET_L||i===Je.BRACKET_R||i===Je.BRACE_L||i===Je.PIPE||i===Je.BRACE_R}function Zl(i){return i>=0&&i<=55295||i>=57344&&i<=1114111}function Zh(i,l){return lv(i.charCodeAt(l))&&cv(i.charCodeAt(l+1))}function lv(i){return i>=55296&&i<=56319}function cv(i){return i>=56320&&i<=57343}function Ka(i,l){const c=i.source.body.codePointAt(l);if(c===void 0)return Je.EOF;if(c>=32&&c<=126){const f=String.fromCodePoint(c);return f==='"'?`'"'`:`"${f}"`}return"U+"+c.toString(16).toUpperCase().padStart(4,"0")}function Sn(i,l,c,f,_){const v=i.line,w=1+c-i.lineStart;return new yf(l,c,f,v,w,_)}function s1(i,l){const c=i.source.body,f=c.length;let _=l;for(;_<f;){const v=c.charCodeAt(_);switch(v){case 65279:case 9:case 32:case 44:++_;continue;case 10:++_,++i.line,i.lineStart=_;continue;case 13:c.charCodeAt(_+1)===10?_+=2:++_,++i.line,i.lineStart=_;continue;case 35:return o1(i,_);case 33:return Sn(i,Je.BANG,_,_+1);case 36:return Sn(i,Je.DOLLAR,_,_+1);case 38:return Sn(i,Je.AMP,_,_+1);case 40:return Sn(i,Je.PAREN_L,_,_+1);case 41:return Sn(i,Je.PAREN_R,_,_+1);case 46:if(c.charCodeAt(_+1)===46&&c.charCodeAt(_+2)===46)return Sn(i,Je.SPREAD,_,_+3);break;case 58:return Sn(i,Je.COLON,_,_+1);case 61:return Sn(i,Je.EQUALS,_,_+1);case 64:return Sn(i,Je.AT,_,_+1);case 91:return Sn(i,Je.BRACKET_L,_,_+1);case 93:return Sn(i,Je.BRACKET_R,_,_+1);case 123:return Sn(i,Je.BRACE_L,_,_+1);case 124:return Sn(i,Je.PIPE,_,_+1);case 125:return Sn(i,Je.BRACE_R,_,_+1);case 34:return c.charCodeAt(_+1)===34&&c.charCodeAt(_+2)===34?p1(i,_):l1(i,_)}if(_u(v)||v===45)return a1(i,_,v);if(_f(v))return d1(i,_);throw Mn(i.source,_,v===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:Zl(v)||Zh(c,_)?`Unexpected character: ${Ka(i,_)}.`:`Invalid character: ${Ka(i,_)}.`)}return Sn(i,Je.EOF,f,f)}function o1(i,l){const c=i.source.body,f=c.length;let _=l+1;for(;_<f;){const v=c.charCodeAt(_);if(v===10||v===13)break;if(Zl(v))++_;else if(Zh(c,_))_+=2;else break}return Sn(i,Je.COMMENT,l,_,c.slice(l+1,_))}function a1(i,l,c){const f=i.source.body;let _=l,v=c,w=!1;if(v===45&&(v=f.charCodeAt(++_)),v===48){if(v=f.charCodeAt(++_),_u(v))throw Mn(i.source,_,`Invalid number, unexpected digit after 0: ${Ka(i,_)}.`)}else _=qd(i,_,v),v=f.charCodeAt(_);if(v===46&&(w=!0,v=f.charCodeAt(++_),_=qd(i,_,v),v=f.charCodeAt(_)),(v===69||v===101)&&(w=!0,v=f.charCodeAt(++_),(v===43||v===45)&&(v=f.charCodeAt(++_)),_=qd(i,_,v),v=f.charCodeAt(_)),v===46||_f(v))throw Mn(i.source,_,`Invalid number, expected digit but got: ${Ka(i,_)}.`);return Sn(i,w?Je.FLOAT:Je.INT,l,_,f.slice(l,_))}function qd(i,l,c){if(!_u(c))throw Mn(i.source,l,`Invalid number, expected digit but got: ${Ka(i,l)}.`);const f=i.source.body;let _=l+1;for(;_u(f.charCodeAt(_));)++_;return _}function l1(i,l){const c=i.source.body,f=c.length;let _=l+1,v=_,w="";for(;_<f;){const o=c.charCodeAt(_);if(o===34)return w+=c.slice(v,_),Sn(i,Je.STRING,l,_+1,w);if(o===92){w+=c.slice(v,_);const I=c.charCodeAt(_+1)===117?c.charCodeAt(_+2)===123?c1(i,_):u1(i,_):h1(i,_);w+=I.value,_+=I.size,v=_;continue}if(o===10||o===13)break;if(Zl(o))++_;else if(Zh(c,_))_+=2;else throw Mn(i.source,_,`Invalid character within String: ${Ka(i,_)}.`)}throw Mn(i.source,_,"Unterminated string.")}function c1(i,l){const c=i.source.body;let f=0,_=3;for(;_<12;){const v=c.charCodeAt(l+_++);if(v===125){if(_<5||!Zl(f))break;return{value:String.fromCodePoint(f),size:_}}if(f=f<<4|cu(v),f<0)break}throw Mn(i.source,l,`Invalid Unicode escape sequence: "${c.slice(l,l+_)}".`)}function u1(i,l){const c=i.source.body,f=i_(c,l+2);if(Zl(f))return{value:String.fromCodePoint(f),size:6};if(lv(f)&&c.charCodeAt(l+6)===92&&c.charCodeAt(l+7)===117){const _=i_(c,l+8);if(cv(_))return{value:String.fromCodePoint(f,_),size:12}}throw Mn(i.source,l,`Invalid Unicode escape sequence: "${c.slice(l,l+6)}".`)}function i_(i,l){return cu(i.charCodeAt(l))<<12|cu(i.charCodeAt(l+1))<<8|cu(i.charCodeAt(l+2))<<4|cu(i.charCodeAt(l+3))}function cu(i){return i>=48&&i<=57?i-48:i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:-1}function h1(i,l){const c=i.source.body;switch(c.charCodeAt(l+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:`
`,size:2};case 114:return{value:"\r",size:2};case 116:return{value:"	",size:2}}throw Mn(i.source,l,`Invalid character escape sequence: "${c.slice(l,l+2)}".`)}function p1(i,l){const c=i.source.body,f=c.length;let _=i.lineStart,v=l+3,w=v,o="";const I=[];for(;v<f;){const A=c.charCodeAt(v);if(A===34&&c.charCodeAt(v+1)===34&&c.charCodeAt(v+2)===34){o+=c.slice(w,v),I.push(o);const L=Sn(i,Je.BLOCK_STRING,l,v+3,r1(I).join(`
`));return i.line+=I.length-1,i.lineStart=_,L}if(A===92&&c.charCodeAt(v+1)===34&&c.charCodeAt(v+2)===34&&c.charCodeAt(v+3)===34){o+=c.slice(w,v),w=v+1,v+=4;continue}if(A===10||A===13){o+=c.slice(w,v),I.push(o),A===13&&c.charCodeAt(v+1)===10?v+=2:++v,o="",w=v,_=v;continue}if(Zl(A))++v;else if(Zh(c,v))v+=2;else throw Mn(i.source,v,`Invalid character within String: ${Ka(i,v)}.`)}throw Mn(i.source,v,"Unterminated string.")}function d1(i,l){const c=i.source.body,f=c.length;let _=l+1;for(;_<f;){const v=c.charCodeAt(_);if(sv(v))++_;else break}return Sn(i,Je.NAME,l,_,c.slice(l,_))}const f1=10,uv=2;function Ke(i){return Hh(i,[])}function Hh(i,l){switch(typeof i){case"string":return JSON.stringify(i);case"function":return i.name?`[function ${i.name}]`:"[function]";case"object":return m1(i,l);default:return String(i)}}function m1(i,l){if(i===null)return"null";if(l.includes(i))return"[Circular]";const c=[...l,i];if(g1(i)){const f=i.toJSON();if(f!==i)return typeof f=="string"?f:Hh(f,c)}else if(Array.isArray(i))return _1(i,c);return y1(i,c)}function g1(i){return typeof i.toJSON=="function"}function y1(i,l){const c=Object.entries(i);return c.length===0?"{}":l.length>uv?"["+v1(i)+"]":"{ "+c.map(([_,v])=>_+": "+Hh(v,l)).join(", ")+" }"}function _1(i,l){if(i.length===0)return"[]";if(l.length>uv)return"[Array]";const c=Math.min(f1,i.length),f=i.length-c,_=[];for(let v=0;v<c;++v)_.push(Hh(i[v],l));return f===1?_.push("... 1 more item"):f>1&&_.push(`... ${f} more items`),"["+_.join(", ")+"]"}function v1(i){const l=Object.prototype.toString.call(i).replace(/^\[object /,"").replace(/]$/,"");if(l==="Object"&&typeof i.constructor=="function"){const c=i.constructor.name;if(typeof c=="string"&&c!=="")return c}return l}const Os=function(l,c){return l instanceof c};class Wh{constructor(l,c="GraphQL request",f={line:1,column:1}){typeof l=="string"||fr(!1,`Body must be a string. Received: ${Ke(l)}.`),this.body=l,this.name=c,this.locationOffset=f,this.locationOffset.line>0||fr(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||fr(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}function hv(i){return Os(i,Wh)}function Xh(i,l){return new Yh(i,l).parseDocument()}function pv(i,l){const c=new Yh(i,l);c.expectToken(Je.SOF);const f=c.parseValueLiteral(!1);return c.expectToken(Je.EOF),f}function x1(i,l){const c=new Yh(i,l);c.expectToken(Je.SOF);const f=c.parseConstValueLiteral();return c.expectToken(Je.EOF),f}function b1(i,l){const c=new Yh(i,l);c.expectToken(Je.SOF);const f=c.parseTypeReference();return c.expectToken(Je.EOF),f}class Yh{constructor(l,c={}){const f=hv(l)?l:new Wh(l);this._lexer=new vf(f),this._options=c,this._tokenCounter=0}parseName(){const l=this.expectToken(Je.NAME);return this.node(l,{kind:fe.NAME,value:l.value})}parseDocument(){return this.node(this._lexer.token,{kind:fe.DOCUMENT,definitions:this.many(Je.SOF,this.parseDefinition,Je.EOF)})}parseDefinition(){if(this.peek(Je.BRACE_L))return this.parseOperationDefinition();const l=this.peekDescription(),c=l?this._lexer.lookahead():this._lexer.token;if(c.kind===Je.NAME){switch(c.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(l)throw Mn(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(c.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(c)}parseOperationDefinition(){const l=this._lexer.token;if(this.peek(Je.BRACE_L))return this.node(l,{kind:fe.OPERATION_DEFINITION,operation:On.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const c=this.parseOperationType();let f;return this.peek(Je.NAME)&&(f=this.parseName()),this.node(l,{kind:fe.OPERATION_DEFINITION,operation:c,name:f,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const l=this.expectToken(Je.NAME);switch(l.value){case"query":return On.QUERY;case"mutation":return On.MUTATION;case"subscription":return On.SUBSCRIPTION}throw this.unexpected(l)}parseVariableDefinitions(){return this.optionalMany(Je.PAREN_L,this.parseVariableDefinition,Je.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:fe.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(Je.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(Je.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const l=this._lexer.token;return this.expectToken(Je.DOLLAR),this.node(l,{kind:fe.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:fe.SELECTION_SET,selections:this.many(Je.BRACE_L,this.parseSelection,Je.BRACE_R)})}parseSelection(){return this.peek(Je.SPREAD)?this.parseFragment():this.parseField()}parseField(){const l=this._lexer.token,c=this.parseName();let f,_;return this.expectOptionalToken(Je.COLON)?(f=c,_=this.parseName()):_=c,this.node(l,{kind:fe.FIELD,alias:f,name:_,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(Je.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(l){const c=l?this.parseConstArgument:this.parseArgument;return this.optionalMany(Je.PAREN_L,c,Je.PAREN_R)}parseArgument(l=!1){const c=this._lexer.token,f=this.parseName();return this.expectToken(Je.COLON),this.node(c,{kind:fe.ARGUMENT,name:f,value:this.parseValueLiteral(l)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const l=this._lexer.token;this.expectToken(Je.SPREAD);const c=this.expectOptionalKeyword("on");return!c&&this.peek(Je.NAME)?this.node(l,{kind:fe.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(l,{kind:fe.INLINE_FRAGMENT,typeCondition:c?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const l=this._lexer.token;return this.expectKeyword("fragment"),this._options.allowLegacyFragmentVariables===!0?this.node(l,{kind:fe.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(l,{kind:fe.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()}parseValueLiteral(l){const c=this._lexer.token;switch(c.kind){case Je.BRACKET_L:return this.parseList(l);case Je.BRACE_L:return this.parseObject(l);case Je.INT:return this.advanceLexer(),this.node(c,{kind:fe.INT,value:c.value});case Je.FLOAT:return this.advanceLexer(),this.node(c,{kind:fe.FLOAT,value:c.value});case Je.STRING:case Je.BLOCK_STRING:return this.parseStringLiteral();case Je.NAME:switch(this.advanceLexer(),c.value){case"true":return this.node(c,{kind:fe.BOOLEAN,value:!0});case"false":return this.node(c,{kind:fe.BOOLEAN,value:!1});case"null":return this.node(c,{kind:fe.NULL});default:return this.node(c,{kind:fe.ENUM,value:c.value})}case Je.DOLLAR:if(l)if(this.expectToken(Je.DOLLAR),this._lexer.token.kind===Je.NAME){const f=this._lexer.token.value;throw Mn(this._lexer.source,c.start,`Unexpected variable "$${f}" in constant value.`)}else throw this.unexpected(c);return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const l=this._lexer.token;return this.advanceLexer(),this.node(l,{kind:fe.STRING,value:l.value,block:l.kind===Je.BLOCK_STRING})}parseList(l){const c=()=>this.parseValueLiteral(l);return this.node(this._lexer.token,{kind:fe.LIST,values:this.any(Je.BRACKET_L,c,Je.BRACKET_R)})}parseObject(l){const c=()=>this.parseObjectField(l);return this.node(this._lexer.token,{kind:fe.OBJECT,fields:this.any(Je.BRACE_L,c,Je.BRACE_R)})}parseObjectField(l){const c=this._lexer.token,f=this.parseName();return this.expectToken(Je.COLON),this.node(c,{kind:fe.OBJECT_FIELD,name:f,value:this.parseValueLiteral(l)})}parseDirectives(l){const c=[];for(;this.peek(Je.AT);)c.push(this.parseDirective(l));return c}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(l){const c=this._lexer.token;return this.expectToken(Je.AT),this.node(c,{kind:fe.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(l)})}parseTypeReference(){const l=this._lexer.token;let c;if(this.expectOptionalToken(Je.BRACKET_L)){const f=this.parseTypeReference();this.expectToken(Je.BRACKET_R),c=this.node(l,{kind:fe.LIST_TYPE,type:f})}else c=this.parseNamedType();return this.expectOptionalToken(Je.BANG)?this.node(l,{kind:fe.NON_NULL_TYPE,type:c}):c}parseNamedType(){return this.node(this._lexer.token,{kind:fe.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(Je.STRING)||this.peek(Je.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const l=this._lexer.token,c=this.parseDescription();this.expectKeyword("schema");const f=this.parseConstDirectives(),_=this.many(Je.BRACE_L,this.parseOperationTypeDefinition,Je.BRACE_R);return this.node(l,{kind:fe.SCHEMA_DEFINITION,description:c,directives:f,operationTypes:_})}parseOperationTypeDefinition(){const l=this._lexer.token,c=this.parseOperationType();this.expectToken(Je.COLON);const f=this.parseNamedType();return this.node(l,{kind:fe.OPERATION_TYPE_DEFINITION,operation:c,type:f})}parseScalarTypeDefinition(){const l=this._lexer.token,c=this.parseDescription();this.expectKeyword("scalar");const f=this.parseName(),_=this.parseConstDirectives();return this.node(l,{kind:fe.SCALAR_TYPE_DEFINITION,description:c,name:f,directives:_})}parseObjectTypeDefinition(){const l=this._lexer.token,c=this.parseDescription();this.expectKeyword("type");const f=this.parseName(),_=this.parseImplementsInterfaces(),v=this.parseConstDirectives(),w=this.parseFieldsDefinition();return this.node(l,{kind:fe.OBJECT_TYPE_DEFINITION,description:c,name:f,interfaces:_,directives:v,fields:w})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(Je.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(Je.BRACE_L,this.parseFieldDefinition,Je.BRACE_R)}parseFieldDefinition(){const l=this._lexer.token,c=this.parseDescription(),f=this.parseName(),_=this.parseArgumentDefs();this.expectToken(Je.COLON);const v=this.parseTypeReference(),w=this.parseConstDirectives();return this.node(l,{kind:fe.FIELD_DEFINITION,description:c,name:f,arguments:_,type:v,directives:w})}parseArgumentDefs(){return this.optionalMany(Je.PAREN_L,this.parseInputValueDef,Je.PAREN_R)}parseInputValueDef(){const l=this._lexer.token,c=this.parseDescription(),f=this.parseName();this.expectToken(Je.COLON);const _=this.parseTypeReference();let v;this.expectOptionalToken(Je.EQUALS)&&(v=this.parseConstValueLiteral());const w=this.parseConstDirectives();return this.node(l,{kind:fe.INPUT_VALUE_DEFINITION,description:c,name:f,type:_,defaultValue:v,directives:w})}parseInterfaceTypeDefinition(){const l=this._lexer.token,c=this.parseDescription();this.expectKeyword("interface");const f=this.parseName(),_=this.parseImplementsInterfaces(),v=this.parseConstDirectives(),w=this.parseFieldsDefinition();return this.node(l,{kind:fe.INTERFACE_TYPE_DEFINITION,description:c,name:f,interfaces:_,directives:v,fields:w})}parseUnionTypeDefinition(){const l=this._lexer.token,c=this.parseDescription();this.expectKeyword("union");const f=this.parseName(),_=this.parseConstDirectives(),v=this.parseUnionMemberTypes();return this.node(l,{kind:fe.UNION_TYPE_DEFINITION,description:c,name:f,directives:_,types:v})}parseUnionMemberTypes(){return this.expectOptionalToken(Je.EQUALS)?this.delimitedMany(Je.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const l=this._lexer.token,c=this.parseDescription();this.expectKeyword("enum");const f=this.parseName(),_=this.parseConstDirectives(),v=this.parseEnumValuesDefinition();return this.node(l,{kind:fe.ENUM_TYPE_DEFINITION,description:c,name:f,directives:_,values:v})}parseEnumValuesDefinition(){return this.optionalMany(Je.BRACE_L,this.parseEnumValueDefinition,Je.BRACE_R)}parseEnumValueDefinition(){const l=this._lexer.token,c=this.parseDescription(),f=this.parseEnumValueName(),_=this.parseConstDirectives();return this.node(l,{kind:fe.ENUM_VALUE_DEFINITION,description:c,name:f,directives:_})}parseEnumValueName(){if(this._lexer.token.value==="true"||this._lexer.token.value==="false"||this._lexer.token.value==="null")throw Mn(this._lexer.source,this._lexer.token.start,`${_h(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const l=this._lexer.token,c=this.parseDescription();this.expectKeyword("input");const f=this.parseName(),_=this.parseConstDirectives(),v=this.parseInputFieldsDefinition();return this.node(l,{kind:fe.INPUT_OBJECT_TYPE_DEFINITION,description:c,name:f,directives:_,fields:v})}parseInputFieldsDefinition(){return this.optionalMany(Je.BRACE_L,this.parseInputValueDef,Je.BRACE_R)}parseTypeSystemExtension(){const l=this._lexer.lookahead();if(l.kind===Je.NAME)switch(l.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(l)}parseSchemaExtension(){const l=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const c=this.parseConstDirectives(),f=this.optionalMany(Je.BRACE_L,this.parseOperationTypeDefinition,Je.BRACE_R);if(c.length===0&&f.length===0)throw this.unexpected();return this.node(l,{kind:fe.SCHEMA_EXTENSION,directives:c,operationTypes:f})}parseScalarTypeExtension(){const l=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const c=this.parseName(),f=this.parseConstDirectives();if(f.length===0)throw this.unexpected();return this.node(l,{kind:fe.SCALAR_TYPE_EXTENSION,name:c,directives:f})}parseObjectTypeExtension(){const l=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const c=this.parseName(),f=this.parseImplementsInterfaces(),_=this.parseConstDirectives(),v=this.parseFieldsDefinition();if(f.length===0&&_.length===0&&v.length===0)throw this.unexpected();return this.node(l,{kind:fe.OBJECT_TYPE_EXTENSION,name:c,interfaces:f,directives:_,fields:v})}parseInterfaceTypeExtension(){const l=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const c=this.parseName(),f=this.parseImplementsInterfaces(),_=this.parseConstDirectives(),v=this.parseFieldsDefinition();if(f.length===0&&_.length===0&&v.length===0)throw this.unexpected();return this.node(l,{kind:fe.INTERFACE_TYPE_EXTENSION,name:c,interfaces:f,directives:_,fields:v})}parseUnionTypeExtension(){const l=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const c=this.parseName(),f=this.parseConstDirectives(),_=this.parseUnionMemberTypes();if(f.length===0&&_.length===0)throw this.unexpected();return this.node(l,{kind:fe.UNION_TYPE_EXTENSION,name:c,directives:f,types:_})}parseEnumTypeExtension(){const l=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const c=this.parseName(),f=this.parseConstDirectives(),_=this.parseEnumValuesDefinition();if(f.length===0&&_.length===0)throw this.unexpected();return this.node(l,{kind:fe.ENUM_TYPE_EXTENSION,name:c,directives:f,values:_})}parseInputObjectTypeExtension(){const l=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const c=this.parseName(),f=this.parseConstDirectives(),_=this.parseInputFieldsDefinition();if(f.length===0&&_.length===0)throw this.unexpected();return this.node(l,{kind:fe.INPUT_OBJECT_TYPE_EXTENSION,name:c,directives:f,fields:_})}parseDirectiveDefinition(){const l=this._lexer.token,c=this.parseDescription();this.expectKeyword("directive"),this.expectToken(Je.AT);const f=this.parseName(),_=this.parseArgumentDefs(),v=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const w=this.parseDirectiveLocations();return this.node(l,{kind:fe.DIRECTIVE_DEFINITION,description:c,name:f,arguments:_,repeatable:v,locations:w})}parseDirectiveLocations(){return this.delimitedMany(Je.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const l=this._lexer.token,c=this.parseName();if(Object.prototype.hasOwnProperty.call(Wt,c.value))return c;throw this.unexpected(l)}node(l,c){return this._options.noLocation!==!0&&(c.loc=new rv(l,this._lexer.lastToken,this._lexer.source)),c}peek(l){return this._lexer.token.kind===l}expectToken(l){const c=this._lexer.token;if(c.kind===l)return this.advanceLexer(),c;throw Mn(this._lexer.source,c.start,`Expected ${dv(l)}, found ${_h(c)}.`)}expectOptionalToken(l){return this._lexer.token.kind===l?(this.advanceLexer(),!0):!1}expectKeyword(l){const c=this._lexer.token;if(c.kind===Je.NAME&&c.value===l)this.advanceLexer();else throw Mn(this._lexer.source,c.start,`Expected "${l}", found ${_h(c)}.`)}expectOptionalKeyword(l){const c=this._lexer.token;return c.kind===Je.NAME&&c.value===l?(this.advanceLexer(),!0):!1}unexpected(l){const c=l??this._lexer.token;return Mn(this._lexer.source,c.start,`Unexpected ${_h(c)}.`)}any(l,c,f){this.expectToken(l);const _=[];for(;!this.expectOptionalToken(f);)_.push(c.call(this));return _}optionalMany(l,c,f){if(this.expectOptionalToken(l)){const _=[];do _.push(c.call(this));while(!this.expectOptionalToken(f));return _}return[]}many(l,c,f){this.expectToken(l);const _=[];do _.push(c.call(this));while(!this.expectOptionalToken(f));return _}delimitedMany(l,c){this.expectOptionalToken(l);const f=[];do f.push(c.call(this));while(this.expectOptionalToken(l));return f}advanceLexer(){const{maxTokens:l}=this._options,c=this._lexer.advance();if(l!==void 0&&c.kind!==Je.EOF&&(++this._tokenCounter,this._tokenCounter>l))throw Mn(this._lexer.source,c.start,`Document contains more that ${l} tokens. Parsing aborted.`)}}function _h(i){const l=i.value;return dv(i.kind)+(l!=null?` "${l}"`:"")}function dv(i){return av(i)?`"${i}"`:i}const w1=5;function Do(i,l){const[c,f]=l?[i,l]:[void 0,i];let _=" Did you mean ";c&&(_+=c+" ");const v=f.map(I=>`"${I}"`);switch(v.length){case 0:return"";case 1:return _+v[0]+"?";case 2:return _+v[0]+" or "+v[1]+"?"}const w=v.slice(0,w1),o=w.pop();return _+w.join(", ")+", or "+o+"?"}function s_(i){return i}function Co(i,l){const c=Object.create(null);for(const f of i)c[l(f)]=f;return c}function ca(i,l,c){const f=Object.create(null);for(const _ of i)f[l(_)]=c(_);return f}function Ao(i,l){const c=Object.create(null);for(const f of Object.keys(i))c[f]=l(i[f],f);return c}function Iu(i,l){let c=0,f=0;for(;c<i.length&&f<l.length;){let _=i.charCodeAt(c),v=l.charCodeAt(f);if(vh(_)&&vh(v)){let w=0;do++c,w=w*10+_-ef,_=i.charCodeAt(c);while(vh(_)&&w>0);let o=0;do++f,o=o*10+v-ef,v=l.charCodeAt(f);while(vh(v)&&o>0);if(w<o)return-1;if(w>o)return 1}else{if(_<v)return-1;if(_>v)return 1;++c,++f}}return i.length-l.length}const ef=48,E1=57;function vh(i){return!isNaN(i)&&ef<=i&&i<=E1}function da(i,l){const c=Object.create(null),f=new T1(i),_=Math.floor(i.length*.4)+1;for(const v of l){const w=f.measure(v,_);w!==void 0&&(c[v]=w)}return Object.keys(c).sort((v,w)=>{const o=c[v]-c[w];return o!==0?o:Iu(v,w)})}class T1{constructor(l){this._input=l,this._inputLowerCase=l.toLowerCase(),this._inputArray=o_(this._inputLowerCase),this._rows=[new Array(l.length+1).fill(0),new Array(l.length+1).fill(0),new Array(l.length+1).fill(0)]}measure(l,c){if(this._input===l)return 0;const f=l.toLowerCase();if(this._inputLowerCase===f)return 1;let _=o_(f),v=this._inputArray;if(_.length<v.length){const L=_;_=v,v=L}const w=_.length,o=v.length;if(w-o>c)return;const I=this._rows;for(let L=0;L<=o;L++)I[0][L]=L;for(let L=1;L<=w;L++){const R=I[(L-1)%3],P=I[L%3];let q=P[0]=L;for(let ie=1;ie<=o;ie++){const le=_[L-1]===v[ie-1]?0:1;let V=Math.min(R[ie]+1,P[ie-1]+1,R[ie-1]+le);if(L>1&&ie>1&&_[L-1]===v[ie-2]&&_[L-2]===v[ie-1]){const me=I[(L-2)%3][ie-2];V=Math.min(V,me+1)}V<q&&(q=V),P[ie]=V}if(q>c)return}const A=I[w%3][o];return A<=c?A:void 0}}function o_(i){const l=i.length,c=new Array(l);for(let f=0;f<l;++f)c[f]=i.charCodeAt(f);return c}function ps(i){if(i==null)return Object.create(null);if(Object.getPrototypeOf(i)===null)return i;const l=Object.create(null);for(const[c,f]of Object.entries(i))l[c]=f;return l}function S1(i){return`"${i.replace(I1,A1)}"`}const I1=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function A1(i){return D1[i.charCodeAt(0)]}const D1=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],Fl=Object.freeze({});function Hl(i,l,c=nv){const f=new Map;for(const me of Object.values(fe))f.set(me,Ul(l,me));let _,v=Array.isArray(i),w=[i],o=-1,I=[],A=i,L,R;const P=[],q=[];do{o++;const me=o===w.length,Oe=me&&I.length!==0;if(me){if(L=q.length===0?void 0:P[P.length-1],A=R,R=q.pop(),Oe)if(v){A=A.slice();let ne=0;for(const[de,ce]of I){const Ae=de-ne;ce===null?(A.splice(Ae,1),ne++):A[Ae]=ce}}else{A=Object.defineProperties({},Object.getOwnPropertyDescriptors(A));for(const[ne,de]of I)A[ne]=de}o=_.index,w=_.keys,I=_.edits,v=_.inArray,_=_.prev}else if(R){if(L=v?o:w[o],A=R[L],A==null)continue;P.push(L)}let Pe;if(!Array.isArray(A)){var ie,le;Kd(A)||fr(!1,`Invalid AST Node: ${Ke(A)}.`);const ne=me?(ie=f.get(A.kind))===null||ie===void 0?void 0:ie.leave:(le=f.get(A.kind))===null||le===void 0?void 0:le.enter;if(Pe=ne==null?void 0:ne.call(l,A,L,R,P,q),Pe===Fl)break;if(Pe===!1){if(!me){P.pop();continue}}else if(Pe!==void 0&&(I.push([L,Pe]),!me))if(Kd(Pe))A=Pe;else{P.pop();continue}}if(Pe===void 0&&Oe&&I.push([L,A]),me)P.pop();else{var V;_={inArray:v,index:o,keys:w,edits:I,prev:_},v=Array.isArray(A),w=v?A:(V=c[A.kind])!==null&&V!==void 0?V:[],o=-1,I=[],R&&q.push(R),R=A}}while(_!==void 0);return I.length!==0?I[I.length-1][1]:i}function xf(i){const l=new Array(i.length).fill(null),c=Object.create(null);for(const f of Object.values(fe)){let _=!1;const v=new Array(i.length).fill(void 0),w=new Array(i.length).fill(void 0);for(let I=0;I<i.length;++I){const{enter:A,leave:L}=Ul(i[I],f);_||(_=A!=null||L!=null),v[I]=A,w[I]=L}if(!_)continue;const o={enter(...I){const A=I[0];for(let R=0;R<i.length;R++)if(l[R]===null){var L;const P=(L=v[R])===null||L===void 0?void 0:L.apply(i[R],I);if(P===!1)l[R]=A;else if(P===Fl)l[R]=Fl;else if(P!==void 0)return P}},leave(...I){const A=I[0];for(let R=0;R<i.length;R++)if(l[R]===null){var L;const P=(L=w[R])===null||L===void 0?void 0:L.apply(i[R],I);if(P===Fl)l[R]=Fl;else if(P!==void 0&&P!==!1)return P}else l[R]===A&&(l[R]=null)}};c[f]=o}return c}function Ul(i,l){const c=i[l];return typeof c=="object"?c:typeof c=="function"?{enter:c,leave:void 0}:{enter:i.enter,leave:i.leave}}function C1(i,l,c){const{enter:f,leave:_}=Ul(i,l);return c?_:f}function Hr(i){return Hl(i,k1)}const P1=80,k1={Name:{leave:i=>i.value},Variable:{leave:i=>"$"+i.name},Document:{leave:i=>Vt(i.definitions,`

`)},OperationDefinition:{leave(i){const l=vr("(",Vt(i.variableDefinitions,", "),")"),c=Vt([i.operation,Vt([i.name,l]),Vt(i.directives," ")]," ");return(c==="query"?"":c+" ")+i.selectionSet}},VariableDefinition:{leave:({variable:i,type:l,defaultValue:c,directives:f})=>i+": "+l+vr(" = ",c)+vr(" ",Vt(f," "))},SelectionSet:{leave:({selections:i})=>Ps(i)},Field:{leave({alias:i,name:l,arguments:c,directives:f,selectionSet:_}){const v=vr("",i,": ")+l;let w=v+vr("(",Vt(c,", "),")");return w.length>P1&&(w=v+vr(`(
`,Sh(Vt(c,`
`)),`
)`)),Vt([w,Vt(f," "),_]," ")}},Argument:{leave:({name:i,value:l})=>i+": "+l},FragmentSpread:{leave:({name:i,directives:l})=>"..."+i+vr(" ",Vt(l," "))},InlineFragment:{leave:({typeCondition:i,directives:l,selectionSet:c})=>Vt(["...",vr("on ",i),Vt(l," "),c]," ")},FragmentDefinition:{leave:({name:i,typeCondition:l,variableDefinitions:c,directives:f,selectionSet:_})=>`fragment ${i}${vr("(",Vt(c,", "),")")} on ${l} ${vr("",Vt(f," ")," ")}`+_},IntValue:{leave:({value:i})=>i},FloatValue:{leave:({value:i})=>i},StringValue:{leave:({value:i,block:l})=>l?ov(i):S1(i)},BooleanValue:{leave:({value:i})=>i?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:i})=>i},ListValue:{leave:({values:i})=>"["+Vt(i,", ")+"]"},ObjectValue:{leave:({fields:i})=>"{"+Vt(i,", ")+"}"},ObjectField:{leave:({name:i,value:l})=>i+": "+l},Directive:{leave:({name:i,arguments:l})=>"@"+i+vr("(",Vt(l,", "),")")},NamedType:{leave:({name:i})=>i},ListType:{leave:({type:i})=>"["+i+"]"},NonNullType:{leave:({type:i})=>i+"!"},SchemaDefinition:{leave:({description:i,directives:l,operationTypes:c})=>vr("",i,`
`)+Vt(["schema",Vt(l," "),Ps(c)]," ")},OperationTypeDefinition:{leave:({operation:i,type:l})=>i+": "+l},ScalarTypeDefinition:{leave:({description:i,name:l,directives:c})=>vr("",i,`
`)+Vt(["scalar",l,Vt(c," ")]," ")},ObjectTypeDefinition:{leave:({description:i,name:l,interfaces:c,directives:f,fields:_})=>vr("",i,`
`)+Vt(["type",l,vr("implements ",Vt(c," & ")),Vt(f," "),Ps(_)]," ")},FieldDefinition:{leave:({description:i,name:l,arguments:c,type:f,directives:_})=>vr("",i,`
`)+l+(a_(c)?vr(`(
`,Sh(Vt(c,`
`)),`
)`):vr("(",Vt(c,", "),")"))+": "+f+vr(" ",Vt(_," "))},InputValueDefinition:{leave:({description:i,name:l,type:c,defaultValue:f,directives:_})=>vr("",i,`
`)+Vt([l+": "+c,vr("= ",f),Vt(_," ")]," ")},InterfaceTypeDefinition:{leave:({description:i,name:l,interfaces:c,directives:f,fields:_})=>vr("",i,`
`)+Vt(["interface",l,vr("implements ",Vt(c," & ")),Vt(f," "),Ps(_)]," ")},UnionTypeDefinition:{leave:({description:i,name:l,directives:c,types:f})=>vr("",i,`
`)+Vt(["union",l,Vt(c," "),vr("= ",Vt(f," | "))]," ")},EnumTypeDefinition:{leave:({description:i,name:l,directives:c,values:f})=>vr("",i,`
`)+Vt(["enum",l,Vt(c," "),Ps(f)]," ")},EnumValueDefinition:{leave:({description:i,name:l,directives:c})=>vr("",i,`
`)+Vt([l,Vt(c," ")]," ")},InputObjectTypeDefinition:{leave:({description:i,name:l,directives:c,fields:f})=>vr("",i,`
`)+Vt(["input",l,Vt(c," "),Ps(f)]," ")},DirectiveDefinition:{leave:({description:i,name:l,arguments:c,repeatable:f,locations:_})=>vr("",i,`
`)+"directive @"+l+(a_(c)?vr(`(
`,Sh(Vt(c,`
`)),`
)`):vr("(",Vt(c,", "),")"))+(f?" repeatable":"")+" on "+Vt(_," | ")},SchemaExtension:{leave:({directives:i,operationTypes:l})=>Vt(["extend schema",Vt(i," "),Ps(l)]," ")},ScalarTypeExtension:{leave:({name:i,directives:l})=>Vt(["extend scalar",i,Vt(l," ")]," ")},ObjectTypeExtension:{leave:({name:i,interfaces:l,directives:c,fields:f})=>Vt(["extend type",i,vr("implements ",Vt(l," & ")),Vt(c," "),Ps(f)]," ")},InterfaceTypeExtension:{leave:({name:i,interfaces:l,directives:c,fields:f})=>Vt(["extend interface",i,vr("implements ",Vt(l," & ")),Vt(c," "),Ps(f)]," ")},UnionTypeExtension:{leave:({name:i,directives:l,types:c})=>Vt(["extend union",i,Vt(l," "),vr("= ",Vt(c," | "))]," ")},EnumTypeExtension:{leave:({name:i,directives:l,values:c})=>Vt(["extend enum",i,Vt(l," "),Ps(c)]," ")},InputObjectTypeExtension:{leave:({name:i,directives:l,fields:c})=>Vt(["extend input",i,Vt(l," "),Ps(c)]," ")}};function Vt(i,l=""){var c;return(c=i==null?void 0:i.filter(f=>f).join(l))!==null&&c!==void 0?c:""}function Ps(i){return vr(`{
`,Sh(Vt(i,`
`)),`
}`)}function vr(i,l,c=""){return l!=null&&l!==""?i+l+c:""}function Sh(i){return vr("  ",i.replace(/\n/g,`
  `))}function a_(i){var l;return(l=i==null?void 0:i.some(c=>c.includes(`
`)))!==null&&l!==void 0?l:!1}function Mh(i,l){switch(i.kind){case fe.NULL:return null;case fe.INT:return parseInt(i.value,10);case fe.FLOAT:return parseFloat(i.value);case fe.STRING:case fe.ENUM:case fe.BOOLEAN:return i.value;case fe.LIST:return i.values.map(c=>Mh(c,l));case fe.OBJECT:return ca(i.fields,c=>c.name.value,c=>Mh(c.value,l));case fe.VARIABLE:return l==null?void 0:l[i.name.value]}}function Hi(i){if(i!=null||fr(!1,"Must provide name."),typeof i=="string"||fr(!1,"Expected name to be a string."),i.length===0)throw new Ze("Expected name to be a non-empty string.");for(let l=1;l<i.length;++l)if(!sv(i.charCodeAt(l)))throw new Ze(`Names must only contain [_a-zA-Z0-9] but "${i}" does not.`);if(!_f(i.charCodeAt(0)))throw new Ze(`Names must start with [_a-zA-Z] but "${i}" does not.`);return i}function fv(i){if(i==="true"||i==="false"||i==="null")throw new Ze(`Enum values cannot be named: ${i}`);return Hi(i)}function Au(i){return Wi(i)||Er(i)||kr(i)||Rn(i)||In(i)||Xr(i)||Wr(i)||tr(i)}function M1(i){if(!Au(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL type.`);return i}function Wi(i){return Os(i,Ws)}function O1(i){if(!Wi(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL Scalar type.`);return i}function Er(i){return Os(i,us)}function mv(i){if(!Er(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL Object type.`);return i}function kr(i){return Os(i,$l)}function gv(i){if(!kr(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL Interface type.`);return i}function Rn(i){return Os(i,Vl)}function R1(i){if(!Rn(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL Union type.`);return i}function In(i){return Os(i,pa)}function N1(i){if(!In(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL Enum type.`);return i}function Xr(i){return Os(i,jl)}function L1(i){if(!Xr(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL Input Object type.`);return i}function Wr(i){return Os(i,si)}function F1(i){if(!Wr(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL List type.`);return i}function tr(i){return Os(i,dr)}function z1(i){if(!tr(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL Non-Null type.`);return i}function Mi(i){return Wi(i)||In(i)||Xr(i)||Du(i)&&Mi(i.ofType)}function B1(i){if(!Mi(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL input type.`);return i}function ha(i){return Wi(i)||Er(i)||kr(i)||Rn(i)||In(i)||Du(i)&&ha(i.ofType)}function U1(i){if(!ha(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL output type.`);return i}function Zs(i){return Wi(i)||In(i)}function $1(i){if(!Zs(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL leaf type.`);return i}function Hs(i){return Er(i)||kr(i)||Rn(i)}function V1(i){if(!Hs(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL composite type.`);return i}function Gs(i){return kr(i)||Rn(i)}function j1(i){if(!Gs(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL abstract type.`);return i}class si{constructor(l){Au(l)||fr(!1,`Expected ${Ke(l)} to be a GraphQL type.`),this.ofType=l}get[Symbol.toStringTag](){return"GraphQLList"}toString(){return"["+String(this.ofType)+"]"}toJSON(){return this.toString()}}class dr{constructor(l){bf(l)||fr(!1,`Expected ${Ke(l)} to be a GraphQL nullable type.`),this.ofType=l}get[Symbol.toStringTag](){return"GraphQLNonNull"}toString(){return String(this.ofType)+"!"}toJSON(){return this.toString()}}function Du(i){return Wr(i)||tr(i)}function q1(i){if(!Du(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL wrapping type.`);return i}function bf(i){return Au(i)&&!tr(i)}function yv(i){if(!bf(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL nullable type.`);return i}function wf(i){if(i)return tr(i)?i.ofType:i}function Cu(i){return Wi(i)||Er(i)||kr(i)||Rn(i)||In(i)||Xr(i)}function G1(i){if(!Cu(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL named type.`);return i}function Si(i){if(i){let l=i;for(;Du(l);)l=l.ofType;return l}}function Ef(i){return typeof i=="function"?i():i}function Tf(i){return typeof i=="function"?i():i}class Ws{constructor(l){var c,f,_,v;const w=(c=l.parseValue)!==null&&c!==void 0?c:s_;this.name=Hi(l.name),this.description=l.description,this.specifiedByURL=l.specifiedByURL,this.serialize=(f=l.serialize)!==null&&f!==void 0?f:s_,this.parseValue=w,this.parseLiteral=(_=l.parseLiteral)!==null&&_!==void 0?_:(o,I)=>w(Mh(o,I)),this.extensions=ps(l.extensions),this.astNode=l.astNode,this.extensionASTNodes=(v=l.extensionASTNodes)!==null&&v!==void 0?v:[],l.specifiedByURL==null||typeof l.specifiedByURL=="string"||fr(!1,`${this.name} must provide "specifiedByURL" as a string, but got: ${Ke(l.specifiedByURL)}.`),l.serialize==null||typeof l.serialize=="function"||fr(!1,`${this.name} must provide "serialize" function. If this custom Scalar is also used as an input type, ensure "parseValue" and "parseLiteral" functions are also provided.`),l.parseLiteral&&(typeof l.parseValue=="function"&&typeof l.parseLiteral=="function"||fr(!1,`${this.name} must provide both "parseValue" and "parseLiteral" functions.`))}get[Symbol.toStringTag](){return"GraphQLScalarType"}toConfig(){return{name:this.name,description:this.description,specifiedByURL:this.specifiedByURL,serialize:this.serialize,parseValue:this.parseValue,parseLiteral:this.parseLiteral,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:this.extensionASTNodes}}toString(){return this.name}toJSON(){return this.toString()}}class us{constructor(l){var c;this.name=Hi(l.name),this.description=l.description,this.isTypeOf=l.isTypeOf,this.extensions=ps(l.extensions),this.astNode=l.astNode,this.extensionASTNodes=(c=l.extensionASTNodes)!==null&&c!==void 0?c:[],this._fields=()=>vv(l),this._interfaces=()=>_v(l),l.isTypeOf==null||typeof l.isTypeOf=="function"||fr(!1,`${this.name} must provide "isTypeOf" as a function, but got: ${Ke(l.isTypeOf)}.`)}get[Symbol.toStringTag](){return"GraphQLObjectType"}getFields(){return typeof this._fields=="function"&&(this._fields=this._fields()),this._fields}getInterfaces(){return typeof this._interfaces=="function"&&(this._interfaces=this._interfaces()),this._interfaces}toConfig(){return{name:this.name,description:this.description,interfaces:this.getInterfaces(),fields:bv(this.getFields()),isTypeOf:this.isTypeOf,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:this.extensionASTNodes}}toString(){return this.name}toJSON(){return this.toString()}}function _v(i){var l;const c=Ef((l=i.interfaces)!==null&&l!==void 0?l:[]);return Array.isArray(c)||fr(!1,`${i.name} interfaces must be an Array or a function which returns an Array.`),c}function vv(i){const l=Tf(i.fields);return Bl(l)||fr(!1,`${i.name} fields must be an object with field names as keys or a function which returns such an object.`),Ao(l,(c,f)=>{var _;Bl(c)||fr(!1,`${i.name}.${f} field config must be an object.`),c.resolve==null||typeof c.resolve=="function"||fr(!1,`${i.name}.${f} field resolver must be a function if provided, but got: ${Ke(c.resolve)}.`);const v=(_=c.args)!==null&&_!==void 0?_:{};return Bl(v)||fr(!1,`${i.name}.${f} args must be an object with argument names as keys.`),{name:Hi(f),description:c.description,type:c.type,args:xv(v),resolve:c.resolve,subscribe:c.subscribe,deprecationReason:c.deprecationReason,extensions:ps(c.extensions),astNode:c.astNode}})}function xv(i){return Object.entries(i).map(([l,c])=>({name:Hi(l),description:c.description,type:c.type,defaultValue:c.defaultValue,deprecationReason:c.deprecationReason,extensions:ps(c.extensions),astNode:c.astNode}))}function Bl(i){return Zi(i)&&!Array.isArray(i)}function bv(i){return Ao(i,l=>({description:l.description,type:l.type,args:wv(l.args),resolve:l.resolve,subscribe:l.subscribe,deprecationReason:l.deprecationReason,extensions:l.extensions,astNode:l.astNode}))}function wv(i){return ca(i,l=>l.name,l=>({description:l.description,type:l.type,defaultValue:l.defaultValue,deprecationReason:l.deprecationReason,extensions:l.extensions,astNode:l.astNode}))}function fa(i){return tr(i.type)&&i.defaultValue===void 0}class $l{constructor(l){var c;this.name=Hi(l.name),this.description=l.description,this.resolveType=l.resolveType,this.extensions=ps(l.extensions),this.astNode=l.astNode,this.extensionASTNodes=(c=l.extensionASTNodes)!==null&&c!==void 0?c:[],this._fields=vv.bind(void 0,l),this._interfaces=_v.bind(void 0,l),l.resolveType==null||typeof l.resolveType=="function"||fr(!1,`${this.name} must provide "resolveType" as a function, but got: ${Ke(l.resolveType)}.`)}get[Symbol.toStringTag](){return"GraphQLInterfaceType"}getFields(){return typeof this._fields=="function"&&(this._fields=this._fields()),this._fields}getInterfaces(){return typeof this._interfaces=="function"&&(this._interfaces=this._interfaces()),this._interfaces}toConfig(){return{name:this.name,description:this.description,interfaces:this.getInterfaces(),fields:bv(this.getFields()),resolveType:this.resolveType,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:this.extensionASTNodes}}toString(){return this.name}toJSON(){return this.toString()}}class Vl{constructor(l){var c;this.name=Hi(l.name),this.description=l.description,this.resolveType=l.resolveType,this.extensions=ps(l.extensions),this.astNode=l.astNode,this.extensionASTNodes=(c=l.extensionASTNodes)!==null&&c!==void 0?c:[],this._types=Z1.bind(void 0,l),l.resolveType==null||typeof l.resolveType=="function"||fr(!1,`${this.name} must provide "resolveType" as a function, but got: ${Ke(l.resolveType)}.`)}get[Symbol.toStringTag](){return"GraphQLUnionType"}getTypes(){return typeof this._types=="function"&&(this._types=this._types()),this._types}toConfig(){return{name:this.name,description:this.description,types:this.getTypes(),resolveType:this.resolveType,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:this.extensionASTNodes}}toString(){return this.name}toJSON(){return this.toString()}}function Z1(i){const l=Ef(i.types);return Array.isArray(l)||fr(!1,`Must provide Array of types or a function which returns such an array for Union ${i.name}.`),l}class pa{constructor(l){var c;this.name=Hi(l.name),this.description=l.description,this.extensions=ps(l.extensions),this.astNode=l.astNode,this.extensionASTNodes=(c=l.extensionASTNodes)!==null&&c!==void 0?c:[],this._values=H1(this.name,l.values),this._valueLookup=new Map(this._values.map(f=>[f.value,f])),this._nameLookup=Co(this._values,f=>f.name)}get[Symbol.toStringTag](){return"GraphQLEnumType"}getValues(){return this._values}getValue(l){return this._nameLookup[l]}serialize(l){const c=this._valueLookup.get(l);if(c===void 0)throw new Ze(`Enum "${this.name}" cannot represent value: ${Ke(l)}`);return c.name}parseValue(l){if(typeof l!="string"){const f=Ke(l);throw new Ze(`Enum "${this.name}" cannot represent non-string value: ${f}.`+xh(this,f))}const c=this.getValue(l);if(c==null)throw new Ze(`Value "${l}" does not exist in "${this.name}" enum.`+xh(this,l));return c.value}parseLiteral(l,c){if(l.kind!==fe.ENUM){const _=Hr(l);throw new Ze(`Enum "${this.name}" cannot represent non-enum value: ${_}.`+xh(this,_),{nodes:l})}const f=this.getValue(l.value);if(f==null){const _=Hr(l);throw new Ze(`Value "${_}" does not exist in "${this.name}" enum.`+xh(this,_),{nodes:l})}return f.value}toConfig(){const l=ca(this.getValues(),c=>c.name,c=>({description:c.description,value:c.value,deprecationReason:c.deprecationReason,extensions:c.extensions,astNode:c.astNode}));return{name:this.name,description:this.description,values:l,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:this.extensionASTNodes}}toString(){return this.name}toJSON(){return this.toString()}}function xh(i,l){const c=i.getValues().map(_=>_.name),f=da(l,c);return Do("the enum value",f)}function H1(i,l){return Bl(l)||fr(!1,`${i} values must be an object with value names as keys.`),Object.entries(l).map(([c,f])=>(Bl(f)||fr(!1,`${i}.${c} must refer to an object with a "value" key representing an internal value but got: ${Ke(f)}.`),{name:fv(c),description:f.description,value:f.value!==void 0?f.value:c,deprecationReason:f.deprecationReason,extensions:ps(f.extensions),astNode:f.astNode}))}class jl{constructor(l){var c;this.name=Hi(l.name),this.description=l.description,this.extensions=ps(l.extensions),this.astNode=l.astNode,this.extensionASTNodes=(c=l.extensionASTNodes)!==null&&c!==void 0?c:[],this._fields=W1.bind(void 0,l)}get[Symbol.toStringTag](){return"GraphQLInputObjectType"}getFields(){return typeof this._fields=="function"&&(this._fields=this._fields()),this._fields}toConfig(){const l=Ao(this.getFields(),c=>({description:c.description,type:c.type,defaultValue:c.defaultValue,deprecationReason:c.deprecationReason,extensions:c.extensions,astNode:c.astNode}));return{name:this.name,description:this.description,fields:l,extensions:this.extensions,astNode:this.astNode,extensionASTNodes:this.extensionASTNodes}}toString(){return this.name}toJSON(){return this.toString()}}function W1(i){const l=Tf(i.fields);return Bl(l)||fr(!1,`${i.name} fields must be an object with field names as keys or a function which returns such an object.`),Ao(l,(c,f)=>(!("resolve"in c)||fr(!1,`${i.name}.${f} field has a resolve property, but Input Types cannot define resolvers.`),{name:Hi(f),description:c.description,type:c.type,defaultValue:c.defaultValue,deprecationReason:c.deprecationReason,extensions:ps(c.extensions),astNode:c.astNode}))}function Jh(i){return tr(i.type)&&i.defaultValue===void 0}function Oh(i,l){return i===l?!0:tr(i)&&tr(l)||Wr(i)&&Wr(l)?Oh(i.ofType,l.ofType):!1}function Ja(i,l,c){return l===c?!0:tr(c)?tr(l)?Ja(i,l.ofType,c.ofType):!1:tr(l)?Ja(i,l.ofType,c):Wr(c)?Wr(l)?Ja(i,l.ofType,c.ofType):!1:Wr(l)?!1:Gs(c)&&(kr(l)||Er(l))&&i.isSubType(c,l)}function tf(i,l,c){return l===c?!0:Gs(l)?Gs(c)?i.getPossibleTypes(l).some(f=>i.isSubType(c,f)):i.isSubType(l,c):Gs(c)?i.isSubType(c,l):!1}const Ih=2147483647,Ah=-2147483648,Ev=new Ws({name:"Int",description:"The `Int` scalar type represents non-fractional signed whole numeric values. Int can represent values between -(2^31) and 2^31 - 1.",serialize(i){const l=ku(i);if(typeof l=="boolean")return l?1:0;let c=l;if(typeof l=="string"&&l!==""&&(c=Number(l)),typeof c!="number"||!Number.isInteger(c))throw new Ze(`Int cannot represent non-integer value: ${Ke(l)}`);if(c>Ih||c<Ah)throw new Ze("Int cannot represent non 32-bit signed integer value: "+Ke(l));return c},parseValue(i){if(typeof i!="number"||!Number.isInteger(i))throw new Ze(`Int cannot represent non-integer value: ${Ke(i)}`);if(i>Ih||i<Ah)throw new Ze(`Int cannot represent non 32-bit signed integer value: ${i}`);return i},parseLiteral(i){if(i.kind!==fe.INT)throw new Ze(`Int cannot represent non-integer value: ${Hr(i)}`,{nodes:i});const l=parseInt(i.value,10);if(l>Ih||l<Ah)throw new Ze(`Int cannot represent non 32-bit signed integer value: ${i.value}`,{nodes:i});return l}}),Tv=new Ws({name:"Float",description:"The `Float` scalar type represents signed double-precision fractional values as specified by [IEEE 754](https://en.wikipedia.org/wiki/IEEE_floating_point).",serialize(i){const l=ku(i);if(typeof l=="boolean")return l?1:0;let c=l;if(typeof l=="string"&&l!==""&&(c=Number(l)),typeof c!="number"||!Number.isFinite(c))throw new Ze(`Float cannot represent non numeric value: ${Ke(l)}`);return c},parseValue(i){if(typeof i!="number"||!Number.isFinite(i))throw new Ze(`Float cannot represent non numeric value: ${Ke(i)}`);return i},parseLiteral(i){if(i.kind!==fe.FLOAT&&i.kind!==fe.INT)throw new Ze(`Float cannot represent non numeric value: ${Hr(i)}`,i);return parseFloat(i.value)}}),un=new Ws({name:"String",description:"The `String` scalar type represents textual data, represented as UTF-8 character sequences. The String type is most often used by GraphQL to represent free-form human-readable text.",serialize(i){const l=ku(i);if(typeof l=="string")return l;if(typeof l=="boolean")return l?"true":"false";if(typeof l=="number"&&Number.isFinite(l))return l.toString();throw new Ze(`String cannot represent value: ${Ke(i)}`)},parseValue(i){if(typeof i!="string")throw new Ze(`String cannot represent a non string value: ${Ke(i)}`);return i},parseLiteral(i){if(i.kind!==fe.STRING)throw new Ze(`String cannot represent a non string value: ${Hr(i)}`,{nodes:i});return i.value}}),qi=new Ws({name:"Boolean",description:"The `Boolean` scalar type represents `true` or `false`.",serialize(i){const l=ku(i);if(typeof l=="boolean")return l;if(Number.isFinite(l))return l!==0;throw new Ze(`Boolean cannot represent a non boolean value: ${Ke(l)}`)},parseValue(i){if(typeof i!="boolean")throw new Ze(`Boolean cannot represent a non boolean value: ${Ke(i)}`);return i},parseLiteral(i){if(i.kind!==fe.BOOLEAN)throw new Ze(`Boolean cannot represent a non boolean value: ${Hr(i)}`,{nodes:i});return i.value}}),Sf=new Ws({name:"ID",description:'The `ID` scalar type represents a unique identifier, often used to refetch an object or as key for a cache. The ID type appears in a JSON response as a String; however, it is not intended to be human-readable. When expected as an input type, any string (such as `"4"`) or integer (such as `4`) input value will be accepted as an ID.',serialize(i){const l=ku(i);if(typeof l=="string")return l;if(Number.isInteger(l))return String(l);throw new Ze(`ID cannot represent value: ${Ke(i)}`)},parseValue(i){if(typeof i=="string")return i;if(typeof i=="number"&&Number.isInteger(i))return i.toString();throw new Ze(`ID cannot represent value: ${Ke(i)}`)},parseLiteral(i){if(i.kind!==fe.STRING&&i.kind!==fe.INT)throw new Ze("ID cannot represent a non-string and non-integer value: "+Hr(i),{nodes:i});return i.value}}),Pu=Object.freeze([un,Ev,Tv,qi,Sf]);function Kh(i){return Pu.some(({name:l})=>i.name===l)}function ku(i){if(Zi(i)){if(typeof i.valueOf=="function"){const l=i.valueOf();if(!Zi(l))return l}if(typeof i.toJSON=="function")return i.toJSON()}return i}function Qh(i){return Os(i,Xs)}function X1(i){if(!Qh(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL directive.`);return i}class Xs{constructor(l){var c,f;this.name=Hi(l.name),this.description=l.description,this.locations=l.locations,this.isRepeatable=(c=l.isRepeatable)!==null&&c!==void 0?c:!1,this.extensions=ps(l.extensions),this.astNode=l.astNode,Array.isArray(l.locations)||fr(!1,`@${l.name} locations must be an Array.`);const _=(f=l.args)!==null&&f!==void 0?f:{};Zi(_)&&!Array.isArray(_)||fr(!1,`@${l.name} args must be an object with argument names as keys.`),this.args=xv(_)}get[Symbol.toStringTag](){return"GraphQLDirective"}toConfig(){return{name:this.name,description:this.description,locations:this.locations,args:wv(this.args),isRepeatable:this.isRepeatable,extensions:this.extensions,astNode:this.astNode}}toString(){return"@"+this.name}toJSON(){return this.toString()}}const If=new Xs({name:"include",description:"Directs the executor to include this field or fragment only when the `if` argument is true.",locations:[Wt.FIELD,Wt.FRAGMENT_SPREAD,Wt.INLINE_FRAGMENT],args:{if:{type:new dr(qi),description:"Included when true."}}}),Af=new Xs({name:"skip",description:"Directs the executor to skip this field or fragment when the `if` argument is true.",locations:[Wt.FIELD,Wt.FRAGMENT_SPREAD,Wt.INLINE_FRAGMENT],args:{if:{type:new dr(qi),description:"Skipped when true."}}}),Df="No longer supported",ep=new Xs({name:"deprecated",description:"Marks an element of a GraphQL schema as no longer supported.",locations:[Wt.FIELD_DEFINITION,Wt.ARGUMENT_DEFINITION,Wt.INPUT_FIELD_DEFINITION,Wt.ENUM_VALUE],args:{reason:{type:un,description:"Explains why this element was deprecated, usually also including a suggestion for how to access supported similar data. Formatted using the Markdown syntax, as specified by [CommonMark](https://commonmark.org/).",defaultValue:Df}}}),Cf=new Xs({name:"specifiedBy",description:"Exposes a URL that specifies the behavior of this scalar.",locations:[Wt.SCALAR],args:{url:{type:new dr(un),description:"The URL that specifies the behavior of this scalar."}}}),ma=Object.freeze([If,Af,ep,Cf]);function Pf(i){return ma.some(({name:l})=>l===i.name)}function kf(i){return typeof i=="object"&&typeof(i==null?void 0:i[Symbol.iterator])=="function"}function ua(i,l){if(tr(l)){const c=ua(i,l.ofType);return(c==null?void 0:c.kind)===fe.NULL?null:c}if(i===null)return{kind:fe.NULL};if(i===void 0)return null;if(Wr(l)){const c=l.ofType;if(kf(i)){const f=[];for(const _ of i){const v=ua(_,c);v!=null&&f.push(v)}return{kind:fe.LIST,values:f}}return ua(i,c)}if(Xr(l)){if(!Zi(i))return null;const c=[];for(const f of Object.values(l.getFields())){const _=ua(i[f.name],f.type);_&&c.push({kind:fe.OBJECT_FIELD,name:{kind:fe.NAME,value:f.name},value:_})}return{kind:fe.OBJECT,fields:c}}if(Zs(l)){const c=l.serialize(i);if(c==null)return null;if(typeof c=="boolean")return{kind:fe.BOOLEAN,value:c};if(typeof c=="number"&&Number.isFinite(c)){const f=String(c);return l_.test(f)?{kind:fe.INT,value:f}:{kind:fe.FLOAT,value:f}}if(typeof c=="string")return In(l)?{kind:fe.ENUM,value:c}:l===Sf&&l_.test(c)?{kind:fe.INT,value:c}:{kind:fe.STRING,value:c};throw new TypeError(`Cannot convert value to AST: ${Ke(c)}.`)}En(!1,"Unexpected input type: "+Ke(l))}const l_=/^-?(?:0|[1-9][0-9]*)$/,tp=new us({name:"__Schema",description:"A GraphQL Schema defines the capabilities of a GraphQL server. It exposes all available types and directives on the server, as well as the entry points for query, mutation, and subscription operations.",fields:()=>({description:{type:un,resolve:i=>i.description},types:{description:"A list of all types supported by this server.",type:new dr(new si(new dr(cs))),resolve(i){return Object.values(i.getTypeMap())}},queryType:{description:"The type that query operations will be rooted at.",type:new dr(cs),resolve:i=>i.getQueryType()},mutationType:{description:"If this server supports mutation, the type that mutation operations will be rooted at.",type:cs,resolve:i=>i.getMutationType()},subscriptionType:{description:"If this server support subscription, the type that subscription operations will be rooted at.",type:cs,resolve:i=>i.getSubscriptionType()},directives:{description:"A list of all directives supported by this server.",type:new dr(new si(new dr(Mf))),resolve:i=>i.getDirectives()}})}),Mf=new us({name:"__Directive",description:`A Directive provides a way to describe alternate runtime execution and type validation behavior in a GraphQL document.

In some cases, you need to provide options to alter GraphQL's execution behavior in ways field arguments will not suffice, such as conditionally including or skipping a field. Directives provide this by describing additional information to the executor.`,fields:()=>({name:{type:new dr(un),resolve:i=>i.name},description:{type:un,resolve:i=>i.description},isRepeatable:{type:new dr(qi),resolve:i=>i.isRepeatable},locations:{type:new dr(new si(new dr(Of))),resolve:i=>i.locations},args:{type:new dr(new si(new dr(Mu))),args:{includeDeprecated:{type:qi,defaultValue:!1}},resolve(i,{includeDeprecated:l}){return l?i.args:i.args.filter(c=>c.deprecationReason==null)}}})}),Of=new pa({name:"__DirectiveLocation",description:"A Directive can be adjacent to many parts of the GraphQL language, a __DirectiveLocation describes one such possible adjacencies.",values:{QUERY:{value:Wt.QUERY,description:"Location adjacent to a query operation."},MUTATION:{value:Wt.MUTATION,description:"Location adjacent to a mutation operation."},SUBSCRIPTION:{value:Wt.SUBSCRIPTION,description:"Location adjacent to a subscription operation."},FIELD:{value:Wt.FIELD,description:"Location adjacent to a field."},FRAGMENT_DEFINITION:{value:Wt.FRAGMENT_DEFINITION,description:"Location adjacent to a fragment definition."},FRAGMENT_SPREAD:{value:Wt.FRAGMENT_SPREAD,description:"Location adjacent to a fragment spread."},INLINE_FRAGMENT:{value:Wt.INLINE_FRAGMENT,description:"Location adjacent to an inline fragment."},VARIABLE_DEFINITION:{value:Wt.VARIABLE_DEFINITION,description:"Location adjacent to a variable definition."},SCHEMA:{value:Wt.SCHEMA,description:"Location adjacent to a schema definition."},SCALAR:{value:Wt.SCALAR,description:"Location adjacent to a scalar definition."},OBJECT:{value:Wt.OBJECT,description:"Location adjacent to an object type definition."},FIELD_DEFINITION:{value:Wt.FIELD_DEFINITION,description:"Location adjacent to a field definition."},ARGUMENT_DEFINITION:{value:Wt.ARGUMENT_DEFINITION,description:"Location adjacent to an argument definition."},INTERFACE:{value:Wt.INTERFACE,description:"Location adjacent to an interface definition."},UNION:{value:Wt.UNION,description:"Location adjacent to a union definition."},ENUM:{value:Wt.ENUM,description:"Location adjacent to an enum definition."},ENUM_VALUE:{value:Wt.ENUM_VALUE,description:"Location adjacent to an enum value definition."},INPUT_OBJECT:{value:Wt.INPUT_OBJECT,description:"Location adjacent to an input object type definition."},INPUT_FIELD_DEFINITION:{value:Wt.INPUT_FIELD_DEFINITION,description:"Location adjacent to an input object field definition."}}}),cs=new us({name:"__Type",description:"The fundamental unit of any GraphQL Schema is the type. There are many kinds of types in GraphQL as represented by the `__TypeKind` enum.\n\nDepending on the kind of a type, certain fields describe information about that type. Scalar types provide no information beyond a name, description and optional `specifiedByURL`, while Enum types provide their values. Object and Interface types provide the fields they describe. Abstract types, Union and Interface, provide the Object types possible at runtime. List and NonNull types compose other types.",fields:()=>({kind:{type:new dr(Lf),resolve(i){if(Wi(i))return $r.SCALAR;if(Er(i))return $r.OBJECT;if(kr(i))return $r.INTERFACE;if(Rn(i))return $r.UNION;if(In(i))return $r.ENUM;if(Xr(i))return $r.INPUT_OBJECT;if(Wr(i))return $r.LIST;if(tr(i))return $r.NON_NULL;En(!1,`Unexpected type: "${Ke(i)}".`)}},name:{type:un,resolve:i=>"name"in i?i.name:void 0},description:{type:un,resolve:i=>"description"in i?i.description:void 0},specifiedByURL:{type:un,resolve:i=>"specifiedByURL"in i?i.specifiedByURL:void 0},fields:{type:new si(new dr(Rf)),args:{includeDeprecated:{type:qi,defaultValue:!1}},resolve(i,{includeDeprecated:l}){if(Er(i)||kr(i)){const c=Object.values(i.getFields());return l?c:c.filter(f=>f.deprecationReason==null)}}},interfaces:{type:new si(new dr(cs)),resolve(i){if(Er(i)||kr(i))return i.getInterfaces()}},possibleTypes:{type:new si(new dr(cs)),resolve(i,l,c,{schema:f}){if(Gs(i))return f.getPossibleTypes(i)}},enumValues:{type:new si(new dr(Nf)),args:{includeDeprecated:{type:qi,defaultValue:!1}},resolve(i,{includeDeprecated:l}){if(In(i)){const c=i.getValues();return l?c:c.filter(f=>f.deprecationReason==null)}}},inputFields:{type:new si(new dr(Mu)),args:{includeDeprecated:{type:qi,defaultValue:!1}},resolve(i,{includeDeprecated:l}){if(Xr(i)){const c=Object.values(i.getFields());return l?c:c.filter(f=>f.deprecationReason==null)}}},ofType:{type:cs,resolve:i=>"ofType"in i?i.ofType:void 0}})}),Rf=new us({name:"__Field",description:"Object and Interface types are described by a list of Fields, each of which has a name, potentially a list of arguments, and a return type.",fields:()=>({name:{type:new dr(un),resolve:i=>i.name},description:{type:un,resolve:i=>i.description},args:{type:new dr(new si(new dr(Mu))),args:{includeDeprecated:{type:qi,defaultValue:!1}},resolve(i,{includeDeprecated:l}){return l?i.args:i.args.filter(c=>c.deprecationReason==null)}},type:{type:new dr(cs),resolve:i=>i.type},isDeprecated:{type:new dr(qi),resolve:i=>i.deprecationReason!=null},deprecationReason:{type:un,resolve:i=>i.deprecationReason}})}),Mu=new us({name:"__InputValue",description:"Arguments provided to Fields or Directives and the input fields of an InputObject are represented as Input Values which describe their type and optionally a default value.",fields:()=>({name:{type:new dr(un),resolve:i=>i.name},description:{type:un,resolve:i=>i.description},type:{type:new dr(cs),resolve:i=>i.type},defaultValue:{type:un,description:"A GraphQL-formatted string representing the default value for this input value.",resolve(i){const{type:l,defaultValue:c}=i,f=ua(c,l);return f?Hr(f):null}},isDeprecated:{type:new dr(qi),resolve:i=>i.deprecationReason!=null},deprecationReason:{type:un,resolve:i=>i.deprecationReason}})}),Nf=new us({name:"__EnumValue",description:"One possible value for a given Enum. Enum values are unique values, not a placeholder for a string or numeric value. However an Enum value is returned in a JSON response as a string.",fields:()=>({name:{type:new dr(un),resolve:i=>i.name},description:{type:un,resolve:i=>i.description},isDeprecated:{type:new dr(qi),resolve:i=>i.deprecationReason!=null},deprecationReason:{type:un,resolve:i=>i.deprecationReason}})});var $r;(function(i){i.SCALAR="SCALAR",i.OBJECT="OBJECT",i.INTERFACE="INTERFACE",i.UNION="UNION",i.ENUM="ENUM",i.INPUT_OBJECT="INPUT_OBJECT",i.LIST="LIST",i.NON_NULL="NON_NULL"})($r||($r={}));const Lf=new pa({name:"__TypeKind",description:"An enum describing what kind of type a given `__Type` is.",values:{SCALAR:{value:$r.SCALAR,description:"Indicates this type is a scalar."},OBJECT:{value:$r.OBJECT,description:"Indicates this type is an object. `fields` and `interfaces` are valid fields."},INTERFACE:{value:$r.INTERFACE,description:"Indicates this type is an interface. `fields`, `interfaces`, and `possibleTypes` are valid fields."},UNION:{value:$r.UNION,description:"Indicates this type is a union. `possibleTypes` is a valid field."},ENUM:{value:$r.ENUM,description:"Indicates this type is an enum. `enumValues` is a valid field."},INPUT_OBJECT:{value:$r.INPUT_OBJECT,description:"Indicates this type is an input object. `inputFields` is a valid field."},LIST:{value:$r.LIST,description:"Indicates this type is a list. `ofType` is a valid field."},NON_NULL:{value:$r.NON_NULL,description:"Indicates this type is a non-null. `ofType` is a valid field."}}}),vu={name:"__schema",type:new dr(tp),description:"Access the current type schema of this server.",args:[],resolve:(i,l,c,{schema:f})=>f,deprecationReason:void 0,extensions:Object.create(null),astNode:void 0},xu={name:"__type",type:cs,description:"Request the type information of a single type.",args:[{name:"name",description:void 0,type:new dr(un),defaultValue:void 0,deprecationReason:void 0,extensions:Object.create(null),astNode:void 0}],resolve:(i,{name:l},c,{schema:f})=>f.getType(l),deprecationReason:void 0,extensions:Object.create(null),astNode:void 0},bu={name:"__typename",type:new dr(un),description:"The name of the current Object type at runtime.",args:[],resolve:(i,l,c,{parentType:f})=>f.name,deprecationReason:void 0,extensions:Object.create(null),astNode:void 0},Ou=Object.freeze([tp,Mf,Of,cs,Rf,Mu,Nf,Lf]);function el(i){return Ou.some(({name:l})=>i.name===l)}function Sv(i){return Os(i,Wl)}function Ff(i){if(!Sv(i))throw new Error(`Expected ${Ke(i)} to be a GraphQL schema.`);return i}class Wl{constructor(l){var c,f;this.__validationErrors=l.assumeValid===!0?[]:void 0,Zi(l)||fr(!1,"Must provide configuration object."),!l.types||Array.isArray(l.types)||fr(!1,`"types" must be Array if provided but got: ${Ke(l.types)}.`),!l.directives||Array.isArray(l.directives)||fr(!1,`"directives" must be Array if provided but got: ${Ke(l.directives)}.`),this.description=l.description,this.extensions=ps(l.extensions),this.astNode=l.astNode,this.extensionASTNodes=(c=l.extensionASTNodes)!==null&&c!==void 0?c:[],this._queryType=l.query,this._mutationType=l.mutation,this._subscriptionType=l.subscription,this._directives=(f=l.directives)!==null&&f!==void 0?f:ma;const _=new Set(l.types);if(l.types!=null)for(const v of l.types)_.delete(v),ks(v,_);this._queryType!=null&&ks(this._queryType,_),this._mutationType!=null&&ks(this._mutationType,_),this._subscriptionType!=null&&ks(this._subscriptionType,_);for(const v of this._directives)if(Qh(v))for(const w of v.args)ks(w.type,_);ks(tp,_),this._typeMap=Object.create(null),this._subTypeMap=Object.create(null),this._implementationsMap=Object.create(null);for(const v of _){if(v==null)continue;const w=v.name;if(w||fr(!1,"One of the provided types for building the Schema is missing a name."),this._typeMap[w]!==void 0)throw new Error(`Schema must contain uniquely named types but contains multiple types named "${w}".`);if(this._typeMap[w]=v,kr(v)){for(const o of v.getInterfaces())if(kr(o)){let I=this._implementationsMap[o.name];I===void 0&&(I=this._implementationsMap[o.name]={objects:[],interfaces:[]}),I.interfaces.push(v)}}else if(Er(v)){for(const o of v.getInterfaces())if(kr(o)){let I=this._implementationsMap[o.name];I===void 0&&(I=this._implementationsMap[o.name]={objects:[],interfaces:[]}),I.objects.push(v)}}}}get[Symbol.toStringTag](){return"GraphQLSchema"}getQueryType(){return this._queryType}getMutationType(){return this._mutationType}getSubscriptionType(){return this._subscriptionType}getRootType(l){switch(l){case On.QUERY:return this.getQueryType();case On.MUTATION:return this.getMutationType();case On.SUBSCRIPTION:return this.getSubscriptionType()}}getTypeMap(){return this._typeMap}getType(l){return this.getTypeMap()[l]}getPossibleTypes(l){return Rn(l)?l.getTypes():this.getImplementations(l).objects}getImplementations(l){const c=this._implementationsMap[l.name];return c??{objects:[],interfaces:[]}}isSubType(l,c){let f=this._subTypeMap[l.name];if(f===void 0){if(f=Object.create(null),Rn(l))for(const _ of l.getTypes())f[_.name]=!0;else{const _=this.getImplementations(l);for(const v of _.objects)f[v.name]=!0;for(const v of _.interfaces)f[v.name]=!0}this._subTypeMap[l.name]=f}return f[c.name]!==void 0}getDirectives(){return this._directives}getDirective(l){return this.getDirectives().find(c=>c.name===l)}toConfig(){return{description:this.description,query:this.getQueryType(),mutation:this.getMutationType(),subscription:this.getSubscriptionType(),types:Object.values(this.getTypeMap()),directives:this.getDirectives(),extensions:this.extensions,astNode:this.astNode,extensionASTNodes:this.extensionASTNodes,assumeValid:this.__validationErrors!==void 0}}}function ks(i,l){const c=Si(i);if(!l.has(c)){if(l.add(c),Rn(c))for(const f of c.getTypes())ks(f,l);else if(Er(c)||kr(c)){for(const f of c.getInterfaces())ks(f,l);for(const f of Object.values(c.getFields())){ks(f.type,l);for(const _ of f.args)ks(_.type,l)}}else if(Xr(c))for(const f of Object.values(c.getFields()))ks(f.type,l)}return l}function zf(i){if(Ff(i),i.__validationErrors)return i.__validationErrors;const l=new Y1(i);J1(l),K1(l),Q1(l);const c=l.getErrors();return i.__validationErrors=c,c}function Bf(i){const l=zf(i);if(l.length!==0)throw new Error(l.map(c=>c.message).join(`

`))}class Y1{constructor(l){this._errors=[],this.schema=l}reportError(l,c){const f=Array.isArray(c)?c.filter(Boolean):c;this._errors.push(new Ze(l,{nodes:f}))}getErrors(){return this._errors}}function J1(i){const l=i.schema,c=l.getQueryType();if(!c)i.reportError("Query root type must be provided.",l.astNode);else if(!Er(c)){var f;i.reportError(`Query root type must be Object type, it cannot be ${Ke(c)}.`,(f=Gd(l,On.QUERY))!==null&&f!==void 0?f:c.astNode)}const _=l.getMutationType();if(_&&!Er(_)){var v;i.reportError(`Mutation root type must be Object type if provided, it cannot be ${Ke(_)}.`,(v=Gd(l,On.MUTATION))!==null&&v!==void 0?v:_.astNode)}const w=l.getSubscriptionType();if(w&&!Er(w)){var o;i.reportError(`Subscription root type must be Object type if provided, it cannot be ${Ke(w)}.`,(o=Gd(l,On.SUBSCRIPTION))!==null&&o!==void 0?o:w.astNode)}}function Gd(i,l){var c;return(c=[i.astNode,...i.extensionASTNodes].flatMap(f=>{var _;return(_=f==null?void 0:f.operationTypes)!==null&&_!==void 0?_:[]}).find(f=>f.operation===l))===null||c===void 0?void 0:c.type}function K1(i){for(const c of i.schema.getDirectives()){if(!Qh(c)){i.reportError(`Expected directive but got: ${Ke(c)}.`,c==null?void 0:c.astNode);continue}Qa(i,c);for(const f of c.args)if(Qa(i,f),Mi(f.type)||i.reportError(`The type of @${c.name}(${f.name}:) must be Input Type but got: ${Ke(f.type)}.`,f.astNode),fa(f)&&f.deprecationReason!=null){var l;i.reportError(`Required argument @${c.name}(${f.name}:) cannot be deprecated.`,[Uf(f.astNode),(l=f.astNode)===null||l===void 0?void 0:l.type])}}}function Qa(i,l){l.name.startsWith("__")&&i.reportError(`Name "${l.name}" must not begin with "__", which is reserved by GraphQL introspection.`,l.astNode)}function Q1(i){const l=sE(i),c=i.schema.getTypeMap();for(const f of Object.values(c)){if(!Cu(f)){i.reportError(`Expected GraphQL named type but got: ${Ke(f)}.`,f.astNode);continue}el(f)||Qa(i,f),Er(f)||kr(f)?(c_(i,f),u_(i,f)):Rn(f)?rE(i,f):In(f)?nE(i,f):Xr(f)&&(iE(i,f),l(f))}}function c_(i,l){const c=Object.values(l.getFields());c.length===0&&i.reportError(`Type ${l.name} must define one or more fields.`,[l.astNode,...l.extensionASTNodes]);for(const w of c){if(Qa(i,w),!ha(w.type)){var f;i.reportError(`The type of ${l.name}.${w.name} must be Output Type but got: ${Ke(w.type)}.`,(f=w.astNode)===null||f===void 0?void 0:f.type)}for(const o of w.args){const I=o.name;if(Qa(i,o),!Mi(o.type)){var _;i.reportError(`The type of ${l.name}.${w.name}(${I}:) must be Input Type but got: ${Ke(o.type)}.`,(_=o.astNode)===null||_===void 0?void 0:_.type)}if(fa(o)&&o.deprecationReason!=null){var v;i.reportError(`Required argument ${l.name}.${w.name}(${I}:) cannot be deprecated.`,[Uf(o.astNode),(v=o.astNode)===null||v===void 0?void 0:v.type])}}}}function u_(i,l){const c=Object.create(null);for(const f of l.getInterfaces()){if(!kr(f)){i.reportError(`Type ${Ke(l)} must only implement Interface types, it cannot implement ${Ke(f)}.`,mu(l,f));continue}if(l===f){i.reportError(`Type ${l.name} cannot implement itself because it would create a circular reference.`,mu(l,f));continue}if(c[f.name]){i.reportError(`Type ${l.name} can only implement ${f.name} once.`,mu(l,f));continue}c[f.name]=!0,tE(i,l,f),eE(i,l,f)}}function eE(i,l,c){const f=l.getFields();for(const I of Object.values(c.getFields())){const A=I.name,L=f[A];if(!L){i.reportError(`Interface field ${c.name}.${A} expected but ${l.name} does not provide it.`,[I.astNode,l.astNode,...l.extensionASTNodes]);continue}if(!Ja(i.schema,L.type,I.type)){var _,v;i.reportError(`Interface field ${c.name}.${A} expects type ${Ke(I.type)} but ${l.name}.${A} is type ${Ke(L.type)}.`,[(_=I.astNode)===null||_===void 0?void 0:_.type,(v=L.astNode)===null||v===void 0?void 0:v.type])}for(const R of I.args){const P=R.name,q=L.args.find(ie=>ie.name===P);if(!q){i.reportError(`Interface field argument ${c.name}.${A}(${P}:) expected but ${l.name}.${A} does not provide it.`,[R.astNode,L.astNode]);continue}if(!Oh(R.type,q.type)){var w,o;i.reportError(`Interface field argument ${c.name}.${A}(${P}:) expects type ${Ke(R.type)} but ${l.name}.${A}(${P}:) is type ${Ke(q.type)}.`,[(w=R.astNode)===null||w===void 0?void 0:w.type,(o=q.astNode)===null||o===void 0?void 0:o.type])}}for(const R of L.args){const P=R.name;!I.args.find(ie=>ie.name===P)&&fa(R)&&i.reportError(`Object field ${l.name}.${A} includes required argument ${P} that is missing from the Interface field ${c.name}.${A}.`,[R.astNode,I.astNode])}}}function tE(i,l,c){const f=l.getInterfaces();for(const _ of c.getInterfaces())f.includes(_)||i.reportError(_===l?`Type ${l.name} cannot implement ${c.name} because it would create a circular reference.`:`Type ${l.name} must implement ${_.name} because it is implemented by ${c.name}.`,[...mu(c,_),...mu(l,c)])}function rE(i,l){const c=l.getTypes();c.length===0&&i.reportError(`Union type ${l.name} must define one or more member types.`,[l.astNode,...l.extensionASTNodes]);const f=Object.create(null);for(const _ of c){if(f[_.name]){i.reportError(`Union type ${l.name} can only include type ${_.name} once.`,h_(l,_.name));continue}f[_.name]=!0,Er(_)||i.reportError(`Union type ${l.name} can only include Object types, it cannot include ${Ke(_)}.`,h_(l,String(_)))}}function nE(i,l){const c=l.getValues();c.length===0&&i.reportError(`Enum type ${l.name} must define one or more values.`,[l.astNode,...l.extensionASTNodes]);for(const f of c)Qa(i,f)}function iE(i,l){const c=Object.values(l.getFields());c.length===0&&i.reportError(`Input Object type ${l.name} must define one or more fields.`,[l.astNode,...l.extensionASTNodes]);for(const v of c){if(Qa(i,v),!Mi(v.type)){var f;i.reportError(`The type of ${l.name}.${v.name} must be Input Type but got: ${Ke(v.type)}.`,(f=v.astNode)===null||f===void 0?void 0:f.type)}if(Jh(v)&&v.deprecationReason!=null){var _;i.reportError(`Required input field ${l.name}.${v.name} cannot be deprecated.`,[Uf(v.astNode),(_=v.astNode)===null||_===void 0?void 0:_.type])}}}function sE(i){const l=Object.create(null),c=[],f=Object.create(null);return _;function _(v){if(l[v.name])return;l[v.name]=!0,f[v.name]=c.length;const w=Object.values(v.getFields());for(const o of w)if(tr(o.type)&&Xr(o.type.ofType)){const I=o.type.ofType,A=f[I.name];if(c.push(o),A===void 0)_(I);else{const L=c.slice(A),R=L.map(P=>P.name).join(".");i.reportError(`Cannot reference Input Object "${I.name}" within itself through a series of non-null fields: "${R}".`,L.map(P=>P.astNode))}c.pop()}f[v.name]=void 0}}function mu(i,l){const{astNode:c,extensionASTNodes:f}=i;return(c!=null?[c,...f]:f).flatMap(v=>{var w;return(w=v.interfaces)!==null&&w!==void 0?w:[]}).filter(v=>v.name.value===l.name)}function h_(i,l){const{astNode:c,extensionASTNodes:f}=i;return(c!=null?[c,...f]:f).flatMap(v=>{var w;return(w=v.types)!==null&&w!==void 0?w:[]}).filter(v=>v.name.value===l)}function Uf(i){var l;return i==null||(l=i.directives)===null||l===void 0?void 0:l.find(c=>c.name.value===ep.name)}function Oi(i,l){switch(l.kind){case fe.LIST_TYPE:{const c=Oi(i,l.type);return c&&new si(c)}case fe.NON_NULL_TYPE:{const c=Oi(i,l.type);return c&&new dr(c)}case fe.NAMED_TYPE:return i.getType(l.name.value)}}class $f{constructor(l,c,f){this._schema=l,this._typeStack=[],this._parentTypeStack=[],this._inputTypeStack=[],this._fieldDefStack=[],this._defaultValueStack=[],this._directive=null,this._argument=null,this._enumValue=null,this._getFieldDef=f??oE,c&&(Mi(c)&&this._inputTypeStack.push(c),Hs(c)&&this._parentTypeStack.push(c),ha(c)&&this._typeStack.push(c))}get[Symbol.toStringTag](){return"TypeInfo"}getType(){if(this._typeStack.length>0)return this._typeStack[this._typeStack.length-1]}getParentType(){if(this._parentTypeStack.length>0)return this._parentTypeStack[this._parentTypeStack.length-1]}getInputType(){if(this._inputTypeStack.length>0)return this._inputTypeStack[this._inputTypeStack.length-1]}getParentInputType(){if(this._inputTypeStack.length>1)return this._inputTypeStack[this._inputTypeStack.length-2]}getFieldDef(){if(this._fieldDefStack.length>0)return this._fieldDefStack[this._fieldDefStack.length-1]}getDefaultValue(){if(this._defaultValueStack.length>0)return this._defaultValueStack[this._defaultValueStack.length-1]}getDirective(){return this._directive}getArgument(){return this._argument}getEnumValue(){return this._enumValue}enter(l){const c=this._schema;switch(l.kind){case fe.SELECTION_SET:{const _=Si(this.getType());this._parentTypeStack.push(Hs(_)?_:void 0);break}case fe.FIELD:{const _=this.getParentType();let v,w;_&&(v=this._getFieldDef(c,_,l),v&&(w=v.type)),this._fieldDefStack.push(v),this._typeStack.push(ha(w)?w:void 0);break}case fe.DIRECTIVE:this._directive=c.getDirective(l.name.value);break;case fe.OPERATION_DEFINITION:{const _=c.getRootType(l.operation);this._typeStack.push(Er(_)?_:void 0);break}case fe.INLINE_FRAGMENT:case fe.FRAGMENT_DEFINITION:{const _=l.typeCondition,v=_?Oi(c,_):Si(this.getType());this._typeStack.push(ha(v)?v:void 0);break}case fe.VARIABLE_DEFINITION:{const _=Oi(c,l.type);this._inputTypeStack.push(Mi(_)?_:void 0);break}case fe.ARGUMENT:{var f;let _,v;const w=(f=this.getDirective())!==null&&f!==void 0?f:this.getFieldDef();w&&(_=w.args.find(o=>o.name===l.name.value),_&&(v=_.type)),this._argument=_,this._defaultValueStack.push(_?_.defaultValue:void 0),this._inputTypeStack.push(Mi(v)?v:void 0);break}case fe.LIST:{const _=wf(this.getInputType()),v=Wr(_)?_.ofType:_;this._defaultValueStack.push(void 0),this._inputTypeStack.push(Mi(v)?v:void 0);break}case fe.OBJECT_FIELD:{const _=Si(this.getInputType());let v,w;Xr(_)&&(w=_.getFields()[l.name.value],w&&(v=w.type)),this._defaultValueStack.push(w?w.defaultValue:void 0),this._inputTypeStack.push(Mi(v)?v:void 0);break}case fe.ENUM:{const _=Si(this.getInputType());let v;In(_)&&(v=_.getValue(l.value)),this._enumValue=v;break}}}leave(l){switch(l.kind){case fe.SELECTION_SET:this._parentTypeStack.pop();break;case fe.FIELD:this._fieldDefStack.pop(),this._typeStack.pop();break;case fe.DIRECTIVE:this._directive=null;break;case fe.OPERATION_DEFINITION:case fe.INLINE_FRAGMENT:case fe.FRAGMENT_DEFINITION:this._typeStack.pop();break;case fe.VARIABLE_DEFINITION:this._inputTypeStack.pop();break;case fe.ARGUMENT:this._argument=null,this._defaultValueStack.pop(),this._inputTypeStack.pop();break;case fe.LIST:case fe.OBJECT_FIELD:this._defaultValueStack.pop(),this._inputTypeStack.pop();break;case fe.ENUM:this._enumValue=null;break}}}function oE(i,l,c){const f=c.name.value;if(f===vu.name&&i.getQueryType()===l)return vu;if(f===xu.name&&i.getQueryType()===l)return xu;if(f===bu.name&&Hs(l))return bu;if(Er(l)||kr(l))return l.getFields()[f]}function Vf(i,l){return{enter(...c){const f=c[0];i.enter(f);const _=Ul(l,f.kind).enter;if(_){const v=_.apply(l,c);return v!==void 0&&(i.leave(f),Kd(v)&&i.enter(v)),v}},leave(...c){const f=c[0],_=Ul(l,f.kind).leave;let v;return _&&(v=_.apply(l,c)),i.leave(f),v}}}function aE(i){return jf(i)||qf(i)||Gf(i)}function jf(i){return i.kind===fe.OPERATION_DEFINITION||i.kind===fe.FRAGMENT_DEFINITION}function lE(i){return i.kind===fe.FIELD||i.kind===fe.FRAGMENT_SPREAD||i.kind===fe.INLINE_FRAGMENT}function Iv(i){return i.kind===fe.VARIABLE||i.kind===fe.INT||i.kind===fe.FLOAT||i.kind===fe.STRING||i.kind===fe.BOOLEAN||i.kind===fe.NULL||i.kind===fe.ENUM||i.kind===fe.LIST||i.kind===fe.OBJECT}function rf(i){return Iv(i)&&(i.kind===fe.LIST?i.values.some(rf):i.kind===fe.OBJECT?i.fields.some(l=>rf(l.value)):i.kind!==fe.VARIABLE)}function cE(i){return i.kind===fe.NAMED_TYPE||i.kind===fe.LIST_TYPE||i.kind===fe.NON_NULL_TYPE}function qf(i){return i.kind===fe.SCHEMA_DEFINITION||Xl(i)||i.kind===fe.DIRECTIVE_DEFINITION}function Xl(i){return i.kind===fe.SCALAR_TYPE_DEFINITION||i.kind===fe.OBJECT_TYPE_DEFINITION||i.kind===fe.INTERFACE_TYPE_DEFINITION||i.kind===fe.UNION_TYPE_DEFINITION||i.kind===fe.ENUM_TYPE_DEFINITION||i.kind===fe.INPUT_OBJECT_TYPE_DEFINITION}function Gf(i){return i.kind===fe.SCHEMA_EXTENSION||rp(i)}function rp(i){return i.kind===fe.SCALAR_TYPE_EXTENSION||i.kind===fe.OBJECT_TYPE_EXTENSION||i.kind===fe.INTERFACE_TYPE_EXTENSION||i.kind===fe.UNION_TYPE_EXTENSION||i.kind===fe.ENUM_TYPE_EXTENSION||i.kind===fe.INPUT_OBJECT_TYPE_EXTENSION}function Av(i){return{Document(l){for(const c of l.definitions)if(!jf(c)){const f=c.kind===fe.SCHEMA_DEFINITION||c.kind===fe.SCHEMA_EXTENSION?"schema":'"'+c.name.value+'"';i.reportError(new Ze(`The ${f} definition is not executable.`,{nodes:c}))}return!1}}}function Dv(i){return{Field(l){const c=i.getParentType();if(c&&!i.getFieldDef()){const _=i.getSchema(),v=l.name.value;let w=Do("to use an inline fragment on",uE(_,c,v));w===""&&(w=Do(hE(c,v))),i.reportError(new Ze(`Cannot query field "${v}" on type "${c.name}".`+w,{nodes:l}))}}}}function uE(i,l,c){if(!Gs(l))return[];const f=new Set,_=Object.create(null);for(const w of i.getPossibleTypes(l))if(w.getFields()[c]){f.add(w),_[w.name]=1;for(const o of w.getInterfaces()){var v;o.getFields()[c]&&(f.add(o),_[o.name]=((v=_[o.name])!==null&&v!==void 0?v:0)+1)}}return[...f].sort((w,o)=>{const I=_[o.name]-_[w.name];return I!==0?I:kr(w)&&i.isSubType(w,o)?-1:kr(o)&&i.isSubType(o,w)?1:Iu(w.name,o.name)}).map(w=>w.name)}function hE(i,l){if(Er(i)||kr(i)){const c=Object.keys(i.getFields());return da(l,c)}return[]}function Cv(i){return{InlineFragment(l){const c=l.typeCondition;if(c){const f=Oi(i.getSchema(),c);if(f&&!Hs(f)){const _=Hr(c);i.reportError(new Ze(`Fragment cannot condition on non composite type "${_}".`,{nodes:c}))}}},FragmentDefinition(l){const c=Oi(i.getSchema(),l.typeCondition);if(c&&!Hs(c)){const f=Hr(l.typeCondition);i.reportError(new Ze(`Fragment "${l.name.value}" cannot condition on non composite type "${f}".`,{nodes:l.typeCondition}))}}}}function Pv(i){return{...kv(i),Argument(l){const c=i.getArgument(),f=i.getFieldDef(),_=i.getParentType();if(!c&&f&&_){const v=l.name.value,w=f.args.map(I=>I.name),o=da(v,w);i.reportError(new Ze(`Unknown argument "${v}" on field "${_.name}.${f.name}".`+Do(o),{nodes:l}))}}}}function kv(i){const l=Object.create(null),c=i.getSchema(),f=c?c.getDirectives():ma;for(const w of f)l[w.name]=w.args.map(o=>o.name);const _=i.getDocument().definitions;for(const w of _)if(w.kind===fe.DIRECTIVE_DEFINITION){var v;const o=(v=w.arguments)!==null&&v!==void 0?v:[];l[w.name.value]=o.map(I=>I.name.value)}return{Directive(w){const o=w.name.value,I=l[o];if(w.arguments&&I)for(const A of w.arguments){const L=A.name.value;if(!I.includes(L)){const R=da(L,I);i.reportError(new Ze(`Unknown argument "${L}" on directive "@${o}".`+Do(R),{nodes:A}))}}return!1}}}function Zf(i){const l=Object.create(null),c=i.getSchema(),f=c?c.getDirectives():ma;for(const v of f)l[v.name]=v.locations;const _=i.getDocument().definitions;for(const v of _)v.kind===fe.DIRECTIVE_DEFINITION&&(l[v.name.value]=v.locations.map(w=>w.value));return{Directive(v,w,o,I,A){const L=v.name.value,R=l[L];if(!R){i.reportError(new Ze(`Unknown directive "@${L}".`,{nodes:v}));return}const P=pE(A);P&&!R.includes(P)&&i.reportError(new Ze(`Directive "@${L}" may not be used on ${P}.`,{nodes:v}))}}}function pE(i){const l=i[i.length-1];switch("kind"in l||En(!1),l.kind){case fe.OPERATION_DEFINITION:return dE(l.operation);case fe.FIELD:return Wt.FIELD;case fe.FRAGMENT_SPREAD:return Wt.FRAGMENT_SPREAD;case fe.INLINE_FRAGMENT:return Wt.INLINE_FRAGMENT;case fe.FRAGMENT_DEFINITION:return Wt.FRAGMENT_DEFINITION;case fe.VARIABLE_DEFINITION:return Wt.VARIABLE_DEFINITION;case fe.SCHEMA_DEFINITION:case fe.SCHEMA_EXTENSION:return Wt.SCHEMA;case fe.SCALAR_TYPE_DEFINITION:case fe.SCALAR_TYPE_EXTENSION:return Wt.SCALAR;case fe.OBJECT_TYPE_DEFINITION:case fe.OBJECT_TYPE_EXTENSION:return Wt.OBJECT;case fe.FIELD_DEFINITION:return Wt.FIELD_DEFINITION;case fe.INTERFACE_TYPE_DEFINITION:case fe.INTERFACE_TYPE_EXTENSION:return Wt.INTERFACE;case fe.UNION_TYPE_DEFINITION:case fe.UNION_TYPE_EXTENSION:return Wt.UNION;case fe.ENUM_TYPE_DEFINITION:case fe.ENUM_TYPE_EXTENSION:return Wt.ENUM;case fe.ENUM_VALUE_DEFINITION:return Wt.ENUM_VALUE;case fe.INPUT_OBJECT_TYPE_DEFINITION:case fe.INPUT_OBJECT_TYPE_EXTENSION:return Wt.INPUT_OBJECT;case fe.INPUT_VALUE_DEFINITION:{const c=i[i.length-3];return"kind"in c||En(!1),c.kind===fe.INPUT_OBJECT_TYPE_DEFINITION?Wt.INPUT_FIELD_DEFINITION:Wt.ARGUMENT_DEFINITION}default:En(!1,"Unexpected kind: "+Ke(l.kind))}}function dE(i){switch(i){case On.QUERY:return Wt.QUERY;case On.MUTATION:return Wt.MUTATION;case On.SUBSCRIPTION:return Wt.SUBSCRIPTION}}function Mv(i){return{FragmentSpread(l){const c=l.name.value;i.getFragment(c)||i.reportError(new Ze(`Unknown fragment "${c}".`,{nodes:l.name}))}}}function Hf(i){const l=i.getSchema(),c=l?l.getTypeMap():Object.create(null),f=Object.create(null);for(const v of i.getDocument().definitions)Xl(v)&&(f[v.name.value]=!0);const _=[...Object.keys(c),...Object.keys(f)];return{NamedType(v,w,o,I,A){const L=v.name.value;if(!c[L]&&!f[L]){var R;const P=(R=A[2])!==null&&R!==void 0?R:o,q=P!=null&&fE(P);if(q&&p_.includes(L))return;const ie=da(L,q?p_.concat(_):_);i.reportError(new Ze(`Unknown type "${L}".`+Do(ie),{nodes:v}))}}}}const p_=[...Pu,...Ou].map(i=>i.name);function fE(i){return"kind"in i&&(qf(i)||Gf(i))}function Ov(i){let l=0;return{Document(c){l=c.definitions.filter(f=>f.kind===fe.OPERATION_DEFINITION).length},OperationDefinition(c){!c.name&&l>1&&i.reportError(new Ze("This anonymous operation must be the only defined operation.",{nodes:c}))}}}function Rv(i){var l,c,f;const _=i.getSchema(),v=(l=(c=(f=_==null?void 0:_.astNode)!==null&&f!==void 0?f:_==null?void 0:_.getQueryType())!==null&&c!==void 0?c:_==null?void 0:_.getMutationType())!==null&&l!==void 0?l:_==null?void 0:_.getSubscriptionType();let w=0;return{SchemaDefinition(o){if(v){i.reportError(new Ze("Cannot define a new schema within a schema extension.",{nodes:o}));return}w>0&&i.reportError(new Ze("Must provide only one schema definition.",{nodes:o})),++w}}}function Nv(i){const l=Object.create(null),c=[],f=Object.create(null);return{OperationDefinition:()=>!1,FragmentDefinition(v){return _(v),!1}};function _(v){if(l[v.name.value])return;const w=v.name.value;l[w]=!0;const o=i.getFragmentSpreads(v.selectionSet);if(o.length!==0){f[w]=c.length;for(const I of o){const A=I.name.value,L=f[A];if(c.push(I),L===void 0){const R=i.getFragment(A);R&&_(R)}else{const R=c.slice(L),P=R.slice(0,-1).map(q=>'"'+q.name.value+'"').join(", ");i.reportError(new Ze(`Cannot spread fragment "${A}" within itself`+(P!==""?` via ${P}.`:"."),{nodes:R}))}c.pop()}f[w]=void 0}}}function Lv(i){let l=Object.create(null);return{OperationDefinition:{enter(){l=Object.create(null)},leave(c){const f=i.getRecursiveVariableUsages(c);for(const{node:_}of f){const v=_.name.value;l[v]!==!0&&i.reportError(new Ze(c.name?`Variable "$${v}" is not defined by operation "${c.name.value}".`:`Variable "$${v}" is not defined.`,{nodes:[_,c]}))}}},VariableDefinition(c){l[c.variable.name.value]=!0}}}function Fv(i){const l=[],c=[];return{OperationDefinition(f){return l.push(f),!1},FragmentDefinition(f){return c.push(f),!1},Document:{leave(){const f=Object.create(null);for(const _ of l)for(const v of i.getRecursivelyReferencedFragments(_))f[v.name.value]=!0;for(const _ of c){const v=_.name.value;f[v]!==!0&&i.reportError(new Ze(`Fragment "${v}" is never used.`,{nodes:_}))}}}}}function zv(i){let l=[];return{OperationDefinition:{enter(){l=[]},leave(c){const f=Object.create(null),_=i.getRecursiveVariableUsages(c);for(const{node:v}of _)f[v.name.value]=!0;for(const v of l){const w=v.variable.name.value;f[w]!==!0&&i.reportError(new Ze(c.name?`Variable "$${w}" is never used in operation "${c.name.value}".`:`Variable "$${w}" is never used.`,{nodes:v}))}}},VariableDefinition(c){l.push(c)}}}function np(i){switch(i.kind){case fe.OBJECT:return{...i,fields:mE(i.fields)};case fe.LIST:return{...i,values:i.values.map(np)};case fe.INT:case fe.FLOAT:case fe.STRING:case fe.BOOLEAN:case fe.NULL:case fe.ENUM:case fe.VARIABLE:return i}}function mE(i){return i.map(l=>({...l,value:np(l.value)})).sort((l,c)=>Iu(l.name.value,c.name.value))}function Bv(i){return Array.isArray(i)?i.map(([l,c])=>`subfields "${l}" conflict because `+Bv(c)).join(" and "):i}function Uv(i){const l=new xE,c=new Map;return{SelectionSet(f){const _=gE(i,c,l,i.getParentType(),f);for(const[[v,w],o,I]of _){const A=Bv(w);i.reportError(new Ze(`Fields "${v}" conflict because ${A}. Use different aliases on the fields to fetch both if this was intentional.`,{nodes:o.concat(I)}))}}}}function gE(i,l,c,f,_){const v=[],[w,o]=Lh(i,l,f,_);if(_E(i,v,l,c,w),o.length!==0)for(let I=0;I<o.length;I++){Rh(i,v,l,c,!1,w,o[I]);for(let A=I+1;A<o.length;A++)Nh(i,v,l,c,!1,o[I],o[A])}return v}function Rh(i,l,c,f,_,v,w){const o=i.getFragment(w);if(!o)return;const[I,A]=sf(i,c,o);if(v!==I){Wf(i,l,c,f,_,v,I);for(const L of A)f.has(L,w,_)||(f.add(L,w,_),Rh(i,l,c,f,_,v,L))}}function Nh(i,l,c,f,_,v,w){if(v===w||f.has(v,w,_))return;f.add(v,w,_);const o=i.getFragment(v),I=i.getFragment(w);if(!o||!I)return;const[A,L]=sf(i,c,o),[R,P]=sf(i,c,I);Wf(i,l,c,f,_,A,R);for(const q of P)Nh(i,l,c,f,_,v,q);for(const q of L)Nh(i,l,c,f,_,q,w)}function yE(i,l,c,f,_,v,w,o){const I=[],[A,L]=Lh(i,l,_,v),[R,P]=Lh(i,l,w,o);Wf(i,I,l,c,f,A,R);for(const q of P)Rh(i,I,l,c,f,A,q);for(const q of L)Rh(i,I,l,c,f,R,q);for(const q of L)for(const ie of P)Nh(i,I,l,c,f,q,ie);return I}function _E(i,l,c,f,_){for(const[v,w]of Object.entries(_))if(w.length>1)for(let o=0;o<w.length;o++)for(let I=o+1;I<w.length;I++){const A=$v(i,c,f,!1,v,w[o],w[I]);A&&l.push(A)}}function Wf(i,l,c,f,_,v,w){for(const[o,I]of Object.entries(v)){const A=w[o];if(A)for(const L of I)for(const R of A){const P=$v(i,c,f,_,o,L,R);P&&l.push(P)}}}function $v(i,l,c,f,_,v,w){const[o,I,A]=v,[L,R,P]=w,q=f||o!==L&&Er(o)&&Er(L);if(!q){const Oe=I.name.value,Pe=R.name.value;if(Oe!==Pe)return[[_,`"${Oe}" and "${Pe}" are different fields`],[I],[R]];if(d_(I)!==d_(R))return[[_,"they have differing arguments"],[I],[R]]}const ie=A==null?void 0:A.type,le=P==null?void 0:P.type;if(ie&&le&&nf(ie,le))return[[_,`they return conflicting types "${Ke(ie)}" and "${Ke(le)}"`],[I],[R]];const V=I.selectionSet,me=R.selectionSet;if(V&&me){const Oe=yE(i,l,c,q,Si(ie),V,Si(le),me);return vE(Oe,_,I,R)}}function d_(i){var l;const c=(l=i.arguments)!==null&&l!==void 0?l:[],f={kind:fe.OBJECT,fields:c.map(_=>({kind:fe.OBJECT_FIELD,name:_.name,value:_.value}))};return Hr(np(f))}function nf(i,l){return Wr(i)?Wr(l)?nf(i.ofType,l.ofType):!0:Wr(l)?!0:tr(i)?tr(l)?nf(i.ofType,l.ofType):!0:tr(l)?!0:Zs(i)||Zs(l)?i!==l:!1}function Lh(i,l,c,f){const _=l.get(f);if(_)return _;const v=Object.create(null),w=Object.create(null);Vv(i,c,f,v,w);const o=[v,Object.keys(w)];return l.set(f,o),o}function sf(i,l,c){const f=l.get(c.selectionSet);if(f)return f;const _=Oi(i.getSchema(),c.typeCondition);return Lh(i,l,_,c.selectionSet)}function Vv(i,l,c,f,_){for(const v of c.selections)switch(v.kind){case fe.FIELD:{const w=v.name.value;let o;(Er(l)||kr(l))&&(o=l.getFields()[w]);const I=v.alias?v.alias.value:w;f[I]||(f[I]=[]),f[I].push([l,v,o]);break}case fe.FRAGMENT_SPREAD:_[v.name.value]=!0;break;case fe.INLINE_FRAGMENT:{const w=v.typeCondition,o=w?Oi(i.getSchema(),w):l;Vv(i,o,v.selectionSet,f,_);break}}}function vE(i,l,c,f){if(i.length>0)return[[l,i.map(([_])=>_)],[c,...i.map(([,_])=>_).flat()],[f,...i.map(([,,_])=>_).flat()]]}class xE{constructor(){this._data=new Map}has(l,c,f){var _;const[v,w]=l<c?[l,c]:[c,l],o=(_=this._data.get(v))===null||_===void 0?void 0:_.get(w);return o===void 0?!1:f?!0:f===o}add(l,c,f){const[_,v]=l<c?[l,c]:[c,l],w=this._data.get(_);w===void 0?this._data.set(_,new Map([[v,f]])):w.set(v,f)}}function jv(i){return{InlineFragment(l){const c=i.getType(),f=i.getParentType();if(Hs(c)&&Hs(f)&&!tf(i.getSchema(),c,f)){const _=Ke(f),v=Ke(c);i.reportError(new Ze(`Fragment cannot be spread here as objects of type "${_}" can never be of type "${v}".`,{nodes:l}))}},FragmentSpread(l){const c=l.name.value,f=bE(i,c),_=i.getParentType();if(f&&_&&!tf(i.getSchema(),f,_)){const v=Ke(_),w=Ke(f);i.reportError(new Ze(`Fragment "${c}" cannot be spread here as objects of type "${v}" can never be of type "${w}".`,{nodes:l}))}}}}function bE(i,l){const c=i.getFragment(l);if(c){const f=Oi(i.getSchema(),c.typeCondition);if(Hs(f))return f}}function qv(i){const l=i.getSchema(),c=Object.create(null);for(const _ of i.getDocument().definitions)Xl(_)&&(c[_.name.value]=_);return{ScalarTypeExtension:f,ObjectTypeExtension:f,InterfaceTypeExtension:f,UnionTypeExtension:f,EnumTypeExtension:f,InputObjectTypeExtension:f};function f(_){const v=_.name.value,w=c[v],o=l==null?void 0:l.getType(v);let I;if(w?I=wE[w.kind]:o&&(I=EE(o)),I){if(I!==_.kind){const A=TE(_.kind);i.reportError(new Ze(`Cannot extend non-${A} type "${v}".`,{nodes:w?[w,_]:_}))}}else{const A=Object.keys({...c,...l==null?void 0:l.getTypeMap()}),L=da(v,A);i.reportError(new Ze(`Cannot extend type "${v}" because it is not defined.`+Do(L),{nodes:_.name}))}}}const wE={[fe.SCALAR_TYPE_DEFINITION]:fe.SCALAR_TYPE_EXTENSION,[fe.OBJECT_TYPE_DEFINITION]:fe.OBJECT_TYPE_EXTENSION,[fe.INTERFACE_TYPE_DEFINITION]:fe.INTERFACE_TYPE_EXTENSION,[fe.UNION_TYPE_DEFINITION]:fe.UNION_TYPE_EXTENSION,[fe.ENUM_TYPE_DEFINITION]:fe.ENUM_TYPE_EXTENSION,[fe.INPUT_OBJECT_TYPE_DEFINITION]:fe.INPUT_OBJECT_TYPE_EXTENSION};function EE(i){if(Wi(i))return fe.SCALAR_TYPE_EXTENSION;if(Er(i))return fe.OBJECT_TYPE_EXTENSION;if(kr(i))return fe.INTERFACE_TYPE_EXTENSION;if(Rn(i))return fe.UNION_TYPE_EXTENSION;if(In(i))return fe.ENUM_TYPE_EXTENSION;if(Xr(i))return fe.INPUT_OBJECT_TYPE_EXTENSION;En(!1,"Unexpected type: "+Ke(i))}function TE(i){switch(i){case fe.SCALAR_TYPE_EXTENSION:return"scalar";case fe.OBJECT_TYPE_EXTENSION:return"object";case fe.INTERFACE_TYPE_EXTENSION:return"interface";case fe.UNION_TYPE_EXTENSION:return"union";case fe.ENUM_TYPE_EXTENSION:return"enum";case fe.INPUT_OBJECT_TYPE_EXTENSION:return"input object";default:En(!1,"Unexpected kind: "+Ke(i))}}function Gv(i){return{...Zv(i),Field:{leave(l){var c;const f=i.getFieldDef();if(!f)return!1;const _=new Set((c=l.arguments)===null||c===void 0?void 0:c.map(v=>v.name.value));for(const v of f.args)if(!_.has(v.name)&&fa(v)){const w=Ke(v.type);i.reportError(new Ze(`Field "${f.name}" argument "${v.name}" of type "${w}" is required, but it was not provided.`,{nodes:l}))}}}}}function Zv(i){var l;const c=Object.create(null),f=i.getSchema(),_=(l=f==null?void 0:f.getDirectives())!==null&&l!==void 0?l:ma;for(const o of _)c[o.name]=Co(o.args.filter(fa),I=>I.name);const v=i.getDocument().definitions;for(const o of v)if(o.kind===fe.DIRECTIVE_DEFINITION){var w;const I=(w=o.arguments)!==null&&w!==void 0?w:[];c[o.name.value]=Co(I.filter(SE),A=>A.name.value)}return{Directive:{leave(o){const I=o.name.value,A=c[I];if(A){var L;const R=(L=o.arguments)!==null&&L!==void 0?L:[],P=new Set(R.map(q=>q.name.value));for(const[q,ie]of Object.entries(A))if(!P.has(q)){const le=Au(ie.type)?Ke(ie.type):Hr(ie.type);i.reportError(new Ze(`Directive "@${I}" argument "${q}" of type "${le}" is required, but it was not provided.`,{nodes:o}))}}}}}}function SE(i){return i.type.kind===fe.NON_NULL_TYPE&&i.defaultValue==null}function Hv(i){return{Field(l){const c=i.getType(),f=l.selectionSet;if(c){if(Zs(Si(c))){if(f){const _=l.name.value,v=Ke(c);i.reportError(new Ze(`Field "${_}" must not have a selection since type "${v}" has no subfields.`,{nodes:f}))}}else if(!f){const _=l.name.value,v=Ke(c);i.reportError(new Ze(`Field "${_}" of type "${v}" must have a selection of subfields. Did you mean "${_} { ... }"?`,{nodes:l}))}}}}}function Wv(i){return i.map(l=>typeof l=="number"?"["+l.toString()+"]":"."+l).join("")}function ql(i,l,c){return{prev:i,key:l,typename:c}}function ji(i){const l=[];let c=i;for(;c;)l.push(c.key),c=c.prev;return l.reverse()}function Xv(i,l,c=IE){return uu(i,l,c,void 0)}function IE(i,l,c){let f="Invalid value "+Ke(l);throw i.length>0&&(f+=` at "value${Wv(i)}"`),c.message=f+": "+c.message,c}function uu(i,l,c,f){if(tr(l)){if(i!=null)return uu(i,l.ofType,c,f);c(ji(f),i,new Ze(`Expected non-nullable type "${Ke(l)}" not to be null.`));return}if(i==null)return null;if(Wr(l)){const _=l.ofType;return kf(i)?Array.from(i,(v,w)=>{const o=ql(f,w,void 0);return uu(v,_,c,o)}):[uu(i,_,c,f)]}if(Xr(l)){if(!Zi(i)){c(ji(f),i,new Ze(`Expected type "${l.name}" to be an object.`));return}const _={},v=l.getFields();for(const w of Object.values(v)){const o=i[w.name];if(o===void 0){if(w.defaultValue!==void 0)_[w.name]=w.defaultValue;else if(tr(w.type)){const I=Ke(w.type);c(ji(f),i,new Ze(`Field "${w.name}" of required type "${I}" was not provided.`))}continue}_[w.name]=uu(o,w.type,c,ql(f,w.name,l.name))}for(const w of Object.keys(i))if(!v[w]){const o=da(w,Object.keys(l.getFields()));c(ji(f),i,new Ze(`Field "${w}" is not defined by type "${l.name}".`+Do(o)))}return _}if(Zs(l)){let _;try{_=l.parseValue(i)}catch(v){v instanceof Ze?c(ji(f),i,v):c(ji(f),i,new Ze(`Expected type "${l.name}". `+v.message,{originalError:v}));return}return _===void 0&&c(ji(f),i,new Ze(`Expected type "${l.name}".`)),_}En(!1,"Unexpected input type: "+Ke(l))}function qs(i,l,c){if(i){if(i.kind===fe.VARIABLE){const f=i.name.value;if(c==null||c[f]===void 0)return;const _=c[f];return _===null&&tr(l)?void 0:_}if(tr(l))return i.kind===fe.NULL?void 0:qs(i,l.ofType,c);if(i.kind===fe.NULL)return null;if(Wr(l)){const f=l.ofType;if(i.kind===fe.LIST){const v=[];for(const w of i.values)if(f_(w,c)){if(tr(f))return;v.push(null)}else{const o=qs(w,f,c);if(o===void 0)return;v.push(o)}return v}const _=qs(i,f,c);return _===void 0?void 0:[_]}if(Xr(l)){if(i.kind!==fe.OBJECT)return;const f=Object.create(null),_=Co(i.fields,v=>v.name.value);for(const v of Object.values(l.getFields())){const w=_[v.name];if(!w||f_(w.value,c)){if(v.defaultValue!==void 0)f[v.name]=v.defaultValue;else if(tr(v.type))return;continue}const o=qs(w.value,v.type,c);if(o===void 0)return;f[v.name]=o}return f}if(Zs(l)){let f;try{f=l.parseLiteral(i,c)}catch{return}return f===void 0?void 0:f}En(!1,"Unexpected input type: "+Ke(l))}}function f_(i,l){return i.kind===fe.VARIABLE&&(l==null||l[i.name.value]===void 0)}function Yv(i,l,c,f){const _=[],v=f==null?void 0:f.maxErrors;try{const w=AE(i,l,c,o=>{if(v!=null&&_.length>=v)throw new Ze("Too many errors processing variables, error limit reached. Execution aborted.");_.push(o)});if(_.length===0)return{coerced:w}}catch(w){_.push(w)}return{errors:_}}function AE(i,l,c,f){const _={};for(const v of l){const w=v.variable.name.value,o=Oi(i,v.type);if(!Mi(o)){const A=Hr(v.type);f(new Ze(`Variable "$${w}" expected value of type "${A}" which cannot be used as an input type.`,{nodes:v.type}));continue}if(!Jv(c,w)){if(v.defaultValue)_[w]=qs(v.defaultValue,o);else if(tr(o)){const A=Ke(o);f(new Ze(`Variable "$${w}" of required type "${A}" was not provided.`,{nodes:v}))}continue}const I=c[w];if(I===null&&tr(o)){const A=Ke(o);f(new Ze(`Variable "$${w}" of non-null type "${A}" must not be null.`,{nodes:v}));continue}_[w]=Xv(I,o,(A,L,R)=>{let P=`Variable "$${w}" got invalid value `+Ke(L);A.length>0&&(P+=` at "${w}${Wv(A)}"`),f(new Ze(P+"; "+R.message,{nodes:v,originalError:R.originalError}))})}return _}function ip(i,l,c){var f;const _={},v=(f=l.arguments)!==null&&f!==void 0?f:[],w=Co(v,o=>o.name.value);for(const o of i.args){const I=o.name,A=o.type,L=w[I];if(!L){if(o.defaultValue!==void 0)_[I]=o.defaultValue;else if(tr(A))throw new Ze(`Argument "${I}" of required type "${Ke(A)}" was not provided.`,{nodes:l});continue}const R=L.value;let P=R.kind===fe.NULL;if(R.kind===fe.VARIABLE){const ie=R.name.value;if(c==null||!Jv(c,ie)){if(o.defaultValue!==void 0)_[I]=o.defaultValue;else if(tr(A))throw new Ze(`Argument "${I}" of required type "${Ke(A)}" was provided the variable "$${ie}" which was not provided a runtime value.`,{nodes:R});continue}P=c[ie]==null}if(P&&tr(A))throw new Ze(`Argument "${I}" of non-null type "${Ke(A)}" must not be null.`,{nodes:R});const q=qs(R,A,c);if(q===void 0)throw new Ze(`Argument "${I}" has invalid value ${Hr(R)}.`,{nodes:R});_[I]=q}return _}function wu(i,l,c){var f;const _=(f=l.directives)===null||f===void 0?void 0:f.find(v=>v.name.value===i.name);if(_)return ip(i,_,c)}function Jv(i,l){return Object.prototype.hasOwnProperty.call(i,l)}function Xf(i,l,c,f,_){const v=new Map;return Fh(i,l,c,f,_,v,new Set),v}function DE(i,l,c,f,_){const v=new Map,w=new Set;for(const o of _)o.selectionSet&&Fh(i,l,c,f,o.selectionSet,v,w);return v}function Fh(i,l,c,f,_,v,w){for(const o of _.selections)switch(o.kind){case fe.FIELD:{if(!Zd(c,o))continue;const I=CE(o),A=v.get(I);A!==void 0?A.push(o):v.set(I,[o]);break}case fe.INLINE_FRAGMENT:{if(!Zd(c,o)||!m_(i,o,f))continue;Fh(i,l,c,f,o.selectionSet,v,w);break}case fe.FRAGMENT_SPREAD:{const I=o.name.value;if(w.has(I)||!Zd(c,o))continue;w.add(I);const A=l[I];if(!A||!m_(i,A,f))continue;Fh(i,l,c,f,A.selectionSet,v,w);break}}}function Zd(i,l){const c=wu(Af,l,i);if((c==null?void 0:c.if)===!0)return!1;const f=wu(If,l,i);return(f==null?void 0:f.if)!==!1}function m_(i,l,c){const f=l.typeCondition;if(!f)return!0;const _=Oi(i,f);return _===c?!0:Gs(_)?i.isSubType(_,c):!1}function CE(i){return i.alias?i.alias.value:i.name.value}function Kv(i){return{OperationDefinition(l){if(l.operation==="subscription"){const c=i.getSchema(),f=c.getSubscriptionType();if(f){const _=l.name?l.name.value:null,v=Object.create(null),w=i.getDocument(),o=Object.create(null);for(const A of w.definitions)A.kind===fe.FRAGMENT_DEFINITION&&(o[A.name.value]=A);const I=Xf(c,o,v,f,l.selectionSet);if(I.size>1){const R=[...I.values()].slice(1).flat();i.reportError(new Ze(_!=null?`Subscription "${_}" must select only one top level field.`:"Anonymous Subscription must select only one top level field.",{nodes:R}))}for(const A of I.values())A[0].name.value.startsWith("__")&&i.reportError(new Ze(_!=null?`Subscription "${_}" must not select an introspection top level field.`:"Anonymous Subscription must not select an introspection top level field.",{nodes:A}))}}}}}function Yf(i,l){const c=new Map;for(const f of i){const _=l(f),v=c.get(_);v===void 0?c.set(_,[f]):v.push(f)}return c}function Qv(i){return{DirectiveDefinition(f){var _;const v=(_=f.arguments)!==null&&_!==void 0?_:[];return c(`@${f.name.value}`,v)},InterfaceTypeDefinition:l,InterfaceTypeExtension:l,ObjectTypeDefinition:l,ObjectTypeExtension:l};function l(f){var _;const v=f.name.value,w=(_=f.fields)!==null&&_!==void 0?_:[];for(const I of w){var o;const A=I.name.value,L=(o=I.arguments)!==null&&o!==void 0?o:[];c(`${v}.${A}`,L)}return!1}function c(f,_){const v=Yf(_,w=>w.name.value);for(const[w,o]of v)o.length>1&&i.reportError(new Ze(`Argument "${f}(${w}:)" can only be defined once.`,{nodes:o.map(I=>I.name)}));return!1}}function Jf(i){return{Field:l,Directive:l};function l(c){var f;const _=(f=c.arguments)!==null&&f!==void 0?f:[],v=Yf(_,w=>w.name.value);for(const[w,o]of v)o.length>1&&i.reportError(new Ze(`There can be only one argument named "${w}".`,{nodes:o.map(I=>I.name)}))}}function e0(i){const l=Object.create(null),c=i.getSchema();return{DirectiveDefinition(f){const _=f.name.value;if(c!=null&&c.getDirective(_)){i.reportError(new Ze(`Directive "@${_}" already exists in the schema. It cannot be redefined.`,{nodes:f.name}));return}return l[_]?i.reportError(new Ze(`There can be only one directive named "@${_}".`,{nodes:[l[_],f.name]})):l[_]=f.name,!1}}}function Kf(i){const l=Object.create(null),c=i.getSchema(),f=c?c.getDirectives():ma;for(const o of f)l[o.name]=!o.isRepeatable;const _=i.getDocument().definitions;for(const o of _)o.kind===fe.DIRECTIVE_DEFINITION&&(l[o.name.value]=!o.repeatable);const v=Object.create(null),w=Object.create(null);return{enter(o){if(!("directives"in o)||!o.directives)return;let I;if(o.kind===fe.SCHEMA_DEFINITION||o.kind===fe.SCHEMA_EXTENSION)I=v;else if(Xl(o)||rp(o)){const A=o.name.value;I=w[A],I===void 0&&(w[A]=I=Object.create(null))}else I=Object.create(null);for(const A of o.directives){const L=A.name.value;l[L]&&(I[L]?i.reportError(new Ze(`The directive "@${L}" can only be used once at this location.`,{nodes:[I[L],A]})):I[L]=A)}}}}function t0(i){const l=i.getSchema(),c=l?l.getTypeMap():Object.create(null),f=Object.create(null);return{EnumTypeDefinition:_,EnumTypeExtension:_};function _(v){var w;const o=v.name.value;f[o]||(f[o]=Object.create(null));const I=(w=v.values)!==null&&w!==void 0?w:[],A=f[o];for(const L of I){const R=L.name.value,P=c[o];In(P)&&P.getValue(R)?i.reportError(new Ze(`Enum value "${o}.${R}" already exists in the schema. It cannot also be defined in this type extension.`,{nodes:L.name})):A[R]?i.reportError(new Ze(`Enum value "${o}.${R}" can only be defined once.`,{nodes:[A[R],L.name]})):A[R]=L.name}return!1}}function r0(i){const l=i.getSchema(),c=l?l.getTypeMap():Object.create(null),f=Object.create(null);return{InputObjectTypeDefinition:_,InputObjectTypeExtension:_,InterfaceTypeDefinition:_,InterfaceTypeExtension:_,ObjectTypeDefinition:_,ObjectTypeExtension:_};function _(v){var w;const o=v.name.value;f[o]||(f[o]=Object.create(null));const I=(w=v.fields)!==null&&w!==void 0?w:[],A=f[o];for(const L of I){const R=L.name.value;PE(c[o],R)?i.reportError(new Ze(`Field "${o}.${R}" already exists in the schema. It cannot also be defined in this type extension.`,{nodes:L.name})):A[R]?i.reportError(new Ze(`Field "${o}.${R}" can only be defined once.`,{nodes:[A[R],L.name]})):A[R]=L.name}return!1}}function PE(i,l){return Er(i)||kr(i)||Xr(i)?i.getFields()[l]!=null:!1}function n0(i){const l=Object.create(null);return{OperationDefinition:()=>!1,FragmentDefinition(c){const f=c.name.value;return l[f]?i.reportError(new Ze(`There can be only one fragment named "${f}".`,{nodes:[l[f],c.name]})):l[f]=c.name,!1}}}function Qf(i){const l=[];let c=Object.create(null);return{ObjectValue:{enter(){l.push(c),c=Object.create(null)},leave(){const f=l.pop();f||En(!1),c=f}},ObjectField(f){const _=f.name.value;c[_]?i.reportError(new Ze(`There can be only one input field named "${_}".`,{nodes:[c[_],f.name]})):c[_]=f.name}}}function i0(i){const l=Object.create(null);return{OperationDefinition(c){const f=c.name;return f&&(l[f.value]?i.reportError(new Ze(`There can be only one operation named "${f.value}".`,{nodes:[l[f.value],f]})):l[f.value]=f),!1},FragmentDefinition:()=>!1}}function s0(i){const l=i.getSchema(),c=Object.create(null),f=l?{query:l.getQueryType(),mutation:l.getMutationType(),subscription:l.getSubscriptionType()}:{};return{SchemaDefinition:_,SchemaExtension:_};function _(v){var w;const o=(w=v.operationTypes)!==null&&w!==void 0?w:[];for(const I of o){const A=I.operation,L=c[A];f[A]?i.reportError(new Ze(`Type for ${A} already defined in the schema. It cannot be redefined.`,{nodes:I})):L?i.reportError(new Ze(`There can be only one ${A} type in schema.`,{nodes:[L,I]})):c[A]=I}return!1}}function o0(i){const l=Object.create(null),c=i.getSchema();return{ScalarTypeDefinition:f,ObjectTypeDefinition:f,InterfaceTypeDefinition:f,UnionTypeDefinition:f,EnumTypeDefinition:f,InputObjectTypeDefinition:f};function f(_){const v=_.name.value;if(c!=null&&c.getType(v)){i.reportError(new Ze(`Type "${v}" already exists in the schema. It cannot also be defined in this type definition.`,{nodes:_.name}));return}return l[v]?i.reportError(new Ze(`There can be only one type named "${v}".`,{nodes:[l[v],_.name]})):l[v]=_.name,!1}}function a0(i){return{OperationDefinition(l){var c;const f=(c=l.variableDefinitions)!==null&&c!==void 0?c:[],_=Yf(f,v=>v.variable.name.value);for(const[v,w]of _)w.length>1&&i.reportError(new Ze(`There can be only one variable named "$${v}".`,{nodes:w.map(o=>o.variable.name)}))}}}function l0(i){return{ListValue(l){const c=wf(i.getParentInputType());if(!Wr(c))return Wa(i,l),!1},ObjectValue(l){const c=Si(i.getInputType());if(!Xr(c))return Wa(i,l),!1;const f=Co(l.fields,_=>_.name.value);for(const _ of Object.values(c.getFields()))if(!f[_.name]&&Jh(_)){const w=Ke(_.type);i.reportError(new Ze(`Field "${c.name}.${_.name}" of required type "${w}" was not provided.`,{nodes:l}))}},ObjectField(l){const c=Si(i.getParentInputType());if(!i.getInputType()&&Xr(c)){const _=da(l.name.value,Object.keys(c.getFields()));i.reportError(new Ze(`Field "${l.name.value}" is not defined by type "${c.name}".`+Do(_),{nodes:l}))}},NullValue(l){const c=i.getInputType();tr(c)&&i.reportError(new Ze(`Expected value of type "${Ke(c)}", found ${Hr(l)}.`,{nodes:l}))},EnumValue:l=>Wa(i,l),IntValue:l=>Wa(i,l),FloatValue:l=>Wa(i,l),StringValue:l=>Wa(i,l),BooleanValue:l=>Wa(i,l)}}function Wa(i,l){const c=i.getInputType();if(!c)return;const f=Si(c);if(!Zs(f)){const _=Ke(c);i.reportError(new Ze(`Expected value of type "${_}", found ${Hr(l)}.`,{nodes:l}));return}try{if(f.parseLiteral(l,void 0)===void 0){const v=Ke(c);i.reportError(new Ze(`Expected value of type "${v}", found ${Hr(l)}.`,{nodes:l}))}}catch(_){const v=Ke(c);_ instanceof Ze?i.reportError(_):i.reportError(new Ze(`Expected value of type "${v}", found ${Hr(l)}; `+_.message,{nodes:l,originalError:_}))}}function c0(i){return{VariableDefinition(l){const c=Oi(i.getSchema(),l.type);if(c!==void 0&&!Mi(c)){const f=l.variable.name.value,_=Hr(l.type);i.reportError(new Ze(`Variable "$${f}" cannot be non-input type "${_}".`,{nodes:l.type}))}}}}function u0(i){let l=Object.create(null);return{OperationDefinition:{enter(){l=Object.create(null)},leave(c){const f=i.getRecursiveVariableUsages(c);for(const{node:_,type:v,defaultValue:w}of f){const o=_.name.value,I=l[o];if(I&&v){const A=i.getSchema(),L=Oi(A,I.type);if(L&&!kE(A,L,I.defaultValue,v,w)){const R=Ke(L),P=Ke(v);i.reportError(new Ze(`Variable "$${o}" of type "${R}" used in position expecting type "${P}".`,{nodes:[I,_]}))}}}}},VariableDefinition(c){l[c.variable.name.value]=c}}}function kE(i,l,c,f,_){if(tr(f)&&!tr(l)){if(!(c!=null&&c.kind!==fe.NULL)&&!(_!==void 0))return!1;const o=f.ofType;return Ja(i,l,o)}return Ja(i,l,f)}const h0=Object.freeze([Av,i0,Ov,Kv,Hf,Cv,c0,Hv,Dv,n0,Mv,Fv,jv,Nv,a0,Lv,zv,Zf,Kf,Pv,Jf,l0,Gv,u0,Uv,Qf]),ME=Object.freeze([Rv,s0,o0,t0,r0,Qv,e0,Hf,Zf,Kf,qv,kv,Jf,Qf,Zv]);class p0{constructor(l,c){this._ast=l,this._fragments=void 0,this._fragmentSpreads=new Map,this._recursivelyReferencedFragments=new Map,this._onError=c}get[Symbol.toStringTag](){return"ASTValidationContext"}reportError(l){this._onError(l)}getDocument(){return this._ast}getFragment(l){let c;if(this._fragments)c=this._fragments;else{c=Object.create(null);for(const f of this.getDocument().definitions)f.kind===fe.FRAGMENT_DEFINITION&&(c[f.name.value]=f);this._fragments=c}return c[l]}getFragmentSpreads(l){let c=this._fragmentSpreads.get(l);if(!c){c=[];const f=[l];let _;for(;_=f.pop();)for(const v of _.selections)v.kind===fe.FRAGMENT_SPREAD?c.push(v):v.selectionSet&&f.push(v.selectionSet);this._fragmentSpreads.set(l,c)}return c}getRecursivelyReferencedFragments(l){let c=this._recursivelyReferencedFragments.get(l);if(!c){c=[];const f=Object.create(null),_=[l.selectionSet];let v;for(;v=_.pop();)for(const w of this.getFragmentSpreads(v)){const o=w.name.value;if(f[o]!==!0){f[o]=!0;const I=this.getFragment(o);I&&(c.push(I),_.push(I.selectionSet))}}this._recursivelyReferencedFragments.set(l,c)}return c}}class OE extends p0{constructor(l,c,f){super(l,f),this._schema=c}get[Symbol.toStringTag](){return"SDLValidationContext"}getSchema(){return this._schema}}class d0 extends p0{constructor(l,c,f,_){super(c,_),this._schema=l,this._typeInfo=f,this._variableUsages=new Map,this._recursiveVariableUsages=new Map}get[Symbol.toStringTag](){return"ValidationContext"}getSchema(){return this._schema}getVariableUsages(l){let c=this._variableUsages.get(l);if(!c){const f=[],_=new $f(this._schema);Hl(l,Vf(_,{VariableDefinition:()=>!1,Variable(v){f.push({node:v,type:_.getInputType(),defaultValue:_.getDefaultValue()})}})),c=f,this._variableUsages.set(l,c)}return c}getRecursiveVariableUsages(l){let c=this._recursiveVariableUsages.get(l);if(!c){c=this.getVariableUsages(l);for(const f of this.getRecursivelyReferencedFragments(l))c=c.concat(this.getVariableUsages(f));this._recursiveVariableUsages.set(l,c)}return c}getType(){return this._typeInfo.getType()}getParentType(){return this._typeInfo.getParentType()}getInputType(){return this._typeInfo.getInputType()}getParentInputType(){return this._typeInfo.getParentInputType()}getFieldDef(){return this._typeInfo.getFieldDef()}getDirective(){return this._typeInfo.getDirective()}getArgument(){return this._typeInfo.getArgument()}getEnumValue(){return this._typeInfo.getEnumValue()}}function f0(i,l,c=h0,f,_=new $f(i)){var v;const w=(v=f==null?void 0:f.maxErrors)!==null&&v!==void 0?v:100;l||fr(!1,"Must provide document."),Bf(i);const o=Object.freeze({}),I=[],A=new d0(i,l,_,R=>{if(I.length>=w)throw I.push(new Ze("Too many validation errors, error limit reached. Validation aborted.")),o;I.push(R)}),L=xf(c.map(R=>R(A)));try{Hl(l,Vf(_,L))}catch(R){if(R!==o)throw R}return I}function m0(i,l,c=ME){const f=[],_=new OE(i,l,w=>{f.push(w)}),v=c.map(w=>w(_));return Hl(i,xf(v)),f}function RE(i){const l=m0(i);if(l.length!==0)throw new Error(l.map(c=>c.message).join(`

`))}function NE(i,l){const c=m0(i,l);if(c.length!==0)throw new Error(c.map(f=>f.message).join(`

`))}function LE(i){let l;return function(f,_,v){l===void 0&&(l=new WeakMap);let w=l.get(f);w===void 0&&(w=new WeakMap,l.set(f,w));let o=w.get(_);o===void 0&&(o=new WeakMap,w.set(_,o));let I=o.get(v);return I===void 0&&(I=i(f,_,v),o.set(v,I)),I}}function FE(i){return Promise.all(Object.values(i)).then(l=>{const c=Object.create(null);for(const[f,_]of Object.keys(i).entries())c[_]=l[f];return c})}function zE(i,l,c){let f=c;for(const _ of i)f=Gi(f)?f.then(v=>l(v,_)):l(f,_);return f}function BE(i){return i instanceof Error?i:new UE(i)}class UE extends Error{constructor(l){super("Unexpected error value: "+Ke(l)),this.name="NonErrorThrown",this.thrownValue=l}}function Gl(i,l,c){var f;const _=BE(i);return $E(_)?_:new Ze(_.message,{nodes:(f=_.nodes)!==null&&f!==void 0?f:l,source:_.source,positions:_.positions,path:c,originalError:_})}function $E(i){return Array.isArray(i.path)}const VE=LE((i,l,c)=>DE(i.schema,i.fragments,i.variableValues,l,c));function sp(i){arguments.length<2||fr(!1,"graphql@16 dropped long-deprecated support for positional arguments, please pass an object instead.");const{schema:l,document:c,variableValues:f,rootValue:_}=i;y0(l,c,f);const v=_0(i);if(!("schema"in v))return{errors:v};try{const{operation:w}=v,o=jE(v,w,_);return Gi(o)?o.then(I=>bh(I,v.errors),I=>(v.errors.push(I),bh(null,v.errors))):bh(o,v.errors)}catch(w){return v.errors.push(w),bh(null,v.errors)}}function g0(i){const l=sp(i);if(Gi(l))throw new Error("GraphQL execution failed to complete synchronously.");return l}function bh(i,l){return l.length===0?{data:i}:{errors:l,data:i}}function y0(i,l,c){l||fr(!1,"Must provide document."),Bf(i),c==null||Zi(c)||fr(!1,"Variables must be provided as an Object where each property is a variable value. Perhaps look to see if an unparsed JSON string was provided.")}function _0(i){var l,c;const{schema:f,document:_,rootValue:v,contextValue:w,variableValues:o,operationName:I,fieldResolver:A,typeResolver:L,subscribeFieldResolver:R}=i;let P;const q=Object.create(null);for(const V of _.definitions)switch(V.kind){case fe.OPERATION_DEFINITION:if(I==null){if(P!==void 0)return[new Ze("Must provide operation name if query contains multiple operations.")];P=V}else((l=V.name)===null||l===void 0?void 0:l.value)===I&&(P=V);break;case fe.FRAGMENT_DEFINITION:q[V.name.value]=V;break}if(!P)return I!=null?[new Ze(`Unknown operation named "${I}".`)]:[new Ze("Must provide an operation.")];const ie=(c=P.variableDefinitions)!==null&&c!==void 0?c:[],le=Yv(f,ie,o??{},{maxErrors:50});return le.errors?le.errors:{schema:f,fragments:q,rootValue:v,contextValue:w,operation:P,variableValues:le.coerced,fieldResolver:A??af,typeResolver:L??b0,subscribeFieldResolver:R??af,errors:[]}}function jE(i,l,c){const f=i.schema.getRootType(l.operation);if(f==null)throw new Ze(`Schema is not configured to execute ${l.operation} operation.`,{nodes:l});const _=Xf(i.schema,i.fragments,i.variableValues,f,l.selectionSet),v=void 0;switch(l.operation){case On.QUERY:return zh(i,f,c,v,_);case On.MUTATION:return qE(i,f,c,v,_);case On.SUBSCRIPTION:return zh(i,f,c,v,_)}}function qE(i,l,c,f,_){return zE(_.entries(),(v,[w,o])=>{const I=ql(f,w,l.name),A=v0(i,l,c,o,I);return A===void 0?v:Gi(A)?A.then(L=>(v[w]=L,v)):(v[w]=A,v)},Object.create(null))}function zh(i,l,c,f,_){const v=Object.create(null);let w=!1;for(const[o,I]of _.entries()){const A=ql(f,o,l.name),L=v0(i,l,c,I,A);L!==void 0&&(v[o]=L,Gi(L)&&(w=!0))}return w?FE(v):v}function v0(i,l,c,f,_){var v;const w=w0(i.schema,l,f[0]);if(!w)return;const o=w.type,I=(v=w.resolve)!==null&&v!==void 0?v:i.fieldResolver,A=x0(i,w,f,l,_);try{const L=ip(w,f[0],i.variableValues),R=i.contextValue,P=I(c,L,R,A);let q;return Gi(P)?q=P.then(ie=>Eu(i,o,f,A,_,ie)):q=Eu(i,o,f,A,_,P),Gi(q)?q.then(void 0,ie=>{const le=Gl(ie,f,ji(_));return Bh(le,o,i)}):q}catch(L){const R=Gl(L,f,ji(_));return Bh(R,o,i)}}function x0(i,l,c,f,_){return{fieldName:l.name,fieldNodes:c,returnType:l.type,parentType:f,path:_,schema:i.schema,fragments:i.fragments,rootValue:i.rootValue,operation:i.operation,variableValues:i.variableValues}}function Bh(i,l,c){if(tr(l))throw i;return c.errors.push(i),null}function Eu(i,l,c,f,_,v){if(v instanceof Error)throw v;if(tr(l)){const w=Eu(i,l.ofType,c,f,_,v);if(w===null)throw new Error(`Cannot return null for non-nullable field ${f.parentType.name}.${f.fieldName}.`);return w}if(v==null)return null;if(Wr(l))return GE(i,l,c,f,_,v);if(Zs(l))return ZE(l,v);if(Gs(l))return HE(i,l,c,f,_,v);if(Er(l))return of(i,l,c,f,_,v);En(!1,"Cannot complete value of unexpected output type: "+Ke(l))}function GE(i,l,c,f,_,v){if(!kf(v))throw new Ze(`Expected Iterable, but did not find one for field "${f.parentType.name}.${f.fieldName}".`);const w=l.ofType;let o=!1;const I=Array.from(v,(A,L)=>{const R=ql(_,L,void 0);try{let P;return Gi(A)?P=A.then(q=>Eu(i,w,c,f,R,q)):P=Eu(i,w,c,f,R,A),Gi(P)?(o=!0,P.then(void 0,q=>{const ie=Gl(q,c,ji(R));return Bh(ie,w,i)})):P}catch(P){const q=Gl(P,c,ji(R));return Bh(q,w,i)}});return o?Promise.all(I):I}function ZE(i,l){const c=i.serialize(l);if(c==null)throw new Error(`Expected \`${Ke(i)}.serialize(${Ke(l)})\` to return non-nullable value, returned: ${Ke(c)}`);return c}function HE(i,l,c,f,_,v){var w;const o=(w=l.resolveType)!==null&&w!==void 0?w:i.typeResolver,I=i.contextValue,A=o(v,I,f,l);return Gi(A)?A.then(L=>of(i,g_(L,i,l,c,f,v),c,f,_,v)):of(i,g_(A,i,l,c,f,v),c,f,_,v)}function g_(i,l,c,f,_,v){if(i==null)throw new Ze(`Abstract type "${c.name}" must resolve to an Object type at runtime for field "${_.parentType.name}.${_.fieldName}". Either the "${c.name}" type should provide a "resolveType" function or each possible type should provide an "isTypeOf" function.`,f);if(Er(i))throw new Ze("Support for returning GraphQLObjectType from resolveType was removed in graphql-js@16.0.0 please return type name instead.");if(typeof i!="string")throw new Ze(`Abstract type "${c.name}" must resolve to an Object type at runtime for field "${_.parentType.name}.${_.fieldName}" with value ${Ke(v)}, received "${Ke(i)}".`);const w=l.schema.getType(i);if(w==null)throw new Ze(`Abstract type "${c.name}" was resolved to a type "${i}" that does not exist inside the schema.`,{nodes:f});if(!Er(w))throw new Ze(`Abstract type "${c.name}" was resolved to a non-object type "${i}".`,{nodes:f});if(!l.schema.isSubType(c,w))throw new Ze(`Runtime Object type "${w.name}" is not a possible type for "${c.name}".`,{nodes:f});return w}function of(i,l,c,f,_,v){const w=VE(i,l,c);if(l.isTypeOf){const o=l.isTypeOf(v,i.contextValue,f);if(Gi(o))return o.then(I=>{if(!I)throw y_(l,v,c);return zh(i,l,v,_,w)});if(!o)throw y_(l,v,c)}return zh(i,l,v,_,w)}function y_(i,l,c){return new Ze(`Expected value of type "${i.name}" but got: ${Ke(l)}.`,{nodes:c})}const b0=function(i,l,c,f){if(Zi(i)&&typeof i.__typename=="string")return i.__typename;const _=c.schema.getPossibleTypes(f),v=[];for(let w=0;w<_.length;w++){const o=_[w];if(o.isTypeOf){const I=o.isTypeOf(i,l,c);if(Gi(I))v[w]=I;else if(I)return o.name}}if(v.length)return Promise.all(v).then(w=>{for(let o=0;o<w.length;o++)if(w[o])return _[o].name})},af=function(i,l,c,f){if(Zi(i)||typeof i=="function"){const _=i[f.fieldName];return typeof _=="function"?i[f.fieldName](l,c,f):_}};function w0(i,l,c){const f=c.name.value;return f===vu.name&&i.getQueryType()===l?vu:f===xu.name&&i.getQueryType()===l?xu:f===bu.name?bu:l.getFields()[f]}function WE(i){return new Promise(l=>l(E0(i)))}function XE(i){const l=E0(i);if(Gi(l))throw new Error("GraphQL execution failed to complete synchronously.");return l}function E0(i){arguments.length<2||fr(!1,"graphql@16 dropped long-deprecated support for positional arguments, please pass an object instead.");const{schema:l,source:c,rootValue:f,contextValue:_,variableValues:v,operationName:w,fieldResolver:o,typeResolver:I}=i,A=zf(l);if(A.length>0)return{errors:A};let L;try{L=Xh(c)}catch(P){return{errors:[P]}}const R=f0(l,L);return R.length>0?{errors:R}:sp({schema:l,document:L,rootValue:f,contextValue:_,variableValues:v,operationName:w,fieldResolver:o,typeResolver:I})}function T0(i){return typeof(i==null?void 0:i[Symbol.asyncIterator])=="function"}function YE(i,l){const c=i[Symbol.asyncIterator]();async function f(_){if(_.done)return _;try{return{value:await l(_.value),done:!1}}catch(v){if(typeof c.return=="function")try{await c.return()}catch{}throw v}}return{async next(){return f(await c.next())},async return(){return typeof c.return=="function"?f(await c.return()):{value:void 0,done:!0}},async throw(_){if(typeof c.throw=="function")return f(await c.throw(_));throw _},[Symbol.asyncIterator](){return this}}}async function JE(i){arguments.length<2||fr(!1,"graphql@16 dropped long-deprecated support for positional arguments, please pass an object instead.");const l=await S0(i);return T0(l)?YE(l,f=>sp({...i,rootValue:f})):l}function KE(i){const l=i[0];return l&&"document"in l?l:{schema:l,document:i[1],rootValue:i[2],contextValue:i[3],variableValues:i[4],operationName:i[5],subscribeFieldResolver:i[6]}}async function S0(...i){const l=KE(i),{schema:c,document:f,variableValues:_}=l;y0(c,f,_);const v=_0(l);if(!("schema"in v))return{errors:v};try{const w=await QE(v);if(!T0(w))throw new Error(`Subscription field must return Async Iterable. Received: ${Ke(w)}.`);return w}catch(w){if(w instanceof Ze)return{errors:[w]};throw w}}async function QE(i){const{schema:l,fragments:c,operation:f,variableValues:_,rootValue:v}=i,w=l.getSubscriptionType();if(w==null)throw new Ze("Schema is not configured to execute subscription operation.",{nodes:f});const o=Xf(l,c,_,w,f.selectionSet),[I,A]=[...o.entries()][0],L=w0(l,w,A[0]);if(!L){const ie=A[0].name.value;throw new Ze(`The subscription field "${ie}" is not defined.`,{nodes:A})}const R=ql(void 0,I,w.name),P=x0(i,L,A,w,R);try{var q;const ie=ip(L,A[0],_),le=i.contextValue,me=await((q=L.subscribe)!==null&&q!==void 0?q:i.subscribeFieldResolver)(v,ie,le,P);if(me instanceof Error)throw me;return me}catch(ie){throw Gl(ie,A,ji(R))}}function eT(i){return{Field(l){const c=i.getFieldDef(),f=c==null?void 0:c.deprecationReason;if(c&&f!=null){const _=i.getParentType();_!=null||En(!1),i.reportError(new Ze(`The field ${_.name}.${c.name} is deprecated. ${f}`,{nodes:l}))}},Argument(l){const c=i.getArgument(),f=c==null?void 0:c.deprecationReason;if(c&&f!=null){const _=i.getDirective();if(_!=null)i.reportError(new Ze(`Directive "@${_.name}" argument "${c.name}" is deprecated. ${f}`,{nodes:l}));else{const v=i.getParentType(),w=i.getFieldDef();v!=null&&w!=null||En(!1),i.reportError(new Ze(`Field "${v.name}.${w.name}" argument "${c.name}" is deprecated. ${f}`,{nodes:l}))}}},ObjectField(l){const c=Si(i.getParentInputType());if(Xr(c)){const f=c.getFields()[l.name.value],_=f==null?void 0:f.deprecationReason;_!=null&&i.reportError(new Ze(`The input field ${c.name}.${f.name} is deprecated. ${_}`,{nodes:l}))}},EnumValue(l){const c=i.getEnumValue(),f=c==null?void 0:c.deprecationReason;if(c&&f!=null){const _=Si(i.getInputType());_!=null||En(!1),i.reportError(new Ze(`The enum value "${_.name}.${c.name}" is deprecated. ${f}`,{nodes:l}))}}}}function tT(i){return{Field(l){const c=Si(i.getType());c&&el(c)&&i.reportError(new Ze(`GraphQL introspection has been disabled, but the requested query contained the field "${l.name.value}".`,{nodes:l}))}}}function I0(i){const l={descriptions:!0,specifiedByUrl:!1,directiveIsRepeatable:!1,schemaDescription:!1,inputValueDeprecation:!1,...i},c=l.descriptions?"description":"",f=l.specifiedByUrl?"specifiedByURL":"",_=l.directiveIsRepeatable?"isRepeatable":"",v=l.schemaDescription?c:"";function w(o){return l.inputValueDeprecation?o:""}return`
    query IntrospectionQuery {
      __schema {
        ${v}
        queryType { name }
        mutationType { name }
        subscriptionType { name }
        types {
          ...FullType
        }
        directives {
          name
          ${c}
          ${_}
          locations
          args${w("(includeDeprecated: true)")} {
            ...InputValue
          }
        }
      }
    }

    fragment FullType on __Type {
      kind
      name
      ${c}
      ${f}
      fields(includeDeprecated: true) {
        name
        ${c}
        args${w("(includeDeprecated: true)")} {
          ...InputValue
        }
        type {
          ...TypeRef
        }
        isDeprecated
        deprecationReason
      }
      inputFields${w("(includeDeprecated: true)")} {
        ...InputValue
      }
      interfaces {
        ...TypeRef
      }
      enumValues(includeDeprecated: true) {
        name
        ${c}
        isDeprecated
        deprecationReason
      }
      possibleTypes {
        ...TypeRef
      }
    }

    fragment InputValue on __InputValue {
      name
      ${c}
      type { ...TypeRef }
      defaultValue
      ${w("isDeprecated")}
      ${w("deprecationReason")}
    }

    fragment TypeRef on __Type {
      kind
      name
      ofType {
        kind
        name
        ofType {
          kind
          name
          ofType {
            kind
            name
            ofType {
              kind
              name
              ofType {
                kind
                name
                ofType {
                  kind
                  name
                  ofType {
                    kind
                    name
                  }
                }
              }
            }
          }
        }
      }
    }
  `}function rT(i,l){let c=null;for(const _ of i.definitions)if(_.kind===fe.OPERATION_DEFINITION){var f;if(l==null){if(c)return null;c=_}else if(((f=_.name)===null||f===void 0?void 0:f.value)===l)return _}return c}function nT(i,l){if(l.operation==="query"){const c=i.getQueryType();if(!c)throw new Ze("Schema does not define the required query root type.",{nodes:l});return c}if(l.operation==="mutation"){const c=i.getMutationType();if(!c)throw new Ze("Schema is not configured for mutations.",{nodes:l});return c}if(l.operation==="subscription"){const c=i.getSubscriptionType();if(!c)throw new Ze("Schema is not configured for subscriptions.",{nodes:l});return c}throw new Ze("Can only have query, mutation and subscription operations.",{nodes:l})}function iT(i,l){const c={specifiedByUrl:!0,directiveIsRepeatable:!0,schemaDescription:!0,inputValueDeprecation:!0,...l},f=Xh(I0(c)),_=g0({schema:i,document:f});return!_.errors&&_.data||En(!1),_.data}function sT(i,l){Zi(i)&&Zi(i.__schema)||fr(!1,`Invalid or incomplete introspection result. Ensure that you are passing "data" property of introspection response and no "errors" was returned alongside: ${Ke(i)}.`);const c=i.__schema,f=ca(c.types,Y=>Y.name,Y=>P(Y));for(const Y of[...Pu,...Ou])f[Y.name]&&(f[Y.name]=Y);const _=c.queryType?L(c.queryType):null,v=c.mutationType?L(c.mutationType):null,w=c.subscriptionType?L(c.subscriptionType):null,o=c.directives?c.directives.map(Me):[];return new Wl({description:c.description,query:_,mutation:v,subscription:w,types:Object.values(f),directives:o,assumeValid:l==null?void 0:l.assumeValid});function I(Y){if(Y.kind===$r.LIST){const xe=Y.ofType;if(!xe)throw new Error("Decorated type deeper than introspection query.");return new si(I(xe))}if(Y.kind===$r.NON_NULL){const xe=Y.ofType;if(!xe)throw new Error("Decorated type deeper than introspection query.");const Ge=I(xe);return new dr(yv(Ge))}return A(Y)}function A(Y){const xe=Y.name;if(!xe)throw new Error(`Unknown type reference: ${Ke(Y)}.`);const Ge=f[xe];if(!Ge)throw new Error(`Invalid or incomplete schema, unknown type: ${xe}. Ensure that a full introspection query is used in order to build a client schema.`);return Ge}function L(Y){return mv(A(Y))}function R(Y){return gv(A(Y))}function P(Y){if(Y!=null&&Y.name!=null&&Y.kind!=null)switch(Y.kind){case $r.SCALAR:return q(Y);case $r.OBJECT:return le(Y);case $r.INTERFACE:return V(Y);case $r.UNION:return me(Y);case $r.ENUM:return Oe(Y);case $r.INPUT_OBJECT:return Pe(Y)}const xe=Ke(Y);throw new Error(`Invalid or incomplete introspection result. Ensure that a full introspection query is used in order to build a client schema: ${xe}.`)}function q(Y){return new Ws({name:Y.name,description:Y.description,specifiedByURL:Y.specifiedByURL})}function ie(Y){if(Y.interfaces===null&&Y.kind===$r.INTERFACE)return[];if(!Y.interfaces){const xe=Ke(Y);throw new Error(`Introspection result missing interfaces: ${xe}.`)}return Y.interfaces.map(R)}function le(Y){return new us({name:Y.name,description:Y.description,interfaces:()=>ie(Y),fields:()=>ne(Y)})}function V(Y){return new $l({name:Y.name,description:Y.description,interfaces:()=>ie(Y),fields:()=>ne(Y)})}function me(Y){if(!Y.possibleTypes){const xe=Ke(Y);throw new Error(`Introspection result missing possibleTypes: ${xe}.`)}return new Vl({name:Y.name,description:Y.description,types:()=>Y.possibleTypes.map(L)})}function Oe(Y){if(!Y.enumValues){const xe=Ke(Y);throw new Error(`Introspection result missing enumValues: ${xe}.`)}return new pa({name:Y.name,description:Y.description,values:ca(Y.enumValues,xe=>xe.name,xe=>({description:xe.description,deprecationReason:xe.deprecationReason}))})}function Pe(Y){if(!Y.inputFields){const xe=Ke(Y);throw new Error(`Introspection result missing inputFields: ${xe}.`)}return new jl({name:Y.name,description:Y.description,fields:()=>ce(Y.inputFields)})}function ne(Y){if(!Y.fields)throw new Error(`Introspection result missing fields: ${Ke(Y)}.`);return ca(Y.fields,xe=>xe.name,de)}function de(Y){const xe=I(Y.type);if(!ha(xe)){const Ge=Ke(xe);throw new Error(`Introspection must provide output type for fields, but received: ${Ge}.`)}if(!Y.args){const Ge=Ke(Y);throw new Error(`Introspection result missing field args: ${Ge}.`)}return{description:Y.description,deprecationReason:Y.deprecationReason,type:xe,args:ce(Y.args)}}function ce(Y){return ca(Y,xe=>xe.name,Ae)}function Ae(Y){const xe=I(Y.type);if(!Mi(xe)){const Ye=Ke(xe);throw new Error(`Introspection must provide input type for arguments, but received: ${Ye}.`)}const Ge=Y.defaultValue!=null?qs(pv(Y.defaultValue),xe):void 0;return{description:Y.description,type:xe,defaultValue:Ge,deprecationReason:Y.deprecationReason}}function Me(Y){if(!Y.args){const xe=Ke(Y);throw new Error(`Introspection result missing directive args: ${xe}.`)}if(!Y.locations){const xe=Ke(Y);throw new Error(`Introspection result missing directive locations: ${xe}.`)}return new Xs({name:Y.name,description:Y.description,isRepeatable:Y.isRepeatable,locations:Y.locations.slice(),args:ce(Y.args)})}}function oT(i,l,c){Ff(i),l!=null&&l.kind===fe.DOCUMENT||fr(!1,"Must provide valid Document AST."),(c==null?void 0:c.assumeValid)!==!0&&(c==null?void 0:c.assumeValidSDL)!==!0&&NE(l,i);const f=i.toConfig(),_=A0(f,l,c);return f===_?i:new Wl(_)}function A0(i,l,c){var f,_,v,w;const o=[],I=Object.create(null),A=[];let L;const R=[];for(const Q of l.definitions)if(Q.kind===fe.SCHEMA_DEFINITION)L=Q;else if(Q.kind===fe.SCHEMA_EXTENSION)R.push(Q);else if(Xl(Q))o.push(Q);else if(rp(Q)){const we=Q.name.value,Ee=I[we];I[we]=Ee?Ee.concat([Q]):[Q]}else Q.kind===fe.DIRECTIVE_DEFINITION&&A.push(Q);if(Object.keys(I).length===0&&o.length===0&&A.length===0&&R.length===0&&L==null)return i;const P=Object.create(null);for(const Q of i.types)P[Q.name]=Oe(Q);for(const Q of o){var q;const we=Q.name.value;P[we]=(q=__[we])!==null&&q!==void 0?q:mt(Q)}const ie={query:i.query&&V(i.query),mutation:i.mutation&&V(i.mutation),subscription:i.subscription&&V(i.subscription),...L&&Ge([L]),...Ge(R)};return{description:(f=L)===null||f===void 0||(_=f.description)===null||_===void 0?void 0:_.value,...ie,types:Object.values(P),directives:[...i.directives.map(me),...A.map(wt)],extensions:Object.create(null),astNode:(v=L)!==null&&v!==void 0?v:i.astNode,extensionASTNodes:i.extensionASTNodes.concat(R),assumeValid:(w=c==null?void 0:c.assumeValid)!==null&&w!==void 0?w:!1};function le(Q){return Wr(Q)?new si(le(Q.ofType)):tr(Q)?new dr(le(Q.ofType)):V(Q)}function V(Q){return P[Q.name]}function me(Q){const we=Q.toConfig();return new Xs({...we,args:Ao(we.args,xe)})}function Oe(Q){if(el(Q)||Kh(Q))return Q;if(Wi(Q))return de(Q);if(Er(Q))return ce(Q);if(kr(Q))return Ae(Q);if(Rn(Q))return Me(Q);if(In(Q))return ne(Q);if(Xr(Q))return Pe(Q);En(!1,"Unexpected type: "+Ke(Q))}function Pe(Q){var we;const Ee=Q.toConfig(),je=(we=I[Ee.name])!==null&&we!==void 0?we:[];return new jl({...Ee,fields:()=>({...Ao(Ee.fields,St=>({...St,type:le(St.type)})),...ht(je)}),extensionASTNodes:Ee.extensionASTNodes.concat(je)})}function ne(Q){var we;const Ee=Q.toConfig(),je=(we=I[Q.name])!==null&&we!==void 0?we:[];return new pa({...Ee,values:{...Ee.values,...et(je)},extensionASTNodes:Ee.extensionASTNodes.concat(je)})}function de(Q){var we;const Ee=Q.toConfig(),je=(we=I[Ee.name])!==null&&we!==void 0?we:[];let St=Ee.specifiedByURL;for(const ot of je){var Mt;St=(Mt=v_(ot))!==null&&Mt!==void 0?Mt:St}return new Ws({...Ee,specifiedByURL:St,extensionASTNodes:Ee.extensionASTNodes.concat(je)})}function ce(Q){var we;const Ee=Q.toConfig(),je=(we=I[Ee.name])!==null&&we!==void 0?we:[];return new us({...Ee,interfaces:()=>[...Q.getInterfaces().map(V),...ft(je)],fields:()=>({...Ao(Ee.fields,Y),...Et(je)}),extensionASTNodes:Ee.extensionASTNodes.concat(je)})}function Ae(Q){var we;const Ee=Q.toConfig(),je=(we=I[Ee.name])!==null&&we!==void 0?we:[];return new $l({...Ee,interfaces:()=>[...Q.getInterfaces().map(V),...ft(je)],fields:()=>({...Ao(Ee.fields,Y),...Et(je)}),extensionASTNodes:Ee.extensionASTNodes.concat(je)})}function Me(Q){var we;const Ee=Q.toConfig(),je=(we=I[Ee.name])!==null&&we!==void 0?we:[];return new Vl({...Ee,types:()=>[...Q.getTypes().map(V),...Ut(je)],extensionASTNodes:Ee.extensionASTNodes.concat(je)})}function Y(Q){return{...Q,type:le(Q.type),args:Q.args&&Ao(Q.args,xe)}}function xe(Q){return{...Q,type:le(Q.type)}}function Ge(Q){const we={};for(const je of Q){var Ee;const St=(Ee=je.operationTypes)!==null&&Ee!==void 0?Ee:[];for(const Mt of St)we[Mt.operation]=Ye(Mt.type)}return we}function Ye(Q){var we;const Ee=Q.name.value,je=(we=__[Ee])!==null&&we!==void 0?we:P[Ee];if(je===void 0)throw new Error(`Unknown type: "${Ee}".`);return je}function ct(Q){return Q.kind===fe.LIST_TYPE?new si(ct(Q.type)):Q.kind===fe.NON_NULL_TYPE?new dr(ct(Q.type)):Ye(Q)}function wt(Q){var we;return new Xs({name:Q.name.value,description:(we=Q.description)===null||we===void 0?void 0:we.value,locations:Q.locations.map(({value:Ee})=>Ee),isRepeatable:Q.repeatable,args:Dt(Q.arguments),astNode:Q})}function Et(Q){const we=Object.create(null);for(const St of Q){var Ee;const Mt=(Ee=St.fields)!==null&&Ee!==void 0?Ee:[];for(const ot of Mt){var je;we[ot.name.value]={type:ct(ot.type),description:(je=ot.description)===null||je===void 0?void 0:je.value,args:Dt(ot.arguments),deprecationReason:wh(ot),astNode:ot}}}return we}function Dt(Q){const we=Q??[],Ee=Object.create(null);for(const St of we){var je;const Mt=ct(St.type);Ee[St.name.value]={type:Mt,description:(je=St.description)===null||je===void 0?void 0:je.value,defaultValue:qs(St.defaultValue,Mt),deprecationReason:wh(St),astNode:St}}return Ee}function ht(Q){const we=Object.create(null);for(const St of Q){var Ee;const Mt=(Ee=St.fields)!==null&&Ee!==void 0?Ee:[];for(const ot of Mt){var je;const It=ct(ot.type);we[ot.name.value]={type:It,description:(je=ot.description)===null||je===void 0?void 0:je.value,defaultValue:qs(ot.defaultValue,It),deprecationReason:wh(ot),astNode:ot}}}return we}function et(Q){const we=Object.create(null);for(const St of Q){var Ee;const Mt=(Ee=St.values)!==null&&Ee!==void 0?Ee:[];for(const ot of Mt){var je;we[ot.name.value]={description:(je=ot.description)===null||je===void 0?void 0:je.value,deprecationReason:wh(ot),astNode:ot}}}return we}function ft(Q){return Q.flatMap(we=>{var Ee,je;return(Ee=(je=we.interfaces)===null||je===void 0?void 0:je.map(Ye))!==null&&Ee!==void 0?Ee:[]})}function Ut(Q){return Q.flatMap(we=>{var Ee,je;return(Ee=(je=we.types)===null||je===void 0?void 0:je.map(Ye))!==null&&Ee!==void 0?Ee:[]})}function mt(Q){var we;const Ee=Q.name.value,je=(we=I[Ee])!==null&&we!==void 0?we:[];switch(Q.kind){case fe.OBJECT_TYPE_DEFINITION:{var St;const Yt=[Q,...je];return new us({name:Ee,description:(St=Q.description)===null||St===void 0?void 0:St.value,interfaces:()=>ft(Yt),fields:()=>Et(Yt),astNode:Q,extensionASTNodes:je})}case fe.INTERFACE_TYPE_DEFINITION:{var Mt;const Yt=[Q,...je];return new $l({name:Ee,description:(Mt=Q.description)===null||Mt===void 0?void 0:Mt.value,interfaces:()=>ft(Yt),fields:()=>Et(Yt),astNode:Q,extensionASTNodes:je})}case fe.ENUM_TYPE_DEFINITION:{var ot;const Yt=[Q,...je];return new pa({name:Ee,description:(ot=Q.description)===null||ot===void 0?void 0:ot.value,values:et(Yt),astNode:Q,extensionASTNodes:je})}case fe.UNION_TYPE_DEFINITION:{var It;const Yt=[Q,...je];return new Vl({name:Ee,description:(It=Q.description)===null||It===void 0?void 0:It.value,types:()=>Ut(Yt),astNode:Q,extensionASTNodes:je})}case fe.SCALAR_TYPE_DEFINITION:{var jt;return new Ws({name:Ee,description:(jt=Q.description)===null||jt===void 0?void 0:jt.value,specifiedByURL:v_(Q),astNode:Q,extensionASTNodes:je})}case fe.INPUT_OBJECT_TYPE_DEFINITION:{var Qt;const Yt=[Q,...je];return new jl({name:Ee,description:(Qt=Q.description)===null||Qt===void 0?void 0:Qt.value,fields:()=>ht(Yt),astNode:Q,extensionASTNodes:je})}}}}const __=Co([...Pu,...Ou],i=>i.name);function wh(i){const l=wu(ep,i);return l==null?void 0:l.reason}function v_(i){const l=wu(Cf,i);return l==null?void 0:l.url}function D0(i,l){i!=null&&i.kind===fe.DOCUMENT||fr(!1,"Must provide valid Document AST."),(l==null?void 0:l.assumeValid)!==!0&&(l==null?void 0:l.assumeValidSDL)!==!0&&RE(i);const f=A0({description:void 0,types:[],directives:[],extensions:Object.create(null),extensionASTNodes:[],assumeValid:!1},i,l);if(f.astNode==null)for(const v of f.types)switch(v.name){case"Query":f.query=v;break;case"Mutation":f.mutation=v;break;case"Subscription":f.subscription=v;break}const _=[...f.directives,...ma.filter(v=>f.directives.every(w=>w.name!==v.name))];return new Wl({...f,directives:_})}function aT(i,l){const c=Xh(i,{noLocation:l==null?void 0:l.noLocation,allowLegacyFragmentVariables:l==null?void 0:l.allowLegacyFragmentVariables});return D0(c,{assumeValidSDL:l==null?void 0:l.assumeValidSDL,assumeValid:l==null?void 0:l.assumeValid})}function lT(i){const l=i.toConfig(),c=ca(Hd(l.types),P=>P.name,R);return new Wl({...l,types:Object.values(c),directives:Hd(l.directives).map(w),query:v(l.query),mutation:v(l.mutation),subscription:v(l.subscription)});function f(P){return Wr(P)?new si(f(P.ofType)):tr(P)?new dr(f(P.ofType)):_(P)}function _(P){return c[P.name]}function v(P){return P&&_(P)}function w(P){const q=P.toConfig();return new Xs({...q,locations:C0(q.locations,ie=>ie),args:o(q.args)})}function o(P){return Eh(P,q=>({...q,type:f(q.type)}))}function I(P){return Eh(P,q=>({...q,type:f(q.type),args:q.args&&o(q.args)}))}function A(P){return Eh(P,q=>({...q,type:f(q.type)}))}function L(P){return Hd(P).map(_)}function R(P){if(Wi(P)||el(P))return P;if(Er(P)){const q=P.toConfig();return new us({...q,interfaces:()=>L(q.interfaces),fields:()=>I(q.fields)})}if(kr(P)){const q=P.toConfig();return new $l({...q,interfaces:()=>L(q.interfaces),fields:()=>I(q.fields)})}if(Rn(P)){const q=P.toConfig();return new Vl({...q,types:()=>L(q.types)})}if(In(P)){const q=P.toConfig();return new pa({...q,values:Eh(q.values,ie=>ie)})}if(Xr(P)){const q=P.toConfig();return new jl({...q,fields:()=>A(q.fields)})}En(!1,"Unexpected type: "+Ke(P))}}function Eh(i,l){const c=Object.create(null);for(const f of Object.keys(i).sort(Iu))c[f]=l(i[f]);return c}function Hd(i){return C0(i,l=>l.name)}function C0(i,l){return i.slice().sort((c,f)=>{const _=l(c),v=l(f);return Iu(_,v)})}function cT(i){return P0(i,l=>!Pf(l),hT)}function uT(i){return P0(i,Pf,el)}function hT(i){return!Kh(i)&&!el(i)}function P0(i,l,c){const f=i.getDirectives().filter(l),_=Object.values(i.getTypeMap()).filter(c);return[pT(i),...f.map(v=>xT(v)),..._.map(v=>k0(v))].filter(Boolean).join(`

`)}function pT(i){if(i.description==null&&dT(i))return;const l=[],c=i.getQueryType();c&&l.push(`  query: ${c.name}`);const f=i.getMutationType();f&&l.push(`  mutation: ${f.name}`);const _=i.getSubscriptionType();return _&&l.push(`  subscription: ${_.name}`),hs(i)+`schema {
${l.join(`
`)}
}`}function dT(i){const l=i.getQueryType();if(l&&l.name!=="Query")return!1;const c=i.getMutationType();if(c&&c.name!=="Mutation")return!1;const f=i.getSubscriptionType();return!(f&&f.name!=="Subscription")}function k0(i){if(Wi(i))return fT(i);if(Er(i))return mT(i);if(kr(i))return gT(i);if(Rn(i))return yT(i);if(In(i))return _T(i);if(Xr(i))return vT(i);En(!1,"Unexpected type: "+Ke(i))}function fT(i){return hs(i)+`scalar ${i.name}`+bT(i)}function M0(i){const l=i.getInterfaces();return l.length?" implements "+l.map(c=>c.name).join(" & "):""}function mT(i){return hs(i)+`type ${i.name}`+M0(i)+O0(i)}function gT(i){return hs(i)+`interface ${i.name}`+M0(i)+O0(i)}function yT(i){const l=i.getTypes(),c=l.length?" = "+l.join(" | "):"";return hs(i)+"union "+i.name+c}function _T(i){const l=i.getValues().map((c,f)=>hs(c,"  ",!f)+"  "+c.name+tm(c.deprecationReason));return hs(i)+`enum ${i.name}`+em(l)}function vT(i){const l=Object.values(i.getFields()).map((c,f)=>hs(c,"  ",!f)+"  "+lf(c));return hs(i)+`input ${i.name}`+em(l)}function O0(i){const l=Object.values(i.getFields()).map((c,f)=>hs(c,"  ",!f)+"  "+c.name+R0(c.args,"  ")+": "+String(c.type)+tm(c.deprecationReason));return em(l)}function em(i){return i.length!==0?` {
`+i.join(`
`)+`
}`:""}function R0(i,l=""){return i.length===0?"":i.every(c=>!c.description)?"("+i.map(lf).join(", ")+")":`(
`+i.map((c,f)=>hs(c,"  "+l,!f)+"  "+l+lf(c)).join(`
`)+`
`+l+")"}function lf(i){const l=ua(i.defaultValue,i.type);let c=i.name+": "+String(i.type);return l&&(c+=` = ${Hr(l)}`),c+tm(i.deprecationReason)}function xT(i){return hs(i)+"directive @"+i.name+R0(i.args)+(i.isRepeatable?" repeatable":"")+" on "+i.locations.join(" | ")}function tm(i){return i==null?"":i!==Df?` @deprecated(reason: ${Hr({kind:fe.STRING,value:i})})`:" @deprecated"}function bT(i){return i.specifiedByURL==null?"":` @specifiedBy(url: ${Hr({kind:fe.STRING,value:i.specifiedByURL})})`}function hs(i,l="",c=!0){const{description:f}=i;if(f==null)return"";const _=Hr({kind:fe.STRING,value:f,block:i1(f)});return(l&&!c?`
`+l:l)+_.replace(/\n/g,`
`+l)+`
`}function wT(i){const l=[];for(const c of i)l.push(...c.definitions);return{kind:fe.DOCUMENT,definitions:l}}function ET(i){const l=[],c=Object.create(null);for(const _ of i.definitions)switch(_.kind){case fe.OPERATION_DEFINITION:l.push(_);break;case fe.FRAGMENT_DEFINITION:c[_.name.value]=x_(_.selectionSet);break}const f=Object.create(null);for(const _ of l){const v=new Set;for(const o of x_(_.selectionSet))N0(v,c,o);const w=_.name?_.name.value:"";f[w]={kind:fe.DOCUMENT,definitions:i.definitions.filter(o=>o===_||o.kind===fe.FRAGMENT_DEFINITION&&v.has(o.name.value))}}return f}function N0(i,l,c){if(!i.has(c)){i.add(c);const f=l[c];if(f!==void 0)for(const _ of f)N0(i,l,_)}}function x_(i){const l=[];return Hl(i,{FragmentSpread(c){l.push(c.name.value)}}),l}function TT(i){const l=hv(i)?i:new Wh(i),c=l.body,f=new vf(l);let _="",v=!1;for(;f.advance().kind!==Je.EOF;){const w=f.token,o=w.kind,I=!av(w.kind);v&&(I||w.kind===Je.SPREAD)&&(_+=" ");const A=c.slice(w.start,w.end);o===Je.BLOCK_STRING?_+=ov(w.value,{minimize:!0}):_+=A,v=I}return _}function ST(i){const l=L0(i);if(l)throw l;return i}function L0(i){if(typeof i=="string"||fr(!1,"Expected name to be a string."),i.startsWith("__"))return new Ze(`Name "${i}" must not begin with "__", which is reserved by GraphQL introspection.`);try{Hi(i)}catch(l){return l}}var cn;(function(i){i.TYPE_REMOVED="TYPE_REMOVED",i.TYPE_CHANGED_KIND="TYPE_CHANGED_KIND",i.TYPE_REMOVED_FROM_UNION="TYPE_REMOVED_FROM_UNION",i.VALUE_REMOVED_FROM_ENUM="VALUE_REMOVED_FROM_ENUM",i.REQUIRED_INPUT_FIELD_ADDED="REQUIRED_INPUT_FIELD_ADDED",i.IMPLEMENTED_INTERFACE_REMOVED="IMPLEMENTED_INTERFACE_REMOVED",i.FIELD_REMOVED="FIELD_REMOVED",i.FIELD_CHANGED_KIND="FIELD_CHANGED_KIND",i.REQUIRED_ARG_ADDED="REQUIRED_ARG_ADDED",i.ARG_REMOVED="ARG_REMOVED",i.ARG_CHANGED_KIND="ARG_CHANGED_KIND",i.DIRECTIVE_REMOVED="DIRECTIVE_REMOVED",i.DIRECTIVE_ARG_REMOVED="DIRECTIVE_ARG_REMOVED",i.REQUIRED_DIRECTIVE_ARG_ADDED="REQUIRED_DIRECTIVE_ARG_ADDED",i.DIRECTIVE_REPEATABLE_REMOVED="DIRECTIVE_REPEATABLE_REMOVED",i.DIRECTIVE_LOCATION_REMOVED="DIRECTIVE_LOCATION_REMOVED"})(cn||(cn={}));var Ms;(function(i){i.VALUE_ADDED_TO_ENUM="VALUE_ADDED_TO_ENUM",i.TYPE_ADDED_TO_UNION="TYPE_ADDED_TO_UNION",i.OPTIONAL_INPUT_FIELD_ADDED="OPTIONAL_INPUT_FIELD_ADDED",i.OPTIONAL_ARG_ADDED="OPTIONAL_ARG_ADDED",i.IMPLEMENTED_INTERFACE_ADDED="IMPLEMENTED_INTERFACE_ADDED",i.ARG_DEFAULT_VALUE_CHANGE="ARG_DEFAULT_VALUE_CHANGE"})(Ms||(Ms={}));function IT(i,l){return F0(i,l).filter(c=>c.type in cn)}function AT(i,l){return F0(i,l).filter(c=>c.type in Ms)}function F0(i,l){return[...CT(i,l),...DT(i,l)]}function DT(i,l){const c=[],f=Po(i.getDirectives(),l.getDirectives());for(const _ of f.removed)c.push({type:cn.DIRECTIVE_REMOVED,description:`${_.name} was removed.`});for(const[_,v]of f.persisted){const w=Po(_.args,v.args);for(const o of w.added)fa(o)&&c.push({type:cn.REQUIRED_DIRECTIVE_ARG_ADDED,description:`A required arg ${o.name} on directive ${_.name} was added.`});for(const o of w.removed)c.push({type:cn.DIRECTIVE_ARG_REMOVED,description:`${o.name} was removed from ${_.name}.`});_.isRepeatable&&!v.isRepeatable&&c.push({type:cn.DIRECTIVE_REPEATABLE_REMOVED,description:`Repeatable flag was removed from ${_.name}.`});for(const o of _.locations)v.locations.includes(o)||c.push({type:cn.DIRECTIVE_LOCATION_REMOVED,description:`${o} was removed from ${_.name}.`})}return c}function CT(i,l){const c=[],f=Po(Object.values(i.getTypeMap()),Object.values(l.getTypeMap()));for(const _ of f.removed)c.push({type:cn.TYPE_REMOVED,description:Kh(_)?`Standard scalar ${_.name} was removed because it is not referenced anymore.`:`${_.name} was removed.`});for(const[_,v]of f.persisted)In(_)&&In(v)?c.push(...MT(_,v)):Rn(_)&&Rn(v)?c.push(...kT(_,v)):Xr(_)&&Xr(v)?c.push(...PT(_,v)):Er(_)&&Er(v)?c.push(...w_(_,v),...b_(_,v)):kr(_)&&kr(v)?c.push(...w_(_,v),...b_(_,v)):_.constructor!==v.constructor&&c.push({type:cn.TYPE_CHANGED_KIND,description:`${_.name} changed from ${E_(_)} to ${E_(v)}.`});return c}function PT(i,l){const c=[],f=Po(Object.values(i.getFields()),Object.values(l.getFields()));for(const _ of f.added)Jh(_)?c.push({type:cn.REQUIRED_INPUT_FIELD_ADDED,description:`A required field ${_.name} on input type ${i.name} was added.`}):c.push({type:Ms.OPTIONAL_INPUT_FIELD_ADDED,description:`An optional field ${_.name} on input type ${i.name} was added.`});for(const _ of f.removed)c.push({type:cn.FIELD_REMOVED,description:`${i.name}.${_.name} was removed.`});for(const[_,v]of f.persisted)gu(_.type,v.type)||c.push({type:cn.FIELD_CHANGED_KIND,description:`${i.name}.${_.name} changed type from ${String(_.type)} to ${String(v.type)}.`});return c}function kT(i,l){const c=[],f=Po(i.getTypes(),l.getTypes());for(const _ of f.added)c.push({type:Ms.TYPE_ADDED_TO_UNION,description:`${_.name} was added to union type ${i.name}.`});for(const _ of f.removed)c.push({type:cn.TYPE_REMOVED_FROM_UNION,description:`${_.name} was removed from union type ${i.name}.`});return c}function MT(i,l){const c=[],f=Po(i.getValues(),l.getValues());for(const _ of f.added)c.push({type:Ms.VALUE_ADDED_TO_ENUM,description:`${_.name} was added to enum type ${i.name}.`});for(const _ of f.removed)c.push({type:cn.VALUE_REMOVED_FROM_ENUM,description:`${_.name} was removed from enum type ${i.name}.`});return c}function b_(i,l){const c=[],f=Po(i.getInterfaces(),l.getInterfaces());for(const _ of f.added)c.push({type:Ms.IMPLEMENTED_INTERFACE_ADDED,description:`${_.name} added to interfaces implemented by ${i.name}.`});for(const _ of f.removed)c.push({type:cn.IMPLEMENTED_INTERFACE_REMOVED,description:`${i.name} no longer implements interface ${_.name}.`});return c}function w_(i,l){const c=[],f=Po(Object.values(i.getFields()),Object.values(l.getFields()));for(const _ of f.removed)c.push({type:cn.FIELD_REMOVED,description:`${i.name}.${_.name} was removed.`});for(const[_,v]of f.persisted)c.push(...OT(i,_,v)),hu(_.type,v.type)||c.push({type:cn.FIELD_CHANGED_KIND,description:`${i.name}.${_.name} changed type from ${String(_.type)} to ${String(v.type)}.`});return c}function OT(i,l,c){const f=[],_=Po(l.args,c.args);for(const v of _.removed)f.push({type:cn.ARG_REMOVED,description:`${i.name}.${l.name} arg ${v.name} was removed.`});for(const[v,w]of _.persisted)if(!gu(v.type,w.type))f.push({type:cn.ARG_CHANGED_KIND,description:`${i.name}.${l.name} arg ${v.name} has changed type from ${String(v.type)} to ${String(w.type)}.`});else if(v.defaultValue!==void 0)if(w.defaultValue===void 0)f.push({type:Ms.ARG_DEFAULT_VALUE_CHANGE,description:`${i.name}.${l.name} arg ${v.name} defaultValue was removed.`});else{const I=T_(v.defaultValue,v.type),A=T_(w.defaultValue,w.type);I!==A&&f.push({type:Ms.ARG_DEFAULT_VALUE_CHANGE,description:`${i.name}.${l.name} arg ${v.name} has changed defaultValue from ${I} to ${A}.`})}for(const v of _.added)fa(v)?f.push({type:cn.REQUIRED_ARG_ADDED,description:`A required arg ${v.name} on ${i.name}.${l.name} was added.`}):f.push({type:Ms.OPTIONAL_ARG_ADDED,description:`An optional arg ${v.name} on ${i.name}.${l.name} was added.`});return f}function hu(i,l){return Wr(i)?Wr(l)&&hu(i.ofType,l.ofType)||tr(l)&&hu(i,l.ofType):tr(i)?tr(l)&&hu(i.ofType,l.ofType):Cu(l)&&i.name===l.name||tr(l)&&hu(i,l.ofType)}function gu(i,l){return Wr(i)?Wr(l)&&gu(i.ofType,l.ofType):tr(i)?tr(l)&&gu(i.ofType,l.ofType)||!tr(l)&&gu(i.ofType,l):Cu(l)&&i.name===l.name}function E_(i){if(Wi(i))return"a Scalar type";if(Er(i))return"an Object type";if(kr(i))return"an Interface type";if(Rn(i))return"a Union type";if(In(i))return"an Enum type";if(Xr(i))return"an Input type";En(!1,"Unexpected type: "+Ke(i))}function T_(i,l){const c=ua(i,l);return c!=null||En(!1),Hr(np(c))}function Po(i,l){const c=[],f=[],_=[],v=Co(i,({name:o})=>o),w=Co(l,({name:o})=>o);for(const o of i){const I=w[o.name];I===void 0?f.push(o):_.push([o,I])}for(const o of l)v[o.name]===void 0&&c.push(o);return{added:c,persisted:_,removed:f}}const RT=Object.freeze(Object.defineProperty({__proto__:null,BREAK:Fl,get BreakingChangeType(){return cn},DEFAULT_DEPRECATION_REASON:Df,get DangerousChangeType(){return Ms},get DirectiveLocation(){return Wt},ExecutableDefinitionsRule:Av,FieldsOnCorrectTypeRule:Dv,FragmentsOnCompositeTypesRule:Cv,GRAPHQL_MAX_INT:Ih,GRAPHQL_MIN_INT:Ah,GraphQLBoolean:qi,GraphQLDeprecatedDirective:ep,GraphQLDirective:Xs,GraphQLEnumType:pa,GraphQLError:Ze,GraphQLFloat:Tv,GraphQLID:Sf,GraphQLIncludeDirective:If,GraphQLInputObjectType:jl,GraphQLInt:Ev,GraphQLInterfaceType:$l,GraphQLList:si,GraphQLNonNull:dr,GraphQLObjectType:us,GraphQLScalarType:Ws,GraphQLSchema:Wl,GraphQLSkipDirective:Af,GraphQLSpecifiedByDirective:Cf,GraphQLString:un,GraphQLUnionType:Vl,get Kind(){return fe},KnownArgumentNamesRule:Pv,KnownDirectivesRule:Zf,KnownFragmentNamesRule:Mv,KnownTypeNamesRule:Hf,Lexer:vf,Location:rv,LoneAnonymousOperationRule:Ov,LoneSchemaDefinitionRule:Rv,NoDeprecatedCustomRule:eT,NoFragmentCyclesRule:Nv,NoSchemaIntrospectionCustomRule:tT,NoUndefinedVariablesRule:Lv,NoUnusedFragmentsRule:Fv,NoUnusedVariablesRule:zv,get OperationTypeNode(){return On},OverlappingFieldsCanBeMergedRule:Uv,PossibleFragmentSpreadsRule:jv,PossibleTypeExtensionsRule:qv,ProvidedRequiredArgumentsRule:Gv,ScalarLeafsRule:Hv,SchemaMetaFieldDef:vu,SingleFieldSubscriptionsRule:Kv,Source:Wh,Token:yf,get TokenKind(){return Je},TypeInfo:$f,get TypeKind(){return $r},TypeMetaFieldDef:xu,TypeNameMetaFieldDef:bu,UniqueArgumentDefinitionNamesRule:Qv,UniqueArgumentNamesRule:Jf,UniqueDirectiveNamesRule:e0,UniqueDirectivesPerLocationRule:Kf,UniqueEnumValueNamesRule:t0,UniqueFieldDefinitionNamesRule:r0,UniqueFragmentNamesRule:n0,UniqueInputFieldNamesRule:Qf,UniqueOperationNamesRule:i0,UniqueOperationTypesRule:s0,UniqueTypeNamesRule:o0,UniqueVariableNamesRule:a0,ValidationContext:d0,ValuesOfCorrectTypeRule:l0,VariablesAreInputTypesRule:c0,VariablesInAllowedPositionRule:u0,__Directive:Mf,__DirectiveLocation:Of,__EnumValue:Nf,__Field:Rf,__InputValue:Mu,__Schema:tp,__Type:cs,__TypeKind:Lf,assertAbstractType:j1,assertCompositeType:V1,assertDirective:X1,assertEnumType:N1,assertEnumValueName:fv,assertInputObjectType:L1,assertInputType:B1,assertInterfaceType:gv,assertLeafType:$1,assertListType:F1,assertName:Hi,assertNamedType:G1,assertNonNullType:z1,assertNullableType:yv,assertObjectType:mv,assertOutputType:U1,assertScalarType:O1,assertSchema:Ff,assertType:M1,assertUnionType:R1,assertValidName:ST,assertValidSchema:Bf,assertWrappingType:q1,astFromValue:ua,buildASTSchema:D0,buildClientSchema:sT,buildSchema:aT,coerceInputValue:Xv,concatAST:wT,createSourceEventStream:S0,defaultFieldResolver:af,defaultTypeResolver:b0,doTypesOverlap:tf,execute:sp,executeSync:g0,extendSchema:oT,findBreakingChanges:IT,findDangerousChanges:AT,formatError:e1,getArgumentValues:ip,getDirectiveValues:wu,getEnterLeaveForKind:Ul,getIntrospectionQuery:I0,getLocation:kh,getNamedType:Si,getNullableType:wf,getOperationAST:rT,getOperationRootType:nT,getVariableValues:Yv,getVisitFn:C1,graphql:WE,graphqlSync:XE,introspectionFromSchema:iT,introspectionTypes:Ou,isAbstractType:Gs,isCompositeType:Hs,isConstValueNode:rf,isDefinitionNode:aE,isDirective:Qh,isEnumType:In,isEqualType:Oh,isExecutableDefinitionNode:jf,isInputObjectType:Xr,isInputType:Mi,isInterfaceType:kr,isIntrospectionType:el,isLeafType:Zs,isListType:Wr,isNamedType:Cu,isNonNullType:tr,isNullableType:bf,isObjectType:Er,isOutputType:ha,isRequiredArgument:fa,isRequiredInputField:Jh,isScalarType:Wi,isSchema:Sv,isSelectionNode:lE,isSpecifiedDirective:Pf,isSpecifiedScalarType:Kh,isType:Au,isTypeDefinitionNode:Xl,isTypeExtensionNode:rp,isTypeNode:cE,isTypeSubTypeOf:Ja,isTypeSystemDefinitionNode:qf,isTypeSystemExtensionNode:Gf,isUnionType:Rn,isValidNameError:L0,isValueNode:Iv,isWrappingType:Du,lexicographicSortSchema:lT,locatedError:Gl,parse:Xh,parseConstValue:x1,parseType:b1,parseValue:pv,print:Hr,printError:Qw,printIntrospectionSchema:uT,printLocation:tv,printSchema:cT,printSourceLocation:gf,printType:k0,resolveObjMapThunk:Tf,resolveReadonlyArrayThunk:Ef,responsePathAsArray:ji,separateOperations:ET,specifiedDirectives:ma,specifiedRules:h0,specifiedScalarTypes:Pu,stripIgnoredCharacters:TT,subscribe:JE,syntaxError:Mn,typeFromAST:Oi,validate:f0,validateSchema:zf,valueFromAST:qs,valueFromASTUntyped:Mh,version:Xw,versionInfo:Yw,visit:Hl,visitInParallel:xf,visitWithTypeInfo:Vf},Symbol.toStringTag,{value:"Module"})),NT=cf(RT);function LT(i){for(var l=[],c=0;c<i.length;){var f=i[c];if(f==="*"||f==="+"||f==="?"){l.push({type:"MODIFIER",index:c,value:i[c++]});continue}if(f==="\\"){l.push({type:"ESCAPED_CHAR",index:c++,value:i[c++]});continue}if(f==="{"){l.push({type:"OPEN",index:c,value:i[c++]});continue}if(f==="}"){l.push({type:"CLOSE",index:c,value:i[c++]});continue}if(f===":"){for(var _="",v=c+1;v<i.length;){var w=i.charCodeAt(v);if(w>=48&&w<=57||w>=65&&w<=90||w>=97&&w<=122||w===95){_+=i[v++];continue}break}if(!_)throw new TypeError("Missing parameter name at ".concat(c));l.push({type:"NAME",index:c,value:_}),c=v;continue}if(f==="("){var o=1,I="",v=c+1;if(i[v]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(v));for(;v<i.length;){if(i[v]==="\\"){I+=i[v++]+i[v++];continue}if(i[v]===")"){if(o--,o===0){v++;break}}else if(i[v]==="("&&(o++,i[v+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(v));I+=i[v++]}if(o)throw new TypeError("Unbalanced pattern at ".concat(c));if(!I)throw new TypeError("Missing pattern at ".concat(c));l.push({type:"PATTERN",index:c,value:I}),c=v;continue}l.push({type:"CHAR",index:c,value:i[c++]})}return l.push({type:"END",index:c,value:""}),l}function rm(i,l){l===void 0&&(l={});for(var c=LT(i),f=l.prefixes,_=f===void 0?"./":f,v="[^".concat(Ll(l.delimiter||"/#?"),"]+?"),w=[],o=0,I=0,A="",L=function(ce){if(I<c.length&&c[I].type===ce)return c[I++].value},R=function(ce){var Ae=L(ce);if(Ae!==void 0)return Ae;var Me=c[I],Y=Me.type,xe=Me.index;throw new TypeError("Unexpected ".concat(Y," at ").concat(xe,", expected ").concat(ce))},P=function(){for(var ce="",Ae;Ae=L("CHAR")||L("ESCAPED_CHAR");)ce+=Ae;return ce};I<c.length;){var q=L("CHAR"),ie=L("NAME"),le=L("PATTERN");if(ie||le){var V=q||"";_.indexOf(V)===-1&&(A+=V,V=""),A&&(w.push(A),A=""),w.push({name:ie||o++,prefix:V,suffix:"",pattern:le||v,modifier:L("MODIFIER")||""});continue}var me=q||L("ESCAPED_CHAR");if(me){A+=me;continue}A&&(w.push(A),A="");var Oe=L("OPEN");if(Oe){var V=P(),Pe=L("NAME")||"",ne=L("PATTERN")||"",de=P();R("CLOSE"),w.push({name:Pe||(ne?o++:""),pattern:Pe&&!ne?v:ne,prefix:V,suffix:de,modifier:L("MODIFIER")||""});continue}R("END")}return w}function FT(i,l){return z0(rm(i,l),l)}function z0(i,l){l===void 0&&(l={});var c=nm(l),f=l.encode,_=f===void 0?function(I){return I}:f,v=l.validate,w=v===void 0?!0:v,o=i.map(function(I){if(typeof I=="object")return new RegExp("^(?:".concat(I.pattern,")$"),c)});return function(I){for(var A="",L=0;L<i.length;L++){var R=i[L];if(typeof R=="string"){A+=R;continue}var P=I?I[R.name]:void 0,q=R.modifier==="?"||R.modifier==="*",ie=R.modifier==="*"||R.modifier==="+";if(Array.isArray(P)){if(!ie)throw new TypeError('Expected "'.concat(R.name,'" to not repeat, but got an array'));if(P.length===0){if(q)continue;throw new TypeError('Expected "'.concat(R.name,'" to not be empty'))}for(var le=0;le<P.length;le++){var V=_(P[le],R);if(w&&!o[L].test(V))throw new TypeError('Expected all "'.concat(R.name,'" to match "').concat(R.pattern,'", but got "').concat(V,'"'));A+=R.prefix+V+R.suffix}continue}if(typeof P=="string"||typeof P=="number"){var V=_(String(P),R);if(w&&!o[L].test(V))throw new TypeError('Expected "'.concat(R.name,'" to match "').concat(R.pattern,'", but got "').concat(V,'"'));A+=R.prefix+V+R.suffix;continue}if(!q){var me=ie?"an array":"a string";throw new TypeError('Expected "'.concat(R.name,'" to be ').concat(me))}}return A}}function zT(i,l){var c=[],f=im(i,c,l);return B0(f,c,l)}function B0(i,l,c){c===void 0&&(c={});var f=c.decode,_=f===void 0?function(v){return v}:f;return function(v){var w=i.exec(v);if(!w)return!1;for(var o=w[0],I=w.index,A=Object.create(null),L=function(P){if(w[P]===void 0)return"continue";var q=l[P-1];q.modifier==="*"||q.modifier==="+"?A[q.name]=w[P].split(q.prefix+q.suffix).map(function(ie){return _(ie,q)}):A[q.name]=_(w[P],q)},R=1;R<w.length;R++)L(R);return{path:o,index:I,params:A}}}function Ll(i){return i.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function nm(i){return i&&i.sensitive?"":"i"}function BT(i,l){if(!l)return i;for(var c=/\((?:\?<(.*?)>)?(?!\?)/g,f=0,_=c.exec(i.source);_;)l.push({name:_[1]||f++,prefix:"",suffix:"",modifier:"",pattern:""}),_=c.exec(i.source);return i}function UT(i,l,c){var f=i.map(function(_){return im(_,l,c).source});return new RegExp("(?:".concat(f.join("|"),")"),nm(c))}function $T(i,l,c){return U0(rm(i,c),l,c)}function U0(i,l,c){c===void 0&&(c={});for(var f=c.strict,_=f===void 0?!1:f,v=c.start,w=v===void 0?!0:v,o=c.end,I=o===void 0?!0:o,A=c.encode,L=A===void 0?function(xe){return xe}:A,R=c.delimiter,P=R===void 0?"/#?":R,q=c.endsWith,ie=q===void 0?"":q,le="[".concat(Ll(ie),"]|$"),V="[".concat(Ll(P),"]"),me=w?"^":"",Oe=0,Pe=i;Oe<Pe.length;Oe++){var ne=Pe[Oe];if(typeof ne=="string")me+=Ll(L(ne));else{var de=Ll(L(ne.prefix)),ce=Ll(L(ne.suffix));if(ne.pattern)if(l&&l.push(ne),de||ce)if(ne.modifier==="+"||ne.modifier==="*"){var Ae=ne.modifier==="*"?"?":"";me+="(?:".concat(de,"((?:").concat(ne.pattern,")(?:").concat(ce).concat(de,"(?:").concat(ne.pattern,"))*)").concat(ce,")").concat(Ae)}else me+="(?:".concat(de,"(").concat(ne.pattern,")").concat(ce,")").concat(ne.modifier);else ne.modifier==="+"||ne.modifier==="*"?me+="((?:".concat(ne.pattern,")").concat(ne.modifier,")"):me+="(".concat(ne.pattern,")").concat(ne.modifier);else me+="(?:".concat(de).concat(ce,")").concat(ne.modifier)}}if(I)_||(me+="".concat(V,"?")),me+=c.endsWith?"(?=".concat(le,")"):"$";else{var Me=i[i.length-1],Y=typeof Me=="string"?V.indexOf(Me[Me.length-1])>-1:Me===void 0;_||(me+="(?:".concat(V,"(?=").concat(le,"))?")),Y||(me+="(?=".concat(V,"|").concat(le,")"))}return new RegExp(me,nm(c))}function im(i,l,c){return i instanceof RegExp?BT(i,l):Array.isArray(i)?UT(i,l,c):$T(i,l,c)}const VT=Object.freeze(Object.defineProperty({__proto__:null,compile:FT,match:zT,parse:rm,pathToRegexp:im,regexpToFunction:B0,tokensToFunction:z0,tokensToRegexp:U0},Symbol.toStringTag,{value:"Module"})),jT=cf(VT);var Xc={},Yc={},S_;function $0(){if(S_)return Yc;S_=1,Object.defineProperty(Yc,"__esModule",{value:!0}),Yc.toIsoResponse=void 0;var i=ls;function l(c){var f;return{status:(f=c.status)!==null&&f!==void 0?f:200,statusText:c.statusText||"OK",headers:i.objectToHeaders(c.headers||{}),body:c.body}}return Yc.toIsoResponse=l,Yc}var I_;function qT(){if(I_)return Xc;I_=1;var i=yt&&yt.__extends||function(){var ie=function(le,V){return ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(me,Oe){me.__proto__=Oe}||function(me,Oe){for(var Pe in Oe)Object.prototype.hasOwnProperty.call(Oe,Pe)&&(me[Pe]=Oe[Pe])},ie(le,V)};return function(le,V){if(typeof V!="function"&&V!==null)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");ie(le,V);function me(){this.constructor=le}le.prototype=V===null?Object.create(V):(me.prototype=V.prototype,new me)}}(),l=yt&&yt.__assign||function(){return l=Object.assign||function(ie){for(var le,V=1,me=arguments.length;V<me;V++){le=arguments[V];for(var Oe in le)Object.prototype.hasOwnProperty.call(le,Oe)&&(ie[Oe]=le[Oe])}return ie},l.apply(this,arguments)},c=yt&&yt.__awaiter||function(ie,le,V,me){function Oe(Pe){return Pe instanceof V?Pe:new V(function(ne){ne(Pe)})}return new(V||(V=Promise))(function(Pe,ne){function de(Me){try{Ae(me.next(Me))}catch(Y){ne(Y)}}function ce(Me){try{Ae(me.throw(Me))}catch(Y){ne(Y)}}function Ae(Me){Me.done?Pe(Me.value):Oe(Me.value).then(de,ce)}Ae((me=me.apply(ie,le||[])).next())})},f=yt&&yt.__generator||function(ie,le){var V={label:0,sent:function(){if(Pe[0]&1)throw Pe[1];return Pe[1]},trys:[],ops:[]},me,Oe,Pe,ne;return ne={next:de(0),throw:de(1),return:de(2)},typeof Symbol=="function"&&(ne[Symbol.iterator]=function(){return this}),ne;function de(Ae){return function(Me){return ce([Ae,Me])}}function ce(Ae){if(me)throw new TypeError("Generator is already executing.");for(;V;)try{if(me=1,Oe&&(Pe=Ae[0]&2?Oe.return:Ae[0]?Oe.throw||((Pe=Oe.return)&&Pe.call(Oe),0):Oe.next)&&!(Pe=Pe.call(Oe,Ae[1])).done)return Pe;switch(Oe=0,Pe&&(Ae=[Ae[0]&2,Pe.value]),Ae[0]){case 0:case 1:Pe=Ae;break;case 4:return V.label++,{value:Ae[1],done:!1};case 5:V.label++,Oe=Ae[1],Ae=[0];continue;case 7:Ae=V.ops.pop(),V.trys.pop();continue;default:if(Pe=V.trys,!(Pe=Pe.length>0&&Pe[Pe.length-1])&&(Ae[0]===6||Ae[0]===2)){V=0;continue}if(Ae[0]===3&&(!Pe||Ae[1]>Pe[0]&&Ae[1]<Pe[3])){V.label=Ae[1];break}if(Ae[0]===6&&V.label<Pe[1]){V.label=Pe[1],Pe=Ae;break}if(Pe&&V.label<Pe[2]){V.label=Pe[2],V.ops.push(Ae);break}Pe[2]&&V.ops.pop(),V.trys.pop();continue}Ae=le.call(ie,V)}catch(Me){Ae=[6,Me],Oe=0}finally{me=Pe=0}if(Ae[0]&5)throw Ae[1];return{value:Ae[0]?Ae[1]:void 0,done:!0}}},_=yt&&yt.__read||function(ie,le){var V=typeof Symbol=="function"&&ie[Symbol.iterator];if(!V)return ie;var me=V.call(ie),Oe,Pe=[],ne;try{for(;(le===void 0||le-- >0)&&!(Oe=me.next()).done;)Pe.push(Oe.value)}catch(de){ne={error:de}}finally{try{Oe&&!Oe.done&&(V=me.return)&&V.call(me)}finally{if(ne)throw ne.error}}return Pe};Object.defineProperty(Xc,"__esModule",{value:!0}),Xc.FetchInterceptor=void 0;var v=ls,w=la(),o=Gh(),I=hf(),A=Uh(),L=$0(),R=mf(),P=function(ie){i(le,ie);function le(){return ie.call(this,le.symbol)||this}return le.prototype.checkEnvironment=function(){return typeof globalThis<"u"&&typeof globalThis.fetch<"u"},le.prototype.setup=function(){var V=this,me=globalThis.fetch;w.invariant(!me[I.IS_PATCHED_MODULE],'Failed to patch the "fetch" module: already patched.'),globalThis.fetch=function(Oe,Pe){return c(V,void 0,void 0,function(){var ne,de,ce,Ae,Me,Y,xe,Ge,Ye,ct,wt=this;return f(this,function(Et){switch(Et.label){case 0:return ne=new Request(Oe,Pe),de=typeof Oe=="string"?Oe:Oe.url,ce=ne.method,this.log("[%s] %s",ce,de),[4,ne.clone().arrayBuffer()];case 1:return Ae=Et.sent(),Me=new o.IsomorphicRequest(new URL(de,location.origin),{body:Ae,method:ce,headers:new v.Headers(ne.headers),credentials:ne.credentials}),Y=new R.InteractiveIsomorphicRequest(Me),this.log("isomorphic request",Y),this.log('emitting the "request" event for %d listener(s)...',this.emitter.listenerCount("request")),this.emitter.emit("request",Y),this.log("awaiting for the mocked response..."),[4,this.emitter.untilIdle("request",function(Dt){var ht=_(Dt.args,1),et=ht[0];return et.id===Y.id})];case 2:return Et.sent(),this.log("all request listeners have been resolved!"),[4,Y.respondWith.invoked()];case 3:return xe=_.apply(void 0,[Et.sent(),1]),Ge=xe[0],this.log("event.respondWith called with:",Ge),Ge?(this.log("received mocked response:",Ge),Ye=L.toIsoResponse(Ge),this.log("derived isomorphic response:",Ye),this.emitter.emit("response",Y,Ye),ct=new Response(Ge.body,l(l({},Ye),{headers:v.flattenHeadersObject(Ge.headers||{})})),Object.defineProperty(ct,"url",{writable:!1,enumerable:!0,configurable:!1,value:Y.url.href}),[2,ct]):(this.log("no mocked response received!"),[2,me(ne).then(function(Dt){return c(wt,void 0,void 0,function(){var ht,et,ft,Ut;return f(this,function(mt){switch(mt.label){case 0:return ht=Dt.clone(),this.log("original fetch performed",ht),ft=(et=this.emitter).emit,Ut=["response",Y],[4,q(ht)];case 1:return ft.apply(et,Ut.concat([mt.sent()])),[2,Dt]}})})})])}})})},Object.defineProperty(globalThis.fetch,I.IS_PATCHED_MODULE,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push(function(){Object.defineProperty(globalThis.fetch,I.IS_PATCHED_MODULE,{value:void 0}),globalThis.fetch=me,V.log('restored native "globalThis.fetch"!',globalThis.fetch.name)})},le.symbol=Symbol("fetch"),le}(A.Interceptor);Xc.FetchInterceptor=P;function q(ie){return c(this,void 0,void 0,function(){var le;return f(this,function(V){switch(V.label){case 0:return le={status:ie.status,statusText:ie.statusText,headers:v.objectToHeaders(v.headersToObject(ie.headers))},[4,ie.text()];case 1:return[2,(le.body=V.sent(),le)]}})})}return Xc}var Jc={},Kc={},Qc={},Io={},Xa={},A_;function op(){if(A_)return Xa;A_=1;function i(v,w,o){if(o===void 0&&(o=Array.prototype),v&&typeof o.find=="function")return o.find.call(v,w);for(var I=0;I<v.length;I++)if(Object.prototype.hasOwnProperty.call(v,I)){var A=v[I];if(w.call(void 0,A,I,v))return A}}function l(v,w){return w===void 0&&(w=Object),w&&typeof w.freeze=="function"?w.freeze(v):v}function c(v,w){if(v===null||typeof v!="object")throw new TypeError("target is not an object");for(var o in w)Object.prototype.hasOwnProperty.call(w,o)&&(v[o]=w[o]);return v}var f=l({HTML:"text/html",isHTML:function(v){return v===f.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),_=l({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(v){return v===_.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});return Xa.assign=c,Xa.find=i,Xa.freeze=l,Xa.MIME_TYPE=f,Xa.NAMESPACE=_,Xa}var D_;function V0(){if(D_)return Io;D_=1;var i=op(),l=i.find,c=i.NAMESPACE;function f(Z){return Z!==""}function _(Z){return Z?Z.split(/[\t\n\f\r ]+/).filter(f):[]}function v(Z,H){return Z.hasOwnProperty(H)||(Z[H]=!0),Z}function w(Z){if(!Z)return[];var H=_(Z);return Object.keys(H.reduce(v,{}))}function o(Z){return function(H){return Z&&Z.indexOf(H)!==-1}}function I(Z,H){for(var _e in Z)Object.prototype.hasOwnProperty.call(Z,_e)&&(H[_e]=Z[_e])}function A(Z,H){var _e=Z.prototype;if(!(_e instanceof H)){let $=function(){};$.prototype=H.prototype,$=new $,I(_e,$),Z.prototype=_e=$}_e.constructor!=Z&&(typeof Z!="function"&&console.error("unknown Class:"+Z),_e.constructor=Z)}var L={},R=L.ELEMENT_NODE=1,P=L.ATTRIBUTE_NODE=2,q=L.TEXT_NODE=3,ie=L.CDATA_SECTION_NODE=4,le=L.ENTITY_REFERENCE_NODE=5,V=L.ENTITY_NODE=6,me=L.PROCESSING_INSTRUCTION_NODE=7,Oe=L.COMMENT_NODE=8,Pe=L.DOCUMENT_NODE=9,ne=L.DOCUMENT_TYPE_NODE=10,de=L.DOCUMENT_FRAGMENT_NODE=11,ce=L.NOTATION_NODE=12,Ae={},Me={};Ae.INDEX_SIZE_ERR=(Me[1]="Index size error",1),Ae.DOMSTRING_SIZE_ERR=(Me[2]="DOMString size error",2);var Y=Ae.HIERARCHY_REQUEST_ERR=(Me[3]="Hierarchy request error",3);Ae.WRONG_DOCUMENT_ERR=(Me[4]="Wrong document",4),Ae.INVALID_CHARACTER_ERR=(Me[5]="Invalid character",5),Ae.NO_DATA_ALLOWED_ERR=(Me[6]="No data allowed",6),Ae.NO_MODIFICATION_ALLOWED_ERR=(Me[7]="No modification allowed",7);var xe=Ae.NOT_FOUND_ERR=(Me[8]="Not found",8);Ae.NOT_SUPPORTED_ERR=(Me[9]="Not supported",9);var Ge=Ae.INUSE_ATTRIBUTE_ERR=(Me[10]="Attribute in use",10);Ae.INVALID_STATE_ERR=(Me[11]="Invalid state",11),Ae.SYNTAX_ERR=(Me[12]="Syntax error",12),Ae.INVALID_MODIFICATION_ERR=(Me[13]="Invalid modification",13),Ae.NAMESPACE_ERR=(Me[14]="Invalid namespace",14),Ae.INVALID_ACCESS_ERR=(Me[15]="Invalid access",15);function Ye(Z,H){if(H instanceof Error)var _e=H;else _e=this,Error.call(this,Me[Z]),this.message=Me[Z],Error.captureStackTrace&&Error.captureStackTrace(this,Ye);return _e.code=Z,H&&(this.message=this.message+": "+H),_e}Ye.prototype=Error.prototype,I(Ae,Ye);function ct(){}ct.prototype={length:0,item:function(Z){return this[Z]||null},toString:function(Z,H){for(var _e=[],$=0;$<this.length;$++)nt(this[$],_e,Z,H);return _e.join("")},filter:function(Z){return Array.prototype.filter.call(this,Z)},indexOf:function(Z){return Array.prototype.indexOf.call(this,Z)}};function wt(Z,H){this._node=Z,this._refresh=H,Et(this)}function Et(Z){var H=Z._node._inc||Z._node.ownerDocument._inc;if(Z._inc!=H){var _e=Z._refresh(Z._node);on(Z,"length",_e.length),I(_e,Z),Z._inc=H}}wt.prototype.item=function(Z){return Et(this),this[Z]},A(wt,ct);function Dt(){}function ht(Z,H){for(var _e=Z.length;_e--;)if(Z[_e]===H)return _e}function et(Z,H,_e,$){if($?H[ht(H,$)]=_e:H[H.length++]=_e,Z){_e.ownerElement=Z;var O=Z.ownerDocument;O&&($&&St(O,Z,$),je(O,Z,_e))}}function ft(Z,H,_e){var $=ht(H,_e);if($>=0){for(var O=H.length-1;$<O;)H[$]=H[++$];if(H.length=O,Z){var B=Z.ownerDocument;B&&(St(B,Z,_e),_e.ownerElement=null)}}else throw new Ye(xe,new Error(Z.tagName+"@"+_e))}Dt.prototype={length:0,item:ct.prototype.item,getNamedItem:function(Z){for(var H=this.length;H--;){var _e=this[H];if(_e.nodeName==Z)return _e}},setNamedItem:function(Z){var H=Z.ownerElement;if(H&&H!=this._ownerElement)throw new Ye(Ge);var _e=this.getNamedItem(Z.nodeName);return et(this._ownerElement,this,Z,_e),_e},setNamedItemNS:function(Z){var H=Z.ownerElement,_e;if(H&&H!=this._ownerElement)throw new Ye(Ge);return _e=this.getNamedItemNS(Z.namespaceURI,Z.localName),et(this._ownerElement,this,Z,_e),_e},removeNamedItem:function(Z){var H=this.getNamedItem(Z);return ft(this._ownerElement,this,H),H},removeNamedItemNS:function(Z,H){var _e=this.getNamedItemNS(Z,H);return ft(this._ownerElement,this,_e),_e},getNamedItemNS:function(Z,H){for(var _e=this.length;_e--;){var $=this[_e];if($.localName==H&&$.namespaceURI==Z)return $}return null}};function Ut(){}Ut.prototype={hasFeature:function(Z,H){return!0},createDocument:function(Z,H,_e){var $=new Ee;if($.implementation=this,$.childNodes=new ct,$.doctype=_e||null,_e&&$.appendChild(_e),H){var O=$.createElementNS(Z,H);$.appendChild(O)}return $},createDocumentType:function(Z,H,_e){var $=new Ln;return $.name=Z,$.nodeName=Z,$.publicId=H||"",$.systemId=_e||"",$}};function mt(){}mt.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(Z,H){return Xe(this,Z,H)},replaceChild:function(Z,H){Xe(this,Z,H,Dn),H&&this.removeChild(H)},removeChild:function(Z){return ot(this,Z)},appendChild:function(Z){return this.insertBefore(Z,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(Z){return Ht(this.ownerDocument||this,this,Z)},normalize:function(){for(var Z=this.firstChild;Z;){var H=Z.nextSibling;H&&H.nodeType==q&&Z.nodeType==q?(this.removeChild(H),Z.appendData(H.data)):(Z.normalize(),Z=H)}},isSupported:function(Z,H){return this.ownerDocument.implementation.hasFeature(Z,H)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(Z){for(var H=this;H;){var _e=H._nsMap;if(_e){for(var $ in _e)if(Object.prototype.hasOwnProperty.call(_e,$)&&_e[$]===Z)return $}H=H.nodeType==P?H.ownerDocument:H.parentNode}return null},lookupNamespaceURI:function(Z){for(var H=this;H;){var _e=H._nsMap;if(_e&&Object.prototype.hasOwnProperty.call(_e,Z))return _e[Z];H=H.nodeType==P?H.ownerDocument:H.parentNode}return null},isDefaultNamespace:function(Z){var H=this.lookupPrefix(Z);return H==null}};function Q(Z){return Z=="<"&&"&lt;"||Z==">"&&"&gt;"||Z=="&"&&"&amp;"||Z=='"'&&"&quot;"||"&#"+Z.charCodeAt()+";"}I(L,mt),I(L,mt.prototype);function we(Z,H){if(H(Z))return!0;if(Z=Z.firstChild)do if(we(Z,H))return!0;while(Z=Z.nextSibling)}function Ee(){this.ownerDocument=this}function je(Z,H,_e){Z&&Z._inc++;var $=_e.namespaceURI;$===c.XMLNS&&(H._nsMap[_e.prefix?_e.localName:""]=_e.value)}function St(Z,H,_e,$){Z&&Z._inc++;var O=_e.namespaceURI;O===c.XMLNS&&delete H._nsMap[_e.prefix?_e.localName:""]}function Mt(Z,H,_e){if(Z&&Z._inc){Z._inc++;var $=H.childNodes;if(_e)$[$.length++]=_e;else{for(var O=H.firstChild,B=0;O;)$[B++]=O,O=O.nextSibling;$.length=B,delete $[$.length]}}}function ot(Z,H){var _e=H.previousSibling,$=H.nextSibling;return _e?_e.nextSibling=$:Z.firstChild=$,$?$.previousSibling=_e:Z.lastChild=_e,H.parentNode=null,H.previousSibling=null,H.nextSibling=null,Mt(Z.ownerDocument,Z),H}function It(Z){return Z&&(Z.nodeType===mt.DOCUMENT_NODE||Z.nodeType===mt.DOCUMENT_FRAGMENT_NODE||Z.nodeType===mt.ELEMENT_NODE)}function jt(Z){return Z&&(Yt(Z)||hn(Z)||Qt(Z)||Z.nodeType===mt.DOCUMENT_FRAGMENT_NODE||Z.nodeType===mt.COMMENT_NODE||Z.nodeType===mt.PROCESSING_INSTRUCTION_NODE)}function Qt(Z){return Z&&Z.nodeType===mt.DOCUMENT_TYPE_NODE}function Yt(Z){return Z&&Z.nodeType===mt.ELEMENT_NODE}function hn(Z){return Z&&Z.nodeType===mt.TEXT_NODE}function gr(Z,H){var _e=Z.childNodes||[];if(l(_e,Yt)||Qt(H))return!1;var $=l(_e,Qt);return!(H&&$&&_e.indexOf($)>_e.indexOf(H))}function sn(Z,H){var _e=Z.childNodes||[];function $(B){return Yt(B)&&B!==H}if(l(_e,$))return!1;var O=l(_e,Qt);return!(H&&O&&_e.indexOf(O)>_e.indexOf(H))}function Sr(Z,H,_e){if(!It(Z))throw new Ye(Y,"Unexpected parent node type "+Z.nodeType);if(_e&&_e.parentNode!==Z)throw new Ye(xe,"child not in parent");if(!jt(H)||Qt(H)&&Z.nodeType!==mt.DOCUMENT_NODE)throw new Ye(Y,"Unexpected node type "+H.nodeType+" for parent node type "+Z.nodeType)}function An(Z,H,_e){var $=Z.childNodes||[],O=H.childNodes||[];if(H.nodeType===mt.DOCUMENT_FRAGMENT_NODE){var B=O.filter(Yt);if(B.length>1||l(O,hn))throw new Ye(Y,"More than one element or text in fragment");if(B.length===1&&!gr(Z,_e))throw new Ye(Y,"Element in fragment can not be inserted before doctype")}if(Yt(H)&&!gr(Z,_e))throw new Ye(Y,"Only one element can be added and only after doctype");if(Qt(H)){if(l($,Qt))throw new Ye(Y,"Only one doctype is allowed");var X=l($,Yt);if(_e&&$.indexOf(X)<$.indexOf(_e))throw new Ye(Y,"Doctype can only be inserted before an element");if(!_e&&X)throw new Ye(Y,"Doctype can not be appended since element is present")}}function Dn(Z,H,_e){var $=Z.childNodes||[],O=H.childNodes||[];if(H.nodeType===mt.DOCUMENT_FRAGMENT_NODE){var B=O.filter(Yt);if(B.length>1||l(O,hn))throw new Ye(Y,"More than one element or text in fragment");if(B.length===1&&!sn(Z,_e))throw new Ye(Y,"Element in fragment can not be inserted before doctype")}if(Yt(H)&&!sn(Z,_e))throw new Ye(Y,"Only one element can be added and only after doctype");if(Qt(H)){if(l($,function(ae){return Qt(ae)&&ae!==_e}))throw new Ye(Y,"Only one doctype is allowed");var X=l($,Yt);if(_e&&$.indexOf(X)<$.indexOf(_e))throw new Ye(Y,"Doctype can only be inserted before an element")}}function Xe(Z,H,_e,$){Sr(Z,H,_e),Z.nodeType===mt.DOCUMENT_NODE&&($||An)(Z,H,_e);var O=H.parentNode;if(O&&O.removeChild(H),H.nodeType===de){var B=H.firstChild;if(B==null)return H;var X=H.lastChild}else B=X=H;var se=_e?_e.previousSibling:Z.lastChild;B.previousSibling=se,X.nextSibling=_e,se?se.nextSibling=B:Z.firstChild=B,_e==null?Z.lastChild=X:_e.previousSibling=X;do B.parentNode=Z;while(B!==X&&(B=B.nextSibling));return Mt(Z.ownerDocument||Z,Z),H.nodeType==de&&(H.firstChild=H.lastChild=null),H}function $e(Z,H){return H.parentNode&&H.parentNode.removeChild(H),H.parentNode=Z,H.previousSibling=Z.lastChild,H.nextSibling=null,H.previousSibling?H.previousSibling.nextSibling=H:Z.firstChild=H,Z.lastChild=H,Mt(Z.ownerDocument,Z,H),H}Ee.prototype={nodeName:"#document",nodeType:Pe,doctype:null,documentElement:null,_inc:1,insertBefore:function(Z,H){if(Z.nodeType==de){for(var _e=Z.firstChild;_e;){var $=_e.nextSibling;this.insertBefore(_e,H),_e=$}return Z}return Xe(this,Z,H),Z.ownerDocument=this,this.documentElement===null&&Z.nodeType===R&&(this.documentElement=Z),Z},removeChild:function(Z){return this.documentElement==Z&&(this.documentElement=null),ot(this,Z)},replaceChild:function(Z,H){Xe(this,Z,H,Dn),Z.ownerDocument=this,H&&this.removeChild(H),Yt(Z)&&(this.documentElement=Z)},importNode:function(Z,H){return Xt(this,Z,H)},getElementById:function(Z){var H=null;return we(this.documentElement,function(_e){if(_e.nodeType==R&&_e.getAttribute("id")==Z)return H=_e,!0}),H},getElementsByClassName:function(Z){var H=w(Z);return new wt(this,function(_e){var $=[];return H.length>0&&we(_e.documentElement,function(O){if(O!==_e&&O.nodeType===R){var B=O.getAttribute("class");if(B){var X=Z===B;if(!X){var se=w(B);X=H.every(o(se))}X&&$.push(O)}}}),$})},createElement:function(Z){var H=new Jt;H.ownerDocument=this,H.nodeName=Z,H.tagName=Z,H.localName=Z,H.childNodes=new ct;var _e=H.attributes=new Dt;return _e._ownerElement=H,H},createDocumentFragment:function(){var Z=new ai;return Z.ownerDocument=this,Z.childNodes=new ct,Z},createTextNode:function(Z){var H=new sr;return H.ownerDocument=this,H.appendData(Z),H},createComment:function(Z){var H=new Nn;return H.ownerDocument=this,H.appendData(Z),H},createCDATASection:function(Z){var H=new Ii;return H.ownerDocument=this,H.appendData(Z),H},createProcessingInstruction:function(Z,H){var _e=new it;return _e.ownerDocument=this,_e.tagName=_e.target=Z,_e.nodeValue=_e.data=H,_e},createAttribute:function(Z){var H=new wr;return H.ownerDocument=this,H.name=Z,H.nodeName=Z,H.localName=Z,H.specified=!0,H},createEntityReference:function(Z){var H=new oi;return H.ownerDocument=this,H.nodeName=Z,H},createElementNS:function(Z,H){var _e=new Jt,$=H.split(":"),O=_e.attributes=new Dt;return _e.childNodes=new ct,_e.ownerDocument=this,_e.nodeName=H,_e.tagName=H,_e.namespaceURI=Z,$.length==2?(_e.prefix=$[0],_e.localName=$[1]):_e.localName=H,O._ownerElement=_e,_e},createAttributeNS:function(Z,H){var _e=new wr,$=H.split(":");return _e.ownerDocument=this,_e.nodeName=H,_e.name=H,_e.namespaceURI=Z,_e.specified=!0,$.length==2?(_e.prefix=$[0],_e.localName=$[1]):_e.localName=H,_e}},A(Ee,mt);function Jt(){this._nsMap={}}Jt.prototype={nodeType:R,hasAttribute:function(Z){return this.getAttributeNode(Z)!=null},getAttribute:function(Z){var H=this.getAttributeNode(Z);return H&&H.value||""},getAttributeNode:function(Z){return this.attributes.getNamedItem(Z)},setAttribute:function(Z,H){var _e=this.ownerDocument.createAttribute(Z);_e.value=_e.nodeValue=""+H,this.setAttributeNode(_e)},removeAttribute:function(Z){var H=this.getAttributeNode(Z);H&&this.removeAttributeNode(H)},appendChild:function(Z){return Z.nodeType===de?this.insertBefore(Z,null):$e(this,Z)},setAttributeNode:function(Z){return this.attributes.setNamedItem(Z)},setAttributeNodeNS:function(Z){return this.attributes.setNamedItemNS(Z)},removeAttributeNode:function(Z){return this.attributes.removeNamedItem(Z.nodeName)},removeAttributeNS:function(Z,H){var _e=this.getAttributeNodeNS(Z,H);_e&&this.removeAttributeNode(_e)},hasAttributeNS:function(Z,H){return this.getAttributeNodeNS(Z,H)!=null},getAttributeNS:function(Z,H){var _e=this.getAttributeNodeNS(Z,H);return _e&&_e.value||""},setAttributeNS:function(Z,H,_e){var $=this.ownerDocument.createAttributeNS(Z,H);$.value=$.nodeValue=""+_e,this.setAttributeNode($)},getAttributeNodeNS:function(Z,H){return this.attributes.getNamedItemNS(Z,H)},getElementsByTagName:function(Z){return new wt(this,function(H){var _e=[];return we(H,function($){$!==H&&$.nodeType==R&&(Z==="*"||$.tagName==Z)&&_e.push($)}),_e})},getElementsByTagNameNS:function(Z,H){return new wt(this,function(_e){var $=[];return we(_e,function(O){O!==_e&&O.nodeType===R&&(Z==="*"||O.namespaceURI===Z)&&(H==="*"||O.localName==H)&&$.push(O)}),$})}},Ee.prototype.getElementsByTagName=Jt.prototype.getElementsByTagName,Ee.prototype.getElementsByTagNameNS=Jt.prototype.getElementsByTagNameNS,A(Jt,mt);function wr(){}wr.prototype.nodeType=P,A(wr,mt);function ur(){}ur.prototype={data:"",substringData:function(Z,H){return this.data.substring(Z,Z+H)},appendData:function(Z){Z=this.data+Z,this.nodeValue=this.data=Z,this.length=Z.length},insertData:function(Z,H){this.replaceData(Z,0,H)},appendChild:function(Z){throw new Error(Me[Y])},deleteData:function(Z,H){this.replaceData(Z,H,"")},replaceData:function(Z,H,_e){var $=this.data.substring(0,Z),O=this.data.substring(Z+H);_e=$+_e+O,this.nodeValue=this.data=_e,this.length=_e.length}},A(ur,mt);function sr(){}sr.prototype={nodeName:"#text",nodeType:q,splitText:function(Z){var H=this.data,_e=H.substring(Z);H=H.substring(0,Z),this.data=this.nodeValue=H,this.length=H.length;var $=this.ownerDocument.createTextNode(_e);return this.parentNode&&this.parentNode.insertBefore($,this.nextSibling),$}},A(sr,ur);function Nn(){}Nn.prototype={nodeName:"#comment",nodeType:Oe},A(Nn,ur);function Ii(){}Ii.prototype={nodeName:"#cdata-section",nodeType:ie},A(Ii,ur);function Ln(){}Ln.prototype.nodeType=ne,A(Ln,mt);function ds(){}ds.prototype.nodeType=ce,A(ds,mt);function Ri(){}Ri.prototype.nodeType=V,A(Ri,mt);function oi(){}oi.prototype.nodeType=le,A(oi,mt);function ai(){}ai.prototype.nodeName="#document-fragment",ai.prototype.nodeType=de,A(ai,mt);function it(){}it.prototype.nodeType=me,A(it,mt);function jn(){}jn.prototype.serializeToString=function(Z,H,_e){return Pr.call(Z,H,_e)},mt.prototype.toString=Pr;function Pr(Z,H){var _e=[],$=this.nodeType==9&&this.documentElement||this,O=$.prefix,B=$.namespaceURI;if(B&&O==null){var O=$.lookupPrefix(B);if(O==null)var X=[{namespace:B,prefix:null}]}return nt(this,_e,Z,H,X),_e.join("")}function Ai(Z,H,_e){var $=Z.prefix||"",O=Z.namespaceURI;if(!O||$==="xml"&&O===c.XML||O===c.XMLNS)return!1;for(var B=_e.length;B--;){var X=_e[B];if(X.prefix===$)return X.namespace!==O}return!0}function qn(Z,H,_e){Z.push(" ",H,'="',_e.replace(/[<>&"\t\n\r]/g,Q),'"')}function nt(Z,H,_e,$,O){if(O||(O=[]),$)if(Z=$(Z),Z){if(typeof Z=="string"){H.push(Z);return}}else return;switch(Z.nodeType){case R:var B=Z.attributes,X=B.length,kt=Z.firstChild,se=Z.tagName;_e=c.isHTML(Z.namespaceURI)||_e;var ae=se;if(!_e&&!Z.prefix&&Z.namespaceURI){for(var Ie,ve=0;ve<B.length;ve++)if(B.item(ve).name==="xmlns"){Ie=B.item(ve).value;break}if(!Ie)for(var he=O.length-1;he>=0;he--){var Te=O[he];if(Te.prefix===""&&Te.namespace===Z.namespaceURI){Ie=Te.namespace;break}}if(Ie!==Z.namespaceURI)for(var he=O.length-1;he>=0;he--){var Te=O[he];if(Te.namespace===Z.namespaceURI){Te.prefix&&(ae=Te.prefix+":"+se);break}}}H.push("<",ae);for(var Ue=0;Ue<X;Ue++){var Ve=B.item(Ue);Ve.prefix=="xmlns"?O.push({prefix:Ve.localName,namespace:Ve.value}):Ve.nodeName=="xmlns"&&O.push({prefix:"",namespace:Ve.value})}for(var Ue=0;Ue<X;Ue++){var Ve=B.item(Ue);if(Ai(Ve,_e,O)){var qe=Ve.prefix||"",Ct=Ve.namespaceURI;qn(H,qe?"xmlns:"+qe:"xmlns",Ct),O.push({prefix:qe,namespace:Ct})}nt(Ve,H,_e,$,O)}if(se===ae&&Ai(Z,_e,O)){var qe=Z.prefix||"",Ct=Z.namespaceURI;qn(H,qe?"xmlns:"+qe:"xmlns",Ct),O.push({prefix:qe,namespace:Ct})}if(kt||_e&&!/^(?:meta|link|img|br|hr|input)$/i.test(se)){if(H.push(">"),_e&&/^script$/i.test(se))for(;kt;)kt.data?H.push(kt.data):nt(kt,H,_e,$,O.slice()),kt=kt.nextSibling;else for(;kt;)nt(kt,H,_e,$,O.slice()),kt=kt.nextSibling;H.push("</",ae,">")}else H.push("/>");return;case Pe:case de:for(var kt=Z.firstChild;kt;)nt(kt,H,_e,$,O.slice()),kt=kt.nextSibling;return;case P:return qn(H,Z.name,Z.value);case q:return H.push(Z.data.replace(/[<&>]/g,Q));case ie:return H.push("<![CDATA[",Z.data,"]]>");case Oe:return H.push("<!--",Z.data,"-->");case ne:var At=Z.publicId,Ot=Z.systemId;if(H.push("<!DOCTYPE ",Z.name),At)H.push(" PUBLIC ",At),Ot&&Ot!="."&&H.push(" ",Ot),H.push(">");else if(Ot&&Ot!=".")H.push(" SYSTEM ",Ot,">");else{var Zt=Z.internalSubset;Zt&&H.push(" [",Zt,"]"),H.push(">")}return;case me:return H.push("<?",Z.target," ",Z.data,"?>");case le:return H.push("&",Z.nodeName,";");default:H.push("??",Z.nodeName)}}function Xt(Z,H,_e){var $;switch(H.nodeType){case R:$=H.cloneNode(!1),$.ownerDocument=Z;case de:break;case P:_e=!0;break}if($||($=H.cloneNode(!1)),$.ownerDocument=Z,$.parentNode=null,_e)for(var O=H.firstChild;O;)$.appendChild(Xt(Z,O,_e)),O=O.nextSibling;return $}function Ht(Z,H,_e){var $=new H.constructor;for(var O in H)if(Object.prototype.hasOwnProperty.call(H,O)){var B=H[O];typeof B!="object"&&B!=$[O]&&($[O]=B)}switch(H.childNodes&&($.childNodes=new ct),$.ownerDocument=Z,$.nodeType){case R:var X=H.attributes,se=$.attributes=new Dt,ae=X.length;se._ownerElement=$;for(var Ie=0;Ie<ae;Ie++)$.setAttributeNode(Ht(Z,X.item(Ie),!0));break;case P:_e=!0}if(_e)for(var ve=H.firstChild;ve;)$.appendChild(Ht(Z,ve,_e)),ve=ve.nextSibling;return $}function on(Z,H,_e){Z[H]=_e}try{if(Object.defineProperty){let Z=function(H){switch(H.nodeType){case R:case de:var _e=[];for(H=H.firstChild;H;)H.nodeType!==7&&H.nodeType!==8&&_e.push(Z(H)),H=H.nextSibling;return _e.join("");default:return H.nodeValue}};Object.defineProperty(wt.prototype,"length",{get:function(){return Et(this),this.$$length}}),Object.defineProperty(mt.prototype,"textContent",{get:function(){return Z(this)},set:function(H){switch(this.nodeType){case R:case de:for(;this.firstChild;)this.removeChild(this.firstChild);(H||String(H))&&this.appendChild(this.ownerDocument.createTextNode(H));break;default:this.data=H,this.value=H,this.nodeValue=H}}}),on=function(H,_e,$){H["$$"+_e]=$}}}catch{}return Io.DocumentType=Ln,Io.DOMException=Ye,Io.DOMImplementation=Ut,Io.Element=Jt,Io.Node=mt,Io.NodeList=ct,Io.XMLSerializer=jn,Io}var eu={},Wd={},C_;function GT(){return C_||(C_=1,function(i){var l=op().freeze;i.XML_ENTITIES=l({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),i.HTML_ENTITIES=l({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}),i.entityMap=i.HTML_ENTITIES}(Wd)),Wd}var Th={},P_;function ZT(){if(P_)return Th;P_=1;var i=op().NAMESPACE,l=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,c=new RegExp("[\\-\\.0-9"+l.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),f=new RegExp("^"+l.source+c.source+"*(?::"+l.source+c.source+"*)?$"),_=0,v=1,w=2,o=3,I=4,A=5,L=6,R=7;function P(Y,xe){this.message=Y,this.locator=xe,Error.captureStackTrace&&Error.captureStackTrace(this,P)}P.prototype=new Error,P.prototype.name=P.name;function q(){}q.prototype={parse:function(Y,xe,Ge){var Ye=this.domBuilder;Ye.startDocument(),ne(xe,xe={}),ie(Y,xe,Ge,Ye,this.errorHandler),Ye.endDocument()}};function ie(Y,xe,Ge,Ye,ct){function wt(Jt){if(Jt>65535){Jt-=65536;var wr=55296+(Jt>>10),ur=56320+(Jt&1023);return String.fromCharCode(wr,ur)}else return String.fromCharCode(Jt)}function Et(Jt){var wr=Jt.slice(1,-1);return Object.hasOwnProperty.call(Ge,wr)?Ge[wr]:wr.charAt(0)==="#"?wt(parseInt(wr.substr(1).replace("x","0x"))):(ct.error("entity not found:"+Jt),Jt)}function Dt(Jt){if(Jt>Ee){var wr=Y.substring(Ee,Jt).replace(/&#?\w+;/g,Et);mt&&ht(Ee),Ye.characters(wr,0,Jt-Ee),Ee=Jt}}function ht(Jt,wr){for(;Jt>=ft&&(wr=Ut.exec(Y));)et=wr.index,ft=et+wr[0].length,mt.lineNumber++;mt.columnNumber=Jt-et+1}for(var et=0,ft=0,Ut=/.*(?:\r\n?|\n)|.*$/g,mt=Ye.locator,Q=[{currentNSMap:xe}],we={},Ee=0;;){try{var je=Y.indexOf("<",Ee);if(je<0){if(!Y.substr(Ee).match(/^\s*$/)){var St=Ye.doc,Mt=St.createTextNode(Y.substr(Ee));St.appendChild(Mt),Ye.currentElement=Mt}return}switch(je>Ee&&Dt(je),Y.charAt(je+1)){case"/":var Sr=Y.indexOf(">",je+3),ot=Y.substring(je+2,Sr).replace(/[ \t\n\r]+$/g,""),It=Q.pop();Sr<0?(ot=Y.substring(je+2).replace(/[\s<].*/,""),ct.error("end tag name: "+ot+" is not complete:"+It.tagName),Sr=je+1+ot.length):ot.match(/\s</)&&(ot=ot.replace(/[\s<].*/,""),ct.error("end tag name: "+ot+" maybe not complete"),Sr=je+1+ot.length);var jt=It.localNSMap,Qt=It.tagName==ot,Yt=Qt||It.tagName&&It.tagName.toLowerCase()==ot.toLowerCase();if(Yt){if(Ye.endElement(It.uri,It.localName,ot),jt)for(var hn in jt)Object.prototype.hasOwnProperty.call(jt,hn)&&Ye.endPrefixMapping(hn);Qt||ct.fatalError("end tag name: "+ot+" is not match the current start tagName:"+It.tagName)}else Q.push(It);Sr++;break;case"?":mt&&ht(je),Sr=ce(Y,je,Ye);break;case"!":mt&&ht(je),Sr=de(Y,je,Ye,ct);break;default:mt&&ht(je);var gr=new Ae,sn=Q[Q.length-1].currentNSMap,Sr=V(Y,je,gr,sn,Et,ct),An=gr.length;if(!gr.closed&&Pe(Y,Sr,gr.tagName,we)&&(gr.closed=!0,Ge.nbsp||ct.warning("unclosed xml attribute")),mt&&An){for(var Dn=le(mt,{}),Xe=0;Xe<An;Xe++){var $e=gr[Xe];ht($e.offset),$e.locator=le(mt,{})}Ye.locator=Dn,me(gr,Ye,sn)&&Q.push(gr),Ye.locator=mt}else me(gr,Ye,sn)&&Q.push(gr);i.isHTML(gr.uri)&&!gr.closed?Sr=Oe(Y,Sr,gr.tagName,Et,Ye):Sr++}}catch(Jt){if(Jt instanceof P)throw Jt;ct.error("element parse error: "+Jt),Sr=-1}Sr>Ee?Ee=Sr:Dt(Math.max(je,Ee)+1)}}function le(Y,xe){return xe.lineNumber=Y.lineNumber,xe.columnNumber=Y.columnNumber,xe}function V(Y,xe,Ge,Ye,ct,wt){function Et(mt,Q,we){Ge.attributeNames.hasOwnProperty(mt)&&wt.fatalError("Attribute "+mt+" redefined"),Ge.addValue(mt,Q.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,ct),we)}for(var Dt,ht,et=++xe,ft=_;;){var Ut=Y.charAt(et);switch(Ut){case"=":if(ft===v)Dt=Y.slice(xe,et),ft=o;else if(ft===w)ft=o;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(ft===o||ft===v)if(ft===v&&(wt.warning('attribute value must after "="'),Dt=Y.slice(xe,et)),xe=et+1,et=Y.indexOf(Ut,xe),et>0)ht=Y.slice(xe,et),Et(Dt,ht,xe-1),ft=A;else throw new Error("attribute value no end '"+Ut+"' match");else if(ft==I)ht=Y.slice(xe,et),Et(Dt,ht,xe),wt.warning('attribute "'+Dt+'" missed start quot('+Ut+")!!"),xe=et+1,ft=A;else throw new Error('attribute value must after "="');break;case"/":switch(ft){case _:Ge.setTagName(Y.slice(xe,et));case A:case L:case R:ft=R,Ge.closed=!0;case I:case v:case w:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return wt.error("unexpected end of input"),ft==_&&Ge.setTagName(Y.slice(xe,et)),et;case">":switch(ft){case _:Ge.setTagName(Y.slice(xe,et));case A:case L:case R:break;case I:case v:ht=Y.slice(xe,et),ht.slice(-1)==="/"&&(Ge.closed=!0,ht=ht.slice(0,-1));case w:ft===w&&(ht=Dt),ft==I?(wt.warning('attribute "'+ht+'" missed quot(")!'),Et(Dt,ht,xe)):((!i.isHTML(Ye[""])||!ht.match(/^(?:disabled|checked|selected)$/i))&&wt.warning('attribute "'+ht+'" missed value!! "'+ht+'" instead!!'),Et(ht,ht,xe));break;case o:throw new Error("attribute value missed!!")}return et;case"":Ut=" ";default:if(Ut<=" ")switch(ft){case _:Ge.setTagName(Y.slice(xe,et)),ft=L;break;case v:Dt=Y.slice(xe,et),ft=w;break;case I:var ht=Y.slice(xe,et);wt.warning('attribute "'+ht+'" missed quot(")!!'),Et(Dt,ht,xe);case A:ft=L;break}else switch(ft){case w:Ge.tagName,(!i.isHTML(Ye[""])||!Dt.match(/^(?:disabled|checked|selected)$/i))&&wt.warning('attribute "'+Dt+'" missed value!! "'+Dt+'" instead2!!'),Et(Dt,Dt,xe),xe=et,ft=v;break;case A:wt.warning('attribute space is required"'+Dt+'"!!');case L:ft=v,xe=et;break;case o:ft=I,xe=et;break;case R:throw new Error("elements closed character '/' and '>' must be connected to")}}et++}}function me(Y,xe,Ge){for(var Ye=Y.tagName,ct=null,Ut=Y.length;Ut--;){var wt=Y[Ut],Et=wt.qName,Dt=wt.value,mt=Et.indexOf(":");if(mt>0)var ht=wt.prefix=Et.slice(0,mt),et=Et.slice(mt+1),ft=ht==="xmlns"&&et;else et=Et,ht=null,ft=Et==="xmlns"&&"";wt.localName=et,ft!==!1&&(ct==null&&(ct={},ne(Ge,Ge={})),Ge[ft]=ct[ft]=Dt,wt.uri=i.XMLNS,xe.startPrefixMapping(ft,Dt))}for(var Ut=Y.length;Ut--;){wt=Y[Ut];var ht=wt.prefix;ht&&(ht==="xml"&&(wt.uri=i.XML),ht!=="xmlns"&&(wt.uri=Ge[ht||""]))}var mt=Ye.indexOf(":");mt>0?(ht=Y.prefix=Ye.slice(0,mt),et=Y.localName=Ye.slice(mt+1)):(ht=null,et=Y.localName=Ye);var Q=Y.uri=Ge[ht||""];if(xe.startElement(Q,et,Ye,Y),Y.closed){if(xe.endElement(Q,et,Ye),ct)for(ht in ct)Object.prototype.hasOwnProperty.call(ct,ht)&&xe.endPrefixMapping(ht)}else return Y.currentNSMap=Ge,Y.localNSMap=ct,!0}function Oe(Y,xe,Ge,Ye,ct){if(/^(?:script|textarea)$/i.test(Ge)){var wt=Y.indexOf("</"+Ge+">",xe),Et=Y.substring(xe+1,wt);if(/[&<]/.test(Et))return/^script$/i.test(Ge)?(ct.characters(Et,0,Et.length),wt):(Et=Et.replace(/&#?\w+;/g,Ye),ct.characters(Et,0,Et.length),wt)}return xe+1}function Pe(Y,xe,Ge,Ye){var ct=Ye[Ge];return ct==null&&(ct=Y.lastIndexOf("</"+Ge+">"),ct<xe&&(ct=Y.lastIndexOf("</"+Ge)),Ye[Ge]=ct),ct<xe}function ne(Y,xe){for(var Ge in Y)Object.prototype.hasOwnProperty.call(Y,Ge)&&(xe[Ge]=Y[Ge])}function de(Y,xe,Ge,Ye){var ct=Y.charAt(xe+2);switch(ct){case"-":if(Y.charAt(xe+3)==="-"){var wt=Y.indexOf("-->",xe+4);return wt>xe?(Ge.comment(Y,xe+4,wt-xe-4),wt+3):(Ye.error("Unclosed comment"),-1)}else return-1;default:if(Y.substr(xe+3,6)=="CDATA["){var wt=Y.indexOf("]]>",xe+9);return Ge.startCDATA(),Ge.characters(Y,xe+9,wt-xe-9),Ge.endCDATA(),wt+3}var Et=Me(Y,xe),Dt=Et.length;if(Dt>1&&/!doctype/i.test(Et[0][0])){var ht=Et[1][0],et=!1,ft=!1;Dt>3&&(/^public$/i.test(Et[2][0])?(et=Et[3][0],ft=Dt>4&&Et[4][0]):/^system$/i.test(Et[2][0])&&(ft=Et[3][0]));var Ut=Et[Dt-1];return Ge.startDTD(ht,et,ft),Ge.endDTD(),Ut.index+Ut[0].length}}return-1}function ce(Y,xe,Ge){var Ye=Y.indexOf("?>",xe);if(Ye){var ct=Y.substring(xe,Ye).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return ct?(ct[0].length,Ge.processingInstruction(ct[1],ct[2]),Ye+2):-1}return-1}function Ae(){this.attributeNames={}}Ae.prototype={setTagName:function(Y){if(!f.test(Y))throw new Error("invalid tagName:"+Y);this.tagName=Y},addValue:function(Y,xe,Ge){if(!f.test(Y))throw new Error("invalid attribute:"+Y);this.attributeNames[Y]=this.length,this[this.length++]={qName:Y,value:xe,offset:Ge}},length:0,getLocalName:function(Y){return this[Y].localName},getLocator:function(Y){return this[Y].locator},getQName:function(Y){return this[Y].qName},getURI:function(Y){return this[Y].uri},getValue:function(Y){return this[Y].value}};function Me(Y,xe){var Ge,Ye=[],ct=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(ct.lastIndex=xe,ct.exec(Y);Ge=ct.exec(Y);)if(Ye.push(Ge),Ge[1])return Ye}return Th.XMLReader=q,Th.ParseError=P,Th}var k_;function HT(){if(k_)return eu;k_=1;var i=op(),l=V0(),c=GT(),f=ZT(),_=l.DOMImplementation,v=i.NAMESPACE,w=f.ParseError,o=f.XMLReader;function I(V){return V.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function A(V){this.options=V||{locator:{}}}A.prototype.parseFromString=function(V,me){var Oe=this.options,Pe=new o,ne=Oe.domBuilder||new R,de=Oe.errorHandler,ce=Oe.locator,Ae=Oe.xmlns||{},Me=/\/x?html?$/.test(me),Y=Me?c.HTML_ENTITIES:c.XML_ENTITIES;ce&&ne.setDocumentLocator(ce),Pe.errorHandler=L(de,ne,ce),Pe.domBuilder=Oe.domBuilder||ne,Me&&(Ae[""]=v.HTML),Ae.xml=Ae.xml||v.XML;var xe=Oe.normalizeLineEndings||I;return V&&typeof V=="string"?Pe.parse(xe(V),Ae,Y):Pe.errorHandler.error("invalid doc source"),ne.doc};function L(V,me,Oe){if(!V){if(me instanceof R)return me;V=me}var Pe={},ne=V instanceof Function;Oe=Oe||{};function de(ce){var Ae=V[ce];!Ae&&ne&&(Ae=V.length==2?function(Me){V(ce,Me)}:V),Pe[ce]=Ae&&function(Me){Ae("[xmldom "+ce+"]	"+Me+q(Oe))}||function(){}}return de("warning"),de("error"),de("fatalError"),Pe}function R(){this.cdata=!1}function P(V,me){me.lineNumber=V.lineNumber,me.columnNumber=V.columnNumber}R.prototype={startDocument:function(){this.doc=new _().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(V,me,Oe,Pe){var ne=this.doc,de=ne.createElementNS(V,Oe||me),ce=Pe.length;le(this,de),this.currentElement=de,this.locator&&P(this.locator,de);for(var Ae=0;Ae<ce;Ae++){var V=Pe.getURI(Ae),Me=Pe.getValue(Ae),Oe=Pe.getQName(Ae),Y=ne.createAttributeNS(V,Oe);this.locator&&P(Pe.getLocator(Ae),Y),Y.value=Y.nodeValue=Me,de.setAttributeNode(Y)}},endElement:function(V,me,Oe){var Pe=this.currentElement;Pe.tagName,this.currentElement=Pe.parentNode},startPrefixMapping:function(V,me){},endPrefixMapping:function(V){},processingInstruction:function(V,me){var Oe=this.doc.createProcessingInstruction(V,me);this.locator&&P(this.locator,Oe),le(this,Oe)},ignorableWhitespace:function(V,me,Oe){},characters:function(V,me,Oe){if(V=ie.apply(this,arguments),V){if(this.cdata)var Pe=this.doc.createCDATASection(V);else var Pe=this.doc.createTextNode(V);this.currentElement?this.currentElement.appendChild(Pe):/^\s*$/.test(V)&&this.doc.appendChild(Pe),this.locator&&P(this.locator,Pe)}},skippedEntity:function(V){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(V){(this.locator=V)&&(V.lineNumber=0)},comment:function(V,me,Oe){V=ie.apply(this,arguments);var Pe=this.doc.createComment(V);this.locator&&P(this.locator,Pe),le(this,Pe)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(V,me,Oe){var Pe=this.doc.implementation;if(Pe&&Pe.createDocumentType){var ne=Pe.createDocumentType(V,me,Oe);this.locator&&P(this.locator,ne),le(this,ne),this.doc.doctype=ne}},warning:function(V){console.warn("[xmldom warning]	"+V,q(this.locator))},error:function(V){console.error("[xmldom error]	"+V,q(this.locator))},fatalError:function(V){throw new w(V,this.locator)}};function q(V){if(V)return`
@`+(V.systemId||"")+"#[line:"+V.lineNumber+",col:"+V.columnNumber+"]"}function ie(V,me,Oe){return typeof V=="string"?V.substr(me,Oe):V.length>=me+Oe||me?new java.lang.String(V,me,Oe)+"":V}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(V){R.prototype[V]=function(){return null}});function le(V,me){V.currentElement?V.currentElement.appendChild(me):V.doc.appendChild(me)}return eu.__DOMHandler=R,eu.normalizeLineEndings=I,eu.DOMParser=A,eu}var M_;function WT(){if(M_)return Qc;M_=1;var i=V0();return Qc.DOMImplementation=i.DOMImplementation,Qc.XMLSerializer=i.XMLSerializer,Qc.DOMParser=HT().DOMParser,Qc}var tu={},O_;function XT(){if(O_)return tu;O_=1,Object.defineProperty(tu,"__esModule",{value:!0}),tu.parseJson=void 0;function i(l){try{var c=JSON.parse(l);return c}catch{return null}}return tu.parseJson=i,tu}var ru={},R_;function YT(){if(R_)return ru;R_=1,Object.defineProperty(ru,"__esModule",{value:!0}),ru.bufferFrom=void 0;function i(l){var c=encodeURIComponent(l),f=c.replace(/%([0-9A-F]{2})/g,function(v,w){return String.fromCharCode("0x"+w)}),_=new Uint8Array(f.length);return Array.prototype.forEach.call(f,function(v,w){_[w]=v.charCodeAt(0)}),_}return ru.bufferFrom=i,ru}var nu={},iu={},N_;function j0(){if(N_)return iu;N_=1,Object.defineProperty(iu,"__esModule",{value:!0}),iu.EventPolyfill=void 0;var i=function(){function l(c,f){this.AT_TARGET=0,this.BUBBLING_PHASE=0,this.CAPTURING_PHASE=0,this.NONE=0,this.type="",this.srcElement=null,this.currentTarget=null,this.eventPhase=0,this.isTrusted=!0,this.composed=!1,this.cancelable=!0,this.defaultPrevented=!1,this.bubbles=!0,this.lengthComputable=!0,this.loaded=0,this.total=0,this.cancelBubble=!1,this.returnValue=!0,this.type=c,this.target=(f==null?void 0:f.target)||null,this.currentTarget=(f==null?void 0:f.currentTarget)||null,this.timeStamp=Date.now()}return l.prototype.composedPath=function(){return[]},l.prototype.initEvent=function(c,f,_){this.type=c,this.bubbles=!!f,this.cancelable=!!_},l.prototype.preventDefault=function(){this.defaultPrevented=!0},l.prototype.stopPropagation=function(){},l.prototype.stopImmediatePropagation=function(){},l}();return iu.EventPolyfill=i,iu}var su={},L_;function JT(){if(L_)return su;L_=1;var i=yt&&yt.__extends||function(){var f=function(_,v){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,o){w.__proto__=o}||function(w,o){for(var I in o)Object.prototype.hasOwnProperty.call(o,I)&&(w[I]=o[I])},f(_,v)};return function(_,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");f(_,v);function w(){this.constructor=_}_.prototype=v===null?Object.create(v):(w.prototype=v.prototype,new w)}}();Object.defineProperty(su,"__esModule",{value:!0}),su.ProgressEventPolyfill=void 0;var l=j0(),c=function(f){i(_,f);function _(v,w){var o=f.call(this,v)||this;return o.lengthComputable=(w==null?void 0:w.lengthComputable)||!1,o.composed=(w==null?void 0:w.composed)||!1,o.loaded=(w==null?void 0:w.loaded)||0,o.total=(w==null?void 0:w.total)||0,o}return _}(l.EventPolyfill);return su.ProgressEventPolyfill=c,su}var F_;function KT(){if(F_)return nu;F_=1,Object.defineProperty(nu,"__esModule",{value:!0}),nu.createEvent=void 0;var i=j0(),l=JT(),c=typeof ProgressEvent<"u";function f(_,v,w){var o=["error","progress","loadstart","loadend","load","timeout","abort"],I=c?ProgressEvent:l.ProgressEventPolyfill,A=o.includes(v)?new I(v,{lengthComputable:!0,loaded:(w==null?void 0:w.loaded)||0,total:(w==null?void 0:w.total)||0}):new i.EventPolyfill(v,{target:_,currentTarget:_});return A}return nu.createEvent=f,nu}var z_;function QT(){if(z_)return Kc;z_=1;var i=yt&&yt.__awaiter||function(le,V,me,Oe){function Pe(ne){return ne instanceof me?ne:new me(function(de){de(ne)})}return new(me||(me=Promise))(function(ne,de){function ce(Y){try{Me(Oe.next(Y))}catch(xe){de(xe)}}function Ae(Y){try{Me(Oe.throw(Y))}catch(xe){de(xe)}}function Me(Y){Y.done?ne(Y.value):Pe(Y.value).then(ce,Ae)}Me((Oe=Oe.apply(le,V||[])).next())})},l=yt&&yt.__generator||function(le,V){var me={label:0,sent:function(){if(ne[0]&1)throw ne[1];return ne[1]},trys:[],ops:[]},Oe,Pe,ne,de;return de={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(de[Symbol.iterator]=function(){return this}),de;function ce(Me){return function(Y){return Ae([Me,Y])}}function Ae(Me){if(Oe)throw new TypeError("Generator is already executing.");for(;me;)try{if(Oe=1,Pe&&(ne=Me[0]&2?Pe.return:Me[0]?Pe.throw||((ne=Pe.return)&&ne.call(Pe),0):Pe.next)&&!(ne=ne.call(Pe,Me[1])).done)return ne;switch(Pe=0,ne&&(Me=[Me[0]&2,ne.value]),Me[0]){case 0:case 1:ne=Me;break;case 4:return me.label++,{value:Me[1],done:!1};case 5:me.label++,Pe=Me[1],Me=[0];continue;case 7:Me=me.ops.pop(),me.trys.pop();continue;default:if(ne=me.trys,!(ne=ne.length>0&&ne[ne.length-1])&&(Me[0]===6||Me[0]===2)){me=0;continue}if(Me[0]===3&&(!ne||Me[1]>ne[0]&&Me[1]<ne[3])){me.label=Me[1];break}if(Me[0]===6&&me.label<ne[1]){me.label=ne[1],ne=Me;break}if(ne&&me.label<ne[2]){me.label=ne[2],me.ops.push(Me);break}ne[2]&&me.ops.pop(),me.trys.pop();continue}Me=V.call(le,me)}catch(Y){Me=[6,Y],Pe=0}finally{Oe=ne=0}if(Me[0]&5)throw Me[1];return{value:Me[0]?Me[1]:void 0,done:!0}}},c=yt&&yt.__values||function(le){var V=typeof Symbol=="function"&&Symbol.iterator,me=V&&le[V],Oe=0;if(me)return me.call(le);if(le&&typeof le.length=="number")return{next:function(){return le&&Oe>=le.length&&(le=void 0),{value:le&&le[Oe++],done:!le}}};throw new TypeError(V?"Object is not iterable.":"Symbol.iterator is not defined.")},f=yt&&yt.__read||function(le,V){var me=typeof Symbol=="function"&&le[Symbol.iterator];if(!me)return le;var Oe=me.call(le),Pe,ne=[],de;try{for(;(V===void 0||V-- >0)&&!(Pe=Oe.next()).done;)ne.push(Pe.value)}catch(ce){de={error:ce}}finally{try{Pe&&!Pe.done&&(me=Oe.return)&&me.call(Oe)}finally{if(de)throw de.error}}return ne};Object.defineProperty(Kc,"__esModule",{value:!0}),Kc.createXMLHttpRequestOverride=void 0;var _=lu(),v=ls,w=WT(),o=XT(),I=$0(),A=YT(),L=KT(),R=Gh(),P=qh(),q=mf(),ie=function(le){var V,me=le.XMLHttpRequest,Oe=le.emitter,Pe=le.log;return V=function(){function ne(){this._events=[],this.log=Pe,this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.onreadystatechange=null,this.onabort=null,this.onerror=null,this.onload=null,this.onloadend=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.url="",this.method="GET",this.readyState=this.UNSENT,this.withCredentials=!1,this.status=200,this.statusText="OK",this.response="",this.responseType="text",this.responseText="",this.responseXML=null,this.responseURL="",this.upload={},this.timeout=0,this._requestHeaders=new v.Headers,this._responseHeaders=new v.Headers}return ne.prototype.setReadyState=function(de){de!==this.readyState&&(this.log("readyState change %d -> %d",this.readyState,de),this.readyState=de,de!==this.UNSENT&&(this.log("triggering readystate change..."),this.trigger("readystatechange")))},ne.prototype.trigger=function(de,ce){var Ae,Me;this.log('trigger "%s" (%d)',de,this.readyState),this.log('resolve listener for event "%s"',de);var Y=this["on"+de];Y==null||Y.call(this,L.createEvent(this,de,ce));try{for(var xe=c(this._events),Ge=xe.next();!Ge.done;Ge=xe.next()){var Ye=Ge.value;Ye.name===de&&(Pe('calling mock event listener "%s" (%d)',de,this.readyState),Ye.listener.call(this,L.createEvent(this,de,ce)))}}catch(ct){Ae={error:ct}}finally{try{Ge&&!Ge.done&&(Me=xe.return)&&Me.call(xe)}finally{if(Ae)throw Ae.error}}return this},ne.prototype.reset=function(){this.log("reset"),this.setReadyState(this.UNSENT),this.status=200,this.statusText="OK",this.response=null,this.responseText=null,this.responseXML=null,this._requestHeaders=new v.Headers,this._responseHeaders=new v.Headers},ne.prototype.open=function(de,ce,Ae,Me,Y){return Ae===void 0&&(Ae=!0),i(this,void 0,void 0,function(){return l(this,function(xe){return this.log=this.log.extend("request "+de+" "+ce),this.log("open",{method:de,url:ce,async:Ae,user:Me,password:Y}),this.reset(),this.setReadyState(this.OPENED),typeof ce>"u"?(this.url=de,this.method="GET"):(this.url=ce,this.method=de,this.async=Ae,this.user=Me,this.password=Y),[2]})})},ne.prototype.send=function(de){var ce=this;this.log("send %s %s",this.method,this.url);var Ae;typeof de=="string"?Ae=P.encodeBuffer(de):Ae=de||new ArrayBuffer(0);var Me;try{Me=new URL(this.url)}catch{Me=new URL(this.url,window.location.href)}this.log("request headers",this._requestHeaders);var Y=new R.IsomorphicRequest(Me,{body:Ae,method:this.method,headers:this._requestHeaders,credentials:this.withCredentials?"include":"omit"}),xe=new q.InteractiveIsomorphicRequest(Y);this.log('emitting the "request" event for %d listener(s)...',Oe.listenerCount("request")),Oe.emit("request",xe),this.log("awaiting mocked response..."),Promise.resolve(_.until(function(){return i(ce,void 0,void 0,function(){var Ge,Ye;return l(this,function(ct){switch(ct.label){case 0:return[4,Oe.untilIdle("request",function(wt){var Et=f(wt.args,1),Dt=Et[0];return Dt.id===xe.id})];case 1:return ct.sent(),this.log("all request listeners have been resolved!"),[4,xe.respondWith.invoked()];case 2:return Ge=f.apply(void 0,[ct.sent(),1]),Ye=Ge[0],this.log("event.respondWith called with:",Ye),[2,Ye]}})})})).then(function(Ge){var Ye,ct,wt=f(Ge,2),Et=wt[0],Dt=wt[1];if(Et){ce.log("middleware function threw an exception!",Et),ce.trigger("error"),ce.abort();return}if(Dt){if(ce.log("received mocked response",Dt),ce.trigger("loadstart"),ce.status=(Ye=Dt.status)!==null&&Ye!==void 0?Ye:200,ce.statusText=Dt.statusText||"OK",ce._responseHeaders=Dt.headers?v.objectToHeaders(Dt.headers):new v.Headers,ce.log("set response status",ce.status,ce.statusText),ce.log("set response headers",ce._responseHeaders),ce.setReadyState(ce.HEADERS_RECEIVED),ce.log("response type",ce.responseType),ce.response=ce.getResponseBody(Dt.body),ce.responseURL=ce.url,ce.responseText=Dt.body||"",ce.responseXML=ce.getResponseXML(),ce.log("set response body",ce.response),Dt.body&&ce.response){ce.setReadyState(ce.LOADING);var ht=A.bufferFrom(Dt.body);ce.trigger("progress",{loaded:ht.length,total:ht.length})}ce.setReadyState(ce.DONE),ce.trigger("load"),ce.trigger("loadend"),Oe.emit("response",Y,I.toIsoResponse(Dt))}else{ce.log("no mocked response received!");var et=new me;ce.log("opening an original request %s %s",ce.method,ce.url),et.open(ce.method,ce.url,(ct=ce.async)!==null&&ct!==void 0?ct:!0,ce.user,ce.password),et.addEventListener("load",function(){ce.log('original "onload"'),ce.status=et.status,ce.statusText=et.statusText,ce.responseURL=et.responseURL,ce.responseType=et.responseType,ce.response=et.response,ce.responseText=et.responseText,ce.responseXML=et.responseXML,ce.log("set mock request readyState to DONE"),ce.setReadyState(ce.DONE),ce.log("received original response",ce.status,ce.statusText),ce.log("original response body:",ce.response);var ft=et.getAllResponseHeaders();ce.log(`original response headers:
`,ft),ce._responseHeaders=v.stringToHeaders(ft),ce.log("original response headers (normalized)",ce._responseHeaders),ce.log("original response finished"),Oe.emit("response",Y,{status:et.status,statusText:et.statusText,headers:ce._responseHeaders,body:et.response})}),ce.propagateCallbacks(et),ce.propagateListeners(et),ce.propagateHeaders(et,ce._requestHeaders),ce.async&&(et.timeout=ce.timeout),ce.log("send",de),et.send(de)}})},ne.prototype.abort=function(){this.log("abort"),this.readyState>this.UNSENT&&this.readyState<this.DONE&&(this.setReadyState(this.UNSENT),this.trigger("abort"))},ne.prototype.dispatchEvent=function(){return!1},ne.prototype.setRequestHeader=function(de,ce){this.log('set request header "%s" to "%s"',de,ce),this._requestHeaders.append(de,ce)},ne.prototype.getResponseHeader=function(de){if(this.log('get response header "%s"',de),this.readyState<this.HEADERS_RECEIVED)return this.log("cannot return a header: headers not received (state: %s)",this.readyState),null;var ce=this._responseHeaders.get(de);return this.log('resolved response header "%s" to "%s"',de,ce,this._responseHeaders),ce},ne.prototype.getAllResponseHeaders=function(){return this.log("get all response headers"),this.readyState<this.HEADERS_RECEIVED?(this.log("cannot return headers: headers not received (state: %s)",this.readyState),""):v.headersToString(this._responseHeaders)},ne.prototype.addEventListener=function(de,ce){this.log("addEventListener",de,ce),this._events.push({name:de,listener:ce})},ne.prototype.removeEventListener=function(de,ce){this.log("removeEventListener",de,ce),this._events=this._events.filter(function(Ae){return Ae.name!==de&&Ae.listener!==ce})},ne.prototype.overrideMimeType=function(){},ne.prototype.getResponseBody=function(de){var ce=de??"";switch(this.log("coerced response body to",ce),this.responseType){case"json":return this.log("resolving response body as JSON"),o.parseJson(ce);case"blob":{var Ae=this.getResponseHeader("content-type")||"text/plain";return this.log("resolving response body as Blob",{type:Ae}),new Blob([ce],{type:Ae})}case"arraybuffer":{this.log("resolving response body as ArrayBuffer");var Me=A.bufferFrom(ce);return Me}default:return ce}},ne.prototype.getResponseXML=function(){var de=this.getResponseHeader("Content-Type");return de==="application/xml"||de==="text/xml"?new w.DOMParser().parseFromString(this.responseText,de):null},ne.prototype.propagateCallbacks=function(de){var ce,Ae;this.log("propagating request callbacks to the original request");var Me=["abort","onerror","ontimeout","onload","onloadstart","onloadend","onprogress","onreadystatechange"];try{for(var Y=c(Me),xe=Y.next();!xe.done;xe=Y.next()){var Ge=xe.value,Ye=this[Ge];Ye&&(de[Ge]=this[Ge],this.log('propagated the "%s" callback',Ge,Ye))}}catch(ct){ce={error:ct}}finally{try{xe&&!xe.done&&(Ae=Y.return)&&Ae.call(Y)}finally{if(ce)throw ce.error}}de.onabort=this.abort,de.onerror=this.onerror,de.ontimeout=this.ontimeout,de.onload=this.onload,de.onloadstart=this.onloadstart,de.onloadend=this.onloadend,de.onprogress=this.onprogress,de.onreadystatechange=this.onreadystatechange},ne.prototype.propagateListeners=function(de){this.log("propagating request listeners (%d) to the original request",this._events.length,this._events),this._events.forEach(function(ce){var Ae=ce.name,Me=ce.listener;de.addEventListener(Ae,Me)})},ne.prototype.propagateHeaders=function(de,ce){var Ae=this;this.log("propagating request headers to the original request",ce),Object.entries(ce.raw()).forEach(function(Me){var Y=f(Me,2),xe=Y[0],Ge=Y[1];Ae.log('setting "%s" (%s) header on the original request',xe,Ge),de.setRequestHeader(xe,Ge)})},ne}(),V.UNSENT=0,V.OPENED=1,V.HEADERS_RECEIVED=2,V.LOADING=3,V.DONE=4,V};return Kc.createXMLHttpRequestOverride=ie,Kc}var B_;function eS(){if(B_)return Jc;B_=1;var i=yt&&yt.__extends||function(){var w=function(o,I){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,L){A.__proto__=L}||function(A,L){for(var R in L)Object.prototype.hasOwnProperty.call(L,R)&&(A[R]=L[R])},w(o,I)};return function(o,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");w(o,I);function A(){this.constructor=o}o.prototype=I===null?Object.create(I):(A.prototype=I.prototype,new A)}}();Object.defineProperty(Jc,"__esModule",{value:!0}),Jc.XMLHttpRequestInterceptor=void 0;var l=la(),c=hf(),f=Uh(),_=QT(),v=function(w){i(o,w);function o(){return w.call(this,o.symbol)||this}return o.prototype.checkEnvironment=function(){return typeof window<"u"&&typeof window.XMLHttpRequest<"u"},o.prototype.setup=function(){var I=this.log.extend("setup");I('patching "XMLHttpRequest" module...');var A=window.XMLHttpRequest;l.invariant(!A[c.IS_PATCHED_MODULE],'Failed to patch the "XMLHttpRequest" module: already patched.'),window.XMLHttpRequest=_.createXMLHttpRequestOverride({XMLHttpRequest:A,emitter:this.emitter,log:this.log}),I('native "XMLHttpRequest" module patched!',window.XMLHttpRequest.name),Object.defineProperty(window.XMLHttpRequest,c.IS_PATCHED_MODULE,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push(function(){Object.defineProperty(window.XMLHttpRequest,c.IS_PATCHED_MODULE,{value:void 0}),window.XMLHttpRequest=A,I('native "XMLHttpRequest" module restored!',window.XMLHttpRequest.name)})},o.symbol=Symbol("xhr"),o}(f.Interceptor);return Jc.XMLHttpRequestInterceptor=v,Jc}var Xd={},ou={},au={},U_;function q0(){if(U_)return au;U_=1,Object.defineProperty(au,"__esModule",{value:!0}),au.MemoryLeakError=void 0;let i=class extends Error{constructor(f,_,v){super(`Possible EventEmitter memory leak detected. ${v} ${_.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`);aa(this,"emitter");aa(this,"type");aa(this,"count");this.emitter=f,this.type=_,this.count=v,this.name="MaxListenersExceededWarning"}};return au.MemoryLeakError=i,au}var $_;function tS(){var c;if($_)return ou;$_=1,Object.defineProperty(ou,"__esModule",{value:!0}),ou.Emitter=void 0;const i=q0();let l=(c=class{constructor(){aa(this,"events");aa(this,"maxListeners");aa(this,"hasWarnedAboutPotentialMemortyLeak");this.events=new Map,this.maxListeners=l.defaultMaxListeners,this.hasWarnedAboutPotentialMemortyLeak=!1}static listenerCount(_,v){return _.listenerCount(v)}_emitInternalEvent(_,v,w){this.emit(_,v,w)}_getListeners(_){return this.events.get(_)||[]}_removeListener(_,v){const w=_.indexOf(v);return w>-1&&_.splice(w,1),[]}_wrapOnceListener(_,v){const w=(...o)=>{this.removeListener(_,w),v.apply(this,o)};return w}setMaxListeners(_){return this.maxListeners=_,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(_,...v){const w=this._getListeners(_);return w.forEach(o=>{o.apply(this,v)}),w.length>0}addListener(_,v){this._emitInternalEvent("newListener",_,v);const w=this._getListeners(_).concat(v);if(this.events.set(_,w),this.maxListeners>0&&this.listenerCount(_)>this.maxListeners&&!this.hasWarnedAboutPotentialMemortyLeak){this.hasWarnedAboutPotentialMemortyLeak=!0;const o=new i.MemoryLeakError(this,_,this.listenerCount(_));console.warn(o)}return this}on(_,v){return this.addListener(_,v)}once(_,v){return this.addListener(_,this._wrapOnceListener(_,v))}prependListener(_,v){const w=this._getListeners(_);if(w.length>0){const o=[v].concat(w);this.events.set(_,o)}else this.events.set(_,w.concat(v));return this}prependOnceListener(_,v){return this.prependListener(_,this._wrapOnceListener(_,v))}removeListener(_,v){const w=this._getListeners(_);return w.length>0&&(this._removeListener(w,v),this.events.set(_,w),this._emitInternalEvent("removeListener",_,v)),this}off(_,v){return this.removeListener(_,v)}removeAllListeners(_){return _?this.events.delete(_):this.events.clear(),this}listeners(_){return Array.from(this._getListeners(_))}listenerCount(_){return this._getListeners(_).length}rawListeners(_){return this.listeners(_)}},aa(c,"defaultMaxListeners",10),c);return ou.Emitter=l,ou}var V_;function rS(){return V_||(V_=1,function(i){var l=yt&&yt.__createBinding||(Object.create?function(f,_,v,w){w===void 0&&(w=v);var o=Object.getOwnPropertyDescriptor(_,v);(!o||("get"in o?!_.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return _[v]}}),Object.defineProperty(f,w,o)}:function(f,_,v,w){w===void 0&&(w=v),f[w]=_[v]}),c=yt&&yt.__exportStar||function(f,_){for(var v in f)v!=="default"&&!Object.prototype.hasOwnProperty.call(_,v)&&l(_,f,v)};Object.defineProperty(i,"__esModule",{value:!0}),c(tS(),i),c(q0(),i)}(Xd)),Xd}var Yd,j_;function uS(){if(j_)return Yd;j_=1;var i=Object.create,l=Object.defineProperty,c=Object.defineProperties,f=Object.getOwnPropertyDescriptor,_=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertyNames,w=Object.getOwnPropertySymbols,o=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,L=(z,J,ye)=>J in z?l(z,J,{enumerable:!0,configurable:!0,writable:!0,value:ye}):z[J]=ye,R=(z,J)=>{for(var ye in J||(J={}))I.call(J,ye)&&L(z,ye,J[ye]);if(w)for(var ye of w(J))A.call(J,ye)&&L(z,ye,J[ye]);return z},P=(z,J)=>c(z,_(J)),q=(z,J)=>{var ye={};for(var Re in z)I.call(z,Re)&&J.indexOf(Re)<0&&(ye[Re]=z[Re]);if(z!=null&&w)for(var Re of w(z))J.indexOf(Re)<0&&A.call(z,Re)&&(ye[Re]=z[Re]);return ye},ie=(z,J)=>{for(var ye in J)l(z,ye,{get:J[ye],enumerable:!0})},le=(z,J,ye,Re)=>{if(J&&typeof J=="object"||typeof J=="function")for(let ze of v(J))!I.call(z,ze)&&ze!==ye&&l(z,ze,{get:()=>J[ze],enumerable:!(Re=f(J,ze))||Re.enumerable});return z},V=(z,J,ye)=>(ye=z!=null?i(o(z)):{},le(J||!z||!z.__esModule?l(ye,"default",{value:z,enumerable:!0}):ye,z)),me=z=>le(l({},"__esModule",{value:!0}),z),Oe={};ie(Oe,{GraphQLHandler:()=>pr,MockedRequest:()=>Ji,RESTMethods:()=>Vo,RequestHandler:()=>ro,RestHandler:()=>jo,SetupApi:()=>La,cleanUrl:()=>to,compose:()=>Pa,context:()=>Pe,createResponseComposition:()=>ka,defaultContext:()=>_s,defaultResponse:()=>ys,graphql:()=>wl,graphqlContext:()=>bs,handleRequest:()=>so,matchRequestUrl:()=>Ns,response:()=>cl,rest:()=>bl,restContext:()=>vs,setupWorker:()=>xl}),Yd=me(Oe);var Pe={};ie(Pe,{body:()=>Te,cookie:()=>he,data:()=>kt,delay:()=>pn,errors:()=>Ir,extensions:()=>At,fetch:()=>fs,json:()=>Ct,set:()=>Ie,status:()=>se,text:()=>tl,xml:()=>xr});var ne="Continue",de="Switching Protocols",ce="Processing",Ae="Early Hints",Me="OK",Y="Created",xe="Accepted",Ge="Non-Authoritative Information",Ye="No Content",ct="Reset Content",wt="Partial Content",Et="Multi-Status",Dt="Already Reported",ht="IM Used",et="Multiple Choices",ft="Moved Permanently",Ut="Found",mt="See Other",Q="Not Modified",we="Use Proxy",Ee="Temporary Redirect",je="Permanent Redirect",St="Bad Request",Mt="Unauthorized",ot="Payment Required",It="Forbidden",jt="Not Found",Qt="Method Not Allowed",Yt="Not Acceptable",hn="Proxy Authentication Required",gr="Request Timeout",sn="Conflict",Sr="Gone",An="Length Required",Dn="Precondition Failed",Xe="Payload Too Large",$e="URI Too Long",Jt="Unsupported Media Type",wr="Range Not Satisfiable",ur="Expectation Failed",sr="I'm a Teapot",Nn="Misdirected Request",Ii="Unprocessable Entity",Ln="Locked",ds="Failed Dependency",Ri="Too Early",oi="Upgrade Required",ai="Precondition Required",it="Too Many Requests",jn="Request Header Fields Too Large",Pr="Unavailable For Legal Reasons",Ai="Internal Server Error",qn="Not Implemented",nt="Bad Gateway",Xt="Service Unavailable",Ht="Gateway Timeout",on="HTTP Version Not Supported",Z="Variant Also Negotiates",H="Insufficient Storage",_e="Loop Detected",$="Bandwidth Limit Exceeded",O="Not Extended",B="Network Authentication Required",X={100:ne,101:de,102:ce,103:Ae,200:Me,201:Y,202:xe,203:Ge,204:Ye,205:ct,206:wt,207:Et,208:Dt,226:ht,300:et,301:ft,302:Ut,303:mt,304:Q,305:we,307:Ee,308:je,400:St,401:Mt,402:ot,403:It,404:jt,405:Qt,406:Yt,407:hn,408:gr,409:sn,410:Sr,411:An,412:Dn,413:Xe,414:$e,415:Jt,416:wr,417:ur,418:sr,421:Nn,422:Ii,423:Ln,424:ds,425:Ri,426:oi,428:ai,429:it,431:jn,451:Pr,500:Ai,501:qn,502:nt,503:Xt,504:Ht,505:on,506:Z,507:H,508:_e,509:$,510:O,511:B},se=(z,J)=>ye=>(ye.status=z,ye.statusText=J||X[String(z)],ye),ae=ls;function Ie(...z){return J=>{const[ye,Re]=z;return typeof ye=="string"?J.headers.append(ye,Re):(0,ae.objectToHeaders)(ye).forEach((at,Tt)=>{J.headers.append(Tt,at)}),J}}var ve=V(td()),he=(z,J,ye)=>Re=>{const ze=ve.serialize(z,J,ye);return Re.headers.append("Set-Cookie",ze),typeof document<"u"&&(document.cookie=ze),Re},Te=z=>J=>(J.body=z,J);function Ue(z){try{return JSON.parse(z)}catch{return}}function Ve(z){return z!=null&&typeof z=="object"&&!Array.isArray(z)}function qe(z,J){return Object.entries(J).reduce((ye,[Re,ze])=>{const at=ye[Re];return Array.isArray(at)&&Array.isArray(ze)?(ye[Re]=at.concat(ze),ye):Ve(at)&&Ve(ze)?(ye[Re]=qe(at,ze),ye):(ye[Re]=ze,ye)},Object.assign({},z))}var Ct=z=>J=>(J.headers.set("Content-Type","application/json"),J.body=JSON.stringify(z),J),kt=z=>J=>{const ye=Ue(J.body)||{},Re=qe(ye,{data:z});return Ct(Re)(J)},At=z=>J=>{const ye=Ue(J.body)||{},Re=qe(ye,{extensions:z});return Ct(Re)(J)},Ot=zl,Zt=2147483647,yr=100,Tr=400,hr=5,or=()=>(0,Ot.isNodeProcess)()?hr:Math.floor(Math.random()*(Tr-yr)+yr),pn=z=>J=>{let ye;if(typeof z=="string")switch(z){case"infinite":{ye=Zt;break}case"real":{ye=or();break}default:throw new Error(`Failed to delay a response: unknown delay mode "${z}". Please make sure you provide one of the supported modes ("real", "infinite") or a number to "ctx.delay".`)}else if(typeof z>"u")ye=or();else{if(z>Zt)throw new Error(`Failed to delay a response: provided delay duration (${z}) exceeds the maximum allowed duration for "setTimeout" (${Zt}). This will cause the response to be returned immediately. Please use a number within the allowed range to delay the response by exact duration, or consider the "infinite" delay mode to delay the response indefinitely.`);ye=z}return J.delay=ye,J},Ir=z=>J=>{if(z==null)return J;const ye=Ue(J.body)||{},Re=qe(ye,{errors:z});return Ct(Re)(J)},Yr=zl,dn=ls,Gn=(0,Yr.isNodeProcess)()?(z,J)=>Promise.resolve().then(()=>V(hw())).then(({default:ye})=>ye(z,J)):globalThis.fetch,ga=z=>{const J=new dn.Headers(z.headers);return J.set("x-msw-bypass","true"),P(R({},z),{headers:J.all()})},Rs=z=>{const{body:J,method:ye}=z,Re=P(R({},z),{body:void 0});return["GET","HEAD"].includes(ye)||(typeof J=="object"||typeof J=="number"||typeof J=="boolean"?Re.body=JSON.stringify(J):Re.body=J),Re},fs=(z,J={})=>{if(typeof z=="string")return Gn(z,ga(J));const ye=Rs(z),Re=ga(ye);return Gn(z.url.href,Re)},tl=z=>J=>(J.headers.set("Content-Type","text/plain"),J.body=z,J),xr=z=>J=>(J.headers.set("Content-Type","text/xml"),J.body=z,J),ya=la(),ko=zl,Tn=lu(),Zn=lu(),_a=(z,J,ye)=>[z.active,z.installing,z.waiting].filter(Boolean).find(Tt=>ye(Tt.scriptURL,J))||null;function li(z){return new URL(z,location.href).href}var fn=la(),Mo="[MSW]";function Xi(z,...J){const ye=(0,fn.format)(z,...J);return`${Mo} ${ye}`}function Nr(z,...J){console.warn(Xi(z,...J))}function _r(z,...J){console.error(Xi(z,...J))}var mr={formatMessage:Xi,warn:Nr,error:_r},Vr=async(z,J={},ye)=>{const Re=li(z),ze=await navigator.serviceWorker.getRegistrations().then(Ft=>Ft.filter(Ar=>_a(Ar,Re,ye)));!navigator.serviceWorker.controller&&ze.length>0&&location.reload();const[at]=ze;if(at)return at.update().then(()=>[_a(at,Re,ye),at]);const[Tt,gt]=await(0,Zn.until)(async()=>{const Ft=await navigator.serviceWorker.register(z,J);return[_a(Ft,Re,ye),Ft]});if(Tt){if(Tt.message.includes("(404)")){const Ar=new URL((J==null?void 0:J.scope)||"/",location.href);throw new Error(mr.formatMessage(`Failed to register a Service Worker for scope ('${Ar.href}') with script ('${Re}'): Service Worker script does not exist at the given path.

Did you forget to run "npx msw init <PUBLIC_DIR>"?

Learn more about creating the Service Worker script: https://mswjs.io/docs/cli/init`))}throw new Error(mr.formatMessage(`Failed to register the Service Worker:

%s`,Tt.message))}return gt};function Ys(z={}){if(z.quiet)return;const J=z.message||"Mocking enabled.";console.groupCollapsed(`%c${mr.formatMessage(J)}`,"color:orangered;font-weight:bold;"),console.log("%cDocumentation: %chttps://mswjs.io/docs","font-weight:bold","font-weight:normal"),console.log("Found an issue? https://github.com/mswjs/msw/issues"),z.workerUrl&&console.log("Worker script URL:",z.workerUrl),z.workerScope&&console.log("Worker scope:",z.workerScope),console.groupEnd()}async function ci(z,J){var ye,Re;if(z.workerChannel.send("MOCK_ACTIVATE"),await z.events.once("MOCKING_ENABLED"),z.isMockingEnabled){mr.warn('Found a redundant "worker.start()" call. Note that starting the worker while mocking is already enabled will have no effect. Consider removing this "worker.start()" call.');return}z.isMockingEnabled=!0,Ys({quiet:J.quiet,workerScope:(ye=z.registration)==null?void 0:ye.scope,workerUrl:(Re=z.worker)==null?void 0:Re.scriptURL})}var va=class{constructor(z){this.port=z}postMessage(z,...J){const[ye,Re]=J;this.port.postMessage({type:z,data:ye},{transfer:Re})}},Ni=class extends Error{constructor(z){super(z),this.name="NetworkError"}},rl=yh(),xa=ls,Oo=V(td()),Js=e_(),Yi=yh(),ba=qh(),Ks=ls,nl=V(td());function il(){return nl.parse(document.cookie)}function wa(z){if(typeof document>"u"||typeof location>"u")return{};switch(z.credentials){case"same-origin":return location.origin===z.url.origin?il():{};case"include":return il();default:return{}}}var Ea=ls;function sl(z){var J,ye;const Re=(0,Ea.stringToHeaders)(z),ze=Re.get("content-type")||"text/plain",at=Re.get("content-disposition");if(!at)throw new Error('"Content-Disposition" header is required.');const Tt=at.split(";").reduce((Ar,Jr)=>{const[Jn,...ui]=Jr.trim().split("=");return Ar[Jn]=ui.join("="),Ar},{}),gt=(J=Tt.name)==null?void 0:J.slice(1,-1),Ft=(ye=Tt.filename)==null?void 0:ye.slice(1,-1);return{name:gt,filename:Ft,contentType:ze}}function Yl(z,J){const ye=J==null?void 0:J.get("content-type");if(!ye)return;const[,...Re]=ye.split(/; */),ze=Re.filter(Ft=>Ft.startsWith("boundary=")).map(Ft=>Ft.replace(/^boundary=/,""))[0];if(!ze)return;const at=new RegExp(`--+${ze}`),Tt=z.split(at).filter(Ft=>Ft.startsWith(`\r
`)&&Ft.endsWith(`\r
`)).map(Ft=>Ft.trimStart().replace(/\r\n$/,""));if(!Tt.length)return;const gt={};try{for(const Ft of Tt){const[Ar,...Jr]=Ft.split(`\r
\r
`),Jn=Jr.join(`\r
\r
`),{contentType:ui,filename:Kn,name:Gr}=sl(Ar),bt=Kn===void 0?Jn:new File([Jn],Kn,{type:ui}),Di=gt[Gr];Di===void 0?gt[Gr]=bt:Array.isArray(Di)?gt[Gr]=[...Di,bt]:gt[Gr]=[Di,bt]}return gt}catch{return}}function Ta(z,J){var ye;if(!z)return z;const Re=((ye=J==null?void 0:J.get("content-type"))==null?void 0:ye.toLowerCase())||"";return Re.startsWith("multipart/form-data")&&typeof z!="object"?Yl(z.toString(),J)||z:Re.includes("json")&&typeof z!="object"&&Ue(z.toString())||z}function Ro(z,J){return z.toLowerCase()===J.toLowerCase()}var Ji=class extends Yi.IsomorphicRequest{constructor(z,J={}){super(z,J),J.id&&(this.id=J.id),this.cache=J.cache||"default",this.destination=J.destination||"",this.integrity=J.integrity||"",this.keepalive=J.keepalive||!1,this.mode=J.mode||"cors",this.priority=J.priority||"auto",this.redirect=J.redirect||"follow",this.referrer=J.referrer||"",this.referrerPolicy=J.referrerPolicy||"no-referrer",this.cookies=J.cookies||this.getCookies()}get body(){const z=(0,ba.decodeBuffer)(this._body),J=Ta(z,this.headers);if(!(Ro(this.method,"GET")&&J===""))return J}passthrough(){return{status:101,statusText:"Continue",headers:new Ks.Headers,body:null,passthrough:!0,once:!1}}getCookies(){var z;const J=this.headers.get("cookie"),ye=J?Oo.parse(J):{};Js.store.hydrate();const Re=Array.from((z=Js.store.get(P(R({},this),{url:this.url.href})))==null?void 0:z.entries()).reduce((Tt,[gt,{value:Ft}])=>Object.assign(Tt,{[gt.trim()]:Ft}),{}),ze=wa(this),at=R(R({},ze),Re);for(const[Tt,gt]of Object.entries(at))this.headers.append("cookie",`${Tt}=${gt}`);return R(R({},at),ye)}};function ol(z){const J=new URL(z.url),ye=new xa.Headers(z.headers);return new Ji(J,P(R({},z),{body:(0,rl.encodeBuffer)(z.body||""),headers:ye}))}var al=lu(),Sa=async(z,J,ye)=>{const Re=J.filter(at=>at.test(z,ye));if(Re.length===0)return{handler:void 0,response:void 0};const ze=await Re.reduce(async(at,Tt)=>{const gt=await at;if(gt!=null&&gt.response)return at;const Ft=await Tt.run(z,ye);return Ft===null||Ft.handler.shouldSkip?null:Ft.response?(Ft.response.once&&Tt.markAsSkipped(!0),Ft):{request:Ft.request,handler:Ft.handler,response:void 0,parsedResult:Ft.parsedResult}},Promise.resolve(null));return ze?{handler:ze.handler,publicRequest:ze.request,parsedRequest:ze.parsedResult,response:ze.response}:{handler:void 0,response:void 0}},No=V(Ww()),ms=NT,Ki=z=>z.referrer.startsWith(z.url.origin)?z.url.pathname:new URL(z.url.pathname,`${z.url.protocol}//${z.url.host}`).href;function Hn(z){var J;const ye=z.definitions.find(Re=>Re.kind==="OperationDefinition");return{operationType:ye==null?void 0:ye.operation,operationName:(J=ye==null?void 0:ye.name)==null?void 0:J.value}}function Lo(z){try{const J=(0,ms.parse)(z);return Hn(J)}catch(J){return J}}function Fo(z,J,ye){const Re={variables:z};for(const[ze,at]of Object.entries(J)){if(!(ze in ye))throw new Error(`Given files do not have a key '${ze}' .`);for(const Tt of at){const[gt,...Ft]=Tt.split(".").reverse(),Ar=Ft.reverse();let Jr=Re;for(const Jn of Ar){if(!(Jn in Jr))throw new Error(`Property '${Ar}' is not in operations.`);Jr=Jr[Jn]}Jr[gt]=ye[ze]}}return Re.variables}function Qs(z){var J,ye;switch(z.method){case"GET":{const Re=z.url.searchParams.get("query"),ze=z.url.searchParams.get("variables")||"";return{query:Re,variables:Ue(ze)}}case"POST":{if((J=z.body)!=null&&J.query){const{query:Re,variables:ze}=z.body;return{query:Re,variables:ze}}if((ye=z.body)!=null&&ye.operations){const Re=z.body,{operations:ze,map:at}=Re,Tt=q(Re,["operations","map"]),gt=Ue(ze)||{};if(!gt.query)return null;const Ft=Ue(at||"")||{},Ar=gt.variables?Fo(gt.variables,Ft,Tt):{};return{query:gt.query,variables:Ar}}}default:return null}}function eo(z){const J=Qs(z);if(!J||!J.query)return;const{query:ye,variables:Re}=J,ze=Lo(ye);if(ze instanceof Error){const at=Ki(z);throw new Error(mr.formatMessage(`Failed to intercept a GraphQL request to "%s %s": cannot parse query. See the error message from the parser below.

%s`,z.method,at,ze.message))}return{operationType:ze.operationType,operationName:ze.operationName,variables:Re}}function gs(z){return z<300?"#69AB32":z<400?"#F0BB4B":"#E95F5D"}function Li(){const z=new Date;return[z.getHours(),z.getMinutes(),z.getSeconds()].map(String).map(J=>J.slice(0,2)).map(J=>J.padStart(2,"0")).join(":")}function rr(z){return P(R({},z),{body:z.body,headers:z.headers.all()})}var zo=ls;function Fn(z){const J=(0,zo.objectToHeaders)(z.headers);return P(R({},z),{body:Ta(z.body,J)})}var Wn=jT,Ia=ev(),Bo=/[\?|#].*$/g;function Uo(z){return new URL(`/${z}`,"http://localhost").searchParams}function to(z){return z.replace(Bo,"")}function Aa(z){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(z)}function $o(z,J){if(Aa(z)||z.startsWith("*"))return z;const ye=J||typeof document<"u"&&document.baseURI;return ye?decodeURI(new URL(encodeURI(z),ye).href):z}function Da(z,J){if(z instanceof RegExp)return z;const ye=$o(z,J);return to(ye)}function Ca(z){return z.replace(/([:a-zA-Z_-]*)(\*{1,2})+/g,(J,ye,Re)=>{const ze="(.*)";return ye?ye.startsWith(":")?`${ye}${Re}`:`${ye}${ze}`:ze}).replace(/([^\/])(:)(?=\d+)/,"$1\\$2").replace(/^([^\/]+)(:)(?=\/\/)/,"$1\\$2")}function Ns(z,J,ye){const Re=Da(J,ye),ze=typeof Re=="string"?Ca(Re):Re,at=(0,Ia.getCleanUrl)(z),Tt=(0,Wn.match)(ze,{decode:decodeURIComponent})(at),gt=Tt&&Tt.params||{};return{matches:Tt!==!1,params:gt}}var ll=ls;function Pa(...z){return(...J)=>z.reduceRight((ye,Re)=>ye instanceof Promise?Promise.resolve(ye).then(Re):Re(ye),J[0])}var ys={status:200,statusText:"OK",body:null,delay:0,once:!1,passthrough:!1},Jl=[];function ka(z,J=Jl){return async(...ye)=>{const Re=Object.assign({},ys,{headers:new ll.Headers({"x-powered-by":"msw"})},z),ze=[...J,...ye].filter(Boolean);return ze.length>0?Pa(...ze)(Re):Re}}var cl=Object.assign(ka(),{once:ka({once:!0}),networkError(z){throw new Ni(z)}}),Kl=/[\/\\]msw[\/\\]src[\/\\](.+)/,Ql=/(node_modules)?[\/\\]lib[\/\\](umd|esm|iief|cjs)[\/\\]|^[^\/\\]*$/;function ec(z){const J=z.stack;if(!J)return;const Re=J.split(`
`).slice(1).find(at=>!(Kl.test(at)||Ql.test(at)));return Re?Re.replace(/\s*at [^()]*\(([^)]+)\)/,"$1").replace(/^@/,""):void 0}function Ma(z){return z?typeof z[Symbol.iterator]=="function":!1}var _s={status:se,set:Ie,delay:pn,fetch:fs},ro=class{constructor(z){this.shouldSkip=!1,this.ctx=z.ctx||_s,this.resolver=z.resolver;const J=ec(new Error);this.info=P(R({},z.info),{callFrame:J})}parse(z,J){return null}test(z,J){return this.predicate(z,this.parse(z,J),J)}getPublicRequest(z,J){return z}markAsSkipped(z=!0){this.shouldSkip=z}async run(z,J){if(this.shouldSkip)return null;const ye=this.parse(z,J);if(!this.predicate(z,ye,J))return null;const ze=this.getPublicRequest(z,ye),Tt=await this.wrapResolver(this.resolver)(ze,cl,this.ctx);return this.createExecutionResult(ye,ze,Tt)}wrapResolver(z){return async(J,ye,Re)=>{const ze=this.resolverGenerator||await z(J,ye,Re);if(Ma(ze)){const{value:at,done:Tt}=ze[Symbol.iterator]().next(),gt=await at;return!gt&&Tt?this.resolverGeneratorResult:(this.resolverGenerator||(this.resolverGenerator=ze),this.resolverGeneratorResult=gt,gt)}return ze}}createExecutionResult(z,J,ye){return{handler:this,parsedResult:z||null,request:J,response:ye||null}}},Vo=(z=>(z.HEAD="HEAD",z.GET="GET",z.POST="POST",z.PUT="PUT",z.PATCH="PATCH",z.OPTIONS="OPTIONS",z.DELETE="DELETE",z))(Vo||{}),vs=P(R({},_s),{cookie:he,body:Te,text:tl,json:Ct,xml:xr}),ul=class extends Ji{constructor(z,J){super(z.url,P(R({},z),{body:z._body})),this.params=J,this.id=z.id}},jo=class extends ro{constructor(z,J,ye){super({info:{header:`${z} ${J}`,path:J,method:z},ctx:vs,resolver:ye}),this.checkRedundantQueryParameters()}checkRedundantQueryParameters(){const{method:z,path:J}=this.info;if(J instanceof RegExp||to(J)===J)return;Uo(J).forEach((ze,at)=>{}),mr.warn(`Found a redundant usage of query parameters in the request handler URL for "${z} ${J}". Please match against a path instead and access query parameters in the response resolver function using "req.url.searchParams".`)}parse(z,J){return Ns(z.url,this.info.path,J==null?void 0:J.baseUrl)}getPublicRequest(z,J){return new ul(z,J.params||{})}predicate(z,J){return(this.info.method instanceof RegExp?this.info.method.test(z.method):Ro(this.info.method,z.method))&&J.matches}log(z,J){const ye=Ki(z),Re=rr(z),ze=Fn(J),at=gs(J.status);console.groupCollapsed(mr.formatMessage("%s %s %s (%c%s%c)"),Li(),z.method,ye,`color:${at}`,`${J.status} ${J.statusText}`,"color:inherit"),console.log("Request",Re),console.log("Handler:",this),console.log("Response",ze),console.groupEnd()}},Ls=la(),xs=(z,J)=>ye=>{hl(z);const Re=Ue(ye.body)||{},ze=qe(Re,{[z]:J});return Ct(ze)(ye)};function hl(z){(0,Ls.invariant)(z.trim()!=="",mr.formatMessage("Failed to set a custom field on a GraphQL response: field name cannot be empty.")),(0,Ls.invariant)(z!=="data",mr.formatMessage('Failed to set a custom "%s" field on a mocked GraphQL response: forbidden field name. Did you mean to call "ctx.data()" instead?',z)),(0,Ls.invariant)(z!=="errors",mr.formatMessage('Failed to set a custom "%s" field on a mocked GraphQL response: forbidden field name. Did you mean to call "ctx.errors()" instead?',z)),(0,Ls.invariant)(z!=="extensions",mr.formatMessage('Failed to set a custom "%s" field on a mocked GraphQL response: forbidden field name. Did you mean to call "ctx.extensions()" instead?',z))}function Fi(z,J){try{return z()}catch(ye){J==null||J(ye)}}var bs=P(R({},_s),{data:kt,extensions:At,errors:Ir,cookie:he,field:xs});function pl(z){return z==null?!1:typeof z=="object"&&"kind"in z&&"definitions"in z}var Oa=class extends Ji{constructor(z,J){super(z.url,P(R({},z),{body:z._body})),this.variables=J}},pr=class extends ro{constructor(z,J,ye,Re){let ze=J;if(pl(J)){const Tt=Hn(J);if(Tt.operationType!==z)throw new Error(`Failed to create a GraphQL handler: provided a DocumentNode with a mismatched operation type (expected "${z}", but got "${Tt.operationType}").`);if(!Tt.operationName)throw new Error("Failed to create a GraphQL handler: provided a DocumentNode with no operation name.");ze=Tt.operationName}const at=z==="all"?`${z} (origin: ${ye.toString()})`:`${z} ${ze} (origin: ${ye.toString()})`;super({info:{header:at,operationType:z,operationName:ze},ctx:bs,resolver:Re}),this.endpoint=ye}parse(z){return Fi(()=>eo(z),J=>console.error(J.message))}getPublicRequest(z,J){return new Oa(z,(J==null?void 0:J.variables)||{})}predicate(z,J){if(!J)return!1;if(!J.operationName&&this.info.operationType!=="all"){const at=Ki(z);return mr.warn(`Failed to intercept a GraphQL request at "${z.method} ${at}": anonymous GraphQL operations are not supported.

Consider naming this operation or using "graphql.operation" request handler to intercept GraphQL requests regardless of their operation name/type. Read more: https://mswjs.io/docs/api/graphql/operation      `),!1}const ye=Ns(z.url,this.endpoint),Re=this.info.operationType==="all"||J.operationType===this.info.operationType,ze=this.info.operationName instanceof RegExp?this.info.operationName.test(J.operationName||""):J.operationName===this.info.operationName;return ye.matches&&Re&&ze}log(z,J,ye){const Re=rr(z),ze=Fn(J),at=gs(J.status),Tt=ye!=null&&ye.operationName?`${ye==null?void 0:ye.operationType} ${ye==null?void 0:ye.operationName}`:`anonymous ${ye==null?void 0:ye.operationType}`;console.groupCollapsed(mr.formatMessage("%s %s (%c%s%c)"),Li(),`${Tt}`,`color:${at}`,`${J.status} ${J.statusText}`,"color:inherit"),console.log("Request:",Re),console.log("Handler:",this),console.log("Response:",ze),console.groupEnd()}},Lr=3,tc=4,nr=.5;function ws(z){return z.reduce((J,ye)=>(ye instanceof jo&&J.rest.push(ye),ye instanceof pr&&J.graphql.push(ye),J),{rest:[],graphql:[]})}function Fr(){return(z,J)=>{const{path:ye,method:Re}=J.info;if(ye instanceof RegExp||Re instanceof RegExp)return 1/0;const at=Ro(z.method,Re)?nr:0,Tt=Ki(z);return(0,No.default)(Tt,ye)-at}}function Mr(z){return(J,ye)=>{if(typeof z.operationName>"u")return 1/0;const{operationType:Re,operationName:ze}=ye.info;if(typeof ze!="string")return 1/0;const Tt=z.operationType===Re?nr:0;return(0,No.default)(z.operationName,ze)-Tt}}function no(z,J,ye){return J.reduce((ze,at)=>{const Tt=ye(z,at);return ze.concat([[Tt,at]])},[]).sort(([ze],[at])=>ze-at).filter(([ze])=>ze<=Lr).slice(0,tc).map(([,ze])=>ze)}function dl(z){return z.length>1?`Did you mean to request one of the following resources instead?

${z.map(J=>`  • ${J.info.header}`).join(`
`)}`:`Did you mean to request "${z[0].info.header}" instead?`}function Ra(z,J,ye="warn"){const Re=Fi(()=>eo(z));function ze(){const gt=ws(J),Ft=Re?gt.graphql:gt.rest,Ar=no(z,Ft,Re?Mr(Re):Fr());return Ar.length>0?dl(Ar):""}function at(){const gt=Ki(z),Ft=Re?`${Re.operationType} ${Re.operationName} (${z.method} ${gt})`:`${z.method} ${gt}`,Ar=ze();return["captured a request without a matching request handler:",`  • ${Ft}`,Ar,`If you still wish to intercept this unhandled request, please create a request handler for it.
Read more: https://mswjs.io/docs/getting-started/mocks`].filter(Boolean).join(`

`)}function Tt(gt){const Ft=at();switch(gt){case"error":throw mr.error("Error: %s",Ft),new Error(mr.formatMessage('Cannot bypass a request when using the "error" strategy for the "onUnhandledRequest" option.'));case"warn":{mr.warn("Warning: %s",Ft);break}case"bypass":break;default:throw new Error(mr.formatMessage('Failed to react to an unhandled request: unknown strategy "%s". Please provide one of the supported strategies ("bypass", "warn", "error") or a custom callback function as the value of the "onUnhandledRequest" option.',gt))}}if(typeof ye=="function"){ye(z,{warning:Tt.bind(null,"warn"),error:Tt.bind(null,"error")});return}Tt(ye)}var io=e_();function qo(z,J){io.store.add(P(R({},z),{url:z.url.toString()}),J),io.store.persist()}async function so(z,J,ye,Re,ze){var at,Tt,gt,Ft,Ar,Jr;if(Re.emit("request:start",z),z.headers.get("x-msw-bypass")==="true"){Re.emit("request:end",z),(at=ze==null?void 0:ze.onPassthroughResponse)==null||at.call(ze,z);return}const[Jn,ui]=await(0,al.until)(()=>Sa(z,J,ze==null?void 0:ze.resolutionContext));if(Jn)throw Re.emit("unhandledException",Jn,z),Jn;const{handler:Kn,response:Gr}=ui;if(!Kn){Ra(z,J,ye.onUnhandledRequest),Re.emit("request:unhandled",z),Re.emit("request:end",z),(Tt=ze==null?void 0:ze.onPassthroughResponse)==null||Tt.call(ze,z);return}if(!Gr){mr.warn(`Expected response resolver to return a mocked response Object, but got %s. The original response is going to be used instead.

  • %s
    %s`,Gr,Kn.info.header,Kn.info.callFrame),Re.emit("request:end",z),(gt=ze==null?void 0:ze.onPassthroughResponse)==null||gt.call(ze,z);return}if(Gr.passthrough){Re.emit("request:end",z),(Ft=ze==null?void 0:ze.onPassthroughResponse)==null||Ft.call(ze,z);return}qo(z,Gr),Re.emit("request:match",z);const bt=ui,Di=((Ar=ze==null?void 0:ze.transformResponse)==null?void 0:Ar.call(ze,Gr))||Gr;return(Jr=ze==null?void 0:ze.onMockedResponse)==null||Jr.call(ze,Di,bt),Re.emit("request:end",z),Di}var oo=ls;function Go(z){return{status:z.status,statusText:z.statusText,headers:(0,oo.flattenHeadersObject)((0,oo.headersToObject)(z.headers)),body:z.body}}var ao=(z,J)=>async(ye,Re)=>{var ze;const at=new va(ye.ports[0]),Tt=ol(Re.payload);try{await so(Tt,z.requestHandlers,J,z.emitter,{transformResponse:lo,onPassthroughResponse(){at.postMessage("NOT_FOUND")},async onMockedResponse(gt,{handler:Ft,publicRequest:Ar,parsedRequest:Jr}){if(gt.body instanceof ReadableStream)throw new Error(mr.formatMessage('Failed to construct a mocked response with a "ReadableStream" body: mocked streams are not supported. Follow https://github.com/mswjs/msw/issues/1336 for more details.'));const ui=await new Response(gt.body,gt).arrayBuffer(),Kn=gt.body==null?null:ui;at.postMessage("MOCK_RESPONSE",P(R({},gt),{body:Kn}),[ui]),J.quiet||z.emitter.once("response:mocked",Gr=>{Ft.log(Ar,Go(Gr),Jr)})}})}catch(gt){if(gt instanceof Ni){at.postMessage("NETWORK_ERROR",{name:gt.name,message:gt.message});return}gt instanceof Error&&(mr.error(`Uncaught exception in the request handler for "%s %s":

%s

This exception has been gracefully handled as a 500 response, however, it's strongly recommended to resolve this error, as it indicates a mistake in your code. If you wish to mock an error response, please see this guide: https://mswjs.io/docs/recipes/mocking-error-responses`,Tt.method,Tt.url,(ze=gt.stack)!=null?ze:gt),at.postMessage("MOCK_RESPONSE",{status:500,statusText:"Request Handler Error",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:gt.name,message:gt.message,stack:gt.stack})}))}};function lo(z){return{status:z.status,statusText:z.statusText,headers:z.headers.all(),body:z.body,delay:z.delay}}async function co(z,J){z.workerChannel.send("INTEGRITY_CHECK_REQUEST");const{payload:ye}=await z.events.once("INTEGRITY_CHECK_RESPONSE");if(ye!=="3d6b9f06410d179a7f7404d4bf4c3c70")throw new Error(`Currently active Service Worker (${ye}) is behind the latest published one (3d6b9f06410d179a7f7404d4bf4c3c70).`);return J}var fl=lu();function Na(z){const J=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(...Re){(0,fl.until)(()=>z).then(()=>{window.XMLHttpRequest.prototype.send=J,this.send(...Re)})};const ye=window.fetch;window.fetch=async(...Re)=>(await(0,fl.until)(()=>z),window.fetch=ye,window.fetch(...Re))}function rc(z){return(J,ye)=>{var Re;const{payload:ze}=ye;if((Re=ze.type)!=null&&Re.includes("opaque"))return;const at=new Response(ze.body||null,ze);at.headers.get("x-powered-by")==="msw"?z.emitter.emit("response:mocked",at,ze.requestId):z.emitter.emit("response:bypass",at,ze.requestId)}}function ml(z,J){!(J!=null&&J.quiet)&&!location.href.startsWith(z.scope)&&mr.warn(`Cannot intercept requests on this page because it's outside of the worker's scope ("${z.scope}"). If you wish to mock API requests on this page, you must resolve this scope issue.

- (Recommended) Register the worker at the root level ("/") of your application.
- Set the "Service-Worker-Allowed" response header to allow out-of-scope workers.`)}var Zo=z=>function(ye,Re){const at=(async()=>{z.events.removeAllListeners(),z.workerChannel.on("REQUEST",ao(z,ye)),z.workerChannel.on("RESPONSE",rc(z));const Tt=await Vr(ye.serviceWorker.url,ye.serviceWorker.options,ye.findWorker),[gt,Ft]=Tt;if(!gt){const Jr=Re!=null&&Re.findWorker?mr.formatMessage(`Failed to locate the Service Worker registration using a custom "findWorker" predicate.

Please ensure that the custom predicate properly locates the Service Worker registration at "%s".
More details: https://mswjs.io/docs/api/setup-worker/start#findworker
`,ye.serviceWorker.url):mr.formatMessage(`Failed to locate the Service Worker registration.

This most likely means that the worker script URL "%s" cannot resolve against the actual public hostname (%s). This may happen if your application runs behind a proxy, or has a dynamic hostname.

Please consider using a custom "serviceWorker.url" option to point to the actual worker script location, or a custom "findWorker" option to resolve the Service Worker registration manually. More details: https://mswjs.io/docs/api/setup-worker/start`,ye.serviceWorker.url,location.host);throw new Error(Jr)}z.worker=gt,z.registration=Ft,z.events.addListener(window,"beforeunload",()=>{gt.state!=="redundant"&&z.workerChannel.send("CLIENT_CLOSED"),window.clearInterval(z.keepAliveInterval)});const[Ar]=await(0,Tn.until)(()=>co(z,gt));return Ar&&mr.error(`Detected outdated Service Worker: ${Ar.message}

The mocking is still enabled, but it's highly recommended that you update your Service Worker by running:

$ npx msw init <PUBLIC_DIR>

This is necessary to ensure that the Service Worker is in sync with the library to guarantee its stability.
If this message still persists after updating, please report an issue: https://github.com/open-draft/msw/issues      `),z.keepAliveInterval=window.setInterval(()=>z.workerChannel.send("KEEPALIVE_REQUEST"),5e3),ml(Ft,z.startOptions),Ft})().then(async Tt=>{const gt=Tt.installing||Tt.waiting;return gt&&await new Promise(Ft=>{gt.addEventListener("statechange",()=>{if(gt.state==="activated")return Ft()})}),await ci(z,ye).catch(Ft=>{throw new Error(`Failed to enable mocking: ${Ft==null?void 0:Ft.message}`)}),Tt});return ye.waitUntilReady&&Na(at),at};function Ho(z={}){z.quiet||console.log(`%c${mr.formatMessage("Mocking disabled.")}`,"color:orangered;font-weight:bold;")}var gl=z=>function(){var ye;if(!z.isMockingEnabled){mr.warn('Found a redundant "worker.stop()" call. Note that stopping the worker while mocking already stopped has no effect. Consider removing this "worker.stop()" call.');return}z.workerChannel.send("MOCK_DEACTIVATE"),z.isMockingEnabled=!1,window.clearInterval(z.keepAliveInterval),Ho({quiet:(ye=z.startOptions)==null?void 0:ye.quiet})},yl={serviceWorker:{url:"/mockServiceWorker.js",options:null},quiet:!1,waitUntilReady:!0,onUnhandledRequest:"warn",findWorker(z,J){return z===J}},uo=yh(),Wo=qT(),Xo=eS(),_l=yh(),Or=()=>{throw new Error("Not implemented")};function Es(z){return P(R({},z),{ok:z.status>=200&&z.status<300,url:"",type:"default",status:z.status,statusText:z.statusText,headers:z.headers,body:new ReadableStream,redirected:z.headers.get("Location")!=null,async text(){return z.body||""},async json(){return JSON.parse(z.body||"")},async arrayBuffer(){return(0,_l.encodeBuffer)(z.body||"")},bodyUsed:!1,formData:Or,blob:Or,clone:Or})}function zn(z,J){const ye=new uo.BatchInterceptor({name:"fallback",interceptors:[new Wo.FetchInterceptor,new Xo.XMLHttpRequestInterceptor]});return ye.on("request",async Re=>{const ze=new Ji(Re.url,P(R({},Re),{body:await Re.arrayBuffer()})),at=await so(ze,z.requestHandlers,J,z.emitter,{transformResponse(Tt){return{status:Tt.status,statusText:Tt.statusText,headers:Tt.headers.all(),body:Tt.body,delay:Tt.delay}},onMockedResponse(Tt,{handler:gt,publicRequest:Ft,parsedRequest:Ar}){J.quiet||z.emitter.once("response:mocked",Jr=>{gt.log(Ft,Go(Jr),Ar)})}});at&&Re.respondWith(at)}),ye.on("response",(Re,ze)=>{if(!Re.id)return;const at=Es(ze);ze.headers.get("x-powered-by")==="msw"?z.emitter.emit("response:mocked",at,Re.id):z.emitter.emit("response:bypass",at,Re.id)}),ye.apply(),ye}function Fs(z){return async function(ye){z.fallbackInterceptor=zn(z,ye),Ys({message:"Mocking enabled (fallback mode).",quiet:ye.quiet})}}function ho(z){return function(){var ye,Re;(ye=z.fallbackInterceptor)==null||ye.dispose(),Ho({quiet:(Re=z.startOptions)==null?void 0:Re.quiet})}}var Yo=la(),Qi=rS();function po(z,J){const ye=z.emit;ye._isPiped||(z.emit=function(Re,...ze){return J.emit(Re,...ze),ye.call(this,Re,...ze)},z.emit._isPiped=!0)}function Ts(z){const J=[...z];return Object.freeze(J),J}var La=class{constructor(...z){this.validateHandlers(...z),this.initialHandlers=Ts(z),this.currentHandlers=[...z],this.emitter=new Qi.Emitter,this.publicEmitter=new Qi.Emitter,po(this.emitter,this.publicEmitter),this.events=this.createLifeCycleEvents()}validateHandlers(...z){for(const J of z)(0,Yo.invariant)(!Array.isArray(J),mr.formatMessage('Failed to construct "%s" given an Array of request handlers. Make sure you spread the request handlers when calling the respective setup function.'),this.constructor.name)}dispose(){this.emitter.removeAllListeners(),this.publicEmitter.removeAllListeners()}use(...z){this.currentHandlers.unshift(...z)}restoreHandlers(){this.currentHandlers.forEach(z=>{z.markAsSkipped(!1)})}resetHandlers(...z){this.currentHandlers=z.length>0?[...z]:[...this.initialHandlers]}listHandlers(){return Ts(this.currentHandlers)}createLifeCycleEvents(){return{on:(...z)=>this.publicEmitter.on(...z),removeListener:(...z)=>this.publicEmitter.removeListener(...z),removeAllListeners:(...z)=>this.publicEmitter.removeAllListeners(...z)}}},vl=class extends La{constructor(...z){super(...z),this.startHandler=null,this.stopHandler=null,(0,ya.invariant)(!(0,ko.isNodeProcess)(),mr.formatMessage("Failed to execute `setupWorker` in a non-browser environment. Consider using `setupServer` for Node.js environment instead.")),this.listeners=[],this.context=this.createWorkerContext()}createWorkerContext(){const z={isMockingEnabled:!1,startOptions:null,worker:null,registration:null,requestHandlers:this.currentHandlers,emitter:this.emitter,workerChannel:{on:(J,ye)=>{this.context.events.addListener(navigator.serviceWorker,"message",Re=>{if(Re.source!==this.context.worker)return;const ze=Re.data;ze&&ze.type===J&&ye(Re,ze)})},send:J=>{var ye;(ye=this.context.worker)==null||ye.postMessage(J)}},events:{addListener:(J,ye,Re)=>(J.addEventListener(ye,Re),this.listeners.push({eventType:ye,target:J,callback:Re}),()=>{J.removeEventListener(ye,Re)}),removeAllListeners:()=>{for(const{target:J,eventType:ye,callback:Re}of this.listeners)J.removeEventListener(ye,Re);this.listeners=[]},once:J=>{const ye=[];return new Promise((Re,ze)=>{const at=Tt=>{try{const gt=Tt.data;gt.type===J&&Re(gt)}catch(gt){ze(gt)}};ye.push(this.context.events.addListener(navigator.serviceWorker,"message",at),this.context.events.addListener(navigator.serviceWorker,"messageerror",ze))}).finally(()=>{ye.forEach(Re=>Re())})}},useFallbackMode:!("serviceWorker"in navigator)||location.protocol==="file:"};return Object.defineProperties(z,{requestHandlers:{get:()=>this.currentHandlers}}),this.startHandler=z.useFallbackMode?Fs(z):Zo(z),this.stopHandler=z.useFallbackMode?ho(z):gl(z),z}async start(z={}){return this.context.startOptions=qe(yl,z),await this.startHandler(this.context.startOptions,z)}printHandlers(){this.listHandlers().forEach(J=>{const{header:ye,callFrame:Re}=J.info,ze=J.info.hasOwnProperty("operationType")?"[graphql]":"[rest]";console.groupCollapsed(`${ze} ${ye}`),Re&&console.log(`Declaration: ${Re}`),console.log("Handler:",J),console.groupEnd()})}stop(){super.dispose(),this.context.events.removeAllListeners(),this.context.emitter.removeAllListeners(),this.stopHandler()}};function xl(...z){return new vl(...z)}function zi(z){return(J,ye)=>new jo(z,J,ye)}var bl={all:zi(/.+/),head:zi("HEAD"),get:zi("GET"),post:zi("POST"),put:zi("PUT"),delete:zi("DELETE"),patch:zi("PATCH"),options:zi("OPTIONS")};function Xn(z,J){return(ye,Re)=>new pr(z,ye,J,Re)}function zs(z){return J=>new pr("all",new RegExp(".*"),z,J)}var Yn={operation:zs("*"),query:Xn("query","*"),mutation:Xn("mutation","*")};function fo(z){return{operation:zs(z),query:Xn("query",z),mutation:Xn("mutation",z)}}var wl=P(R({},Yn),{link:fo});return Yd}export{Tu as H,Xb as a,la as b,Jb as c,yh as d,rS as e,td as f,e_ as g,qh as h,lu as i,Ww as j,ev as k,sS as l,zl as m,zT as n,sw as o,Xh as p,uS as q,eS as r,nw as s,qb as t,oS as u,aS as v};

var je=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Sn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function We(e,t){return t={exports:{}},e(t,t.exports),t.exports}var ge=1e3,pe=ge*60,ye=pe*60,ue=ye*24,Mn=ue*7,$n=ue*365.25,Pn=function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return In(e);if(n==="number"&&isFinite(e))return t.long?Nn(e):Un(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function In(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),s=(t[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return n*$n;case"weeks":case"week":case"w":return n*Mn;case"days":case"day":case"d":return n*ue;case"hours":case"hour":case"hrs":case"hr":case"h":return n*ye;case"minutes":case"minute":case"mins":case"min":case"m":return n*pe;case"seconds":case"second":case"secs":case"sec":case"s":return n*ge;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function Un(e){var t=Math.abs(e);return t>=ue?Math.round(e/ue)+"d":t>=ye?Math.round(e/ye)+"h":t>=pe?Math.round(e/pe)+"m":t>=ge?Math.round(e/ge)+"s":e+"ms"}function Nn(e){var t=Math.abs(e);return t>=ue?Le(e,t,ue,"day"):t>=ye?Le(e,t,ye,"hour"):t>=pe?Le(e,t,pe,"minute"):t>=ge?Le(e,t,ge,"second"):e+" ms"}function Le(e,t,n,s){var o=t>=n*1.5;return Math.round(e/n)+" "+s+(o?"s":"")}function jn(e){n.debug=n,n.default=n,n.coerce=u,n.disable=a,n.enable=o,n.enabled=h,n.humanize=Pn,n.destroy=d,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let g=0;for(let y=0;y<f.length;y++)g=(g<<5)-g+f.charCodeAt(y),g|=0;return n.colors[Math.abs(g)%n.colors.length]}n.selectColor=t;function n(f){let g,y=null;function v(...R){if(!v.enabled)return;const M=v,B=Number(new Date),be=B-(g||B);M.diff=be,M.prev=g,M.curr=B,g=B,R[0]=n.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let E=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,(ee,fe)=>{if(ee==="%%")return"%";E++;const z=n.formatters[fe];if(typeof z=="function"){const te=R[E];ee=z.call(M,te),R.splice(E,1),E--}return ee}),n.formatArgs.call(M,R),(M.log||n.log).apply(M,R)}return v.namespace=f,v.useColors=n.useColors(),v.color=n.selectColor(f),v.extend=s,v.destroy=n.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>y===null?n.enabled(f):y,set:R=>{y=R}}),typeof n.init=="function"&&n.init(v),v}function s(f,g){const y=n(this.namespace+(typeof g>"u"?":":g)+f);return y.log=this.log,y}function o(f){n.save(f),n.names=[],n.skips=[];let g;const y=(typeof f=="string"?f:"").split(/[\s,]+/),v=y.length;for(g=0;g<v;g++)y[g]&&(f=y[g].replace(/\*/g,".*?"),f[0]==="-"?n.skips.push(new RegExp("^"+f.substr(1)+"$")):n.names.push(new RegExp("^"+f+"$")))}function a(){const f=[...n.names.map(p),...n.skips.map(p).map(g=>"-"+g)].join(",");return n.enable(""),f}function h(f){if(f[f.length-1]==="*")return!0;let g,y;for(g=0,y=n.skips.length;g<y;g++)if(n.skips[g].test(f))return!1;for(g=0,y=n.names.length;g<y;g++)if(n.names[g].test(f))return!0;return!1}function p(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function u(f){return f instanceof Error?f.stack||f.message:f}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Ln=jn,j=We(function(e,t){t.formatArgs=s,t.save=o,t.load=a,t.useColors=n,t.storage=h(),t.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;u.splice(1,0,d,"color: inherit");let f=0,g=0;u[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(f++,y==="%c"&&(g=f))}),u.splice(g,0,d)}t.log=console.debug||console.log||(()=>{});function o(u){try{u?t.storage.setItem("debug",u):t.storage.removeItem("debug")}catch{}}function a(){let u;try{u=t.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u={}.DEBUG),u}function h(){try{return localStorage}catch{}}e.exports=Ln(t);const{formatters:p}=e.exports;p.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}});j.formatArgs;j.save;j.load;j.useColors;j.storage;j.destroy;j.colors;j.log;let Wt,Be="default",it="";const ot=()=>{Wt=j(it?`fetch-mock:${Be}:${it}`:`fetch-mock:${Be}`)},Dn=e=>j(`fetch-mock:${Be}:${e}`);ot();var le={debug:(...e)=>{Wt(...e)},setDebugNamespace:e=>{it=e,ot()},setDebugPhase:e=>{Be=e||"default",ot()},getDebug:e=>Dn(e)};const{debug:kn,setDebugPhase:Jt}=le,U={};U.mock=function(...e){return Jt("setup"),e.length&&this.addRoute(e),this._mock()};U.addRoute=function(e){kn("Adding route",e);const t=this.compileRoute(e),n=this.routes.filter(({identifier:s,method:o})=>(typeof s=="function"?s===t.identifier:String(s)===String(t.identifier))&&(!o||!t.method||o===t.method));if(this.getOption("overwriteRoutes",t)===!1||!n.length)return this._uncompiledRoutes.push(e),this.routes.push(t);if(this.getOption("overwriteRoutes",t)===!0)return n.forEach(s=>{const o=this.routes.indexOf(s);this._uncompiledRoutes.splice(o,1,e),this.routes.splice(o,1,t)}),this.routes;if(n.length)throw new Error("fetch-mock: Adding route with same name or matcher as existing route. See `overwriteRoutes` option.");this._uncompiledRoutes.push(e),this.routes.push(t)};U._mock=function(){return this.isSandbox||(this.realFetch=this.realFetch||this.global.fetch,this.global.fetch=this.fetchHandler),Jt(),this};U.catch=function(e){return this.fallbackResponse&&console.warn("calling fetchMock.catch() twice - are you sure you want to overwrite the previous fallback response"),this.fallbackResponse=e||"ok",this._mock()};U.spy=function(e){return this._mock(),e?this.mock(e,this.getNativeFetch()):this.catch(this.getNativeFetch())};const ze=(e,t,n)=>{U[e]=function(s,o,a){return this[t](s,o,Object.assign(a||{},n))}},Ge=(e,t)=>{U[e]=function(n,s){return this[t]({},n,s)}};ze("sticky","mock",{sticky:!0});ze("once","mock",{repeat:1});Ge("any","mock");Ge("anyOnce","once");["get","post","put","delete","head","patch"].forEach(e=>{ze(e,"mock",{method:e}),ze(`${e}Once`,"once",{method:e}),Ge(`${e}Any`,e),Ge(`${e}AnyOnce`,`${e}Once`)});const Bn=e=>{typeof e=="function"&&(console.warn("Deprecated: Passing fetch-mock reset methods\ndirectly in as handlers for before/after test runner hooks.\nWrap in an arrow function instead e.g. `() => fetchMock.restore()`"),e())},zn=({sticky:e})=>t=>e?[]:t.filter(({sticky:n})=>n);U.resetBehavior=function(e={}){Bn(e);const t=zn(e);return this.routes=t(this.routes),this._uncompiledRoutes=t(this._uncompiledRoutes),this.realFetch&&!this.routes.length&&(this.global.fetch=this.realFetch,this.realFetch=void 0),this.fallbackResponse=void 0,this};U.resetHistory=function(){return this._calls=[],this._holdingPromises=[],this.routes.forEach(e=>e.reset&&e.reset()),this};U.restore=U.reset=function(e){return this.resetBehavior(e),this.resetHistory(),this};var Gn=U;const{getDebug:qn}=le,Nt=["body","headers","throws","status","redirectUrl"];class Hn{constructor(t){this.debug=qn("ResponseBuilder()"),this.debug("Response builder created with options",t),Object.assign(this,t)}exec(){this.debug("building response"),this.normalizeResponseConfig(),this.constructFetchOpts(),this.constructResponseBody();const t=new this.fetchMock.config.Response(this.body,this.options),n=this.buildObservableResponse(t);return[t,n]}sendAsObject(){return Nt.some(t=>this.responseConfig[t])?!Object.keys(this.responseConfig).every(t=>Nt.includes(t)):!0}normalizeResponseConfig(){typeof this.responseConfig=="number"?(this.debug("building response using status",this.responseConfig),this.responseConfig={status:this.responseConfig}):(typeof this.responseConfig=="string"||this.sendAsObject())&&(this.debug("building text response from",this.responseConfig),this.responseConfig={body:this.responseConfig})}validateStatus(t){if(!t)return this.debug("No status provided. Defaulting to 200"),200;if(typeof t=="number"&&parseInt(t,10)!==t&&t>=200||t<600)return this.debug("Valid status provided",t),t;throw new TypeError(`fetch-mock: Invalid status ${t} passed on response object.
To respond with a JSON object that has status as a property assign the object to body
e.g. {"body": {"status: "registered"}}`)}constructFetchOpts(){this.options=this.responseConfig.options||{},this.options.url=this.responseConfig.redirectUrl||this.url,this.options.status=this.validateStatus(this.responseConfig.status),this.options.statusText=this.fetchMock.statusTextMap[String(this.options.status)],this.options.headers=new this.fetchMock.config.Headers(this.responseConfig.headers||{})}getOption(t){return this.fetchMock.getOption(t,this.route)}convertToJson(){this.getOption("sendAsJson")&&this.responseConfig.body!=null&&typeof this.body=="object"&&(this.debug("Stringifying JSON response body"),this.body=JSON.stringify(this.body),this.options.headers.has("Content-Type")||this.options.headers.set("Content-Type","application/json"))}setContentLength(){this.getOption("includeContentLength")&&typeof this.body=="string"&&!this.options.headers.has("Content-Length")&&(this.debug("Setting content-length header:",this.body.length.toString()),this.options.headers.set("Content-Length",this.body.length.toString()))}constructResponseBody(){if(this.body=this.responseConfig.body,this.convertToJson(),this.setContentLength(),this.Stream){this.debug("Creating response stream");const t=new this.Stream.Readable;this.body!=null&&t.push(this.body,"utf-8"),t.push(null),this.body=t}this.body=this.body}buildObservableResponse(t){const n=this.fetchMock;return t._fmResults={},this.debug("Wrapping Response in ES proxy for observability"),new Proxy(t,{get:(s,o)=>{if(this.responseConfig.redirectUrl){if(o==="url")return this.debug("Retrieving redirect url",this.responseConfig.redirectUrl),this.responseConfig.redirectUrl;if(o==="redirected")return this.debug("Retrieving redirected status",!0),!0}return typeof s[o]=="function"?(this.debug("Wrapping body promises in ES proxies for observability"),new Proxy(s[o],{apply:(a,h,p)=>{this.debug(`Calling res.${o}`);const u=a.apply(t,p);return u.then&&(n._holdingPromises.push(u.catch(()=>null)),s._fmResults[o]=u),u}})):s[o]}})}}var Wn=e=>new Hn(e).exec();let Q;const at=new RegExp("^[a-z]+://","i"),Jn=new RegExp("^//","i"),jt=e=>typeof e.raw=="function"?Object.entries(e.raw()):e[Symbol.iterator]?[...e]:Object.entries(e),Lt=e=>e.reduce((t,[n,s])=>Object.assign(t,{[n]:s}),{}),st=e=>{if(typeof e=="function"||e instanceof RegExp||/^(begin|end|glob|express|path)\:/.test(e))return e;if(at.test(e))return new Q(e).href;if(Jn.test(e))return new Q(e,"http://dummy").href;{const t=new Q(e,"http://dummy");return t.pathname+t.search}},Kn=async e=>{try{return"body"in e?e.body.toString():e.clone().text()}catch{}};var Je={setUrlImplementation:e=>{Q=e},normalizeRequest:(e,t,n)=>{if(n.prototype.isPrototypeOf(e)){const s={method:e.method},o=Kn(e);typeof o<"u"&&(s.body=o);const a={url:st(e.url),options:Object.assign(s,t),request:e,signal:t&&t.signal||e.signal},h=jt(e.headers);return h.length&&(a.options.headers=Lt(h)),a}else{if(typeof e=="string"||typeof e=="object"&&"href"in e)return{url:st(e),options:t,signal:t&&t.signal};throw typeof e=="object"?new TypeError("fetch-mock: Unrecognised Request object. Read the Config and Installation sections of the docs"):new TypeError("fetch-mock: Invalid arguments passed to fetch")}},normalizeUrl:st,getPath:e=>(at.test(e)?new Q(e):new Q(e,"http://dummy")).pathname,getQuery:e=>{const t=at.test(e)?new Q(e):new Q(e,"http://dummy");return t.search?t.search.substr(1):""},headers:{normalize:e=>Lt(jt(e)),toLowerCase:e=>Object.keys(e).reduce((t,n)=>(t[n.toLowerCase()]=e[n],t),{}),equal:(e,t)=>(e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],e.length!==t.length?!1:e.every((n,s)=>n===t[s]))}};const{debug:xe,setDebugPhase:Kt,getDebug:Ke}=le,L={};class Xn extends Error{constructor(){super(...arguments),this.name="AbortError",this.message="The operation was aborted.",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}const Zn=e=>typeof navigator>"u"||!navigator.vendor||navigator.vendor!=="Apple Computer, Inc."?e:async t=>{const{method:n}=t;if(!["POST","PUT","PATCH"].includes(n))return e(t);const s=await t.clone().text(),{cache:o,credentials:a,headers:h,integrity:p,mode:u,redirect:d,referrer:f}=t,g={body:s,cache:o,credentials:a,headers:h,integrity:p,mode:u,redirect:d,referrer:f,method:n};return e(t.url,g)},Qn=async({response:e,responseIsFetch:t=!1},n,s,o)=>{const a=Ke("resolve()");for(a("Recursively resolving function and promise responses");;)if(typeof e=="function"){if(a("  Response is a function"),t)return o?(a("  -> Calling fetch with Request instance"),e(o)):(a("  -> Calling fetch with url and options"),e(n,s));a("  -> Calling response function"),e=e(n,s,o)}else if(typeof e.then=="function")a("  Response is a promise"),a("  -> Resolving promise"),e=await e;else return a("  Response is not a function or a promise"),a("  -> Exiting response resolution recursion"),e};L.needsAsyncBodyExtraction=function({request:e}){return e&&this.routes.some(({usesBody:t})=>t)};L.fetchHandler=function(e,t){Kt("handle");const n=Ke("fetchHandler()");n("fetch called with:",e,t);const s=Je.normalizeRequest(e,t,this.config.Request);return n("Request normalised"),n("  url",s.url),n("  options",s.options),n("  request",s.request),n("  signal",s.signal),this.needsAsyncBodyExtraction(s)?(n("Need to wait for Body to be streamed before calling router: switching to async mode"),this._extractBodyThenHandle(s)):this._fetchHandler(s)};L._extractBodyThenHandle=async function(e){return e.options.body=await e.options.body,this._fetchHandler(e)};L._fetchHandler=function({url:e,options:t,request:n,signal:s}){const{route:o,callLog:a}=this.executeRouter(e,t,n);this.recordCall(a);let h;return this._holdingPromises.push(new this.config.Promise(p=>h=p)),new this.config.Promise((p,u)=>{if(s){xe("signal exists - enabling fetch abort");const d=()=>{xe("aborting fetch"),u(typeof DOMException<"u"?new DOMException("The operation was aborted.","AbortError"):new Xn),h()};s.aborted&&(xe("signal is already aborted - aborting the fetch"),d()),s.addEventListener("abort",d)}this.generateResponse({route:o,url:e,options:t,request:n,callLog:a}).then(p,u).then(h,h).then(()=>{Kt()})})};L.fetchHandler.isMock=!0;L.executeRouter=function(e,t,n){const s=Ke("executeRouter()"),o={url:e,options:t,request:n,isUnmatched:!0};if(s("Attempting to match request to a route"),this.getOption("fallbackToNetwork")==="always")return s("  Configured with fallbackToNetwork=always - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0}};const a=this.router(e,t,n);if(a)return s("  Matching route found"),{route:a,callLog:{url:e,options:t,request:n,identifier:a.identifier}};if(this.getOption("warnOnFallback")&&console.warn(`Unmatched ${t&&t.method||"GET"} to ${e}`),this.fallbackResponse)return s("  No matching route found - using fallbackResponse"),{route:{response:this.fallbackResponse},callLog:o};if(!this.getOption("fallbackToNetwork"))throw new Error(`fetch-mock: No fallback response defined for ${t&&t.method||"GET"} to ${e}`);return s("  Configured to fallbackToNetwork - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0},callLog:o}};L.generateResponse=async function({route:e,url:t,options:n,request:s,callLog:o={}}){const a=Ke("generateResponse()"),h=await Qn(e,t,n,s);if(h.throws&&typeof h!="function")throw a("response.throws is defined - throwing an error"),h.throws;if(this.config.Response.prototype.isPrototypeOf(h))return a("response is already a Response instance - returning it"),o.response=h,h;const[p,u]=Wn({url:t,responseConfig:h,fetchMock:this,route:e});return o.response=p,u};L.router=function(e,t,n){const s=this.routes.find((o,a)=>(xe(`Trying to match route ${a}`),o.matcher(e,t,n)));if(s)return s};L.getNativeFetch=function(){const e=this.realFetch||this.isSandbox&&this.config.fetch;if(!e)throw new Error("fetch-mock: Falling back to network only available on global fetch-mock, or by setting config.fetch on sandboxed fetch-mock");return Zn(e)};L.recordCall=function(e){xe("Recording fetch call",e),e&&this._calls.push(e)};var Yn=L,Vn=function(e,t){if(typeof e!="string")throw new TypeError("Expected a string");for(var n=String(e),s="",o=t?!!t.extended:!1,a=t?!!t.globstar:!1,h=!1,p=t&&typeof t.flags=="string"?t.flags:"",u,d=0,f=n.length;d<f;d++)switch(u=n[d],u){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":s+="\\"+u;break;case"?":if(o){s+=".";break}case"[":case"]":if(o){s+=u;break}case"{":if(o){h=!0,s+="(";break}case"}":if(o){h=!1,s+=")";break}case",":if(h){s+="|";break}s+="\\"+u;break;case"*":for(var g=n[d-1],y=1;n[d+1]==="*";)y++,d++;var v=n[d+1];if(!a)s+=".*";else{var R=y>1&&(g==="/"||g===void 0)&&(v==="/"||v===void 0);R?(s+="((?:[^/]*(?:/|$))*)",d++):s+="([^/]*)"}break;default:s+=u}return(!p||!~p.indexOf("g"))&&(s="^"+s+"$"),new RegExp(s,p)},me=er,es=ut,ts=is,rs=Qt,ns=Vt,Xt="/",Zt="./",ss=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function ut(e,t){for(var n=[],s=0,o=0,a="",h=t&&t.delimiter||Xt,p=t&&t.delimiters||Zt,u=!1,d;(d=ss.exec(e))!==null;){var f=d[0],g=d[1],y=d.index;if(a+=e.slice(o,y),o=y+f.length,g){a+=g[1],u=!0;continue}var v="",R=e[o],M=d[2],B=d[3],be=d[4],E=d[5];if(!u&&a.length){var V=a.length-1;p.indexOf(a[V])>-1&&(v=a[V],a=a.slice(0,V))}a&&(n.push(a),a="",u=!1);var ee=v!==""&&R!==void 0&&R!==v,fe=E==="+"||E==="*",z=E==="?"||E==="*",te=v||h,Fe=B||be;n.push({name:M||s++,prefix:v,delimiter:te,optional:z,repeat:fe,partial:ee,pattern:Fe?os(Fe):"[^"+X(te)+"]+?"})}return(a||o<e.length)&&n.push(a+e.substr(o)),n}function is(e,t){return Qt(ut(e,t))}function Qt(e){for(var t=new Array(e.length),n=0;n<e.length;n++)typeof e[n]=="object"&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(s,o){for(var a="",h=o&&o.encode||encodeURIComponent,p=0;p<e.length;p++){var u=e[p];if(typeof u=="string"){a+=u;continue}var d=s?s[u.name]:void 0,f;if(Array.isArray(d)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but got array');if(d.length===0){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var g=0;g<d.length;g++){if(f=h(d[g],u),!t[p].test(f))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'"');a+=(g===0?u.prefix:u.delimiter)+f}continue}if(typeof d=="string"||typeof d=="number"||typeof d=="boolean"){if(f=h(String(d),u),!t[p].test(f))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but got "'+f+'"');a+=u.prefix+f;continue}if(u.optional){u.partial&&(a+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be '+(u.repeat?"an array":"a string"))}return a}}function X(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function os(e){return e.replace(/([=!:$/()])/g,"\\$1")}function Yt(e){return e&&e.sensitive?"":"i"}function as(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var s=0;s<n.length;s++)t.push({name:s,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}function cs(e,t,n){for(var s=[],o=0;o<e.length;o++)s.push(er(e[o],t,n).source);return new RegExp("(?:"+s.join("|")+")",Yt(n))}function us(e,t,n){return Vt(ut(e,n),t,n)}function Vt(e,t,n){n=n||{};for(var s=n.strict,o=n.start!==!1,a=n.end!==!1,h=X(n.delimiter||Xt),p=n.delimiters||Zt,u=[].concat(n.endsWith||[]).map(X).concat("$").join("|"),d=o?"^":"",f=e.length===0,g=0;g<e.length;g++){var y=e[g];if(typeof y=="string")d+=X(y),f=g===e.length-1&&p.indexOf(y[y.length-1])>-1;else{var v=y.repeat?"(?:"+y.pattern+")(?:"+X(y.delimiter)+"(?:"+y.pattern+"))*":y.pattern;t&&t.push(y),y.optional?y.partial?d+=X(y.prefix)+"("+v+")?":d+="(?:"+X(y.prefix)+"("+v+"))?":d+=X(y.prefix)+"("+v+")"}}return a?(s||(d+="(?:"+h+")?"),d+=u==="$"?"$":"(?="+u+")"):(s||(d+="(?:"+h+"(?="+u+"))?"),f||(d+="(?="+h+"|"+u+")")),new RegExp(d,Yt(n))}function er(e,t,n){return e instanceof RegExp?as(e,t):Array.isArray(e)?cs(e,t,n):us(e,t,n)}me.parse=es;me.compile=ts;me.tokensToFunction=rs;me.tokensToRegExp=ns;function ls(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var fs=function(e,t,n,s){t=t||"&",n=n||"=";var o={};if(typeof e!="string"||e.length===0)return o;var a=/\+/g;e=e.split(t);var h=1e3;s&&typeof s.maxKeys=="number"&&(h=s.maxKeys);var p=e.length;h>0&&p>h&&(p=h);for(var u=0;u<p;++u){var d=e[u].replace(a,"%20"),f=d.indexOf(n),g,y,v,R;f>=0?(g=d.substr(0,f),y=d.substr(f+1)):(g=d,y=""),v=decodeURIComponent(g),R=decodeURIComponent(y),ls(o,v)?Array.isArray(o[v])?o[v].push(R):o[v]=[o[v],R]:o[v]=R}return o},Re=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},hs=function(e,t,n,s){return t=t||"&",n=n||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(o){var a=encodeURIComponent(Re(o))+n;return Array.isArray(e[o])?e[o].map(function(h){return a+encodeURIComponent(Re(h))}).join(t):a+encodeURIComponent(Re(e[o]))}).join(t):s?encodeURIComponent(Re(s))+n+encodeURIComponent(Re(e)):""},ae=We(function(e,t){t.decode=t.parse=fs,t.encode=t.stringify=hs});ae.decode;ae.parse;ae.encode;ae.stringify;var tr=We(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(s){function o(a,h){return s.apply(this,arguments)}return o.toString=function(){return s.toString()},o}(function(s,o){return typeof s!="object"||s===null||typeof o!="object"||o===null?!1:Object.keys(o).every(function(a){if(!s.propertyIsEnumerable(a))return!1;var h=o[a],p=s[a];return!(typeof h=="object"&&h!==null?!n(p,h):p!==h)})});t.default=n,e.exports=t.default});Sn(tr);var rr=We(function(e,t){var n=200,s="__lodash_hash_undefined__",o=1,a=2,h=9007199254740991,p="[object Arguments]",u="[object Array]",d="[object AsyncFunction]",f="[object Boolean]",g="[object Date]",y="[object Error]",v="[object Function]",R="[object GeneratorFunction]",M="[object Map]",B="[object Number]",be="[object Null]",E="[object Object]",V="[object Promise]",ee="[object Proxy]",fe="[object RegExp]",z="[object Set]",te="[object String]",Fe="[object Symbol]",ir="[object Undefined]",Xe="[object WeakMap]",ft="[object ArrayBuffer]",Ee="[object DataView]",or="[object Float32Array]",ar="[object Float64Array]",cr="[object Int8Array]",ur="[object Int16Array]",lr="[object Int32Array]",fr="[object Uint8Array]",hr="[object Uint8ClampedArray]",dr="[object Uint16Array]",gr="[object Uint32Array]",pr=/[\\^$.*+?()[\]{}|]/g,yr=/^\[object .+?Constructor\]$/,mr=/^(?:0|[1-9]\d*)$/,C={};C[or]=C[ar]=C[cr]=C[ur]=C[lr]=C[fr]=C[hr]=C[dr]=C[gr]=!0,C[p]=C[u]=C[ft]=C[f]=C[Ee]=C[g]=C[y]=C[v]=C[M]=C[B]=C[E]=C[fe]=C[z]=C[te]=C[Xe]=!1;var ht=typeof je=="object"&&je&&je.Object===Object&&je,br=typeof self=="object"&&self&&self.Object===Object&&self,G=ht||br||Function("return this")(),dt=t&&!t.nodeType&&t,gt=dt&&!0&&e&&!e.nodeType&&e,pt=gt&&gt.exports===dt,Ze=pt&&ht.process,yt=function(){try{return Ze&&Ze.binding&&Ze.binding("util")}catch{}}(),mt=yt&&yt.isTypedArray;function vr(r,i){for(var c=-1,l=r==null?0:r.length,_=0,b=[];++c<l;){var x=r[c];i(x,c,r)&&(b[_++]=x)}return b}function wr(r,i){for(var c=-1,l=i.length,_=r.length;++c<l;)r[_+c]=i[c];return r}function Cr(r,i){for(var c=-1,l=r==null?0:r.length;++c<l;)if(i(r[c],c,r))return!0;return!1}function _r(r,i){for(var c=-1,l=Array(r);++c<r;)l[c]=i(c);return l}function Rr(r){return function(i){return r(i)}}function Ar(r,i){return r.has(i)}function xr(r,i){return r==null?void 0:r[i]}function Tr(r){var i=-1,c=Array(r.size);return r.forEach(function(l,_){c[++i]=[_,l]}),c}function Fr(r,i){return function(c){return r(i(c))}}function Er(r){var i=-1,c=Array(r.size);return r.forEach(function(l){c[++i]=l}),c}var Or=Array.prototype,Sr=Function.prototype,Oe=Object.prototype,Qe=G["__core-js_shared__"],bt=Sr.toString,D=Oe.hasOwnProperty,vt=function(){var r=/[^.]+$/.exec(Qe&&Qe.keys&&Qe.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),wt=Oe.toString,Mr=RegExp("^"+bt.call(D).replace(pr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ct=pt?G.Buffer:void 0,Se=G.Symbol,_t=G.Uint8Array,Rt=Oe.propertyIsEnumerable,$r=Or.splice,re=Se?Se.toStringTag:void 0,At=Object.getOwnPropertySymbols,Pr=Ct?Ct.isBuffer:void 0,Ir=Fr(Object.keys,Object),Ye=he(G,"DataView"),ve=he(G,"Map"),Ve=he(G,"Promise"),et=he(G,"Set"),tt=he(G,"WeakMap"),we=he(Object,"create"),Ur=ie(Ye),Nr=ie(ve),jr=ie(Ve),Lr=ie(et),Dr=ie(tt),xt=Se?Se.prototype:void 0,rt=xt?xt.valueOf:void 0;function ne(r){var i=-1,c=r==null?0:r.length;for(this.clear();++i<c;){var l=r[i];this.set(l[0],l[1])}}function kr(){this.__data__=we?we(null):{},this.size=0}function Br(r){var i=this.has(r)&&delete this.__data__[r];return this.size-=i?1:0,i}function zr(r){var i=this.__data__;if(we){var c=i[r];return c===s?void 0:c}return D.call(i,r)?i[r]:void 0}function Gr(r){var i=this.__data__;return we?i[r]!==void 0:D.call(i,r)}function qr(r,i){var c=this.__data__;return this.size+=this.has(r)?0:1,c[r]=we&&i===void 0?s:i,this}ne.prototype.clear=kr,ne.prototype.delete=Br,ne.prototype.get=zr,ne.prototype.has=Gr,ne.prototype.set=qr;function q(r){var i=-1,c=r==null?0:r.length;for(this.clear();++i<c;){var l=r[i];this.set(l[0],l[1])}}function Hr(){this.__data__=[],this.size=0}function Wr(r){var i=this.__data__,c=$e(i,r);if(c<0)return!1;var l=i.length-1;return c==l?i.pop():$r.call(i,c,1),--this.size,!0}function Jr(r){var i=this.__data__,c=$e(i,r);return c<0?void 0:i[c][1]}function Kr(r){return $e(this.__data__,r)>-1}function Xr(r,i){var c=this.__data__,l=$e(c,r);return l<0?(++this.size,c.push([r,i])):c[l][1]=i,this}q.prototype.clear=Hr,q.prototype.delete=Wr,q.prototype.get=Jr,q.prototype.has=Kr,q.prototype.set=Xr;function se(r){var i=-1,c=r==null?0:r.length;for(this.clear();++i<c;){var l=r[i];this.set(l[0],l[1])}}function Zr(){this.size=0,this.__data__={hash:new ne,map:new(ve||q),string:new ne}}function Qr(r){var i=Pe(this,r).delete(r);return this.size-=i?1:0,i}function Yr(r){return Pe(this,r).get(r)}function Vr(r){return Pe(this,r).has(r)}function en(r,i){var c=Pe(this,r),l=c.size;return c.set(r,i),this.size+=c.size==l?0:1,this}se.prototype.clear=Zr,se.prototype.delete=Qr,se.prototype.get=Yr,se.prototype.has=Vr,se.prototype.set=en;function Me(r){var i=-1,c=r==null?0:r.length;for(this.__data__=new se;++i<c;)this.add(r[i])}function tn(r){return this.__data__.set(r,s),this}function rn(r){return this.__data__.has(r)}Me.prototype.add=Me.prototype.push=tn,Me.prototype.has=rn;function W(r){var i=this.__data__=new q(r);this.size=i.size}function nn(){this.__data__=new q,this.size=0}function sn(r){var i=this.__data__,c=i.delete(r);return this.size=i.size,c}function on(r){return this.__data__.get(r)}function an(r){return this.__data__.has(r)}function cn(r,i){var c=this.__data__;if(c instanceof q){var l=c.__data__;if(!ve||l.length<n-1)return l.push([r,i]),this.size=++c.size,this;c=this.__data__=new se(l)}return c.set(r,i),this.size=c.size,this}W.prototype.clear=nn,W.prototype.delete=sn,W.prototype.get=on,W.prototype.has=an,W.prototype.set=cn;function un(r,i){var c=Ie(r),l=!c&&An(r),_=!c&&!l&&nt(r),b=!c&&!l&&!_&&It(r),x=c||l||_||b,T=x?_r(r.length,String):[],F=T.length;for(var A in r)(i||D.call(r,A))&&!(x&&(A=="length"||_&&(A=="offset"||A=="parent")||b&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||vn(A,F)))&&T.push(A);return T}function $e(r,i){for(var c=r.length;c--;)if(St(r[c][0],i))return c;return-1}function ln(r,i,c){var l=i(r);return Ie(r)?l:wr(l,c(r))}function Ce(r){return r==null?r===void 0?ir:be:re&&re in Object(r)?mn(r):Rn(r)}function Tt(r){return _e(r)&&Ce(r)==p}function Ft(r,i,c,l,_){return r===i?!0:r==null||i==null||!_e(r)&&!_e(i)?r!==r&&i!==i:fn(r,i,c,l,Ft,_)}function fn(r,i,c,l,_,b){var x=Ie(r),T=Ie(i),F=x?u:J(r),A=T?u:J(i);F=F==p?E:F,A=A==p?E:A;var $=F==E,N=A==E,O=F==A;if(O&&nt(r)){if(!nt(i))return!1;x=!0,$=!1}if(O&&!$)return b||(b=new W),x||It(r)?Et(r,i,c,l,_,b):pn(r,i,F,c,l,_,b);if(!(c&o)){var P=$&&D.call(r,"__wrapped__"),I=N&&D.call(i,"__wrapped__");if(P||I){var K=P?r.value():r,H=I?i.value():i;return b||(b=new W),_(K,H,c,l,b)}}return O?(b||(b=new W),yn(r,i,c,l,_,b)):!1}function hn(r){if(!Pt(r)||Cn(r))return!1;var i=Mt(r)?Mr:yr;return i.test(ie(r))}function dn(r){return _e(r)&&$t(r.length)&&!!C[Ce(r)]}function gn(r){if(!_n(r))return Ir(r);var i=[];for(var c in Object(r))D.call(r,c)&&c!="constructor"&&i.push(c);return i}function Et(r,i,c,l,_,b){var x=c&o,T=r.length,F=i.length;if(T!=F&&!(x&&F>T))return!1;var A=b.get(r);if(A&&b.get(i))return A==i;var $=-1,N=!0,O=c&a?new Me:void 0;for(b.set(r,i),b.set(i,r);++$<T;){var P=r[$],I=i[$];if(l)var K=x?l(I,P,$,i,r,b):l(P,I,$,r,i,b);if(K!==void 0){if(K)continue;N=!1;break}if(O){if(!Cr(i,function(H,oe){if(!Ar(O,oe)&&(P===H||_(P,H,c,l,b)))return O.push(oe)})){N=!1;break}}else if(!(P===I||_(P,I,c,l,b))){N=!1;break}}return b.delete(r),b.delete(i),N}function pn(r,i,c,l,_,b,x){switch(c){case Ee:if(r.byteLength!=i.byteLength||r.byteOffset!=i.byteOffset)return!1;r=r.buffer,i=i.buffer;case ft:return!(r.byteLength!=i.byteLength||!b(new _t(r),new _t(i)));case f:case g:case B:return St(+r,+i);case y:return r.name==i.name&&r.message==i.message;case fe:case te:return r==i+"";case M:var T=Tr;case z:var F=l&o;if(T||(T=Er),r.size!=i.size&&!F)return!1;var A=x.get(r);if(A)return A==i;l|=a,x.set(r,i);var $=Et(T(r),T(i),l,_,b,x);return x.delete(r),$;case Fe:if(rt)return rt.call(r)==rt.call(i)}return!1}function yn(r,i,c,l,_,b){var x=c&o,T=Ot(r),F=T.length,A=Ot(i),$=A.length;if(F!=$&&!x)return!1;for(var N=F;N--;){var O=T[N];if(!(x?O in i:D.call(i,O)))return!1}var P=b.get(r);if(P&&b.get(i))return P==i;var I=!0;b.set(r,i),b.set(i,r);for(var K=x;++N<F;){O=T[N];var H=r[O],oe=i[O];if(l)var Ut=x?l(oe,H,O,i,r,b):l(H,oe,O,r,i,b);if(!(Ut===void 0?H===oe||_(H,oe,c,l,b):Ut)){I=!1;break}K||(K=O=="constructor")}if(I&&!K){var Ue=r.constructor,Ne=i.constructor;Ue!=Ne&&"constructor"in r&&"constructor"in i&&!(typeof Ue=="function"&&Ue instanceof Ue&&typeof Ne=="function"&&Ne instanceof Ne)&&(I=!1)}return b.delete(r),b.delete(i),I}function Ot(r){return ln(r,Fn,bn)}function Pe(r,i){var c=r.__data__;return wn(i)?c[typeof i=="string"?"string":"hash"]:c.map}function he(r,i){var c=xr(r,i);return hn(c)?c:void 0}function mn(r){var i=D.call(r,re),c=r[re];try{r[re]=void 0;var l=!0}catch{}var _=wt.call(r);return l&&(i?r[re]=c:delete r[re]),_}var bn=At?function(r){return r==null?[]:(r=Object(r),vr(At(r),function(i){return Rt.call(r,i)}))}:En,J=Ce;(Ye&&J(new Ye(new ArrayBuffer(1)))!=Ee||ve&&J(new ve)!=M||Ve&&J(Ve.resolve())!=V||et&&J(new et)!=z||tt&&J(new tt)!=Xe)&&(J=function(r){var i=Ce(r),c=i==E?r.constructor:void 0,l=c?ie(c):"";if(l)switch(l){case Ur:return Ee;case Nr:return M;case jr:return V;case Lr:return z;case Dr:return Xe}return i});function vn(r,i){return i=i??h,!!i&&(typeof r=="number"||mr.test(r))&&r>-1&&r%1==0&&r<i}function wn(r){var i=typeof r;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?r!=="__proto__":r===null}function Cn(r){return!!vt&&vt in r}function _n(r){var i=r&&r.constructor,c=typeof i=="function"&&i.prototype||Oe;return r===c}function Rn(r){return wt.call(r)}function ie(r){if(r!=null){try{return bt.call(r)}catch{}try{return r+""}catch{}}return""}function St(r,i){return r===i||r!==r&&i!==i}var An=Tt(function(){return arguments}())?Tt:function(r){return _e(r)&&D.call(r,"callee")&&!Rt.call(r,"callee")},Ie=Array.isArray;function xn(r){return r!=null&&$t(r.length)&&!Mt(r)}var nt=Pr||On;function Tn(r,i){return Ft(r,i)}function Mt(r){if(!Pt(r))return!1;var i=Ce(r);return i==v||i==R||i==d||i==ee}function $t(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=h}function Pt(r){var i=typeof r;return r!=null&&(i=="object"||i=="function")}function _e(r){return r!=null&&typeof r=="object"}var It=mt?Rr(mt):dn;function Fn(r){return xn(r)?un(r):gn(r)}function En(){return[]}function On(){return!1}e.exports=Tn});const{debug:m}=le,{headers:De,getPath:ct,getQuery:ds,normalizeUrl:Dt}=Je,Ae=e=>t=>(m("Actual url:",t),e(t)),kt={begin:e=>Ae(t=>t.indexOf(e)===0),end:e=>Ae(t=>t.substr(-e.length)===e),glob:e=>{const t=Vn(e);return Ae(n=>t.test(n))},express:e=>{const t=me(e);return Ae(n=>t.test(ct(n)))},path:e=>Ae(t=>ct(t)===e)},gs=({headers:e})=>{if(m("Generating header matcher"),!e){m("  No header expectations defined - skipping");return}const t=De.toLowerCase(e);return m("  Expected headers:",t),(n,{headers:s={}})=>{m("Attempting to match headers");const o=De.toLowerCase(De.normalize(s));return m("  Expected headers:",t),m("  Actual headers:",o),Object.keys(t).every(a=>De.equal(o[a],t[a]))}},ps=({method:e})=>{if(m("Generating method matcher"),!e){m("  No method expectations defined - skipping");return}return m("  Expected method:",e),(t,{method:n})=>{m("Attempting to match method");const s=n?n.toLowerCase():"get";return m("  Expected method:",e),m("  Actual method:",s),e===s}},ys=({query:e})=>{if(m("Generating query parameters matcher"),!e){m("  No query parameters expectations defined - skipping");return}const t=ae.parse(ae.stringify(e));m("  Expected query parameters:",e);const n=Object.keys(t);return s=>{m("Attempting to match query parameters");const o=ae.parse(ds(s));return m("  Expected query parameters:",t),m("  Actual query parameters:",o),n.every(a=>Array.isArray(o[a])?Array.isArray(t[a])?rr(o[a].sort(),t[a].sort()):!1:o[a]===t[a])}},ms=({params:e,url:t})=>{if(m("Generating path parameters matcher"),!e){m("  No path parameters expectations defined - skipping");return}if(!/express:/.test(t))throw new Error("fetch-mock: matching on params is only possible when using an express: matcher");m("  Expected path parameters:",e);const n=Object.keys(e),s=[],o=me(t.replace(/^express:/,""),s);return a=>{m("Attempting to match path parameters");const h=o.exec(ct(a))||[];h.shift();const p=s.reduce((u,{name:d},f)=>h[f]?Object.assign(u,{[d]:h[f]}):u,{});return m("  Expected path parameters:",e),m("  Actual path parameters:",p),n.every(u=>p[u]===e[u])}},bs=(e,t)=>{const n=t.getOption("matchPartialBody",e),{body:s}=e;return m("Generating body matcher"),(o,{body:a,method:h="get"})=>{if(m("Attempting to match body"),h.toLowerCase()==="get")return m("  GET request - skip matching body"),!0;let p;try{m("  Parsing request body as JSON"),p=JSON.parse(a)}catch(u){m("  Failed to parse request body as JSON",u)}return m("Expected body:",s),m("Actual body:",p),n&&m("matchPartialBody is true - checking for partial match only"),p&&(n?tr(p,s):rr(p,s))}},Bt=(e,t,n)=>{m("  Matching using full url",t);const s=Dt(t);return m("  Normalised url to:",t),e.identifier===t&&(m("  Updating route identifier to match normalized url:",t),e.identifier=s),o=>(m("Expected url:",s),m("Actual url:",o),n&&s.indexOf("?")?(m("Ignoring query string when matching url"),o.indexOf(s)===0):Dt(o)===s)},vs=({functionMatcher:e})=>(m("Detected user defined function matcher",e),(...t)=>(m("Calling function matcher with arguments",t),e(...t))),ws=e=>{m("Generating url matcher");const{url:t,query:n}=e;if(t==="*")return m("  Using universal * rule to match any url"),()=>!0;if(t instanceof RegExp)return m("  Using regular expression to match url:",t),s=>t.test(s);if(t.href)return m("  Using URL object to match url",t),Bt(e,t.href,n);for(const s in kt)if(t.indexOf(s+":")===0){m(`  Using ${s}: pattern to match url`,t);const o=t.replace(new RegExp(`^${s}:`),"");return kt[s](o)}return Bt(e,t,n)};var Cs=[{name:"query",matcher:ys},{name:"method",matcher:ps},{name:"headers",matcher:gs},{name:"params",matcher:ms},{name:"body",matcher:bs,usesBody:!0},{name:"functionMatcher",matcher:vs},{name:"url",matcher:ws}];const{debug:zt,setDebugNamespace:Gt,getDebug:ke}=le,qt=e=>e instanceof RegExp||typeof e=="string"||typeof e=="object"&&"href"in e,_s=e=>typeof e=="function";class ce{constructor(t,n){this.fetchMock=n,ke("compileRoute()")("Compiling route"),this.init(t),this.sanitize(),this.validate(),this.generateMatcher(),this.limit(),this.delayResponse()}validate(){if(!("response"in this))throw new Error("fetch-mock: Each route must define a response");if(!ce.registeredMatchers.some(({name:t})=>t in this))throw new Error("fetch-mock: Each route must specify some criteria for matching calls to fetch. To match all calls use '*'")}init(t){const[n,s,o={}]=t,a={};qt(n)||_s(n)?a.matcher=n:Object.assign(a,n),typeof s<"u"&&(a.response=s),Object.assign(a,o),Object.assign(this,a)}sanitize(){const t=ke("sanitize()");t("Sanitizing route properties"),this.method&&(t(`Converting method ${this.method} to lower case`),this.method=this.method.toLowerCase()),qt(this.matcher)&&(t("Mock uses a url matcher",this.matcher),this.url=this.matcher,delete this.matcher),this.functionMatcher=this.matcher||this.functionMatcher,t("Setting route.identifier..."),t(`  route.name is ${this.name}`),t(`  route.url is ${this.url}`),t(`  route.functionMatcher is ${this.functionMatcher}`),this.identifier=this.name||this.url||this.functionMatcher,t(`  -> route.identifier set to ${this.identifier}`)}generateMatcher(){Gt("generateMatcher()"),zt("Compiling matcher for route");const t=ce.registeredMatchers.map(({name:n,matcher:s,usesBody:o})=>this[n]&&{matcher:s(this,this.fetchMock),usesBody:o}).filter(n=>Boolean(n));this.usesBody=t.some(({usesBody:n})=>n),zt("Compiled matcher for route"),Gt(),this.matcher=(n,s={},o)=>t.every(({matcher:a})=>a(n,s,o))}limit(){const t=ke("limit()");if(t("Limiting number of requests to handle by route"),!this.repeat){t("  No `repeat` value set on route. Will match any number of requests");return}t(`  Route set to repeat ${this.repeat} times`);const n=this.matcher;let s=this.repeat;this.matcher=(o,a)=>{if(s&&n(o,a))return s--,!0},this.reset=()=>s=this.repeat}delayResponse(){const t=ke("delayResponse()");if(t("Applying response delay settings"),this.delay){t(`  Wrapping response in delay of ${this.delay} miliseconds`);const n=this.response;this.response=()=>(t(`Delaying response by ${this.delay} miliseconds`),new Promise(s=>setTimeout(()=>s(n),this.delay)))}else t("  No delay set on route. Will respond 'immediately' (but asynchronously)")}static addMatcher(t){ce.registeredMatchers.push(t)}}ce.registeredMatchers=[];Cs.forEach(ce.addMatcher);var lt=ce;const{setDebugPhase:qe,setDebugNamespace:He,debug:w}=le,{normalizeUrl:nr}=Je,k={},Rs=e=>typeof e=="string"&&/^[\da-zA-Z\-]+$/.test(e),As=function(e,t={},n){return{matcher:e}=new lt([Object.assign({matcher:e,response:"ok"},t)],this),n.filter(({url:s,options:o})=>e(nr(s),o))},Y=e=>function(...t){qe("inspect");const n=e.call(this,...t);return qe(),n},xs=e=>{if(!e)return;const{url:t,options:n,request:s,identifier:o,isUnmatched:a,response:h}=e,p=[t,n];return p.request=s,p.identifier=o,p.isUnmatched=a,p.response=h,p};k.filterCalls=function(e,t){w("Filtering fetch calls");let n=this._calls,s="*";return[!0,"matched"].includes(e)?(w(`Filter provided is ${e}. Returning matched calls only`),n=n.filter(({isUnmatched:o})=>!o)):[!1,"unmatched"].includes(e)?(w(`Filter provided is ${e}. Returning unmatched calls only`),n=n.filter(({isUnmatched:o})=>o)):typeof e>"u"?(w("Filter provided is undefined. Returning all calls"),n=n):Rs(e)?(w("Filter provided, looks like the name of a named route. Returning only calls handled by that route"),n=n.filter(({identifier:o})=>o===e)):(s=e==="*"?"*":nr(e),this.routes.some(({identifier:o})=>o===s)&&(w(`Filter provided, ${e}, identifies a route. Returning only calls handled by that route`),n=n.filter(o=>o.identifier===s))),(t||s!=="*")&&n.length&&(typeof t=="string"&&(t={method:t}),w("Compiling filter and options to route in order to filter all calls",e),n=As.call(this,s,t,n)),w(`Retrieved ${n.length} calls`),n.map(xs)};k.calls=Y(function(e,t){return w("retrieving matching calls"),this.filterCalls(e,t)});k.lastCall=Y(function(e,t){return w("retrieving last matching call"),[...this.filterCalls(e,t)].pop()});k.lastUrl=Y(function(e,t){return w("retrieving url of last matching call"),(this.lastCall(e,t)||[])[0]});k.lastOptions=Y(function(e,t){return w("retrieving options of last matching call"),(this.lastCall(e,t)||[])[1]});k.lastResponse=Y(function(e,t){w("retrieving respose of last matching call"),console.warn(`When doing all the following:
- using node-fetch
- responding with a real network response (using spy() or fallbackToNetwork)
- using \`fetchMock.LastResponse()\`
- awaiting the body content
... the response will hang unless your source code also awaits the response body.
This is an unavoidable consequence of the nodejs implementation of streams.
`);const n=(this.lastCall(e,t)||[]).response;try{return n.clone()}catch{return Object.entries(n._fmResults).forEach(([o,a])=>{n[o]=()=>a}),n}});k.called=Y(function(e,t){return w("checking if matching call was made"),Boolean(this.filterCalls(e,t).length)});k.flush=Y(async function(e){He("flush"),w(`flushing all fetch calls. ${e?"":"Not "}waiting for response bodies to complete download`);const t=this._holdingPromises;this._holdingPromises=[],w(`${t.length} fetch calls to be awaited`),await Promise.all(t),w("All fetch calls have completed"),e&&this._holdingPromises.length&&(w("Awaiting all fetch bodies to download"),await this.flush(e),w("All fetch bodies have completed downloading")),He()});k.done=Y(function(e){qe("inspect"),He("done"),w("Checking to see if expected calls have been made");let t;e&&typeof e!="boolean"?(w("Checking to see if expected calls have been made for single route:",e),t=[{identifier:e}]):(w("Checking to see if expected calls have been made for all routes"),t=this.routes);const n=t.map(({identifier:s})=>{if(!this.called(s))return w("No calls made for route:",s),console.warn(`Warning: ${s} not called`),!1;const o=(this.routes.find(h=>h.identifier===s)||{}).repeat;if(!o)return w("Route has been called at least once, and no expectation of more set:",s),!0;const a=this.filterCalls(s).length;return w(`Route called ${a} times:`,s),o>a?(w(`Route called ${a} times, but expected ${o}:`,s),console.warn(`Warning: ${s} only called ${a} times, but ${o} expected`),!1):!0}).every(s=>s);return He(),qe(),n});var Ts=k;const{debug:sr}=le,S=Object.assign({},Yn,Gn,Ts);S.addMatcher=function(e){lt.addMatcher(e)};S.config={fallbackToNetwork:!1,includeContentLength:!0,sendAsJson:!0,warnOnFallback:!0,overwriteRoutes:void 0};S.createInstance=function(){sr("Creating fetch-mock instance");const e=Object.create(S);return e._uncompiledRoutes=(this._uncompiledRoutes||[]).slice(),e.routes=e._uncompiledRoutes.map(t=>this.compileRoute(t)),e.fallbackResponse=this.fallbackResponse||void 0,e.config=Object.assign({},this.config||S.config),e._calls=[],e._holdingPromises=[],e.bindMethods(),e};S.compileRoute=function(e){return new lt(e,this)};S.bindMethods=function(){this.fetchHandler=S.fetchHandler.bind(this),this.reset=this.restore=S.reset.bind(this),this.resetHistory=S.resetHistory.bind(this),this.resetBehavior=S.resetBehavior.bind(this)};S.sandbox=function(){sr("Creating sandboxed fetch-mock instance");const t=Object.assign((n,s)=>t.fetchHandler(n,s),S,this.createInstance(),{Headers:this.config.Headers,Request:this.config.Request,Response:this.config.Response});return t.bindMethods(),t.isSandbox=!0,t.default=t,t};S.getOption=function(e,t={}){return e in t?t[e]:this.config[e]};var Te=S;const Fs={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var Es=Fs;const de=typeof window<"u"?window:self,{setUrlImplementation:Os}=Je;Os(de.URL);Te.global=de;Te.statusTextMap=Es;Te.config=Object.assign(Te.config,{Promise:de.Promise,Request:de.Request,Response:de.Response,Headers:de.Headers});var Z=Te.createInstance();const{makeDecorator:Ss}=__STORYBOOK_MODULE_PREVIEW_API__;var Ms="fetchMock";function Ht(e,t="mocks"){Array.isArray(e)?e.forEach(n=>{if(Array.isArray(n)){Z.mock(...n);return}let{matcher:s,response:o,options:a}=n;s&&Z.mock(s,o,a)}):e&&console.warn(`fetchMock.${t} should be an array; ${typeof e} given.`)}var $s=Ss({name:"withFetchMock",parameterName:Ms,skipIfNoParametersOrOptions:!1,wrapper(e,t,{parameters:n}){if(Z.called()&&n&&n.debug){let s={};Z.calls().forEach(o=>{s[o.identifier]=o}),console.log({"fetch-mock matched these mocks":s})}return Z.reset(),Z.config.fallbackToNetwork=!0,Ht(n.mocks),typeof n.useFetchMock=="function"&&n.useFetchMock(Z),Ht(n.catchAllMocks,"catchAllMocks"),Array.isArray(n.catchAllURLs)&&n.catchAllURLs.forEach(s=>{Z.mock({name:`catchAllURLs[ ${s} ]`,url:`begin:${s}`},404)}),e(t)}}),Ps={decorators:[$s]},Is=Ps;export{Is as default};
